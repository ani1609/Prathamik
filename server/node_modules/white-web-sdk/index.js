"use strict";require("core-js/modules/es.reflect.construct.js");require("core-js/modules/es.reflect.get.js");require("regenerator-runtime/runtime.js");require("core-js/modules/es.object.create.js");require("core-js/modules/es.object.define-property.js");require("core-js/modules/es.object.define-properties.js");require("core-js/modules/es.object.get-own-property-descriptor.js");require("core-js/modules/es.object.get-own-property-descriptors.js");require("core-js/modules/es.object.get-own-property-names.js");require("core-js/modules/es.symbol.js");require("core-js/modules/es.object.get-prototype-of.js");require("core-js/modules/es.date.to-string.js");require("core-js/modules/es.object.to-string.js");require("core-js/modules/es.regexp.to-string.js");require("core-js/modules/es.number.constructor.js");require("core-js/modules/es.parse-int.js");require("core-js/modules/es.object.freeze.js");require("core-js/modules/es.object.set-prototype-of.js");require("core-js/modules/es.array-buffer.constructor.js");require("core-js/modules/es.array-buffer.slice.js");require("core-js/modules/es.data-view.js");require("core-js/modules/es.number.max-safe-integer.js");require("core-js/modules/es.function.bind.js");require("core-js/modules/es.function.name.js");require("core-js/modules/es.array.for-each.js");require("core-js/modules/web.dom-collections.for-each.js");require("core-js/modules/es.array.map.js");require("core-js/modules/es.array.join.js");require("core-js/modules/es.regexp.exec.js");require("core-js/modules/es.string.split.js");require("core-js/modules/es.array.concat.js");require("core-js/modules/es.date.now.js");require("core-js/modules/web.timers.js");require("core-js/modules/es.promise.js");require("core-js/modules/es.array.splice.js");require("core-js/modules/es.string.match.js");require("core-js/modules/es.string.replace.js");require("core-js/modules/es.array.index-of.js");require("core-js/modules/es.number.is-safe-integer.js");require("core-js/modules/es.array.slice.js");require("core-js/modules/es.array.fill.js");require("core-js/modules/es.object.keys.js");require("core-js/modules/es.array.iterator.js");require("core-js/modules/web.dom-collections.iterator.js");require("core-js/modules/es.number.is-nan.js");require("core-js/modules/es.array.find.js");require("core-js/modules/es.array.filter.js");require("core-js/modules/es.array.some.js");require("core-js/modules/es.array.sort.js");require("core-js/modules/es.string.iterator.js");require("core-js/modules/web.url.js");require("core-js/modules/es.string.search.js");require("core-js/modules/es.array.is-array.js");require("core-js/modules/es.regexp.constructor.js");require("core-js/modules/es.symbol.description.js");require("core-js/modules/es.array.find-index.js");require("core-js/modules/es.object.seal.js");require("core-js/modules/es.object.assign.js");require("core-js/modules/es.string.from-code-point.js");require("core-js/modules/es.number.is-finite.js");require("core-js/modules/es.number.is-integer.js");require("core-js/modules/es.number.parse-float.js");require("core-js/modules/es.number.parse-int.js");require("core-js/modules/es.date.to-json.js");require("core-js/modules/web.url.to-json.js");require("core-js/modules/es.symbol.iterator.js");require("core-js/modules/es.array.every.js");require("core-js/modules/es.array.last-index-of.js");require("core-js/modules/es.array.reduce.js");require("core-js/modules/es.array.reduce-right.js");require("core-js/modules/es.string.anchor.js");require("core-js/modules/es.parse-float.js");require("core-js/modules/es.array.includes.js");require("core-js/modules/es.string.includes.js");require("core-js/modules/es.number.min-safe-integer.js");require("core-js/modules/es.array.reverse.js");require("core-js/modules/es.map.js");require("core-js/modules/es.set.js");require("core-js/modules/es.string.repeat.js");require("core-js/modules/es.number.to-fixed.js");require("core-js/modules/es.string.ends-with.js");require("core-js/modules/es.string.starts-with.js");require("core-js/modules/es.weak-set.js");require("core-js/modules/es.string.trim.js");require("core-js/modules/es.weak-map.js");require("core-js/modules/es.array.from.js");require("core-js/modules/es.string.italics.js");require("core-js/modules/es.string.bold.js");require("core-js/modules/es.string.code-point-at.js");require("core-js/modules/es.string.pad-start.js");require("core-js/modules/es.typed-array.uint8-array.js");require("core-js/modules/es.typed-array.copy-within.js");require("core-js/modules/es.typed-array.every.js");require("core-js/modules/es.typed-array.fill.js");require("core-js/modules/es.typed-array.filter.js");require("core-js/modules/es.typed-array.find.js");require("core-js/modules/es.typed-array.find-index.js");require("core-js/modules/es.typed-array.for-each.js");require("core-js/modules/es.typed-array.includes.js");require("core-js/modules/es.typed-array.index-of.js");require("core-js/modules/es.typed-array.iterator.js");require("core-js/modules/es.typed-array.join.js");require("core-js/modules/es.typed-array.last-index-of.js");require("core-js/modules/es.typed-array.map.js");require("core-js/modules/es.typed-array.reduce.js");require("core-js/modules/es.typed-array.reduce-right.js");require("core-js/modules/es.typed-array.reverse.js");require("core-js/modules/es.typed-array.set.js");require("core-js/modules/es.typed-array.slice.js");require("core-js/modules/es.typed-array.some.js");require("core-js/modules/es.typed-array.sort.js");require("core-js/modules/es.typed-array.subarray.js");require("core-js/modules/es.typed-array.to-locale-string.js");require("core-js/modules/es.typed-array.to-string.js");require("core-js/modules/es.string.link.js");var _Object$freeze,_Object$freeze2;function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _toArray(arr){return _arrayWithHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableRest()}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _wrapNativeSuper(Class){var _cache=typeof Map==="function"?new Map:undefined;_wrapNativeSuper=function _wrapNativeSuper(Class){if(Class===null||!_isNativeFunction(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function")}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor)}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _setPrototypeOf(Wrapper,Class)};return _wrapNativeSuper(Class)}function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor;if(Class)_setPrototypeOf(instance,Class.prototype);return instance}}return _construct.apply(null,arguments)}function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e12){throw _e12},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e13){didErr=true;err=_e13},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}var Zw=Object.create;var Dn=Object.defineProperty,Jw=Object.defineProperties,dm=Object.getOwnPropertyDescriptor,e1=Object.getOwnPropertyDescriptors,t1=Object.getOwnPropertyNames,um=Object.getOwnPropertySymbols,i1=Object.getPrototypeOf,pm=Object.prototype.hasOwnProperty,r1=Object.prototype.propertyIsEnumerable;var mm=function mm(e,t,i){return t in e?Dn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},I=function I(e,t){for(var i in t||(t={})){pm.call(t,i)&&mm(e,i,t[i])}if(um){var _iterator=_createForOfIteratorHelper(um(t)),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var i=_step.value;r1.call(t,i)&&mm(e,i,t[i])}}catch(err){_iterator.e(err)}finally{_iterator.f()}}return e},D=function D(e,t){return Jw(e,e1(t))},fm=function fm(e){return Dn(e,"__esModule",{value:!0})};var OE=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")};var Bn=function Bn(e,t){fm(e);for(var i in t){Dn(e,i,{get:t[i],enumerable:!0})}},n1=function n1(e,t,i){if(t&&_typeof(t)=="object"||typeof t=="function"){var _iterator2=_createForOfIteratorHelper(t1(t)),_step2;try{var _loop=function _loop(){var r=_step2.value;!pm.call(e,r)&&r!=="default"&&Dn(e,r,{get:function get(){return t[r]},enumerable:!(i=dm(t,r))||i.enumerable})};for(_iterator2.s();!(_step2=_iterator2.n()).done;){_loop()}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}return e},P=function P(e){return n1(fm(Dn(e!=null?Zw(i1(e)):{},"default",e&&e.__esModule&&"default"in e?{get:function get(){return e["default"]},enumerable:!0}:{value:e,enumerable:!0})),e)},vr=function vr(e,t,i,r){for(var n=r>1?void 0:r?dm(t,i):t,s=e.length-1,o;s>=0;s--){(o=e[s])&&(n=(r?o(t,i,n):o(n))||n)}return r&&n&&Dn(t,i,n),n};Bn(exports,{AdminObserverId:function AdminObserverId(){return ce},AkkoVersion:function AkkoVersion(){return Le},AnimationMode:function AnimationMode(){return $},ApplianceNames:function ApplianceNames(){return L},AsyncModuleLoadMode:function AsyncModuleLoadMode(){return $r},CNode:function CNode(){return Oi},CursorNames:function CursorNames(){return se},DefaultHotKeys:function DefaultHotKeys(){return cp},DeviceType:function DeviceType(){return Ue},DisplayerConsumer:function DisplayerConsumer(){return $p},EventPhase:function EventPhase(){return Mi},EventScope:function EventScope(){return Ve},InvisiblePlugin:function InvisiblePlugin(){return js},KeyboardKind:function KeyboardKind(){return Si},LoggerReportMode:function LoggerReportMode(){return Ci},NewPencilWritingQuality:function NewPencilWritingQuality(){return yr},NullIdentifier:function NullIdentifier(){return xt},ObserverMode:function ObserverMode(){return Vi},PPTKind:function PPTKind(){return Tn},PPTTaskStatus:function PPTTaskStatus(){return ac},PPTTaskStep:function PPTTaskStep(){return lc},PlayerConsumer:function PlayerConsumer(){return Yp},PlayerPhase:function PlayerPhase(){return Ze},RenderEngine:function RenderEngine(){return ei},RoomConsumer:function RoomConsumer(){return ra},RoomErrorLevel:function RoomErrorLevel(){return Zr},RoomPhase:function RoomPhase(){return le},ScenePathType:function ScenePathType(){return ct},ScreenType:function ScreenType(){return Jt},ShapeType:function ShapeType(){return mc},UpdateEventKind:function UpdateEventKind(){return B},ViewMode:function ViewMode(){return pe},ViewVisionMode:function ViewVisionMode(){return Vt},WhiteVersion:function WhiteVersion(){return AE},WhiteWebSdk:function WhiteWebSdk(){return lm},autorun:function autorun(){return Yc.autorun},contentModeAspectFill:function contentModeAspectFill(){return nw},contentModeAspectFillScale:function contentModeAspectFillScale(){return Sp},contentModeAspectFit:function contentModeAspectFit(){return sw},contentModeAspectFitScale:function contentModeAspectFitScale(){return aw},contentModeAspectFitSpace:function contentModeAspectFitSpace(){return ow},contentModeScale:function contentModeScale(){return Xo},createPPTTask:function createPPTTask(){return qS},createPlugins:function createPlugins(){return Xp},injectCustomStyle:function injectCustomStyle(){return Nw},isPlayer:function isPlayer(){return Sw},isRoom:function isRoom(){return kc},listenDisposed:function listenDisposed(){return ja},listenUpdated:function listenUpdated(){return on},previewPPT:function previewPPT(){return rp},reaction:function reaction(){return Yc.reaction},setAsyncModuleLoadMode:function setAsyncModuleLoadMode(){return BS},toJS:function toJS(){return ue},unlistenDisposed:function unlistenDisposed(){return za},unlistenUpdated:function unlistenUpdated(){return an}});var s1="2.16.42",o1="cn-hz",a1={identifier:"link.netless/white-model-render",origin:"https://sdk.netless.link"},l1=["api.netless.link","api.whiteboard.agora.io"],c1={pptApi:["api.netless.link"]},h1={argusOptions:{reportResourceURL:"https://rest-argus-ad.agoralab.co/v3/report",vid:3}},k={sdkVersion:s1,defaultRegion:o1,modules:a1,shuntApiHosts:l1,hosts:c1,log:h1};var gm=P(require("mobx"));(0,gm.configure)({useProxies:window.__netlessMobXUseProxies,isolateGlobalState:!0});var qj=P(require("@netless/canvas-polyfill"));var ad={};Bn(ad,{ActionFrameType:function ActionFrameType(){return ke},AdminObserverId:function AdminObserverId(){return ce},AkkoApp:function AkkoApp(){return od},AkkoFetcher:function AkkoFetcher(){return $i},AkkoVersion:function AkkoVersion(){return Le},Environment:function Environment(){return Mt},EventPhase:function EventPhase(){return Mi},EventScope:function EventScope(){return Ve},FramePicker:function FramePicker(){return _t},ImagePhase:function ImagePhase(){return sn},KickReason:function KickReason(){return qi},Library:function Library(){return Th},MagixPhase:function MagixPhase(){return j},NullIdentifier:function NullIdentifier(){return xt},ReconstructorFactory:function ReconstructorFactory(){return _g},ReconstructorPhase:function ReconstructorPhase(){return fe},ReconstructorSeekingResult:function ReconstructorSeekingResult(){return $t},SocketErrorCode:function SocketErrorCode(){return mt},UpdateEventKind:function UpdateEventKind(){return B},__context:function __context(){return Mf},copy:function copy(){return At},createBuffer:function createBuffer(){return Ct},createElement:function createElement(){return ig},event:function event(){return of},findClass:function findClass(){return Zh},findClassId:function findClassId(){return fg},findIdentifierWith:function findIdentifierWith(){return Va},getAuthorId:function getAuthorId(){return Of},getClassReflection:function getClassReflection(){return Qi},getCurrentTimestamp:function getCurrentTimestamp(){return Af},getEnvironment:function getEnvironment(){return Ef},getLibrary:function getLibrary(){return Pa},getResource:function getResource(){return hf},getSnapshot:function getSnapshot(){return Bf},getUser:function getUser(){return Lf},getUserIds:function getUserIds(){return Df},getUsersCount:function getUsersCount(){return Nf},hasUser:function hasUser(){return Rf},isAkkoObject:function isAkkoObject(){return Tf},isAkkoWrappedObject:function isAkkoWrappedObject(){return He},isAkkoWrappedObjectAccessible:function isAkkoWrappedObjectAccessible(){return pg},isBuffer:function isBuffer(){return we},isInstanceOf:function isInstanceOf(){return Ye},listenDisposed:function listenDisposed(){return ja},listenUpdated:function listenUpdated(){return on},noEffects:function noEffects(){return nn},resolve:function resolve(){return Pm},socketFactory:function socketFactory(){return Ma},"transient":function transient(){return Ks},translateToAckFrame:function translateToAckFrame(){return rf},unlistenDisposed:function unlistenDisposed(){return za},unlistenUpdated:function unlistenUpdated(){return an},wrapBuffer:function wrapBuffer(){return ai}});var Lm=P(require("spark-md5"));var d1=Object.defineProperty,u1=Object.defineProperties,p1=Object.getOwnPropertyDescriptors,ym=Object.getOwnPropertySymbols,m1=Object.prototype.hasOwnProperty,f1=Object.prototype.propertyIsEnumerable,bm=function bm(e,t,i){return t in e?d1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},Zc=function Zc(e,t){for(var i in t||(t={})){m1.call(t,i)&&bm(e,i,t[i])}if(ym){var _iterator3=_createForOfIteratorHelper(ym(t)),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var i=_step3.value;f1.call(t,i)&&bm(e,i,t[i])}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}return e},g1=function g1(e,t){return u1(e,p1(t))},DE=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")},Jc=/*#__PURE__*/function(){function Jc(){_classCallCheck(this,Jc)}_createClass(Jc,[{key:"id",get:function get(){return this._id===void 0&&(this._id="".concat(Jc.nextBufferId),Jc.nextBufferId+=1),this._id}}]);return Jc}(),eh=Jc;eh.nextBufferId=0;var th=8,vm=b1(),y1=v1();function Sm(e,t,i){var r=new String(new Number(i).toString(16)),n=2*th-r.length;for(var s=0;s<th;++s){var o=2*s-n;if(o<-1)e.setUint8(t+s,0);else if(o===-1){var a=r.substr(0,1),l=vm[a];e.setUint8(t+s,l)}else{var _a2=r.substr(o,2),_l2=vm[_a2];e.setUint8(t+s,_l2)}}}function wm(e,t){var i="";for(var r=0;r<th;++r){var n=e.getUint8(t+r);i+=y1[n]}return parseInt(i,16)}function b1(){var e={};for(var t=0;t<256;++t){var i=t.toString(16);i.length===1&&(e["0"+i]=t),e[i]=t}return Object.freeze(e)}function v1(){var e=[];for(var t=0;t<256;++t){var i=t.toString(16);i.length===1?e[t]="0"+i:e[t]=i}return Object.freeze(e)}var ih=/*#__PURE__*/function(_eh){_inherits(ih,_eh);var _super=_createSuper(ih);function ih(e,t){var _this;_classCallCheck(this,ih);_this=_super.call(this);_this.buffer=e,_this.create=t;return _this}_createClass(ih,[{key:"readonly",get:function get(){return!0}},{key:"byteLength",get:function get(){return this.buffer.byteLength}},{key:"primitiveBuffer",get:function get(){return this.buffer}},{key:"isEqualsTo",value:function isEqualsTo(e){if(this.byteLength!==e.byteLength)return!1;for(var t=0;t<this.byteLength;++t){if(this.getUint8(t)!==e.getUint8(t))return!1}return!0}},{key:"slice",value:function slice(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.buffer.length-e;var i=this.create(t),r=i.buffer;for(var n=0;n<t;++n){r.writeUInt8(this.buffer.readUInt8(e+n),n)}return i}},{key:"getFloat64",value:function getFloat64(e){return this.buffer.readDoubleLE(e)}},{key:"getUint16",value:function getUint16(e){return this.buffer.readUInt16LE(e)}},{key:"getInt32",value:function getInt32(e){return this.buffer.readInt32LE(e)}},{key:"getUint32",value:function getUint32(e){return this.buffer.readUInt32LE(e)}},{key:"getUint8",value:function getUint8(e){return this.buffer.readUInt8(e)}},{key:"getUint64",value:function getUint64(e){return wm(this,e)}}]);return ih}(eh),Cm=/*#__PURE__*/function(_ih){_inherits(Cm,_ih);var _super2=_createSuper(Cm);function Cm(){_classCallCheck(this,Cm);return _super2.apply(this,arguments)}_createClass(Cm,[{key:"readonly",get:function get(){return!1}},{key:"freeze",value:function freeze(){return Object.setPrototypeOf(this,ih.prototype),this}},{key:"fill",value:function fill(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:e.byteLength-i;var n=e.primitiveBuffer;if(n instanceof ArrayBuffer){var s=new DataView(n),o=this.buffer.byteLength-t,a=Math.min(r,o);for(var l=0;l<a;++l){this.buffer.writeUInt8(s.getUint8(l+i),l+t)}return a}else return n.copy(this.buffer,t,i,i+r)}},{key:"setFloat64",value:function setFloat64(e,t){this.buffer.writeDoubleLE(t,e)}},{key:"setUint16",value:function setUint16(e,t){this.buffer.writeUInt16LE(t,e)}},{key:"setInt32",value:function setInt32(e,t){this.buffer.writeInt32LE(t,e)}},{key:"setUint32",value:function setUint32(e,t){this.buffer.writeUInt32LE(t,e)}},{key:"setUint8",value:function setUint8(e,t){this.buffer.writeUInt8(t,e)}},{key:"setUint64",value:function setUint64(e,t){Sm(this,e,t)}}]);return Cm}(ih),rh=/*#__PURE__*/function(_eh2){_inherits(rh,_eh2);var _super3=_createSuper(rh);function rh(e){var _this2;_classCallCheck(this,rh);_this2=_super3.call(this);_this2.arrayBuffer=e,_this2.dataView=new DataView(e);return _this2}_createClass(rh,[{key:"readonly",get:function get(){return!0}},{key:"byteLength",get:function get(){return this.arrayBuffer.byteLength}},{key:"primitiveBuffer",get:function get(){return this.arrayBuffer}},{key:"isEqualsTo",value:function isEqualsTo(e){if(this.byteLength!==e.byteLength)return!1;for(var t=0;t<this.byteLength;++t){if(this.getUint8(t)!==e.getUint8(t))return!1}return!0}},{key:"slice",value:function slice(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.dataView.byteLength-e;var i=new ArrayBuffer(t),r=new DataView(i);for(var n=0;n<t;++n){r.setUint8(n,this.dataView.getUint8(e+n))}return new nh(i)}},{key:"getFloat64",value:function getFloat64(e){return this.dataView.getFloat64(e,!0)}},{key:"getUint16",value:function getUint16(e){return this.dataView.getUint16(e,!0)}},{key:"getInt32",value:function getInt32(e){return this.dataView.getInt32(e,!0)}},{key:"getUint32",value:function getUint32(e){return this.dataView.getUint32(e,!0)}},{key:"getUint8",value:function getUint8(e){return this.dataView.getUint8(e)}},{key:"getUint64",value:function getUint64(e){return wm(this,e)}}]);return rh}(eh),nh=/*#__PURE__*/function(_rh){_inherits(nh,_rh);var _super4=_createSuper(nh);function nh(){_classCallCheck(this,nh);return _super4.apply(this,arguments)}_createClass(nh,[{key:"readonly",get:function get(){return!1}},{key:"freeze",value:function freeze(){return Object.setPrototypeOf(this,rh.prototype),this}},{key:"fill",value:function fill(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Number.MAX_SAFE_INTEGER;var n=e.primitiveBuffer,s=this.dataView.byteLength-t,o=Math.min(r,s);if(n instanceof ArrayBuffer){var a=new DataView(n);for(var l=0;l<o;++l){this.dataView.setUint8(l+t,a.getUint8(l+i))}}else for(var _a3=0;_a3<o;++_a3){this.dataView.setUint8(_a3+t,n.readUInt8(_a3+i))}return o}},{key:"setFloat64",value:function setFloat64(e,t){this.dataView.setFloat64(e,t,!0)}},{key:"setUint16",value:function setUint16(e,t){this.dataView.setUint16(e,t,!0)}},{key:"setInt32",value:function setInt32(e,t){this.dataView.setInt32(e,t,!0)}},{key:"setUint32",value:function setUint32(e,t){this.dataView.setUint32(e,t,!0)}},{key:"setUint8",value:function setUint8(e,t){this.dataView.setUint8(e,t)}},{key:"setUint64",value:function setUint64(e,t){Sm(this,e,t)}}]);return nh}(rh),S1=function S1(){var _this3=this;_classCallCheck(this,S1);this.create=function(e){return _this3.nodeBuffer?new Cm(_this3.nodeBuffer.alloc(e),_this3.create):new nh(new ArrayBuffer(e))},this.wrap=function(e){return _this3.nodeBuffer&&e instanceof _this3.nodeBuffer?new Cm(e,_this3.create):new nh(e)},typeof Buffer=="function"?this.nodeBuffer=global.Buffer:this.nodeBuffer=null},km=new S1,Ct=km.create,ai=km.wrap;function we(e){return e instanceof ih||e instanceof rh}var N;(function(e){e.Any="any",e.Never="never",e.Undefined="undefined",e.Null="null",e.String="string",e.Number="number",e.Boolean="boolean",e.Function="function",e.Object="object",e.And="and",e.Or="or",e.Generic="generic",e.Generator="generator",e.Reference="reference",e.GlobalReference="globalReference"})(N||(N={}));var xm=/*#__PURE__*/function(){function xm(){_classCallCheck(this,xm);this.singletonMap=xm.createSingletonMap()}_createClass(xm,[{key:"getSingletonType",value:function getSingletonType(e){return this.singletonMap[e]}},{key:"getFunctionType",value:function getFunctionType(){return{typeEnum:N.Function}}},{key:"getObjectType",value:function getObjectType(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},e=_ref.key,t=_ref.index,i=_ref.properties;return{typeEnum:N.Object,key:e||this.getSingletonType(N.Undefined),index:t||this.getSingletonType(N.Undefined),properties:i||{}}}},{key:"getCompoundType",value:function getCompoundType(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return{typeEnum:e,children:t}}},{key:"getGenericType",value:function getGenericType(e){return{index:e,typeEnum:N.Generic}}},{key:"getGeneratorType",value:function getGeneratorType(_ref2){var e=_ref2.template,t=_ref2.params;return{typeEnum:N.Generator,template:e,params:t||[]}}},{key:"getReferenceType",value:function getReferenceType(e){return{typeEnum:N.Reference,name:e}}},{key:"getGlobalReferenceType",value:function getGlobalReferenceType(e,t){return{typeEnum:N.GlobalReference,path:e,name:t}}}],[{key:"createSingletonMap",value:function createSingletonMap(){var e={},t=[N.Any,N.Never,N.Undefined,N.Null,N.String,N.Number,N.Boolean];for(var _i2=0,_t2=t;_i2<_t2.length;_i2++){var i=_t2[_i2];e[i]={typeEnum:i}}return Object.freeze(e)}}]);return xm}();var et=new xm,BE=et.getSingletonType.bind(et),FE=et.getFunctionType.bind(et),jE=et.getObjectType.bind(et),zE=et.getCompoundType.bind(et),UE=et.getGenericType.bind(et),VE=et.getGeneratorType.bind(et),WE=et.getReferenceType.bind(et),HE=et.getGlobalReferenceType.bind(et),xi=/*#__PURE__*/function(_Error){_inherits(xi,_Error);var _super5=_createSuper(xi);function xi(e){var _this4;_classCallCheck(this,xi);_this4=_super5.call(this,e);_this4.name="RuntimeError";return _this4}return xi}(/*#__PURE__*/_wrapNativeSuper(Error)),w1=/*#__PURE__*/function(){function w1(e,t,i,r){_classCallCheck(this,w1);this.akkoVersion=e,this.akkoObjectBaseClass=t,this.libraryFactory=i,this.onCreatedLibrary=r,this.classHandlers={}}_createClass(w1,[{key:"baseClass",value:function baseClass(){return this.akkoObjectBaseClass}},{key:"wrapSuperClass",value:function wrapSuperClass(e){if(e===Object)return this.akkoObjectBaseClass;if(typeof e!="function")return e;{var t=e;for(;t!==this.akkoObjectBaseClass;){var i=Object.getPrototypeOf(t.prototype);if(!i)throw new xi("class ".concat(e.name," can't be extended, it's out of library"));t=i.constructor}return e}}},{key:"declareClass",value:function declareClass(_ref3){var e=_ref3.classId,t=_ref3.clazz,i=_ref3.superClass,r=_ref3.memberDecorators;if(this.classHandlers[e])throw new xi("class id ".concat(e," was declared"));this.classHandlers[e]={classId:e,clazz:t,superClass:i,memberDecorators:r||{}}}},{key:"createLibrary",value:function createLibrary(e,t){var i={};for(var n in t.classes){var s=t.classes[n],o=this.classHandlers[n],a=[];var _iterator4=_createForOfIteratorHelper(s.members),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var l=_step4.value;var h=o.memberDecorators[l.name];a.push(g1(Zc({},l),{decorators:h||Object.freeze([])}))}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}i[n]={classId:o.classId,clazz:o.clazz,superClass:o.superClass,objectFormatId:s.objectFormatId,members:a}}var r=this.libraryFactory({appIdentifier:t.identifier,appVersion:t.version,akkoVersion:t.akko,formatBase64:t.formatBase64,formatHash:t.formatHash,rootConstructor:e,classDeclarations:i});return Object.defineProperty(e,"__library",{enumerable:!1,configurable:!1,writable:!1,value:r}),this.onCreatedLibrary(r),e}}]);return w1}();function C1(e){var t=new w1(e.akkoVersion,e.akkoObjectBaseClass,e.libraryFactory,e.onCreatedLibrary);return Object.freeze({baseClass:t.baseClass.bind(t),wrapSuperClass:t.wrapSuperClass.bind(t),declareClass:t.declareClass.bind(t),createLibrary:t.createLibrary.bind(t),creator:e.coreFunctions.creator,updater:e.coreFunctions.updater,wrapper:e.coreFunctions.wrapper,unwrapper:e.coreFunctions.unwrapper,jsxUnwrapper:e.coreFunctions.jsxUnwrapper,getter:e.coreFunctions.getter,setter:e.coreFunctions.setter,caller:e.coreFunctions.caller,remover:e.coreFunctions.remover,prefix:e.coreFunctions.prefix,postfix:e.coreFunctions.postfix})}function Pm(){var t=[];for(var _len=arguments.length,e=new Array(_len),_key=0;_key<_len;_key++){e[_key]=arguments[_key]}return e.map(function(i){return k1(i)}).forEach(function(i){t.length===0||!x1(i)?t=i:t=P1(t,i)}),t.join("/")}function k1(e){var t=e.split("/");return t.length>0&&(t[0]==="."&&t.shift(),t[t.length-1]===""&&t.pop()),t}function x1(e){return e.length>0&&e[0]!==""}function P1(e,t){var i=Im(e),r=Im(t);if(i.pureCells.length>r.doubleDotsCount){for(var n=0;n<r.doubleDotsCount;++n){i.pureCells.pop()}return[].concat(_toConsumableArray(Mm(i.doubleDotsCount)),_toConsumableArray(i.pureCells),_toConsumableArray(r.pureCells))}else{var _n2=r.doubleDotsCount-i.pureCells.length;return[].concat(_toConsumableArray(Mm(i.doubleDotsCount+_n2)),_toConsumableArray(r.pureCells))}}function Im(e){var t=[],i=0;var _iterator5=_createForOfIteratorHelper(e),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var r=_step5.value;r===".."?i+=1:t.push(r)}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}return{doubleDotsCount:i,pureCells:t}}function Mm(e){var t=[];for(var i=0;i<e;++i){t.push("..")}return t}var Tm=function Tm(e){var _this5=this;_classCallCheck(this,Tm);this.contextsStack=[],this.context=function(t){switch(t){case"index":{var i=C1({akkoVersion:_this5.akkoVersion,akkoObjectBaseClass:_this5.akkoObjectBaseClass,libraryFactory:_this5.libraryFactory,coreFunctions:_this5.coreFunctions,onCreatedLibrary:function onCreatedLibrary(){return _this5.contextsStack.pop()}});return _this5.contextsStack.push(i),i}case"module":{var _i3=_this5.contextsStack[_this5.contextsStack.length-1];if(!_i3)throw new xi("can't import index out of library");return _i3}default:throw new xi("unexpect mode ".concat(JSON.stringify(t)));}},this.isAkkoObject=function(t){return t instanceof _this5.akkoObjectBaseClass},this.getLibrary=function(t){if(typeof t=="function"){var i=t.__library;if(_typeof(i)=="object")return i}else if(_this5.isAkkoObject(t))return _this5.getLibrary(t.constructor)},this.akkoVersion=e.akkoVersion,this.akkoObjectBaseClass=e.akkoObjectBaseClass,this.libraryFactory=e.libraryFactory,this.coreFunctions=Object.freeze(Zc({},e.coreFunctions))};function Em(e){return e.type===la.Property}function Am(e){return e.type===la.Method}var la;(function(e){e.Method="method",e.Property="property"})(la||(la={}));var Fn;(function(e){e.Value="value",e.Readonly="readonly",e.Writeonly="writeonly",e.Accessible="accessible"})(Fn||(Fn={}));var Pi=/*#__PURE__*/function(){function Pi(e){var _this6=this;_classCallCheck(this,Pi);this.invoker=e,this.timer=null,this.fireAt=-1,this.invokeWhenTimeout=function(){var t=Date.now();if(t>=_this6.fireAt)_this6.timer=null,_this6.fireAt=-1,_this6.invoker();else{var i=_this6.fireAt-t;_this6.timer=setTimeout(_this6.invokeWhenTimeout,i)}}}_createClass(Pi,[{key:"isRunning",get:function get(){return this.timer!==null}},{key:"refreshAndInvokeAfterInterval",value:function refreshAndInvokeAfterInterval(e){var t=Date.now();if(this.timer===null)this.timer=setTimeout(this.invokeWhenTimeout,e),this.fireAt=t+e;else{var i=t+e;i<=this.fireAt&&(clearTimeout(this.timer),this.timer=setTimeout(this.invokeWhenTimeout,e)),this.fireAt=i}}},{key:"cancel",value:function cancel(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)}},{key:"dispose",value:function dispose(){this.cancel(),this.invoker=Pi.emptyInvoker}}],[{key:"emptyInvoker",value:function emptyInvoker(){}}]);return Pi}();function ca(e){return(typeof window==="undefined"?"undefined":_typeof(window))=="object"&&"requestIdleCallback"in window?new M1(e):new I1}var I1=/*#__PURE__*/function(){function I1(){_classCallCheck(this,I1)}_createClass(I1,[{key:"invokeOnIdle",value:function invokeOnIdle(e){for(var _len2=arguments.length,t=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){t[_key2-1]=arguments[_key2]}return new Promise(function(i,r){try{i(e.apply(void 0,t))}catch(n){r(n)}})}},{key:"invoke",value:function invoke(e){for(var _len3=arguments.length,t=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++){t[_key3-1]=arguments[_key3]}return e.apply(void 0,t)}}]);return I1}(),M1=/*#__PURE__*/function(){function M1(e){var _this7=this;_classCallCheck(this,M1);this.queue=[],this.isWaitingIdle=!1,this.onFire=function(){try{if(_this7.queue.length>0){var _this7$config=_this7.config,t=_this7$config.checkingTimeMod,i=_this7$config.maxInvokingDuration,r=_this7$config.maxPaddingDuration,n=Date.now(),s;for(s=0;s<_this7.queue.length;++s){var o=_this7.queue[s];if(_this7.handle(o),n<o.beginAt+r&&s!==0&&s%t==0&&Date.now()-n>i)break}_this7.queue.splice(0,s+1),_this7.isWaitingIdle=!1,_this7.queue.length>0&&_this7.requestNextFire()}}catch(t){console.error("[Error] IdleQueue is crash (akko-core)"),console.error(t)}},this.handle=function(_ref4){var t=_ref4.invoker,i=_ref4.params,r=_ref4.resolve,n=_ref4.reject;try{r(t.apply(void 0,_toConsumableArray(i)))}catch(s){n(s)}},this.config=Object.freeze(Zc({},e))}_createClass(M1,[{key:"invoke",value:function invoke(e){for(var _len4=arguments.length,t=new Array(_len4>1?_len4-1:0),_key4=1;_key4<_len4;_key4++){t[_key4-1]=arguments[_key4]}return this.queue.length>0&&this.queue.splice(0).forEach(this.handle),e.apply(void 0,t)}},{key:"invokeOnIdle",value:function invokeOnIdle(e){var _this8=this;for(var _len5=arguments.length,t=new Array(_len5>1?_len5-1:0),_key5=1;_key5<_len5;_key5++){t[_key5-1]=arguments[_key5]}return new Promise(function(i,r){var n=Date.now();_this8.queue.push({invoker:e,params:t,beginAt:n,resolve:i,reject:r}),!_this8.isWaitingIdle&&_this8.queue.length===1&&(_this8.isWaitingIdle=!0,_this8.requestNextFire())})}},{key:"requestNextFire",value:function requestNextFire(){window.requestIdleCallback(this.onFire,{timeout:this.config.timeout})}}]);return M1}(),dt=/*#__PURE__*/function(){function dt(e,t){_classCallCheck(this,dt);this.isFreezed=!1,this.shouldInvokeAfterFreeze=!1,this.latestInvokeTimestamp=0,this.timer=-1,this._limitDuration=e,this.invoker=t,this.invokeWhenTimeout=this.invokeWhenTimeout.bind(this)}_createClass(dt,[{key:"limitDuration",get:function get(){return this._limitDuration},set:function set(e){if(this._limitDuration!==e){if(this._limitDuration=e,this.timer!==-1){clearTimeout(this.timer);var t=this.nextInvokeTimeDuration();this.timer=setTimeout(this.invokeWhenTimeout,t)}this.invoke()}}},{key:"isWaitingToInvoke",get:function get(){return this.shouldInvokeAfterFreeze||this.timer!==-1}},{key:"invoke",value:function invoke(){if(this.isFreezed)this.shouldInvokeAfterFreeze=!0;else if(this.timer===-1){var e=this.nextInvokeTimeDuration();this.timer=setTimeout(this.invokeWhenTimeout,e)}}},{key:"nextInvokeTimeDuration",value:function nextInvokeTimeDuration(){var e=Date.now(),t=this.latestInvokeTimestamp+this.limitDuration-e;return Math.max(0,t)}},{key:"invokeWhenTimeout",value:function invokeWhenTimeout(){this.timer=-1,this.latestInvokeTimestamp=Date.now(),this.invoker()}},{key:"cancel",value:function cancel(){this.isFreezed?this.shouldInvokeAfterFreeze=!1:this.timer!==-1&&(clearTimeout(this.timer),this.timer=-1)}},{key:"freeze",value:function freeze(){this.isFreezed||(this.timer!==-1&&(clearTimeout(this.timer),this.timer=-1,this.shouldInvokeAfterFreeze=!0),this.isFreezed=!0)}},{key:"unfreeze",value:function unfreeze(){!this.isFreezed||(this.isFreezed=!1,this.shouldInvokeAfterFreeze&&(this.shouldInvokeAfterFreeze=!1,this.invoke()))}}]);return dt}(),sh=Object.freeze(["alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega"]),kt=/*#__PURE__*/function(){function kt(e,t,i,r){_classCallCheck(this,kt);this.x=e,this.y=t,this.z=i,this.suffix=r,Object.freeze(this)}_createClass(kt,[{key:"withoutSuffix",value:function withoutSuffix(){return new kt(this.x,this.y,this.z)}},{key:"toString",value:function toString(){var e="".concat(this.x,".").concat(this.y,".").concat(this.z);return this.suffix&&(e+="-".concat(this.suffix.greekLetter,".").concat(this.suffix.number)),e}}],[{key:"parse",value:function parse(e){if(!/^\d+\.\d+\.\d+(-\w+\.\d+)?$/i.test(e))throw new Error("invalid version format ".concat(JSON.stringify(e)));var t=e.match(/-\w+\.\d+$/),i,r=e;t&&(i=kt.parseSuffix(e,t[0].replace(/^-/i,"")),r=e.substring(0,e.length-t[0].length));var _kt$parseVersionArray=kt.parseVersionArray(e,r),_kt$parseVersionArray2=_slicedToArray(_kt$parseVersionArray,3),n=_kt$parseVersionArray2[0],s=_kt$parseVersionArray2[1],o=_kt$parseVersionArray2[2];return new kt(n,s,o,i)}},{key:"parseSuffix",value:function parseSuffix(e,t){var i=t.split("."),r=i[0];if(sh.indexOf(r)===-1)throw new Error("invalid Greek letter ".concat(JSON.stringify(r)," of ").concat(JSON.stringify(e)));var n=parseInt(i[1],10);if(!Number.isSafeInteger(n))throw new Error("invalid version number ".concat(JSON.stringify(n)," of ").concat(JSON.stringify(e)));return Object.freeze({greekLetter:r,number:n})}},{key:"parseVersionArray",value:function parseVersionArray(e,t){var i=[];var _iterator6=_createForOfIteratorHelper(t.split(".")),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var r=_step6.value;var n=parseInt(r,10);if(!Number.isSafeInteger(n))throw new Error("invalid version number ".concat(JSON.stringify(r)," of ").concat(JSON.stringify(e)));i.push(n)}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}return i}},{key:"compare",value:function compare(e,t){var i=e.x-t.x;if(i!==0||(i=e.y-t.y,i!==0)||(i=e.z-t.z,i!==0))return i;if(!e.suffix&&t.suffix)return 1;if(e.suffix&&!t.suffix)return-1;if(!e.suffix&&!t.suffix)return 0;var r=e.suffix.greekLetter,n=t.suffix.greekLetter;return i=sh.indexOf(r)-sh.indexOf(n),i!==0?i:e.suffix.number-t.suffix.number}}]);return kt}(),Le="1.4.4";var Km=P(require("spark-md5"));var T1=Object.defineProperty,E1=Object.defineProperties,A1=Object.getOwnPropertyDescriptors,Om=Object.getOwnPropertySymbols,O1=Object.prototype.hasOwnProperty,R1=Object.prototype.propertyIsEnumerable,Rm=function Rm(e,t,i){return t in e?T1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},Nm=function Nm(e,t){for(var i in t||(t={})){O1.call(t,i)&&Rm(e,i,t[i])}if(Om){var _iterator7=_createForOfIteratorHelper(Om(t)),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var i=_step7.value;R1.call(t,i)&&Rm(e,i,t[i])}}catch(err){_iterator7.e(err)}finally{_iterator7.f()}}return e},N1=function N1(e,t){return E1(e,A1(t))},KE=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")};function L1(e){var t=new String(e),i=0,r=0;for(var n=0;n<t.length;++n){r=t.charCodeAt(n),r<128?i+=1:r<2048?i+=2:(r&64512)==55296&&(t.charCodeAt(n+1)&64512)==56320?(++n,i+=4):i+=3}return i}function D1(e,t,i){var r=t;if(i<1)return"";var n=r+i,s=[],o=null,a=0,l;for(;r<n;){l=e.getUint8(r++),l<128?s[a++]=l:l>191&&l<224?s[a++]=(l&31)<<6|e.getUint8(r++)&63:l>239&&l<365?(l=((l&7)<<18|(e.getUint8(r++)&63)<<12|(e.getUint8(r++)&63)<<6|e.getUint8(r++)&63)-65536,s[a++]=55296+(l>>10),s[a++]=56320+(l&1023)):s[a++]=(l&15)<<12|(e.getUint8(r++)&63)<<6|e.getUint8(r++)&63,a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))}function B1(e,t){var i=new String(e),r,n;for(var s=0;s<i.length;++s){r=i.charCodeAt(s),r<128?t.pushUint8(r):r<2048?(t.pushUint8(r>>6|192),t.pushUint8(r&63|128)):(r&64512)==55296&&((n=i.charCodeAt(s+1))&64512)==56320?(r=65536+((r&1023)<<10)+(n&1023),++s,t.pushUint8(r>>18|240),t.pushUint8(r>>12&63|128),t.pushUint8(r>>6&63|128),t.pushUint8(r&63|128)):(t.pushUint8(r>>12|224),t.pushUint8(r>>6&63|128),t.pushUint8(r&63|128))}}var rn=Math.pow(2,32),F1=Math.pow(2,16),jn=rn-1,GE=F1-1,j1=256,z1=/*#__PURE__*/function(){function z1(){_classCallCheck(this,z1);this._length=0,this.bufferChunks=[],this.appendNewChunk()}_createClass(z1,[{key:"length",get:function get(){return this._length}},{key:"toBuffer",value:function toBuffer(){var e=Ct(this.length),t=0;var _iterator8=_createForOfIteratorHelper(this.bufferChunks),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var i=_step8.value;e.fill(i.buffer,t,0,i.length),t+=i.length}}catch(err){_iterator8.e(err)}finally{_iterator8.f()}return e}},{key:"generateHash",value:function generateHash(e,t){var i=0,r=e;for(;;){if(i>=this.bufferChunks.length)return"";var a=this.bufferChunks[i].length;if(r<a)break;r-=a,i+=1}var n=t,s=new Lm["default"],o=[0];for(;i<this.bufferChunks.length;++i){var _this$bufferChunks$i=this.bufferChunks[i],_a4=_this$bufferChunks$i.buffer,l=_this$bufferChunks$i.length;for(var h=r;h<l;++h){if(o[0]=_a4.getUint8(h),s.appendBinary(String.fromCharCode.apply(String,o)),n-=1,n<=0)return s.end(!0)}r=0}return s.end(!0)}},{key:"pushBuffer",value:function pushBuffer(e,t,i){var r=Math.min(i,this.currentChunk.buffer.byteLength-this.currentChunk.length);r>0&&(this.currentChunk.buffer.fill(e,this.currentChunk.length,t,r),this.currentChunk.length+=r,this._length+=r);var n=i-r;n>0&&(this.currentChunk={buffer:e.slice(t+r,n),length:n},this.bufferChunks.push(this.currentChunk),this._length+=n)}},{key:"pushUint8",value:function pushUint8(e){this.currentChunk.length+1>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setUint8(this.currentChunk.length,e),this.currentChunk.length+=1,this._length+=1}},{key:"pushUint8Holder",value:function pushUint8Holder(){this.currentChunk.length+1>this.currentChunk.buffer.byteLength&&this.appendNewChunk();var e=this.currentChunk.length,t=this.currentChunk.buffer;return this.currentChunk.length+=1,this._length+=1,function(i){return t.setUint8(e,i)}}},{key:"pushUint16",value:function pushUint16(e){this.currentChunk.length+2>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setUint16(this.currentChunk.length,e),this.currentChunk.length+=2,this._length+=2}},{key:"pushInt32",value:function pushInt32(e){this.currentChunk.length+4>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setInt32(this.currentChunk.length,e),this.currentChunk.length+=4,this._length+=4}},{key:"pushUint32",value:function pushUint32(e){this.currentChunk.length+4>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setUint32(this.currentChunk.length,e),this.currentChunk.length+=4,this._length+=4}},{key:"pushUint32Holder",value:function pushUint32Holder(){this.currentChunk.length+4>this.currentChunk.buffer.byteLength&&this.appendNewChunk();var e=this.currentChunk.length,t=this.currentChunk.buffer;return this.currentChunk.length+=4,this._length+=4,function(i){return t.setUint32(e,i)}}},{key:"pushFloat64",value:function pushFloat64(e){this.currentChunk.length+8>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setFloat64(this.currentChunk.length,e),this.currentChunk.length+=8,this._length+=8}},{key:"appendNewChunk",value:function appendNewChunk(){var e=Ct(j1);this.currentChunk={buffer:e,length:0},this.bufferChunks.push(this.currentChunk)}}]);return z1}(),_;(function(e){e[e.Never=0]="Never",e[e.Undefined=1]="Undefined",e[e.Null=2]="Null",e[e.String=3]="String",e[e.Integer32=4]="Integer32",e[e.Integer53=5]="Integer53",e[e.Float=6]="Float",e[e.Function=7]="Function",e[e.Object=8]="Object",e[e.Array=9]="Array",e[e.True=10]="True",e[e.False=11]="False",e[e.Buffer=12]="Buffer",e[e.HangUpObject=13]="HangUpObject"})(_||(_={}));var ye;(function(e){e[e.Array=0]="Array",e[e.DeducedObject=1]="DeducedObject",e[e.AssertedObject=2]="AssertedObject",e[e.HangUpObject=3]="HangUpObject"})(ye||(ye={}));var ie;(function(e){e[e.Array=0]="Array",e[e.Object=1]="Object",e[e.HangUpObject=2]="HangUpObject"})(ie||(ie={}));var Dm="__identifier",oh="__hangUpMetadata",zn=/*#__PURE__*/function(){function zn(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:function(){};_classCallCheck(this,zn);this.decorateObjectEnums=Object.freeze([1]),this.decorateObject=e}_createClass(zn,[{key:"createObject",value:function createObject(e,t){var i=t===0?[]:{};return Object.defineProperty(i,Dm,{enumerable:!1,configurable:!0,value:e}),i}},{key:"findIdentifier",value:function findIdentifier(e){return e[Dm]}},{key:"findHangUpMetadata",value:function findHangUpMetadata(e){return e[oh]}},{key:"checkObjectEnum",value:function checkObjectEnum(e){return e.constructor===Array?0:oh in e?2:1}},{key:"length",value:function length(e){return e.length}},{key:"keys",value:function keys(e){return Object.keys(e)}},{key:"hasKey",value:function hasKey(e,t){return t in e}},{key:"getValue",value:function getValue(e,t){return e[t]}},{key:"setValue",value:function setValue(e,t,i){e[t]=i}},{key:"completeHangUpObject",value:function completeHangUpObject(e,t){Object.defineProperty(e,oh,{enumerable:!1,configurable:!0,value:Object.freeze(Nm({},t))})}}]);return zn}();function Bm(){var e={};return e.id=-1,e.key=e,e.index=e,e.properties=Object.freeze({}),Object.freeze(e)}var Fm="0".charCodeAt(0),U1="9".charCodeAt(0)+1,V1="a".charCodeAt(0),W1="f".charCodeAt(0)+1,Sr=15,H1=/*#__PURE__*/function(){function H1(){_classCallCheck(this,H1);var e=[],t=[];for(var i=0;i<16;++i){var r=i.toString(16).charCodeAt(0);e[i]=r,t[r]=i}this.integerToCode=Object.freeze(e),this.codeToInteger=Object.freeze(t)}_createClass(H1,[{key:"cleanUnmeaningZero",value:function cleanUnmeaningZero(e,t){for(;e.length>t&&this.codeToInteger[e[e.length-1]]===0;){e.pop()}}},{key:"pushInt53",value:function pushInt53(e,t){var i=t|0,r=(t-i)/rn;this.pushUint32(e,i),this.pushUint32(e,r)}},{key:"readInt53",value:function readInt53(e,t){var i=2,r=this.readInt32(e,t);return this.readInt32(e,t+4*i)*rn+r}},{key:"pushUint32",value:function pushUint32(e,t){var i=e.length;e[i]=this.integerToCode[t&Sr],e[i+1]=this.integerToCode[t>>4&Sr],e[i+2]=this.integerToCode[t>>8&Sr],e[i+3]=this.integerToCode[t>>12&Sr],e[i+4]=this.integerToCode[t>>16&Sr],e[i+5]=this.integerToCode[t>>20&Sr],e[i+6]=this.integerToCode[t>>24&Sr],e[i+7]=this.integerToCode[t>>28&Sr]}},{key:"readUint32",value:function readUint32(e,t){var i=this.readInt32(e,t);return i<0&&(i+=rn),i}},{key:"readInt32",value:function readInt32(e,t){var i=0;for(var r=0;r<8;++r){var n=this.codeToInteger[e.charCodeAt(t+r)];if(n===void 0)return NaN;i|=n<<4*r}return i}},{key:"parseCode",value:function parseCode(e){return this.codeToInteger[e]}},{key:"toCode",value:function toCode(e){return this.integerToCode[e]}},{key:"increment",value:function increment(e,t){var i=t;for(;;){if(e.length<=i){e[i]=Fm+1;break}var r=!0;switch(e[i]+=1,e[i]){case U1:{e[i]=V1;break}case W1:{e[i]=Fm,i+=1,r=!1;break}}if(r)break}}},{key:"parseString",value:function parseString(e){var t=new String(e),i=[];for(var r=0;r<t.length;++r){i.push(t.charCodeAt(r))}return i}},{key:"stringify",value:function stringify(e){return String.fromCharCode.apply(String,e)}}]);return H1}(),tt=new H1,xt="",wr=-1,ah=16;function jm(e){return tt.readInt53(e,0)}function li(e,t){var i=[];return tt.pushInt53(i,e),typeof t=="number"&&(tt.pushInt53(i,t),tt.cleanUnmeaningZero(i,ah)),new Um(e,i)}function zm(e,t){if(e>jn)throw new Error("observerId ".concat(e," is out of range 0 ~ ").concat(jn));var i=[],r=new Wm(e,i);return tt.pushUint32(i,e),r.makeSureNextGenerationIdAfter(t),r}var Um=/*#__PURE__*/function(){function Um(e,t){_classCallCheck(this,Um);this.scopeId=e,this.codes=t}_createClass(Um,[{key:"generate",value:function generate(){var e=tt.stringify(this.codes);return tt.increment(this.codes,ah),e}},{key:"createdCount",get:function get(){var e=4*2,t=ah,i=0,r=0;for(var n=0;n<e;++n){var s=this.codes[t+n];s===void 0?s=0:s=tt.parseCode(s),i|=s<<4*n}t+=e;for(var _n3=0;_n3<e;++_n3){var _s2=this.codes[t+_n3];_s2===void 0?_s2=0:_s2=tt.parseCode(_s2),r|=_s2<<4*_n3}return r*rn+i}},{key:"clone",value:function clone(){return new Um(this.scopeId,_toConsumableArray(this.codes))}}]);return Um}(),Vm=8,Wm=/*#__PURE__*/function(){function Wm(e,t){_classCallCheck(this,Wm);this.observerId=e,this.codes=t,this._createdCount=0}_createClass(Wm,[{key:"scopeId",get:function get(){return 0}},{key:"createdCount",get:function get(){return this._createdCount}},{key:"generate",value:function generate(){return this._createdCount+=1,tt.increment(this.codes,Vm),tt.stringify(this.codes)}},{key:"clone",value:function clone(){return new Wm(this.observerId,_toConsumableArray(this.codes))}},{key:"makeSureNextGenerationIdAfter",value:function makeSureNextGenerationIdAfter(e){var t=[];for(var i=0;i<e.length;++i){var r=e.charCodeAt(i);if(tt.parseCode(r)===void 0)throw new Error("invalid generationId");t[i]=r}for(var _i4=0;_i4<t.length;++_i4){this.codes[_i4+Vm]=t[_i4]}}}]);return Wm}(),ha=/*#__PURE__*/function(_Error2){_inherits(ha,_Error2);var _super6=_createSuper(ha);function ha(e){var _this9;_classCallCheck(this,ha);_this9=_super6.call(this,e);_this9.name="SerializerError";return _this9}return ha}(/*#__PURE__*/_wrapNativeSuper(Error)),ut=/*#__PURE__*/function(_Error3){_inherits(ut,_Error3);var _super7=_createSuper(ut);function ut(e){var _this10;_classCallCheck(this,ut);_this10=_super7.call(this,e);_this10.name="DeserializerError";return _this10}return ut}(/*#__PURE__*/_wrapNativeSuper(Error)),_1=Math.pow(2,31)-1,K1=-Math.pow(2,31),G1=/*#__PURE__*/function(){function G1(e,t,i,r){_classCallCheck(this,G1);this.writer=e,this.objectFormats=t,this.objectAdapter=i,this.assertObjectFormat=r,this.anyObjectFormat=Bm(),this.serializeTasksQueue=[],this.serializeBufferQueue=[],this.didObjectInQueueSet={},this.bufferIndexMap={}}_createClass(G1,[{key:"serialize",value:function serialize(e,t){var i=this.writer.putUint32Holder(),r=this.writer.didWriteBytes,n=1;this.objectFormats.length!==1&&(this.writer.writeUint32(e.length),n=e.length);for(var a=0;a<n;++a){var l=this.objectFormats[a]||this.anyObjectFormat,h=e[a];this.serializeValue(l,h)}for(;this.serializeTasksQueue.length>0;){var _a5=this.serializeTasksQueue.pop();this.handleSerializeTask(_a5)}this.writer.writeBigInt(xt),this.writer.writeUint32(this.serializeBufferQueue.length);var _iterator9=_createForOfIteratorHelper(this.serializeBufferQueue),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var _a6=_step9.value;this.writer.writeUint8(_a6.readonly?255:0),this.writer.writeBuffer(_a6)}}catch(err){_iterator9.e(err)}finally{_iterator9.f()}var s=this.writer.didWriteBytes-r,o=t?this.writer.generateHash(r,s):hh;this.serializeHash(o),i(s+_i)}},{key:"serializeValue",value:function serializeValue(e,t){_typeof(t)!="object"?this.serializeNotObjectValue(t):t===null?this.writer.writeUint8(_.Null):we(t)?this.serializeBufferValue(t):this.serializeObjectValue(e,t)}},{key:"handleSerializeTask",value:function handleSerializeTask(_ref5){var e=_ref5.identifier,t=_ref5.object,i=_ref5.objectEnum,r=_ref5.deducedFormat;switch(this.writer.writeBigInt(e),i){case ie.Array:{this.writer.writeUint8(ye.Array),this.handleArraySerializeTask(t,r);break}case ie.Object:{var n=this.assertObjectFormat(t),s=n?ye.AssertedObject:ye.DeducedObject,o=n||r,a=!n;this.writer.writeUint8(s),this.handleObjectSerializeTask(t,o,a);break}case ie.HangUpObject:{var _n4=this.objectAdapter.findHangUpMetadata(t),_kt$parse=kt.parse(_n4.version),_s3=_kt$parse.x,_o2=_kt$parse.y,_a7=_kt$parse.z;this.writer.writeUint8(ye.HangUpObject),this.writer.writeUint32(_n4.objectFormatId),this.writer.writeUint16(_s3),this.writer.writeUint16(_o2),this.writer.writeUint16(_a7),this.writer.writeUint8(_.Never),this.handleHangUpObjectSerializeTask(t);break}}}},{key:"serializeNotObjectValue",value:function serializeNotObjectValue(e){switch(_typeof(e)){case"undefined":{this.writer.writeUint8(_.Undefined);break}case"string":{this.writer.writeUint8(_.String),this.writer.writeString(e);break}case"number":{Number.isSafeInteger(e)?K1<=e&&e<=_1?(this.writer.writeUint8(_.Integer32),this.writer.writeInt32(e)):(this.writer.writeUint8(_.Integer53),this.writer.writeInt53(e)):(this.writer.writeUint8(_.Float),this.writer.writeFloat64(e));break}case"boolean":{e?this.writer.writeUint8(_.True):this.writer.writeUint8(_.False);break}default:throw new ha("not support ".concat(_typeof(e)," now"));}}},{key:"serializeBufferValue",value:function serializeBufferValue(e){var t=this.bufferIndexMap[e.id];t===void 0&&(t=this.serializeBufferQueue.length,this.bufferIndexMap[e.id]=t,this.serializeBufferQueue[t]=e),this.writer.writeUint8(_.Buffer),this.writer.writeUint32(t)}},{key:"serializeObjectValue",value:function serializeObjectValue(e,t){var i=this.objectAdapter.findIdentifier(t),r=this.objectAdapter.checkObjectEnum(t),n;switch(r){case ie.Array:{n=_.Array;break}case ie.Object:{n=_.Object;break}case ie.HangUpObject:{n=_.HangUpObject;break}default:throw new Error("unrecognized object enum ".concat(r));}this.writer.writeUint8(n),this.writer.writeUint8(0),this.writer.writeBigInt(i),this.pushToSerializeTaskQueueIfFirstCall({identifier:i,object:t,deducedFormat:e,objectEnum:r})}},{key:"pushToSerializeTaskQueueIfFirstCall",value:function pushToSerializeTaskQueueIfFirstCall(e){this.didObjectInQueueSet[e.identifier]||(this.didObjectInQueueSet[e.identifier]=!0,this.serializeTasksQueue.push(e))}},{key:"handleArraySerializeTask",value:function handleArraySerializeTask(e,t){var i=this.objectAdapter.length(e),r=t.index;this.writer.writeUint32(i);for(var n=0;n<i;++n){this.serializeValue(r,this.objectAdapter.getValue(e,n))}}},{key:"handleObjectSerializeTask",value:function handleObjectSerializeTask(e,t,i){this.writer.writeUint32(t.id);for(var r in t.properties){var n=t.properties[r];this.objectAdapter.hasKey(e,r)?this.serializeValue(n,this.objectAdapter.getValue(e,r)):this.writer.writeUint8(_.Never)}if(i){var _r2=this.writer.putUint32Holder(),_n5=0;var _iterator10=_createForOfIteratorHelper(this.objectAdapter.keys(e)),_step10;try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var s=_step10.value;s in t.properties||(this.writer.writeString(s),this.serializeValue(t.key,this.objectAdapter.getValue(e,s)),_n5+=1)}}catch(err){_iterator10.e(err)}finally{_iterator10.f()}_r2(_n5)}else this.writer.writeUint32(0)}},{key:"handleHangUpObjectSerializeTask",value:function handleHangUpObjectSerializeTask(e){var t=this.writer.putUint32Holder(),i=0;var _iterator11=_createForOfIteratorHelper(this.objectAdapter.keys(e)),_step11;try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var r=_step11.value;this.writer.writeString(r),this.serializeValue(this.anyObjectFormat,this.objectAdapter.getValue(e,r)),i+=1}}catch(err){_iterator11.e(err)}finally{_iterator11.f()}t(i)}},{key:"serializeHash",value:function serializeHash(e){for(var t=0;t<_i;++t){t<e.length?this.writer.writeUint8(e.charCodeAt(t)):this.writer.writeUint8(0)}}}]);return G1}(),Hm=/*#__PURE__*/function(){function Hm(e,t,i,r){_classCallCheck(this,Hm);this.reader=e,this.format=t,this.objectAdapter=i,this.valuesLength=r,this.objectStateMap={},this.holdersMap={},this.deserializeBufferSetterQueue=[],this.cacheMap=Object.freeze([{},{},{}])}_createClass(Hm,[{key:"deserialize",value:function deserialize(e){var t=Hm.simpleObjectAdapter,i=this.reader.readUint32(),r=this.reader.didReadBytes,n=this.deserializeRootValuesLength(),s=[];for(var l=0;l<n;++l){this.deserializeValue(t,s,l)}for(;;){var _l3=this.reader.readBigInt();if(_l3===xt)break;this.deserializeArrayOrObjectBody(_l3)}this.handleAllDeserializeBuffers(),this.invokeObjectDecorator();var o=this.reader.didReadBytes-r;if(i!==o+_i)throw new ut("expect bytes ".concat(i,", instead of ").concat(o));var a=this.deserializeHash();if(!e&&a!==hh&&a!==this.reader.generateHash(r,o))throw new ut("hash isn't matched");return s}},{key:"deserializeRootValuesLength",value:function deserializeRootValuesLength(){return this.valuesLength!==1?this.reader.readUint32():1}},{key:"invokeObjectDecorator",value:function invokeObjectDecorator(){var e=Object.freeze([]);var _iterator12=_createForOfIteratorHelper(this.objectAdapter.decorateObjectEnums),_step12;try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){var t=_step12.value;var i=this.cacheMap[t];for(var r in i){var n=i[r],s=this.objectStateMap[r];if(s){var o=this.holdersMap[r]||e,a=s.type,l=s.objectFormat;this.objectAdapter.decorateObject(n,a,o,l)}}}}catch(err){_iterator12.e(err)}finally{_iterator12.f()}}},{key:"deserializeValue",value:function deserializeValue(e,t,i){var r=this.reader.readUint8(),n;switch(r){case _.Undefined:{e.setValue(t,i,void 0);break}case _.Null:{e.setValue(t,i,null);break}case _.String:{e.setValue(t,i,this.reader.readString());break}case _.Integer32:{e.setValue(t,i,this.reader.readInt32());break}case _.Integer53:{e.setValue(t,i,this.reader.readInt53());break}case _.Float:{e.setValue(t,i,this.reader.readFloat64());break}case _.True:{e.setValue(t,i,!0);break}case _.False:{e.setValue(t,i,!1);break}case _.Array:{this.reader.readUint8(),n=this.reader.readBigInt();var s=this.readAndPushToDeserializeTaskQueueIfNeed(n,ie.Array);e.setValue(t,i,s);break}case _.Object:{this.reader.readUint8(),n=this.reader.readBigInt();var _s4=this.readAndPushToDeserializeTaskQueueIfNeed(n,ie.Object);e.setValue(t,i,_s4);break}case _.HangUpObject:{this.reader.readUint8(),n=this.reader.readBigInt();var _s5=this.readAndPushToDeserializeTaskQueueIfNeed(n,ie.HangUpObject);e.setValue(t,i,_s5);break}case _.Buffer:{var _s6=this.reader.readUint32(),o=this.deserializeBufferSetterQueue[_s6];o||(o=this.deserializeBufferSetterQueue[_s6]=[]),o.push(function(a){return e.setValue(t,i,a)});break}case _.Never:break;default:throw new ha("unrecognized primitiveType ".concat(JSON.stringify(r)));}return n}},{key:"readAndPushToDeserializeTaskQueueIfNeed",value:function readAndPushToDeserializeTaskQueueIfNeed(e,t){var i=this.cacheMap[t],r=i[e];return r||(i[e]=r=this.objectAdapter.createObject(e,t)),r}},{key:"deserializeArrayOrObjectBody",value:function deserializeArrayOrObjectBody(e){var t=this.reader.readUint8();switch(t){case ye.Array:{this.objectStateMap[e]={type:t},this.handleArrayDeserializerTask(this.cacheMap[ie.Array][e]);break}case ye.DeducedObject:case ye.AssertedObject:{var i=this.cacheMap[ie.Object][e],r=this.reader.readUint32(),n=this.format.findObjectFormat(r);this.objectStateMap[e]={type:t,objectFormat:n},this.handleObjectDeserializerTask(i,n);break}case ye.HangUpObject:{var _i5=this.cacheMap[ie.HangUpObject][e],_r3=this.reader.readUint32(),_n6=this.reader.readUint16(),s=this.reader.readUint16(),o=this.reader.readUint16();this.objectStateMap[e]={type:t},this.reader.readUint8(),this.handleHangUpObjectDeserializerTask(_i5,{objectFormatId:_r3,version:"".concat(_n6,".").concat(s,".").concat(o)});break}}}},{key:"handleAllDeserializeBuffers",value:function handleAllDeserializeBuffers(){var e=this.reader.readUint32();for(var t=0;t<e;++t){var i=this.reader.readUint8(),r=this.reader.readBuffer();i&&r.freeze();var n=this.deserializeBufferSetterQueue[t];var _iterator13=_createForOfIteratorHelper(n),_step13;try{for(_iterator13.s();!(_step13=_iterator13.n()).done;){var s=_step13.value;s(r)}}catch(err){_iterator13.e(err)}finally{_iterator13.f()}}}},{key:"handleArrayDeserializerTask",value:function handleArrayDeserializerTask(e){var t=this.reader.readUint32();for(var i=0;i<t;++i){this.deserializeValueAndRecordHolders(e,i)}}},{key:"handleObjectDeserializerTask",value:function handleObjectDeserializerTask(e,t){for(var r in t.properties){this.deserializeValueAndRecordHolders(e,r)}var i=this.reader.readUint32();for(var _r4=0;_r4<i;++_r4){var n=this.reader.readString();this.deserializeValueAndRecordHolders(e,n)}}},{key:"handleHangUpObjectDeserializerTask",value:function handleHangUpObjectDeserializerTask(e,t){var i=this.reader.readUint32();for(var r=0;r<i;++r){var n=this.reader.readString();this.deserializeValueAndRecordHolders(e,n)}this.objectAdapter.completeHangUpObject(e,t)}},{key:"deserializeValueAndRecordHolders",value:function deserializeValueAndRecordHolders(e,t){var i=this.deserializeValue(this.objectAdapter,e,t);if(i!==void 0){var r=this.holdersMap[i];r||(this.holdersMap[i]=r=[]),r.push({object:e,key:t})}}},{key:"deserializeHash",value:function deserializeHash(){var e=new Array(_i);for(var t=0;t<_i;++t){e[t]=this.reader.readUint8()}return String.fromCharCode.apply(String,e)}}]);return Hm}(),_m=Hm;_m.simpleObjectAdapter=new zn;var lh=/*#__PURE__*/function(){function lh(e,t,i,r){_classCallCheck(this,lh);this.reader=e,this.format=t,this.objectFormats=i,this.objectAdapter=r,this.arrayCacheMap={},this.objectCacheMap={},this.objectStateMap={},this.holdersMap={},this.deserializeTasksQueue=[],this.deserializeBufferSetterQueue=[]}_createClass(lh,[{key:"deserialize",value:function deserialize(e){var t=lh.simpleObjectAdapter,i=this.reader.readUint32(),r=this.reader.didReadBytes,n=this.deserializeRootValuesLength(),s=[];for(var l=0;l<n;++l){var h=this.objectFormats[l]||lh.neverObjectFormat;this.deserializeValue(h,t,s,l)}for(;;){var _l4=this.reader.readBigInt();if(_l4===xt)break;var _h2=this.takeNextDeserializerTask(_l4);this.handleDeserializerTask(_h2)}this.handleAllDeserializeBuffers(),this.invokeObjectDecorator();var o=this.reader.didReadBytes-r;if(i!==o+_i)throw new ut("expect bytes ".concat(i,", instead of ").concat(o));var a=this.deserializeHash();if(!e&&a!==hh&&a!==this.reader.generateHash(r,o))throw new ut("hash isn't matched");return s}},{key:"deserializeRootValuesLength",value:function deserializeRootValuesLength(){return this.objectFormats.length!==1?this.reader.readUint32():1}},{key:"invokeObjectDecorator",value:function invokeObjectDecorator(){var e=Object.freeze([]);for(var t in this.objectCacheMap){var i=this.objectCacheMap[t],r=this.holdersMap[t]||e,_this$objectStateMap$=this.objectStateMap[t],n=_this$objectStateMap$.objectFormat,s=_this$objectStateMap$.type;this.objectAdapter.decorateObject(i,s,r,n)}}},{key:"deserializeValueAndRecordHolders",value:function deserializeValueAndRecordHolders(e,t,i){var r=this.deserializeValue(e,this.objectAdapter,t,i);if(r!==void 0){var n=this.holdersMap[r];n||(this.holdersMap[r]=n=[]),n.push({object:t,key:i})}}},{key:"deserializeValue",value:function deserializeValue(e,t,i,r){var n=this.reader.readUint8(),s;switch(n){case _.Undefined:{t.setValue(i,r,void 0);break}case _.Null:{t.setValue(i,r,null);break}case _.String:{t.setValue(i,r,this.reader.readString());break}case _.Integer32:{t.setValue(i,r,this.reader.readInt32());break}case _.Integer53:{t.setValue(i,r,this.reader.readInt53());break}case _.Float:{t.setValue(i,r,this.reader.readFloat64());break}case _.True:{t.setValue(i,r,!0);break}case _.False:{t.setValue(i,r,!1);break}case _.Object:{s=this.reader.readBigInt();var o=this.readAndPushToDeserializeTaskQueueIfNeed(s,e,!1);t.setValue(i,r,o);break}case _.Array:{s=this.reader.readBigInt();var _o3=this.readAndPushToDeserializeTaskQueueIfNeed(s,e,!0);t.setValue(i,r,_o3);break}case _.Buffer:{var _o4=this.reader.readUint32(),a=this.deserializeBufferSetterQueue[_o4];a||(a=this.deserializeBufferSetterQueue[_o4]=[]),a.push(function(l){return t.setValue(i,r,l)});break}}return s}},{key:"readAndPushToDeserializeTaskQueueIfNeed",value:function readAndPushToDeserializeTaskQueueIfNeed(e,t,i){var r=i?this.arrayCacheMap:this.objectCacheMap,n=r[e];return n||(r[e]=n=this.objectAdapter.createObject(e,i?ie.Array:ie.Object),this.deserializeTasksQueue.push({isArray:i,identifier:e,deducedFormat:t,object:n})),n}},{key:"takeNextDeserializerTask",value:function takeNextDeserializerTask(e){for(var t=0;t<this.deserializeTasksQueue.length;++t){var i=this.deserializeTasksQueue[t];if(e===i.identifier)return this.deserializeTasksQueue.splice(t,1),i}throw new ut("can't find identifier ".concat(e," in task queue"))}},{key:"handleDeserializerTask",value:function handleDeserializerTask(e){var t=this.reader.readUint8(),i=e.identifier;switch(t){case ye.Array:{if(!e.isArray)throw new ut("expect array");this.objectStateMap[i]={type:t,objectFormat:e.deducedFormat},this.handleArrayDeserializerTask(e.object,e.deducedFormat);break}case ye.DeducedObject:{if(e.isArray)throw new ut("expect object");this.objectStateMap[i]={type:t,objectFormat:e.deducedFormat},this.handleObjectDeserializerTask(e.object,e.deducedFormat);break}case ye.AssertedObject:{if(e.isArray)throw new ut("expect object");var r=this.reader.readUint32(),n=this.format.findObjectFormat(r);this.objectStateMap[i]={type:t,objectFormat:n},this.handleObjectDeserializerTask(e.object,n);break}}}},{key:"handleAllDeserializeBuffers",value:function handleAllDeserializeBuffers(){var e=this.reader.readUint32();for(var t=0;t<e;++t){var i=this.reader.readUint8(),r=this.reader.readBuffer();i&&r.freeze();var n=this.deserializeBufferSetterQueue[t];var _iterator14=_createForOfIteratorHelper(n),_step14;try{for(_iterator14.s();!(_step14=_iterator14.n()).done;){var s=_step14.value;s(r)}}catch(err){_iterator14.e(err)}finally{_iterator14.f()}}}},{key:"handleArrayDeserializerTask",value:function handleArrayDeserializerTask(e,t){var i=t.index,r=this.reader.readUint32();for(var n=0;n<r;++n){this.deserializeValueAndRecordHolders(i,e,n)}}},{key:"handleObjectDeserializerTask",value:function handleObjectDeserializerTask(e,t){for(var r in t.properties){this.deserializeValueAndRecordHolders(t.properties[r],e,r)}var i=this.reader.readUint32();for(var _r5=0;_r5<i;++_r5){var n=this.reader.readString();this.deserializeValueAndRecordHolders(t.key,e,n)}}},{key:"deserializeHash",value:function deserializeHash(){var e=new Array(_i);for(var t=0;t<_i;++t){e[t]=this.reader.readUint8()}return String.fromCharCode.apply(String,e)}}]);return lh}(),ch=lh;ch.neverObjectFormat=Bm(),ch.simpleObjectAdapter=new zn;var ci;(function(e){e[e.V0=0]="V0",e[e.V1=1]="V1"})(ci||(ci={}));var $1=kt.parse("1.4.2");function hi(e){var t=e;return typeof t=="string"&&(t=kt.parse(t)),kt.compare(t,$1)<0?0:1}var Ii=/*#__PURE__*/function(){function Ii(e){_classCallCheck(this,Ii);this.format=e.format,this.objectAdapter=e.objectAdapter,this.assertObjectFormat=e.assertObjectFormat||function(){}}_createClass(Ii,[{key:"serialize",value:function serialize(_ref6){var e=_ref6.writer,t=_ref6.values,i=_ref6.objectFormats,r=_ref6.includesHash;new G1(e,i,this.objectAdapter,this.assertObjectFormat).serialize(t,r)}},{key:"deserialize",value:function deserialize(_ref7){var e=_ref7.reader,t=_ref7.objectFormats,i=_ref7.ignoreHashChecking,r=_ref7.version;switch(r){case ci.V0:return new ch(e,this.format,t,this.objectAdapter).deserialize(i);case ci.V1:return new _m(e,this.format,this.objectAdapter,t.length).deserialize(i);default:return[];}}}]);return Ii}(),Y1="0".charCodeAt(0),De=/*#__PURE__*/function(){function De(){_classCallCheck(this,De);this.buffer=new z1}_createClass(De,[{key:"generateHash",value:function generateHash(e,t){return this.buffer.generateHash(e,t)}},{key:"didWriteBytes",get:function get(){return this.buffer.length}},{key:"writeBuffer",value:function writeBuffer(e){this.buffer.pushUint32(e.byteLength),e.byteLength>0&&this.buffer.pushBuffer(e,0,e.byteLength)}},{key:"writeUint8",value:function writeUint8(e){this.buffer.pushUint8(e)}},{key:"putUint8Holder",value:function putUint8Holder(){return this.buffer.pushUint8Holder()}},{key:"writeUint16",value:function writeUint16(e){this.buffer.pushUint16(e)}},{key:"writeInt32",value:function writeInt32(e){this.buffer.pushInt32(e)}},{key:"writeUint32",value:function writeUint32(e){this.buffer.pushUint32(e)}},{key:"putUint32Holder",value:function putUint32Holder(){return this.buffer.pushUint32Holder()}},{key:"writeInt53",value:function writeInt53(e){var t=e|0,i=(e-t)/rn;this.buffer.pushInt32(t),this.buffer.pushInt32(i)}},{key:"writeFloat64",value:function writeFloat64(e){this.buffer.pushFloat64(e)}},{key:"writeString",value:function writeString(e){var t=L1(e);this.writeInt32(t),B1(e,this.buffer)}},{key:"writeBigInt",value:function writeBigInt(e){var t=e;if(t.length>255)throw new ha("length of identifier ".concat(t.length," is greater than 255"));this.buffer.pushUint8(t.length);var i=Math.ceil(t.length/2);for(var r=0;r<i;++r){var n=t.charCodeAt(r*2),s=t.charCodeAt(r*2+1);Number.isNaN(s)&&(s=Y1);var o=tt.parseCode(n),a=tt.parseCode(s);if(o===void 0||a===void 0)throw new ha("invalid big integer ".concat(JSON.stringify(e)));this.buffer.pushUint8(o|a<<4)}}},{key:"writeReadSlice",value:function writeReadSlice(e){var _iterator15=_createForOfIteratorHelper(e),_step15;try{for(_iterator15.s();!(_step15=_iterator15.n()).done;){var _step15$value=_step15.value,t=_step15$value.offset,i=_step15$value.byteLength,r=_step15$value.buffer;this.buffer.pushBuffer(r,t,i)}}catch(err){_iterator15.e(err)}finally{_iterator15.f()}}},{key:"toBuffer",value:function toBuffer(){return this.buffer.toBuffer()}}]);return De}(),X1=[],Q1=[0],q1=[0,0],Z1=[0,0,0],J1=[0,0,0,0],e0=[0,0,0,0,0],t0=[0,0,0,0,0,0],i0=[0,0,0,0,0,0,0],r0=[0,0,0,0,0,0,0,0];function n0(e){switch(e){case 0:return X1;case 1:return Q1;case 2:return q1;case 3:return Z1;case 4:return J1;case 5:return e0;case 6:return t0;case 7:return i0;case 8:return r0;default:return[];}}var Ce=/*#__PURE__*/function(){function Ce(e){_classCallCheck(this,Ce);this._offset=0,this.buffer=e}_createClass(Ce,[{key:"offset",get:function get(){return this._offset}},{key:"generateHash",value:function generateHash(e,t){var i=Math.min(e+t-1,this.buffer.byteLength-1),r=new Km["default"],n=[0];for(var s=e;s<=i;++s){n[0]=this.buffer.getUint8(s),r.appendBinary(String.fromCharCode.apply(String,n))}return r.end(!0)}},{key:"didReadBytes",get:function get(){return this._offset}},{key:"readBuffer",value:function readBuffer(){var e=this.buffer.getUint32(this._offset);this._offset+=4;var t=this.buffer.slice(this._offset,e);return this._offset+=e,t}},{key:"readUint8",value:function readUint8(){var e=this.buffer.getUint8(this._offset);return this._offset+=1,e}},{key:"readUint16",value:function readUint16(){var e=this.buffer.getUint16(this._offset);return this._offset+=2,e}},{key:"readInt32",value:function readInt32(){var e=this.buffer.getInt32(this._offset);return this._offset+=4,e}},{key:"readUint32",value:function readUint32(){var e=this.buffer.getUint32(this._offset);return this._offset+=4,e}},{key:"readInt53",value:function readInt53(){var e=this.buffer.getInt32(this._offset);this._offset+=4;var t=this.buffer.getInt32(this._offset);return this._offset+=4,t*rn+e}},{key:"readFloat64",value:function readFloat64(){var e=this.buffer.getFloat64(this._offset);return this._offset+=8,e}},{key:"readString",value:function readString(){var e=this.readInt32(),t=D1(this.buffer,this._offset,e);return this._offset+=e,t}},{key:"readBigInt",value:function readBigInt(){var e=this.readUint8(),t=Math.ceil(e/2),i=n0(e);for(var r=0;r<t;++r){var n=this.readUint8(),s=n&15,o=n>>4&15;i[r*2]=tt.toCode(s),r*2+1<e&&(i[r*2+1]=tt.toCode(o))}return String.fromCharCode.apply(String,i)}},{key:"skipBytes",value:function skipBytes(e){return this._offset+=e,e}},{key:"sliceLatestBytes",value:function sliceLatestBytes(e){return[{offset:this._offset-e,buffer:this.buffer,byteLength:e}]}}]);return Ce}(),_i=16,hh=function(){var e=[];for(var t=0;t<_i;++t){e[t]=0}return String.fromCharCode.apply(String,e)}(),Ki=/*#__PURE__*/function(_Error4){_inherits(Ki,_Error4);var _super8=_createSuper(Ki);function Ki(e){var _this11;_classCallCheck(this,Ki);_this11=_super8.call(this,e);_this11.name="FormatError";return _this11}return Ki}(/*#__PURE__*/_wrapNativeSuper(Error)),Gi;(function(e){e[e.Indeterminate=0]="Indeterminate",e[e.Circular=1]="Circular",e[e.Noncircular=2]="Noncircular"})(Gi||(Gi={}));var Un;(function(e){e[e.Border=0]="Border",e[e.Compound=1]="Compound",e[e.Object=2]="Object",e[e.Handle=3]="Handle"})(Un||(Un={}));var s0=/*#__PURE__*/function(){function s0(e,t,i){_classCallCheck(this,s0);this.templateEnvironment=e,this.templateType=t,this.params=i,this.expandedParamNodes=[],this.convertTypeToGeneratorParam=this.convertTypeToGeneratorParam.bind(this);for(var r=0;r<i.length;++r){this.expandedParamNodes[r]=void 0}}_createClass(s0,[{key:"getExpandedExpression",value:function getExpandedExpression(){return this.expandNode(this.templateType)}},{key:"expandNode",value:function expandNode(e){switch(e.typeEnum){case N.Any:case N.Never:case N.Undefined:case N.Null:case N.String:case N.Number:case N.Boolean:case N.Function:return{type:e,clazz:0};case N.Object:{var t=e,i={};for(var r in t.properties){var n=t.properties[r];i[r]=this.expandNode(n)}return{type:t,clazz:2,key:this.expandNode(t.key),index:this.expandNode(t.index),properties:i}}case N.And:case N.Or:{var _t3=e,_i6=[];var _iterator16=_createForOfIteratorHelper(_t3.children),_step16;try{for(_iterator16.s();!(_step16=_iterator16.n()).done;){var _r6=_step16.value;_i6.push(this.expandNode(_r6))}}catch(err){_iterator16.e(err)}finally{_iterator16.f()}return{type:_t3,clazz:1,children:_i6}}case N.Generator:return this.expandGeneratorType(e);case N.Generic:return this.expandGenericType(e);case N.Reference:case N.GlobalReference:return this.expandReferenceType(e);}throw new Ki("unrecognized enum type "+e.typeEnum)}},{key:"expandGeneratorType",value:function expandGeneratorType(e){var t=e.params.map(this.convertTypeToGeneratorParam),i=this.templateEnvironment.getTemplate(e.template);return{clazz:3,handle:i.getHandle(t)}}},{key:"convertTypeToGeneratorParam",value:function convertTypeToGeneratorParam(e){var t=this.expandNode(e);return t.clazz===3?t.handle:t.type}},{key:"expandGenericType",value:function expandGenericType(_ref8){var e=_ref8.index;var t=this.expandedParamNodes[e];if(!t){var i=this.params[e];if(!i)throw new Ki("generic index ".concat(e," is out of range: 0 ~ ").concat(this.params.length-1));t=this.covertParamTypeToExpandedNode(i),this.expandedParamNodes[e]=t}return t}},{key:"expandReferenceType",value:function expandReferenceType(e){var t=this.templateEnvironment.replaceReferenceType(e),i;return t.typeEnum===N.Generator?i=t:i={typeEnum:N.Generator,template:t,params:[]},this.expandGeneratorType(i)}},{key:"covertParamTypeToExpandedNode",value:function covertParamTypeToExpandedNode(e){return"id"in e?this.expandNode(e):{clazz:3,handle:e}}}]);return s0}(),pt=/*#__PURE__*/function(){function pt(e){_classCallCheck(this,pt);this.rootExpandedNode=e}_createClass(pt,[{key:"getCollapsedExpression",value:function getCollapsedExpression(){return this.collapseNode(this.rootExpandedNode)}},{key:"collapseNode",value:function collapseNode(e){switch(e.clazz){case Un.Border:return{id:pt.generateId(),hasCircular:!1,types:[e.type.typeEnum]};case Un.Object:return this.collapseObjectExpandedNode(e);case Un.Handle:return this.collapseHandleExpandedNode(e);case Un.Compound:return this.collapseCompoundExpandedNode(e,e.type.typeEnum);default:throw new Error("invalid class ".concat(e.clazz));}}},{key:"collapseObjectExpandedNode",value:function collapseObjectExpandedNode(_ref9){var e=_ref9.key,t=_ref9.index,i=_ref9.properties;var r=this.collapseNode(e),n=this.collapseNode(t),s=r.hasCircular||n.hasCircular,o={};for(var l in i){var h=i[l],d=this.collapseNode(h);o[l]=d,s=s||d.hasCircular}var a={key:r,index:n,properties:o};return this.isCollapsedObjectHasNeverPropertyTypes(a)?pt.neverCollapsedNode:{id:pt.generateId(),hasCircular:s,types:[N.Object],object:a}}},{key:"collapseHandleExpandedNode",value:function collapseHandleExpandedNode(_ref10){var e=_ref10.handle;switch(e.state){case Gi.Noncircular:return e.collapsedNode;case Gi.Indeterminate:case Gi.Circular:return{id:pt.generateId(),hasCircular:!0,types:[N.Object],handle:e};default:throw new Error("invalid state ".concat(e.state));}}},{key:"collapseCompoundExpandedNode",value:function collapseCompoundExpandedNode(_ref11,t){var e=_ref11.children;var i=[];var _iterator17=_createForOfIteratorHelper(e),_step17;try{for(_iterator17.s();!(_step17=_iterator17.n()).done;){var _r7=_step17.value;i.push(this.collapseNode(_r7))}}catch(err){_iterator17.e(err)}finally{_iterator17.f()}if(i.length===0)return pt.neverCollapsedNode;if(i.length===1)return i[0];for(var _i8=0,_i7=i;_i8<_i7.length;_i8++){var r=_i7[_i8];if(r.handle&&r.handle.state===Gi.Indeterminate){var n=t===N.And?"&":"|";throw new Ki("can not operate an indeterminate expression with \"".concat(n,"\" sign"))}}return t===N.And?this.pruneAndMergeNodes(i):this.flattenNodes(i)}},{key:"pruneAndMergeNodes",value:function pruneAndMergeNodes(e){var t=this.collectCrossTypeEnumsWith(e);if(t.length===0||t.find(function(r){return r===N.Never}))return pt.neverCollapsedNode;var i=this.collectAllObjectCollapsedNodesIn(e);return this.handleObjectCollapsedNodesWithTypeEnums(i,t,N.And)}},{key:"flattenNodes",value:function flattenNodes(e){var t=this.collectUnionTypeEnumsWith(e);if(t=t.filter(function(r){return r!==N.Never}),t.length===0)return pt.neverCollapsedNode;if(t.find(function(r){return r===N.Any}))return{id:pt.generateId(),hasCircular:!1,types:[N.Any]};var i=this.collectAllObjectCollapsedNodesIn(e);return this.handleObjectCollapsedNodesWithTypeEnums(i,t,N.Or)}},{key:"collectCrossTypeEnumsWith",value:function collectCrossTypeEnumsWith(e){var t={};var _iterator18=_createForOfIteratorHelper(e),_step18;try{for(_iterator18.s();!(_step18=_iterator18.n()).done;){var _r8=_step18.value.types;var _iterator19=_createForOfIteratorHelper(_r8),_step19;try{for(_iterator19.s();!(_step19=_iterator19.n()).done;){var n=_step19.value;var s=t[n];s===void 0&&(s=0),t[n]=s+1}}catch(err){_iterator19.e(err)}finally{_iterator19.f()}}}catch(err){_iterator18.e(err)}finally{_iterator18.f()}var i=[];for(var r in t){t[r]===e.length&&i.push(r)}return i}},{key:"collectUnionTypeEnumsWith",value:function collectUnionTypeEnumsWith(e){var t={};var _iterator20=_createForOfIteratorHelper(e),_step20;try{for(_iterator20.s();!(_step20=_iterator20.n()).done;){var _r9=_step20.value.types;var _iterator21=_createForOfIteratorHelper(_r9),_step21;try{for(_iterator21.s();!(_step21=_iterator21.n()).done;){var n=_step21.value;t[n]=!0}}catch(err){_iterator21.e(err)}finally{_iterator21.f()}}}catch(err){_iterator20.e(err)}finally{_iterator20.f()}var i=[];for(var r in t){t[r]&&i.push(r)}return i}},{key:"collectAllObjectCollapsedNodesIn",value:function collectAllObjectCollapsedNodesIn(e){var t=[];var _iterator22=_createForOfIteratorHelper(e),_step22;try{for(_iterator22.s();!(_step22=_iterator22.n()).done;){var i=_step22.value;(i.object||i.handle)&&t.push(i)}}catch(err){_iterator22.e(err)}finally{_iterator22.f()}return t}},{key:"handleObjectCollapsedNodesWithTypeEnums",value:function handleObjectCollapsedNodesWithTypeEnums(e,t,i){var _r10;var r=e;if(r.length===0)return{id:pt.generateId(),hasCircular:!1,types:t};if(r.length===1)return N1(Nm({},r[0]),{id:pt.generateId(),types:t});var n=[];if(r=r.filter(function(o){return o.handle?(n.push(o),!1):!0}),n.length>=2){var o=i===N.And?"&":"|";throw new Ki("can not ".concat(n.length," circular expression with \"").concat(o,"\" sign"))}(_r10=r).push.apply(_r10,n);var s=r[0].object;for(var _o5=1;_o5<r.length;++_o5){if(i===N.And&&this.isCollapsedObjectHasNeverPropertyTypes(s))return pt.neverCollapsedNode;var a=r[_o5],l=this.getObjectFromObjectCollapsedNode(a);i===N.And?s=this.factorizeWithAndOperation(s,l):s=this.factorizeWithOrOperation(s,l)}return this.isCollapsedObjectHasNeverPropertyTypes(s)?pt.neverCollapsedNode:{id:pt.generateId(),types:t,hasCircular:this.hasCircularIn(r),object:s}}},{key:"getObjectFromObjectCollapsedNode",value:function getObjectFromObjectCollapsedNode(e){var t=e;for(;;){if(t.object)return t.object;t=t.handle.collapsedNode}}},{key:"hasCircularIn",value:function hasCircularIn(e){var _iterator23=_createForOfIteratorHelper(e),_step23;try{for(_iterator23.s();!(_step23=_iterator23.n()).done;){var t=_step23.value.hasCircular;if(t)return!0}}catch(err){_iterator23.e(err)}finally{_iterator23.f()}return!1}},{key:"factorizeWithAndOperation",value:function factorizeWithAndOperation(e,t){var i=[],r=[],n=[];for(var o in e.properties){o in t.properties?i.push(o):r.push(o)}for(var _o6 in t.properties){_o6 in e.properties||n.push(_o6)}var s={};for(var _i10=0,_i9=i;_i10<_i9.length;_i10++){var _o7=_i9[_i10];var a=e.properties[_o7],l=t.properties[_o7];s[_o7]=this.pruneAndMergeNodes([a,l])}for(var _i11=0,_r11=r;_i11<_r11.length;_i11++){var _o8=_r11[_i11];s[_o8]=e.properties[_o8]}for(var _i12=0,_n7=n;_i12<_n7.length;_i12++){var _o9=_n7[_i12];s[_o9]=t.properties[_o9]}return{key:this.pruneAndMergeKeyOrIndexNodes(e.key,t.key),index:this.pruneAndMergeKeyOrIndexNodes(e.index,t.index),properties:s}}},{key:"factorizeWithOrOperation",value:function factorizeWithOrOperation(e,t){var i=[];for(var n in e.properties){n in t.properties&&i.push(n)}var r={};for(var _i14=0,_i13=i;_i14<_i13.length;_i14++){var _n8=_i13[_i14];var s=e.properties[_n8],o=t.properties[_n8];r[_n8]=this.flattenNodes([s,o])}return{key:this.flattenNodesKeyOrIndexNodes(e.key,t.key),index:this.flattenNodesKeyOrIndexNodes(e.index,t.index),properties:r}}},{key:"pruneAndMergeKeyOrIndexNodes",value:function pruneAndMergeKeyOrIndexNodes(e,t){return this.isCollapsedNodeTypeEqual(e,N.Undefined)?t:this.isCollapsedNodeTypeEqual(t,N.Undefined)?e:this.pruneAndMergeNodes([e,t])}},{key:"flattenNodesKeyOrIndexNodes",value:function flattenNodesKeyOrIndexNodes(e,t){return this.isCollapsedNodeTypeEqual(e,N.Undefined)?t:this.isCollapsedNodeTypeEqual(t,N.Undefined)?e:this.flattenNodes([e,t])}},{key:"isCollapsedObjectHasNeverPropertyTypes",value:function isCollapsedObjectHasNeverPropertyTypes(e){if(this.isCollapsedNodeTypeEqual(e.key,N.Never)||this.isCollapsedNodeTypeEqual(e.index,N.Never))return!0;for(var t in e.properties){if(this.isCollapsedNodeTypeEqual(e.properties[t],N.Never))return!0}return!1}},{key:"isCollapsedNodeTypeEqual",value:function isCollapsedNodeTypeEqual(e,t){return e.types.length!==1?!1:e.types[0]===t}}],[{key:"generateId",value:function generateId(){var e=this.nextId;return this.nextId+=1,"".concat(e)}}]);return pt}(),dh=pt;dh.nextId=0,dh.neverCollapsedNode={id:pt.generateId(),hasCircular:!1,types:[N.Never]};var o0=2500,a0=/*#__PURE__*/function(){function a0(e){_classCallCheck(this,a0);this.replaceReferenceType=e,this.templatesTable={}}_createClass(a0,[{key:"getTemplate",value:function getTemplate(e){if(e.id===void 0)throw new Ki("templateType don't have id");var t=this.templatesTable[e.id];return t||(t=new Gm(this,e),this.templatesTable[e.id]=t),t}}]);return a0}(),Gm=/*#__PURE__*/function(){function Gm(e,t){_classCallCheck(this,Gm);this.templateEnvironment=e,this.templateType=t,this.handlesCache=[]}_createClass(Gm,[{key:"getHandle",value:function getHandle(e){var t=this.getHandleByParams(e);if(!t){t={state:Gi.Indeterminate},this.setHandleWithParams(t,_toConsumableArray(e));var i=this.createCollapsedNode(e);t.collapsedNode=i,t.state=i.hasCircular?Gi.Circular:Gi.Noncircular}return t}},{key:"createCollapsedNode",value:function createCollapsedNode(e){var t=new s0(this.templateEnvironment,this.templateType,e).getExpandedExpression();return new dh(t).getCollapsedExpression()}},{key:"getHandleByParams",value:function getHandleByParams(e){var _iterator24=_createForOfIteratorHelper(this.handlesCache),_step24;try{for(_iterator24.s();!(_step24=_iterator24.n()).done;){var t=_step24.value;if(Gm.isParamsEquals(t.params,e))return t.handle}}catch(err){_iterator24.e(err)}finally{_iterator24.f()}}},{key:"setHandleWithParams",value:function setHandleWithParams(e,t){if(this.handlesCache.length>=o0)throw new Ki("the template's definition is divergence");this.handlesCache.push({handle:e,params:t})}}],[{key:"isParamsEquals",value:function isParamsEquals(e,t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;++i){var r=e[i],n=t[i];if(r!==n&&(!("id"in r)||!("id"in n)||r.id!==n.id))return!1}return!0}}]);return Gm}(),l0=/*#__PURE__*/function(){function l0(e){_classCallCheck(this,l0);this.collapsedNodeToRecordMap={},this.recordMap={},this.nextRecordId=0,this.templateEnvironment=new a0(e);var t=this.nextRecordId;this.nextRecordId+=1,this.recordMap[t]=this.anyObjectFormatRecord={id:t,key:t,index:t,properties:{}}}_createClass(l0,[{key:"covert",value:function covert(e){var t=this.templateEnvironment.getTemplate(e).getHandle([]).collapsedNode,i=this.findRecordId(t);return this.recordMap[i]}},{key:"getObjectFormatRecords",value:function getObjectFormatRecords(){var e=[];for(var t in this.recordMap){e.push(this.recordMap[t])}return e}},{key:"findRecordId",value:function findRecordId(e){if(e.types.some(function(t){return t===N.Object})){var t=this.collapsedNodeToRecordMap[e.id];if(!t){var i={id:this.nextRecordId};this.nextRecordId+=1,this.collapsedNodeToRecordMap[e.id]=i,this.recordMap[i.id]=i,this.convertCollapsedNodeAndFillObjectFormatRecord(e,i),t=i}return t.id}else return this.anyObjectFormatRecord.id}},{key:"convertCollapsedNodeAndFillObjectFormatRecord",value:function convertCollapsedNodeAndFillObjectFormatRecord(e,t){var i=e;for(;i.handle;){i=i.handle.collapsedNode}var r=i.object,n={};for(var s in r.properties){n[s]=this.findRecordId(r.properties[s])}t.key=this.findRecordId(r.key),t.index=this.findRecordId(r.index),t.properties=n}}]);return l0}(),$m=/*#__PURE__*/function(){function $m(){_classCallCheck(this,$m);this.replaceReferenceType=function(){throw new Ki("not define referenceTypeReplacer")}}_createClass($m,[{key:"createWithRecords",value:function createWithRecords(e,t){var i=new l0(t||this.replaceReferenceType),r=[],n={};var _iterator25=_createForOfIteratorHelper(e),_step25;try{for(_iterator25.s();!(_step25=_iterator25.n()).done;){var _step25$value=_step25.value,_l5=_step25$value.type,h=_step25$value.interrupter;var d=i.covert(_l5);h&&(n[d.id]=h),r.push(d.id)}}catch(err){_iterator25.e(err)}finally{_iterator25.f()}var s=i.getObjectFormatRecords().map(function(l){var h=n[l.id];return h?h(l):l}),o=new uh(s),a=[];for(var _i15=0,_r12=r;_i15<_r12.length;_i15++){var l=_r12[_i15];a.push(o.findObjectFormat(l))}return{format:o,objectFormats:a}}},{key:"createWithBuffer",value:function createWithBuffer(e){return new uh(uh.deserialize(e))}}]);return $m}(),uh=/*#__PURE__*/function(){function uh(e){_classCallCheck(this,uh);this.records={},this.formats={};var t=null;var _iterator26=_createForOfIteratorHelper(e),_step26;try{for(_iterator26.s();!(_step26=_iterator26.n()).done;){var i=_step26.value;var r={};this.records[i.id]=i,this.formats[i.id]=r,this.isAnyObjectFormatRecord(i)&&(t=r)}}catch(err){_iterator26.e(err)}finally{_iterator26.f()}var _iterator27=_createForOfIteratorHelper(e),_step27;try{for(_iterator27.s();!(_step27=_iterator27.n()).done;){var _i16=_step27.value;this.completeObjectFormat(this.formats[_i16.id],_i16)}}catch(err){_iterator27.e(err)}finally{_iterator27.f()}if(!t)throw new Error("can't find any object format");this.anyObjectFormat=t,this.objectFormatIds=Object.freeze(e.map(function(i){return i.id}).sort())}_createClass(uh,[{key:"isAnyObjectFormatRecord",value:function isAnyObjectFormatRecord(e){for(var t in e.properties){return!1}return e.index===e.id&&e.key===e.id}},{key:"completeObjectFormat",value:function completeObjectFormat(e,t){e.id=t.id,e.key=this.formats[t.key],e.index=this.formats[t.index],e.properties={};for(var i in t.properties){e.properties[i]=this.formats[t.properties[i]]}Object.freeze(e.properties),Object.freeze(e)}},{key:"findObjectFormat",value:function findObjectFormat(e){var t=this.formats[e];if(!t)throw new Error("can't find ObjectFormat with id ".concat(e));return t}},{key:"serialize",value:function serialize(){var e=[],t=new De;for(var i in this.records){e.push(this.records[i])}e.sort(function(i,r){return i.id-r.id}),t.writeUint32(e.length);for(var _i17=0,_e2=e;_i17<_e2.length;_i17++){var _i18=_e2[_i17];this.serializeRecord(_i18,t)}return t.toBuffer()}},{key:"serializeRecord",value:function serializeRecord(e,t){if(e.id>jn)throw new Ki("ObjectFormat's number can't greater than ".concat(jn));var i=Object.keys(e.properties).sort();if(i.length>jn)throw new Ki("ObjectFormat's properties number can't greater than ".concat(jn));t.writeUint32(e.id),t.writeUint32(e.key),t.writeUint32(e.index),t.writeUint32(i.length);var _iterator28=_createForOfIteratorHelper(i),_step28;try{for(_iterator28.s();!(_step28=_iterator28.n()).done;){var r=_step28.value;t.writeString(r),t.writeUint32(e.properties[r])}}catch(err){_iterator28.e(err)}finally{_iterator28.f()}}}],[{key:"deserialize",value:function deserialize(e){var t=[],i=new Ce(e),r=i.readUint32();for(var n=0;n<r;++n){var s=i.readUint32(),o=i.readUint32(),a=i.readUint32(),l=i.readUint32(),h={};for(var d=0;d<l;++d){var u=i.readString(),p=i.readUint32();h[u]=p}t.push({id:s,key:o,index:a,properties:h})}return t}}]);return uh}(),ce=Math.pow(2,32)-1;var c0=Object.defineProperty,Ym=Object.getOwnPropertySymbols,h0=Object.prototype.hasOwnProperty,d0=Object.prototype.propertyIsEnumerable,Xm=function Xm(e,t,i){return t in e?c0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},u0=function u0(e,t){for(var i in t||(t={})){h0.call(t,i)&&Xm(e,i,t[i])}if(Ym){var _iterator29=_createForOfIteratorHelper(Ym(t)),_step29;try{for(_iterator29.s();!(_step29=_iterator29.n()).done;){var i=_step29.value;d0.call(t,i)&&Xm(e,i,t[i])}}catch(err){_iterator29.e(err)}finally{_iterator29.f()}}return e},eA=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")};function Vn(e,t){return e===void 0?t:e}var p0=/*#__PURE__*/function(){function p0(e){_classCallCheck(this,p0);var t={},i=[];for(var r in e){var n=e[r],s=Vn(n.enablePing,!0),o=Vn(n.useSSL,!0),a=[],l={};for(var h in n.hosts){h==="*"?a.push.apply(a,_toConsumableArray(this.readStringArray(n.hosts[h]))):l[h]=this.readStringArray(n.hosts[h])}i.push(r),t[r]=Object.freeze({enablePing:s,useSSL:o,hosts:Object.freeze({"default":Object.freeze(a),regions:Object.freeze(l)})})}this.keys=Object.freeze(i.sort()),this.hosts=Object.freeze(u0({},t))}_createClass(p0,[{key:"readStringArray",value:function readStringArray(e){return typeof e=="string"?Object.freeze([e]):Object.freeze(_toConsumableArray(e))}},{key:"host",value:function host(e){var t=this.hosts[e];if(!t)throw new Error("cannot find host ".concat(JSON.stringify(e)));return t}}]);return p0}(),m0=/*#__PURE__*/function(){function m0(e,t){_classCallCheck(this,m0);this.nextIndex=0,this.enablePing=e.enablePing,this.useSSL=e.useSSL;var i;if(t===void 0?i=e.hosts["default"]:i=e.hosts.regions[t]||e.hosts["default"],i.length===0)throw t===void 0?new Error("expect region: unexpect undefined"):new Error("invalid region ".concat(JSON.stringify(t),": cannot find any hosts of region"));this.hosts=i}_createClass(m0,[{key:"hostsCount",get:function get(){return this.hosts.length}},{key:"host",value:function host(){return this.hosts[this.nextIndex]}},{key:"markSuccess",value:function markSuccess(e){}},{key:"markFail",value:function markFail(e){var t=this.nextIndex+1;t>=this.hosts.length&&(t=0),this.nextIndex=t}}]);return m0}(),f0=/*#__PURE__*/function(){function f0(e){_classCallCheck(this,f0);this.fetcher=e}_createClass(f0,[{key:"fetch",value:function fetch(e,t,i){var _this12=this;return new Promise(function(r,n){var s=setTimeout(o,i);function o(){s=null,n(new Error("timeout"))}_this12.fetcher(e,t).then(function(a){s!==null&&(clearTimeout(s),r(a))})["catch"](function(a){s!==null&&(clearTimeout(s),n(a))})})}}]);return f0}(),da=/*#__PURE__*/function(){function da(e){_classCallCheck(this,da);var t=new p0(e.configmap),i={};this.fetcher=new f0(e.fetcher),this.keys=t.keys,this.onIngoreFetchError=e.onIngoreFetchError,this.retryCount=e.retryCount,this.retryLoopsCount=e.retryLoopsCount,this.timeout=da.parseTimeoutFromParams(e.timeout),this.bussySleepDuration=Vn(e.bussySleepDuration,3*1e3);var _iterator30=_createForOfIteratorHelper(this.keys),_step30;try{for(_iterator30.s();!(_step30=_iterator30.n()).done;){var r=_step30.value;i[r]=new m0(t.host(r),e.region)}}catch(err){_iterator30.e(err)}finally{_iterator30.f()}this.loops=Object.freeze(i)}_createClass(da,[{key:"fetch",value:function fetch(e){var _this13=this;var t=this.parseFetchingContext(e),i=t.key,r=this.loop(i);return function(n,s){return _this13.fetchWithKey(t,r,n,s)}}},{key:"origin",value:function origin(e,t){var i=this.loop(t),r=i.host(),n=e;return /:$/im.test(n)||(n+=":"),this.replaceProtocol(n,i.useSSL)+"//"+r}},{key:"reportSuccess",value:function reportSuccess(e,t){this.loop(e).markSuccess(t)}},{key:"reportFail",value:function reportFail(e,t){this.loop(e).markFail(t)}},{key:"fetchWithKey",value:function(){var _fetchWithKey=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee(e,t,i,r){var n,s,o,a,h,d,u,p,f,m,g,l;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:n=(r&&r.method||"get").toLowerCase(),s=e.enableRetry;s===void 0&&(s=this.checkIsIdempotent(n));o=s?this.getFetchingCount(e,t):1,a=null;h=0;case 4:if(!(h<o)){_context.next=28;break}d=Date.now();_context.prev=6;u=t.host();p=this.replaceURL(i,u,t.useSSL);f=e.timeout.length;m=h<f?e.timeout[h]:e.timeout[f-1];_context.next=13;return this.fetcher.fetch(p,r,m);case 13:g=_context.sent;if(this.isServerBussyCode(g.status)){_context.next=16;break}return _context.abrupt("return",(t.markSuccess(Date.now()-d),g));case 16:_context.t0=h<o-1;if(!_context.t0){_context.next=20;break}_context.next=20;return new Promise(function(y){return setTimeout(y,e.bussySleepDuration)});case 20:_context.next=25;break;case 22:_context.prev=22;_context.t1=_context["catch"](6);a=_context.t1,t.markFail(Date.now()-d);case 25:++h;_context.next=4;break;case 28:this.onIngoreFetchError&&a&&this.onIngoreFetchError(a);l="fail to ".concat(n," ").concat(this.replaceHost(i,t.useSSL));throw o>1&&(l+=" after ".concat(o," times retries")),a?a=new Error("".concat(l," and the last Error is: ").concat(a.message)):a=new Error(l),a;case 31:case"end":return _context.stop();}}},_callee,this,[[6,22]])}));function fetchWithKey(_x2,_x3,_x4,_x5){return _fetchWithKey.apply(this,arguments)}return fetchWithKey}()},{key:"getFetchingCount",value:function getFetchingCount(e,t){var i,r;return typeof e.retryCount=="number"&&(i=e.retryCount+1),typeof e.retryLoopsCount=="number"&&(r=(e.retryLoopsCount+1)*t.hostsCount),i!==void 0&&r!==void 0?Math.max(i,r):i!==void 0?i:r!==void 0?r:t.hostsCount}},{key:"replaceURL",value:function replaceURL(e,t,i){var _URL=new URL(e),r=_URL.protocol,n=_URL.port,s=_URL.pathname,o=_URL.search,a=this.replaceProtocol(r,i),l=t;return n&&(l+=":"+n),"".concat(a,"//").concat(l).concat(s).concat(o)}},{key:"replaceHost",value:function replaceHost(e,t){var _URL2=new URL(e),i=_URL2.protocol,r=_URL2.hostname,n=_URL2.port,s=_URL2.pathname,o=_URL2.search,a=this.replaceProtocol(i,t),l="{{"+r+"}}";return n&&(l+=":"+n),"".concat(a,"//").concat(l).concat(s).concat(o)}},{key:"parseFetchingContext",value:function parseFetchingContext(e){var t=e;return typeof t=="string"&&(t={key:t}),Object.freeze({key:t.key,enableRetry:t.enableRetry,timeout:da.parseTimeoutFromParams(t.timeout,this.timeout),retryCount:Vn(t.retryCount,this.retryCount),retryLoopsCount:Vn(t.retryLoopsCount,this.retryLoopsCount),bussySleepDuration:Vn(t.bussySleepDuration,this.bussySleepDuration)})}},{key:"checkIsIdempotent",value:function checkIsIdempotent(e){switch(e){case"put":case"options":case"head":case"patch":case"delete":case"get":return!0;default:return!1;}}},{key:"isServerBussyCode",value:function isServerBussyCode(e){switch(e){case 503:case 504:return!0;default:return!1;}}},{key:"replaceProtocol",value:function replaceProtocol(e,t){switch(e){case"http:":case"https:":return t?"https:":"http:";case"ws:":case"wss:":return t?"wss:":"ws:";default:return e;}}},{key:"loop",value:function loop(e){var t=this.loops[e];if(!t)throw new Error("undefined key ".concat(JSON.stringify(e)));return t}}],[{key:"parseTimeoutFromParams",value:function parseTimeoutFromParams(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:da.defaultTimeout;if(typeof e=="number")return Object.freeze([e]);if(Array.isArray(e)){if(e.length===0)throw new Error("timeout cannot be []");return Object.freeze(_toConsumableArray(e))}else return t}}]);return da}(),$i=da;$i.defaultTimeout=Object.freeze([5*1e3,10*1e3,25*1e3]);var df=P(require("atob"));var g0=Object.defineProperty,Qm=Object.getOwnPropertySymbols,y0=Object.prototype.hasOwnProperty,b0=Object.prototype.propertyIsEnumerable,qm=function qm(e,t,i){return t in e?g0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},ua=function ua(e,t){for(var i in t||(t={})){y0.call(t,i)&&qm(e,i,t[i])}if(Qm){var _iterator31=_createForOfIteratorHelper(Qm(t)),_step31;try{for(_iterator31.s();!(_step31=_iterator31.n()).done;){var i=_step31.value;b0.call(t,i)&&qm(e,i,t[i])}}catch(err){_iterator31.e(err)}finally{_iterator31.f()}}return e},iA=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")},v0=/*#__PURE__*/function(){function v0(e){_classCallCheck(this,v0);this.sockets=[],this.logger=e}_createClass(v0,[{key:"socketsCount",get:function get(){return this.sockets.length}},{key:"addSocket",value:function addSocket(e){this.sockets.indexOf(e)===-1&&this.sockets.push(e)}},{key:"removeSocket",value:function removeSocket(e){var t=this.sockets.indexOf(e);t!==-1&&this.sockets.splice(t,1)}},{key:"forEachSockets",value:function forEachSockets(e){this.sockets.forEach(e)}},{key:"emit",value:function emit(e,t){var _iterator32=_createForOfIteratorHelper(this.sockets),_step32;try{for(_iterator32.s();!(_step32=_iterator32.n()).done;){var i=_step32.value;try{i.emit(e,t)}catch(r){this.logger.error(r)}}}catch(err){_iterator32.e(err)}finally{_iterator32.f()}}}]);return v0}(),pa=/*#__PURE__*/function(){function pa(e){_classCallCheck(this,pa);this.typesMap={},this.typeToIndexMap={},this.typesMap=Object.freeze(this.createTypesMap(e)),this.typeToIndexMap=Object.freeze(this.createTypeToIndexMap(this.typesMap))}_createClass(pa,[{key:"createTypesMap",value:function createTypesMap(e){var t={};for(var i=0;i<e.length;++i){t[i]=e[i]}return t}},{key:"createTypeToIndexMap",value:function createTypeToIndexMap(e){var t={};for(var i in e){var r=parseInt(i,10),n=e[r];if(n in t)throw new Error("find duplicated type \"".concat(n," in parameters of new TypesMap(...)\""));t[n]=r}return t}},{key:"hasType",value:function hasType(e){return e in this.typeToIndexMap}},{key:"findTypeId",value:function findTypeId(e){var t=this.typeToIndexMap[e];if(t===void 0)throw new Error("can't find id with type ".concat(e));return t}},{key:"findTypeById",value:function findTypeById(e){var t=this.typesMap[e];if(!t)throw new Error("can't find type with id ".concat(e));return t}},{key:"extendsTypesMap",value:function extendsTypesMap(e){var t=[];for(var i in this.typesMap){t.push(this.typesMap[i])}for(var _i19 in e.typesMap){t.push(e.typesMap[_i19])}return new pa(t)}}],[{key:"create",value:function create(e){return new pa(e)}}]);return pa}(),Wn;(function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"})(Wn||(Wn={}));var S0=/*#__PURE__*/function(){function S0(){_classCallCheck(this,S0);this.eventListeners={}}_createClass(S0,[{key:"on",value:function on(e,t){var i=this.eventListeners[e];i||(i=[],this.eventListeners[e]=i),i.indexOf(t)===-1&&i.push(t)}},{key:"off",value:function off(e,t){var i=this.eventListeners[e];if(i){var r=i.indexOf(t);r!==-1&&(i.splice(r,1),i.length===0&&delete this.eventListeners[e])}}},{key:"once",value:function once(e,t){var _this14=this;var i=function i(r){try{t(r)}finally{_this14.off(e,i)}};this.on(e,i)}},{key:"dispatchToListeners",value:function dispatchToListeners(e,t){var i=this.eventListeners[e];if(i){var _iterator33=_createForOfIteratorHelper(i),_step33;try{for(_iterator33.s();!(_step33=_iterator33.n()).done;){var r=_step33.value;try{r(t)}catch(n){console.error(n)}}}catch(err){_iterator33.e(err)}finally{_iterator33.f()}}}}]);return S0}(),ph=Math.pow(2,32);function mh(e,t,i){var r=i%ph,n=(i-r)/ph;e.setInt32(t,r),e.setInt32(t+4,n)}function fh(e,t){var i=e.getInt32(t);return e.getInt32(t+4)*ph+i}var Hs;(function(e){e[e.Buffer=0]="Buffer",e[e.String=1]="String",e[e.Integer=2]="Integer"})(Hs||(Hs={}));function w0(e){switch(_typeof(e)){case"number":return 2;case"string":return 1;default:return 0;}}var C0=/*#__PURE__*/function(){function C0(e,t,i){var _this15=this;_classCallCheck(this,C0);this.typesMap=e,this.socket=t,this.receiver=i,this.latestThreePackageBytes=[0,0,0],this.nextSelfPackageId=0,this._latestReceivedRemoteId=-1,this.onMessage=function(r){try{if(!_this15.receivedPackageHeadBuffer)_this15.receivedPackageHeadBuffer=ai(r.data);else{var n=_this15.receivedPackageHeadBuffer,s=ai(r.data),o=_this15.parsePackage(n,s);_this15._latestReceivedRemoteId=Math.max(o.id,_this15._latestReceivedRemoteId),_this15.receivedPackageHeadBuffer=void 0,_this15.receiver(null,o)}}catch(n){_this15.receiver(n,null)}},t.binaryType="arraybuffer",t.addEventListener("message",this.onMessage)}_createClass(C0,[{key:"bufferedAmount",get:function get(){return this.socket.bufferedAmount}},{key:"maxPackageBytesInLatestThree",get:function get(){return Math.max.apply(Math,[0].concat(_toConsumableArray(this.latestThreePackageBytes)))}},{key:"latestReceivedRemoteId",get:function get(){return this._latestReceivedRemoteId}},{key:"sendPackage",value:function sendPackage(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=Object.freeze({id:this.nextSelfPackageId,receivedId:this._latestReceivedRemoteId,type:e,data:t});this.nextSelfPackageId+=1;var r=this.createPackageHead(i),n=this.wrapPackageData(i.data),s=r.byteLength+n.byteLength;return this.socket.send(r.primitiveBuffer),this.socket.send(n.primitiveBuffer),this.latestThreePackageBytes[0]=this.latestThreePackageBytes[1],this.latestThreePackageBytes[1]=this.latestThreePackageBytes[2],this.latestThreePackageBytes[2]=s,i.id}},{key:"createPackageHead",value:function createPackageHead(e){var t=Ct(18);return mh(t,0,e.id),mh(t,8,e.receivedId),t.setUint8(16,this.typesMap.findTypeId(e.type)),t.setUint8(17,w0(e.data)),t}},{key:"wrapPackageData",value:function wrapPackageData(e){if(typeof e=="string"){var t=new String(e),i=Ct(t.length*2);for(var r=0;r<t.length;++r){i.setUint16(r*2,t.charCodeAt(r)&65535)}return i}else if(typeof e=="number"){var _t4=Ct(8);return mh(_t4,0,e),_t4}else return e}},{key:"parsePackage",value:function parsePackage(e,t){var i=fh(e,0),r=fh(e,8),n=e.getUint8(16),s=e.getUint8(17),o;switch(s){case Hs.String:{var a=t.byteLength/2,l=[];for(var h=0;h<a;++h){l[h]=t.getUint16(h*2)}o=String.fromCharCode.apply(String,l);break}case Hs.Integer:{o=fh(t,0);break}case Hs.Buffer:{o=t;break}default:throw new Error("unrecognized data type ".concat(s));}return Object.freeze({id:i,receivedId:r,type:this.typesMap.findTypeById(n),data:o})}}]);return C0}(),Zm=/*#__PURE__*/function(){function Zm(e,t,i,r,n){var _this16=this;_classCallCheck(this,Zm);this.receivedWhenNotWorkingBuffer=[],this.remoteHeartbeatTimeout=void 0,this.crashByChannelError=!1,this.isWorking=!1,this.isLimit=!1,this.becameLimitTimestamp=0,this.sendHeartbeat=function(){_this16.isWorking&&(_this16.sendHeartbeatDelayer.refreshAndInvokeAfterInterval(_this16.akkoSocket.params.heartbeatInterval),_this16.chanel.sendPackage("heartbeat"))},this.handleRemoteHeartbeatTimeout=function(){_this16.crashByChannelError||(_this16.crashByChannelError=!0,_this16.callbacks.onRemoteHeartbeatTimeout())},this.onReceivedPackage=function(s,o){if(!_this16.crashByChannelError)if(!s&&o){if(_this16.isWorking)try{_this16.handleReceivedPackage(o)}finally{_this16.delayRemoteHeartbeatTimeoutChecking()}else _this16.receivedWhenNotWorkingBuffer.push(o);}else s&&!o&&_this16.callbacks.onParseMessageFailed(s)},this.akkoSocket=e,this.logger=i,this.chanel=new C0(r,t,this.onReceivedPackage),this.callbacks=Object.freeze(ua({},n)),this.sendHeartbeatDelayer=new Pi(this.sendHeartbeat),this.remoteHeartbeatTimeoutDelayer=new Pi(this.handleRemoteHeartbeatTimeout)}_createClass(Zm,[{key:"send",value:function send(e,t){if(this.isWorking)if(t instanceof Array){var _iterator34=_createForOfIteratorHelper(t),_step34;try{for(_iterator34.s();!(_step34=_iterator34.n()).done;){var i=_step34.value;this.sendPackage(e,i)}}catch(err){_iterator34.e(err)}finally{_iterator34.f()}}else this.sendPackage(e,t)}},{key:"sendPackage",value:function sendPackage(e,t){if(this.checkBufferedAmountOverflow())throw this.crashByChannelError||(this.crashByChannelError=!0,this.callbacks.onSendingBufferOverflow()),new Error("sending buffer overflow");this.sendHeartbeatDelayer.refreshAndInvokeAfterInterval(this.akkoSocket.params.heartbeatInterval),this.chanel.sendPackage(e,t)}},{key:"checkBufferedAmountOverflow",value:function checkBufferedAmountOverflow(){var e=!1,_this$akkoSocket$para=this.akkoSocket.params,t=_this$akkoSocket$para.sendingBufferCrash,i=_this$akkoSocket$para.sendingBufferLimit,r=_this$akkoSocket$para.sendingBufferLimitDuration,_this$chanel=this.chanel,n=_this$chanel.bufferedAmount,s=_this$chanel.maxPackageBytesInLatestThree;if(n>t+s)e=!0;else if(n>i+s){var o=Date.now();this.isLimit?o-this.becameLimitTimestamp>r&&(this.isLimit=!1,e=!0):(this.isLimit=!0,this.becameLimitTimestamp=o)}else this.isLimit=!1;return e}},{key:"dispatchClose",value:function dispatchClose(e){var t=JSON.stringify(e);this.chanel.sendPackage("close",t)}},{key:"start",value:function start(){this.isWorking||(this.isWorking=!0,this.delayRemoteHeartbeatTimeoutChecking(),this.sendHeartbeatDelayer.refreshAndInvokeAfterInterval(this.akkoSocket.params.heartbeatInterval),this.chanel.sendPackage("setHeartbeatTimeout",this.akkoSocket.params.heartbeatTimeout),this.cleanReceivedWhenNotWorkingBuffer())}},{key:"cleanReceivedWhenNotWorkingBuffer",value:function cleanReceivedWhenNotWorkingBuffer(){var e=this.receivedWhenNotWorkingBuffer.splice(0,this.receivedWhenNotWorkingBuffer.length);if(e.length>0)try{var _iterator35=_createForOfIteratorHelper(e),_step35;try{for(_iterator35.s();!(_step35=_iterator35.n()).done;){var t=_step35.value;this.handleReceivedPackage(t)}}catch(err){_iterator35.e(err)}finally{_iterator35.f()}}finally{this.delayRemoteHeartbeatTimeoutChecking()}}},{key:"stop",value:function stop(){this.isWorking&&(this.isWorking=!1,this.sendHeartbeatDelayer.dispose(),this.remoteHeartbeatTimeoutDelayer.dispose(),this.remoteHeartbeatTimeout=void 0)}},{key:"handleReceivedPackage",value:function handleReceivedPackage(e){if(!Zm.sessionEventTypesMap.hasType(e.type))this.callbacks.onEvent(e.type,e.data);else if(e.type==="setHeartbeatTimeout")typeof e.data=="number"&&e.data>0?this.remoteHeartbeatTimeout=e.data:this.logger.warn("illegal remote heartbeat timeout: ".concat(e.data));else if(e.type==="close"){var t;if(typeof e.data=="string")try{t=JSON.parse(e.data)}catch(i){this.logger.warn("parse close payload as JSON failed: ".concat(i.message))}this.callbacks.onCloseByRemote(t)}}},{key:"delayRemoteHeartbeatTimeoutChecking",value:function delayRemoteHeartbeatTimeoutChecking(){this.remoteHeartbeatTimeout===void 0?this.remoteHeartbeatTimeoutDelayer.refreshAndInvokeAfterInterval(this.akkoSocket.params.heartbeatTimeout):this.remoteHeartbeatTimeoutDelayer.refreshAndInvokeAfterInterval(this.remoteHeartbeatTimeout)}}]);return Zm}(),gh=Zm;gh.sessionEventTypesMap=pa.create(["heartbeat","setHeartbeatTimeout","close"]);var k0=25*1e3,x0=/*#__PURE__*/function(){function x0(e,t){var _this17=this;_classCallCheck(this,x0);this.socket=e,this.logger=t,this.paddingExecutors=[],this.createdAt=Date.now(),this.isConnecting=!0,this.onOpen=function(){if(_this17.isConnecting){_this17.finishConnecting();var i=Date.now()-_this17.createdAt;var _iterator36=_createForOfIteratorHelper(_this17.paddingExecutors.splice(0)),_step36;try{for(_iterator36.s();!(_step36=_iterator36.n()).done;){var r=_step36.value;r.resolve({duration:i})}}catch(err){_iterator36.e(err)}finally{_iterator36.f()}}},this.onError=function(i){if(_this17.isConnecting){_this17.finishConnecting();var r=new Error(i.message||"connect failed");var _iterator37=_createForOfIteratorHelper(_this17.paddingExecutors.splice(0)),_step37;try{for(_iterator37.s();!(_step37=_iterator37.n()).done;){var n=_step37.value;n.reject(r)}}catch(err){_iterator37.e(err)}finally{_iterator37.f()}}},this.onTimeout=function(){if(_this17.isConnecting){_this17.finishConnecting();var i=new Error("timeout");var _iterator38=_createForOfIteratorHelper(_this17.paddingExecutors.splice(0)),_step38;try{for(_iterator38.s();!(_step38=_iterator38.n()).done;){var _r13=_step38.value;_r13.reject(i)}}catch(err){_iterator38.e(err)}finally{_iterator38.f()}try{var r=1e3;_this17.socket.close(r)}catch(r){_this17.logger.error(r)}}},e.addEventListener("open",this.onOpen),e.addEventListener("error",this.onError),this.timeoutTimer=setTimeout(this.onTimeout,k0)}_createClass(x0,[{key:"waitToConnected",value:function waitToConnected(){var _this18=this;return new Promise(function(e,t){_this18.paddingExecutors.push({resolve:e,reject:t})})}},{key:"finishConnecting",value:function finishConnecting(){this.timeoutTimer&&clearTimeout(this.timeoutTimer),this.socket.removeEventListener("open",this.onOpen),this.socket.removeEventListener("error",this.onError),this.isConnecting=!1,this.timeoutTimer=null}}]);return x0}(),P0=3e3,I0=/*#__PURE__*/function(_S2){_inherits(I0,_S2);var _super9=_createSuper(I0);function I0(e,t,i,r){var _this19;_classCallCheck(this,I0);_this19=_super9.call(this);_this19.didCallDisconnect=!1,_this19.connectingManager=null,_this19.connectFailError=void 0,_this19.onError=function(){_this19.logger.warn("websocket received error")},_this19.onCloseByRemote=function(n){if(_this19._phase!==Pe.Connected)return;var s=1e3;_this19.sessionChannel.stop(),_this19.closeSocket(s),_this19.updatePhase(Pe.Disconnected);var o=n&&n.error,a=n&&n.reason;o?_this19.callOnDisconnect({reason:Pt.RemoteError,message:o,remoteCode:n.errorCode}):_this19.callOnDisconnect({reason:Pt.Normal,message:a||"ok"})},_this19.onClose=function(_ref12){var _ref12$code=_ref12.code,n=_ref12$code===void 0?1e3:_ref12$code,s=_ref12.reason;if(_this19._phase!==Pe.Connected)return;var o=_this19.errorMessageWithCode(n)||"disconnected with code ".concat(n," \"").concat(s,"\"");_this19.sessionChannel.stop(),_this19.updatePhase(Pe.Disconnected),_this19.callOnDisconnect({reason:Pt.WebSocketError,message:o,webSocketCode:n})},_this19.socket=e,_this19.socket.binaryType="arraybuffer",_this19.logger=t,_this19.params=Object.freeze(ua({},r)),_this19.sessionChannel=new gh(_assertThisInitialized(_this19),e,t,i,{onCloseByRemote:_this19.onCloseByRemote,onEvent:function onEvent(n,s){return _this19.dispatchToListeners(n,s)},onRemoteHeartbeatTimeout:function onRemoteHeartbeatTimeout(){return _this19.onCommunicationErrorMessage("remote heartbeat timeout")},onSendingBufferOverflow:function onSendingBufferOverflow(){return _this19.onCommunicationErrorMessage("sending buffer overflow")},onParseMessageFailed:function onParseMessageFailed(n){return _this19.onCommunicationErrorMessage("parse message failed: "+n.message)}}),_this19.initializePhaseWithSocketReadyState();return _this19}_createClass(I0,[{key:"initializePhaseWithSocketReadyState",value:function initializePhaseWithSocketReadyState(){switch(this.socket.readyState){case Wn.CONNECTING:{this._phase=Pe.Connecting,this.connect();break}case Wn.OPEN:{this._phase=Pe.Connected,this.addSessionListeners(),this.sessionChannel.start();break}default:{var e=Wn[this.socket.readyState];throw e||(e="".concat(this.socket.readyState)),new Error("invalid readyState of WebSocket: ".concat(e))}}}},{key:"phase",get:function get(){return this._phase}},{key:"updatePhase",value:function updatePhase(e){if(this._phase!==e)try{this.params.onPhaseChanged(e)}finally{this._phase=e}}},{key:"emit",value:function emit(e,t){if(this._phase!==Pe.Connected)throw new Error("AkkoSocket can't emit when phase is ".concat(this.phase));try{this.sessionChannel.send(e,t)}catch(i){var r=1e3;throw this.disconnectForceWithCode(r),this.callOnDisconnect({reason:Pt.WebSocketError,message:i.message}),i}}},{key:"connect",value:function(){var _connect=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;this.connectingManager=new x0(this.socket,this.logger);_context2.next=4;return this.connectingManager.waitToConnected();case 4:this.addSessionListeners();this.sessionChannel.start();this.updatePhase(Pe.Connected);_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2["catch"](0);this.updatePhase(Pe.Disconnected),this.connectFailError=_context2.t0;case 12:_context2.prev=12;this.connectingManager=null;return _context2.finish(12);case 15:case"end":return _context2.stop();}}},_callee2,this,[[0,9,12,15]])}));function connect(){return _connect.apply(this,arguments)}return connect}()},{key:"addSessionListeners",value:function addSessionListeners(){this.socket.addEventListener("close",this.onClose),this.socket.addEventListener("error",this.onError)}},{key:"waitToConnected",value:function waitToConnected(){if(this.connectFailError)throw this.connectFailError;if(this._phase===Pe.Connected)return Promise.resolve({duration:0});if(this._phase===Pe.Connecting)return this.connectingManager.waitToConnected();throw new Error("AkkoSocket's phase had became ".concat(this._phase))}},{key:"disconnect",value:function disconnect(e){return e?this.disconnectWithCodeAndReason({reason:e}):this.disconnectWithCodeAndReason()}},{key:"disconnectWithErrorDescription",value:function disconnectWithErrorDescription(_ref13){var e=_ref13.message,t=_ref13.code;return this.disconnectWithCodeAndReason({error:e,errorCode:t})}},{key:"disconnectForce",value:function disconnectForce(){if(this._phase!==Pe.Connected)return;var e=1e3;this.disconnectForceWithCode(e)}},{key:"disconnectForceWithCode",value:function disconnectForceWithCode(e){this.sessionChannel.stop(),this.closeSocket(e),this.updatePhase(Pe.Disconnected)}},{key:"disconnectWithCodeAndReason",value:function(){var _disconnectWithCodeAndReason=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee3(e){var t,i;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!this.didCallDisconnect){_context3.next=2;break}throw new Error("AkkoSocket did call disconnect");case 2:this.didCallDisconnect=!0;t=!0;_context3.t0=this._phase;_context3.next=_context3.t0===Pe.Disconnecting?7:_context3.t0===Pe.Disconnected?7:_context3.t0===Pe.Connecting?8:17;break;case 7:throw new Error("AkkoSocket can't disconnect when phase is ".concat(this.phase));case 8:_context3.prev=8;_context3.next=11;return this.waitToConnected();case 11:_context3.next=16;break;case 13:_context3.prev=13;_context3.t1=_context3["catch"](8);t=!1;case 16:return _context3.abrupt("break",17);case 17:if(!t){_context3.next=26;break}this.updatePhase(Pe.Disconnecting);this.sessionChannel.dispatchClose(e);_context3.next=22;return this.waitUtilCloseAndCheckTimeout();case 22:if(!_context3.sent){_context3.next=25;break}i=1e3;this.closeSocket(i);case 25:this.sessionChannel.stop(),this.updatePhase(Pe.Disconnected);case 26:case"end":return _context3.stop();}}},_callee3,this,[[8,13]])}));function disconnectWithCodeAndReason(_x6){return _disconnectWithCodeAndReason.apply(this,arguments)}return disconnectWithCodeAndReason}()},{key:"waitUtilCloseAndCheckTimeout",value:function waitUtilCloseAndCheckTimeout(){var _this20=this;var e=null,t=new Promise(function(r){e=setTimeout(function(){e=null,r(!0)},P0)}),i=new Promise(function(r){_this20.socket.readyState===Wn.CLOSED?r(!1):_this20.socket.addEventListener("close",function(){return r(!1)})});return Promise.race([t,i]).then(function(r){return e!==null&&clearTimeout(e),r})}},{key:"onCommunicationErrorMessage",value:function onCommunicationErrorMessage(e){this._phase===Pe.Connected&&(this.disconnectForce(),this.callOnDisconnect({reason:Pt.CommunicationError,message:e}))}},{key:"closeSocket",value:function closeSocket(e){try{this.socket.close(e)}catch(t){this.logger.error(t)}}},{key:"callOnDisconnect",value:function callOnDisconnect(e){this.didCallDisconnect||this.params.onDisconnect(e)}},{key:"errorMessageWithCode",value:function errorMessageWithCode(e){switch(e){case 1e3:return"CLOSE_NORMAL";case 1001:return"CLOSE_GOING_AWAY";case 1002:return"CLOSE_PROTOCOL_ERROR";case 1003:return"CLOSE_UNSUPPORTED";case 1005:return"CLOSE_NO_STATUS";case 1006:return"CLOSE_ABNORMAL";case 1007:return"Unsupported Data";case 1008:return"Policy Violation";case 1009:return"CLOSE_TOO_LARGE";case 1010:return"Missing Extension";case 1011:return"Internal Error";case 1012:return"Service Restart";case 1013:return"Try Again Later";case 1015:return"TLS Handshake";default:return;}}}]);return I0}(S0),Jm=/*#__PURE__*/function(){function Jm(e){_classCallCheck(this,Jm);this.eventTypesMap=gh.sessionEventTypesMap.extendsTypesMap(pa.create(e))}_createClass(Jm,[{key:"createSocket",value:function createSocket(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return new I0(e,t,this.eventTypesMap,ua(ua({},Jm.defaultSocketParams),i))}},{key:"createCombinedSockets",value:function createCombinedSockets(e){return new v0(e)}}]);return Jm}(),yh=Jm;yh.defaultSocketParams=Object.freeze({heartbeatInterval:40*1e3,heartbeatTimeout:50*1e3,sendingBufferLimit:5*1024*1024,sendingBufferLimitDuration:30*1e3,sendingBufferCrash:100*1024*1024,onDisconnect:function onDisconnect(){},onPhaseChanged:function onPhaseChanged(){}});var Pe;(function(e){e.Connecting="connecting",e.Connected="connected",e.Disconnecting="disconnecting",e.Disconnected="disconnected"})(Pe||(Pe={}));var Pt;(function(e){e.Normal="normal",e.WebSocketError="webSocketError",e.CommunicationError="communicationError",e.RemoteError="remoteError"})(Pt||(Pt={}));var M0=Object.defineProperty,T0=Object.defineProperties,E0=Object.getOwnPropertyDescriptors,ef=Object.getOwnPropertySymbols,A0=Object.prototype.hasOwnProperty,O0=Object.prototype.propertyIsEnumerable,tf=function tf(e,t,i){return t in e?M0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},ii=function ii(e,t){for(var i in t||(t={})){A0.call(t,i)&&tf(e,i,t[i])}if(ef){var _iterator39=_createForOfIteratorHelper(ef(t)),_step39;try{for(_iterator39.s();!(_step39=_iterator39.n()).done;){var i=_step39.value;O0.call(t,i)&&tf(e,i,t[i])}}catch(err){_iterator39.e(err)}finally{_iterator39.f()}}return e},di=function di(e,t){return T0(e,E0(t))},oA=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")};function R0(e){var t=e.readInt32();e.readInt32();var i=[];for(var r=0;r<t;++r){var n=e.readUint32();i.push({userId:n,nextFrameId:0,session:"",payload:void 0})}return i}var ke;(function(e){e[e.Invoker=0]="Invoker",e[e.Event=1]="Event",e[e.Ack=2]="Ack",e[e.Enter=3]="Enter",e[e.Leave=4]="Leave"})(ke||(ke={}));function bh(e){return e.type===0}function ma(e){return e.type===1}function fa(e){return e.type===3}function ga(e){return e.type===4}var Ve;(function(e){e[e.System=0]="System",e[e.App=1]="App",e[e.Custom=2]="Custom",e[e.Magix=3]="Magix"})(Ve||(Ve={}));var N0=/*#__PURE__*/function(){function N0(e,t){_classCallCheck(this,N0);var i=e.format.anyObjectFormat;this.serialization=e,this.rootClassReflection=t,this.rootObjectFormats=Object.freeze([this.rootClassReflection.objectFormat]),this.oneAnyObjectFormats=Object.freeze([i]),this.twoAnyObjectFormats=Object.freeze([i,i])}_createClass(N0,[{key:"serializeSnapshotFrame",value:function serializeSnapshotFrame(e){var t=new De;return this.serializeFrameHeader(t,e),this.serializeUsers(t,e.users),this.serialization.serialize({writer:t,values:[e.rootObject],objectFormats:this.rootObjectFormats,includesHash:!0}),t.toBuffer()}},{key:"serializeUsers",value:function serializeUsers(e,t){var i=[this.serialization.format.anyObjectFormat];e.writeUint32(t.length);var _iterator40=_createForOfIteratorHelper(t),_step40;try{for(_iterator40.s();!(_step40=_iterator40.n()).done;){var r=_step40.value;e.writeUint32(r.userId),e.writeUint32(r.nextFrameId),e.writeString(r.session),this.serialization.serialize({writer:e,values:[r.payload],objectFormats:i,includesHash:!0})}}catch(err){_iterator40.e(err)}finally{_iterator40.f()}}},{key:"deserializeSnapshotFrame",value:function deserializeSnapshotFrame(e,t,i){var r=new Ce(e),n=this.deserializeFrameHeader(r),s;t!==ci.V0?s=this.deserializeUsers(r,t,i):s=R0(r);var _this$serialization$d=this.serialization.deserialize({reader:r,objectFormats:this.rootObjectFormats,ignoreHashChecking:i,version:t}),_this$serialization$d2=_slicedToArray(_this$serialization$d,1),o=_this$serialization$d2[0];return di(ii({},n),{users:s,rootObject:o})}},{key:"deserializeUsers",value:function deserializeUsers(e,t,i){var r=e.readUint32(),n=[],s=[this.serialization.format.anyObjectFormat];for(var o=0;o<r;++o){var a=e.readUint32(),l=e.readUint32(),h=e.readString(),_this$serialization$d3=this.serialization.deserialize({reader:e,objectFormats:s,ignoreHashChecking:i,version:t}),_this$serialization$d4=_slicedToArray(_this$serialization$d3,1),d=_this$serialization$d4[0];n.push({userId:a,nextFrameId:l,session:h,payload:d})}return Object.freeze(n)}},{key:"serializeActionFrame",value:function serializeActionFrame(e,t){var i=new De;if(this.serializeFrameHeader(i,e),i.writeUint8(e.type),i.writeInt53(e.scopeId),i.writeInt53(e.beginObjectId),bh(e)){i.writeUint32(e.methodId);var r=this.rootClassReflection.methodNames[e.methodId],n=this.rootClassReflection.methods[r].parameterFormatObjects;this.serialization.serialize({writer:i,values:e.parameters,objectFormats:n,includesHash:t})}else ma(e)?(i.writeUint8(e.scope),i.writeString(e.event),this.serialization.serialize({writer:i,values:[e.payload],objectFormats:this.oneAnyObjectFormats,includesHash:t})):fa(e)?(i.writeString(e.session),this.serialization.serialize({writer:i,values:[e.userPayload,e.connectedPayload],objectFormats:this.twoAnyObjectFormats,includesHash:t})):ga(e)&&this.serialization.serialize({writer:i,values:[e.payload],objectFormats:this.oneAnyObjectFormats,includesHash:t});return i.toBuffer()}},{key:"deserializeActionFrame",value:function deserializeActionFrame(e,t,i){var r=new Ce(e),n=this.deserializeFrameHeader(r),s=r.readUint8(),o=0,a=0,l;switch(t!==ci.V0&&(o=r.readInt53(),a=r.readInt53()),s){case ke.Invoker:{var h=r.readUint32(),d=this.rootClassReflection.methodNames[h],u=this.rootClassReflection.methods[d].parameterFormatObjects,p=this.serialization.deserialize({reader:r,objectFormats:u,ignoreHashChecking:i,version:t});return t===ci.V0&&(l=r.readBigInt()),di(ii({},n),{type:s,scopeId:o,beginObjectId:a,beginGenerationId:l,methodId:h,parameters:p})}case ke.Event:{var _h3=r.readUint8(),_d2=r.readString(),_this$serialization$d5=this.serialization.deserialize({reader:r,objectFormats:this.oneAnyObjectFormats,ignoreHashChecking:i,version:t}),_this$serialization$d6=_slicedToArray(_this$serialization$d5,1),_u2=_this$serialization$d6[0];return t===ci.V0&&(l=r.readBigInt()),di(ii({},n),{type:s,scopeId:o,beginObjectId:a,beginGenerationId:l,scope:_h3,event:_d2,payload:_u2})}case ke.Ack:return di(ii({},n),{type:s,scopeId:o,beginObjectId:a});case ke.Enter:{var _h4=r.readString(),_this$serialization$d7=this.serialization.deserialize({reader:r,objectFormats:this.twoAnyObjectFormats,ignoreHashChecking:i,version:t}),_this$serialization$d8=_slicedToArray(_this$serialization$d7,2),_d3=_this$serialization$d8[0],_u3=_this$serialization$d8[1];return di(ii({},n),{type:s,scopeId:o,beginObjectId:a,session:_h4,userPayload:_d3,connectedPayload:_u3})}case ke.Leave:{var _this$serialization$d9=this.serialization.deserialize({reader:r,objectFormats:this.oneAnyObjectFormats,ignoreHashChecking:i,version:t}),_this$serialization$d10=_slicedToArray(_this$serialization$d9,1),_h5=_this$serialization$d10[0];return di(ii({},n),{type:s,scopeId:o,beginObjectId:a,payload:_h5})}default:throw new Error("invalid type ".concat(s));}}},{key:"serializeFrameHeader",value:function serializeFrameHeader(e,t){e.writeUint32(t.frameId),e.writeUint32(t.originalFrameId),e.writeInt53(t.timestamp),e.writeUint32(t.authorId)}},{key:"deserializeFrameHeader",value:function deserializeFrameHeader(e){var t=e.readUint32(),i=e.readUint32(),r=e.readInt53(),n=e.readUint32();return{frameId:t,originalFrameId:i,timestamp:r,authorId:n}}}]);return N0}(),vh=Math.pow(2,32),L0=Math.pow(2,16),uA=vh-1,pA=L0-1,ya=1,Yi=4,Sh=8,Cr=5*Yi;function wh(e,t){var i=e.getInt32(t);return e.getInt32(t+Yi)*vh+i}function rf(e){var t=new Ce(e),i=new De;for(var r=0;r<Cr;++r){i.writeUint8(t.readUint8())}return i.writeUint8(ke.Ack),i.toBuffer()}var _t=/*#__PURE__*/function(){function _t(e){_classCallCheck(this,_t);if(e.byteLength<Cr)throw new Error("Buffer is to short");this.frameBuffer=e}_createClass(_t,[{key:"frameId",get:function get(){return this.frameBuffer.getUint32(0)},set:function set(e){this.frameBuffer.setUint32(0,e)}},{key:"originalFrameId",get:function get(){return this.frameBuffer.getUint32(1*Yi)},set:function set(e){this.frameBuffer.setUint32(1*Yi,e)}},{key:"timestamp",get:function get(){return wh(this.frameBuffer,2*Yi)},set:function set(e){var t=e|0,i=(e-t)/vh;this.frameBuffer.setInt32(2*Yi,t),this.frameBuffer.setInt32(3*Yi,i)}},{key:"authorId",get:function get(){return this.frameBuffer.getUint32(4*Yi)},set:function set(e){this.frameBuffer.setUint32(4*Yi,e)}},{key:"type",get:function get(){return this.frameBuffer.getUint8(Cr)}},{key:"scopeId",get:function get(){return wh(this.frameBuffer,Cr+ya)}},{key:"beginObjectId",get:function get(){return wh(this.frameBuffer,Cr+Sh+ya)}},{key:"scope",get:function get(){return this.frameBuffer.getUint8(Cr+2*Sh+ya)}},{key:"bodyBytes",get:function get(){return this.frameBuffer.byteLength-Cr}},{key:"fetchEventContent",value:function fetchEventContent(){var e=new Ce(this.frameBuffer),t=Cr+2*Sh+ya;if(e.skipBytes(t),this.type===ke.Event){var i=e.readUint8();return{event:e.readString(),scope:i}}}}]);return _t}(),Ch=/*#__PURE__*/function(_zn){_inherits(Ch,_zn);var _super10=_createSuper(Ch);function Ch(){_classCallCheck(this,Ch);return _super10.call(this)}_createClass(Ch,[{key:"createObject",value:function createObject(e,t){var i=_get(_getPrototypeOf(Ch.prototype),"createObject",this).call(this,e,t);return Ch.objectsCollection&&Ch.objectsCollection.push(i),i}}],[{key:"startCollection",value:function startCollection(){this.objectsCollection=[]}},{key:"completeCollection",value:function completeCollection(){try{if(!this.objectsCollection)return[];var _iterator41=_createForOfIteratorHelper(this.objectsCollection),_step41;try{for(_iterator41.s();!(_step41=_iterator41.n()).done;){var e=_step41.value;delete e.__identifier}}catch(err){_iterator41.e(err)}finally{_iterator41.f()}return this.objectsCollection}finally{this.objectsCollection=void 0}}}]);return Ch}(zn),_s=Ch;_s.objectsCollection=void 0;function kh(e,t){return new N0(e,t)}var D0=/*#__PURE__*/function(){function D0(){_classCallCheck(this,D0);this.listeners=[]}_createClass(D0,[{key:"currentNode",get:function get(){return this._currentNode}},{key:"addListener",value:function addListener(e){this.listeners.push(e)}},{key:"runWith",value:function runWith(e,t){var i=this._currentNode;this._currentNode=e,this.dispatch(e,!0);try{return t()}finally{this._currentNode=i,this.dispatch(e,!1),i&&this.dispatch(i,!0)}}},{key:"dispatch",value:function dispatch(e,t){var _iterator42=_createForOfIteratorHelper(this.listeners),_step42;try{for(_iterator42.s();!(_step42=_iterator42.n()).done;){var i=_step42.value;try{i(e,t)}catch(r){console.error(r)}}}catch(err){_iterator42.e(err)}finally{_iterator42.f()}}}]);return D0}(),It;(function(e){e[e.SingleForward=0]="SingleForward",e[e.DoubleForward=1]="DoubleForward"})(It||(It={}));var Q=new D0,Be;(function(e){e[e.FlatObject=0]="FlatObject",e[e.AkkoObject=1]="AkkoObject",e[e.Array=2]="Array",e[e.Displayer=3]="Displayer"})(Be||(Be={}));var kr;(function(e){e[e.Uncommitted=0]="Uncommitted",e[e.Committed=1]="Committed",e[e.Rejected=2]="Rejected"})(kr||(kr={}));var he;(function(e){e[e.Illusion=0]="Illusion",e[e.IllusionRebuild=1]="IllusionRebuild",e[e.Real=2]="Real",e[e.RealAck=3]="RealAck",e[e.Outside=4]="Outside"})(he||(he={}));var B0=/*#__PURE__*/function(){function B0(e){_classCallCheck(this,B0);this.operator=e,this.floatObjects={}}_createClass(B0,[{key:"collectValue",value:function collectValue(e){var _this21=this;if(!(_typeof(e)!="object"||e===null)){var t=this.operator.identifier(e);return t in this.floatObjects||(this.floatObjects[t]=e,this.operator.forEach(e,function(i){_this21.collectValue(i)})),t}}}]);return B0}(),nf=function nf(){_classCallCheck(this,nf)};function xh(e){return e instanceof nf}function Ph(e){var t=function t(i,r,n){return n};return Object.setPrototypeOf(t,nf.prototype),Object.defineProperty(t,"payload",{enumerable:!0,configurable:!1,writable:!1,value:e}),t}var Ks=Ph(null),nn=Ph(null),F0=function F0(e){var _this22=this;_classCallCheck(this,F0);this.filters=[],this.filter=function(i,r,n){var _iterator43=_createForOfIteratorHelper(_this22.filters),_step43;try{for(_iterator43.s();!(_step43=_iterator43.n()).done;){var s=_step43.value;if(s(i,r,n))return!0}}catch(err){_iterator43.e(err)}finally{_iterator43.f()}return!1};var t=[];var _iterator44=_createForOfIteratorHelper(e),_step44;try{var _loop2=function _loop2(){var i=_step44.value;var r=void 0;if(typeof i=="function")r=i;else if(typeof i=="string")r=function r(n){return n===i};else if(i instanceof RegExp)r=function r(n){return i.test(n)};else throw new Error("unrecognized condition "+i);t.push(r)};for(_iterator44.s();!(_step44=_iterator44.n()).done;){_loop2()}}catch(err){_iterator44.e(err)}finally{_iterator44.f()}this.filters=Object.freeze(t)},Hn;(function(e){e.System="system",e.App="app",e.Custom="custom",e.Magix="magix"})(Hn||(Hn={}));var Mi;(function(e){e.Dispatched="dispatched",e.Updated="updated",e.Canceled="canceled"})(Mi||(Mi={}));function ba(e,t){return{event:e.event,payload:e.payload,authorId:e.authorId,scope:j0(e.scope),phase:t}}function j0(e){switch(e){case Ve.System:return Hn.System;case Ve.App:return Hn.App;case Ve.Custom:return Hn.Custom;default:return Hn.Magix;}}var sf=function sf(e){_classCallCheck(this,sf);this.eventFilter=new F0(e).filter};function Ih(e){return _typeof(e)=="object"&&e!==null&&e instanceof sf}function of(){for(var _len6=arguments.length,e=new Array(_len6),_key6=0;_key6<_len6;_key6++){e[_key6]=arguments[_key6]}return Ph(new sf(e))}var Ie="__reflection",z0=/*#__PURE__*/function(){function z0(e,t,i,r){_classCallCheck(this,z0);this.isRootClass=t,this.id=i.classId,this.name=i.clazz.name,this.clazz=i.clazz,this.superClass=i.superClass,this.objectFormat=e.findObjectFormat(i.objectFormatId);var n={},s={},o=[i].concat(_toConsumableArray(r));for(var a=o.length-1;a>=0;--a){var l=o[a],h=l.clazz;var _iterator45=_createForOfIteratorHelper(l.members),_step45;try{for(_iterator45.s();!(_step45=_iterator45.n()).done;){var d=_step45.value;Em(d)?n[d.name]=this.createProperty(d,h,this.objectFormat):Am(d)&&(s[d.name]=this.createMethod(d,h,e))}}catch(err){_iterator45.e(err)}finally{_iterator45.f()}}this.properties=Object.freeze(n),this.methods=Object.freeze(s),this.methodNames=Object.freeze(Object.keys(this.methods))}_createClass(z0,[{key:"createProperty",value:function createProperty(e,t,i){var r=e.decorators.some(function(n){return n===Ks});return Object.freeze({name:e.name,mode:e.mode,belongsClass:t,isTransient:r,isPublic:e.isPublic,objectFormat:i.properties[e.name],decorators:e.decorators})}},{key:"createMethod",value:function createMethod(e,t,i){var r=e.name,n=e.parameters,s=e.decorators,o=[];var _iterator46=_createForOfIteratorHelper(n),_step46;try{for(_iterator46.s();!(_step46=_iterator46.n()).done;){var a=_step46.value;o.push(i.findObjectFormat(a))}}catch(err){_iterator46.e(err)}finally{_iterator46.f()}return Object.freeze({name:r,belongsClass:t,isPublic:e.isPublic,parameterFormatObjects:Object.freeze(o),decorators:Object.freeze(_toConsumableArray(s))})}}]);return z0}(),U0=/*#__PURE__*/function(_zn2){_inherits(U0,_zn2);var _super11=_createSuper(U0);function U0(e,t,i,r,n){var _this23;_classCallCheck(this,U0);_this23=_super11.call(this,function(s,o,a,l){return _this23.handleDecorateObject(s,o,a,l)});_this23.decorateObjectEnums=Object.freeze([ie.Object,ie.Array]),_this23.proxyRuntime=e,_this23.idGenerator=i,_this23.covertIdToClass=t,_this23.toOverrideObjects=r,_this23.overrideNodeCatcher=n;return _this23}_createClass(U0,[{key:"createObject",value:function createObject(e,t){if(t===ie.HangUpObject)throw new ut("not support hang up object: ".concat(e));return _get(_getPrototypeOf(U0.prototype),"createObject",this).call(this,e,t)}},{key:"handleDecorateObject",value:function handleDecorateObject(e,t,i,r){var n=e.__identifier,s=this.proxyRuntime.objectOperator,o=this.getClassReflection(t,r),a=this.toOverrideObjects[n];if(!a||!this.isTypeMatch(a,t))switch(t){case ye.Array:{a=s.createObject(this.idGenerator.generate(),[]);break}case ye.DeducedObject:{a=s.createObject(this.idGenerator.generate(),{});break}case ye.AssertedObject:{Object.setPrototypeOf(e,o.clazz.prototype),a=s.createObject(this.idGenerator.generate(),e);break}default:throw new ut("invalid ObjectType ".concat(t));}var _iterator47=_createForOfIteratorHelper(i),_step47;try{for(_iterator47.s();!(_step47=_iterator47.n()).done;){var _step47$value=_step47.value,l=_step47$value.object,h=_step47$value.key;l[h]=a}}catch(err){_iterator47.e(err)}finally{_iterator47.f()}this.overrideNodeCatcher(a,e,o)}},{key:"isTypeMatch",value:function isTypeMatch(e,t){switch(this.proxyRuntime.objectOperator.kind(e)){case Be.Array:return t===ye.Array;case Be.FlatObject:return t===ye.DeducedObject;case Be.AkkoObject:return t===ye.AssertedObject;default:return!1;}}},{key:"getClassReflection",value:function getClassReflection(e,t){if(e===ye.AssertedObject){if(!t)throw new ut("expect object format");var i=this.covertIdToClass(t.id);if(!i)throw new ut("can't find class by object format id ".concat(t.id));return i[Ie]}else return null}}]);return U0}(zn),af=/*#__PURE__*/function(){function af(e){var _this24=this;_classCallCheck(this,af);this.assertObjectFormat=function(i){var r=_this24.proxyRuntime.objectOperator.getClassReflection(i);if(r)return r.objectFormat};var t=new B0(e.proxyRuntime.objectOperator);this.format=e.format,this.snapshotObjectFormats=e.snapshotObjectFormats,this.idGenerator=e.idGenerator,this.proxyRuntime=e.proxyRuntime,this.covertIdToClass=e.covertIdToClass,t.collectValue(e.rootObject),this.floatObjects=t.floatObjects}_createClass(af,[{key:"recoverFrom",value:function recoverFrom(e,t){var i=[],r=new U0(this.proxyRuntime,this.covertIdToClass,this.idGenerator,this.floatObjects,function(l,h,d){return i.push({object:l,tempObject:h,classReflection:d})}),n=new Ii({format:this.format,objectAdapter:r,assertObjectFormat:this.assertObjectFormat}),s=!t,_n$deserialize=n.deserialize({reader:e,objectFormats:this.snapshotObjectFormats,ignoreHashChecking:s,version:af.akkoSerVersion}),_n$deserialize2=_slicedToArray(_n$deserialize,1),o=_n$deserialize2[0],a;for(var _i21=0,_i20=i;_i21<_i20.length;_i21++){var _i20$_i=_i20[_i21],l=_i20$_i.object,h=_i20$_i.tempObject,d=_i20$_i.classReflection;this.proxyRuntime.objectOperator.override(l,h,d),h===o&&(a=l)}return a}}]);return af}(),lf=af;lf.akkoSerVersion=hi(Le);var va,Gs=null,Mh=null;Q.addListener(function(e,t){t&&e.tools?(va=e.coreFunctions,Mh=e.tools.idGenerator,Gs=e.proxyRuntime):(va=null,Mh=null,Gs=null)});var V0=/*#__PURE__*/function(){function V0(e,t){_classCallCheck(this,V0);this.format=t.format,this.covertIdToClass=t.covertObjectFormatIdToClass,this.description=Object.freeze({roomUUID:e,appIdentifier:t.appIdentifier,appVersion:t.appVersion,appHash:t.appHash,akkoVersion:t.akkoVersion})}_createClass(V0,[{key:"createSnapshot",value:function createSnapshot(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;if(!Q.currentNode)throw new Error("can't call createSnapshot out of Magix");var i=va.wrapper(e),r=new De,n=this.readObjectFormatWith(i),s=t;return r.writeUint8(t?255:0),t&&(r.writeString(this.description.roomUUID),r.writeString(this.description.appIdentifier),r.writeString(this.description.appVersion),r.writeString(this.description.appHash),r.writeString(this.description.akkoVersion)),r.writeUint32(n.id),Gs.frameHandler.createSerialization(this.format).serialize({writer:r,values:[i],objectFormats:[n],includesHash:s}),r.toBuffer().freeze()}},{key:"recoverWithSnapshot",value:function recoverWithSnapshot(e,t){if(!Q.currentNode)throw new Error("can't call recoverWithSnapshot out of Magix");var i=va.wrapper(t),r=new Ce(e),n=this.readDescription(r),s=r.readUint32();if(i&&this.readObjectFormatWith(i).id!==s)throw new Error("target's class isn't matching");var o=this.format.findObjectFormat(s),a=this.shouldOverrideTarget(n)?i:void 0;return new lf({rootObject:a,format:this.format,snapshotObjectFormats:[o],idGenerator:Mh,proxyRuntime:Gs,covertIdToClass:this.covertIdToClass}).recoverFrom(r,n!==void 0)}},{key:"readObjectFormatWith",value:function readObjectFormatWith(e){var t=Gs.objectOperator;if(t.kind(e)!==Be.AkkoObject)throw new Error("can't only create snapshot of AkkoObject");return t.getClassReflection(e).objectFormat}},{key:"readDescription",value:function readDescription(e){if(!e.readUint8())return;var t=e.readString(),i=e.readString(),r=e.readString(),n=e.readString(),s=e.readString();if(i!==this.description.appIdentifier)throw new Error("invalid snapshot: appIdentifier not matches");if(r!==this.description.appVersion)throw new Error("invalid snapshot: appVersion not matches");if(n!==this.description.appHash)throw new Error("invalid snapshot: appHash not matches");if(s!==this.description.akkoVersion)throw new Error("invalid snapshot: akkoVersion not matches");return{roomUUID:t,appIdentifier:i,appVersion:r,appHash:n,akkoVersion:s}}},{key:"shouldOverrideTarget",value:function shouldOverrideTarget(e){return e?e.roomUUID===this.description.roomUUID:!0}}]);return V0}();function cf(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";return new V0(t,e)}var Sa;Q.addListener(function(e,t){t&&e.tools?Sa=e.tools.extra:Sa=void 0});function hf(){if(!Sa)throw new Error("you can not call this function out of Magix");return Sa.resource}var Mt;(function(e){e.Real="real",e.Illusion="illusion",e.NoEffects="noEffects"})(Mt||(Mt={}));var W0=/*#__PURE__*/function(){function W0(e){_classCallCheck(this,W0);this.atob=e}_createClass(W0,[{key:"parse",value:function parse(e){var t=new String(this.atob(e)),i=Ct(t.length);for(var r=0;r<t.length;++r){i.setUint8(r,t.charCodeAt(r))}return i}}]);return W0}();function $s(e){var t={};var _loop3=function _loop3(i){var r=e[i];typeof r=="function"?t[i]=function(){var s;try{for(var _len7=arguments.length,n=new Array(_len7),_key7=0;_key7<_len7;_key7++){n[_key7]=arguments[_key7]}s=r.apply(t,n)}catch(o){console.error(o)}return s}:t[i]=r};for(var i in e){_loop3(i)}return Object.freeze(t)}var Xi="__identifier";function _n(e,t){Object.defineProperty(e,Xi,{enumerable:!1,configurable:!0,value:t})}var uf=/*#__PURE__*/function(){function uf(e,t){_classCallCheck(this,uf);this.foundObjects=[],this.idGenerator=e,this.operator=t}_createClass(uf,[{key:"complete",value:function complete(){var _iterator48=_createForOfIteratorHelper(this.foundObjects),_step48;try{for(_iterator48.s();!(_step48=_iterator48.n()).done;){var e=_step48.value;delete e[Xi]}}catch(err){_iterator48.e(err)}finally{_iterator48.f()}}},{key:"bind",value:function bind(e){if(_typeof(e)!="object"||e===null||we(e))return e;{var t=e;if(this.operator.isDisplayerObject(t)&&(t=this.operator.copyDisplayer(t)),t.constructor===Array)return this.bindArray(t);if(t.constructor===Object)return this.bindObject(t)}throw new Error("can't let object of ".concat(e.constructor.name," pass Magix border"))}},{key:"bindArray",value:function bindArray(e){var t=e[Xi];t===void 0&&(t=this.idGenerator.generate(),_n(e,t),this.foundObjects.push(e));for(var i=0;i<e.length;++i){this.bind(e[i])}}},{key:"bindObject",value:function bindObject(e){var t=e[Xi];t===void 0&&(t=this.idGenerator.generate(),_n(e,t),this.foundObjects.push(e));for(var i in e){this.bind(e[i])}}}]);return uf}(),pf=/*#__PURE__*/function(){function pf(e,t,i){_classCallCheck(this,pf);this.nodes={},this.idGenerator=e,this.operator=t,this.adapter=i}_createClass(pf,[{key:"bind",value:function bind(e,t){var i=null,r=this.bindValue(e,t),n=this.findIdentifier(r);if(n!==void 0){var _this$nodes$n=this.nodes[n],s=_this$nodes$n.wrapped,o=_this$nodes$n.copied;i={wrapped:s,copied:o}}return{value:r,binder:i}}},{key:"completeBinding",value:function completeBinding(){for(var e in this.nodes){var t=this.nodes[e].binded;delete t[Xi]}}},{key:"bindValue",value:function bindValue(e,t){if(_typeof(e)!="object"||e===null)return e;if(we(e))return e.readonly?e:e.slice();{var i=e;if(this.operator.isDisplayerObject(i)&&(i=this.operator.copyDisplayer(i)),i.constructor===Array)return this.bindArray(i,t);if(i.constructor===Object)return this.bindObject(i,t)}throw new Error("can't let object of ".concat(e.constructor.name," pass Magix border"))}},{key:"bindArray",value:function bindArray(e,t){var i=e[Xi];if(i===void 0){i=this.idGenerator.generate();var r=this.adapter.createObject(i,ie.Array),n=[];_n(e,i),_n(n,i),this.nodes[i]={identifier:i,binded:e,copied:n,wrapped:r};for(var s=0;s<e.length;++s){var o=this.bindValue(e[s],t.index),a=this.findIdentifier(o);if(a===void 0)this.adapter.setValue(r,s,o),n[s]=o;else{var _this$nodes$a=this.nodes[a],l=_this$nodes$a.copied,h=_this$nodes$a.wrapped;this.adapter.setValue(r,s,h),n[s]=l}}}return e}},{key:"bindObject",value:function bindObject(e,t){var i=e[Xi];if(i===void 0){i=this.idGenerator.generate();var r={},n=this.adapter.createObject(i,ie.Object),s=[],o=[];_n(e,i),_n(r,i),this.nodes[i]={identifier:i,binded:e,copied:r,wrapped:n};for(var a in t.properties){a in e&&(s.push(a),o.push(t.properties[a]))}for(var _a8 in e){_a8!==Xi&&!(_a8 in t.properties)&&(s.push(_a8),o.push(t.key))}for(var _a9=0;_a9<s.length;++_a9){var l=s[_a9],h=o[_a9],d=this.bindValue(e[l],h),u=this.findIdentifier(d);if(u===void 0)this.adapter.setValue(n,l,d),r[l]=d;else{var _this$nodes$u=this.nodes[u],p=_this$nodes$u.copied,f=_this$nodes$u.wrapped;this.adapter.setValue(n,l,f),r[l]=p}}}return e}},{key:"findIdentifier",value:function findIdentifier(e){if(_typeof(e)=="object"&&e!==null)return e[Xi]}}]);return pf}(),Kn=/*#__PURE__*/function(){function Kn(e){_classCallCheck(this,Kn);this._phase=e.phase||e.getCurrentPhase(),this.getCurrentPhase=e.getCurrentPhase,this.onPhaseChanged=e.onPhaseChanged}_createClass(Kn,[{key:"phase",get:function get(){return this._phase}},{key:"touch",value:function touch(){var e=this.getCurrentPhase(),t=this._phase;t!==e&&(this._phase=e,this.onPhaseChanged&&this.onPhaseChanged(e,t))}}]);return Kn}(),H0=/*#__PURE__*/function(){function H0(e,t){_classCallCheck(this,H0);this.paddingInvokers=null,this.logger=e,this.callbacks=ii({},t)}_createClass(H0,[{key:"hasKey",value:function hasKey(e){return e in this.callbacks}},{key:"callback",value:function callback(e,t){var i=this.callbacks[e];if(i)if(this.paddingInvokers)this.paddingInvokers.push({key:e,payload:t});else try{i(t)}catch(r){this.logger.error(r)}}},{key:"isPadding",get:function get(){return!!this.paddingInvokers},set:function set(e){if(this.isPadding!==e)if(e)this.paddingInvokers=[];else{var _iterator49=_createForOfIteratorHelper(this.paddingInvokers),_step49;try{for(_iterator49.s();!(_step49=_iterator49.n()).done;){var _step49$value=_step49.value,t=_step49$value.key,i=_step49$value.payload;try{this.callbacks[t](i)}catch(r){this.logger.error(r)}}}catch(err){_iterator49.e(err)}finally{_iterator49.f()}this.paddingInvokers=null}}}]);return H0}(),_0=/*#__PURE__*/function(){function _0(e){_classCallCheck(this,_0);this.base64Parser=new W0(e)}_createClass(_0,[{key:"create",value:function create(e){if(!this.isSupportedAkkoVersion(e.akkoVersion))throw new xi("can not support library (built by akko ".concat(e.akkoVersion,")"));var t=this.createFormat(e.formatBase64),i=this.createClassReflections(t,e.rootConstructor,e.classDeclarations),r=this.createObjectFormatToClassMap(i),n=function n(s){return r[s]};return new Th(e.appIdentifier,e.appVersion,e.formatHash,e.akkoVersion,e.rootConstructor,n,t,i)}},{key:"isSupportedAkkoVersion",value:function isSupportedAkkoVersion(e){var t=Le.split("."),i=e.split(".");return i.length<2||t[0]!==i[0]||t[1]!==i[1]?!1:t.length>=3?t[2]>=i[2]:!0}},{key:"createFormat",value:function createFormat(e){var t=new $m,i=this.base64Parser.parse(e);return t.createWithBuffer(i)}},{key:"createClassReflections",value:function createClassReflections(e,t,i){var r={};for(var n in i){var s=i[n],o=s.clazz,a=o===t,_this$searchThisAndSu=this.searchThisAndSuperClassDeclarations(s,i),_this$searchThisAndSu2=_toArray(_this$searchThisAndSu),l=_this$searchThisAndSu2[0],h=_this$searchThisAndSu2.slice(1),d=new z0(e,a,l,h);if(Object.getOwnPropertyDescriptor(o,Ie)!==void 0)throw new xi("class ".concat(o.name," has defined  reserved word static property \"").concat(Ie));Object.defineProperty(o,Ie,{value:d,writable:!1,configurable:!1}),r[n]=d}return Object.freeze(r)}},{key:"createObjectFormatToClassMap",value:function createObjectFormatToClassMap(e){var t={};for(var i in e){var r=e[i],n=r.objectFormat.id;t[n]=r.clazz}return Object.freeze(t)}},{key:"searchThisAndSuperClassDeclarations",value:function searchThisAndSuperClassDeclarations(e,t){var i=[],r=e;for(;i.push(r),!(!r.superClass||r.superClass===Object);){r=this.findClassDeclarationsWithConstructor(r.superClass,t)}return i}},{key:"findClassDeclarationsWithConstructor",value:function findClassDeclarationsWithConstructor(e,t){for(var i in t){var r=t[i];if(r.clazz===e)return r}throw new xi("can not find superClass")}}]);return _0}(),Th=/*#__PURE__*/function(){function Th(e,t,i,r,n,s,o,a){_classCallCheck(this,Th);this.appIdentifier=e,this.appVersion=t,this.appHash=i,this.akkoVersion=r,this.rootClass=n,this.covertObjectFormatIdToClass=s,this.format=o,this.classReflections=a}_createClass(Th,[{key:"classReflection",value:function classReflection(e){var t=this.classReflections[e];if(!t)throw new Error("can't find class with id ".concat(e));return t}}]);return Th}(),mf,ff,gf,yf,bf,vf,Sf,wf,Cf,kf,xf;function K0(){return{creator:function creator(e){return e},updater:function updater(e){return e},wrapper:function wrapper(e){return e},unwrapper:function unwrapper(e){return e},jsxUnwrapper:function jsxUnwrapper(e){return e},getter:function getter(e,t){return e[t]},setter:function setter(e,t,i){return e[t]=i},caller:function caller(e,t,i,r){return(r||e)[t].apply(e,i)},remover:function remover(e,t){return delete e[t]},prefix:function prefix(e,t,i){return e[t]+=i},postfix:function postfix(e,t,i){var r=e[t];return e[t]+=i,r}}}function G0(){return{creator:function creator(e){return mf(e)},updater:function updater(e){return ff(e)},wrapper:function wrapper(e){return gf(e)},unwrapper:function unwrapper(e){return yf(e)},jsxUnwrapper:function jsxUnwrapper(e){return bf(e)},getter:function getter(e,t){return vf(e,t)},setter:function setter(e,t,i){return Sf(e,t,i)},caller:function caller(e,t,i,r){return wf(e,t,i,r)},remover:function remover(e,t){return Cf(e,t)},prefix:function prefix(e,t,i){return kf(e,t,i)},postfix:function postfix(e,t,i){return xf(e,t,i)}}}function Pf(e){mf=e.creator,ff=e.updater,gf=e.wrapper,yf=e.unwrapper,bf=e.jsxUnwrapper,vf=e.getter,Sf=e.setter,wf=e.caller,Cf=e.remover,kf=e.prefix,xf=e.postfix}var If=Object.freeze(K0());Pf(If);Q.addListener(function(e,t){Pf(t?e.coreFunctions:If)});var wa;Q.addListener(function(e,t){t?wa=e.coreFunctions.creator:wa=void 0});function Ca(){if(!wa){var e=this.constructor&&this.constructor.name;throw e?new Error("can't construct ".concat(e," out of Magix, it's an AkkoObject")):new Error("can't construct an AkkoObject out of Magix")}wa(this)}Object.setPrototypeOf(Ca.prototype,Object.prototype);var ka;Q.addListener(function(e,t){t?ka=e.proxyRuntime.objectOperator:ka=void 0});var xa=$0();function $0(){var e=new _0(df["default"].bind(null));return new Tm({akkoVersion:Le,akkoObjectBaseClass:Ca,libraryFactory:e.create.bind(e),coreFunctions:G0()})}var Mf=xa.context,Pa=xa.getLibrary;function Tf(e){if(!ka)throw new Error("can't call isAkkoObject out of Magix");return ka.isValidObject(e)||xa.isAkkoObject(e)}function Qi(e){if(typeof e=="function"){var t=e[Ie];if(_typeof(t)=="object"&&t!==null)return t}else if(xa.isAkkoObject(e))return Qi(e.constructor)}var We;Q.addListener(function(e,t){t&&e.tools?We=e.tools:We=void 0});function Ef(){if(!We)throw xr();return We.environment}function Af(){if(!We)throw xr();return We.timestamp}function Of(){if(!We)throw xr();return We.functions.getAuthorId()}function Rf(e){if(!We)throw xr();return We.functions.hasUser(e)}function Nf(){if(!We)throw xr();return We.functions.getUsersCount()}function Lf(e){if(!We)throw xr();return We.functions.getUser(e)}function Df(){if(!We)throw xr();return We.functions.getUserIds()}function Bf(){if(!We)throw xr();return We.snapshot}function xr(){return new Error("you can not call this function out of Magix")}var qi;(function(e){e.RoomDelete="roomDelete",e.RoomZombie="roomZombie",e.RoomBan="roomBan",e.GatewayAdjust="GatewayAdjust",e.KickByAdmin="kickByAdmin",e.ReplaceByOther="replaceByOther",e.Crash="crash",e.Isolate="isolate"})(qi||(qi={}));var B;(function(e){e[e.Inserted=0]="Inserted",e[e.Updated=1]="Updated",e[e.Removed=2]="Removed"})(B||(B={}));function Ff(e){var t=new Ce(e),i=t.readUint32(),r=[],n=t.readUint32();for(var s=0;s<n;++s){var o=t.readInt53(),a=t.readUint32();r.push(Object.freeze({beginScopeId:o,count:a}))}return Object.freeze({userId:i,initializeSlices:Object.freeze(r)})}var Zi;(function(e){e[e.Readonly=0]="Readonly",e[e.Writable=1]="Writable"})(Zi||(Zi={}));var Eh=/*#__PURE__*/function(){function Eh(e,t){_classCallCheck(this,Eh);var i=t.format.anyObjectFormat;this.serialization=new Ii({format:t.format,objectAdapter:new _s}),this.objectOperator=e,this.oneAnyObjectFormats=Object.freeze([i]),this.twoAnyObjectFormats=Object.freeze([i,i])}_createClass(Eh,[{key:"serialize",value:function serialize(e){var t=new De,i=li(wr),r=new uf(i,this.objectOperator);t.writeUint8(e.kind);try{switch(e.kind){case Zi.Writable:{var n=e.userPayload,s=e.connectedPayload;r.bind(n),r.bind(s),this.serialization.serialize({writer:t,values:[n,s],objectFormats:this.twoAnyObjectFormats,includesHash:!1});break}case Zi.Readonly:{var _n9=e.payload;r.bind(_n9),this.serialization.serialize({writer:t,values:[_n9],objectFormats:this.oneAnyObjectFormats,includesHash:!1});break}}return t.toBuffer()}finally{r.complete()}}},{key:"deserialize",value:function deserialize(e){try{_s.startCollection();var t=new Ce(e),i=t.readUint8();switch(i){case Zi.Writable:{var _this$serialization$d11=this.serialization.deserialize({reader:t,objectFormats:this.twoAnyObjectFormats,ignoreHashChecking:!0,version:Eh.akkoSerVersion}),_this$serialization$d12=_slicedToArray(_this$serialization$d11,2),r=_this$serialization$d12[0],n=_this$serialization$d12[1];return{kind:i,userPayload:r,connectedPayload:n}}case Zi.Readonly:{var _this$serialization$d13=this.serialization.deserialize({reader:t,objectFormats:this.oneAnyObjectFormats,ignoreHashChecking:!0,version:Eh.akkoSerVersion}),_this$serialization$d14=_slicedToArray(_this$serialization$d13,1),_r14=_this$serialization$d14[0];return{kind:i,payload:_r14}}default:throw new Error("invalid kind ".concat(i));}}finally{_s.completeCollection()}}}]);return Eh}(),Ia=Eh;Ia.akkoSerVersion=hi(Le);var jf=/*#__PURE__*/function(){function jf(){_classCallCheck(this,jf)}_createClass(jf,[{key:"serialize",value:function serialize(e){var t=new De;return t.writeString(e.libIdentifier),t.writeString(e.appIdentifier),t.writeString(e.appVersion),t.writeString(e.appHash),t.toBuffer()}},{key:"deserialize",value:function deserialize(e){var t=new Ce(e),i=t.readString(),r=t.readString(),n=t.readString(),s=t.readString();return{libIdentifier:i,appIdentifier:r,appVersion:n,appHash:s}}}]);return jf}();function zf(e){var t=new Ce(e),i=t.readString(),r=t.readString(),n=t.readString();return Object.freeze({session:i,sessionToken:r,slice:n})}function Uf(e){return Y0(e)}function Vf(e){return X0(e)}function Y0(e){var t=new De;return t.writeUint32(e.id),t.writeInt53(e.timestamp),t.toBuffer()}function X0(e){var t=new Ce(e),i=t.readUint32(),r=t.readInt53();return Object.freeze({id:i,timestamp:r})}var Wf=/*#__PURE__*/function(){function Wf(e){_classCallCheck(this,Wf);if(this.storageSlices=[],this.usingSlice=void 0,this.nextScopeId=0,e){var _iterator50=_createForOfIteratorHelper(e),_step50;try{for(_iterator50.s();!(_step50=_iterator50.n()).done;){var t=_step50.value;this.appendScopeSlice(t)}}catch(err){_iterator50.e(err)}finally{_iterator50.f()}}}_createClass(Wf,[{key:"allocScopeId",value:function allocScopeId(){if(this.usingSlice){var e=this.nextScopeId;return e===this.usingSlice.beginScopeId+this.usingSlice.count-1?(this.usingSlice=this.storageSlices.shift(),this.usingSlice&&(this.nextScopeId=this.usingSlice.beginScopeId)):this.nextScopeId+=1,e}else return}},{key:"appendScopeSlice",value:function appendScopeSlice(e){this.usingSlice?this.storageSlices.push(e):(this.usingSlice=e,this.nextScopeId=e.beginScopeId)}}]);return Wf}();function Hf(e){var t=new Ce(e),i=[],r=t.readUint32();for(var n=0;n<r;++n){var s=t.readInt53(),o=t.readUint32();i.push(Object.freeze({beginScopeId:s,count:o}))}return Object.freeze(i)}var Ma=new yh(["error","snapshot","action","chunk","session-build","update-online","allocate-user","release-user","allocate-scope","update-access","ban-access","hang-up","library-description","ping","pong","reset-frame-id","ack-reset-frame-id","action-newline","allocate-user-ids","user-ids","allocate-snapshot","watch-action","action-result","isolate-room","action-ack"]),mt;(function(e){e[e.Undefined=0]="Undefined",e[e.NoUserToRelease=1]="NoUserToRelease",e[e.WritableAccessForbidden=2]="WritableAccessForbidden",e[e.StuffedOfWritableUsers=3]="StuffedOfWritableUsers",e[e.WrongWritablePhase=4]="WrongWritablePhase"})(mt||(mt={}));var _f=/*#__PURE__*/function(){function _f(e,t,i){_classCallCheck(this,_f);this.nextFrameId=0,this.userId=e,this.scopeStorage=t,this.nextFrameId=i}_createClass(_f,[{key:"createFrameId",value:function createFrameId(){var e=this.nextFrameId;return this.nextFrameId+=1,e}},{key:"appendScopeSlices",value:function appendScopeSlices(e){var _iterator51=_createForOfIteratorHelper(e),_step51;try{for(_iterator51.s();!(_step51=_iterator51.n()).done;){var t=_step51.value;this.scopeStorage.appendScopeSlice(t)}}catch(err){_iterator51.e(err)}finally{_iterator51.f()}}},{key:"allocateIdentifierGenerator",value:function allocateIdentifierGenerator(){var e=this.scopeStorage.allocScopeId();if(e===void 0)throw new xi("run out of scope ID");return li(e)}}]);return _f}(),Kf=/*#__PURE__*/function(){function Kf(e,t){_classCallCheck(this,Kf);if(this.users={},this._usersCount=0,this.paddingImageCreatingTask=null,this.proxyRuntime=e,t){var _iterator52=_createForOfIteratorHelper(t),_step52;try{for(_iterator52.s();!(_step52=_iterator52.n()).done;){var i=_step52.value;this.users[i.userId]={userId:i.userId,nextFrameId:i.nextFrameId,session:i.session,payload:i.payload},this._usersCount+=1}}catch(err){_iterator52.e(err)}finally{_iterator52.f()}}else this.users[ce]={userId:ce,nextFrameId:0,session:"",payload:void 0},this._usersCount+=1}_createClass(Kf,[{key:"hasUser",value:function hasUser(e){return e in this.users}},{key:"userIds",get:function get(){var e=[];for(var t in this.users){e.push(parseInt(t,10))}return e.sort()}},{key:"usersCount",get:function get(){return this._usersCount}},{key:"user",value:function user(e,t){var i=this.users[e];if(i){var r=i.payload;return t||(r=this.proxyRuntime.objectOperator.wrapDisplayer(this.proxyRuntime,r)),{userId:e,session:i.session,payload:r}}else return}},{key:"snapshotUsers",value:function snapshotUsers(){var e=[];var _iterator53=_createForOfIteratorHelper(this.userIds),_step53;try{for(_iterator53.s();!(_step53=_iterator53.n()).done;){var t=_step53.value;var i=this.users[t];e.push({userId:t,nextFrameId:i.nextFrameId,session:i.session,payload:i.payload})}}catch(err){_iterator53.e(err)}finally{_iterator53.f()}return e}},{key:"createImageAuthor",value:function createImageAuthor(e,t){var _this25=this;var i=e.userId,r=this.users[i];if(r){var n=new Wf(e.initializeSlices),s=new _f(e.userId,n,r.nextFrameId);try{t(s)}catch(o){console.error(o)}return Promise.resolve()}else return new Promise(function(n){_this25.paddingImageCreatingTask={allocatedUser:e,complete:function complete(s){n(),s&&t(s)}}})}},{key:"cancelImageAuthorCreating",value:function cancelImageAuthorCreating(){this.paddingImageCreatingTask&&(this.paddingImageCreatingTask.complete(null),this.paddingImageCreatingTask=null)}},{key:"updateUserNextFrameId",value:function updateUserNextFrameId(e,t){var i=this.users[e];i&&(i.nextFrameId=t)}},{key:"userEnter",value:function userEnter(e,t,i,r){var _this26=this;e in this.users||(this._usersCount+=1),this.users[e]={userId:e,nextFrameId:t,session:i,payload:r},this.proxyRuntime.observeUpdate(function(){if(_this26.paddingImageCreatingTask){var _this26$paddingImageC=_this26.paddingImageCreatingTask.allocatedUser,n=_this26$paddingImageC.userId,s=_this26$paddingImageC.initializeSlices;if(n===e){var o=new Wf(s),a=new _f(e,o,t);_this26.paddingImageCreatingTask.complete(a),_this26.paddingImageCreatingTask=null}}_this26.proxyRuntime.reportUsersChanged(_this26._usersCount)})}},{key:"userLeave",value:function userLeave(e){e in this.users&&(this._usersCount-=1,delete this.users[e]),this.proxyRuntime.reportUsersChanged(this._usersCount)}}]);return Kf}(),Ah=/*#__PURE__*/function(){function Ah(e){_classCallCheck(this,Ah);this.didCompleteInit=!1,this.proxyRuntime=e.proxyRuntime,this.imageUsers=e.imageUsers,this.onEventFire=e.onEventFire,this.onEventFireACK=e.onEventFireACK,this.onCatchErrorWhenAppendFrame=e.onCatchErrorWhenAppendFrame;var t=Qi(e.library.rootClass),i=[],r={},n={};for(var s in t.methods){var o=t.methods[s],a=Ah.findEventPayloadWithDecorators(o.decorators);a&&i.push(Object.freeze({filter:a.eventFilter,method:s})),n[s]=Ah.findNoEffectsWithDecorators(o.decorators)}for(var _s7=0;_s7<t.methodNames.length;++_s7){r[t.methodNames[_s7]]=_s7}this.methodNames=t.methodNames,this.methodNameToIdMap=Object.freeze(r),this.eventHandlers=Object.freeze(i),this.noEffectsMethods=Object.freeze(n)}_createClass(Ah,[{key:"completeInit",value:function completeInit(){this.didCompleteInit=!0}},{key:"methodNameToId",value:function methodNameToId(e){return this.methodNameToIdMap[e]}},{key:"isNoEffectMethod",value:function isNoEffectMethod(e){return this.noEffectsMethods[e]}},{key:"dispatch",value:function dispatch(e,t){var i=this.proxyRuntime.rootObject.target,r=Ve.Custom;var _iterator54=_createForOfIteratorHelper(this.eventHandlers),_step54;try{for(_iterator54.s();!(_step54=_iterator54.n()).done;){var _step54$value=_step54.value,n=_step54$value.filter,s=_step54$value.method;n(e,t,r)&&this.proxyRuntime.rootObject.getRootMethod(s).apply(i,[e,t,r])}}catch(err){_iterator54.e(err)}finally{_iterator54.f()}}},{key:"invoke",value:function invoke(e,t){var i=this.proxyRuntime.rootObject.target;return this.proxyRuntime.rootObject.getRootMethod(e).apply(i,t)}},{key:"appendAction",value:function appendAction(e,t,i){var _this27=this;(t.mode===he.Real||t.mode===he.RealAck)&&this.imageUsers.updateUserNextFrameId(e.authorId,e.originalFrameId+1);var r=!this.isForcesOnIllusionLine(t.mode);try{var n;return this.proxyRuntime.block.runWithMagix(t,function(){bh(e)?n=_this27.invokeActionFrame(e):ma(e)?_this27.handleEventActionFrame(e):fa(e)?_this27.handleEnterActionFrame(e):ga(e)&&_this27.handleLeaveActionFrame(e)}),n}catch(n){try{this.onCatchErrorWhenAppendFrame&&this.onCatchErrorWhenAppendFrame(e.authorId,n),i&&i(n)}catch(s){console.error(s)}return}finally{r&&(this.frameId=e.frameId,this.timestamp=e.timestamp)}}},{key:"callbackEventIfNeed",value:function callbackEventIfNeed(e){if(this.didCompleteInit)if(ma(e)){var t=this.proxyRuntime.rootObject.observerId;e.authorId===t?this.onEventFireACK({event:e.event,payload:this.proxyRuntime.objectOperator.copyDisplayer(e.payload),scope:e.scope,authorId:e.authorId}):this.onEventFire({event:e.event,payload:this.proxyRuntime.objectOperator.copyDisplayer(e.payload),scope:e.scope,authorId:e.authorId})}else fa(e)?this.onEventFire({event:"Enter",payload:this.proxyRuntime.objectOperator.copyDisplayer(e.connectedPayload),scope:Ve.System,authorId:e.authorId}):ga(e)&&this.onEventFire({event:"Leave",payload:this.proxyRuntime.objectOperator.copyDisplayer(e.payload),scope:Ve.System,authorId:e.authorId})}},{key:"invokeActionFrame",value:function invokeActionFrame(_ref14){var e=_ref14.methodId,t=_ref14.parameters;var i=this.proxyRuntime.rootObject.target,r=this.methodNames[e];return this.proxyRuntime.rootObject.getRootMethod(r).apply(i,t)}},{key:"handleEventActionFrame",value:function handleEventActionFrame(e){if(e.beginGenerationId!==void 0&&e.scope===Ve.System)switch(e.event){case"Enter":{var t=e.authorId,i=e.originalFrameId+1,r="",n;this.imageUsers.userEnter(t,i,r,n);break}case"Leave":{this.imageUsers.userLeave(e.authorId);break}}this.invokeEventCallbacks(e.event,e.payload,e.scope)}},{key:"handleEnterActionFrame",value:function handleEnterActionFrame(e){var t=e.authorId,i=e.originalFrameId+1,r=e.session,n=e.userPayload;this.imageUsers.userEnter(t,i,r,n),this.invokeEventCallbacks("Enter",e.connectedPayload,Ve.System)}},{key:"handleLeaveActionFrame",value:function handleLeaveActionFrame(_ref15){var e=_ref15.authorId,t=_ref15.payload;this.imageUsers.userLeave(e),this.invokeEventCallbacks("Leave",t,Ve.System)}},{key:"invokeEventCallbacks",value:function invokeEventCallbacks(e,t,i){var r=this.proxyRuntime.rootObject.target;var _iterator55=_createForOfIteratorHelper(this.eventHandlers),_step55;try{for(_iterator55.s();!(_step55=_iterator55.n()).done;){var _step55$value=_step55.value,n=_step55$value.filter,s=_step55$value.method;n(e,t,i)&&this.proxyRuntime.rootObject.getRootMethod(s).apply(r,[e,t,i])}}catch(err){_iterator55.e(err)}finally{_iterator55.f()}}},{key:"isForcesOnIllusionLine",value:function isForcesOnIllusionLine(e){switch(e){case he.Real:case he.RealAck:return!1;case he.Illusion:case he.IllusionRebuild:return!0;case he.Outside:return this.proxyRuntime.hasDoubleLines&&this.proxyRuntime.hasBranch;default:throw new Error("invalid mode ".concat(e));}}}],[{key:"findEventPayloadWithDecorators",value:function findEventPayloadWithDecorators(e){var _iterator56=_createForOfIteratorHelper(e),_step56;try{for(_iterator56.s();!(_step56=_iterator56.n()).done;){var t=_step56.value;if(xh(t)&&Ih(t.payload))return t.payload}}catch(err){_iterator56.e(err)}finally{_iterator56.f()}}},{key:"findNoEffectsWithDecorators",value:function findNoEffectsWithDecorators(e){var _iterator57=_createForOfIteratorHelper(e),_step57;try{for(_iterator57.s();!(_step57=_iterator57.n()).done;){var t=_step57.value;if(t===nn)return!0}}catch(err){_iterator57.e(err)}finally{_iterator57.f()}return!1}}]);return Ah}(),Oh=/*#__PURE__*/function(){function Oh(e,t,i){_classCallCheck(this,Oh);this.observerId=e,this.logger=t,this.onLengthChanged=i,this.queue=[]}_createClass(Oh,[{key:"length",get:function get(){return this.queue.length}},{key:"pushIllusionActionFrameGetter",value:function pushIllusionActionFrameGetter(e){this.queue.push(e),this.onLengthChanged(this.queue.length)}},{key:"forFrames",value:function forFrames(e){var _iterator58=_createForOfIteratorHelper(this.queue),_step58;try{for(_iterator58.s();!(_step58=_iterator58.n()).done;){var t=_step58.value;e(t)}}catch(err){_iterator58.e(err)}finally{_iterator58.f()}}},{key:"replaceActionFrame",value:function replaceActionFrame(e){var t=this.isAckFrame(e),i,r,n;if(t){var s=this.takeIllusionFrame(e.frameId,e.originalFrameId),o=new _t(s.get());i=Date.now()-s.timestamp,o.frameId=e.frameId,o.originalFrameId=e.originalFrameId,o.timestamp=e.timestamp,r=o.frameBuffer,n=s.section}else{if(e.type===ke.Ack)throw new Error("received others' ACK frame");r=e.frameBuffer}return{replacedBuffer:r,isAck:t,rttTimeInterval:i,section:n}}},{key:"takeIllusionFrame",value:function takeIllusionFrame(e,t){var i=this.queue.findIndex(function(n){return n.frameId===t});if(i>0&&this.logger.warn("received frame can't touch first illusion frame"),i===-1)throw new Error("not found frameId ".concat(t," match to ACK frameId"));var r=this.queue.splice(i,1)[0];return this.onLengthChanged(this.queue.length),r}},{key:"isAckFrame",value:function isAckFrame(e){switch(e.type){case ke.Ack:case ke.Invoker:return e.authorId===this.observerId;case ke.Event:{if(e.scope===Ve.Custom)return e.authorId===this.observerId;break}default:break;}return!1}}]);return Oh}();function Gn(e){return e.beginGenerationId===void 0?li(e.scopeId,e.beginObjectId):zm(e.authorId,e.beginGenerationId)}var Q0=/*#__PURE__*/function(){function Q0(e,t,i,r,n,s,o){_classCallCheck(this,Q0);this.logger=e,this.strategy=t,this.proxyRuntime=i,this.triggerInvoker=r,this.assertAppendFrameId=n,this.onReceivedRttReport=s,this.onIllusionQueueLengthChanged=o,this.observerId=null,this._illusionQueue=null}_createClass(Q0,[{key:"illusionQueue",get:function get(){return this._illusionQueue}},{key:"waitUtilIllusionQueueEmpty",value:function waitUtilIllusionQueueEmpty(){var _this28=this;return this._illusionQueue.length===0?Promise.resolve():new Promise(function(e){_this28.onIllusionQueueEmpty=e})}},{key:"setObserverId",value:function setObserverId(e){if(this._illusionQueue)throw new Error("did set observer ID");this.observerId=e,this._illusionQueue=new Oh(e,this.logger,this.onIllusionQueueLengthChanged)}},{key:"cleanObserverId",value:function cleanObserverId(){var e=this._illusionQueue;this.observerId=null,this._illusionQueue=null,this.onIllusionQueueLengthChanged(e.length)}},{key:"appendActionFramesWithDoubleMode",value:function appendActionFramesWithDoubleMode(e,t){var _this29=this;var i;var _loop4=function _loop4(r){var n=e[r],s=_this29.proxyRuntime.frameHandler.deserializeActionFrame(n,_this29.strategy.deserializerVersion,_this29.strategy.ignoreHashChecking,{mode:he.Real}),o=Gn(s);_this29.assertAppendFrameId(s);var a=t&&function(h){return t(h,r)},l={authorId:s.authorId,mode:he.Real,timestamp:s.timestamp,identifierGenerator:o};i=_this29.triggerInvoker.appendAction(s,l,a),_this29.triggerInvoker.callbackEventIfNeed(s)};for(var r=0;r<e.length;++r){_loop4(r)}return i}},{key:"appendActionFrames",value:function appendActionFrames(e,t){var _this30=this;var i=[],r=[],n=!1,s=!1;for(var a=0;a<e.length;++a){var l=new _t(e[a]),h=this._illusionQueue.replaceActionFrame(l);h.isAck||(n=!0),!s&&l.type===ke.Leave&&l.authorId===this.observerId&&(s=!0);var d={index:a,frameBuffer:h.replacedBuffer,frameSection:h.section};n?r.push(d):i.push(d),h.rttTimeInterval!==void 0&&this.onReceivedRttReport(h.rttTimeInterval)}this.proxyRuntime.block.runWithDisableObserve(function(){var _iterator59=_createForOfIteratorHelper(i),_step59;try{var _loop5=function _loop5(){var _step59$value=_step59.value,a=_step59$value.index,l=_step59$value.frameBuffer,h=_step59$value.frameSection;var d=_this30.proxyRuntime.frameHandler.deserializeActionFrame(l,_this30.strategy.deserializerVersion,_this30.strategy.ignoreHashChecking,{mode:he.RealAck,frameSection:h}),u=Gn(d);_this30.assertAppendFrameId(d);var p=t&&function(m){return t(m,a)},f={authorId:d.authorId,mode:he.RealAck,timestamp:d.timestamp,frameSection:h,identifierGenerator:u};_this30.triggerInvoker.appendAction(d,f,p),_this30.triggerInvoker.callbackEventIfNeed(d),h.completeACK()};for(_iterator59.s();!(_step59=_iterator59.n()).done;){_loop5()}}catch(err){_iterator59.e(err)}finally{_iterator59.f()}});var o;if(r.length>0){this.proxyRuntime.mergeBranch();var _iterator60=_createForOfIteratorHelper(r),_step60;try{var _loop6=function _loop6(){var _step60$value=_step60.value,a=_step60$value.index,l=_step60$value.frameBuffer,h=_step60$value.frameSection;var d=_this30.proxyRuntime.frameHandler.deserializeActionFrame(l,_this30.strategy.deserializerVersion,_this30.strategy.ignoreHashChecking,{mode:he.Real,frameSection:h}),u=Gn(d);_this30.assertAppendFrameId(d);var p=t&&function(m){return t(m,a)},f={authorId:d.authorId,mode:he.Real,timestamp:d.timestamp,frameSection:h,identifierGenerator:u};o=_this30.triggerInvoker.appendAction(d,f,p),_this30.triggerInvoker.callbackEventIfNeed(d)};for(_iterator60.s();!(_step60=_iterator60.n()).done;){_loop6()}}catch(err){_iterator60.e(err)}finally{_iterator60.f()}this._illusionQueue.length>0&&(s?this._illusionQueue=new Oh(this.observerId,this.logger,this.onIllusionQueueLengthChanged):this.rebuildIllusionBranch())}return this.proxyRuntime.hasBranch&&this.proxyRuntime.hasDoubleLines&&this._illusionQueue.length===0&&this.proxyRuntime.mergeBranch(),this.onIllusionQueueEmpty&&this._illusionQueue.length===0&&(this.onIllusionQueueEmpty(),this.onIllusionQueueEmpty=void 0),o}},{key:"rebuildIllusionBranch",value:function rebuildIllusionBranch(){var _this31=this;this.proxyRuntime.forkBranchRuntime();var e=this._illusionQueue;this._illusionQueue=new Oh(this.observerId,this.logger,this.onIllusionQueueLengthChanged),e.forFrames(function(t){var i=new _t(t.get()),r=_this31.proxyRuntime.createFrameSection(t.section),n={frameId:t.frameId,timestamp:t.timestamp,section:r,get:function get(){return i.frameBuffer}};_this31._illusionQueue.pushIllusionActionFrameGetter(n);var s=_this31.proxyRuntime.frameHandler.deserializeActionFrame(i.frameBuffer,_this31.strategy.deserializerVersion,_this31.strategy.ignoreHashChecking,{mode:he.IllusionRebuild,frameSection:r}),o=Gn(s);_this31.triggerInvoker.appendAction(s,{authorId:s.authorId,mode:he.IllusionRebuild,timestamp:s.timestamp,frameSection:r,identifierGenerator:o}),r.completeRebuild()}),e.length>0&&this.onIllusionQueueLengthChanged(this._illusionQueue.length)}}]);return Q0}(),q0=/*#__PURE__*/function(){function q0(e,t){_classCallCheck(this,q0);this.objectOperator=t,this.rootClassReflection=Qi(e.rootClass);var i=new Ii({format:e.format,objectAdapter:new _s});this.flatFrameSerialization=kh(i,this.rootClassReflection)}_createClass(q0,[{key:"serialize",value:function serialize(e,t,i){var r=new uf(e,this.objectOperator);try{this.replaceWithBindsActionFrame(r,t);var n=di(ii({},t),{beginObjectId:e.createdCount});return this.flatFrameSerialization.serializeActionFrame(n,i)}finally{r.complete()}}},{key:"replaceWithBindsActionFrame",value:function replaceWithBindsActionFrame(e,t){if(ma(t))e.bind(t.payload);else if(bh(t)){var _iterator61=_createForOfIteratorHelper(t.parameters),_step61;try{for(_iterator61.s();!(_step61=_iterator61.n()).done;){var i=_step61.value;e.bind(i)}}catch(err){_iterator61.e(err)}finally{_iterator61.f()}}else fa(t)?(e.bind(t.userPayload),e.bind(t.connectedPayload)):ga(t)&&e.bind(t.payload)}}]);return q0}(),Z0=/*#__PURE__*/function(){function Z0(e){_classCallCheck(this,Z0);this.author=e.author,this.objectOperator=e.objectOperator,this.rootClassReflection=e.rootClassReflection,this.objectAdapter=e.objectAdapter,this.flatFrameSerialization=e.flatFrameSerialization,this.includesFrameHash=e.includesFrameHash}_createClass(Z0,[{key:"appendScopeSlices",value:function appendScopeSlices(e){this.author.appendScopeSlices(e)}},{key:"handleInvokerArgs",value:function handleInvokerArgs(e,t,i){var r=this.objectOperator,n=this.objectAdapter,s=this.rootClassReflection,o=new pf(i,r,n);try{var a=s.methods[e].parameterFormatObjects,l=[],h=[];for(var d=0;d<t.length;++d){var _o$bind=o.bind(t[d],a[d]),u=_o$bind.value,p=_o$bind.binder;p?(l[d]=p.copied,h[d]=p.wrapped):(l[d]=u,h[d]=u)}return{copied:l,wrapped:h}}finally{o.completeBinding()}}},{key:"handlePayload",value:function handlePayload(e,t){var i=this.objectOperator,r=this.objectAdapter,n=this.flatFrameSerialization.serialization.format.anyObjectFormat,s=new pf(t,i,r);try{var _s$bind=s.bind(e,n),o=_s$bind.value,a=_s$bind.binder,l=o,h=o;return a&&(l=a.copied,h=a.wrapped),{copied:l,wrapped:h}}finally{s.completeBinding()}}},{key:"serializeEventFrameGetter",value:function serializeEventFrameGetter(e,t,i,r){var _this32=this;var n=this.author.createFrameId(),s={frameId:n,originalFrameId:n,timestamp:i,authorId:this.author.userId,type:ke.Event,scopeId:r.scopeId,beginObjectId:r.createdCount,event:e,payload:t,scope:Ve.Custom};return{frameId:n,getter:function getter(){return _this32.flatFrameSerialization.serializeActionFrame(s,_this32.includesFrameHash)}}}},{key:"serializeInvokerFrameGetter",value:function serializeInvokerFrameGetter(e,t,i,r){var _this33=this;var n=this.author.createFrameId(),s={frameId:n,originalFrameId:n,timestamp:i,authorId:this.author.userId,type:ke.Invoker,scopeId:r.scopeId,beginObjectId:r.createdCount,methodId:e,parameters:t};return{frameId:n,getter:function getter(){return _this33.flatFrameSerialization.serializeActionFrame(s,_this33.includesFrameHash)}}}}]);return Z0}(),Gf=/*#__PURE__*/function(){function Gf(e,t){_classCallCheck(this,Gf);this.onGeneratedFrameBuffer=e,this.onGenreateFrameFailed=t,this.pendding={},this._count=0}_createClass(Gf,[{key:"count",get:function get(){return this._count}},{key:"createEventFrameGetter",value:function createEventFrameGetter(e,t,i,r,n,s){var _this34=this;var _r$serializeEventFram=r.serializeEventFrameGetter(e,t,i,s),o=_r$serializeEventFram.frameId,a=_r$serializeEventFram.getter,l=new Nh(o,i,n,function(){try{var h=new _t(a());return _this34.fireGenerate(l,h),h.frameBuffer}catch(h){throw _this34.onGenreateFrameFailed(h),h}});return this.fireCreate(l),l}},{key:"createInvokerFrameGetter",value:function createInvokerFrameGetter(e,t,i,r,n,s){var _this35=this;var _r$serializeInvokerFr=r.serializeInvokerFrameGetter(e,t,i,s),o=_r$serializeInvokerFr.frameId,a=_r$serializeInvokerFr.getter,l=new Nh(o,i,n,function(){try{var h=new _t(a());return _this35.fireGenerate(l,h),h.frameBuffer}catch(h){throw _this35.onGenreateFrameFailed(h),h}});return this.fireCreate(l),l}},{key:"fireCreate",value:function fireCreate(e){this.pendding[e.id]||(this.pendding[e.id]=e,this._count+=1)}},{key:"fireGenerate",value:function fireGenerate(e,t){e.id in this.pendding&&(delete this.pendding[e.id],this._count-=1),this.onGeneratedFrameBuffer(t.frameBuffer)}}]);return Gf}();Gf.callGetMaxDuration=1200;var Rh=/*#__PURE__*/function(){function Rh(e,t,i,r){_classCallCheck(this,Rh);this.frameId=e,this.timestamp=t,this.section=i,this.getter=r,this.buffer=null,this.id="".concat(Rh.nextId),Rh.nextId+=1}_createClass(Rh,[{key:"get",value:function get(){return this.buffer||(this.buffer=this.getter()),this.buffer}}]);return Rh}(),Nh=Rh;Nh.nextId=0;var J0=700,$f=/*#__PURE__*/function(){function $f(e){var _this36=this;_classCallCheck(this,$f);if(this.modifiable=!0,this.generator=null,this.didDestroy=!1,this.assertAppendFrameId=function(t){var i=t.frameId,r=_this36.triggerInvoker.frameId+1;if(r!==i)throw new Error("find unexpected frame id ".concat(i,", wanna ").concat(r))},this.invokeMethod=function(t,i){_this36.assertEnableSendActionFrames();var r,n=Date.now(),s=_this36.generator;if(!s)throw new Error("cannot invoke ".concat(t,", frameGenerator is not prepare"));var o=s.author.allocateIdentifierGenerator(),a=_this36.proxyRuntime.block.runWithContinuousUpdated(function(){var l=_this36.proxyRuntime.createFrameSection(),h={authorId:s.author.userId,mode:he.Illusion,frameSection:l,timestamp:n,identifierGenerator:o};r=_this36.proxyRuntime.block.runWithMagix(h,function(){var d=_this36.triggerInvoker.methodNameToId(t),u=s.handleInvokerArgs(t,i,o),p=o.clone();try{return _this36.triggerInvoker.invoke(t,u.wrapped)}finally{var f=_this36.pending.createInvokerFrameGetter(d,u.copied,n,s,l,p);_this36.branchImageHelper.illusionQueue.pushIllusionActionFrameGetter(f),_this36.callbacks.onGeneratedActionFrame?(_this36.phaseNode.touch(),_this36.callbacks.onGeneratedActionFrame(f)):f.get()}})});return _this36.callbacks.onModified&&a.didUpdated&&_this36.callbacks.onModified(),r},this.currentPhase=function(){var t=_this36.branchImageHelper.illusionQueue;return t&&t.length===0&&_this36.pending.count===0?sn.Real:sn.Illusion},this.clientCrashWithError=function(t){_this36.callbacks.onClientCrashWithError&&Promise.resolve().then(function(){return _this36.callbacks.onClientCrashWithError(t)})["catch"](function(i){return console.error(i)})},this.library=e.library,this.logger=e.logger,this.proxyRuntime=e.proxyRuntime,this.serializer=new q0(e.library,e.proxyRuntime.objectOperator),this.imageUsers=e.imageUsers,this.strategy=e.strategy,this.callbacks=$s(e.callbacks||{}),this.eventFireNode=new H0(e.logger,{fire:this.callbacks.onEventFire,ack:this.callbacks.onEventFireACK}),this.eventFireNode.isPadding=!0,this.triggerInvoker=new Ah({library:this.library,imageUsers:this.imageUsers,proxyRuntime:e.proxyRuntime,onEventFire:function onEventFire(t){return _this36.eventFireNode.callback("fire",t)},onEventFireACK:function onEventFireACK(t){return _this36.eventFireNode.callback("ack",t)},onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame}),this.triggerInvoker.frameId=e.frameId,this.triggerInvoker.timestamp=e.timestamp,this.proxyRuntime.rootObject.onInvokedTriggerMethod=this.invokeMethod,e.actionFrames){var _iterator62=_createForOfIteratorHelper(e.actionFrames),_step62;try{for(_iterator62.s();!(_step62=_iterator62.n()).done;){var t=_step62.value;var i=this.proxyRuntime.frameHandler.deserializeActionFrame(t,this.strategy.deserializerVersion,this.strategy.ignoreHashChecking),r=Gn(i);this.triggerInvoker.appendAction(i,{authorId:i.authorId,timestamp:i.timestamp,mode:he.Real,identifierGenerator:r})}}catch(err){_iterator62.e(err)}finally{_iterator62.f()}}this.phaseNode=new Kn({phase:sn.Real,getCurrentPhase:this.currentPhase,onPhaseChanged:this.callbacks.onPhaseChanged}),this.branchImageHelper=new Q0(this.logger,this.strategy,this.proxyRuntime,this.triggerInvoker,this.assertAppendFrameId,this.callbacks.onReceivedRttReport||function(){},this.callbacks.onIllusionQueueLengthChanged||function(){}),this.pending=new Gf(function(){return _this36.phaseNode.touch()},this.clientCrashWithError),this.triggerInvoker.completeInit(),this.eventFireNode.hasKey("fire")&&Promise.resolve().then(function(){return _this36.eventFireNode.isPadding=!1})["catch"](function(t){return console.error(t)})}_createClass($f,[{key:"hasDoubleLines",get:function get(){return this.proxyRuntime.hasDoubleLines}},{key:"trigger",get:function get(){return this.proxyRuntime.rootObject.displayer}},{key:"phase",get:function get(){return this.phaseNode.phase}},{key:"userIds",get:function get(){return this.imageUsers.userIds}},{key:"usersCount",get:function get(){return this.imageUsers.usersCount}},{key:"pendingReportChanged",get:function get(){return this.proxyRuntime.pendingReportChanged},set:function set(e){this.proxyRuntime.pendingReportChanged=e}},{key:"hasUser",value:function hasUser(e){return this.imageUsers.hasUser(e)}},{key:"user",value:function user(e){return this.imageUsers.user(e,!1)}},{key:"verifiedFrameId",get:function get(){return this.triggerInvoker.frameId}},{key:"frameId",get:function get(){var e=this.triggerInvoker.frameId,t=this.branchImageHelper.illusionQueue;return t&&(e+=t.length),e},set:function set(e){var t=this.branchImageHelper.illusionQueue,i=e;t&&(i-=t.length),this.triggerInvoker.frameId=i}},{key:"timestamp",get:function get(){return this.triggerInvoker.timestamp}},{key:"appendActionFrames",value:function appendActionFrames(e,t){this.appendActionFramesToRuntime(e,t)}},{key:"appendActionFramesToRuntime",value:function appendActionFramesToRuntime(e,t){var _this37=this;var i,r;this.eventFireNode.isPadding=!0;try{i=this.proxyRuntime.block.runWithContinuousUpdated(function(){_this37.proxyRuntime.hasDoubleLines?_this37.proxyRuntime.hasBranch?r=_this37.branchImageHelper.appendActionFrames(e,t):r=_this37.branchImageHelper.appendActionFramesWithDoubleMode(e,t):r=_this37.appendActionFramesWithSingleMode(e,t)}),this.phaseNode.touch()}finally{this.eventFireNode.isPadding=!1}return this.callbacks.onModified&&i.didUpdated&&this.callbacks.onModified(),r}},{key:"appendScopeSlices",value:function appendScopeSlices(e){this.generator&&this.generator.appendScopeSlices(e)}},{key:"appendActionFramesWithSingleMode",value:function appendActionFramesWithSingleMode(e,t){var _this38=this;var i;var _loop7=function _loop7(r){var n=e[r],s=_this38.proxyRuntime.frameHandler.deserializeActionFrame(n,_this38.strategy.deserializerVersion,_this38.strategy.ignoreHashChecking),o=Gn(s);_this38.assertAppendFrameId(s);var a=t&&function(h){return t(h,r)},l={authorId:s.authorId,mode:he.Real,timestamp:s.timestamp,identifierGenerator:o};i=_this38.triggerInvoker.appendAction(s,l,a),_this38.triggerInvoker.callbackEventIfNeed(s)};for(var r=0;r<e.length;++r){_loop7(r)}return i}},{key:"dispatch",value:function dispatch(e,t){var _this39=this;this.assertEnableSendActionFrames();var i=Date.now(),r=this.generator;if(!r)throw new Error("cannot dispatch event ".concat(e,", generator is not prepare"));var n=r.author.allocateIdentifierGenerator(),s=this.proxyRuntime.block.runWithContinuousUpdated(function(){var o=_this39.proxyRuntime.createFrameSection(),a={authorId:r.author.userId,mode:he.Illusion,timestamp:i,frameSection:o,identifierGenerator:n};_this39.proxyRuntime.block.runWithMagix(a,function(){var l=r.handlePayload(t,n),h=n.clone();try{return _this39.triggerInvoker.dispatch(e,l.wrapped)}finally{var d=_this39.pending.createEventFrameGetter(e,l.copied,i,r,o,h);_this39.branchImageHelper.illusionQueue.pushIllusionActionFrameGetter(d),_this39.callbacks.onGeneratedActionFrame?(_this39.phaseNode.touch(),_this39.callbacks.onGeneratedActionFrame(d)):d.get()}})});this.eventFireNode.callback("fire",{event:e,payload:t,scope:Ve.Custom,authorId:r.author.userId}),this.callbacks.onModified&&s.didUpdated&&this.callbacks.onModified()}},{key:"snapshot",value:function snapshot(){var _this40=this;var e=this.generator?this.generator.author.userId:ce,t={frameId:this.frameId,originalFrameId:this.frameId,timestamp:this.timestamp,authorId:e,rootObject:this.proxyRuntime.rootObject.snapshotRootObject(),users:this.imageUsers.snapshotUsers()},i={authorId:e,mode:he.Outside,timestamp:t.timestamp,identifierGenerator:li(wr)};return this.proxyRuntime.block.runWithMagix(i,function(){return _this40.proxyRuntime.frameHandler.serializeSnapshotFrame(t)})}},{key:"setAllocatedUser",value:function setAllocatedUser(e){var _this41=this;return this.imageUsers.createImageAuthor(e,function(t){var _this41$serializer=_this41.serializer,i=_this41$serializer.objectOperator,r=_this41$serializer.rootClassReflection,n=_this41$serializer.flatFrameSerialization,s=_this41.proxyRuntime.frameHandler.objectAdapter,o=_this41.strategy.includesFrameHash;_this41.generator=new Z0({author:t,objectOperator:i,rootClassReflection:r,flatFrameSerialization:n,objectAdapter:s,includesFrameHash:o}),_this41.proxyRuntime.reportObserverIdChanged(e.userId),_this41.branchImageHelper.setObserverId(t.userId)})}},{key:"waitUtilIllusionQueueEmpty",value:function waitUtilIllusionQueueEmpty(){return this.branchImageHelper.waitUtilIllusionQueueEmpty()}},{key:"removeAllocatedUser",value:function(){var _removeAllocatedUser=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:this.imageUsers.cancelImageAuthorCreating();this.generator=null;this.proxyRuntime.reportObserverIdChanged(ce);_context4.next=5;return this.branchImageHelper.waitUtilIllusionQueueEmpty();case 5:this.branchImageHelper.cleanObserverId();case 6:case"end":return _context4.stop();}}},_callee4,this)}));function removeAllocatedUser(){return _removeAllocatedUser.apply(this,arguments)}return removeAllocatedUser}()},{key:"destroy",value:function destroy(){this.didDestroy||(this.imageUsers.cancelImageAuthorCreating(),this.generator=null,this.didDestroy=!0,this.proxyRuntime.dispose(),this.phaseNode.touch())}},{key:"createInvokerFrameBuffer",value:function createInvokerFrameBuffer(e){var t=this.triggerInvoker.methodNameToId(e.method);if(t===void 0)throw new Error("can't find method ".concat(JSON.stringify(e.method)));if(this.triggerInvoker.isNoEffectMethod(e.method))throw new Error("can't create frame for no effects method ".concat(JSON.stringify(e.method)));var i=di(ii({},this.createFrameHeader(e)),{type:ke.Invoker,scopeId:e.identifierGenerator.scopeId,methodId:t,parameters:e.parameters});return this.serializeActionFrame(e.identifierGenerator,i)}},{key:"createEventFrameBuffer",value:function createEventFrameBuffer(e){var t=di(ii({},this.createFrameHeader(e)),{type:ke.Event,scopeId:e.identifierGenerator.scopeId,scope:e.scope,event:e.event,payload:e.payload});return this.serializeActionFrame(e.identifierGenerator,t)}},{key:"createEnterFrameBuffer",value:function createEnterFrameBuffer(e){var t=di(ii({},this.createFrameHeader(e)),{type:ke.Enter,scopeId:e.identifierGenerator.scopeId,session:e.session,userPayload:e.userPayload,connectedPayload:e.connectedPayload});return this.serializeActionFrame(e.identifierGenerator,t)}},{key:"createLeaveFrameBuffer",value:function createLeaveFrameBuffer(e){var t=di(ii({},this.createFrameHeader(e)),{type:ke.Leave,scopeId:e.identifierGenerator.scopeId,payload:e.payload});return this.serializeActionFrame(e.identifierGenerator,t)}},{key:"createFrameHeader",value:function createFrameHeader(_ref16){var e=_ref16.frameId,t=_ref16.originalFrameId,i=_ref16.authorId;return{frameId:e,originalFrameId:t===void 0?e:t,timestamp:Date.now(),authorId:i,beginObjectId:0}}},{key:"serializeActionFrame",value:function serializeActionFrame(e,t){var _this42=this;var i={authorId:this.generator?this.generator.author.userId:ce,mode:he.Outside,timestamp:t.timestamp,identifierGenerator:e};return this.proxyRuntime.block.runWithMagix(i,function(){return _this42.serializer.serialize(e,t,_this42.strategy.includesFrameHash)})}},{key:"assertEnableSendActionFrames",value:function assertEnableSendActionFrames(){if(this.didDestroy)throw new Error("image was desctroy");var e=this.branchImageHelper.illusionQueue;if((e?e.length:0)>=J0)throw this.clientCrashWithError(new Error("illusion queue is overflow")),new Error("can't modify. illusion queue is overflow")}}]);return $f}(),sn;(function(e){e.Real="real",e.Illusion="illusion"})(sn||(sn={}));var Ta=/*#__PURE__*/function(){function Ta(e){_classCallCheck(this,Ta);this.proxyManager=e}_createClass(Ta,[{key:"createAccessUpdaterSerialization",value:function createAccessUpdaterSerialization(e){return new Ia(this.proxyManager.objectOperator,e)}},{key:"createWithParameters",value:function createWithParameters(e){var t=this.findOriginProxyRuntime(e),i=this.proxyManager.createProxyRuntime(e.library,t),r=new Kf(i),n=Date.now();i.setupWithParameters(e.constructorScopeId,e.args,n,{logger:e.logger,observerId:e.observerId,imageUsers:r,pendingReportChanged:e.pendingReportChanged,snapshotManager:cf(e.library,e.roomUUID),toolsExtra:e.toolsExtra});var s=new $f({frameId:0,timestamp:n,library:e.library,logger:e.logger,proxyRuntime:i,actionFrames:[],imageUsers:r,strategy:Ta.wrapStrategy(e),callbacks:e.callbacks});return t?i.rootObject.initializeWithOriginRootObject(t.rootObject):i.rootObject.initialize(),s}},{key:"parseSnapshotFrame",value:function parseSnapshotFrame(e,t){var i=this.proxyManager.createProxyRuntime(e),r=ci.V1,n=!1;return i.frameHandler.deserializeSnapshotFrame(t,r,n)}},{key:"createWithSnapshot",value:function createWithSnapshot(e){var t=this.findOriginProxyRuntime(e),i=this.proxyManager.createProxyRuntime(e.library,t),r=e.snapshotDeserializerVersion;r===void 0&&(r=hi(Le));var n=i.frameHandler.deserializeSnapshotFrame(e.snapshotFrame,r,e.ignoreHashChecking),s=n.rootObject,o=new Kf(i,n.users);i.setupWithRootObject(s,{logger:e.logger,observerId:e.observerId,imageUsers:o,pendingReportChanged:e.pendingReportChanged,snapshotManager:cf(e.library,e.roomUUID),toolsExtra:e.toolsExtra});var a=new $f({frameId:n.frameId,timestamp:n.timestamp,library:e.library,logger:e.logger,actionFrames:e.actionFrames,proxyRuntime:i,imageUsers:o,strategy:Ta.wrapStrategy(e),callbacks:e.callbacks});return t?i.rootObject.initializeWithOriginRootObject(t.rootObject):i.rootObject.initialize(),a}},{key:"findOriginProxyRuntime",value:function findOriginProxyRuntime(_ref17){var e=_ref17.originalImage;if(e)return e.proxyRuntime}}],[{key:"wrapStrategy",value:function wrapStrategy(e){var t=e.actionDeserializerVersion;return t===void 0&&(t=hi(Le)),Object.freeze({roomUUID:e.roomUUID,ignoreHashChecking:e.ignoreHashChecking,includesFrameHash:e.includesFrameHash,deserializerVersion:t})}}]);return Ta}(),Yf=Object.freeze(eC());function eC(){return[{methodName:"toString",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"toLocaleString",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"join",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"indexOf",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"lastIndexOf",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"every",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"some",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"forEach",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"reduce",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"reduceRight",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"concat",returnArray:!0,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"reverse",returnArray:!0,lengthChanged:!1,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"slice",returnArray:!0,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"splice",returnArray:!0,lengthChanged:!0,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e,t){var i,r=t[0];if(r>=0&&r<e.length)if(t.length>1){var n=t[1];n===void 0&&(n=0);var s=t.length-2;s<0&&(s=0),s===n?s>0&&(i={beginIndex:r,length:s}):i={beginIndex:r,length:e.length-r}}else i={beginIndex:r,length:e.length-r};return i}},{methodName:"map",returnArray:!0,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"filter",returnArray:!0,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"sort",returnArray:!0,lengthChanged:!1,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"push",returnArray:!1,lengthChanged:!0,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:e.length-1,length:1}}},{methodName:"pop",returnArray:!1,lengthChanged:!0,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:e.length,length:1}}},{methodName:"shift",returnArray:!1,lengthChanged:!0,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length+1}}},{methodName:"unshift",returnArray:!1,lengthChanged:!0,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}}]}var tC=/*#__PURE__*/function(){function tC(e){_classCallCheck(this,tC);this.nodes={};var t={};var _iterator63=_createForOfIteratorHelper(e),_step63;try{var _loop8=function _loop8(){var _step63$value=_step63.value,i=_step63$value.clazz,r=_step63$value.banList,n=_step63$value.proxyList;var s={},o=i.name;t[o]=Object.freeze({clazz:i,methods:s});var _iterator64=_createForOfIteratorHelper(r),_step64;try{var _loop9=function _loop9(){var a=_step64.value;s[a]=function(){throw new Error("".concat(o,".").concat(a," is ban in Magix"))}};for(_iterator64.s();!(_step64=_iterator64.n()).done;){_loop9()}}catch(err){_iterator64.e(err)}finally{_iterator64.f()}var _iterator65=_createForOfIteratorHelper(n),_step65;try{var _loop10=function _loop10(){var a=_step65.value;s[a]=function(){throw new Error("".concat(o,".").concat(a," is not defined"))}};for(_iterator65.s();!(_step65=_iterator65.n()).done;){_loop10()}}catch(err){_iterator65.e(err)}finally{_iterator65.f()}Object.seal(s)};for(_iterator63.s();!(_step63=_iterator63.n()).done;){_loop8()}}catch(err){_iterator63.e(err)}finally{_iterator63.f()}this.nodes=t}_createClass(tC,[{key:"findMethod",value:function findMethod(e,t){var i=this.findNode(e);if(i)return i.methods[t]}},{key:"proxyMethod",value:function proxyMethod(e,t,i){var r=this.findNode(e);if(!r)throw new Error("invalid class");if(!(t in r.methods))throw new Error("invalid method ".concat(JSON.stringify(t)));r.methods[t]=i}},{key:"findNode",value:function findNode(e){var t=e.name,i=this.nodes[t];if(i&&i.clazz===e)return i}}]);return tC}();function Xf(){return new tC([{clazz:Object,proxyList:["assign"],banList:["getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","create","defineProperty","defineProperties"]},{clazz:Array,proxyList:[],banList:["from"]},{clazz:String,proxyList:["fromCodePoint","fromCharCode"],banList:[]},{clazz:Number,proxyList:["isFinite","isInteger","isNaN","isSafeInteger","parseFloat","parseInt"],banList:[]}])}var iC=Object.defineProperty,Qf=Object.getOwnPropertySymbols,rC=Object.prototype.hasOwnProperty,nC=Object.prototype.propertyIsEnumerable,qf=function qf(e,t,i){return t in e?iC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},Ys=function Ys(e,t){for(var i in t||(t={})){rC.call(t,i)&&qf(e,i,t[i])}if(Qf){var _iterator66=_createForOfIteratorHelper(Qf(t)),_step66;try{for(_iterator66.s();!(_step66=_iterator66.n()).done;){var i=_step66.value;nC.call(t,i)&&qf(e,i,t[i])}}catch(err){_iterator66.e(err)}finally{_iterator66.f()}}return e},$A=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")},sC=/*#__PURE__*/function(){function sC(e){_classCallCheck(this,sC);this.usersCache={},this.observerId=e.observerId,this.environment=e.environment,this.authorId=e.authorId,this.core=e.coreFunctions,this.roomObserver=e.roomObserver,this.imageUsers=e.imageUsers}_createClass(sC,[{key:"getAuthorId",value:function getAuthorId(){var e;return this.environment===Mt.NoEffects&&this.observerId===this.authorId&&((e=this.roomObserver)==null||e.reportObservedObserverId()),this.authorId}},{key:"hasUser",value:function hasUser(e){var t;return this.environment===Mt.NoEffects&&((t=this.roomObserver)==null||t.reportObservedUsers()),this.imageUsers.hasUser(e)}},{key:"getUsersCount",value:function getUsersCount(){var e;return this.environment===Mt.NoEffects&&((e=this.roomObserver)==null||e.reportObservedUsers()),this.imageUsers.usersCount}},{key:"getUser",value:function getUser(e){var t;var i;return this.imageUsers.hasUser(e)&&(i=this.usersCache[e],i||(i=this.usersCache[e]=this.core.creator(this.imageUsers.user(e,!0)))),this.environment===Mt.NoEffects&&((t=this.roomObserver)==null||t.reportObservedUsers()),i}},{key:"getUserIds",value:function getUserIds(){var e;return this.userIdsCache||(this.userIdsCache=this.core.creator(this.imageUsers.userIds)),this.environment===Mt.NoEffects&&((e=this.roomObserver)==null||e.reportObservedUsers()),this.userIdsCache}}]);return sC}(),Lh=/*#__PURE__*/function(){function Lh(e){_classCallCheck(this,Lh);this._hasDoubleLines=!1,this._branchRuntime=null,this.logger=e.logger,this.observerId=e.observerId,this.proxyRuntime=e.proxyRuntime,this.imageUsers=e.imageUsers,this.toolsExtra=e.toolsExtra,this.snapshotManager=e.snapshotManager}_createClass(Lh,[{key:"hasDoubleLines",get:function get(){return this._hasDoubleLines}},{key:"branchRuntime",get:function get(){return this._branchRuntime}},{key:"changeToDoubleLines",value:function changeToDoubleLines(){this._hasDoubleLines=!0}},{key:"forkBranchRuntime",value:function forkBranchRuntime(){return this._branchRuntime=wC(this.logger),this._branchRuntime}},{key:"releaseBranchRuntime",value:function releaseBranchRuntime(){this._branchRuntime&&(this._branchRuntime=null)}},{key:"getForwardMode",value:function getForwardMode(){return!this._hasDoubleLines||this._branchRuntime?It.SingleForward:It.DoubleForward}},{key:"runWithMagix",value:function runWithMagix(e,t){var i=e.authorId,r=this.getEnvironment(e.mode),n=this.getForwardMode(),s=Lh.coreFunctionsSwitcher.switchCoreFunctions(e.mode),o=Object.freeze({idGenerator:e.identifierGenerator,environment:r,timestamp:e.timestamp,snapshot:this.snapshotManager,extra:this.toolsExtra,functions:new sC({observerId:this.observerId,environment:r,authorId:i,coreFunctions:s,roomObserver:this.proxyRuntime.roomObserver,imageUsers:this.imageUsers})}),a={mode:e.mode,coreFunctions:s,frameSection:e.frameSection,proxyRuntime:this.proxyRuntime,forwardMode:n,tools:o};return Q.runWith(a,t)}},{key:"runWithSerialization",value:function runWithSerialization(e,t){var i=this.getForwardMode(),r=Lh.coreFunctionsSwitcher.switchCoreFunctions(e.mode),n={mode:e.mode,coreFunctions:r,frameSection:e.frameSection,proxyRuntime:this.proxyRuntime,forwardMode:i};return Q.runWith(n,t)}},{key:"isForcesOnIllusionLine",value:function isForcesOnIllusionLine(e){switch(e){case it.Real:case it.RealAck:return!1;case it.Illusion:case it.IllusionRebuild:return!0;case it.Outside:return this._hasDoubleLines&&!!this._branchRuntime;default:throw new Error("invalid mode ".concat(e));}}},{key:"getEnvironment",value:function getEnvironment(e){switch(e){case it.Illusion:case it.IllusionRebuild:return Mt.Illusion;case it.Real:case it.RealAck:return Mt.Real;case it.Outside:return Mt.NoEffects;default:throw new Error("invalid mode ".concat(e));}}}],[{key:"coreFunctionsSwitcher",get:function get(){return this._coreFunctionsSwitcher||(this._coreFunctionsSwitcher=new Jn),this._coreFunctionsSwitcher}}]);return Lh}();function Zf(e,t,i){return t.constructor===Object?is(e,i,t):rs(e,i,t)}var Ea="__identifier";function Jf(e,t){Object.defineProperty(e,Ea,{enumerable:!1,configurable:!0,value:t})}var Aa;Q.addListener(function(e,t){t?Aa=e.coreFunctions.creator:Aa=void 0});var oC=/*#__PURE__*/function(){function oC(e,t,i){_classCallCheck(this,oC);this.proxyRuntime=e,this.identifierGenerator=t,this.banFunction=i,this.proxyNodes={},this.modifyObjects=[]}_createClass(oC,[{key:"complete",value:function complete(){var _iterator67=_createForOfIteratorHelper(this.modifyObjects),_step67;try{for(_iterator67.s();!(_step67=_iterator67.n()).done;){var e=_step67.value;delete e[Ea]}}catch(err){_iterator67.e(err)}finally{_iterator67.f()}}},{key:"wrap",value:function wrap(e){if(this.banFunction&&typeof e=="function")throw new Error("can't wrap function");if(_typeof(e)!="object"||e===null||we(e))return e;if(He(e))throw new Error("can't let displayer node pass Magix border");if(e.constructor===Array)return this.wrapArray(e);if(e.constructor===Object)return this.wrapObject(e);throw new Error("can't let object of ".concat(e.constructor.name," pass Magix border"))}},{key:"wrapArray",value:function wrapArray(e){var t=e[Ea],i;if(t===void 0){t=this.identifierGenerator.generate(),Jf(e,t),i=this.createProxyNode([],t);var r=i.target();for(var n=0;n<e.length;++n){r[n]=this.wrap(e[n])}this.proxyNodes[t]=i,this.modifyObjects.push(e)}else i=this.proxyNodes[t];return i}},{key:"wrapObject",value:function wrapObject(e){var t=e[Ea],i;if(t===void 0){t=this.identifierGenerator.generate(),Jf(e,t),i=this.createProxyNode({},t);var r=i.target(),n=Object.keys(e).sort();var _iterator68=_createForOfIteratorHelper(n),_step68;try{for(_iterator68.s();!(_step68=_iterator68.n()).done;){var s=_step68.value;r[s]=this.wrap(e[s])}}catch(err){_iterator68.e(err)}finally{_iterator68.f()}this.proxyNodes[t]=i,this.modifyObjects.push(e)}else i=this.proxyNodes[t];return i}},{key:"createProxyNode",value:function createProxyNode(e,t){return Aa?Aa(e,t):Zf(this.proxyRuntime,e,t)}}]);return oC}(),$n=/*#__PURE__*/function(){function $n(e){_classCallCheck(this,$n);this.pendingBuffer={},this.observer=e.create(xt,"room observer")}_createClass($n,[{key:"pendingReportChanged",get:function get(){return!!this.pendingBuffer},set:function set(e){!!this.pendingBuffer!==e&&(e?this.pendingBuffer={}:(this.firePendingReportChanges(this.pendingBuffer),this.pendingBuffer=null))}},{key:"reportObserverIdChanged",value:function reportObserverIdChanged(e){this.report($n.selfUserId,e,B.Updated)}},{key:"reportUsersChanged",value:function reportUsersChanged(e){this.report($n.users,e,B.Updated)}},{key:"reportObservedObserverId",value:function reportObservedObserverId(){this.observer.reportObservedKey($n.selfUserId)}},{key:"reportObservedUsers",value:function reportObservedUsers(){this.observer.reportObservedKey($n.users)}},{key:"firePendingReportChanges",value:function firePendingReportChanges(e){for(var t in e){var _e$t=e[t],i=_e$t.value,r=_e$t.kind;this.observer.reportChanged($n.users,i,r)}}},{key:"report",value:function report(e,t,i){if(this.pendingBuffer){var r=this.pendingBuffer[e];r?(r.value=t,r.kind=i):this.pendingBuffer[e]={value:t,kind:i}}else this.observer.reportChanged(e,t,i)}}]);return $n}(),Dh=$n;Dh.selfUserId="userId",Dh.users="users";function Bh(e,t){Object.defineProperty(e,Tt,{enumerable:!1,writable:!1,configurable:!0,value:t})}var aC=/*#__PURE__*/function(){function aC(){_classCallCheck(this,aC);this.didTouchedSet={}}_createClass(aC,[{key:"copyProxyNode",value:function copyProxyNode(e){var t=e.identifier;this.didTouchedSet[t]||(this.didTouchedSet[t]=!0,ft(e)?this.copyAkkoObjectProxyNode(e):Ei(e)?this.copyFlatObjectProxyNode(e):Ai(e)&&this.copyArrayProxyNode(e))}},{key:"copyAkkoObjectProxyNode",value:function copyAkkoObjectProxyNode(e){var t=e.realTarget;if(t){var i={};for(var r in t){var n=Object.getOwnPropertyDescriptor(t,r);if(n&&!n.get&&!n.set){var s=t[r];Me(s)&&this.copyProxyNode(s),i[r]=s}}Bh(i,e),Object.setPrototypeOf(i,e.struct.classReflection.clazz.prototype),e.illuTarget=i}}},{key:"copyFlatObjectProxyNode",value:function copyFlatObjectProxyNode(e){var t=e.realTarget;if(t){var i={};for(var r in t){var n=t[r];Me(n)&&this.copyProxyNode(n),i[r]=n}Bh(i,e),e.illuTarget=i}}},{key:"copyArrayProxyNode",value:function copyArrayProxyNode(e){var t=e.realTarget;if(t){var i=[];for(var r=0;r<t.length;++r){if(r in t){var n=t[r];Me(n)&&this.copyProxyNode(n),i[r]=n}}Bh(i,e),e.illuTarget=i}}}]);return aC}(),Oa=new(/*#__PURE__*/function(){function _class(){_classCallCheck(this,_class)}_createClass(_class,[{key:"addProperty",value:function addProperty(e,t,i){}},{key:"removeProperty",value:function removeProperty(e,t){}},{key:"setProperty",value:function setProperty(e,t,i){}},{key:"unbindDelegate",value:function unbindDelegate(e){}},{key:"callbackDelegates",value:function callbackDelegates(){return{didUpdated:!1}}}]);return _class}());function me(){return Oa}function eg(e,t){var i=Oa;try{return Oa=e,t(),{didUpdated:e.didUpdated}}finally{Oa=i}}var Fh=/*#__PURE__*/function(){function Fh(){_classCallCheck(this,Fh);this.disable=!1,this.delegates={},this.unbindsDelegated={},this.updatedObjects={},this._didUpdated=!1}_createClass(Fh,[{key:"didUpdated",get:function get(){return this._didUpdated}},{key:"callbackDelegates",value:function callbackDelegates(){for(var e in this.delegates){if(e in this.unbindsDelegated)delete this.delegates[e];else{var t=this.delegates[e],i=this.updatedObjects[e];t.updateDisplayer(i)}}for(var _e3 in this.delegates){var _t5=this.delegates[_e3],_i22=this.updatedObjects[_e3];_t5.reportChanged(_i22)}}},{key:"unbindDelegate",value:function unbindDelegate(e){this.disable||(this.unbindsDelegated[e.identifier]=!0)}},{key:"addProperty",value:function addProperty(e,t,i){if(this.disable||(this._didUpdated=!0,e.didDispose))return;var r=this.getBufferObject(e),n=r[t];if(n)switch(n.value=i,n.kind){case B.Removed:{n.kind=B.Updated;break}case B.Inserted:{n.kind=B.Inserted;break}case B.Updated:{n.kind=B.Updated;break}}else r[t]={kind:B.Inserted,value:i,isIndex:typeof t=="number"}}},{key:"setProperty",value:function setProperty(e,t,i){if(this.disable||(this._didUpdated=!0,e.didDispose))return;var r=this.getBufferObject(e),n=r[t];if(n)switch(n.value=i,n.kind){case B.Removed:{n.kind=B.Updated;break}case B.Inserted:{n.kind=B.Inserted;break}case B.Updated:{n.kind=B.Updated;break}}else r[t]={kind:B.Updated,value:i,isIndex:typeof t=="number"}}},{key:"removeProperty",value:function removeProperty(e,t){if(this.disable||(this._didUpdated=!0,e.didDispose))return;var i=this.getBufferObject(e),r=i[t];if(r)switch(r.kind){case B.Removed:break;case B.Inserted:{delete i[t];break}case B.Updated:{r.kind=B.Removed,r.value=void 0;break}}else i[t]={kind:B.Removed,value:void 0,isIndex:typeof t=="number"}}},{key:"getBufferObject",value:function getBufferObject(e){var t=e.identifier,i=this.updatedObjects[t];return i||(this.delegates[t]=e,this.updatedObjects[t]=i={}),i}}]);return Fh}(),lC=/*#__PURE__*/function(){function lC(e,t,i){_classCallCheck(this,lC);this.runtime=e,this.observerAdapter=t,i?this.pendingUpdatedSection=new Fh:this.pendingUpdatedSection=null}_createClass(lC,[{key:"pendingReportChanged",get:function get(){return!!this.pendingUpdatedSection},set:function set(e){!!this.pendingUpdatedSection!==e&&(e?this.pendingUpdatedSection=new Fh:(this.pendingUpdatedSection.callbackDelegates(),this.pendingUpdatedSection=null))}},{key:"runWithMagix",value:function runWithMagix(e,t){return this.runtime.runWithMagix(e,t)}},{key:"runWithDisableObserve",value:function runWithDisableObserve(e){var t=me();try{return t.disable=!0,e()}finally{t.disable=!1}}},{key:"runWithContinuousUpdated",value:function runWithContinuousUpdated(e){var t,i,r;return this.pendingUpdatedSection?(i=this.pendingUpdatedSection,r=!1):(i=new Fh,r=!0),this.observerAdapter?this.observerAdapter.observeUpdate(function(){t=eg(i,e),r&&i.callbackDelegates()}):(t=eg(i,e),r&&i.callbackDelegates()),t}}]);return lC}();function cC(e){for(var t in e){return!0}return!1}var tg=/*#__PURE__*/function(){function tg(e){var _this43=this;_classCallCheck(this,tg);this.cache={},this.clean=function(){var t=_this43.adapter.createObserverCollection();for(var i in _this43.cache){var r=_this43.cache[i];for(var n in r){var s=r[n].hub;s&&t.addObserverHub(s)}delete _this43.cache[i]}t.clean()},this.adapter=e,this.delayer=new Pi(this.clean)}_createClass(tg,[{key:"dispose",value:function dispose(){this.delayer.dispose()}},{key:"valueWithArgs",value:function valueWithArgs(e,t,i,r,n){var _this44=this;var s;if(this.isComplicate(r))return n.call(e,i,r);{var o=i+JSON.stringify(r),a=this.cache[t];a||(a=this.cache[t]={});var l;if(o in a)l=a[o],(s=l.hub)==null||s.replay();else{var h,d;try{h=this.adapter.collectObservations(function(){return n.call(e,i,r)},function(u){return d=u}),l={hub:d,result:h}}catch(u){l={hub:d,error:u}}d&&(d.onChanged=function(){return _this44.onExpire(t,o)}),a[o]=l}return this.touchCache(),this.returnNode(l)}}},{key:"isComplicate",value:function isComplicate(e){var t=5;if(e.length>=t)return!0;var _iterator69=_createForOfIteratorHelper(e),_step69;try{for(_iterator69.s();!(_step69=_iterator69.n()).done;){var i=_step69.value;if(typeof i!="string"&&typeof i!="number")return!0}}catch(err){_iterator69.e(err)}finally{_iterator69.f()}return!1}},{key:"valueWithKey",value:function valueWithKey(e,t,i,r){var _this45=this;var n;var s=this.cache[t];s||(s=this.cache[t]={});var o;if(i in s)o=s[i],(n=o.hub)==null||n.replay();else{var a,l;try{a=this.adapter.collectObservations(function(){return r.call(e,i)},function(h){return l=h}),o={hub:l,result:a}}catch(h){o={hub:l,error:h}}l&&(l.onChanged=function(){return _this45.onExpire(t,i)}),s[i]=o}return this.touchCache(),this.returnNode(o)}},{key:"onExpire",value:function onExpire(e,t){var i=this.cache[e];t in i&&(delete i[t],cC(i)||delete this.cache[e])}},{key:"returnNode",value:function returnNode(e){if(e.error)throw e.error;return e.hub&&e.hub.replay(),e.result}},{key:"touchCache",value:function touchCache(){if(!this.delayer.isRunning){var e=tg.cacheDuration,t=tg.cacheRate,i=e+Math.random()*t;this.delayer.refreshAndInvokeAfterInterval(i)}}}]);return tg}(),jh=tg;jh.cacheDuration=60*1e3,jh.cacheRate=.3;var hC=/*#__PURE__*/function(){function hC(e,t,i,_ref18){var r=_ref18.observerAdapter,n=_ref18.escapeObjectFilter,s=_ref18.jsxFactory;_classCallCheck(this,hC);this.objectOperator=e,this.library=t,this.disposedListeners=[],this.observerAdapter=r,this.escapeObjectFilter=n||function(){return!1},this.jsxFactory=s,this.roomObserver=r&&new Dh(r),this.noEffectsIdGenerator=li(wr),this.frameHandler=new FC(this,this.library),this.cache=this.observerAdapter&&new jh(this.observerAdapter),i&&i.library===this.library?this.structMap=Ys({},i.structMap):this.structMap={}}_createClass(hC,[{key:"runtime",get:function get(){return this._runtime}},{key:"block",get:function get(){return this.proxyBlock}},{key:"rootObject",get:function get(){return this._rootObject}},{key:"hasDoubleLines",get:function get(){return this._runtime.hasDoubleLines}},{key:"hasBranch",get:function get(){return!!this._runtime.branchRuntime}},{key:"pendingReportChanged",get:function get(){var e,t;return!!(((e=this.roomObserver)==null?void 0:e.pendingReportChanged)||((t=this.proxyBlock)==null?void 0:t.pendingReportChanged))},set:function set(e){this.roomObserver&&(this.roomObserver.pendingReportChanged=e),this.proxyBlock&&(this.proxyBlock.pendingReportChanged=e),this._rootObject.pendingUpdatedRootObject=e}},{key:"forkBranchRuntime",value:function forkBranchRuntime(){this._runtime.forkBranchRuntime()}},{key:"mergeBranch",value:function mergeBranch(){var e=this._runtime;e.branchRuntime.syncTwoBranches(),e.releaseBranchRuntime()}},{key:"observeUpdate",value:function observeUpdate(e){this.observerAdapter?this.observerAdapter.observeUpdate(e):e()}},{key:"reportUsersChanged",value:function reportUsersChanged(e){var t;(t=this.roomObserver)==null||t.reportUsersChanged(e)}},{key:"reportObserverIdChanged",value:function reportObserverIdChanged(e){var t;this._runtime.observerId=e,(t=this.roomObserver)==null||t.reportObserverIdChanged(e)}},{key:"createFrameSection",value:function createFrameSection(e){var t=this._runtime;t.hasDoubleLines||(new aC().copyProxyNode(this._rootObject.snapshotRootObject()),t.changeToDoubleLines());var i=t.branchRuntime;i||(i=t.forkBranchRuntime());var r;return e&&(r=e.takeCreatedProxyNodes()),i.createFrameSection(r)}},{key:"setupWithParameters",value:function setupWithParameters(e,t,i,r){var _this46=this;this.setupRuntime(r);var n=ce,s=li(e),o=this.pushValues(s,t,!0),a={authorId:n,mode:he.Real,timestamp:i,identifierGenerator:s},l=this.runtime.runWithMagix(a,function(){var h=_this46.library.rootClass;return _construct(h,_toConsumableArray(o))}).__proxy;this._rootObject=new ug(this._runtime,l,this.observerAdapter),this._rootObject.pendingUpdatedRootObject=r.pendingReportChanged}},{key:"setupWithRootObject",value:function setupWithRootObject(e,t){if(this.setupRuntime(t),!ft(e))throw new Error("rootObject should be AkkoObjectProxyNode");this._rootObject=new ug(this._runtime,e,this.observerAdapter),this._rootObject.pendingUpdatedRootObject=t.pendingReportChanged}},{key:"setupRuntime",value:function setupRuntime(e){if(this._runtime)throw new Error("did bind runtime params");this._runtime=new Lh({logger:e.logger,observerId:e.observerId,imageUsers:e.imageUsers,snapshotManager:e.snapshotManager,proxyRuntime:this,toolsExtra:e.toolsExtra}),this.roomObserver&&(this.roomObserver.pendingReportChanged=e.pendingReportChanged),this.proxyBlock=new lC(this._runtime,this.observerAdapter,e.pendingReportChanged)}},{key:"pullValue",value:function pullValue(e){return _typeof(e)!="object"||e===null?e:Me(e)?e.displayer:we(e)?e.readonly?e:e.slice():this.escapeObjectFilter(e)?e:void 0}},{key:"pushValues",value:function pushValues(e,t,i){var r=[],n=new oC(this,e,i);try{for(var s=0;s<t.length;++s){r[s]=n.wrap(t[s])}return r}finally{n.complete()}}},{key:"getAkkoObjectStruct",value:function getAkkoObjectStruct(e){var t=this.structMap[e.id];return t||(t=this.structMap[e.id]=new xC(e)),t}},{key:"listenDisposed",value:function listenDisposed(e){this.disposedListeners.indexOf(e)===-1&&this.disposedListeners.push(e)}},{key:"unlistenDisposed",value:function unlistenDisposed(e){var t=this.disposedListeners.indexOf(e);t!==-1&&this.disposedListeners.splice(t,1)}},{key:"dispose",value:function dispose(){var e;(e=this.cache)==null||e.dispose();var _iterator70=_createForOfIteratorHelper(this.disposedListeners.splice(0)),_step70;try{for(_iterator70.s();!(_step70=_iterator70.n()).done;){var t=_step70.value;try{t()}catch(i){console.error(i)}}}catch(err){_iterator70.e(err)}finally{_iterator70.f()}}}]);return hC}(),Ti=Xf();Ti.proxyMethod(Object,"assign",function(){var t;for(var _len8=arguments.length,e=new Array(_len8),_key8=0;_key8<_len8;_key8++){e[_key8]=arguments[_key8]}if(e.length>0){var n=e[0];n&&Me(n)&&(t=n)}for(var _n10=0;_n10<e.length;++_n10){e[_n10]=$h(e[_n10])}var i=Object.assign.apply(this,e),r=i[Tt];return t&&t!==r&&(r=t,Ir(t,i)),r});Ti.proxyMethod(String,"fromCodePoint",function(){for(var _len9=arguments.length,e=new Array(_len9),_key9=0;_key9<_len9;_key9++){e[_key9]=arguments[_key9]}for(var t=0;t<e.length;++t){e[t]=$h(e[t])}return String.fromCodePoint.apply(this,e)});Ti.proxyMethod(String,"fromCharCode",function(){for(var _len10=arguments.length,e=new Array(_len10),_key10=0;_key10<_len10;_key10++){e[_key10]=arguments[_key10]}for(var t=0;t<e.length;++t){e[t]=$h(e[t])}return String.fromCharCode.apply(this,e)});Ti.proxyMethod(Number,"isFinite",Number.isFinite);Ti.proxyMethod(Number,"isInteger",Number.isInteger);Ti.proxyMethod(Number,"isNaN",Number.isNaN);Ti.proxyMethod(Number,"isSafeInteger",Number.isSafeInteger);Ti.proxyMethod(Number,"parseFloat",Number.parseFloat);Ti.proxyMethod(Number,"parseInt",Number.parseInt);var Ra;Q.addListener(function(e,t){t?Ra=e.proxyRuntime.jsxFactory:Ra=void 0});function ig(){if(!Ra)throw Q.currentNode?new Error("can't create JSX. you didn't set jsxFactory"):new Error("can't create JSX. maybe you called it out of Magix");for(var _len11=arguments.length,e=new Array(_len11),_key11=0;_key11<_len11;_key11++){e[_key11]=arguments[_key11]}return Ra.apply(void 0,e)}var dC=/*#__PURE__*/function(){function dC(){_classCallCheck(this,dC);this.unwrappedMap={}}_createClass(dC,[{key:"unwrap",value:function unwrap(e){return Me(e)?this.unwrapProxyNode(e):we(e)?e.readonly?e:e.slice():e}},{key:"unwrapProxyNode",value:function unwrapProxyNode(e){if(ft(e))return e.displayer;{var t=e.identifier,i=this.unwrappedMap[t];if(!i){var r=e.target();if(Ei(e)){this.unwrappedMap[t]=i={};for(var n in r){i[n]=this.unwrap(r[n])}}else if(Ai(e)){this.unwrappedMap[t]=i=[];for(var _n11=0;_n11<r.length;++_n11){i[_n11]=this.unwrap(r[_n11])}}}return i}}}]);return dC}();function xe(e){if(!(_typeof(e)!="object"||e===null)){if(Me(e))return e;{var t=e[Tt];return Me(t)?t:void 0}}}function Xs(e){return e instanceof Ca?e.__proxy:e}var Qs=/*#__PURE__*/function(){function Qs(){_classCallCheck(this,Qs)}_createClass(Qs,[{key:"updater",value:function updater(e){return e}},{key:"getter",value:function getter(e,t){var i=xe(e);return i?i.getValue(t):e[t]}},{key:"caller",value:function caller(e,t,i,r){if(typeof e=="function"){if(Ie in e)return e[t].apply(e,i);{var n=Ti.findMethod(e,t);if(n)return n.apply(e,i);if(typeof Function.prototype[t]=="function")return e[t].apply(e,_toConsumableArray(i));throw new Error("can't call ".concat(e.name,".").concat(t,", it's not supported"))}}else{var _n12,s;return r&&(_n12=r[t]),Me(e)?(s=e.target(),_n12||(_n12=e.getMethod(t))):(s=e,_n12||(_n12=e[t])),_n12.apply(s,i)}}},{key:"setter",value:function setter(e,t,i){var r=xe(e),n=i;return n=Xs(n),r?r.setValue(t,n):e[t]=n}},{key:"prefix",value:function prefix(e,t,i){var r=xe(e);return r?r.prefix(t,i):e[t]+=i}},{key:"postfix",value:function postfix(e,t,i){var r=xe(e);if(r)return r.postfix(t,i);{var n=e[t];return e[t]+=i,n}}},{key:"remover",value:function remover(e,t){var i=xe(e);return i?i.removeKey(t):delete e[t]}},{key:"wrapper",value:function wrapper(e){return _typeof(e)!="object"||e===null?e:e[Tt]||e}},{key:"unwrapper",value:function unwrapper(e){return Me(e)?e.target():e}},{key:"jsxUnwrapper",value:function jsxUnwrapper(e){return new dC().unwrap(e)}}]);return Qs}(),zh,Pr,Yn,uC=/*#__PURE__*/function(_Qs){_inherits(uC,_Qs);var _super12=_createSuper(uC);function uC(){_classCallCheck(this,uC);return _super12.apply(this,arguments)}_createClass(uC,[{key:"onContextUpdate",value:function onContextUpdate(e,t){t?(zh=e.tools&&e.tools.idGenerator,Pr=e.frameSection,Yn=e.proxyRuntime):(zh=void 0,Pr=void 0,Yn=void 0)}},{key:"creator",value:function creator(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:zh.generate();var i;if(e.constructor===Array)i=rs(Yn,t,e);else if(e.constructor===Object)i=is(Yn,t,e);else{var r=e.constructor[Ie];if(_typeof(r)!="object"||r===null)throw new Error("can't find __reflection");var n=Yn.getAkkoObjectStruct(r);i=eo(Yn,t,e,n)}return Pr.addCreatedObject(i),i}},{key:"updater",value:function updater(e){return Me(e)&&Pr.illusionUpdateProxyNode(e),e}},{key:"setter",value:function setter(e,t,i){var r=xe(e),n=i;return n=Xs(n),r?(Pr.illusionUpdateProxyNode(r),r.setValue(t,n)):e[t]=n}},{key:"prefix",value:function prefix(e,t,i){var r=xe(e);return r?(Pr.illusionUpdateProxyNode(r),r.prefix(t,i)):e[t]+=i}},{key:"postfix",value:function postfix(e,t,i){var r=xe(e);if(r)return Pr.illusionUpdateProxyNode(r),r.postfix(t,i);{var n=e[t];return e[t]+=i,n}}},{key:"remover",value:function remover(e,t){var i=xe(e);return i?(Pr.illusionUpdateProxyNode(i),i.removeKey(t)):delete e[t]}}]);return uC}(Qs),Uh,Ji,Xn,pC=/*#__PURE__*/function(_Qs2){_inherits(pC,_Qs2);var _super13=_createSuper(pC);function pC(){_classCallCheck(this,pC);return _super13.apply(this,arguments)}_createClass(pC,[{key:"onContextUpdate",value:function onContextUpdate(e,t){t?(Uh=e.tools&&e.tools.idGenerator,Ji=e.frameSection,Xn=e.proxyRuntime):(Uh=void 0,Ji=void 0,Xn=void 0)}},{key:"creator",value:function creator(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Uh.generate();var i=Ji.illusionTakeCreatedObject(t,e);if(i)i.replaceIlluTarget(e);else if(e.constructor===Array)i=rs(Xn,t,e);else if(e.constructor===Object)i=is(Xn,t,e);else{var r=e.constructor[Ie];if(_typeof(r)!="object"||r===null)throw new Error("can't find __reflection");var n=Xn.getAkkoObjectStruct(r);i=eo(Xn,t,e,n)}return Ji.addCreatedObject(i),i}},{key:"updater",value:function updater(e){return Me(e)&&Ji.illusionUpdateProxyNode(e),e}},{key:"setter",value:function setter(e,t,i){var r=xe(e),n=i;return n=Xs(n),r?(Ji.illusionUpdateProxyNode(r),r.setValue(t,n)):e[t]=n}},{key:"prefix",value:function prefix(e,t,i){var r=xe(e);return r?(Ji.illusionUpdateProxyNode(r),r.prefix(t,i)):e[t]+=i}},{key:"postfix",value:function postfix(e,t,i){var r=xe(e);if(r)return Ji.illusionUpdateProxyNode(r),r.postfix(t,i);{var n=e[t];return e[t]+=i,n}}},{key:"remover",value:function remover(e,t){var i=xe(e);return i?(Ji.illusionUpdateProxyNode(i),i.removeKey(t)):delete e[t]}}]);return pC}(Qs),Vh,Na,Qn,La=It.SingleForward,mC=/*#__PURE__*/function(_Qs3){_inherits(mC,_Qs3);var _super14=_createSuper(mC);function mC(){_classCallCheck(this,mC);return _super14.apply(this,arguments)}_createClass(mC,[{key:"onContextUpdate",value:function onContextUpdate(e,t){t?(Vh=e.tools&&e.tools.idGenerator,Na=e.frameSection,Qn=e.proxyRuntime,La=e.forwardMode):(Vh=void 0,Na=void 0,Qn=void 0,La=It.SingleForward)}},{key:"creator",value:function creator(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Vh.generate();var i=Na==null?void 0:Na.realTakeCreatedObject(t,e);if(i)i.realTarget=Ir(i,e);else if(e.constructor===Array)i=rs(Qn,t,e);else if(e.constructor===Object)i=is(Qn,t,e);else{var r=e.constructor[Ie];if(_typeof(r)!="object"||r===null)throw new Error("can't find __reflection");var n=Qn.getAkkoObjectStruct(r);i=eo(Qn,t,e,n)}return La===It.DoubleForward&&i.converge(),i}},{key:"wrapper",value:function wrapper(e){if(_typeof(e)!="object"||e===null)return e;var t=e[Tt];return t?(La===It.DoubleForward&&t.converge(),t):e}}]);return mC}(Qs),Wh,ri,qn,fC=/*#__PURE__*/function(_Qs4){_inherits(fC,_Qs4);var _super15=_createSuper(fC);function fC(){_classCallCheck(this,fC);return _super15.apply(this,arguments)}_createClass(fC,[{key:"onContextUpdate",value:function onContextUpdate(e,t){t?(Wh=e.tools&&e.tools.idGenerator,ri=e.frameSection,qn=e.proxyRuntime):(Wh=void 0,ri=void 0,qn=void 0)}},{key:"creator",value:function creator(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Wh.generate();var i=ri.realTakeCreatedObject(t,e);if(i)i.realTarget=Ir(i,e);else if(e.constructor===Array)i=rs(qn,t,e),i.converge(),ri.realUpdateProxyNode(i);else if(e.constructor===Object)i=is(qn,t,e),i.converge(),ri.realUpdateProxyNode(i);else{var r=e.constructor[Ie];if(_typeof(r)!="object"||r===null)throw new Error("can't find __reflection");var n=qn.getAkkoObjectStruct(r);i=eo(qn,t,e,n),i.converge(),ri.realUpdateProxyNode(i)}return i}},{key:"wrapper",value:function wrapper(e){if(_typeof(e)!="object"||e===null)return e;var t=e[Tt];return t?(t.illuTarget||(t.converge(),ri.realUpdateProxyNode(t)),t):e}},{key:"updater",value:function updater(e){return Me(e)&&ri.realUpdateProxyNode(e),e}},{key:"setter",value:function setter(e,t,i){var r=xe(e),n=i;return n=Xs(n),r?(ri.realUpdateProxyNode(r),r.setValue(t,n)):e[t]=n}},{key:"prefix",value:function prefix(e,t,i){var r=xe(e);return r?(ri.realUpdateProxyNode(r),r.prefix(t,i)):e[t]+=i}},{key:"postfix",value:function postfix(e,t,i){var r=xe(e);if(r)return ri.realUpdateProxyNode(r),r.postfix(t,i);{var n=e[t];return e[t]+=i,n}}},{key:"remover",value:function remover(e,t){var i=xe(e);return i?(ri.realUpdateProxyNode(i),i.removeKey(t)):delete e[t]}}]);return fC}(Qs),Da=rg;Q.addListener(function(e,t){t&&e.tools&&e.mode===it.Outside?Da=gC:Da=rg});function gC(e){return jm(e.identifier)===wr}function rg(){return!0}var Hh,Zn;function Ba(e,t){if(Da(e))return!0;var i=Qi(e.target());if(i){var r=i.properties[t];if(r&&r.isTransient)return!0}return!1}var yC=/*#__PURE__*/function(_Qs5){_inherits(yC,_Qs5);var _super16=_createSuper(yC);function yC(){_classCallCheck(this,yC);return _super16.apply(this,arguments)}_createClass(yC,[{key:"onContextUpdate",value:function onContextUpdate(e,t){t?(Hh=e.tools&&e.tools.idGenerator,Zn=e.proxyRuntime):(Hh=void 0,Zn=void 0)}},{key:"creator",value:function creator(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Hh.generate();var i;if(e.constructor===Array)i=rs(Zn,t,e);else if(e.constructor===Object)i=is(Zn,t,e);else{var r=e.constructor[Ie];if(_typeof(r)!="object"||r===null)throw new Error("can't find __reflection");var n=Zn.getAkkoObjectStruct(r);i=eo(Zn,t,e,n)}return i}},{key:"getter",value:function getter(e,t){var i=xe(e);if(i){var r=i.getValue(t);return i.touchKey(t),r}else return e[t]}},{key:"unwrapper",value:function unwrapper(e){return Me(e)?(e.touchKey(),e.target()):e}},{key:"setter",value:function setter(e,t,i){var r=xe(e),n=i;if(r&&Ba(r,t))return n=Xs(n),r?r.setValue(t,n):e[t]=n;throw new Error("Magix is frozen, you can't modify anything")}},{key:"prefix",value:function prefix(e,t,i){var r=xe(e);if(r&&Ba(r,t)){var n=r.prefix(t,i);return r.touchKey(t),n}else throw new Error("Magix is frozen, you can't modify anything")}},{key:"postfix",value:function postfix(e,t,i){var r=xe(e);if(r&&Ba(r,t)){var n=r.postfix(t,i);return r.touchKey(t),n}else throw new Error("Magix is frozen, you can't modify anything")}},{key:"remover",value:function remover(e,t){var i=xe(e);if(i&&Ba(i,t))return i.removeKey(t);throw new Error("Magix is frozen, you can't modify anything")}}]);return yC}(Qs),it;(function(e){e[e.Illusion=0]="Illusion",e[e.IllusionRebuild=1]="IllusionRebuild",e[e.Real=2]="Real",e[e.RealAck=3]="RealAck",e[e.Outside=4]="Outside"})(it||(it={}));var Jn=/*#__PURE__*/function(){function Jn(){var _this47=this;_classCallCheck(this,Jn);this.illusion=Jn.bind(new uC),this.illusionRebuild=Jn.bind(new pC),this.real=Jn.bind(new mC),this.realAck=Jn.bind(new fC),this.outside=Jn.bind(new yC),this.currentCoreFunctions=this.illusion,Q.addListener(function(e,t){return _this47.currentCoreFunctions.onContextUpdate(e,t)})}_createClass(Jn,[{key:"switchCoreFunctions",value:function switchCoreFunctions(e){switch(e){case 0:{this.currentCoreFunctions=this.illusion;break}case 1:{this.currentCoreFunctions=this.illusionRebuild;break}case 2:{this.currentCoreFunctions=this.real;break}case 3:{this.currentCoreFunctions=this.realAck;break}case 4:{this.currentCoreFunctions=this.outside;break}}return this.currentCoreFunctions}}],[{key:"bind",value:function bind(e){return Object.freeze({creator:e.creator.bind(e),updater:e.updater.bind(e),wrapper:e.wrapper.bind(e),unwrapper:e.unwrapper.bind(e),jsxUnwrapper:e.jsxUnwrapper.bind(e),getter:e.getter.bind(e),setter:e.setter.bind(e),caller:e.caller.bind(e),remover:e.remover.bind(e),prefix:e.prefix.bind(e),postfix:e.postfix.bind(e),onContextUpdate:e.onContextUpdate.bind(e)})}}]);return Jn}();function bC(){return new vC}var vC=/*#__PURE__*/function(){function vC(){_classCallCheck(this,vC);this.counterSet={},this.elementSet={}}_createClass(vC,[{key:"hasElement",value:function hasElement(e){var t=this.elementSet[e.identifier];return t?t===e:!1}},{key:"createSubSet",value:function createSubSet(){return new SC(this)}},{key:"release",value:function release(e){for(var t in this.elementSet){var i=this.elementSet[t];e&&e(i),delete this.counterSet[t],delete this.elementSet[t]}}},{key:"add",value:function add(e){var t=e.identifier;return t in this.counterSet?this.counterSet[t]+=1:(this.elementSet[t]=e,this.counterSet[t]=1)}},{key:"remove",value:function remove(e){var t=this.counterSet[e];return t===void 0?t=0:(t-=1,t===0&&(delete this.counterSet[e],delete this.elementSet[e])),t}}]);return vC}(),SC=/*#__PURE__*/function(){function SC(e){_classCallCheck(this,SC);this.uniteSet=e,this.elementSet={}}_createClass(SC,[{key:"add",value:function add(e){var t=e.identifier;t in this.elementSet||(this.elementSet[t]=e,this.uniteSet.add(e))}},{key:"release",value:function release(e){for(var t in this.elementSet){var i=this.elementSet[t],r=this.uniteSet.remove(t);e&&r===0&&e(i),delete this.elementSet[t]}}}]);return SC}();function _h(e){var t=e.realTarget,i=e.illuTarget;if(!t||!i)return!1;switch(e.kind){case Et.Array:{var r=e,n=t,s=i;if(n.length!==s.length)return!1;for(var o=r.equalsCount;o<n.length;++o){if(Kh(n[o],s[o]))return r.equalsCount=o,!1}return r.equalsCount=n.length,!0}case Et.FlatObject:case Et.HangUpObject:{for(var _r15 in t){if(!(_r15 in i)||Kh(i[_r15],t[_r15]))return!1}for(var _r16 in i){if(!(_r16 in t))return!1}return!0}case Et.AkkoObject:{var _r17=e.struct;var _iterator71=_createForOfIteratorHelper(_r17.serializableValueProperties),_step71;try{for(_iterator71.s();!(_step71=_iterator71.n()).done;){var _n13=_step71.value;if(_n13 in t!=_n13 in i||Kh(t[_n13],i[_n13]))return!1}}catch(err){_iterator71.e(err)}finally{_iterator71.f()}return!0}default:return!1;}}function Kh(e,t){return e===t?!1:Number.isNaN(e)?!Number.isNaN(t):we(e)&&we(t)?!e.isEqualsTo(t):!0}function wC(e){return new CC(e)}var CC=/*#__PURE__*/function(){function CC(e){_classCallCheck(this,CC);this.logger=e,this.updatedProxyNodes=bC(),this.noConvergentRealNodes={},this.noConvergentIllusionNodes={}}_createClass(CC,[{key:"createFrameSection",value:function createFrameSection(e){return new kC(this,this.updatedProxyNodes.createSubSet(),e)}},{key:"syncTwoBranches",value:function syncTwoBranches(){this.updatedProxyNodes.release(function(e){_h(e)||e.converge()});for(var e in this.noConvergentIllusionNodes){var t=this.noConvergentIllusionNodes[e],i=this.noConvergentRealNodes[e];t!==i&&t.converge(),delete this.noConvergentIllusionNodes[e]}for(var _e4 in this.noConvergentRealNodes){this.noConvergentRealNodes[_e4].converge(),delete this.noConvergentRealNodes[_e4]}}},{key:"isUpdatedProxyNode",value:function isUpdatedProxyNode(e){return this.updatedProxyNodes.hasElement(e)}},{key:"isNoConvergentIllusionProxyNode",value:function isNoConvergentIllusionProxyNode(e){return e in this.noConvergentIllusionNodes}},{key:"isNoConvergentRealProxyNode",value:function isNoConvergentRealProxyNode(e){return e in this.noConvergentRealNodes}},{key:"addNoConvergentIllusionProxyNode",value:function addNoConvergentIllusionProxyNode(e){this.logger.warn("found no convergent illusion object: ".concat(e.identifier)),this.noConvergentIllusionNodes[e.identifier]=e}},{key:"addNoConvergentRealProxyNode",value:function addNoConvergentRealProxyNode(e){this.logger.warn("found no convergent real object: ".concat(e.identifier)),this.noConvergentRealNodes[e.identifier]=e}}]);return CC}(),kC=/*#__PURE__*/function(){function kC(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};_classCallCheck(this,kC);this.createdProxyNodes={},this.branch=e,this.illuUpdatedProxyNodes=t,this.realUpdatedProxyNodes={},this.legacyCreatedProxyNodes=i}_createClass(kC,[{key:"takeCreatedProxyNodes",value:function takeCreatedProxyNodes(){try{return this.createdProxyNodes}finally{this.createdProxyNodes={}}}},{key:"illusionUpdateProxyNode",value:function illusionUpdateProxyNode(e){this.branch.isNoConvergentIllusionProxyNode(e.identifier)||this.illuUpdatedProxyNodes.add(e)}},{key:"realUpdateProxyNode",value:function realUpdateProxyNode(e){!this.branch.isNoConvergentRealProxyNode(e.identifier)&&!this.branch.isUpdatedProxyNode(e)&&(this.realUpdatedProxyNodes[e.identifier]=e)}},{key:"addCreatedObject",value:function addCreatedObject(e){e.identifier in this.createdProxyNodes||(this.createdProxyNodes[e.identifier]=e),this.illuUpdatedProxyNodes.add(e)}},{key:"illusionTakeCreatedObject",value:function illusionTakeCreatedObject(e,t){return this.takeCreatedObject(e,t,this.legacyCreatedProxyNodes)}},{key:"realTakeCreatedObject",value:function realTakeCreatedObject(e,t){var i=this.takeCreatedObject(e,t,this.createdProxyNodes);return i&&!this.branch.isUpdatedProxyNode(i)&&(this.realUpdatedProxyNodes[e]=i),i}},{key:"takeCreatedObject",value:function takeCreatedObject(e,t,i){var r=i[e];return r&&(delete i[e],(Ai(r)&&t.constructor!==Array||Ei(r)&&t.constructor!==Object||ft(r)&&t.constructor!==r.struct.classReflection.clazz)&&(r.dispose(),r=void 0)),r}},{key:"completeRebuild",value:function completeRebuild(){for(var e in this.legacyCreatedProxyNodes){this.legacyCreatedProxyNodes[e].dispose(),delete this.legacyCreatedProxyNodes[e]}}},{key:"completeACK",value:function completeACK(){var _this48=this;for(var e in this.realUpdatedProxyNodes){var t=this.realUpdatedProxyNodes[e];_h(t)||this.branch.addNoConvergentRealProxyNode(t),delete this.realUpdatedProxyNodes[e]}this.illuUpdatedProxyNodes.release(function(e){e.realTarget&&!_h(e)&&_this48.branch.addNoConvergentIllusionProxyNode(e)});for(var _e5 in this.createdProxyNodes){this.createdProxyNodes[_e5].dispose(),delete this.createdProxyNodes[_e5]}}}]);return kC}();function He(e){return e instanceof qs}function ng(e){var t=e.__proxy;return t.didDispose?kr.Rejected:t.realTarget?kr.Committed:kr.Uncommitted}var qs=/*#__PURE__*/function(){function qs(e){_classCallCheck(this,qs);Object.defineProperty(this,"__proxy",{value:e,writable:!1,enumerable:!1,configurable:!0})}_createClass(qs,[{key:"toJSON",value:function toJSON(){return this.__proxy.toJSON()}}]);return qs}();function Fa(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!0;Object.defineProperty(e,t,{enumerable:i,configurable:!0,get:function get(){var r=this.__proxy,n=r.proxyRuntime.pullValue(r.displayerTarget()[t]);return r.assertAccessible(),r.touchKey(t),n}})}function sg(e,t){delete e[t]}var er;(function(e){e[e.ReadValue=0]="ReadValue",e[e.ReadByGetter=1]="ReadByGetter",e[e.CanNotReadGetter=2]="CanNotReadGetter",e[e.CanNotReadPrivateValue=3]="CanNotReadPrivateValue",e[e.CanNotReadPrivateGetter=4]="CanNotReadPrivateGetter"})(er||(er={}));var es;(function(e){e[e.NoEffects=0]="NoEffects",e[e.Modifiable=1]="Modifiable",e[e.Private=2]="Private",e[e.EventReceiver=3]="EventReceiver"})(es||(es={}));var xC=/*#__PURE__*/function(){function xC(e){_classCallCheck(this,xC);this.valuePropertiesSet={},this.classReflection=e;var t=[],i=[],r=[],n={};for(var s in e.properties){var o=e.properties[s],a=o.mode===Fn.Value,l=o.decorators.some(function(d){return d===nn}),h=o.decorators.some(function(d){return d===Ks});a&&(n[s]=!0,h?t.push(s):i.push(s)),o.isPublic&&(a||l)&&r.push(s)}this.transientValueProperties=Object.freeze(t),this.serializableValueProperties=Object.freeze(i),this.copyableProperties=Object.freeze(r),this.displayerNodeClass=this.createAkkoDisplayerNodeClass(e),this.valuePropertiesSet=Object.freeze(n),this.propertyKinds=this.createPropertyReadableKinds(e),this.methodKinds=this.createMethodCallableKinds(e)}_createClass(xC,[{key:"isValueProperty",value:function isValueProperty(e){return e in this.valuePropertiesSet}},{key:"getPropertyReadableKind",value:function getPropertyReadableKind(e){return this.propertyKinds[e]}},{key:"getMethodCallableKind",value:function getMethodCallableKind(e){return this.methodKinds[e]}},{key:"getValueOutsideFromProxyNode",value:function getValueOutsideFromProxyNode(e,t){switch(this.propertyKinds[t]){case 0:case 1:return e.proxyRuntime.pullValue(this.getValueFromProxyNode(e,t));case 2:throw new Error("can't read property ".concat(JSON.stringify(t)," unless it has @noEffects"));case 3:case 4:throw new Error("can't read private property ".concat(JSON.stringify(t)));default:return;}}},{key:"getValueFromProxyNode",value:function getValueFromProxyNode(e,t){switch(e.assertAccessible(),this.propertyKinds[t]){case 0:case 3:{var i=e.displayerTarget()[t];return e.touchKey(t),i}case 1:{var _i23=e.proxyRuntime.runtime,r=_i23.observerId,n=e.proxyRuntime.noEffectsIdGenerator,s={authorId:r,mode:it.Outside,timestamp:Date.now(),identifierGenerator:n};return _i23.runWithMagix(s,function(){return e.target()[t]})}default:return;}}},{key:"createAkkoDisplayerNodeClass",value:function createAkkoDisplayerNodeClass(e){var t=/*#__PURE__*/function(_qs){_inherits(t,_qs);var _super17=_createSuper(t);function t(){_classCallCheck(this,t);return _super17.apply(this,arguments)}return t}(qs);var _loop11=function _loop11(i){var r=function r(){var n=this.__proxy,s=n.struct;return n.assertAccessible(),s.getValueOutsideFromProxyNode(n,i)};Object.defineProperty(t.prototype,i,{enumerable:!1,configurable:!1,get:r})};for(var i in e.properties){_loop11(i)}var _loop12=function _loop12(_i24){t.prototype[_i24]=function(){for(var _len12=arguments.length,r=new Array(_len12),_key12=0;_key12<_len12;_key12++){r[_key12]=arguments[_key12]}return this.__proxy.callOutside(_i24,r)}};for(var _i24 in e.methods){_loop12(_i24)}return t}},{key:"createPropertyReadableKinds",value:function createPropertyReadableKinds(e){var t={};for(var i in e.properties){var r=e.properties[i];r.isPublic?r.mode===Fn.Value?t[i]=0:r.decorators.some(function(n){return n===nn})?t[i]=1:t[i]=2:r.mode===Fn.Value?t[i]=3:t[i]=4}return Object.freeze(t)}},{key:"createMethodCallableKinds",value:function createMethodCallableKinds(e){var t={};for(var i in e.methods){var r=e.methods[i];r.isPublic?r.decorators.some(function(n){return xh(n)&&Ih(n.payload)})?t[i]=3:r.decorators.some(function(n){return n===nn})?t[i]=0:t[i]=1:t[i]=2}return Object.freeze(t)}}]);return xC}();function Ir(e,t){return Object.defineProperty(t,Tt,{enumerable:!1,writable:!1,configurable:!0,value:e}),t}function PC(e,t,i){var r=[];for(var n in t){var s=t[n],o=s.isIndex?parseInt(n,10):n,a=s.kind,l=void 0;switch(a){case B.Inserted:{l=e.proxyRuntime.pullValue(s.value);break}case B.Updated:{l=e.proxyRuntime.pullValue(s.value);break}case B.Removed:break;}r.push({key:o,value:l,kind:a})}i(r)}var ts=/*#__PURE__*/function(_qs2){_inherits(ts,_qs2);var _super18=_createSuper(ts);function ts(){_classCallCheck(this,ts);return _super18.apply(this,arguments)}_createClass(ts,null,[{key:"createClass",value:function createClass(_ref19){var e=_ref19.classReflection,t=_ref19.getter,i=_ref19.invoker;var r=/*#__PURE__*/function(_ts){_inherits(r,_ts);var _super19=_createSuper(r);function r(s,o){var _this49;_classCallCheck(this,r);_this49=_super19.call(this,o);Object.defineProperty(_assertThisInitialized(_this49),"__Holder",{value:s,writable:!1,enumerable:!1,configurable:!0});return _this49}return r}(ts);var _loop13=function _loop13(n){Object.defineProperty(r.prototype,n,{enumerable:!1,configurable:!1,get:function get(){return t(n)},set:function set(){throw new Error("cannot set property ".concat(n," which has only a getter"))}})};for(var n in e.properties){_loop13(n)}var _loop14=function _loop14(_n14){r.prototype[_n14]=function(){for(var _len13=arguments.length,s=new Array(_len13),_key13=0;_key13<_len13;_key13++){s[_key13]=arguments[_key13]}return i(_n14,s)}};for(var _n14 in e.methods){_loop14(_n14)}return r}},{key:"updateProxy",value:function updateProxy(e,t){Object.defineProperty(e,Tt,{value:t,writable:!1,enumerable:!1,configurable:!0})}},{key:"getHolder",value:function getHolder(e){return e.__Holder}}]);return ts}(qs),IC=/*#__PURE__*/function(){function IC(e,t){var _this50=this;_classCallCheck(this,IC);this.updatedListeners=[],this.disposedListeners=[],this.dispatchDisposed=function(){var _iterator72=_createForOfIteratorHelper(_this50.disposedListeners),_step72;try{for(_iterator72.s();!(_step72=_iterator72.n()).done;){var i=_step72.value;try{i()}catch(r){console.error(r)}}}catch(err){_iterator72.e(err)}finally{_iterator72.f()}},this.runtime=e,this.onClean=t}_createClass(IC,[{key:"listenUpdated",value:function listenUpdated(e){this.updatedListeners.some(function(t){return t.id===e.id})||this.updatedListeners.push(Object.freeze(Ys({},e)))}},{key:"unlistenUpdated",value:function unlistenUpdated(e){var t=this.updatedListeners.findIndex(function(i){return i.id===e});t!==-1&&(this.updatedListeners.splice(t,1),this.fireRemoveListener())}},{key:"listenDisposed",value:function listenDisposed(e){this.disposedListeners.indexOf(e)===-1&&(this.disposedListeners.push(e),this.disposedListeners.length===1&&this.runtime.listenDisposed(this.dispatchDisposed))}},{key:"unlistenDisposed",value:function unlistenDisposed(e){var t=this.disposedListeners.indexOf(e);t!==-1&&(this.disposedListeners.splice(t,1),this.fireRemoveListener(),this.disposedListeners.length===0&&this.runtime.unlistenDisposed(this.dispatchDisposed))}},{key:"dispatchUpdated",value:function dispatchUpdated(e){var _iterator73=_createForOfIteratorHelper(this.updatedListeners),_step73;try{for(_iterator73.s();!(_step73=_iterator73.n()).done;){var t=_step73.value.listener;try{t(e)}catch(i){console.error(i)}}}catch(err){_iterator73.e(err)}finally{_iterator73.f()}}},{key:"fireRemoveListener",value:function fireRemoveListener(){this.updatedListeners.length===0&&this.disposedListeners.length===0&&(this.runtime.unlistenDisposed(this.dispatchDisposed),this.onClean())}}]);return IC}();function on(e,t){var i=Ua(e),r=e.__proxy;i==null||i.listenUpdated({id:t,listener:function listener(n){return PC(r,n,t)}})}function an(e,t){var i;(i=Ua(e))==null||i.unlistenUpdated(t)}function ja(e,t){var i;(i=Ua(e))==null||i.listenDisposed(t)}function za(e,t){var i;(i=Ua(e))==null||i.unlistenDisposed(t)}function Ua(e){if(!He(e))throw new Error("it isn't akko wrapped object");var t;return e instanceof ts?t=ts.getHolder(e).getListeners():t=e.__proxy.getListeners(),t}var Zs=!1,Gh=It.SingleForward;Q.addListener(function(e,t){if(t){var i=e.proxyRuntime.runtime;Zs=i.isForcesOnIllusionLine(e.mode),Gh=e.forwardMode}else Zs=!1,Gh=It.SingleForward});function Me(e){return e instanceof Js}function $h(e){return _typeof(e)!="object"||e===null?e:e instanceof Js?e.target():e}var Js=/*#__PURE__*/function(){function Js(e,t,i){_classCallCheck(this,Js);this._didDispose=!1,this.listeners=null,this.proxyRuntime=e,this.identifier=t,Zs?this.illuTarget=Ir(this,i):this.realTarget=Ir(this,i)}_createClass(Js,[{key:"didDispose",get:function get(){return this._didDispose}},{key:"assertAccessible",value:function assertAccessible(){if(this._didDispose)throw new Error("akko wrapped object isn't accessible")}},{key:"reportChanged",value:function reportChanged(e){var t;(t=this.listeners)==null||t.dispatchUpdated(e)}},{key:"getValue",value:function getValue(e){return this.target()[e]}},{key:"touchKey",value:function touchKey(e){var t=this.proxyRuntime.observerAdapter;t&&(this.observer||(this.observer=t.create(this.identifier,this.getDebugName())),e===void 0?this.observer.reportObservedIteration():this.observer.reportObservedKey(e))}},{key:"getListeners",value:function getListeners(){var _this51=this;return!this.listeners&&!this._didDispose&&(this.listeners=new IC(this.proxyRuntime,function(){_this51.listeners=null})),this.listeners}},{key:"cleanListeners",value:function cleanListeners(){this.listeners=null}},{key:"dispose",value:function dispose(){this._didDispose=!0,me().unbindDelegate(this),this._displayer&&(this.releaseDisplayer(this._displayer),delete this._displayer,delete this.observer),this.listeners&&(this.listeners=null)}},{key:"target",value:function target(){return Zs?this.illuTarget:this.realTarget}},{key:"displayerTarget",value:function displayerTarget(){return this.illuTarget||this.realTarget}},{key:"displayer",get:function get(){return this._displayer||(this._displayer=this.createDisplayer()),this._displayer}},{key:"toString",value:function toString(){return this.target().toString()}},{key:"toLocaleString",value:function toLocaleString(){return this.target().toLocaleString()}},{key:"sideTarget",value:function sideTarget(){if(Gh===It.DoubleForward&&!Zs)return this.illuTarget}}]);return Js}(),Tt="__proxy",Et;(function(e){e[e.FlatObject=0]="FlatObject",e[e.AkkoObject=1]="AkkoObject",e[e.Array=2]="Array",e[e.HangUpObject=3]="HangUpObject"})(Et||(Et={}));function Va(e){if(Q.currentNode){if(Me(e))return e.identifier;{var t=e[Tt];if(!Me(t))throw new Error("identifier not found");return t.identifier}}else{if(He(e))return e.__proxy.identifier;throw _typeof(e)!="object"?new Error("can not find identifier of ".concat(_typeof(e))):e===null?new Error("can not find identifier of null"):new Error("identifier not found")}}function ft(e){return e instanceof Yh}var Yh=/*#__PURE__*/function(_Js){_inherits(Yh,_Js);var _super20=_createSuper(Yh);function Yh(e,t,i,r){var _this52;_classCallCheck(this,Yh);_this52=_super20.call(this,e,t,i);_this52.struct=r;return _this52}_createClass(Yh,[{key:"getDebugName",value:function getDebugName(){return this.struct.classReflection.name}},{key:"createDisplayer",value:function createDisplayer(){var e=this.struct.displayerNodeClass;return new e(this)}},{key:"kind",get:function get(){return Et.AkkoObject}},{key:"clazz",get:function get(){return this.struct.classReflection.clazz}},{key:"updateDisplayer",value:function updateDisplayer(e){}},{key:"reportChanged",value:function reportChanged(e){_get(_getPrototypeOf(Yh.prototype),"reportChanged",this).call(this,e);var t=this.observer;if(t)for(var i in e){var _e$i=e[i],r=_e$i.kind,n=_e$i.value;t.reportChanged(i,n,r)}}},{key:"converge",value:function converge(){var e=this.realTarget;if(e){var t={};var _iterator74=_createForOfIteratorHelper(this.struct.serializableValueProperties),_step74;try{for(_iterator74.s();!(_step74=_iterator74.n()).done;){var i=_step74.value;i in e&&(t[i]=e[i])}}catch(err){_iterator74.e(err)}finally{_iterator74.f()}Object.setPrototypeOf(t,this.struct.classReflection.clazz.prototype),this.replaceIlluTarget(t)}}},{key:"replaceIlluTarget",value:function replaceIlluTarget(e){var t=this.illuTarget||this.realTarget,i=Ir(this,e);this.illuTarget=i;var r=me();var _iterator75=_createForOfIteratorHelper(this.struct.serializableValueProperties),_step75;try{for(_iterator75.s();!(_step75=_iterator75.n()).done;){var n=_step75.value;var s=(n in t),o=(n in i);o&&!s?r.addProperty(this,n,i[n]):!o&&s?r.removeProperty(this,n):o&&s&&i[n]!==t[n]&&r.setProperty(this,n,i[n])}}catch(err){_iterator75.e(err)}finally{_iterator75.f()}}},{key:"getMethod",value:function getMethod(e){return this.target()[e]}},{key:"touchKey",value:function touchKey(e){switch(this.struct.getPropertyReadableKind(e)){case er.ReadValue:case er.CanNotReadPrivateValue:{_get(_getPrototypeOf(Yh.prototype),"touchKey",this).call(this,e);break}}}},{key:"callOutside",value:function callOutside(e,t){this.assertAccessible();var i;switch(this.struct.getMethodCallableKind(e)){case es.NoEffects:{var r=this.proxyRuntime.cache;r?i=r.valueWithArgs(this,this.identifier,e,t,this.callNoEffectsMethod):i=this.callNoEffectsMethod(e,t);break}case es.Modifiable:{if(this.struct.classReflection.isRootClass)i=this.proxyRuntime.rootObject.onInvokedTriggerMethod(e,t);else throw new Error("can only call modifiable methods of trigger object");break}case es.EventReceiver:throw new Error("can't invoke event receiver. you should call dispatch()");case es.Private:throw new Error("can't invoke private method");default:{var _3;(_3=void 0)[e].apply(_3,_toConsumableArray(t));break}}return this.proxyRuntime.pullValue(i)}},{key:"callNoEffectsMethod",value:function callNoEffectsMethod(e,t){var _this53=this;var i=this.proxyRuntime.runtime,r=i.observerId,n=this.proxyRuntime.noEffectsIdGenerator,s={authorId:r,mode:it.Outside,timestamp:Date.now(),identifierGenerator:n};return i.runWithMagix(s,function(){var o=_this53.target(),a=o[e],l=_this53.proxyRuntime.pushValues(n,t,!1);return a.apply(o,l)})}},{key:"setValue",value:function setValue(e,t){var i=this.target();if(this.struct.isValueProperty(e)){var r=i[e],n=(e in i);i[e]=t,n?r!==t&&me().setProperty(this,e,t):me().addProperty(this,e,t);var s=this.sideTarget();return s&&(s[e]=t),t}else return i[e]=t}},{key:"postfix",value:function postfix(e,t){var i=this.target();if(this.struct.isValueProperty(e)){var r=i[e],n=(e in i),s=i[e]+=t;n?r!==s&&me().setProperty(this,e,s):me().addProperty(this,e,s);var o=this.sideTarget();return o&&(o[e]=s),s}else return i[e]+=t}},{key:"prefix",value:function prefix(e,t){var i=this.target(),r=i[e];if(this.struct.isValueProperty(e)){var n=(e in i),s=i[e]+=t;n?r!==s&&me().setProperty(this,e,s):me().addProperty(this,e,s);var o=this.sideTarget();o&&(o[e]=s)}else i[e]+=t;return r}},{key:"removeKey",value:function removeKey(e){if(this.struct.isValueProperty(e)){var t=this.target(),i=(e in t);if(i){delete t[e],me().removeProperty(this,e);var r=this.sideTarget();r&&delete r[e]}return i}else return!1}},{key:"toJSON",value:function toJSON(){var e={};var _iterator76=_createForOfIteratorHelper(this.struct.copyableProperties),_step76;try{for(_iterator76.s();!(_step76=_iterator76.n()).done;){var t=_step76.value;e[t]=this[t]}}catch(err){_iterator76.e(err)}finally{_iterator76.f()}return e}},{key:"releaseDisplayer",value:function releaseDisplayer(e){}}]);return Yh}(Js),og=/*#__PURE__*/function(_Js2){_inherits(og,_Js2);var _super21=_createSuper(og);function og(){_classCallCheck(this,og);return _super21.apply(this,arguments)}_createClass(og,[{key:"getDebugName",value:function getDebugName(){return"Object"}},{key:"createDisplayer",value:function createDisplayer(){var e=new qs(this);for(var t in this.displayerTarget()){Fa(e,t)}return e}},{key:"updateDisplayer",value:function updateDisplayer(e){var t=this._displayer;if(t)for(var i in e){switch(e[i].kind){case B.Inserted:{Fa(t,i);break}case B.Removed:{sg(t,i);break}}}}},{key:"reportChanged",value:function reportChanged(e){_get(_getPrototypeOf(og.prototype),"reportChanged",this).call(this,e);var t=this.observer;if(t)for(var i in e){var _e$i2=e[i],r=_e$i2.kind,n=_e$i2.value;t.reportChanged(i,n,r)}}},{key:"clazz",get:function get(){return Object}},{key:"converge",value:function converge(){this.realTarget&&this.replaceIlluTarget(Ys({},this.realTarget))}},{key:"replaceIlluTarget",value:function replaceIlluTarget(e){var t=this.illuTarget||this.realTarget,i=Ir(this,e);this.illuTarget=i;var r=me();for(var n in i){var s=i[n];n in t?t[n]!==s&&r.setProperty(this,n,s):r.addProperty(this,n,s)}for(var _n15 in t){_n15 in i||r.removeProperty(this,_n15)}}},{key:"getMethod",value:function getMethod(e){return this.target()[e]}},{key:"setValue",value:function setValue(e,t){var i=this.target(),r=this.sideTarget(),n=i[e],s=(e in i);return i[e]=t,s?n!==t&&me().setProperty(this,e,t):me().addProperty(this,e,t),r&&(r[e]=t),t}},{key:"prefix",value:function prefix(e,t){var i=this.target(),r=this.sideTarget(),n=i[e],s=(e in i),o=i[e]+=t;return s?n!==o&&me().setProperty(this,e,o):me().addProperty(this,e,o),r&&(r[e]=o),o}},{key:"postfix",value:function postfix(e,t){var i=this.target(),r=this.sideTarget(),n=i[e],s=(e in i),o=i[e]+=t;return s?n!==o&&me().setProperty(this,e,o):me().addProperty(this,e,o),r&&(r[e]=o),n}},{key:"removeKey",value:function removeKey(e){var t=this.target(),i=(e in t);if(i){delete t[e];var r=this.sideTarget();me().removeProperty(this,e),r&&delete r[e]}return i}},{key:"toJSON",value:function toJSON(){var e=this.displayerTarget(),t={};for(var i in e){t[i]=e[i]}return t}},{key:"releaseDisplayer",value:function releaseDisplayer(e){}}]);return og}(Js);function Ei(e){return e instanceof ag}var ag=/*#__PURE__*/function(_og){_inherits(ag,_og);var _super22=_createSuper(ag);function ag(){_classCallCheck(this,ag);return _super22.apply(this,arguments)}_createClass(ag,[{key:"kind",get:function get(){return Et.FlatObject}},{key:"covertToAkkoObjectProxyNode",value:function covertToAkkoObjectProxyNode(e){var t=this,i=this.realTarget,r=this.illuTarget;return t.struct=this.proxyRuntime.getAkkoObjectStruct(e),t._displayer=void 0,Object.setPrototypeOf(t,Yh.prototype),Object.setPrototypeOf(i,e.clazz.prototype),r&&Object.setPrototypeOf(r,e.clazz.prototype),t}}]);return ag}(og),lg=/*#__PURE__*/function(){function lg(e){_classCallCheck(this,lg);this.index=0,this.proxy=e,this.length=e.proxyRuntime.pullValue(e.displayerTarget().length),e.assertAccessible(),e.touchKey("length")}_createClass(lg,[{key:Symbol.iterator,value:function value(){return new lg(this.proxy)}},{key:"next",value:function next(){if(this.index>=this.length)return{value:void 0,done:!0};{var e=this.proxy.displayerTarget()[this.index],t=this.proxy.proxyRuntime.pullValue(e);return this.proxy.assertAccessible(),this.proxy.touchKey(this.index),this.index+=1,{value:t,done:!1}}}}]);return lg}(),Fe=/*#__PURE__*/function(_qs3){_inherits(Fe,_qs3);var _super23=_createSuper(Fe);function Fe(e){var _this54;_classCallCheck(this,Fe);_this54=_super23.call(this,e);var t=e.displayerTarget();for(var i=0;i<t.length;++i){Fa(_assertThisInitialized(_this54),i)}return _this54}_createClass(Fe,[{key:"concat",value:function concat(){var t=Fe.unwrapToPureArray(this);for(var _len14=arguments.length,e=new Array(_len14),_key14=0;_key14<_len14;_key14++){e[_key14]=arguments[_key14]}for(var i=0;i<e.length;++i){e[i]=Fe.unwrapToPureArray(e[i])}return Array.prototype.concat(t,e)}},{key:"every",value:function every(e,t){var _this55=this;var i=this.__proxy.proxyRuntime,r=function r(n,s){return e.call(t,i.pullValue(n),s,_this55)};return Array.prototype.every.call(this.__proxy.displayerTarget(),r)}},{key:"filter",value:function filter(e,t){var _this56=this;var i=this.__proxy.proxyRuntime,r=function r(n,s){return e.call(t,i.pullValue(n),s,_this56)};return Array.prototype.filter.call(this.__proxy.displayerTarget(),r)}},{key:"find",value:function find(e,t){var _this57=this;var i=this.__proxy.proxyRuntime,r=function r(s,o){return e.call(t,i.pullValue(s),o,_this57)},n=Array.prototype.find.call(this.__proxy.displayerTarget(),r);return i.pullValue(n)}},{key:"findIndex",value:function findIndex(e,t){var _this58=this;var i=this.__proxy.proxyRuntime,r=function r(n,s){return e.call(t,i.pullValue(n),s,_this58)};return Array.prototype.findIndex.call(this.__proxy.displayerTarget(),r)}},{key:"forEach",value:function forEach(e,t){var _this59=this;var i=this.__proxy.proxyRuntime,r=function r(n,s){e.call(t,i.pullValue(n),s,_this59)};Array.prototype.forEach.call(this.__proxy.displayerTarget(),r)}},{key:"indexOf",value:function indexOf(e,t){var i=e;return He(i)&&(i=i.__proxy),Array.prototype.indexOf.call(this.__proxy.displayerTarget(),i,t)}},{key:"lastIndexOf",value:function lastIndexOf(e,t){var i=e;return He(i)&&(i=i.__proxy),Array.prototype.lastIndexOf.call(this.__proxy.displayerTarget(),i,t)}},{key:"join",value:function join(e){return Array.prototype.join.call(this.__proxy.displayerTarget(),e)}},{key:"map",value:function map(e,t){var _this60=this;var i=this.__proxy.proxyRuntime,r=function r(n,s){return e.call(t,i.pullValue(n),s,_this60)};return Array.prototype.map.call(this.__proxy.displayerTarget(),r)}},{key:"reduce",value:function reduce(e,t){var _this61=this;var i=this.__proxy.proxyRuntime,r=t,n=function n(s,o,a){var l=s;return r!==l&&(l=i.pullValue(l)),r=e(l,i.pullValue(o),a,_this61),r};return Array.prototype.reduce.call(this.__proxy.displayerTarget(),n,t)}},{key:"reduceRight",value:function reduceRight(e,t){var _this62=this;var i=this.__proxy.proxyRuntime,r=t,n=function n(s,o,a){var l=s;return r!==l&&(l=i.pullValue(l)),r=e(l,i.pullValue(o),a,_this62),r};return Array.prototype.reduceRight.call(this.__proxy.displayerTarget(),n,t)}},{key:"slice",value:function slice(e,t){var i=this.__proxy.proxyRuntime,r=Array.prototype.slice.call(this.__proxy.displayerTarget(),e,t);for(var n=0;n<r.length;++n){r[n]=i.pullValue(r[n])}return r}},{key:"some",value:function some(e,t){var _this63=this;var i=this.__proxy.proxyRuntime,r=function r(n,s){return e.call(t,i.pullValue(n),s,_this63)};return Array.prototype.some.call(this.__proxy.displayerTarget(),r)}},{key:"toString",value:function toString(){return Array.prototype.toString.apply(this.__proxy.displayerTarget())}},{key:"copyWithin",value:function copyWithin(){Fe.throwImmutableError()}},{key:"fill",value:function fill(){Fe.throwImmutableError()}},{key:"pop",value:function pop(){Fe.throwImmutableError()}},{key:"push",value:function push(){Fe.throwImmutableError()}},{key:"reverse",value:function reverse(){Fe.throwImmutableError()}},{key:"shift",value:function shift(){Fe.throwImmutableError()}},{key:"splice",value:function splice(){Fe.throwImmutableError()}},{key:"unshift",value:function unshift(){Fe.throwImmutableError()}},{key:"sort",value:function sort(){Fe.throwImmutableError()}},{key:"entries",value:function entries(){Fe.throwBanMethodError()}},{key:"keys",value:function keys(){Fe.throwBanMethodError()}},{key:"values",value:function values(){Fe.throwBanMethodError()}}],[{key:"refreshLength",value:function refreshLength(e,t){var i=t;for(;(i in e);){sg(e,i),i+=1}if(i===t)for(i=t-1;i>=0&&!(i in e);){Fa(e,i),i-=1}}},{key:"unwrapToPureArray",value:function unwrapToPureArray(e){if(e instanceof Fe){var _e$__proxy$displayerT=e.__proxy.displayerTarget(),t=_e$__proxy$displayerT.length,i=new Array(t);for(var r=0;r<t;++r){i[r]=e[r]}return i}else return e}},{key:"throwImmutableError",value:function throwImmutableError(){throw new Error("it is immutable")}},{key:"throwBanMethodError",value:function throwBanMethodError(){throw new Error("ban method")}}]);return Fe}(qs);Object.defineProperty(Fe.prototype,"length",{enumerable:!1,configurable:!0,get:function get(){var e=this.__proxy,t=e.proxyRuntime.pullValue(e.displayerTarget().length);return e.touchKey("length"),t}});typeof Symbol!="undefined"&&typeof Symbol.iterator!="undefined"&&Object.defineProperty(Fe.prototype,Symbol.iterator,{enumerable:!1,configurable:!0,writable:!1,value:function value(){return new lg(this.__proxy)}});function Ai(e){return e instanceof Qh}var Xh=/*#__PURE__*/function(_Js3){_inherits(Xh,_Js3);var _super24=_createSuper(Xh);function Xh(){var _this64;_classCallCheck(this,Xh);_this64=_super24.apply(this,arguments);_this64.equalsCount=0;return _this64}_createClass(Xh,[{key:"getDebugName",value:function getDebugName(){return"Array"}},{key:"createDisplayer",value:function createDisplayer(){return new Fe(this)}},{key:"kind",get:function get(){return Et.Array}},{key:"clazz",get:function get(){return Array}},{key:"updateDisplayer",value:function updateDisplayer(e){var t=this._displayer,i=e.length;t&&i&&Fe.refreshLength(t,i.value)}},{key:"reportChanged",value:function reportChanged(e){_get(_getPrototypeOf(Xh.prototype),"reportChanged",this).call(this,e);var t=this.observer;if(t){var i=e.length;i&&t.reportChanged("length",i.value,i.kind);for(var r in e){var _e$r=e[r],n=_e$r.kind,s=_e$r.value,o=_e$r.isIndex;o&&t.reportChanged(parseInt(r,10),s,n)}}}},{key:"converge",value:function converge(){this.realTarget&&(this.replaceIlluTarget(_toConsumableArray(this.realTarget)),this.equalsCount=this.realTarget.length)}},{key:"replaceIlluTarget",value:function replaceIlluTarget(e){var t=this.illuTarget||this.realTarget,i=Ir(this,e);this.illuTarget=i;var r=Math.min(t.length,i.length),n=me();for(var s=0;s<r;++s){t[s]!==i[s]&&n.setProperty(this,s,i[s])}this.refreshLength(t.length,i),this.equalsCount=0}},{key:"getMethod",value:function getMethod(e){return Xh.arrayValidMethods[e]}},{key:"getValue",value:function getValue(e){return typeof e=="number"?this.target()[e]:e==="length"?this.target().length:void 0}},{key:"setValue",value:function setValue(e,t){var i=this.target(),r=i.length;if(typeof e=="number"){if(e>=0){var n=e in i&&i[e]!==t,s=i[e]=t;n&&me().setProperty(this,e,t);var o=this.sideTarget();return this.refreshLength(r,i),o&&(o[e]=t),e<this.equalsCount&&(this.equalsCount=e),s}else return t;}else return i[e]}},{key:"removeKey",value:function removeKey(e){return!1}},{key:"prefix",value:function prefix(e,t){if(typeof e=="number"){var i=this.target(),r=this.sideTarget(),n=(e in i),s=i.length,o=i[e],a=i[e]+=t;return n&&a!==o&&me().setProperty(this,e,a),this.refreshLength(s,i),r&&(r[e]=a),e<this.equalsCount&&(this.equalsCount=e),a}else return}},{key:"postfix",value:function postfix(e,t){if(typeof e=="number"){var i=this.target(),r=this.sideTarget(),n=(e in i),s=i.length,o=i[e],a=i[e]+=t;return n&&a!==o&&me().setProperty(this,e,a),this.refreshLength(s,i),r&&(r[e]=a),e<this.equalsCount&&(this.equalsCount=e),o}else return}},{key:"toJSON",value:function toJSON(){var e=this.displayerTarget(),t=[];for(var i=0;i<e.length;++i){t[i]=e[i]}return t}},{key:"releaseDisplayer",value:function releaseDisplayer(e){}},{key:"refreshLength",value:function refreshLength(e,t){if(e!==t.length){var i=this.sideTarget(),r=me();if(e>t.length){i&&i.splice(t.length);for(var n=t.length;n<e;++n){r.removeProperty(this,n)}}else for(var _n16=e;_n16<t.length;++_n16){i&&(i[_n16]=t[_n16]),r.addProperty(this,_n16,t[_n16])}r.setProperty(this,"length",t.length)}}}],[{key:"createArrayValidMethods",value:function createArrayValidMethods(){var e,t,i;Q.addListener(function(s,o){o&&s.tools?(e=s.tools.idGenerator,t=s.coreFunctions.updater,i=s.coreFunctions.creator):(e=void 0,t=void 0,i=void 0)});var r=function r(s,o){return s===o?s[Tt]:i(o,e.generate())},n={};var _iterator77=_createForOfIteratorHelper(Yf),_step77;try{var _loop15=function _loop15(){var _step77$value=_step77.value,s=_step77$value.methodName,o=_step77$value.returnArray,a=_step77$value.lengthChanged,l=_step77$value.elementChanged,h=_step77$value.touchLength,d=_step77$value.cleanEqualsCount,u=_step77$value.pickTouchedSegment;var p=Array.prototype[s],f=a||l;n[s]=function(){for(var _len15=arguments.length,m=new Array(_len15),_key15=0;_key15<_len15;_key15++){m[_key15]=arguments[_key15]}var g=this,y=g.length,b=g[Tt],v=p.apply(g,m);if(f&&!Da(b))throw new Error("Magix is frozen, you can't call Array.".concat(s,"()"));var w=u&&u(g,m);if(a&&b.refreshLength(y,g),w){var M=Math.min(g.length,w.beginIndex+w.length),x=b.sideTarget(),T=me();for(var O=w.beginIndex;O<M;++O){if(l){var R=g[O];x&&(x[O]=R),T.setProperty(b,O,R)}b.touchKey(O)}}return h&&b.touchKey(),d&&(b.equalsCount=0),f&&t(b),o?r(g,v):v}};for(_iterator77.s();!(_step77=_iterator77.n()).done;){_loop15()}}catch(err){_iterator77.e(err)}finally{_iterator77.f()}return Object.freeze(n)}}]);return Xh}(Js),Qh=Xh;Qh.arrayValidMethods=Xh.createArrayValidMethods();function qh(e){return e instanceof cg}var cg=/*#__PURE__*/function(_og2){_inherits(cg,_og2);var _super25=_createSuper(cg);function cg(){_classCallCheck(this,cg);return _super25.apply(this,arguments)}_createClass(cg,[{key:"version",get:function get(){return this._version}},{key:"objectFormatId",get:function get(){return this._objectFormatId}},{key:"setHangMetadata",value:function setHangMetadata(e){if(this._version||this._objectFormatId)throw new Error("did set version");this._version=e.version,this._objectFormatId=e.objectFormatId}},{key:"kind",get:function get(){return Et.HangUpObject}}]);return cg}(og),hg;(function(e){e[e.ExportsPropertyMode=0]="ExportsPropertyMode",e[e.SerializablePropertyMode=1]="SerializablePropertyMode"})(hg||(hg={}));function dg(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=arguments.length>2?arguments[2]:undefined;return new MC(t,i).copyValue(e)}var MC=/*#__PURE__*/function(){function MC(e,t){_classCallCheck(this,MC);this.mode=e,this.creator=t,this.copedObjectMap={}}_createClass(MC,[{key:"copyValue",value:function copyValue(e){return He(e)?this.copyProxyNode(e.__proxy):Me(e)?this.copyProxyNode(e):e}},{key:"copyProxyNode",value:function copyProxyNode(e){var t=e.identifier,i=this.copedObjectMap[t];if(!i){var r=e.displayerTarget();if(Ei(e)){var n={};this.copedObjectMap[t]=i=n;for(var s in r){n[s]=this.copyInsideValue(e.proxyRuntime,r[s])}}else if(ft(e)){var _n17=e.struct,_s8=this.createAkkoObject(_n17.classReflection.clazz);this.copedObjectMap[t]=i=_s8;var _iterator78=_createForOfIteratorHelper(this.getPropertiesToCopy(e)),_step78;try{for(_iterator78.s();!(_step78=_iterator78.n()).done;){var o=_step78.value;_s8[o]=this.copyInsideValue(e.proxyRuntime,_n17.getValueFromProxyNode(e,o))}}catch(err){_iterator78.e(err)}finally{_iterator78.f()}}else if(Ai(e)){var _n18=r.length,_s9=[];this.copedObjectMap[t]=i=_s9;for(var _o10=0;_o10<_n18;++_o10){_s9[_o10]=this.copyInsideValue(e.proxyRuntime,r[_o10])}}}return i}},{key:"getPropertiesToCopy",value:function getPropertiesToCopy(e){switch(this.mode){case 0:return e.struct.copyableProperties;case 1:return e.struct.serializableValueProperties;default:throw new Error("invalid mode ".concat(this.mode));}}},{key:"createAkkoObject",value:function createAkkoObject(e){return this.creator?this.creator(e):{}}},{key:"copyInsideValue",value:function copyInsideValue(e,t){return _typeof(t)!="object"||t===null?t:Me(t)?this.copyProxyNode(t):we(t)?t.readonly?t:t.slice():e.escapeObjectFilter(t)?t:void 0}}]);return MC}(),Kt;Q.addListener(function(e,t){t&&e.tools?Kt=e.coreFunctions:Kt=null});function TC(e){return new EC().copyValue(e)}var EC=/*#__PURE__*/function(){function EC(){_classCallCheck(this,EC);this.copedObjectMap={}}_createClass(EC,[{key:"copyValue",value:function copyValue(e){return Me(e)?this.copyProxyNode(e):e}},{key:"copyProxyNode",value:function copyProxyNode(e){var t=e.identifier,i=this.copedObjectMap[t];if(!i)if(Ei(e)||qh(e)){var r=Kt.creator({});this.copedObjectMap[t]=i=r;for(var n in Kt.unwrapper(e)){var s=this.copyValue(Kt.getter(e,n));Kt.setter(i,n,s)}}else if(ft(e)){var _r18=e.struct,_n19={};Object.setPrototypeOf(_n19,_r18.classReflection.clazz.prototype);var _s10=Kt.creator(_n19);this.copedObjectMap[t]=i=_s10;var _iterator79=_createForOfIteratorHelper(_r18.serializableValueProperties),_step79;try{for(_iterator79.s();!(_step79=_iterator79.n()).done;){var o=_step79.value;var a=this.copyValue(Kt.getter(e,o));Kt.setter(_s10,o,a)}}catch(err){_iterator79.e(err)}finally{_iterator79.f()}}else if(Ai(e)){var _r19=Kt.getter(e,"length"),_n20=Kt.creator([]);this.copedObjectMap[t]=i=_n20;for(var _s11=0;_s11<_r19;++_s11){var _o11=this.copyValue(Kt.getter(e,_s11));Kt.setter(_n20,_s11,_o11)}}else throw new Error("invalid proxy node");return i}}]);return EC}(),AC=/*#__PURE__*/function(){function AC(e,t){var _this65=this;_classCallCheck(this,AC);this.listeners=new OC,this.didDispose=!1,this.getProperty=function(i){var r,n=_this65._akkoProxyNode.proxyRuntime;switch(_this65.struct.getPropertyReadableKind(i)){case er.ReadValue:{r=n.pullValue(_this65._akkoProxyNode.displayerTarget()[i]),_this65.touchKey(i);break}case er.ReadByGetter:{var s=n.cache;s?r=s.valueWithKey(_this65,_this65._akkoProxyNode.identifier,i,_this65.readByGetter):r=_this65.readByGetter(i),_this65.touchKey(Tt);break}case er.CanNotReadGetter:throw new Error("can't read property ".concat(JSON.stringify(i)," unless it has @noEffects"));case er.CanNotReadPrivateValue:case er.CanNotReadPrivateGetter:throw new Error("can't read private property ".concat(JSON.stringify(i)));}return r},this.readByGetter=function(i){var r=_this65._akkoProxyNode.proxyRuntime,n=r.runtime,s=n.observerId,o=r.noEffectsIdGenerator,a={authorId:s,mode:it.Outside,timestamp:Date.now(),identifierGenerator:o},l=n.runWithMagix(a,function(){return _this65._akkoProxyNode.target()[i]});return r.pullValue(l)},this.invokeMethod=function(i,r){var n=_this65._akkoProxyNode.callOutside(i,r);return _this65.touchKey(Tt),n},this.onAkkoProxyNodeUpdated=function(i){if(_this65.observer){for(var r in i){var _i$r=i[r],n=_i$r.kind,s=_i$r.value;_this65.observer.reportChanged(r,s,n)}_this65.listeners.dispatchUpdated(i)}},this.struct=e.struct,this.observerAdapter=t,this._akkoProxyNode=e,this.displayer=this.createDisplayer(e),this.valueProperties=Object.freeze([].concat(_toConsumableArray(this.struct.transientValueProperties),_toConsumableArray(this.struct.serializableValueProperties))),this.listenUpdated(e)}_createClass(AC,[{key:"dispose",value:function dispose(){this.didDispose||(this.unlistenUpdate(this._akkoProxyNode),this.listeners.dispatchDisposed(),this.didDispose=!0)}},{key:"getListeners",value:function getListeners(){return this.listeners}},{key:"akkoProxyNode",get:function get(){return this._akkoProxyNode},set:function set(e){var _this66=this;this._akkoProxyNode!==e&&(this.unlistenUpdate(this._akkoProxyNode),this.observerAdapter?this.observerAdapter.observeUpdate(function(){_this66.compareAndReportUpdated(_this66._akkoProxyNode,e),_this66._akkoProxyNode=e,ts.updateProxy(_this66.displayer,e)}):(this.compareAndReportUpdated(this._akkoProxyNode,e),this._akkoProxyNode=e,ts.updateProxy(this.displayer,e)),this.listenUpdated(this.akkoProxyNode))}},{key:"compareAndReportUpdated",value:function compareAndReportUpdated(e,t){var i=this.compareAndGetUpdatedObject(e,t);if(this.observer){for(var r in i){var _i$r2=i[r],n=_i$r2.value,s=_i$r2.kind;this.observer.reportChanged(r,n,s)}this.observer.reportChanged(Tt,t,B.Updated)}this.listeners.dispatchUpdated(i)}},{key:"compareAndGetUpdatedObject",value:function compareAndGetUpdatedObject(e,t){var i=e.displayerTarget(),r=t.displayerTarget(),n={};var _iterator80=_createForOfIteratorHelper(this.valueProperties),_step80;try{for(_iterator80.s();!(_step80=_iterator80.n()).done;){var s=_step80.value;var o=(s in i),a=(s in r),l=typeof s=="number",h=null;o&&!a?h={isIndex:l,kind:B.Removed,value:void 0}:!o&&a?h={isIndex:l,kind:B.Inserted,value:r[s]}:i[s]!==r[s]&&(h={isIndex:l,kind:B.Updated,value:r[s]}),h&&(n[s]=h)}}catch(err){_iterator80.e(err)}finally{_iterator80.f()}return n}},{key:"createDisplayer",value:function createDisplayer(e){var t=ts.createClass({classReflection:e.struct.classReflection,getter:this.getProperty,invoker:this.invokeMethod});return new t(this,e)}},{key:"listenUpdated",value:function listenUpdated(e){var t;(t=e.getListeners())==null||t.listenUpdated({id:this.onAkkoProxyNodeUpdated,listener:this.onAkkoProxyNodeUpdated})}},{key:"unlistenUpdate",value:function unlistenUpdate(e){var t;(t=e.getListeners())==null||t.unlistenUpdated(this.onAkkoProxyNodeUpdated)}},{key:"touchKey",value:function touchKey(e){var t=this.observerAdapter;if(t){if(!this.observer){var i=this._akkoProxyNode.identifier;this.observer=t.create(i,"AkkoDisplayerHolder")}this.observer.reportObservedKey(e)}}}]);return AC}(),OC=/*#__PURE__*/function(){function OC(){_classCallCheck(this,OC);this.updatedListeners=[],this.disposedListeners=[]}_createClass(OC,[{key:"listenUpdated",value:function listenUpdated(e){this.updatedListeners.some(function(t){return t.id===e.id})||this.updatedListeners.push(Object.freeze(Ys({},e)))}},{key:"unlistenUpdated",value:function unlistenUpdated(e){var t=this.updatedListeners.findIndex(function(i){return i.id===e});t!==-1&&this.updatedListeners.splice(t,1)}},{key:"listenDisposed",value:function listenDisposed(e){this.disposedListeners.indexOf(e)===-1&&this.disposedListeners.push(e)}},{key:"unlistenDisposed",value:function unlistenDisposed(e){var t=this.disposedListeners.indexOf(e);t!==-1&&this.disposedListeners.splice(t,1)}},{key:"dispatchUpdated",value:function dispatchUpdated(e){var _iterator81=_createForOfIteratorHelper(this.updatedListeners),_step81;try{for(_iterator81.s();!(_step81=_iterator81.n()).done;){var t=_step81.value.listener;try{t(e)}catch(i){console.error(i)}}}catch(err){_iterator81.e(err)}finally{_iterator81.f()}}},{key:"dispatchDisposed",value:function dispatchDisposed(){var _iterator82=_createForOfIteratorHelper(this.disposedListeners),_step82;try{for(_iterator82.s();!(_step82=_iterator82.n()).done;){var e=_step82.value;try{e()}catch(t){console.error(t)}}}catch(err){_iterator82.e(err)}finally{_iterator82.f()}}}]);return OC}(),ui=null;Q.addListener(function(e,t){t?ui=e.coreFunctions:ui=null});var RC=/*#__PURE__*/function(){function RC(){_classCallCheck(this,RC)}_createClass(RC,[{key:"isValidObject",value:function isValidObject(e){return ft(e)}},{key:"isDisplayerObject",value:function isDisplayerObject(e){return He(e)}},{key:"identifier",value:function identifier(e){return e.identifier}},{key:"kind",value:function kind(e){if(ft(e))return Be.AkkoObject;if(Ei(e))return Be.FlatObject;if(Ai(e))return Be.Array;if(He(e))return Be.Displayer;throw new Error("unrecognized proxy node")}},{key:"forEach",value:function forEach(e,t){if(Ei(e)){var i=e.target();for(var r in i){t(i[r],r)}}else if(Ai(e)){var _i25=e.target();for(var _r20=0;_r20<_i25.length;++_r20){t(_i25[_r20],_r20)}}else if(ft(e)){var _i26=e.target(),_r21=e.struct;var _iterator83=_createForOfIteratorHelper(_r21.serializableValueProperties),_step83;try{for(_iterator83.s();!(_step83=_iterator83.n()).done;){var n=_step83.value;t(_i26[n],n)}}catch(err){_iterator83.e(err)}finally{_iterator83.f()}}}},{key:"createObject",value:function createObject(e,t){return ui.creator(t,e)}},{key:"wrapDisplayer",value:function wrapDisplayer(e,t){return t.displayer}},{key:"unwrapDisplayer",value:function unwrapDisplayer(e,t){return t.__proxy}},{key:"getClassReflection",value:function getClassReflection(e){var t=e;if(He(t)&&(t=t.__proxy),!!ft(t))return t.struct.classReflection}},{key:"override",value:function override(e,t,i){if(Ei(e)){for(var r in ui.unwrapper(e)){r in t||ui.remover(e,r)}for(var _r22 in t){ui.setter(e,_r22,t[_r22])}}else if(Ai(e)){var _r23=t,n=ui.getter(e,"length");_r23.length>n&&ui.caller(e,"splice",[n]);for(var s=0;s<_r23.length;++s){ui.setter(e,s,_r23[s])}}else if(ft(e)){var _r24=e.proxyRuntime.getAkkoObjectStruct(i);var _iterator84=_createForOfIteratorHelper(_r24.transientValueProperties),_step84;try{for(_iterator84.s();!(_step84=_iterator84.n()).done;){var _n21=_step84.value;ui.remover(e,_n21)}}catch(err){_iterator84.e(err)}finally{_iterator84.f()}var _iterator85=_createForOfIteratorHelper(_r24.serializableValueProperties),_step85;try{for(_iterator85.s();!(_step85=_iterator85.n()).done;){var _n22=_step85.value;ui.setter(e,_n22,t[_n22])}}catch(err){_iterator85.e(err)}finally{_iterator85.f()}}}},{key:"displayerPhase",value:function displayerPhase(e){if(He(e))return ng(e);throw new Error("it isn't akko wrapped object")}},{key:"copyDisplayer",value:function copyDisplayer(e){return dg(e)}}]);return RC}();function is(e,t,i){return new ag(e,t,i)}function eo(e,t,i,r){return new Yh(e,t,i,r)}function rs(e,t,i){return new Qh(e,t,i)}function NC(e,t,i){return new cg(e,t,i)}var Wa;Q.addListener(function(e,t){t?Wa=e.coreFunctions.creator:Wa=void 0});var LC=/*#__PURE__*/function(){function LC(e,t){_classCallCheck(this,LC);this.decorateObjectEnums=Object.freeze([ie.Object]),this.proxyRuntime=e,this.covertIdToClass=t}_createClass(LC,[{key:"createObject",value:function createObject(e,t){if(t===ie.HangUpObject)return NC(this.proxyRuntime,e,{});{var i=t===ie.Array?[]:{};return Wa?Wa(i,e):Zf(this.proxyRuntime,i,e)}}},{key:"findIdentifier",value:function findIdentifier(e){var t=e.identifier;if(t===void 0)throw Me(e)?new Error("can't find identifier of proxy node"):new Error("object should be proxy node");return t}},{key:"findHangUpMetadata",value:function findHangUpMetadata(e){if(!qh(e))throw new Error("it's not hang up object");return e}},{key:"checkObjectEnum",value:function checkObjectEnum(e){switch(e.kind){case Et.Array:return ie.Array;case Et.AkkoObject:case Et.FlatObject:return ie.Object;case Et.HangUpObject:return ie.HangUpObject;default:throw new Error("unrecognized object");}}},{key:"keys",value:function keys(e){return Object.keys(e.target())}},{key:"length",value:function length(e){if(Ai(e))return e.target().length}},{key:"hasKey",value:function hasKey(e,t){return t in e.target()}},{key:"getValue",value:function getValue(e,t){return e.target()[t]}},{key:"setValue",value:function setValue(e,t,i){e.setValue(t,i)}},{key:"completeHangUpObject",value:function completeHangUpObject(e,t){qh(e)&&e.setHangMetadata(t)}},{key:"decorateObject",value:function decorateObject(e,t,i,r,n){if(r&&t===ye.AssertedObject){var s=this.covertIdToClass(r.id);if(!s)throw new ut("can't find class by object format id ".concat(r.id));var o=s[Ie];Ei(e)&&e.covertToAkkoObjectProxyNode(o)}}}]);return LC}();function DC(e,t){return new LC(t,e.covertObjectFormatIdToClass)}function BC(e,t){var i=Qi(e.rootClass),r=new Ii({format:e.format,objectAdapter:t,assertObjectFormat:function assertObjectFormat(n){if(ft(n))return n.struct.classReflection.objectFormat}});return kh(r,i)}var FC=/*#__PURE__*/function(){function FC(e,t){_classCallCheck(this,FC);this.assertObjectFormat=function(i){if(ft(i))return i.struct.classReflection.objectFormat},this.proxyRuntime=e,this.objectAdapter=DC(t,e),this.frameSerialization=BC(t,this.objectAdapter)}_createClass(FC,[{key:"serializeSnapshotFrame",value:function serializeSnapshotFrame(e){return this.frameSerialization.serializeSnapshotFrame(e)}},{key:"serializeActionFrame",value:function serializeActionFrame(e,t){return this.frameSerialization.serializeActionFrame(e,t)}},{key:"deserializeSnapshotFrame",value:function deserializeSnapshotFrame(e,t,i){return this.frameSerialization.deserializeSnapshotFrame(e,t,i)}},{key:"deserializeActionFrame",value:function deserializeActionFrame(e,t,i,r){var _this67=this;return r?this.proxyRuntime.runtime.runWithSerialization(r,function(){return _this67.frameSerialization.deserializeActionFrame(e,t,i)}):this.frameSerialization.deserializeActionFrame(e,t,i)}},{key:"createSerialization",value:function createSerialization(e){return new Ii({format:e,objectAdapter:this.objectAdapter,assertObjectFormat:this.assertObjectFormat})}}]);return FC}(),ug=/*#__PURE__*/function(){function ug(e,t,i){_classCallCheck(this,ug);this.runtime=e,this.rootObject=t,this.observerAdapter=i,this._pendingUpdatedRootObject=!1,this.didPenddingRootObject=!1}_createClass(ug,[{key:"initialize",value:function initialize(){this.holder=new AC(this.rootObject,this.observerAdapter)}},{key:"initializeWithOriginRootObject",value:function initializeWithOriginRootObject(e){this.holder=e.holder,this._pendingUpdatedRootObject?this.didPenddingRootObject=!0:this.holder.akkoProxyNode=this.rootObject}},{key:"pendingUpdatedRootObject",get:function get(){return this._pendingUpdatedRootObject},set:function set(e){this._pendingUpdatedRootObject!==e&&(this._pendingUpdatedRootObject=e,!e&&this.didPenddingRootObject&&(this.didPenddingRootObject=!1,this.holder.akkoProxyNode=this.rootObject))}},{key:"observerId",get:function get(){return this.runtime.observerId}},{key:"displayer",get:function get(){return this.holder.displayer}},{key:"target",get:function get(){return this.rootObject.target()}},{key:"getRootMethod",value:function getRootMethod(e){return this.rootObject.getMethod(e)}},{key:"snapshotRootObject",value:function snapshotRootObject(){return this.rootObject}}]);return ug}(),jC=/*#__PURE__*/function(){function jC(e){_classCallCheck(this,jC);this.params=Object.freeze(Ys({},e)),this.objectOperator=new RC}_createClass(jC,[{key:"createProxyRuntime",value:function createProxyRuntime(e,t){return new hC(this.objectOperator,e,t,{escapeObjectFilter:this.params.escapeObjectFilter,jsxFactory:this.params.jsxFactory,observerAdapter:this.params.observerAdapter})}}]);return jC}();function pg(e){if(!He(e))throw new Error("it isn't akko wrapped object");return kr.Rejected!==ng(e)}function Ye(e,t){return He(e)?e.__proxy.displayerTarget()instanceof t:Me(e)?e.displayerTarget()instanceof t:e instanceof t}var zC=-1,UC=-2,mg=-3;function fg(e){var t=Zh(e);if(t===Object)return zC;if(t===Array)return UC;if(t===void 0)return mg;{var i=t[Ie];return i?i.id:mg}}function Zh(e){switch(_typeof(e)){case"function":return e;case"object":{if(e!==null)return VC(e);break}}}function VC(e){var t=e.__proxy;switch(WC(t)){case Be.FlatObject:return Object;case Be.Array:return Array;case Be.AkkoObject:return HC(t).clazz;}return e.constructor}function WC(e){if(ft(e))return Be.AkkoObject;if(Ei(e))return Be.FlatObject;if(Ai(e))return Be.AkkoObject;if(He(e))return Be.Displayer;throw new Error("unrecognized proxy node")}function HC(e){var t=e;if(He(t)&&(t=t.__proxy),!!ft(t))return t.struct.classReflection}function gg(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new jC(e)}function At(e){return Q.currentNode?TC(e):dg(e)}var xg=P(require("query-string"));var Tg=P(require("query-string"));var Fg=P(require("query-string"));var nd=P(require("query-string"));var Wg=P(require("query-string"));var _C=Object.defineProperty,KC=Object.defineProperties,GC=Object.getOwnPropertyDescriptors,yg=Object.getOwnPropertySymbols,$C=Object.prototype.hasOwnProperty,YC=Object.prototype.propertyIsEnumerable,bg=function bg(e,t,i){return t in e?_C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},Gt=function Gt(e,t){for(var i in t||(t={})){$C.call(t,i)&&bg(e,i,t[i])}if(yg){var _iterator86=_createForOfIteratorHelper(yg(t)),_step86;try{for(_iterator86.s();!(_step86=_iterator86.n()).done;){var i=_step86.value;YC.call(t,i)&&bg(e,i,t[i])}}catch(err){_iterator86.e(err)}finally{_iterator86.f()}}return e},to=function to(e,t){return KC(e,GC(t))},jO=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")},vg=/*#__PURE__*/function(){function vg(){_classCallCheck(this,vg)}_createClass(vg,[{key:"create",value:function create(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new wg(e)}}]);return vg}(),Sg=/*#__PURE__*/function(){function Sg(e){_classCallCheck(this,Sg);this.callbacks=Object.freeze(this.wrapCallbacks(e))}_createClass(Sg,[{key:"wrapCallbacks",value:function wrapCallbacks(e){var t={};var _iterator87=_createForOfIteratorHelper(Sg.callbackKeys),_step87;try{var _loop16=function _loop16(){var i=_step87.value;var r=e[i];r?t[i]=r:t[i]=function(){throw new Error("can't call. ".concat(i," not register"))}};for(_iterator87.s();!(_step87=_iterator87.n()).done;){_loop16()}}catch(err){_iterator87.e(err)}finally{_iterator87.f()}return Object.freeze(t)}},{key:"convertIdToUrl",value:function convertIdToUrl(e){return this.callbacks.convertIdToUrl(e)}}]);return Sg}(),wg=Sg;wg.callbackKeys=Object.freeze(["convertIdToUrl"]);var Mr=/*#__PURE__*/function(){function Mr(){_classCallCheck(this,Mr);this.paddingResolves=[]}_createClass(Mr,[{key:"hasValue",get:function get(){return!this.paddingResolves}},{key:"getValueRightNow",value:function getValueRightNow(){return this.value}},{key:"getValue",value:function getValue(){var _this68=this;return this.hasValue?this.error?Promise.reject(this.error):Promise.resolve(this.value):new Promise(function(e,t){return _this68.paddingResolves.push({resolve:e,reject:t})})}},{key:"catchError",value:function catchError(e){if(!this.hasValue){var _iterator88=_createForOfIteratorHelper(this.paddingResolves),_step88;try{for(_iterator88.s();!(_step88=_iterator88.n()).done;){var t=_step88.value.reject;t(e)}}catch(err){_iterator88.e(err)}finally{_iterator88.f()}this.value=void 0,this.error=e,this.paddingResolves=null}return this}},{key:"setValue",value:function setValue(e){if(this.hasValue)throw new Error("did set value");this.value=e,this.error=void 0;var _iterator89=_createForOfIteratorHelper(this.paddingResolves),_step89;try{for(_iterator89.s();!(_step89=_iterator89.n()).done;){var t=_step89.value.resolve;t(e)}}catch(err){_iterator89.e(err)}finally{_iterator89.f()}return this.paddingResolves=null,this}}]);return Mr}(),Jh=/*#__PURE__*/function(_Error5){_inherits(Jh,_Error5);var _super26=_createSuper(Jh);function Jh(e){var _this69;_classCallCheck(this,Jh);_this69=_super26.call(this,Jh.createMessage(e));_this69.name=e.title,_this69.title=e.title,_this69.messages=e.messages?Object.freeze(_toConsumableArray(e.messages)):Jh.emptyArray,_this69.statusCode=e.statusCode,_this69.errorCode=e.errorCode;return _this69}_createClass(Jh,null,[{key:"createMessage",value:function createMessage(e){var t=e.title;return e.messages&&e.messages.length>0&&(t+=": "+e.messages.join("; ")),t}}]);return Jh}(/*#__PURE__*/_wrapNativeSuper(Error)),Cg=Jh;Cg.emptyArray=Object.freeze([]);var kg=/*#__PURE__*/function(){function kg(e,t,i,r){var _this70=this;_classCallCheck(this,kg);this.keyFetcherValue=new Mr,this.akkoVersionValue=t,e.getValue().then(function(n){return _this70.keyFetcherValue.setValue(n.getFetcher(i).fetch(r))})["catch"](function(n){return _this70.keyFetcherValue.catchError(n)})}_createClass(kg,[{key:"akkoVersion",get:function get(){return this.akkoVersionValue.getValue()}},{key:"fetchJSON",value:function(){var _fetchJSON=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee5(e,t){var i,r;return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return this.keyFetcherValue.getValue();case 2:_context5.t0=_context5.sent;_context5.next=5;return(0,_context5.t0)(e,t);case 5:i=_context5.sent;if(!this.isSuccessStatus(i,t)){_context5.next=13;break}_context5.next=9;return i.text();case 9:r=_context5.sent;return _context5.abrupt("return",r===""?void 0:JSON.parse(r));case 13:_context5.next=15;return this.createError(i);case 15:throw _context5.sent;case 16:case"end":return _context5.stop();}}},_callee5,this)}));function fetchJSON(_x7,_x8){return _fetchJSON.apply(this,arguments)}return fetchJSON}()},{key:"fetchBuffer",value:function(){var _fetchBuffer=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee6(e,t){var i;return regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return this.keyFetcherValue.getValue();case 2:_context6.t0=_context6.sent;_context6.next=5;return(0,_context6.t0)(e,t);case 5:i=_context6.sent;if(!(i.status===404)){_context6.next=8;break}return _context6.abrupt("return",null);case 8:if(!this.isSuccessStatus(i,t)){_context6.next=23;break}if(!i.arrayBuffer){_context6.next=17;break}_context6.t2=ai;_context6.next=13;return i.arrayBuffer();case 13:_context6.t3=_context6.sent;_context6.t1=(0,_context6.t2)(_context6.t3);_context6.next=22;break;case 17:_context6.t4=ai;_context6.next=20;return i.buffer();case 20:_context6.t5=_context6.sent;_context6.t1=(0,_context6.t4)(_context6.t5);case 22:return _context6.abrupt("return",_context6.t1);case 23:_context6.next=25;return this.createError(i);case 25:throw _context6.sent;case 26:case"end":return _context6.stop();}}},_callee6,this)}));function fetchBuffer(_x9,_x10){return _fetchBuffer.apply(this,arguments)}return fetchBuffer}()},{key:"createError",value:function(){var _createError=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee7(e){var t,i,_i$error,r,n,s;return regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:t=e.headers.get("content-type");if(!(!t||/application\/json/i.test(t))){_context7.next=17;break}_context7.prev=2;_context7.next=5;return e.json();case 5:i=_context7.sent;_context7.next=11;break;case 8:_context7.prev=8;_context7.t0=_context7["catch"](2);return _context7.abrupt("return",new Error("response with status "+e.status+" and parse error JSON failed: "+_context7.t0.message));case 11:if(!(_typeof(i.error)!="object"||i.error===null)){_context7.next=13;break}return _context7.abrupt("return",new Error("response with status "+e.status+" without error object"));case 13:_i$error=i.error,r=_i$error.code,n=_i$error.title,s=_i$error.messages;return _context7.abrupt("return",new Cg({statusCode:e.status,errorCode:r,title:n,messages:s}));case 17:_context7.t1=Error;_context7.t2="response with status "+e.status+" with text ";_context7.next=21;return e.text();case 21:_context7.t3=_context7.sent;_context7.t4=_context7.t2+_context7.t3;return _context7.abrupt("return",new _context7.t1(_context7.t4));case 24:case"end":return _context7.stop();}}},_callee7,null,[[2,8]])}));function createError(_x11){return _createError.apply(this,arguments)}return createError}()},{key:"isSuccessStatus",value:function isSuccessStatus(e,t){var i=e.status;switch(t&&t.method||"get"){case"get":return i===200||i===206;case"delete":return i===204;default:return i===201;}}}]);return kg}(),Pg=/*#__PURE__*/function(){function Pg(e,t){_classCallCheck(this,Pg);this.configmap=e,this.onIngoreFetchError=t,this.fetchers={},this.supportRegions=this.collectRegions(e)}_createClass(Pg,[{key:"collectRegions",value:function collectRegions(e){var t={};for(var i in e){for(var r in e[i].hosts){t[r]=!0}}return t}},{key:"getFetcher",value:function getFetcher(e){var t=this.fetchers[e];if(!t){if(!this.supportRegions[e])throw new Error("invalid region ".concat(JSON.stringify(e)));t=this.fetchers[e]=new $i({fetcher:fetch.bind(window),region:e,configmap:this.configmap,onIngoreFetchError:this.onIngoreFetchError,retryCount:2,retryLoopsCount:0})}return t}}]);return Pg}();function Ig(e){if(_typeof(e)=="object"&&e!==null){for(var t in e){Ig(e[t])}Object.freeze(e)}return e}function ed(e){if(_typeof(e)!="object"||e===null)return e;if(e instanceof Array){var t=[];for(var i=0;i<e.length;++i){t[i]=ed(e[i])}return t}else{var _t6={};for(var _i27 in e){_t6[_i27]=ed(e[_i27])}return _t6}}var XC=/*#__PURE__*/function(){function XC(){_classCallCheck(this,XC);this.node=null}_createClass(XC,[{key:"getAkkoAppConfigs",value:function(){var _getAkkoAppConfigs=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee8(e,t,i){var _this71=this;var r;return regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:if(!this.node||this.node.appIdentifier!==e){r=new Mr;this.node=Object.freeze({appIdentifier:e,configsValue:r}),this.fetchAkkoAppConfigs(e,t,i).then(function(n){return r.setValue(Ig(n))})["catch"](function(n){r.catchError(n),setTimeout(function(){return _this71.node=null},0)})}_context8.t0=ed;_context8.next=4;return this.node.configsValue.getValue();case 4:_context8.t1=_context8.sent;return _context8.abrupt("return",(0,_context8.t0)(_context8.t1));case 6:case"end":return _context8.stop();}}},_callee8,this)}));function getAkkoAppConfigs(_x12,_x13,_x14){return _getAkkoAppConfigs.apply(this,arguments)}return getAkkoAppConfigs}()},{key:"fetchAkkoAppConfigs",value:function(){var _fetchAkkoAppConfigs=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee9(e,t,i){var r,n,s,o,a,l;return regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:r={api:{hosts:{"*":t}}},n=new Pg(r,i),s=new Mr().setValue(n),o=new Mr,a=new kg(s,o,"*","api"),l=(0,xg.stringify)({app:e});_context9.next=3;return a.fetchJSON("https://shunt-api/v5/configs/regions?".concat(l));case 3:return _context9.abrupt("return",_context9.sent);case 4:case"end":return _context9.stop();}}},_callee9)}));function fetchAkkoAppConfigs(_x15,_x16,_x17){return _fetchAkkoAppConfigs.apply(this,arguments)}return fetchAkkoAppConfigs}()}]);return XC}(),QC=new XC;function qC(e,t,i){return QC.getAkkoAppConfigs(e,t,i)}var Mg;(function(e){e[e.Ready=0]="Ready",e[e.Setuping=1]="Setuping",e[e.Fail=2]="Fail"})(Mg||(Mg={}));var ZC=/*#__PURE__*/function(){function ZC(e){var _this72=this;_classCallCheck(this,ZC);this.fetcherPhase=1,this.getAkkoFetcher=/*#__PURE__*/function(){var _ref20=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee10(t){return regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_this72.fetcherPhase===2&&_this72.setupFetcher();_context10.next=3;return _this72.fetchersHubValue.getValue();case 3:return _context10.abrupt("return",_context10.sent.getFetcher(t));case 4:case"end":return _context10.stop();}}},_callee10)}));return function(_x18){return _ref20.apply(this,arguments)}}(),this.onIngoreFetchError=function(t){console.warn("fetch failed but ignore: ".concat(t.message))},this.params=Object.freeze(to(Gt({},e),{shuntApiHosts:Object.freeze(_toConsumableArray(e.shuntApiHosts))})),this.akkoVersionValue=new Mr,this.setupFetcher()}_createClass(ZC,[{key:"create",value:function create(e){return new JC(this.fetchersHubValue,this.akkoVersionValue,this.getAkkoFetcher,e)}},{key:"setupFetcher",value:function(){var _setupFetcher=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee11(){var _this$params,e,t,i,r,n;return regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_this$params=this.params,e=_this$params.appIdentifier,t=_this$params.shuntApiHosts,i=_this$params.onInterruptConfigs,r=_this$params.onAkkoSetupFailed;_context11.prev=1;this.fetchersHubValue=new Mr,this.fetcherPhase=1;_context11.next=5;return qC(e,t,this.onIngoreFetchError);case 5:n=_context11.sent;i&&(n=i(n)),this.akkoVersionValue.setValue(n.akkoVersion),this.fetchersHubValue.setValue(new Pg(n.configmap,this.onIngoreFetchError)),this.fetcherPhase=0;_context11.next=12;break;case 9:_context11.prev=9;_context11.t0=_context11["catch"](1);this.fetchersHubValue.catchError(new Error("akko setup failed: ".concat(_context11.t0.message))),this.fetcherPhase=2,r&&r(_context11.t0);case 12:case"end":return _context11.stop();}}},_callee11,this,[[1,9]])}));function setupFetcher(){return _setupFetcher.apply(this,arguments)}return setupFetcher}()}]);return ZC}(),JC=/*#__PURE__*/function(){function JC(e,t,i,r){_classCallCheck(this,JC);this.fetchersHubValue=e,this.akkoVersionValue=t,this.getAkkoFetcher=i,this.region=r}_createClass(JC,[{key:"fetch",value:function(){var _fetch=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee12(e){return regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:return _context12.abrupt("return",new kg(this.fetchersHubValue,this.akkoVersionValue,this.region,e));case 1:case"end":return _context12.stop();}}},_callee12,this)}));function fetch(_x19){return _fetch.apply(this,arguments)}return fetch}()},{key:"origin",value:function(){var _origin=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee13(e,t){return regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:_context13.next=2;return this.getAkkoFetcher(this.region);case 2:return _context13.abrupt("return",_context13.sent.origin(e,t));case 3:case"end":return _context13.stop();}}},_callee13,this)}));function origin(_x20,_x21){return _origin.apply(this,arguments)}return origin}()},{key:"reportSuccess",value:function reportSuccess(e,t){this.getAkkoFetcher(this.region).then(function(i){i.reportSuccess(e,t)})}},{key:"reportFail",value:function reportFail(e,t){this.getAkkoFetcher(this.region).then(function(i){i.reportFail(e,t)})}},{key:"akkoVersion",get:function get(){return this.akkoVersionValue.getValue()}}]);return JC}(),ek=/*#__PURE__*/function(){function ek(e,t){var _this73=this;_classCallCheck(this,ek);this.netState=e,this.onNetStateUpdate=t,this.paddingResolver=[],this._didDispose=!1,this.onOnline=function(){_this73._isOnline=!0,_this73.onNetStateUpdate&&_this73.onNetStateUpdate(!0),_this73.handleAllPaddingResolver(!0)},this.onOffline=function(){_this73._isOnline=!1,_this73.onNetStateUpdate&&_this73.onNetStateUpdate(!1)},e.addListener(this.listener={onOnline:this.onOnline,onOffline:this.onOffline}),this._isOnline=e.isOnline}_createClass(ek,[{key:"isOnline",get:function get(){return this._isOnline}},{key:"didDispose",get:function get(){return this._didDispose}},{key:"dispose",value:function dispose(){try{this.handleAllPaddingResolver(!1),this.netState.removeListener(this.listener)}finally{this._didDispose=!0}}},{key:"makeSureOnline",value:function makeSureOnline(){var _this74=this;return this._didDispose?Promise.resolve(!1):this._isOnline?Promise.resolve(!0):new Promise(function(e){_this74.paddingResolver.push(e)})}},{key:"handleAllPaddingResolver",value:function handleAllPaddingResolver(e){var _iterator90=_createForOfIteratorHelper(this.paddingResolver.splice(0,this.paddingResolver.length)),_step90;try{for(_iterator90.s();!(_step90=_iterator90.n()).done;){var t=_step90.value;t(e)}}catch(err){_iterator90.e(err)}finally{_iterator90.f()}}}]);return ek}();function tk(){return typeof WebSocket!="undefined"?WebSocket:global.WebSocket}var ik=tk();function rk(e,t){var i={room:t.uuid,token:e,combinable:!0,sessionToken:t.sessionToken,akkoVersion:t.akkoVersion,clientVersion:t.clientVersion,markWritable:t.markWritable,access:t.access};for(var r in i){i[r]===void 0&&delete i[r]}return(0,Tg.stringify)(i)}var nk=/*#__PURE__*/function(){function nk(e,_ref21){var _this75=this;var t=_ref21.logger,i=_ref21.timeout,r=_ref21.roomToken,n=_ref21.webSocketQuery,s=_ref21.callbacks;_classCallCheck(this,nk);this.disconnectedCallbacks=[],this.actionFramesInterrupter=[],this.snapshotFrameInterrupter=null,this._connectingDuration=-1,this.onReceiveSnapshotFrame=function(l){_this75.snapshotFrameInterrupter=l},this.onReceiveActionFrame=function(l){_this75.actionFramesInterrupter?_this75.actionFramesInterrupter.push(l):_this75.callbacks.onReceivedActionFrame(l)},this.onReceiveScopeSlices=function(l){_this75.callbacks.onReceivedScopeSlices(Hf(l))},this.onHangUp=function(){_this75.socket.disconnect(),_this75.callbacks.onKickWithReason(qi.GatewayAdjust)},this.onDisconnect=function(_ref22){var l=_ref22.reason,h=_ref22.message;var d=_this75.isConnected();_this75._sessionBuild=void 0;var u=l===Pt.WebSocketError||l===Pt.CommunicationError;if(_this75.disconnectedCallback(h,u),d)switch(l){case Pt.WebSocketError:case Pt.CommunicationError:{_this75.callbacks.onDisconnectedWithSocketError(new Error(h));break}case Pt.Normal:{_this75.callbacks.onKickWithReason(h);break}case Pt.RemoteError:{_this75.callbacks.onDisconnectedByServer(new Error(h));break}}};var o="".concat(e,"?").concat(rk(r,n)),a=new ik(o);this.logger=t,this.timeout=i,this.uuid=n.uuid,this.libraryDescriptionSerialization=new jf,this.socket=Ma.createSocket(a,t,{onDisconnect:this.onDisconnect}),this.socket.on("snapshot",this.onReceiveSnapshotFrame),this.socket.on("action",this.onReceiveActionFrame),this.socket.on("allocate-scope",this.onReceiveScopeSlices),this.socket.on("hang-up",this.onHangUp),this.callbacks=Object.freeze(Gt({},s))}_createClass(nk,[{key:"connectingDuration",get:function get(){return this._connectingDuration}},{key:"setAccessUpdaterSerialization",value:function setAccessUpdaterSerialization(e){this.accessUpdaterSerialization=e}},{key:"bindPingPongNode",value:function bindPingPongNode(e){e.bindSocket(this.socket)}},{key:"sessionBuild",get:function get(){if(!this._sessionBuild)throw new Error("not connected");return this._sessionBuild}},{key:"sendActionFrame",value:function sendActionFrame(e){this.socket.emit("action",e)}},{key:"isConnected",value:function isConnected(){return!!this._sessionBuild}},{key:"connect",value:function connect(){var _this76=this;return new Promise(function(e,t){var i=function i(){var a=_this76.disconnectedCallbacks.indexOf(n);a!==-1&&_this76.disconnectedCallbacks.splice(a,1),r!==null&&(clearTimeout(r),r=null),_this76.socket.off("session-build",s)},r=setTimeout(function(){i(),t(new Error("receive session-build event timeout"))},_this76.timeout),n=function n(a,l){i(),l?e(a):t(new Error("connect failed: ".concat(a)))};_this76.disconnectedCallbacks.push(n);var s=function s(a){i();var l=_this76.snapshotFrameInterrupter,h=_this76.actionFramesInterrupter;_this76._sessionBuild=zf(a),_this76.snapshotFrameInterrupter=null,_this76.actionFramesInterrupter=null,e({snapshot:l,actionFrames:h})},o=function o(a){var l=_this76.libraryDescriptionSerialization.deserialize(a);_this76.callbacks.onReceivedLibraryDescription(l),_this76.socket.off("library-description",o)};_this76.socket.on("session-build",s),_this76.socket.on("library-description",o),_this76.socket.waitToConnected().then(function(_ref23){var a=_ref23.duration;return _this76._connectingDuration=a})["catch"](function(a){_this76.logger.warn(a.message),n(a.message,!0)})})}},{key:"disconnect",value:function disconnect(){return this.disconnectedCallback("disconnect",!1),this.socket.disconnect()}},{key:"disconnectWithError",value:function disconnectWithError(e){return this.disconnectedCallback(e.message,!1),this.socket.disconnectWithErrorDescription({message:e.message})}},{key:"updateToWritable",value:function(){var _updateToWritable=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee14(e,t){var i,r;return regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:i={kind:Zi.Writable,userPayload:e,connectedPayload:t};this.socket.emit("update-access",this.accessUpdaterSerialization.serialize(i));_context14.next=4;return this.interruptEvent("allocate-user",[mt.WritableAccessForbidden,mt.StuffedOfWritableUsers,mt.WrongWritablePhase]);case 4:r=_context14.sent;if(!(r.errorCode!==void 0)){_context14.next=12;break}_context14.t0=r.errorCode;_context14.next=_context14.t0===mt.WritableAccessForbidden?9:_context14.t0===mt.StuffedOfWritableUsers?10:_context14.t0===mt.WrongWritablePhase?11:12;break;case 9:throw new Error("can't update to writable. you don't have permission");case 10:throw new Error("room is stuffed of writable users");case 11:throw new Error("it's wrong writable phase");case 12:return _context14.abrupt("return",r.target!==void 0?Ff(r.target):null);case 13:case"end":return _context14.stop();}}},_callee14,this)}));function updateToWritable(_x22,_x23){return _updateToWritable.apply(this,arguments)}return updateToWritable}()},{key:"updateToReadonly",value:function(){var _updateToReadonly=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee15(e){var t,i;return regeneratorRuntime.wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:t={kind:Zi.Readonly,payload:e};this.socket.emit("update-access",this.accessUpdaterSerialization.serialize(t));_context15.next=4;return this.interruptEvent("release-user",[mt.NoUserToRelease,mt.WrongWritablePhase]);case 4:i=_context15.sent;if(!(i.errorCode!==void 0)){_context15.next=11;break}_context15.t0=i.errorCode;_context15.next=_context15.t0===mt.NoUserToRelease?9:_context15.t0===mt.WrongWritablePhase?10:11;break;case 9:throw new Error("room don't have user to release");case 10:throw new Error("it's wrong writable phase");case 11:return _context15.abrupt("return",i.target!==void 0);case 12:case"end":return _context15.stop();}}},_callee15,this)}));function updateToReadonly(_x24){return _updateToReadonly.apply(this,arguments)}return updateToReadonly}()},{key:"disconnectedCallback",value:function disconnectedCallback(e,t){var _iterator91=_createForOfIteratorHelper(this.disconnectedCallbacks.splice(0)),_step91;try{for(_iterator91.s();!(_step91=_iterator91.n()).done;){var i=_step91.value;i(e,t)}}catch(err){_iterator91.e(err)}finally{_iterator91.f()}}},{key:"interruptEvent",value:function interruptEvent(e,t){var _this77=this;return new Promise(function(i){var r=function r(){var a=_this77.disconnectedCallbacks.indexOf(n);a!==-1&&_this77.disconnectedCallbacks.splice(a,1),_this77.socket.off(e,s),_this77.socket.off("error",o)},n=function n(){r(),i({})};_this77.disconnectedCallbacks.push(n);var s=function s(a){r(),i({target:a})},o=function o(a){t.indexOf(a)!==-1&&(r(),i({errorCode:a}))};_this77.socket.on(e,s),_this77.socket.on("error",o)})}}]);return nk}(),sk=/*#__PURE__*/function(){function sk(){_classCallCheck(this,sk);this.switchOn=!0}_createClass(sk,[{key:"wrapCallbacks",value:function wrapCallbacks(e){var _this78=this;var t={};var _loop17=function _loop17(i){var r=e[i];typeof r=="function"?t[i]=function(){for(var _len16=arguments.length,n=new Array(_len16),_key16=0;_key16<_len16;_key16++){n[_key16]=arguments[_key16]}if(_this78.switchOn)return r.apply(t,n)}:t[i]=r};for(var i in e){_loop17(i)}return Object.freeze(t)}}]);return sk}(),Eg=Object.freeze([1e3,1e3,1e3,3e3,3e3,5e3,5e3]);function ok(e){return new Promise(function(t){return setTimeout(t,e)})}var ak=/*#__PURE__*/function(){function ak(e,t,i){var _this79=this;_classCallCheck(this,ak);this._didDispose=!1,this.connectionTask=null,this.operator=null,this.connectionNode=null,this.onNetStateUpdate=function(r){_this79._didDispose||(r?_this79.connectionTask&&_this79.startConnectionTask():_this79.operator&&(_this79.operator.cancel(),_this79.operator=null))},this.logger=e,this.fetcher=t,this.netStatePaddingNode=i&&new ek(i,this.onNetStateUpdate)}_createClass(ak,[{key:"dispose",value:function dispose(){this._didDispose||(this._didDispose=!0,this.operator&&this.operator.cancel(),this.connectionTask=null,this.operator=null,this.netStatePaddingNode&&this.netStatePaddingNode.dispose())}},{key:"connect",value:function(){var _connect2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee16(e){var _this80=this;var t;return regeneratorRuntime.wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:if(!this._didDispose){_context16.next=2;break}throw new Error("did dispose");case 2:if(!this.connectionTask){_context16.next=4;break}throw new Error("is connecting");case 4:this.connectionNode&&(this.connectionNode.filter.switchOn=!1,this.connectionNode=null);_context16.t0=this.netStatePaddingNode;if(!_context16.t0){_context16.next=10;break}_context16.next=9;return this.netStatePaddingNode.makeSureOnline();case 9:_context16.t0=!_context16.sent;case 10:if(!_context16.t0){_context16.next=12;break}throw new Error("offline");case 12:t=new Promise(function(i,r){var n=new sk;_this80.connectionTask={resolve:i,reject:r,filter:n,params:to(Gt({},e),{callbacks:n.wrapCallbacks(e.callbacks)})}});this.startConnectionTask();_context16.prev=14;_context16.next=17;return t;case 17:return _context16.abrupt("return",_context16.sent);case 18:_context16.prev=18;this.connectionTask=null;return _context16.finish(18);case 21:case"end":return _context16.stop();}}},_callee16,this,[[14,,18,21]])}));function connect(_x25){return _connect2.apply(this,arguments)}return connect}()},{key:"startConnectionTask",value:function startConnectionTask(){var _this81=this;var e=new lk(this.logger,this.fetcher),_this$connectionTask=this.connectionTask,t=_this$connectionTask.params,i=_this$connectionTask.filter,r=_this$connectionTask.resolve,n=_this$connectionTask.reject;this.operator=e,this.operator.connect(t).then(function(s){s&&e===_this81.operator&&(r(s),_this81.operator=null,_this81.connectionNode={filter:i,connection:s.connection})})["catch"](function(s){e===_this81.operator&&(n(s),_this81.operator=null)})}}]);return ak}(),lk=/*#__PURE__*/function(){function lk(e,t){_classCallCheck(this,lk);this.logger=e,this.fetcher=t,this.connection=null,this.isCancel=!1}_createClass(lk,[{key:"connect",value:function(){var _connect3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee17(e){var t,i,r,n,s,o,a;return regeneratorRuntime.wrap(function _callee17$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:t="";i=0;case 2:if(!(i<Eg.length+1)){_context17.next=33;break}_context17.next=5;return this.fetcher.origin("wss","realtime");case 5:r=_context17.sent;n=Date.now();this.connection=new nk(r,e);s=Date.now();_context17.next=11;return this.connection.connect();case 11:o=_context17.sent;if(!this.isCancel){_context17.next=19;break}this.fetcher.reportSuccess("realtime",Date.now()-n);_context17.t0=o&&this.connection;if(!_context17.t0){_context17.next=18;break}_context17.next=18;return this.connection.disconnectWithError(new Error("cancel connect"));case 18:return _context17.abrupt("return",null);case 19:if(!(_typeof(o)=="object")){_context17.next=21;break}return _context17.abrupt("return",(this.fetcher.reportSuccess("realtime",Date.now()-n),{connection:this.connection,snapshot:o.snapshot,actionFrames:o.actionFrames,retryCount:i}));case 21:this.fetcher.reportFail("realtime",Date.now()-n),t=o,this.connection=null;a=Eg[i];_context17.t1=a!==void 0&&s+a-Date.now()>0;if(!_context17.t1){_context17.next=28;break}_context17.next=27;return ok(a);case 27:_context17.t1=this.isCancel;case 28:if(!_context17.t1){_context17.next=30;break}return _context17.abrupt("return",null);case 30:++i;_context17.next=2;break;case 33:throw new Error("connect fail after multiple retries: "+t);case 34:case"end":return _context17.stop();}}},_callee17,this)}));function connect(_x26){return _connect3.apply(this,arguments)}return connect}()},{key:"cancel",value:function cancel(){var _this82=this;this.connection&&(this.connection.disconnectWithError(new Error("cancel connect"))["catch"](function(e){return _this82.logger.error(e)}),this.connection=null),this.isCancel=!0}}]);return lk}();function td(e){var t=Pa(e);if(!t)throw new Error("can't find library from ".concat(e.name,". it's not root class"));return t}var Ag=function Ag(){};function ck(_x27){return _ck.apply(this,arguments)}function _ck(){_ck=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee109(e){var t,i;return regeneratorRuntime.wrap(function _callee109$(_context113){while(1){switch(_context113.prev=_context113.next){case 0:t=new hk(e);_context113.next=3;return t.connect();case 3:i=_context113.sent;return _context113.abrupt("return",{session:t,snapshot:i.snapshot,actionFrames:i.actionFrames,connection:i.connection,retryCount:i.retryCount});case 5:case"end":return _context113.stop();}}},_callee109)}));return _ck.apply(this,arguments)}var hk=/*#__PURE__*/function(){function hk(e){var _this83=this;_classCallCheck(this,hk);this.connectingResult=null,this._connection=null,this._libraryNode=null,this.onDisconnectedByServer=function(t){_this83._connection=null,_this83._libraryNode=null,_this83.callbacks.onDisconnectedByServer&&_this83.callbacks.onDisconnectedByServer(t)},this.onKickWithReason=function(t){_this83._connection=null,_this83._libraryNode=null,!_this83.reconnectionOptions.disableReconnect&&(t===qi.GatewayAdjust||t===qi.RoomZombie)?_this83.startReconnect(new Error("room became zombie")):_this83.callbacks.onKickWithReason&&_this83.callbacks.onKickWithReason(t)},this.onDisconnectedWithSocketError=/*#__PURE__*/function(){var _ref24=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee18(t){return regeneratorRuntime.wrap(function _callee18$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:_this83._connection=null;_this83._libraryNode=null;if(!_this83.reconnectionOptions.disableReconnect){_context18.next=6;break}_this83.callbacks.onDisconnectedWithSocketError&&_this83.callbacks.onDisconnectedWithSocketError(t);_context18.next=8;break;case 6:_context18.next=8;return _this83.startReconnect(t);case 8:case"end":return _context18.stop();}}},_callee18)}));return function(_x28){return _ref24.apply(this,arguments)}}(),this.logger=e.logger,this.uuid=e.uuid,this.roomToken=e.roomToken,this.timeout=e.timeout,this.markWritable=e.markWritable,this.clientVersion=e.clientVersion,this.reconnectionOptions=e.reconnectionOptions,this.access=e.access,this.objectOperator=e.objectOperator,this.libraryNodeFetcher=e.libraryNodeFetcher,this.connectionBuilder=new ak(e.logger,e.fetcher,e.netState),this.callbacks=Object.freeze(Gt({},e.callbacks))}_createClass(hk,[{key:"session",get:function get(){return this.sessionBuild.session}},{key:"slice",get:function get(){return this.sessionBuild.slice}},{key:"connection",get:function get(){return this._connection}},{key:"libraryNode",get:function get(){return this._libraryNode}},{key:"dispose",value:function dispose(){this.connectionBuilder.dispose()}},{key:"connect",value:function(){var _connect4=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee19(){var e,t,i,_i$connection$session,r,n;return regeneratorRuntime.wrap(function _callee19$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:if(!this.connectingResult){_context19.next=2;break}throw new Error("WebSocketSession is connecting");case 2:e=new Mr,t=this.connectingResult=new Mr;_context19.prev=3;_context19.next=6;return this.connectionBuilder.connect({logger:this.logger,roomToken:this.roomToken,timeout:this.timeout,webSocketQuery:{uuid:this.uuid,akkoVersion:Le,clientVersion:this.clientVersion,markWritable:this.markWritable,access:this.access,sessionToken:this.sessionBuild&&this.sessionBuild.sessionToken},callbacks:{onReceivedLibraryDescription:this.createLibraryDescriptionReceiver(e),onReceivedActionFrame:this.callbacks.onReceivedActionFrame||Ag,onReceivedScopeSlices:this.callbacks.onReceivedScopeSlices||Ag,onDisconnectedByServer:this.onDisconnectedByServer,onKickWithReason:this.onKickWithReason,onDisconnectedWithSocketError:this.onDisconnectedWithSocketError}});case 6:i=_context19.sent;if(this.sessionBuild){_i$connection$session=i.connection.sessionBuild,r=_i$connection$session.session,n=_i$connection$session.slice;this.callbacks.onSessionUpdate&&this.sessionBuild.session!==r&&this.callbacks.onSessionUpdate(r),this.callbacks.onSliceUpdate&&this.sessionBuild.slice!==n&&this.callbacks.onSliceUpdate(n)}this._connection=i.connection;_context19.next=11;return e.getValue();case 11:this._libraryNode=_context19.sent;this.sessionBuild=i.connection.sessionBuild;this._connection.setAccessUpdaterSerialization(new Ia(this.objectOperator,td(this._libraryNode.libraryClass)));this.connectingResult=null;t.setValue(i);return _context19.abrupt("return",i);case 19:_context19.prev=19;_context19.t0=_context19["catch"](3);throw e.catchError(_context19.t0),t.catchError(_context19.t0),_context19.t0;case 22:case"end":return _context19.stop();}}},_callee19,this,[[3,19]])}));function connect(){return _connect4.apply(this,arguments)}return connect}()},{key:"reconnectWithError",value:function reconnectWithError(e){this._connection&&(this._connection.disconnect(),this._connection=null,this._libraryNode=null),this.startReconnect(e)}},{key:"createLibraryDescriptionReceiver",value:function createLibraryDescriptionReceiver(e){var _this84=this;return/*#__PURE__*/function(){var _ref25=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee20(t){return regeneratorRuntime.wrap(function _callee20$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:_context20.prev=0;_context20.t0=e;_context20.next=4;return _this84.libraryNodeFetcher(t);case 4:_context20.t1=_context20.sent;_context20.t0.setValue.call(_context20.t0,_context20.t1);_context20.next=11;break;case 8:_context20.prev=8;_context20.t2=_context20["catch"](0);e.catchError(_context20.t2);case 11:case"end":return _context20.stop();}}},_callee20,null,[[0,8]])}));return function(_x29){return _ref25.apply(this,arguments)}}()}},{key:"startReconnect",value:function(){var _startReconnect=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee21(e){var _this$callbacks,t,i,r;return regeneratorRuntime.wrap(function _callee21$(_context21){while(1){switch(_context21.prev=_context21.next){case 0:if(!this.connectingResult){_context21.next=5;break}_context21.next=3;return this.connectingResult.getValue();case 3:_context21.next=0;break;case 5:_context21.prev=5;_this$callbacks=this.callbacks,t=_this$callbacks.onBeginReconnect,i=_this$callbacks.onReconnected;t&&Promise.resolve().then(function(){return t(e)});_context21.next=10;return this.connect();case 10:r=_context21.sent;i&&Promise.resolve().then(function(){return i(r)});_context21.next=17;break;case 14:_context21.prev=14;_context21.t0=_context21["catch"](5);this.callbacks.onDisconnectedWithSocketError&&this.callbacks.onDisconnectedWithSocketError(_context21.t0);case 17:case"end":return _context21.stop();}}},_callee21,this,[[5,14]])}));function startReconnect(_x30){return _startReconnect.apply(this,arguments)}return startReconnect}()}]);return hk}(),dk=Object.freeze({disableReconnect:!1});function uk(e){return e===!1?{disableReconnect:!0}:Gt(Gt({},dk),e)}var Og;(function(e){e[e.Success=0]="Success",e[e.Break=1]="Break"})(Og||(Og={}));var Tr=/*#__PURE__*/function(){function Tr(e){var _this85=this;_classCallCheck(this,Tr);this.idle=ca({timeout:800,checkingTimeMod:2,maxPaddingDuration:1600,maxInvokingDuration:100}),this.nextId=0,this.socket=null,this.pingProgress=null,this.promiseSleep=null,this.deltaTime=void 0,this.latestAdjustedTimestamp=0,this.isFirstAdjustedTime=!0,this.onPong=function(t){var _Vf=Vf(t),i=_Vf.id,r=_Vf.timestamp;if(_this85.pingProgress){var _this85$pingProgress=_this85.pingProgress,n=_this85$pingProgress.id,s=_this85$pingProgress.timestamp,o=_this85$pingProgress.handlers;if(n===i){var a={remoteTimestamp:r,shouldBreak:!1,sendAt:s,receivedAt:Date.now()};var _iterator92=_createForOfIteratorHelper(o),_step92;try{for(_iterator92.s();!(_step92=_iterator92.n()).done;){var _step92$value=_step92.value,l=_step92$value.resolve,h=_step92$value.timer;clearTimeout(h),l(a)}}catch(err){_iterator92.e(err)}finally{_iterator92.f()}_this85.pingProgress=null}}},this.onPingFailed=e}_createClass(Tr,[{key:"calibrationTimestamp",get:function get(){if(this.deltaTime===void 0)return Date.now();{var e=Math.max(this.latestAdjustedTimestamp,Date.now()+this.deltaTime);return this.latestAdjustedTimestamp=e,e}}},{key:"bindSocket",value:function bindSocket(e){this.socket&&this.unbindSocket(),this.socket=e,this.socket.on("pong",this.onPong),this.handleStartPingLoop()["catch"](this.onPingFailed)}},{key:"unbindSocket",value:function unbindSocket(){if(this.socket&&(this.socket.off("pong",this.onPong),this.socket=null),this.promiseSleep&&(clearTimeout(this.promiseSleep.sleepTimer),this.promiseSleep.resolve(1),this.promiseSleep=null),this.pingProgress){var e={shouldBreak:!0,remoteTimestamp:0,sendAt:0,receivedAt:0};var _iterator93=_createForOfIteratorHelper(this.pingProgress.handlers),_step93;try{for(_iterator93.s();!(_step93=_iterator93.n()).done;){var t=_step93.value.resolve;t(e)}}catch(err){_iterator93.e(err)}finally{_iterator93.f()}this.pingProgress=null}}},{key:"handleStartPingLoop",value:function(){var _handleStartPingLoop=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee23(){var _this86=this;var _loop18,_ret;return regeneratorRuntime.wrap(function _callee23$(_context24){while(1){switch(_context24.prev=_context24.next){case 0:_loop18=/*#__PURE__*/regeneratorRuntime.mark(function _loop18(){var e,t,i;return regeneratorRuntime.wrap(function _loop18$(_context23){while(1){switch(_context23.prev=_context23.next){case 0:e=0;t=0;_context23.next=4;return _this86.doProgress(_this86.onPingFailed,/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee22(){var _yield$_this86$ping,r,n,s,o,a;return regeneratorRuntime.wrap(function _callee22$(_context22){while(1){switch(_context22.prev=_context22.next){case 0:_context22.next=2;return _this86.ping(Tr.pongTimeout);case 2:_yield$_this86$ping=_context22.sent;r=_yield$_this86$ping.shouldBreak;n=_yield$_this86$ping.remoteTimestamp;s=_yield$_this86$ping.sendAt;o=_yield$_this86$ping.receivedAt;if(!r){_context22.next=9;break}return _context22.abrupt("return",1);case 9:a=o-s;return _context22.abrupt("return",(e+=n+a/2-o,t+=1,_this86.isFirstAdjustedTime&&_this86.updateDeltaTime(Math.floor(e/t)),0));case 11:case"end":return _context22.stop();}}},_callee22)})));case 4:i=_context23.sent;_context23.t0=i===1;if(_context23.t0){_context23.next=12;break}_this86.isFirstAdjustedTime?_this86.isFirstAdjustedTime=!1:t>=(Tr.processTimeIntervalList.length+1)/2&&_this86.updateDeltaTime(Math.floor(e/t));_context23.next=10;return _this86.sleep(_this86.withFloatRate(Tr.processInterval));case 10:i=_context23.sent;_context23.t0=i===1;case 12:if(!_context23.t0){_context23.next=14;break}return _context23.abrupt("return","break");case 14:case"end":return _context23.stop();}}},_loop18)});case 1:if(!this.socket){_context24.next=8;break}return _context24.delegateYield(_loop18(),"t0",3);case 3:_ret=_context24.t0;if(!(_ret==="break")){_context24.next=6;break}return _context24.abrupt("break",8);case 6:_context24.next=1;break;case 8:case"end":return _context24.stop();}}},_callee23,this)}));function handleStartPingLoop(){return _handleStartPingLoop.apply(this,arguments)}return handleStartPingLoop}()},{key:"updateDeltaTime",value:function updateDeltaTime(e){this.deltaTime=e}},{key:"doProgress",value:function(){var _doProgress=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee24(e,t){var i,_iterator94,_step94,r;return regeneratorRuntime.wrap(function _callee24$(_context25){while(1){switch(_context25.prev=_context25.next){case 0:i=0;_context25.prev=1;_context25.next=4;return t();case 4:i=_context25.sent;_context25.next=10;break;case 7:_context25.prev=7;_context25.t0=_context25["catch"](1);e(_context25.t0);case 10:if(!(i===0)){_context25.next=43;break}_iterator94=_createForOfIteratorHelper(Tr.processTimeIntervalList);_context25.prev=12;_iterator94.s();case 14:if((_step94=_iterator94.n()).done){_context25.next=35;break}r=_step94.value;_context25.prev=16;_context25.next=19;return this.sleep(this.withFloatRate(r));case 19:i=_context25.sent;_context25.t1=i===1;if(_context25.t1){_context25.next=26;break}_context25.next=24;return t();case 24:i=_context25.sent;_context25.t1=i===1;case 26:if(!_context25.t1){_context25.next=28;break}return _context25.abrupt("break",35);case 28:_context25.next=33;break;case 30:_context25.prev=30;_context25.t2=_context25["catch"](16);e(_context25.t2);case 33:_context25.next=14;break;case 35:_context25.next=40;break;case 37:_context25.prev=37;_context25.t3=_context25["catch"](12);_iterator94.e(_context25.t3);case 40:_context25.prev=40;_iterator94.f();return _context25.finish(40);case 43:return _context25.abrupt("return",i);case 44:case"end":return _context25.stop();}}},_callee24,this,[[1,7],[12,37,40,43],[16,30]])}));function doProgress(_x31,_x32){return _doProgress.apply(this,arguments)}return doProgress}()},{key:"ping",value:function ping(e){var _this87=this;return new Promise(function(t,i){var r=Date.now(),n,s;_this87.pingProgress?(n=_this87.pingProgress.id,s=_this87.pingProgress.handlers):(n=_this87.getNextId(),s=[],_this87.pingProgress={id:n,timestamp:r,handlers:s},_this87.idle.invokeOnIdle(function(){var l;(l=_this87.socket)==null||l.emit("ping",Uf({id:n,timestamp:r}))})["catch"](function(l){if(_this87.pingProgress){var _iterator95=_createForOfIteratorHelper(_this87.pingProgress.handlers),_step95;try{for(_iterator95.s();!(_step95=_iterator95.n()).done;){var h=_step95.value;h.reject(l),clearTimeout(h.timer)}}catch(err){_iterator95.e(err)}finally{_iterator95.f()}_this87.pingProgress=null}}));var o=setTimeout(function(){_this87.pingProgress&&_this87.pingProgress.id===n&&_this87.removeHandler(a)&&a.reject(new Error("pong timeout"))},e),a={resolve:t,reject:i,timer:o};s.push(a)})}},{key:"removeHandler",value:function removeHandler(e){var t=!1;if(this.pingProgress){var i=this.pingProgress.handlers,r=i.indexOf(e);r>=0&&(i.splice(r,1),i.length===0&&(this.pingProgress=null),t=!0)}return t}},{key:"getNextId",value:function getNextId(){this.nextId>Tr.maxId&&(this.nextId=0);var e=this.nextId;return this.nextId+=1,e}},{key:"withFloatRate",value:function withFloatRate(e){var t=1-Tr.timeFloatRate+2*Tr.timeFloatRate*Math.random();return Math.floor(t*e)}},{key:"sleep",value:function sleep(e){var _this88=this;if(this.promiseSleep)throw new Error("did call sleep");return new Promise(function(t){var i=setTimeout(function(){_this88.promiseSleep=null,t(0)},e);_this88.promiseSleep={resolve:t,sleepTimer:i}})}}]);return Tr}(),ns=Tr;ns.maxId=Math.pow(2,32)-1,ns.pongTimeout=6*1e3,ns.timeFloatRate=.35,ns.processInterval=5*60*1e3,ns.processTimeIntervalList=Object.freeze([5*1e3,7*1e3,12*1e3,15*1e3]);var Rg=/*#__PURE__*/function(){function Rg(e){var _this89=this;_classCallCheck(this,Rg);this.invoker=e,this.animationFrameId=null,this.shouldInvokeNextFrame=!1,this.blockInvoke=!1,this.fireTick=function(){if(_this89.shouldInvokeNextFrame)try{_this89.invoker()}catch(t){console.error(t)}_this89.shouldInvokeNextFrame=!1,_this89.blockInvoke=!1,_this89.animationFrameId=null}}_createClass(Rg,[{key:"invoke",value:function invoke(){if(this.blockInvoke)this.shouldInvokeNextFrame=!0;else{try{this.invoker()}catch(e){console.error(e)}this.animationFrameId===null&&(this.animationFrameId=window.requestAnimationFrame(this.fireTick)),this.blockInvoke=!0}}}]);return Rg}(),be;(function(e){e.Playing="playing",e.Pausing="pausing",e.PausingAndWaiting="pausingAndWaiting",e.Waiting="waiting",e.Ended="ended"})(be||(be={}));var id;(function(e){e[e.AutoBlockNewFrames=0]="AutoBlockNewFrames",e[e.DoNotBlockNewFrames=1]="DoNotBlockNewFrames"})(id||(id={}));var pk=/*#__PURE__*/function(){function pk(){_classCallCheck(this,pk);this.blockMode=1,this.queue=[],this.blockIndex=this.queue.length}_createClass(pk,[{key:"hasFrames",get:function get(){return this.queue.length>0}},{key:"hasAccessibleFrames",get:function get(){return this.blockIndex>0}},{key:"hasBlockedFrames",get:function get(){return this.queue.length>this.blockIndex}},{key:"accessibleLength",get:function get(){return this.blockIndex}},{key:"rearFrame",get:function get(){return this.frameAt(0)}},{key:"latestFrameIncludesBlocked",get:function get(){var e;return(e=this.queue[this.queue.length-1])==null?void 0:e.proto}},{key:"blockedFrame",get:function get(){var e;return(e=this.queue[this.blockIndex])==null?void 0:e.proto}},{key:"blockedReceivedAt",get:function get(){var e=this.queue[this.blockIndex];return e?e.receivedAt:-1}},{key:"timeInterval",get:function get(){if(this.blockIndex>0){var e=this.queue[this.blockIndex-1],t=this.queue[0];return e.proto.timestamp-t.proto.timestamp}else return 0}},{key:"timeIntervalBefore",value:function timeIntervalBefore(e){var t;var i=0,r=(t=this.queue[0])==null?void 0:t.proto.timestamp;if(r!==void 0){var n=-1;for(var s=this.blockIndex-1;s>=0;--s){var o=this.queue[s];if(o.proto.timestamp<=e){n=o.proto.timestamp;break}}n!==-1&&(i=n-r)}return i}},{key:"frameAt",value:function frameAt(e){if(e<this.blockIndex)return this.queue[e].proto}},{key:"push",value:function push(e){var t=Date.now();this.blockMode===1&&(this.blockIndex+=e.length);var _iterator96=_createForOfIteratorHelper(e),_step96;try{for(_iterator96.s();!(_step96=_iterator96.n()).done;){var i=_step96.value;this.queue.push({proto:i,receivedAt:t})}}catch(err){_iterator96.e(err)}finally{_iterator96.f()}}},{key:"shift",value:function shift(){var e;if(this.frameAt(0))return this.blockIndex-=1,(e=this.queue.shift())==null?void 0:e.proto}},{key:"unblockOneFrame",value:function unblockOneFrame(){this.blockIndex<this.queue.length&&(this.blockIndex+=1)}}]);return pk}(),mk=12e3,ss;(function(e){e.Realtime="realtime",e.Reconstruction="reconstruction"})(ss||(ss={}));var Ng=/*#__PURE__*/function(){function Ng(e){var _this90=this;_classCallCheck(this,Ng);this.framesQueue=new pk,this.isPlaying=!1,this._didCompletePushFrames=!1,this.didCompletePlaying=!1,this.handleTickEvent=function(){try{_this90.onTick()}finally{_this90.shouldTickNextFrame()&&_this90.tickLimiter.invoke(),_this90.phaseNode.touch()}},this.currentPhase=function(){return _this90.didCompletePlaying?be.Ended:_this90._didCompletePushFrames||_this90.framesQueue.hasAccessibleFrames?_this90.isPlaying?be.Playing:be.Pausing:_this90.isPlaying?be.Waiting:be.PausingAndWaiting},this.onPhaseChanged=function(n,s){s===be.Playing&&n!==be.Playing?_this90.onPlayingStop():s!==be.Playing&&n===be.Playing&&_this90.onPlayingContinue(),_this90.callbacks.onPhaseChanged&&_this90.callbacks.onPhaseChanged(n)},this.logger=e.logger,this.mode=e.mode,this.callbacks=Object.freeze(Gt({},e.callbacks));var t=e.enableAnimationFrame,_e$frameInterval=e.frameInterval,i=_e$frameInterval===void 0?17:_e$frameInterval,_e$remainLowTimeInter=e.remainLowTimeInterval,r=_e$remainLowTimeInter===void 0?mk:_e$remainLowTimeInter;if(t){var n=new Rg(this.handleTickEvent);this.tickLimiter=new dt(i,function(){return n.invoke()})}else this.tickLimiter=new dt(i,this.handleTickEvent);this.remainLowTimeInterval=r,this.phaseNode=new Kn({getCurrentPhase:this.currentPhase,onPhaseChanged:this.onPhaseChanged})}_createClass(Ng,[{key:"didCompletePushFrames",get:function get(){return this._didCompletePushFrames}},{key:"completePlaying",value:function completePlaying(){this.didCompletePlaying=!0,this.phaseNode.touch(),this.tickLimiter.cancel()}},{key:"frameInterval",get:function get(){return this.tickLimiter.limitDuration},set:function set(e){this.tickLimiter.limitDuration=e}},{key:"phase",get:function get(){return this.phaseNode.phase}},{key:"shouldTickNextFrame",value:function shouldTickNextFrame(){return this.didCompletePlaying?!1:this.willTickEveryFrames?!0:!!(this.isPlaying&&this.framesQueue.hasFrames)}},{key:"pushFrames",value:function pushFrames(e){this.framesQueue.push(e),e.length>0&&this.isPlaying&&this.tickLimiter.invoke(),this.phaseNode.touch()}},{key:"play",value:function play(){!this.isPlaying&&this.phaseNode.phase!==be.Ended&&(this.isPlaying=!0,this.framesQueue.hasAccessibleFrames&&this.tickLimiter.invoke(),this.phaseNode.touch())}},{key:"pause",value:function pause(){this.isPlaying&&(this.isPlaying=!1,this.tickLimiter.cancel(),this.phaseNode.touch())}},{key:"completePushFrames",value:function completePushFrames(){this._didCompletePushFrames=!0,this.framesQueue.hasAccessibleFrames||(this.didCompletePlaying=!0,this.tickLimiter.cancel()),this.phaseNode.touch()}}]);return Ng}(),rd=/*#__PURE__*/function(){function rd(e,t){_classCallCheck(this,rd);this.lastTimestamp=0,this.targetValue=e,this._momentValue=e,this.halfLifeInterval=t}_createClass(rd,[{key:"value",get:function get(){return this.targetValue},set:function set(e){this.targetValue!==e&&(this.targetValue!==this._momentValue&&this.refreshMomentValue(),this.targetValue=e)}},{key:"momentValue",get:function get(){return this.targetValue!==this._momentValue&&this.refreshMomentValue(),this._momentValue}},{key:"refreshMomentValue",value:function refreshMomentValue(){var e=Date.now(),t=e-this.lastTimestamp,i;if(t>this.halfLifeInterval*rd.convergenceTimes)i=this.targetValue;else{var r=Math.pow(.5,t/this.halfLifeInterval);i=this._momentValue*r+this.targetValue*(1-r),Math.abs(i-this.targetValue)<rd.minNumber&&(i=this.targetValue)}this._momentValue=i,this.lastTimestamp=e}}]);return rd}(),Ha=rd;Ha.convergenceTimes=6,Ha.minNumber=.01;var Lg=1200,Dg=Object.freeze([Object.freeze({duration:1200,rate:1}),Object.freeze({duration:1e3,rate:.75}),Object.freeze({duration:3e3,rate:.5}),Object.freeze({duration:5e3,rate:.25})]);function fk(e){var t=e;var _iterator97=_createForOfIteratorHelper(Dg),_step97;try{for(_iterator97.s();!(_step97=_iterator97.n()).done;){var i=_step97.value;if(t<=i.duration)return i.rate;t-=i.duration}}catch(err){_iterator97.e(err)}finally{_iterator97.f()}throw new Error("durationTime is too large:"+t)}var gk=function(){var e=0;var _iterator98=_createForOfIteratorHelper(Dg),_step98;try{for(_iterator98.s();!(_step98=_iterator98.n()).done;){var t=_step98.value.duration;e+=t}}catch(err){_iterator98.e(err)}finally{_iterator98.f()}return e}(),yk=/*#__PURE__*/function(_Ng){_inherits(yk,_Ng);var _super27=_createSuper(yk);function yk(e){var _this91;_classCallCheck(this,yk);_this91=_super27.call(this,e);_this91.latestTimestamp=null,_this91.syncDelta=null,_this91.framesQueue.blockMode=id.AutoBlockNewFrames,_this91.frameDelayGradient=new Ha(e.frameDelay||0,Lg);return _this91}_createClass(yk,[{key:"frameDelay",get:function get(){return this.frameDelayGradient.value},set:function set(e){this.frameDelayGradient.value=e}},{key:"isPlaybackSpeedModifiable",get:function get(){return!1}},{key:"playbackSpeed",get:function get(){return 1},set:function set(e){}},{key:"willTickEveryFrames",get:function get(){return!1}},{key:"syncBlockTimestamp",value:function syncBlockTimestamp(e){var t=e-Date.now();this.syncDelta?this.syncDelta.value=t:this.syncDelta=new Ha(t,Lg)}},{key:"stopBlockTimestamp",value:function stopBlockTimestamp(){this.syncDelta=null}},{key:"onPlayingContinue",value:function onPlayingContinue(){}},{key:"onPlayingStop",value:function onPlayingStop(){}},{key:"onTick",value:function onTick(){var e=Date.now(),t=[];if(this.unblockFramesIfNeed(e),this.fillOverIntervalFrames(e,t),this.fillShouldPlayFrames(e,t),this.playFrames(t),this.callbacks.onBufferRemainLow&&this.latestTimestamp&&!this.didCompletePushFrames){var i=0;if(this.framesQueue.hasAccessibleFrames){var r=this.framesQueue.latestFrameIncludesBlocked.timestamp;i=r-this.latestTimestamp.ack}i<this.remainLowTimeInterval&&this.callbacks.onBufferRemainLow()}}},{key:"unblockFramesIfNeed",value:function unblockFramesIfNeed(e){if(this.syncDelta){var t=e+this.syncDelta.momentValue;for(;this.framesQueue.hasBlockedFrames&&this.framesQueue.blockedFrame.timestamp<=t;){this.framesQueue.unblockOneFrame()}}else for(;this.framesQueue.hasBlockedFrames;){var _t7=this.framesQueue.blockedReceivedAt+this.frameDelayGradient.momentValue;if(e>=_t7)this.framesQueue.unblockOneFrame();else break}}},{key:"fillOverIntervalFrames",value:function fillOverIntervalFrames(e,t){for(;this.framesQueue.timeInterval>gk;){t.push(this.framesQueue.shift())}t.length>0&&this.updateLatestTimestamp(e,t[t.length-1])}},{key:"fillShouldPlayFrames",value:function fillShouldPlayFrames(e,t){var i=this.framesQueue.timeIntervalBefore(e),r=fk(i);for(;this.framesQueue.hasAccessibleFrames;){var n=this.framesQueue.rearFrame,s=!1;if(!this.latestTimestamp)s=!0;else{var o=n.timestamp-this.latestTimestamp.ack,a=this.latestTimestamp.device+o*r;s=e+this.frameInterval>=a}if(s)t.push(this.framesQueue.shift()),this.updateLatestTimestamp(e,n);else break}}},{key:"playFrames",value:function playFrames(e){if(e.length>0)try{this.callbacks.onPlayActionFrames&&this.callbacks.onPlayActionFrames(e)}catch(t){this.logger.error(t)}}},{key:"updateLatestTimestamp",value:function updateLatestTimestamp(e,_ref27){var t=_ref27.timestamp;this.latestTimestamp?(this.latestTimestamp.ack=t,this.latestTimestamp.device=e):this.latestTimestamp={ack:t,device:e}}}]);return yk}(Ng),bk=/*#__PURE__*/function(_Ng2){_inherits(bk,_Ng2);var _super28=_createSuper(bk);function bk(e){var _this92;_classCallCheck(this,bk);_this92=_super28.call(this,e);_this92.frameDelay=0,_this92._playbackSpeed=1,_this92.endFrameTimestamp=e.endFrameTimestamp,_this92.anchor={deviceTimestamp:Date.now(),playerTimestamp:e.initFrameTimestamp};return _this92}_createClass(bk,[{key:"syncBlockTimestamp",value:function syncBlockTimestamp(e){}},{key:"stopBlockTimestamp",value:function stopBlockTimestamp(){}},{key:"play",value:function play(){_get(_getPrototypeOf(bk.prototype),"play",this).call(this);var e=this.callbacks.onBufferRemainLow;e&&this.isBufferRemainLow&&Promise.resolve().then(e)["catch"](function(t){return console.error(t)})}},{key:"isPlaybackSpeedModifiable",get:function get(){return!0}},{key:"playbackSpeed",get:function get(){return this._playbackSpeed},set:function set(e){if(e<0)throw new Error("invalid playback speed ".concat(e,". it shouldn't be nagative number"));if(Number.isNaN(e)||e===1/0)throw new Error("invalid playback speed. it can not be ".concat(e));this._playbackSpeed!==e&&(this.phase===be.Playing&&this.refreshAnchor(this._playbackSpeed),this._playbackSpeed=e)}},{key:"willTickEveryFrames",get:function get(){return!0}},{key:"onPlayingContinue",value:function onPlayingContinue(){this.refreshAnchor(0)}},{key:"onPlayingStop",value:function onPlayingStop(){this.refreshAnchor(this._playbackSpeed)}},{key:"onTick",value:function onTick(){var e=[],t=this.playbackSpeed*(Date.now()-this.anchor.deviceTimestamp+this.frameInterval),i=this.anchor.playerTimestamp+t;for(;this.framesQueue.hasAccessibleFrames&&this.framesQueue.rearFrame.timestamp<=i;){e.push(this.framesQueue.shift())}if(e.length>0)try{this.callbacks.onPlayActionFrames&&this.callbacks.onPlayActionFrames(e)}catch(r){this.logger.error(r)}if(this.callbacks.onTick)if(e.length>0){var r=e[e.length-1],n=Math.max(this.anchor.playerTimestamp,r.timestamp);this.callbacks.onTick(n,!1)}else this.callbacks.onTick(i,!0);this.callbacks.onBufferRemainLow&&!this.didCompletePushFrames&&this.isBufferRemainLow&&this.callbacks.onBufferRemainLow(),this.didCompletePushFrames&&e.length===0&&this.endFrameTimestamp!==void 0&&i>=this.endFrameTimestamp&&this.completePlaying()}},{key:"refreshAnchor",value:function refreshAnchor(e){var t=Date.now(),i=e*(t-this.anchor.deviceTimestamp);this.anchor={deviceTimestamp:t,playerTimestamp:this.anchor.playerTimestamp+i}}},{key:"isBufferRemainLow",get:function get(){return this.framesQueue.timeInterval<this.remainLowTimeInterval}}]);return bk}(Ng),vk=/*#__PURE__*/function(){function vk(){_classCallCheck(this,vk)}_createClass(vk,[{key:"create",value:function create(e){switch(e.mode){case ss.Realtime:return new yk(e);case ss.Reconstruction:return new bk(e);default:throw new Error("invalid mode ".concat(e.mode));}}}]);return vk}(),Bg=new vk,Sk=/*#__PURE__*/function(){function Sk(e){_classCallCheck(this,Sk);this.latestReceivedFrameId=-1,this.didAssertedCount=0,this.latestReceivedFrameId=e}_createClass(Sk,[{key:"assertReceivedFrameId",value:function assertReceivedFrameId(e){var t=this.latestReceivedFrameId+1;if(e!==t)throw new Error("Magix want frameId ".concat(t,", instead of ").concat(e," (did asserted ").concat(this.didAssertedCount," frames)"));this.latestReceivedFrameId=e,this.didAssertedCount+=1}}]);return Sk}(),wk=/*#__PURE__*/function(){function wk(e){var _this93=this;_classCallCheck(this,wk);this.latestTimestamp=null,this.receivedActionFramePicker=function(i){_this93.frameIdAsserter.assertReceivedFrameId(i.frameId),_this93.playerBuffer.pushFrames([i])},this.onPlayActionFrames=function(i){_this93.onFrameReceivedInterval&&i.length>0&&_this93.onFrameReceivedInterval(_this93.getFrameReceivedInterval(i));var r=[];var _iterator99=_createForOfIteratorHelper(i),_step99;try{for(_iterator99.s();!(_step99=_iterator99.n()).done;){var n=_step99.value;r.push(n.frameBuffer)}}catch(err){_iterator99.e(err)}finally{_iterator99.f()}try{_this93.image.appendActionFrames(r)}catch(n){if(_this93.onClientCrashWithError)_this93.onClientCrashWithError(n);else throw n}};var t;this.connection=e.connection,this.image=e.imageFactory.createWithSnapshot({logger:e.logger,observerId:ce,library:e.library,snapshotFrame:e.snapshot,pendingReportChanged:e.pendingReportChanged,actionFrames:_toConsumableArray(e.initializeActionFrames),originalImage:(t=e.originalMagixSession)==null?void 0:t.image,includesFrameHash:!1,ignoreHashChecking:!0,roomUUID:e.connection.uuid,toolsExtra:e.toolsExtra,callbacks:{onModified:e.callbacks.onModified,onPhaseChanged:e.callbacks.onImagePhaseChanged,onGeneratedActionFrame:e.callbacks.onGeneratedActionFrame,onCatchErrorWhenAppendFrame:e.callbacks.onCatchErrorWhenAppendFrame,onReceivedRttReport:e.callbacks.onReceivedRttReport,onIllusionQueueLengthChanged:e.callbacks.onIllusionQueueLengthChanged,onEventFire:e.callbacks.onEventFire,onEventFireACK:e.callbacks.onEventFireACK,onClientCrashWithError:e.callbacks.onClientCrashWithError}}),this.frameIdAsserter=new Sk(this.image.frameId),this.playerBuffer=Bg.create({logger:e.logger,mode:ss.Realtime,frameDelay:e.timeDelay,enableAnimationFrame:e.enableAnimationFrame,initFrameTimestamp:this.image.timestamp,callbacks:{onPlayActionFrames:this.onPlayActionFrames}}),this.onFrameReceivedInterval=e.callbacks.onFrameReceivedInterval,this.onClientCrashWithError=e.callbacks.onClientCrashWithError,this.playerBuffer.play()}_createClass(wk,[{key:"imagePhase",get:function get(){return this.image.phase}},{key:"timestamp",get:function get(){return this.image.timestamp}},{key:"trigger",get:function get(){return this.image.trigger}},{key:"pendingReportChanged",get:function get(){return this.image.pendingReportChanged},set:function set(e){this.image.pendingReportChanged=e}},{key:"receivedScopeSlices",value:function receivedScopeSlices(e){this.image.appendScopeSlices(e)}},{key:"dispatch",value:function dispatch(e,t){this.image.dispatch(e,t)}},{key:"updateTimeDelay",value:function updateTimeDelay(e){this.playerBuffer.frameDelay=e}},{key:"syncBlockTimestamp",value:function syncBlockTimestamp(e){this.playerBuffer.syncBlockTimestamp(e)}},{key:"stopBlockTimestamp",value:function stopBlockTimestamp(){this.playerBuffer.stopBlockTimestamp()}},{key:"setModifiable",value:function setModifiable(e){this.image.modifiable=e}},{key:"setAllocatedUser",value:function setAllocatedUser(e){return this.image.setAllocatedUser(e)}},{key:"removeAllocatedUser",value:function removeAllocatedUser(){return this.image.removeAllocatedUser()}},{key:"destroy",value:function destroy(){this.image.destroy()}},{key:"cleanSendingQueue",value:function cleanSendingQueue(){return this.image.waitUtilIllusionQueueEmpty()}},{key:"getFrameReceivedInterval",value:function getFrameReceivedInterval(e){var t=Date.now(),i=0,r=0;var _iterator100=_createForOfIteratorHelper(e),_step100;try{for(_iterator100.s();!(_step100=_iterator100.n()).done;){var s=_step100.value;if(this.latestTimestamp){var o=t-this.latestTimestamp.recevied,a=s.timestamp-this.latestTimestamp.arbitrated;this.latestTimestamp.recevied=t,this.latestTimestamp.arbitrated=s.timestamp,i+=Math.abs(o-a),r+=1}else this.latestTimestamp={recevied:t,arbitrated:s.timestamp}}}catch(err){_iterator100.e(err)}finally{_iterator100.f()}var n=0;return r>0&&(n=i/r),n}}]);return wk}(),Ck=/*#__PURE__*/function(){function Ck(e,t,i,r){_classCallCheck(this,Ck);this.userPayload=e,this.onCleanSendingQueue=t,this.onSelfUserIdUpdate=i,this.onConvertToWritable=r,this._selfUserId=void 0,this.invokerBlock=Promise.resolve(),this.isConnectedSessionWritable=!1,this.connectedSession=null}_createClass(Ck,[{key:"selfUserId",get:function get(){return this._selfUserId}},{key:"finalUserId",get:function get(){var _this94=this;return this.invokerBlock.then(function(){return _this94._selfUserId})}},{key:"setConnectedMagixSession",value:function setConnectedMagixSession(e){this.connectedSession!==e&&(!this.connectedSession&&e&&this.paddingAndWaitSession&&(this.paddingAndWaitSession(e),this.paddingAndWaitSession=void 0),this.connectedSession=e,this.isConnectedSessionWritable=!1)}},{key:"setWritable",value:function setWritable(e,t){return this.invokerBlock=this.convertTo(this.invokerBlock,e,t)}},{key:"convertTo",value:function(){var _convertTo=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee25(e,t,i){var r,n;return regeneratorRuntime.wrap(function _callee25$(_context26){while(1){switch(_context26.prev=_context26.next){case 0:_context26.next=2;return e;case 2:if(!(this.isConnectedSessionWritable===t)){_context26.next=4;break}return _context26.abrupt("return");case 4:this.updateObserverId(void 0);r=null;case 6:_context26.next=8;return this.waitAndGetConnectedSession();case 8:n=_context26.sent;if(!(this.isConnectedSessionWritable===t)){_context26.next=11;break}return _context26.abrupt("break",33);case 11:if(!t){_context26.next=21;break}_context26.next=14;return n.connection.updateToWritable(this.userPayload,i);case 14:r=_context26.sent;if(r){_context26.next=17;break}return _context26.abrupt("continue",31);case 17:_context26.next=19;return n.setAllocatedUser(r);case 19:_context26.next=29;break;case 21:_context26.next=23;return this.onCleanSendingQueue();case 23:_context26.next=25;return n.connection.updateToReadonly(i);case 25:if(_context26.sent){_context26.next=27;break}return _context26.abrupt("continue",31);case 27:_context26.next=29;return n.removeAllocatedUser();case 29:this.isConnectedSessionWritable=t;return _context26.abrupt("break",33);case 31:_context26.next=6;break;case 33:r&&this.updateObserverId(r.userId),this.onConvertToWritable&&this.onConvertToWritable(!!r);case 34:case"end":return _context26.stop();}}},_callee25,this)}));function convertTo(_x33,_x34,_x35){return _convertTo.apply(this,arguments)}return convertTo}()},{key:"waitAndGetConnectedSession",value:function waitAndGetConnectedSession(){var _this95=this;return this.connectedSession?Promise.resolve(this.connectedSession):new Promise(function(e){return _this95.paddingAndWaitSession=e})}},{key:"updateObserverId",value:function updateObserverId(e){this._selfUserId!==e&&(this._selfUserId=e,this.onSelfUserIdUpdate&&this.onSelfUserIdUpdate(e))}}]);return Ck}(),kk="NETLESSROOM_".length,jg;(function(e){e[e.Admin=0]="Admin",e[e.Writer=1]="Writer",e[e.Reader=2]="Reader"})(jg||(jg={}));function xk(e){if(/^NETLESSROOM_.+/.test(e)){var t=e.substring(kk),i=(0,Fg.parse)(Pk(t)),r=parseFloat("".concat(i.role));if(Number.isNaN(r)||!Number.isSafeInteger(r))throw new Error("invalid room token with wrong role: ".concat(JSON.stringify(e)));switch(r){case 0:case 1:return"writable";case 2:return"readonly";default:throw new Error("find unrecognized role from roomToken: ".concat(r));}}else{if(/^WHITE.+/.test(e))return"writable";throw new Error("invalid room token: ".concat(JSON.stringify(e)))}}function Pk(e){return atob(e.replace(/_/g,"/").replace(/-/g,"+"))}var Ik=/*#__PURE__*/function(){function Ik(e,t){var _this96=this;_classCallCheck(this,Ik);this.queue=[],this._isWorking=!0,this.onDelayFire=function(){_this96.queue.splice(0),_this96.onTimeout()},this.timeout=e,this.delayer=new Pi(this.onDelayFire),this.onTimeout=t}_createClass(Ik,[{key:"isWorking",get:function get(){return this._isWorking},set:function set(e){this._isWorking!==e&&(this._isWorking=e,e?this.activeFirstNode():this.delayer.cancel())}},{key:"fireSend",value:function fireSend(e){var t=e.frameId,i=Date.now();this.queue.push({frameId:t,sendAt:i}),this._isWorking&&this.queue.length===1&&this.delayer.refreshAndInvokeAfterInterval(this.timeout)}},{key:"fireACK",value:function fireACK(e){var t=e.originalFrameId,i=this.queue.findIndex(function(r){return r.frameId===t});i!==-1&&(this.queue.splice(i,1),this._isWorking&&this.activeFirstNode())}},{key:"activeFirstNode",value:function activeFirstNode(){if(this.queue.length===0)this.delayer.cancel();else{var e=this.queue[0].sendAt,t=e+this.timeout-Date.now();t>0?this.delayer.refreshAndInvokeAfterInterval(t):(this.delayer.cancel(),this.onDelayFire())}}}]);return Ik}(),os=/*#__PURE__*/function(){function os(e){var _this97=this;_classCallCheck(this,os);this.idle=ca({timeout:250,checkingTimeMod:7,maxPaddingDuration:800,maxInvokingDuration:5}),this.actionFramePickersList=[],this._phase=j.Ready,this._modifiable=!0,this._timeDelay=0,this.switchWritable=!1,this.switchWritableTaskId=0,this.isReconnecting=!1,this.beginReconnectAt=0,this.onReceivedActionFrame=function(t){var i=new _t(t);try{if(_this97.magixSession){if(_this97.actionFramePickersList.length>0){var _iterator101=_createForOfIteratorHelper(_this97.cleanActionFramesBufferList()),_step101;try{for(_iterator101.s();!(_step101=_iterator101.n()).done;){var r=_step101.value;_this97.magixSession.receivedActionFramePicker(r)}}catch(err){_iterator101.e(err)}finally{_iterator101.f()}}_this97.magixSession.receivedActionFramePicker(i)}else _this97.actionFramePickersList.push(i)}catch(r){_this97.logger.error("found error when receive action frame: "+r.message),_this97.socketSession.reconnectWithError(r)}finally{_this97.ackTimeout.fireACK(i)}},this.onReceivedScopeSlices=function(t){try{_this97.magixSession&&_this97.magixSession.receivedScopeSlices(t)}catch(i){_this97.logger.error("found error when receive scope slices: "+i.message),_this97.socketSession.reconnectWithError(i)}},this.onBeginReconnect=function(t){var i=_this97._phase===j.Connecting;_this97.beginReconnectAt=Date.now(),_this97.refreshACKTimeoutIsWorking(),i||(_this97.callbacks.onReconnectWithError?_this97.callbacks.onReconnectWithError(t):_this97.logger.error(t)),_this97.switchWritableTaskId+=1,_this97.magixSession.destroy(),_this97.pingPongNode.unbindSocket(),i||_this97.changePhase(j.Reconnecting),_this97.isReconnecting=!0,_this97.authorState.setConnectedMagixSession(null)},this.onReconnected=/*#__PURE__*/function(){var _ref29=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee26(_ref28){var t,i,r,n,s,o;return regeneratorRuntime.wrap(function _callee26$(_context27){while(1){switch(_context27.prev=_context27.next){case 0:t=_ref28.connection,i=_ref28.snapshot,r=_ref28.actionFrames,n=_ref28.retryCount;_this97.buildMagixSession({connection:t,snapshot:i,actionFrames:r,pendingReportChanged:!0});s=_this97._phase===j.Connecting,o=_this97.switchWritableTaskId;_context27.t0=_this97.switchWritable;if(!_context27.t0){_context27.next=7;break}_context27.next=7;return _this97.authorState.setWritable(!0,_this97.settingWritablePayload);case 7:o===_this97.switchWritableTaskId&&(_this97.magixSession.pendingReportChanged=!1,s||(_this97.changePhase(j.Connected),_this97.onModified()),_this97.isReconnecting=!1,_this97.reconnectionResultReceiver&&(_this97.reconnectionResultReceiver(null),_this97.reconnectionResultReceiver=null),_this97.callbacks.onReconnected&&!s&&_this97.callbacks.onReconnected({retryCount:n,buildWebSocketDuration:t.connectingDuration,buildMagixDuration:Date.now()-_this97.beginReconnectAt}));_this97.beginReconnectAt=0;_this97.refreshACKTimeoutIsWorking();case 10:case"end":return _context27.stop();}}},_callee26)}));return function(_x36){return _ref29.apply(this,arguments)}}(),this.onGeneratedActionFrame=function(t){var i;_this97.idle.invokeOnIdle(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee27(){return regeneratorRuntime.wrap(function _callee27$(_context28){while(1){switch(_context28.prev=_context28.next){case 0:i=t.get();case 1:case"end":return _context28.stop();}}},_callee27)})))["catch"](function(r){var n,s;return(s=(n=_this97.callbacks).onReceivedWarning)==null?void 0:s.call(n,r.message)}),_this97.idle.invokeOnIdle(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee28(){return regeneratorRuntime.wrap(function _callee28$(_context29){while(1){switch(_context29.prev=_context29.next){case 0:i&&(_this97.socketSession.connection.sendActionFrame(i),_this97.ackTimeout.fireSend(new _t(i)));case 1:case"end":return _context29.stop();}}},_callee28)})))["catch"](function(r){var n,s;return(s=(n=_this97.callbacks).onReceivedWarning)==null?void 0:s.call(n,r.message)})},this.onCleanSendingQueue=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee29(){var t;return regeneratorRuntime.wrap(function _callee29$(_context30){while(1){switch(_context30.prev=_context30.next){case 0:_context30.next=2;return(t=_this97.magixSession)==null?void 0:t.cleanSendingQueue();case 2:case"end":return _context30.stop();}}},_callee29)})),this.onSelfUserIdUpdate=function(t){_this97.callbacks.onSelfUserIdUpdate&&_this97._phase!==j.Ready&&_this97._phase!==j.Connecting&&_this97.callbacks.onSelfUserIdUpdate(t)},this.onModified=function(){_this97.callbacks.onModified&&_this97._phase!==j.Ready&&_this97._phase!==j.Connecting&&(_this97.animationFrameTicker?_this97.animationFrameTicker.invoke():_this97.callbacks.onModified())},this.onACKTimeout=function(){console.warn("receive ACK frame timeout. it will send a ping"),_this97.pingPongNode.ping(os.pingAfterAckTimeout)["catch"](function(){_this97.onClientCrashWithError(new Error("connection failed because pong timeout after receive ACK frame timeout"))})},this.onClientCrashWithError=function(t){_this97._phase===j.Connected&&_this97.socketSession.reconnectWithError(t)},this.onFrameReceivedInterval=function(t){_this97.callbacks.onFrameReceivedInterval&&(_this97.callbacks.onFrameReceivedInterval(t),_this97.receivedIntervalResetter.refreshAndInvokeAfterInterval(os.receivedIntervalResetterCleanInterval))},this.onDisconnectWithError=function(t){if(_this97.magixSession.destroy(),_this97.pingPongNode.unbindSocket(),_this97.phase!==j.Disconnected){var i=_this97._phase;_this97.socketSession.dispose(),_this97.isReconnecting=!1,_this97.changePhase(j.Disconnected),_this97.reconnectionResultReceiver&&(_this97.reconnectionResultReceiver(t),_this97.reconnectionResultReceiver=null),i===j.Connecting?_this97.errorWhenConnecting=t:_this97.callbacks.onDisconnectWithError&&_this97.callbacks.onDisconnectWithError(t)}},this.onKickedWithReason=function(t){if(_this97.magixSession.destroy(),_this97.pingPongNode.unbindSocket(),_this97.phase!==j.Disconnected){var i=_this97._phase,r=new Error("kicked by server when connecting: ".concat(t));_this97.socketSession.dispose(),_this97.isReconnecting=!1,_this97.changePhase(j.Disconnected),_this97.reconnectionResultReceiver&&(_this97.reconnectionResultReceiver(r),_this97.reconnectionResultReceiver=null),i===j.Connecting&&(_this97.errorWhenConnecting=r),_this97.callbacks.onKickedWithReason&&_this97.callbacks.onKickedWithReason(t)}},this.logger=e.logger,this.imageFactory=e.imageFactory,this.libraryNodeFetcher=e.libraryNodeFetcher,this.fetcherFactory=e.fetcherFactory,this.enableAnimationFrame=e.enableAnimationFrame,this.reconnectionOptions=e.reconnectionOptions,this.toolsExtra=e.toolsExtra,this.netState=e.netState,this.clientVersion=e.clientVersion,this.callbacks=$s(e.callbacks),this.callbacks.onModified&&e.enableAnimationFrame&&(this.animationFrameTicker=new Rg(this.callbacks.onModified)),this.pingPongNode=new ns(this.logger.warn),this.authorState=new Ck(e.userPayload,this.onCleanSendingQueue,this.onSelfUserIdUpdate,this.onModified),this.ackTimeout=new Ik(os.ackTimeout,this.onACKTimeout),this.receivedIntervalResetter=new Pi(function(){_this97.callbacks.onFrameReceivedInterval&&_this97.callbacks.onFrameReceivedInterval(0)})}_createClass(os,[{key:"modifiable",get:function get(){return this._modifiable}},{key:"phase",get:function get(){return this._phase}},{key:"calibrationTimestamp",get:function get(){return this.pingPongNode.calibrationTimestamp}},{key:"timeDelay",get:function get(){return this._timeDelay},set:function set(e){this._timeDelay=e,this.magixSession&&this.magixSession.updateTimeDelay(e)}},{key:"session",get:function get(){return this.socketSession&&this.socketSession.session}},{key:"slice",get:function get(){return this.socketSession&&this.socketSession.slice}},{key:"changePhase",value:function changePhase(e){if(this._phase!==e){switch(this._phase=e,e){case j.Disconnecting:case j.Disconnected:{this.refreshACKTimeoutIsWorking(),this.receivedIntervalResetter.cancel();break}}this.callbacks.onPhaseChanged&&this.callbacks.onPhaseChanged(e)}}},{key:"selfUserId",get:function get(){return this.authorState.selfUserId}},{key:"isWritable",get:function get(){return this.authorState.selfUserId!==void 0}},{key:"imagePhase",get:function get(){if(!this.magixSession)throw new Error("image phase not exist when Magix's phase is ".concat(this.phase));return this.magixSession.imagePhase}},{key:"trigger",get:function get(){if(!this.magixSession)throw new Error("trigger object not exist when Magix's phase is ".concat(this.phase));return this.magixSession.trigger}},{key:"syncBlockTimestamp",value:function syncBlockTimestamp(e){var t;(t=this.magixSession)==null||t.syncBlockTimestamp(e)}},{key:"stopBlockTimestamp",value:function stopBlockTimestamp(){var e;(e=this.magixSession)==null||e.stopBlockTimestamp()}},{key:"setWritable",value:function(){var _setWritable=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee30(e,t){return regeneratorRuntime.wrap(function _callee30$(_context31){while(1){switch(_context31.prev=_context31.next){case 0:if(!(this._phase===j.Connected||this._phase===j.Reconnecting)){_context31.next=10;break}this.switchWritable=e,this.settingWritablePayload=e?t:void 0,this.refreshACKTimeoutIsWorking();_context31.prev=2;_context31.next=5;return this.authorState.setWritable(e,t);case 5:_context31.prev=5;this.refreshACKTimeoutIsWorking();return _context31.finish(5);case 8:_context31.next=11;break;case 10:throw new Error("can't only set writable when connected or reconnecting");case 11:case"end":return _context31.stop();}}},_callee30,this,[[2,,5,8]])}));function setWritable(_x37,_x38){return _setWritable.apply(this,arguments)}return setWritable}()},{key:"connect",value:function(){var _connect5=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee31(e){var _this98=this;var t,_yield$ck,i,r,n,s,o,a;return regeneratorRuntime.wrap(function _callee31$(_context32){while(1){switch(_context32.prev=_context32.next){case 0:t=Date.now();if(!(this.phase!==j.Ready)){_context32.next=3;break}throw new Error("can't connect when Magix's phase is ".concat(this.phase));case 3:this.changePhase(j.Connecting);_context32.prev=4;_context32.next=7;return ck({logger:this.logger,fetcher:this.fetcherFactory.create(e.region),uuid:e.uuid,roomToken:e.roomToken,timeout:45*1e3,markWritable:e.isWritable,clientVersion:this.clientVersion,access:xk(e.roomToken),netState:this.netState,reconnectionOptions:this.reconnectionOptions,objectOperator:this.imageFactory.proxyManager.objectOperator,libraryNodeFetcher:this.libraryNodeFetcher,callbacks:{onReceivedActionFrame:this.onReceivedActionFrame,onReceivedScopeSlices:this.onReceivedScopeSlices,onBeginReconnect:this.onBeginReconnect,onReconnected:this.onReconnected,onSliceUpdate:this.callbacks.onSliceChanged,onSessionUpdate:this.callbacks.onSessionChanged,onDisconnectedByServer:this.onDisconnectWithError,onDisconnectedWithSocketError:this.onDisconnectWithError,onKickWithReason:this.onKickedWithReason}});case 7:_yield$ck=_context32.sent;i=_yield$ck.session;r=_yield$ck.connection;n=_yield$ck.snapshot;s=_yield$ck.actionFrames;o=_yield$ck.retryCount;this.socketSession=i;this.settingWritablePayload=e.connectedPayload;this.buildMagixSession({connection:r,snapshot:n,actionFrames:s,pendingReportChanged:!1});_context32.t0=e.isWritable;if(!_context32.t0){_context32.next=21;break}_context32.next=20;return this.authorState.setWritable(!0,e.connectedPayload);case 20:this.switchWritable=!0;case 21:if(!this.isReconnecting){_context32.next=29;break}_context32.next=24;return new Promise(function(l){_this98.reconnectionResultReceiver=l});case 24:a=_context32.sent;if(!a){_context32.next=27;break}throw a;case 27:_context32.next=31;break;case 29:if(!(this._phase!==j.Connecting)){_context32.next=31;break}throw this.errorWhenConnecting?this.errorWhenConnecting:new Error("magix connect fail with invalid phase ".concat(this._phase));case 31:return _context32.abrupt("return",(this.changePhase(j.Connected),{libraryNode:i.libraryNode,statistics:{retryCount:o,buildWebSocketDuration:i.connection.connectingDuration,buildMagixDuration:Date.now()-t}}));case 34:_context32.prev=34;_context32.t1=_context32["catch"](4);throw this.cleanActionFramesBufferList(),this.changePhase(j.Disconnected),this.pingPongNode.unbindSocket(),_context32.t1;case 37:case"end":return _context32.stop();}}},_callee31,this,[[4,34]])}));function connect(_x39){return _connect5.apply(this,arguments)}return connect}()},{key:"reconnectWithError",value:function reconnectWithError(e){if(this._phase!==j.Reconnecting){if(this._phase!==j.Connected)throw new Error("can't reconnect when magix's phase is ".concat(this._phase));this.socketSession.reconnectWithError(e)}}},{key:"buildMagixSession",value:function buildMagixSession(_ref33){var _this99=this;var e=_ref33.connection,t=_ref33.snapshot,i=_ref33.actionFrames,r=_ref33.pendingReportChanged;this.magixSession&&this.magixSession.destroy(),t.byteLength>=os.hugeSnapshotBytes&&(this.ackTimeout.timeout=os.hugeSnapshotAckTimeout);var n=this.magixSession=new wk({logger:this.logger,library:td(this.socketSession.libraryNode.libraryClass),connection:e,pendingReportChanged:r,snapshot:t,initializeActionFrames:i,imageFactory:this.imageFactory,enableAnimationFrame:this.enableAnimationFrame,originalMagixSession:this.magixSession,timeDelay:this._timeDelay,toolsExtra:this.toolsExtra,callbacks:{onImagePhaseChanged:function onImagePhaseChanged(s){return _this99.onImagePhaseChanged(n,s)},onGeneratedActionFrame:this.onGeneratedActionFrame,onModified:this.onModified,onEventFire:this.wrapeEventFireCallback(this.callbacks.onEventFire),onEventFireACK:this.wrapeEventFireCallback(this.callbacks.onEventFireACK),onClientCrashWithError:this.onClientCrashWithError,onFrameReceivedInterval:this.onFrameReceivedInterval,onReceivedRttReport:this.callbacks.onReceivedRttReport,onIllusionQueueLengthChanged:this.callbacks.onIllusionQueueLengthChanged,onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame||function(s,o){return _this99.logger.error(o)}}});e.bindPingPongNode(this.pingPongNode),this.magixSession.setModifiable(this._modifiable),this.authorState.setConnectedMagixSession(this.magixSession)}},{key:"disconnect",value:function(){var _disconnect=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee32(){return regeneratorRuntime.wrap(function _callee32$(_context33){while(1){switch(_context33.prev=_context33.next){case 0:if(!(this.isReconnecting=!1,this.phase===j.Reconnecting)){_context33.next=4;break}this.socketSession.dispose(),this.pingPongNode.unbindSocket(),this.changePhase(j.Disconnected);_context33.next=27;break;case 4:if(!(this.phase===j.Connected)){_context33.next=26;break}this.pingPongNode.unbindSocket(),this.changePhase(j.Disconnecting);_context33.prev=6;_context33.t0=this.magixSession;if(!_context33.t0){_context33.next=18;break}_context33.next=11;return this.authorState.finalUserId;case 11:_context33.t1=_context33.sent;_context33.t2=void 0;_context33.t3=_context33.t1!==_context33.t2;if(!_context33.t3){_context33.next=17;break}_context33.next=17;return this.magixSession.removeAllocatedUser();case 17:this.magixSession.destroy();case 18:_context33.next=20;return this.socketSession.connection.disconnect();case 20:this.socketSession.dispose();case 21:_context33.prev=21;this.changePhase(j.Disconnected);return _context33.finish(21);case 24:_context33.next=27;break;case 26:throw new Error("can't disconnect when Magix's phase is ".concat(this.phase));case 27:case"end":return _context33.stop();}}},_callee32,this,[[6,,21,24]])}));function disconnect(){return _disconnect.apply(this,arguments)}return disconnect}()},{key:"dispatch",value:function dispatch(e,t){if(this.phase!==j.Connected)throw new Error("can't dispatch event when Magix's phase is ".concat(this.phase));this.magixSession.dispatch(e,t)}},{key:"refreshACKTimeoutIsWorking",value:function refreshACKTimeoutIsWorking(){this.beginReconnectAt===0&&this.switchWritable&&this.isWritable&&this._phase===j.Connected?this.ackTimeout.isWorking=!0:this.ackTimeout.isWorking=!1}},{key:"onImagePhaseChanged",value:function onImagePhaseChanged(e,t){this.callbacks.onImagePhaseChanged&&this.magixSession===e&&this.callbacks.onImagePhaseChanged(t)}},{key:"wrapeEventFireCallback",value:function wrapeEventFireCallback(e){if(e)return function(t){return e(ba(t,Mi.Dispatched))}}},{key:"cleanActionFramesBufferList",value:function cleanActionFramesBufferList(){return this.actionFramePickersList.splice(0,this.actionFramePickersList.length)}}]);return os}(),as=os;as.receivedIntervalResetterCleanInterval=700,as.ackTimeout=7*1e3,as.pingAfterAckTimeout=7*1e3,as.hugeSnapshotAckTimeout=26*1e3,as.hugeSnapshotBytes=1024*1024;var Mk=/*#__PURE__*/function(){function Mk(e,t,i,r,n,s){_classCallCheck(this,Mk);this.fetcherFactory=e,this.imageFactory=t,this.reconnectionOptions=i,this.netState=r,this.clientVersion=n,this.magixConfiguration=Object.freeze(Gt({},s))}_createClass(Mk,[{key:"createMagix",value:function createMagix(e,t){return new as({logger:t.logger,fetcherFactory:this.fetcherFactory,libraryNodeFetcher:t.libraryNodeFetcher,imageFactory:this.imageFactory,toolsExtra:e,enableAnimationFrame:this.magixConfiguration.enableAnimationFrame,reconnectionOptions:this.reconnectionOptions,netState:this.netState,userPayload:t.userPayload,clientVersion:this.clientVersion,callbacks:t.callbacks||{}})}}]);return Mk}(),j;(function(e){e.Ready="ready",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnecting="disconnecting",e.Disconnected="disconnected"})(j||(j={}));function zg(_x40){return _zg.apply(this,arguments)}function _zg(){_zg=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee110(e){var t,i,_r248;return regeneratorRuntime.wrap(function _callee110$(_context114){while(1){switch(_context114.prev=_context114.next){case 0:t=3;_r248=0;case 2:if(!(_r248<t)){_context114.next=15;break}_context114.prev=3;_context114.next=6;return e();case 6:return _context114.abrupt("return",_context114.sent);case 9:_context114.prev=9;_context114.t0=_context114["catch"](3);i=_context114.t0;case 12:++_r248;_context114.next=2;break;case 15:throw i;case 16:case"end":return _context114.stop();}}},_callee110,null,[[3,9]])}));return _zg.apply(this,arguments)}var Ug=/*#__PURE__*/function(){function Ug(e){var _this100=this;_classCallCheck(this,Ug);this.isDownloading=!1,this.didDestroy=!1,this.onPlayActionFrames=function(t){var i=[];var _iterator102=_createForOfIteratorHelper(t),_step102;try{for(_iterator102.s();!(_step102=_iterator102.n()).done;){var _step102$value=_step102.value,r=_step102$value.sequenceInitializer,n=_step102$value.framePicker;r&&(i.length>0&&(_this100.image.appendActionFrames(i),i=[]),_this100.image=_this100.createImage(r,_this100.image),_this100._libIdentifier=r.libIdentifier,_this100._libraryNode=r.libraryNode,_this100.playingSliceIndex+=1,_this100.callbacks.onSliceChanged&&_this100.callbacks.onSliceChanged()),n&&i.push(n.frameBuffer)}}catch(err){_iterator102.e(err)}finally{_iterator102.f()}i.length>0&&_this100.image.appendActionFrames(i)},this.onBufferRemainLow=function(){_this100.isDownloading||_this100.loadActionFrames()},this.onPlayerBufferPhaseChanged=function(t){_this100.callbacks.onPhaseChanged&&_this100.callbacks.onPhaseChanged(t)},this.logger=e.logger,this.imageFactory=e.imageFactory,this.sliceChunk=e.sliceChunk,this.sequenceFetcher=e.sequenceFetcher,this.toolsExtra=e.toolsExtra,this.fetchingSliceIndex=e.beginSliceIndex,this.playingSliceIndex=e.beginSliceIndex,this.callbacks=e.callbacks,this.isFirstSlice=!0,this.image=this.createImage(e.sequenceInitializer,e.originalReconstructorLine&&e.originalReconstructorLine.image),this.latestFetchingFrameId=this.image.frameId,this.latestPlayingFrameId=this.image.frameId,this.beginTimestamp=e.initFrameTimestamp===void 0?this.image.timestamp:e.initFrameTimestamp,this._libIdentifier=e.sequenceInitializer.libIdentifier,this._libraryNode=e.sequenceInitializer.libraryNode,this.playerBuffer=Bg.create({logger:e.logger,mode:ss.Reconstruction,enableAnimationFrame:e.enableAnimationFrame,initFrameTimestamp:this.beginTimestamp,endFrameTimestamp:this.sliceChunk.beginTimestamp+this.sliceChunk.duration,callbacks:{onBufferRemainLow:this.onBufferRemainLow,onPlayActionFrames:this.onPlayActionFrames,onPhaseChanged:this.onPlayerBufferPhaseChanged,onTick:e.callbacks.onTick}}),this.playerBuffer.playbackSpeed=e.playbackSpeed}_createClass(Ug,[{key:"trigger",get:function get(){return this.image.trigger}},{key:"libIdentifier",get:function get(){return this._libIdentifier}},{key:"libraryNode",get:function get(){return this._libraryNode}},{key:"playbackSpeed",get:function get(){return this.playerBuffer.playbackSpeed},set:function set(e){this.playerBuffer.playbackSpeed=e}},{key:"createImage",value:function createImage(_ref34,n){var e=_ref34.snapshot,t=_ref34.actionFrames,i=_ref34.akkoSerVersion,r=_ref34.libraryNode;var s=this.imageFactory.createWithSnapshot({logger:this.logger,observerId:ce,library:td(r.libraryClass),snapshotFrame:e,actionFrames:t,originalImage:n,toolsExtra:this.toolsExtra,roomUUID:this.sliceChunk.roomUUID,includesFrameHash:!1,ignoreHashChecking:!0,pendingReportChanged:!1,snapshotDeserializerVersion:i,actionDeserializerVersion:i,callbacks:{onModified:this.callbacks.onModified,onEventFire:this.callbacks.onEventFire,onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame}});return s.modifiable=!1,s}},{key:"slice",get:function get(){return this.sliceChunk.sliceAt(this.playingSliceIndex)}},{key:"sliceIndex",get:function get(){return this.playingSliceIndex}},{key:"play",value:function play(){this.playerBuffer.play()}},{key:"pause",value:function pause(){this.playerBuffer.pause()}},{key:"setup",value:function setup(){var e=this.sliceChunk.beginTimestamp+this.sliceChunk.duration;this.beginTimestamp<e?this.loadActionFrames():this.playerBuffer.completePushFrames()}},{key:"destroy",value:function destroy(){this.didDestroy||(this.playerBuffer.pause(),this.image.destroy(),this.didDestroy=!0)}},{key:"phase",get:function get(){return this.playerBuffer.phase}},{key:"isRemainFramesToFetch",value:function isRemainFramesToFetch(){return this.fetchingSliceIndex<this.sliceChunk.slicesCount}},{key:"loadActionFrames",value:function loadActionFrames(){var _this101=this;this.fillActionFramesIntoBuffer()["catch"](function(e){return _this101.logger.error(e)})}},{key:"fillActionFramesIntoBuffer",value:function(){var _fillActionFramesIntoBuffer=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee33(){var e,t,i,r;return regeneratorRuntime.wrap(function _callee33$(_context34){while(1){switch(_context34.prev=_context34.next){case 0:if(!this.isRemainFramesToFetch()){_context34.next=18;break}_context34.prev=1;this.isDownloading=!0;_context34.next=5;return this.fetchFrames();case 5:e=_context34.sent;t=this.sliceChunk.beginTimestamp+this.sliceChunk.duration;i=this.removeTimestampOverFrames(e,t);r=e[e.length-1];r&&(this.latestPlayingFrameId=r.frameId),this.shouldPushEndSpaceHolderFrame(e,i,t)&&e.push({frameId:this.latestPlayingFrameId+1,timestamp:t}),e.length>0&&this.playerBuffer.pushFrames(e),this.isRemainFramesToFetch()||this.playerBuffer.completePushFrames();_context34.next=15;break;case 12:_context34.prev=12;_context34.t0=_context34["catch"](1);this.callbacks.onCatchErrorWhenFetchBuffer&&this.callbacks.onCatchErrorWhenFetchBuffer(_context34.t0);case 15:_context34.prev=15;this.isDownloading=!1;return _context34.finish(15);case 18:case"end":return _context34.stop();}}},_callee33,this,[[1,12,15,18]])}));function fillActionFramesIntoBuffer(){return _fillActionFramesIntoBuffer.apply(this,arguments)}return fillActionFramesIntoBuffer}()},{key:"shouldPushEndSpaceHolderFrame",value:function shouldPushEndSpaceHolderFrame(e,t,i){var r=e[e.length-1];return(t||!this.isRemainFramesToFetch())&&(!r||r.timestamp<i)}},{key:"fetchFrames",value:function(){var _fetchFrames=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee34(){var _this102=this;var e,t,i,r,_yield$Promise$all,_yield$Promise$all2,n,s,o,_iterator103,_step103,a;return regeneratorRuntime.wrap(function _callee34$(_context35){while(1){switch(_context35.prev=_context35.next){case 0:if(!(e=this.sliceChunk.sliceAt(this.fetchingSliceIndex),!e)){_context35.next=2;break}return _context35.abrupt("return",[]);case 2:if(!(t=e.framesCount-this.latestFetchingFrameId,t>0)){_context35.next=4;break}return _context35.abrupt("break",7);case 4:this.latestFetchingFrameId=0,this.latestPlayingFrameId=0,this.fetchingSliceIndex+=1,this.isFirstSlice=!1;case 5:_context35.next=0;break;case 7:i=Math.min(t,Ug.fetchFramesCountOnce);r=this.latestFetchingFrameId===0&&!this.isFirstSlice;_context35.next=11;return Promise.all([zg(function(){return _this102.sequenceFetcher.fetchFramePickers(e,_this102.latestFetchingFrameId,i)}),r?zg(function(){return _this102.sequenceFetcher.initializeWithFrameId(e,_this102.latestFetchingFrameId)}):Promise.resolve(void 0)]);case 11:_yield$Promise$all=_context35.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);n=_yield$Promise$all2[0];s=_yield$Promise$all2[1];o=[];_iterator103=_createForOfIteratorHelper(n);try{for(_iterator103.s();!(_step103=_iterator103.n()).done;){a=_step103.value;this.latestFetchingFrameId=a.frameId,o.push({frameId:a.frameId,timestamp:a.timestamp,framePicker:a})}}catch(err){_iterator103.e(err)}finally{_iterator103.f()}return _context35.abrupt("return",(s&&(o[0].sequenceInitializer=s),o));case 19:case"end":return _context35.stop();}}},_callee34,this)}));function fetchFrames(){return _fetchFrames.apply(this,arguments)}return fetchFrames}()},{key:"removeTimestampOverFrames",value:function removeTimestampOverFrames(e,t){var i=e.findIndex(function(r){return r.timestamp>t});return i!==-1?(e.splice(i,e.length-i),!0):!1}}]);return Ug}(),sd=Ug;sd.fetchFramesCountOnce=600;var Tk=/*#__PURE__*/function(){function Tk(e){_classCallCheck(this,Tk);this.sliceChunk=e.sliceChunk,this.imageFactory=e.imageFactory,this.sequenceFetcher=e.sequenceFetcher,this.toolsExtra=e.toolsExtra,this.enableAnimationFrame=e.enableAnimationFrame}_createClass(Tk,[{key:"createWithFrameId",value:function(){var _createWithFrameId=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee35(e,t,i,r,n){var _this$sliceChunk$getF,s,o,a,l;return regeneratorRuntime.wrap(function _callee35$(_context36){while(1){switch(_context36.prev=_context36.next){case 0:_this$sliceChunk$getF=this.sliceChunk.getFrameDescriptionWithFrameId(t);s=_this$sliceChunk$getF.sliceIndex;o=_this$sliceChunk$getF.frameId;a=this.sliceChunk.sliceAt(s);_context36.next=6;return this.sequenceFetcher.initializeWithFrameId(a,o);case 6:l=_context36.sent;return _context36.abrupt("return",new sd({logger:e,imageFactory:this.imageFactory,sequenceFetcher:this.sequenceFetcher,originalReconstructorLine:n,sliceChunk:this.sliceChunk,toolsExtra:this.toolsExtra,beginSliceIndex:s,initFrameTimestamp:this.sliceChunk.beginTimestamp,sequenceInitializer:l,enableAnimationFrame:this.enableAnimationFrame,playbackSpeed:i,callbacks:r}));case 8:case"end":return _context36.stop();}}},_callee35,this)}));function createWithFrameId(_x41,_x42,_x43,_x44,_x45){return _createWithFrameId.apply(this,arguments)}return createWithFrameId}()},{key:"createWithProgressTime",value:function(){var _createWithProgressTime=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee36(e,t,i,r,n){var _this$sliceChunk$getF2,s,o,a,l,h;return regeneratorRuntime.wrap(function _callee36$(_context37){while(1){switch(_context37.prev=_context37.next){case 0:_this$sliceChunk$getF2=this.sliceChunk.getFrameDescriptionWithTimestamp(t);s=_this$sliceChunk$getF2.sliceIndex;o=_this$sliceChunk$getF2.timestamp;a=this.sliceChunk.sliceAt(s);l=o+a.beginTimestamp;_context37.next=7;return this.sequenceFetcher.initializeWithTimestamp(a,l);case 7:h=_context37.sent;return _context37.abrupt("return",new sd({logger:e,imageFactory:this.imageFactory,sequenceFetcher:this.sequenceFetcher,originalReconstructorLine:n,sliceChunk:this.sliceChunk,toolsExtra:this.toolsExtra,beginSliceIndex:s,initFrameTimestamp:this.sliceChunk.beginTimestamp+t,sequenceInitializer:h,enableAnimationFrame:this.enableAnimationFrame,playbackSpeed:i,callbacks:r}));case 9:case"end":return _context37.stop();}}},_callee36,this)}));function createWithProgressTime(_x46,_x47,_x48,_x49,_x50){return _createWithProgressTime.apply(this,arguments)}return createWithProgressTime}()}]);return Tk}(),Vg;(function(e){e[e.FrameId=0]="FrameId",e[e.ProgressTime=1]="ProgressTime"})(Vg||(Vg={}));var Ek=/*#__PURE__*/function(){function Ek(e){_classCallCheck(this,Ek);this.isRunningLoop=!1,this.task=null,this.id=0,this.callbacks=Object.freeze(Gt({},e))}_createClass(Ek,[{key:"currentTaskId",get:function get(){return this.id}},{key:"isSeeking",get:function get(){return this.isRunningLoop}},{key:"stopSeeking",value:function stopSeeking(){this.task&&(this.task.complete($t.Stopped),this.task=null),this.id+=1}},{key:"seekToFrameId",value:function seekToFrameId(e){var _this103=this;return new Promise(function(t){!_this103.task||_this103.task.mode!==0||_this103.task.value!==e?(_this103.setNewTask(0,e,t),_this103.startTaskLoop()["catch"](function(i){return console.error(i)})):t($t.SuccessButUnnecessary)})}},{key:"seekToProgressTime",value:function seekToProgressTime(e){var _this104=this;return new Promise(function(t){!_this104.task||_this104.task.mode!==1||_this104.task.value!==e?(_this104.setNewTask(1,e,t),_this104.startTaskLoop()["catch"](function(i){return console.error(i)})):t($t.SuccessButUnnecessary)})}},{key:"setNewTask",value:function setNewTask(e,t,i){var r=this.id+=1;this.task&&this.task.complete($t.Override),this.task={id:r,mode:e,value:t,complete:i}}},{key:"startTaskLoop",value:function(){var _startTaskLoop=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee37(){var e,_this$task,t,i,r,n;return regeneratorRuntime.wrap(function _callee37$(_context38){while(1){switch(_context38.prev=_context38.next){case 0:if(this.isRunningLoop){_context38.next=23;break}_context38.prev=1;this.isRunningLoop=!0,this.callbacks.updateIsSeeking();case 3:if(!this.task){_context38.next=20;break}_this$task=this.task,t=_this$task.id,i=_this$task.mode,r=_this$task.value,n=void 0;_context38.t0=i;_context38.next=_context38.t0===0?8:_context38.t0===1?12:16;break;case 8:_context38.next=10;return this.callbacks.startSeekingToFrameId(t,r);case 10:n=_context38.sent;return _context38.abrupt("break",17);case 12:_context38.next=14;return this.callbacks.startSeekingToProgressTime(t,r);case 14:n=_context38.sent;return _context38.abrupt("break",17);case 16:throw new Error("invalid mode ".concat(i));case 17:this.id===t?((e=this.task)==null||e.complete($t.Success),this.task=null,this.callbacks.afterSeeking(n)):this.callbacks.cancelSeeking(n);case 18:_context38.next=3;break;case 20:_context38.prev=20;this.isRunningLoop=!1,this.callbacks.updateIsSeeking();return _context38.finish(20);case 23:case"end":return _context38.stop();}}},_callee37,this,[[1,,20,23]])}));function startTaskLoop(){return _startTaskLoop.apply(this,arguments)}return startTaskLoop}()}]);return Ek}(),Ak=/*#__PURE__*/function(){function Ak(e){var _this105=this;_classCallCheck(this,Ak);this._progressTime=0,this._playbackSpeed=1,this.isPlaying=!1,this.isMaskPhaseUpdating=!1,this.didStop=!1,this.currentLine=void 0,this.startSeekingToFrameId=/*#__PURE__*/function(){var _ref35=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee38(t,i){var r,n;return regeneratorRuntime.wrap(function _callee38$(_context39){while(1){switch(_context39.prev=_context39.next){case 0:r=i;r=Math.max(r,0),r=Math.min(r,_this105.framesCount);n=function n(s){return _this105.lineFactory.createWithFrameId(_this105.logger,r,_this105.playbackSpeed,s,_this105.currentLine)};_context39.next=5;return _this105.startSeekingTask(t,n);case 5:return _context39.abrupt("return",_context39.sent);case 6:case"end":return _context39.stop();}}},_callee38)}));return function(_x51,_x52){return _ref35.apply(this,arguments)}}(),this.startSeekingToProgressTime=/*#__PURE__*/function(){var _ref36=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee39(t,i){var r,n;return regeneratorRuntime.wrap(function _callee39$(_context40){while(1){switch(_context40.prev=_context40.next){case 0:r=i;r=Math.max(r,0),r=Math.min(r,_this105.duration),Number.isSafeInteger(r)||(r=Math.floor(r));n=function n(s){return _this105.lineFactory.createWithProgressTime(_this105.logger,r,_this105.playbackSpeed,s,_this105.currentLine)};_context40.next=5;return _this105.startSeekingTask(t,n);case 5:return _context40.abrupt("return",_context40.sent);case 6:case"end":return _context40.stop();}}},_callee39)}));return function(_x53,_x54){return _ref36.apply(this,arguments)}}(),this.afterSeeking=function(t){try{_this105.isMaskPhaseUpdating=!0,t.setup()}finally{_this105.isMaskPhaseUpdating=!1}_this105.changeCurrentLine(t)},this.cancelSeeking=function(t){t.destroy()},this.onLineSliceChanged=function(){var t,i;_this105.currentLine&&(_this105.sliceStateUpdater.refreshReconstructorLine(_this105.currentLine),_this105.callbacks.onModified&&_this105.callbacks.onModified(),_this105.onTick(_this105.currentLine.beginTimestamp),(i=(t=_this105.callbacks).onTriggerBuilt)==null||i.call(t))},this.currentIsPlayable=function(){if(_this105.didStop||!_this105.currentLine||_this105.seekingNode.isSeeking)return!1;switch(_this105.currentLine.phase){case be.Playing:case be.Pausing:return!0;case be.PausingAndWaiting:case be.Waiting:case be.Ended:return!1;default:return!1;}},this.currentPhase=function(){if(_this105.didStop)return fe.Stopped;if(!_this105.currentLine)return fe.WaitingFirstFrame;if(_this105.seekingNode.isSeeking)return fe.Seeking;switch(_this105.currentLine.phase){case be.Playing:return fe.Playing;case be.Pausing:case be.PausingAndWaiting:return fe.Pause;case be.Waiting:return fe.Buffering;case be.Ended:return fe.Ended;default:throw new Error("invalid phase ".concat(_this105.currentLine.phase));}},this.touchPhaseChanged=function(){_this105.isMaskPhaseUpdating||(_this105.phaseNode.touch(),_this105.isPlayableNode.touch())},this.onTick=function(t){var i=Math.min(t-_this105.beginTimestamp,_this105.sliceChunk.duration);_this105._progressTime=i,_this105.callbacks.onProgressTimeChanged&&_this105.callbacks.onProgressTimeChanged(i)},this.onCatchError=function(t){_this105.didStop||(_this105.stop(),_this105.callbacks.onStoppedWithError&&_this105.callbacks.onStoppedWithError(t))},this.onEventFire=function(t){_this105.callbacks.onEventFire&&_this105.callbacks.onEventFire(ba(t,Mi.Dispatched))},this.logger=e.logger,this.sliceChunk=e.sliceChunk,this.sequenceFetcher=e.sequenceFetcher,this.callbacks=$s(e.callbacks),this.sliceStateUpdater=e.sliceStateUpdater,this.sliceStateUpdater.onSliceChanged=this.callbacks.onSliceChanged,this.sliceStateUpdater.onLibraryNodeChanged=this.callbacks.onLibraryNodeChanged,this.seekingNode=new Ek({startSeekingToFrameId:this.startSeekingToFrameId,startSeekingToProgressTime:this.startSeekingToProgressTime,afterSeeking:this.afterSeeking,cancelSeeking:this.cancelSeeking,updateIsSeeking:this.touchPhaseChanged}),this.isPlayableNode=new Kn({phase:!1,onPhaseChanged:e.callbacks.onIsPlayableChanged,getCurrentPhase:this.currentIsPlayable}),this.phaseNode=new Kn({phase:fe.WaitingFirstFrame,onPhaseChanged:e.callbacks.onPhaseChanged,getCurrentPhase:this.currentPhase}),this.lineFactory=new Tk({sliceChunk:e.sliceChunk,imageFactory:e.imageFactory,sequenceFetcher:e.sequenceFetcher,toolsExtra:e.toolsExtra,enableAnimationFrame:e.enableAnimationFrame})}_createClass(Ak,[{key:"trigger",get:function get(){if(!this.currentLine)throw new Error("trigger object not exist when Reconstructor's phase is ".concat(this.phase));return this.currentLine.trigger}},{key:"isPlayable",get:function get(){return this.isPlayableNode.phase}},{key:"phase",get:function get(){return this.phaseNode.phase}},{key:"progressTime",get:function get(){return this._progressTime}},{key:"slice",get:function get(){return this.sliceStateUpdater.slice}},{key:"sliceIndex",get:function get(){return this.sliceStateUpdater.sliceIndex}},{key:"libIdentifier",get:function get(){return this.sliceStateUpdater.libIdentifier}},{key:"libraryNode",get:function get(){return this.sliceStateUpdater.libraryNode}},{key:"roomUUID",get:function get(){return this.sliceChunk.roomUUID}},{key:"duration",get:function get(){return this.sliceChunk.duration}},{key:"framesCount",get:function get(){return this.sliceChunk.framesCount}},{key:"beginTimestamp",get:function get(){return this.sliceChunk.beginTimestamp}},{key:"playbackSpeed",get:function get(){return this.currentLine?this.currentLine.playbackSpeed:this._playbackSpeed},set:function set(e){this._playbackSpeed=e,this.currentLine&&(this.currentLine.playbackSpeed=e)}},{key:"play",value:function play(){var _this106=this;if(this.assertNotStop(),this.phaseNode.phase!==fe.Ended){var e=this.isPlaying;this.isPlaying=!0,!e&&!this.seekingNode.isSeeking&&(this.currentLine?this.currentLine.play():this.seekToProgressTime(0)["catch"](function(t){return _this106.logger.error(t)})),this.touchPhaseChanged()}}},{key:"pause",value:function pause(){this.assertNotStop(),this.isPlaying&&!this.seekingNode.isSeeking&&this.currentLine&&this.currentLine.pause(),this.isPlaying=!1,this.touchPhaseChanged()}},{key:"stop",value:function stop(){this.assertNotStop(),this.seekingNode.stopSeeking(),this.currentLine&&(this.currentLine.destroy(),this.currentLine=void 0),this.didStop=!0,this.touchPhaseChanged()}},{key:"seekToFrameId",value:function seekToFrameId(e){return this.assertNotStop(),this.seekingNode.seekToFrameId(e)}},{key:"seekToProgressTime",value:function seekToProgressTime(e){return this.assertNotStop(),this.seekingNode.seekToProgressTime(e)}},{key:"startSeekingTask",value:function(){var _startSeekingTask=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee40(e,t){var i;return regeneratorRuntime.wrap(function _callee40$(_context41){while(1){switch(_context41.prev=_context41.next){case 0:_context41.prev=0;i=Gt({},this.wrapCallbacksWithTaskChecking(e,{onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame,onCatchErrorWhenFetchBuffer:this.onCatchError,onModified:this.callbacks.onModified,onSliceChanged:this.onLineSliceChanged,onEventFire:this.onEventFire,onTick:this.onTick,onPhaseChanged:this.touchPhaseChanged}));_context41.next=4;return t(i);case 4:return _context41.abrupt("return",_context41.sent);case 7:_context41.prev=7;_context41.t0=_context41["catch"](0);throw this.onCatchError(_context41.t0),_context41.t0;case 10:case"end":return _context41.stop();}}},_callee40,this,[[0,7]])}));function startSeekingTask(_x55,_x56){return _startSeekingTask.apply(this,arguments)}return startSeekingTask}()},{key:"changeCurrentLine",value:function changeCurrentLine(e){var t,i;this.currentLine&&this.currentLine.destroy(),this.currentLine=e,this.sliceStateUpdater.refreshReconstructorLine(e),this.isPlaying&&e.play(),this.callbacks.onModified&&this.callbacks.onModified(),this.onTick(e.beginTimestamp),(i=(t=this.callbacks).onTriggerBuilt)==null||i.call(t)}},{key:"wrapCallbacksWithTaskChecking",value:function wrapCallbacksWithTaskChecking(e,t){var _this107=this;var i={};var _loop19=function _loop19(_r25){var n=t[_r25];n&&(i[_r25]=function(){if(e===_this107.seekingNode.currentTaskId)return n.apply(void 0,arguments)})};for(var _r25 in t){_loop19(_r25)}return i}},{key:"assertNotStop",value:function assertNotStop(){if(this.didStop)throw new Error("Reconstructor did stop")}}]);return Ak}(),ln=8;function Hg(e,t,i){var r=Math.min(e,i),n=Math.max(e,i),s=t;return t<r?s=r:t>n&&(s=n),s}var Ok=/*#__PURE__*/function(){function Ok(e){var _this108=this;_classCallCheck(this,Ok);this.fetchLibraryNode=/*#__PURE__*/function(){var _ref37=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee41(t,i){var _r26;return regeneratorRuntime.wrap(function _callee41$(_context42){while(1){switch(_context42.prev=_context42.next){case 0:if(!(_this108.previousLibraryNode&&_this108.previousLibraryNode.libIdentifier===i)){_context42.next=2;break}return _context42.abrupt("return",_this108.previousLibraryNode.libraryNode);case 2:_context42.next=4;return _this108.libraryNodeFetcher({appIdentifier:t.appIdentifier,appVersion:t.appVersion,appHash:t.appHash,libIdentifier:i});case 4:_r26=_context42.sent;return _context42.abrupt("return",(_this108.previousLibraryNode=Object.freeze({libIdentifier:i,libraryNode:_r26}),_r26));case 6:case"end":return _context42.stop();}}},_callee41)}));return function(_x57,_x58){return _ref37.apply(this,arguments)}}(),this.logger=e.logger,this.fetcher=e.fetcher,this.roomToken=e.roomToken,this.libraryNodeFetcher=e.libraryNodeFetcher}_createClass(Ok,[{key:"initializeWithTimestamp",value:function(){var _initializeWithTimestamp=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee42(e,t){var i,_yield$Promise$all3,_yield$Promise$all4,r,n;return regeneratorRuntime.wrap(function _callee42$(_context43){while(1){switch(_context43.prev=_context43.next){case 0:i=e.libIdentifier;_context43.next=3;return Promise.all([this.sequenceImageInitializerWithTimestamp(e,t),this.fetchLibraryNode(e,i)]);case 3:_yield$Promise$all3=_context43.sent;_yield$Promise$all4=_slicedToArray(_yield$Promise$all3,2);r=_yield$Promise$all4[0];n=_yield$Promise$all4[1];return _context43.abrupt("return",to(Gt({},r),{libraryNode:n,libIdentifier:i}));case 8:case"end":return _context43.stop();}}},_callee42,this)}));function initializeWithTimestamp(_x59,_x60){return _initializeWithTimestamp.apply(this,arguments)}return initializeWithTimestamp}()},{key:"initializeWithFrameId",value:function(){var _initializeWithFrameId=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee43(e,t){var i,_yield$Promise$all5,_yield$Promise$all6,r,n;return regeneratorRuntime.wrap(function _callee43$(_context44){while(1){switch(_context44.prev=_context44.next){case 0:i=e.libIdentifier;_context44.next=3;return Promise.all([this.sequenceImageInitializerWithFrameId(e,t),this.fetchLibraryNode(e,i)]);case 3:_yield$Promise$all5=_context44.sent;_yield$Promise$all6=_slicedToArray(_yield$Promise$all5,2);r=_yield$Promise$all6[0];n=_yield$Promise$all6[1];return _context44.abrupt("return",to(Gt({},r),{libraryNode:n,libIdentifier:i}));case 8:case"end":return _context44.stop();}}},_callee43,this)}));function initializeWithFrameId(_x61,_x62){return _initializeWithFrameId.apply(this,arguments)}return initializeWithFrameId}()},{key:"sequenceImageInitializerWithTimestamp",value:function(){var _sequenceImageInitializerWithTimestamp=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee44(e,t){var i,r,n,s,o,a,l,u,h,d;return regeneratorRuntime.wrap(function _callee44$(_context45){while(1){switch(_context45.prev=_context45.next){case 0:i=Hg(e.beginTimestamp,t,e.beginTimestamp+e.duration);_context45.next=3;return this.fetcher.fetch("persistence");case 3:r=_context45.sent;n=(0,Wg.stringify)({timestamp:i});s="https://persistence/pv/rooms/".concat(e.roomUUID,"/slices/").concat(e.uuid,"/snapshots?").concat(n);_context45.next=8;return r.fetchJSON(s,{method:"get",headers:{"content-type":"application/json",token:this.roomToken}});case 8:o=_context45.sent;o||(this.logger.warn("cannot find snapshot that timestamp=".concat(i," and slice=").concat(e.uuid)),o={frameId:0,timestamp:e.beginTimestamp});_context45.next=12;return this.fetchFrameRouterPicker(e,o.frameId);case 12:a=_context45.sent;l=0;for(u=0;u<a.framesCount&&a.timestampAt(u)<=t;u++){l+=1}_context45.next=17;return this.fetchSnapshot(e,o.frameId);case 17:h=_context45.sent;if(!(l===0)){_context45.next=22;break}_context45.t0=[];_context45.next=25;break;case 22:_context45.next=24;return this.fetchFramePickers(e,o.frameId,l);case 24:_context45.t0=_context45.sent;case 25:d=_context45.t0;return _context45.abrupt("return",{snapshot:h.frameBuffer,actionFrames:d.map(function(u){return u.frameBuffer}),akkoSerVersion:hi(e.akkoVersion)});case 27:case"end":return _context45.stop();}}},_callee44,this)}));function sequenceImageInitializerWithTimestamp(_x63,_x64){return _sequenceImageInitializerWithTimestamp.apply(this,arguments)}return sequenceImageInitializerWithTimestamp}()},{key:"sequenceImageInitializerWithFrameId",value:function(){var _sequenceImageInitializerWithFrameId=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee45(e,t){var i,r,n,s;return regeneratorRuntime.wrap(function _callee45$(_context46){while(1){switch(_context46.prev=_context46.next){case 0:i=Hg(0,t,e.framesCount-1);_context46.next=3;return this.fetchSnapshot(e,i);case 3:r=_context46.sent;n=i-r.frameId;if(!(n===0)){_context46.next=7;break}return _context46.abrupt("return",{snapshot:r.frameBuffer,actionFrames:[],akkoSerVersion:hi(e.akkoVersion)});case 7:_context46.next=9;return this.fetchFramePickers(e,r.frameId,n);case 9:s=_context46.sent;return _context46.abrupt("return",{snapshot:r.frameBuffer,actionFrames:s.map(function(o){return o.frameBuffer}),akkoSerVersion:hi(e.akkoVersion)});case 11:case"end":return _context46.stop();}}},_callee45,this)}));function sequenceImageInitializerWithFrameId(_x65,_x66){return _sequenceImageInitializerWithFrameId.apply(this,arguments)}return sequenceImageInitializerWithFrameId}()},{key:"fetchFramePickers",value:function(){var _fetchFramePickers=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee46(e,t,i){var _yield$this$getAssets,r,n,s,o,a,l,h,d,u,p;return regeneratorRuntime.wrap(function _callee46$(_context47){while(1){switch(_context47.prev=_context47.next){case 0:_context47.next=2;return this.getAssetsFetcherAndURL(e,"framesRouter");case 2:_yield$this$getAssets=_context47.sent;r=_yield$this$getAssets.fetcher;n=_yield$this$getAssets.url;_context47.next=7;return _a.pick(r,n,t,i);case 7:s=_context47.sent;_context47.next=10;return this.fetchBody(e,"framesBody",s.offset,s.length);case 10:o=_context47.sent;a=[];l=0;case 13:if(!(l<s.framesCount)){_context47.next=22;break}h=s.offsetAt(l)-s.offset,d=s.lengthAt(l);if(!(o.byteLength<h+d)){_context47.next=17;break}return _context47.abrupt("break",22);case 17:u=o.slice(h,d),p=new _t(u);a.push(p);case 19:++l;_context47.next=13;break;case 22:return _context47.abrupt("return",a);case 23:case"end":return _context47.stop();}}},_callee46,this)}));function fetchFramePickers(_x67,_x68,_x69){return _fetchFramePickers.apply(this,arguments)}return fetchFramePickers}()},{key:"fetchSnapshot",value:function(){var _fetchSnapshot=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee47(e,t){var _yield$this$getAssets2,i,r,n,s,o,a,l;return regeneratorRuntime.wrap(function _callee47$(_context48){while(1){switch(_context48.prev=_context48.next){case 0:_context48.next=2;return this.getAssetsFetcherAndURL(e,"snapshotsRouter");case 2:_yield$this$getAssets2=_context48.sent;i=_yield$this$getAssets2.fetcher;r=_yield$this$getAssets2.url;n=Math.floor(t/e.snapshotIdInterval);_context48.next=8;return _a.pick(i,r,n,1);case 8:s=_context48.sent;if(!(s.framesCount===0)){_context48.next=11;break}throw new Error("can't find snapshot with frameId ".concat(t));case 11:o=s.offsetAt(0);a=s.lengthAt(0);_context48.next=15;return this.fetchBody(e,"snapshotsBody",o,a);case 15:l=_context48.sent;return _context48.abrupt("return",new _t(l));case 17:case"end":return _context48.stop();}}},_callee47,this)}));function fetchSnapshot(_x70,_x71){return _fetchSnapshot.apply(this,arguments)}return fetchSnapshot}()},{key:"fetchFrameRouterPicker",value:function(){var _fetchFrameRouterPicker=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee48(e,t){var _yield$this$getAssets3,i,r,n;return regeneratorRuntime.wrap(function _callee48$(_context49){while(1){switch(_context49.prev=_context49.next){case 0:_context49.next=2;return this.getAssetsFetcherAndURL(e,"framesRouter");case 2:_yield$this$getAssets3=_context49.sent;i=_yield$this$getAssets3.fetcher;r=_yield$this$getAssets3.url;n=Math.min(e.framesCount-t,e.snapshotIdInterval-1);return _context49.abrupt("return",_a.pick(i,r,t,n));case 7:case"end":return _context49.stop();}}},_callee48,this)}));function fetchFrameRouterPicker(_x72,_x73){return _fetchFrameRouterPicker.apply(this,arguments)}return fetchFrameRouterPicker}()},{key:"fetchBody",value:function(){var _fetchBody=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee49(e,t,i,r){var _yield$this$getAssets4,n,s,o;return regeneratorRuntime.wrap(function _callee49$(_context50){while(1){switch(_context50.prev=_context50.next){case 0:_context50.next=2;return this.getAssetsFetcherAndURL(e,t);case 2:_yield$this$getAssets4=_context50.sent;n=_yield$this$getAssets4.fetcher;s=_yield$this$getAssets4.url;_context50.next=7;return n.fetchBuffer(s,{method:"get",headers:{"content-type":"application/json",Accept:"application/octet-stream",Range:"bytes=".concat(i,"-").concat(i+r)}});case 7:o=_context50.sent;if(o){_context50.next=10;break}throw new Error("can't find \"".concat(s,"\""));case 10:return _context50.abrupt("return",o);case 11:case"end":return _context50.stop();}}},_callee49,this)}));function fetchBody(_x74,_x75,_x76,_x77){return _fetchBody.apply(this,arguments)}return fetchBody}()},{key:"getAssetsFetcherAndURL",value:function(){var _getAssetsFetcherAndURL=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee50(_ref38,n){var e,t,i,r,s,o,a,l;return regeneratorRuntime.wrap(function _callee50$(_context51){while(1){switch(_context51.prev=_context51.next){case 0:e=_ref38.uuid,t=_ref38.roomUUID,i=_ref38.token,r=_ref38.signedUrl;_context51.t0=n;_context51.next=_context51.t0==="framesBody"?4:_context51.t0==="framesRouter"?6:_context51.t0==="snapshotsBody"?8:_context51.t0==="snapshotsRouter"?10:12;break;case 4:s="frames.body";return _context51.abrupt("break",12);case 6:s="frames.router";return _context51.abrupt("break",12);case 8:s="snapshots.body";return _context51.abrupt("break",12);case 10:s="snapshots.router";return _context51.abrupt("break",12);case 12:i?(o="assets-auth",a=i[n]):o="assets";l="https://".concat(o,"/").concat(t,"/").concat(e,"/").concat(s);r?l=r[n]:a&&(l+="?auth_key="+a);_context51.next=17;return this.fetcher.fetch(o);case 17:_context51.t1=_context51.sent;_context51.t2=l;return _context51.abrupt("return",{fetcher:_context51.t1,url:_context51.t2});case 20:case"end":return _context51.stop();}}},_callee50,this)}));function getAssetsFetcherAndURL(_x78,_x79){return _getAssetsFetcherAndURL.apply(this,arguments)}return getAssetsFetcherAndURL}()}]);return Ok}(),_a=/*#__PURE__*/function(){function _a(e,t){_classCallCheck(this,_a);this.buffer=e,this.framesCount=t,this.framesCount>0?this.offset=this.offsetAt(0):this.offset=Number.NaN}_createClass(_a,[{key:"length",get:function get(){if(this._length===void 0){this._length=0;for(var e=0;e<this.framesCount;++e){this._length+=this.lengthAt(e)}}return this._length}},{key:"timestampAt",value:function timestampAt(e){var t=3*ln,i=e*t+0*ln;return this.buffer.getUint64(i)}},{key:"offsetAt",value:function offsetAt(e){var t=3*ln,i=e*t+1*ln;return this.buffer.getUint64(i)}},{key:"lengthAt",value:function lengthAt(e){var t=3*ln,i=e*t+2*ln;return this.buffer.getUint64(i)}}],[{key:"pick",value:function(){var _pick=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee51(e,t,i,r){var n,s,o,a,l;return regeneratorRuntime.wrap(function _callee51$(_context52){while(1){switch(_context52.prev=_context52.next){case 0:n=3*ln;s=i*n;o=(i+r)*n-1;_context52.next=5;return e.fetchBuffer(t,{method:"get",headers:{"content-type":"application/json",Accept:"application/octet-stream",Range:"bytes=".concat(s,"-").concat(o)}});case 5:a=_context52.sent;a||(a=Ct(0));l=Math.floor(a.byteLength/n);return _context52.abrupt("return",new _a(a,l));case 9:case"end":return _context52.stop();}}},_callee51)}));function pick(_x80,_x81,_x82,_x83){return _pick.apply(this,arguments)}return pick}()}]);return _a}(),Rk=/*#__PURE__*/function(){function Rk(e){_classCallCheck(this,Rk);this.slices=Object.freeze(_toConsumableArray(e.slices).sort(function(t,i){return t.beginTimestamp-i.beginTimestamp})),this.beginAt=e.beginAt,this.endAt=e.endAt,this.roomUUID=this.getRoomUUID(),this.framesCount=this.getFramesCount()}_createClass(Rk,[{key:"getRoomUUID",value:function getRoomUUID(){var e=this.slices[0].roomUUID;for(var t=1;t<this.slices.length;++t){if(e!==this.slices[t].roomUUID)throw new Error("all slices should have the same roomUUID")}return e}},{key:"getFramesCount",value:function getFramesCount(){var e=0;var _iterator104=_createForOfIteratorHelper(this.slices),_step104;try{for(_iterator104.s();!(_step104=_iterator104.n()).done;){var t=_step104.value;e+=t.framesCount}}catch(err){_iterator104.e(err)}finally{_iterator104.f()}return e}},{key:"beginTimestamp",get:function get(){return this.beginAt}},{key:"duration",get:function get(){return this.endAt-this.beginAt}},{key:"slicesCount",get:function get(){return this.slices.length}},{key:"sliceAt",value:function sliceAt(e){return this.slices[e]}},{key:"getFrameDescriptionWithFrameId",value:function getFrameDescriptionWithFrameId(e){var t=e,i=0;for(var _r27=0;_r27<this.slices.length;++_r27){var n=this.slices[_r27];if(i=_r27,t<n.framesCount)break;t-=n.framesCount}return{frameId:t,sliceIndex:i}}},{key:"getFrameDescriptionWithTimestamp",value:function getFrameDescriptionWithTimestamp(e){var t=e+this.beginAt,i=0;for(var n=0;n<this.slices.length;++n){var s=this.slices[n];if(i=n,t<s.beginTimestamp+s.duration)break}var r=Math.max(0,t-this.slices[i].beginTimestamp);return{sliceIndex:i,timestamp:r}}}]);return Rk}(),Nk=/*#__PURE__*/function(){function Nk(e){var _this109=this;_classCallCheck(this,Nk);this._libraryNodeFetcher=e,this.libraryNodeFetcher=function(t){return _this109._libraryNode&&_this109._libIdentifier===t.libIdentifier?Promise.resolve(_this109._libraryNode):_this109._libraryNodeFetcher(t)}}_createClass(Nk,[{key:"sliceIndex",get:function get(){return this._sliceIndex}},{key:"slice",get:function get(){return this._slice}},{key:"libIdentifier",get:function get(){return this._libIdentifier}},{key:"libraryNode",get:function get(){return this._libraryNode}},{key:"refreshReconstructorLine",value:function refreshReconstructorLine(e){(e.libIdentifier!==this._libIdentifier||e.libraryNode!==this._libraryNode)&&(this._libIdentifier=e.libIdentifier,this._libraryNode=e.libraryNode,this.onLibraryNodeChanged&&this.onLibraryNodeChanged(this._libIdentifier,this._libraryNode)),e.sliceIndex!==this._sliceIndex&&(this._sliceIndex=e.sliceIndex,this._slice=e.slice,this.onSliceChanged&&this.onSliceChanged(this._slice,this._sliceIndex))}}]);return Nk}(),_g=/*#__PURE__*/function(){function _g(e,t,i,r){_classCallCheck(this,_g);this.fetcherFactory=e,this.imageFactory=t,this.clientVersion=i,this.enableAnimationFrame=r}_createClass(_g,[{key:"createReconstructor",value:function(){var _createReconstructor=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee52(e,t){var i,r,n,s;return regeneratorRuntime.wrap(function _callee52$(_context53){while(1){switch(_context53.prev=_context53.next){case 0:i=t.rangeQuery;r=new Nk(t.libraryNodeFetcher);n=new Ok({logger:t.logger,roomToken:t.roomToken,fetcher:this.fetcherFactory.create(i.region),libraryNodeFetcher:r.libraryNodeFetcher});_context53.next=5;return this.fetchSliceChunk(i);case 5:s=_context53.sent;if(s){_context53.next=8;break}throw new Error("couldn't find any matching slices");case 8:return _context53.abrupt("return",new Ak({logger:t.logger,sliceChunk:s,imageFactory:this.imageFactory,sequenceFetcher:n,sliceStateUpdater:r,toolsExtra:e,enableAnimationFrame:this.enableAnimationFrame,callbacks:t.callbacks||{}}));case 9:case"end":return _context53.stop();}}},_callee52,this)}));function createReconstructor(_x84,_x85){return _createReconstructor.apply(this,arguments)}return createReconstructor}()},{key:"searchSlices",value:function(){var _searchSlices=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee53(e){var t,i,_r28;return regeneratorRuntime.wrap(function _callee53$(_context54){while(1){switch(_context54.prev=_context54.next){case 0:_context54.next=2;return this.fetchSliceChunk(e);case 2:t=_context54.sent;i=[];if(t)for(_r28=0;_r28<t.slicesCount;++_r28){i.push(t.sliceAt(_r28))}return _context54.abrupt("return",i);case 6:case"end":return _context54.stop();}}},_callee53,this)}));function searchSlices(_x86){return _searchSlices.apply(this,arguments)}return searchSlices}()},{key:"fetchSliceChunk",value:function(){var _fetchSliceChunk=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee54(e){var _this110=this;var t,i,_r29,n,s,_r30,_n23,_s12,o,_r31,_n24,_iterator105,_step105,_s13;return regeneratorRuntime.wrap(function _callee54$(_context55){while(1){switch(_context55.prev=_context55.next){case 0:_context55.next=2;return this.fetcherFactory.create(e.region).fetch("persistence");case 2:t=_context55.sent;if(!(e.slice!==void 0)){_context55.next=14;break}_r29={clientVersion:this.clientVersion};n="https://persistence/pv/rooms/".concat(e.room,"/slices/").concat(e.slice,"?").concat((0,nd.stringify)(_r29));_context55.next=8;return t.fetchJSON(n,{headers:{"content-type":"application/json",token:e.roomToken}});case 8:s=_context55.sent;if(!(e.room!==void 0&&e.room!==s.roomUUID)){_context55.next=11;break}throw new Error("slice ".concat(s.uuid," is not belongs to room ").concat(e.room));case 11:i=[s];_context55.next=22;break;case 14:if(!(e.room!==void 0)){_context55.next=21;break}_r30=e.beginTimestamp,_n23=e.beginTimestamp!==void 0&&e.duration!==void 0?e.beginTimestamp+e.duration:void 0,_s12={beginAt:_r30,endAt:_n23,clientVersion:this.clientVersion},o="https://persistence/pv/rooms/".concat(e.room,"/slices?").concat((0,nd.stringify)(_s12));_context55.next=18;return t.fetchJSON(o,{headers:{"content-type":"application/json",token:e.roomToken}});case 18:i=_context55.sent;_context55.next=22;break;case 21:throw new Error("expect either room or slice");case 22:if(!(i=i.map(function(r){return _this110.fillSliceLibIdentifier(r)}),i.length>0)){_context55.next=31;break}_r31=e.beginTimestamp;_r31===void 0&&(_r31=Math.min.apply(Math,_toConsumableArray(i.map(function(s){return s.beginTimestamp}))));e.duration?_n24=_r31+e.duration:_n24=Math.max.apply(Math,_toConsumableArray(i.map(function(s){return s.beginTimestamp+s.duration})));_iterator105=_createForOfIteratorHelper(i);try{for(_iterator105.s();!(_step105=_iterator105.n()).done;){_s13=_step105.value;Object.freeze(_s13)}}catch(err){_iterator105.e(err)}finally{_iterator105.f()}return _context55.abrupt("return",(i=i.filter(function(s){var o=s.beginTimestamp;return s.beginTimestamp+s.duration>=_r31&&o<=_n24}),new Rk({beginAt:_r31,endAt:_n24,slices:i})));case 31:return _context55.abrupt("return",null);case 32:case"end":return _context55.stop();}}},_callee54,this)}));function fetchSliceChunk(_x87){return _fetchSliceChunk.apply(this,arguments)}return fetchSliceChunk}()},{key:"fillSliceLibIdentifier",value:function fillSliceLibIdentifier(e){var t,_e$libIdentifier$repl=e.libIdentifier.replace(/\.\w+$/im,"").split("-"),_e$libIdentifier$repl2=_slicedToArray(_e$libIdentifier$repl,2),i=_e$libIdentifier$repl2[0],r=_e$libIdentifier$repl2[1];if(i&&r)try{if(kt.compare(kt.parse(r),kt.parse("2.7.0"))<0)switch(i){case"2.0.0":{t="2.0.0-2.7.9.0f385eb562396be49fb451e80c1d85fa";break}case"2.1.0":{t="2.1.0-2.8.0.fb7b9e324522d815ee4e40990d061a0b";break}}}catch(n){console.warn(n)}return t?to(Gt({},e),{libIdentifier:t}):e}}]);return _g}(),fe;(function(e){e.WaitingFirstFrame="waitingFirstFrame",e.Playing="playing",e.Pause="pause",e.Stopped="stopped",e.Ended="ended",e.Buffering="buffering",e.Seeking="seeking"})(fe||(fe={}));var $t;(function(e){e[e.Success=0]="Success",e[e.SuccessButUnnecessary=1]="SuccessButUnnecessary",e[e.Override=2]="Override",e[e.Stopped=3]="Stopped"})($t||($t={}));var od=/*#__PURE__*/function(){function od(e){_classCallCheck(this,od);var t=e.onAkkoSetupFailed,i=gg({escapeObjectFilter:e.escapeObjectFilter,jsxFactory:e.jsxFactory,observerAdapter:e.observerAdapter});if(this.imageFactory=new Ta(i),this.convertIdToUrl=e.convertIdToUrl,e.shuntApiHosts){var _r32=new ZC({appIdentifier:e.appIdentifier,shuntApiHosts:e.shuntApiHosts,onInterruptConfigs:e.configsInterrupter,onAkkoSetupFailed:function onAkkoSetupFailed(a){console.error("akko setup failed: ".concat(a.stack||a.message)),t&&t(a)}}),n=!!e.enableAnimationFrame,s={enableAnimationFrame:n},o=uk(e.reconnectionOptions);this.magixFactory=new Mk(_r32,this.imageFactory,o,e.netStateAdapter,e.clientVersion,s),this.playerFactory=new _g(_r32,this.imageFactory,e.clientVersion,n)}}_createClass(od,[{key:"createMagix",value:function createMagix(e){if(!this.magixFactory)throw new Error("expect shuntApiHosts");var t=new vg().create({convertIdToUrl:this.convertIdToUrl}),i=Object.freeze({resource:t});return this.magixFactory.createMagix(i,e)}},{key:"createReconstructor",value:function createReconstructor(e){if(!this.playerFactory)throw new Error("expect shuntApiHosts");var t=new vg().create({convertIdToUrl:this.convertIdToUrl}),i=Object.freeze({resource:t});return this.playerFactory.createReconstructor(i,e)}},{key:"searchSlices",value:function(){var _searchSlices2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee55(e){return regeneratorRuntime.wrap(function _callee55$(_context56){while(1){switch(_context56.prev=_context56.next){case 0:if(this.playerFactory){_context56.next=2;break}throw new Error("expect shuntApiHosts");case 2:_context56.next=4;return this.playerFactory.searchSlices(e);case 4:return _context56.abrupt("return",_context56.sent);case 5:case"end":return _context56.stop();}}},_callee55,this)}));function searchSlices(_x88){return _searchSlices2.apply(this,arguments)}return searchSlices}()}]);return od}();var Nd={};Bn(Nd,{AnimationMode:function AnimationMode(){return $},Boundless:function Boundless(){return bo},BoundlessEventKind:function BoundlessEventKind(){return S},CNode:function CNode(){return Oi},CameraTransformation:function CameraTransformation(){return fi},CanvasPaitingMode:function CanvasPaitingMode(){return mn},CanvasRenderMode:function CanvasRenderMode(){return mo},CanvasRenderState:function CanvasRenderState(){return Rd},ComponentKind:function ComponentKind(){return Ri},DeviceType:function DeviceType(){return Ue},LayoutKind:function LayoutKind(){return fn},LayoutRenderMode:function LayoutRenderMode(){return So},RectangleAdapterMode:function RectangleAdapterMode(){return mi},RectangleTesting:function RectangleTesting(){return Nr},RenderLayoutMode:function RenderLayoutMode(){return Er},creatHTMLRenderEngine:function creatHTMLRenderEngine(){return wy},createCanvasRenderEngine:function createCanvasRenderEngine(){return Sy},createComponentDefinition:function createComponentDefinition(){return vo},distance:function distance(){return ib},isCanvasRenderEngine:function isCanvasRenderEngine(){return Ix},isHTMLRenderEngine:function isHTMLRenderEngine(){return Rx},midpoint:function midpoint(){return ds},unitVector:function unitVector(){return tb}});var Xg=P(require("spark-md5")),Lk=Object.defineProperty,Dk=Object.defineProperties,Bk=Object.getOwnPropertyDescriptors,Kg=Object.getOwnPropertySymbols,Fk=Object.prototype.hasOwnProperty,jk=Object.prototype.propertyIsEnumerable,Gg=function Gg(e,t,i){return t in e?Lk(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},io=function io(e,t){for(var i in t||(t={})){Fk.call(t,i)&&Gg(e,i,t[i])}if(Kg){var _iterator106=_createForOfIteratorHelper(Kg(t)),_step106;try{for(_iterator106.s();!(_step106=_iterator106.n()).done;){var i=_step106.value;jk.call(t,i)&&Gg(e,i,t[i])}}catch(err){_iterator106.e(err)}finally{_iterator106.f()}}return e},zk=function zk(e,t){return Dk(e,Bk(t))},gR=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")},ro=Object.freeze({debug:0,info:1,warn:2,error:3}),ls=/*#__PURE__*/function(){function ls(){var _ref39=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},e=_ref39.prefix,t=_ref39.levelMask;_classCallCheck(this,ls);this.prefix=e,this.levelMaskIndex=ro[t||"info"]}_createClass(ls,[{key:"log",value:function log(e,t,i){ro[t]>=this.levelMaskIndex&&(this.prefix?console[t](this.prefix,i):console[t](i))}},{key:"commit",value:function commit(){}},{key:"isSupportedEvents",value:function isSupportedEvents(e){return!0}}]);return ls}();function $g(e){var t={};for(var i in e){var _r33=e[i];_r33!==void 0&&(t[i]=_r33)}return t}function ld(e){if(_typeof(e)!="object"||e===null)return e;if(e instanceof Array){var t=[];var _iterator107=_createForOfIteratorHelper(e),_step107;try{for(_iterator107.s();!(_step107=_iterator107.n()).done;){var i=_step107.value;t.push(ld(i))}}catch(err){_iterator107.e(err)}finally{_iterator107.f()}return Object.freeze(t)}else{var _t8={};for(var _i28 in e){_t8[_i28]=ld(e[_i28])}return Object.freeze(_t8)}}function no(e,t,i){if(!e.isSupportedEvents(t))throw new Error("unsupported event name: ".concat(t));var r=i?{context:$g(i)}:{};return Yg(e,t,r)}function Yg(e,t,i){var r={debug:Ka(e,"debug",t,i),info:Ka(e,"info",t,i),warn:Ka(e,"warn",t,i),error:Ka(e,"error",t,i),withContext:function withContext(n){return Yg(e,t,{context:io(io({},i.context),n)})}};return Object.defineProperty(r,"context",{enumerable:!1,set:function set(n){return i.context=n},get:function get(){return i.context}}),Object.freeze(r)}function Ka(e,t,i,r){return function(){for(var _len17=arguments.length,n=new Array(_len17),_key17=0;_key17<_len17;_key17++){n[_key17]=arguments[_key17]}for(var a=0;a<n.length;++a){n[a]=Vk(n[a])}var s=Uk(r),o=n.join(" ");e.log(i,t,o,s)}}function Uk(e){var t;if(e.context){t||(t={});for(var i in e.context){t[i]=e.context[i]}}return Object.freeze(t)}function Vk(e){if(e instanceof Error){var t="Error: "+e.message+"\n";return typeof e.stack=="string"?t+e.stack.replace(t,""):t}else try{return"".concat(e)}catch(t){return"[".concat(_typeof(e)," ").concat(JSON.stringify(t.message),"]")}}function Ga(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!e.isSupportedEvents(t))throw new Error("unsupported event name: ".concat(t));var r=Object.freeze($g(i));return Object.freeze({commit:function commit(n){e.commit(t,io(io({},r),n))}})}var Wk=function Wk(e){if((typeof process==="undefined"?"undefined":_typeof(process))=="object"&&process+""=="[object process]")return Buffer.from(e).toString("base64");{var t=32768,i="",_r34,n=0,s=e.length;for(;n<s;){_r34=e.subarray(n,Math.min(n+t,s)),i+=String.fromCharCode.apply(null,_r34),n+=t}return btoa(i)}},Qg=/*#__PURE__*/function(){function Qg(e,t){_classCallCheck(this,Qg);this.argusEvents=ld(e),this.vid=t}_createClass(Qg,[{key:"encode",value:function encode(e,t){var i=zk(io({},t),{vid:this.vid,lts:Date.now(),clientIP:"__#CLIENT_IP#__"}),_this$argusEvents$e=this.argusEvents[e],r=_this$argusEvents$e.eventID,n=_this$argusEvents$e.proto,s=n.verify(i);if(s)throw new Error(s);var o=n.create(i),a=n.encode(o).finish(),l=Wk(a),h="whiteBoard",d=Math.floor(Date.now()/1e3),u=Xg["default"].hash("payload=".concat(l,"&src=").concat(h,"&ts=").concat(d));return{id:r,src:h,payload:l,qos:this.vid===1?101:1,ts:d,sign:u}}}]);return Qg}(),qg=/*#__PURE__*/function(){function qg(){_classCallCheck(this,qg);this.queue=[]}_createClass(qg,[{key:"append",value:function append(e){this.queue.push(e)}},{key:"next",get:function get(){return this.queue[0]}},{key:"done",value:function done(){this.queue.shift()}},{key:"length",get:function get(){return this.queue.length}}]);return qg}(),cd=3,Hk=1e3,_k=/*#__PURE__*/function(){var _ref40=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee56(e,t){var _loop20,i,_ret2;return regeneratorRuntime.wrap(function _callee56$(_context58){while(1){switch(_context58.prev=_context58.next){case 0:_loop20=/*#__PURE__*/regeneratorRuntime.mark(function _loop20(i){return regeneratorRuntime.wrap(function _loop20$(_context57){while(1){switch(_context57.prev=_context57.next){case 0:_context57.prev=0;_context57.next=3;return e(t);case 3:return _context57.abrupt("return","break");case 6:_context57.prev=6;_context57.t0=_context57["catch"](0);if(!(i===cd)){_context57.next=10;break}throw new Error("report log failed (with ".concat(cd," times failed), error: ").concat(_context57.t0));case 10:_context57.next=12;return new Promise(function(n){setTimeout(n,i*Hk)});case 12:case"end":return _context57.stop();}}},_loop20,null,[[0,6]])});i=1;case 2:if(!(i<=cd)){_context58.next=10;break}return _context58.delegateYield(_loop20(i),"t0",4);case 4:_ret2=_context58.t0;if(!(_ret2==="break")){_context58.next=7;break}return _context58.abrupt("break",10);case 7:i++;_context58.next=2;break;case 10:case"end":return _context58.stop();}}},_callee56)}));return function _k(_x89,_x90){return _ref40.apply(this,arguments)}}(),Zg=/*#__PURE__*/function(){function Zg(e,t,i,r){_classCallCheck(this,Zg);this.logQueue=e,this.resourceURL=t,this.request=i,this.warnLog=r}_createClass(Zg,[{key:"report",value:function(){var _report=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee57(e){var _this111=this;var t;return regeneratorRuntime.wrap(function _callee57$(_context59){while(1){switch(_context59.prev=_context59.next){case 0:if(!(this.logQueue.append(e),this.logQueue.length===1)){_context59.next=19;break}case 1:t=this.logQueue.next;if(!t){_context59.next=16;break}_context59.prev=3;_context59.next=6;return _k(function(i){return _this111.request(i,_this111.resourceURL)},t);case 6:_context59.next=11;break;case 8:_context59.prev=8;_context59.t0=_context59["catch"](3);this.warnLog(_context59.t0);case 11:_context59.prev=11;this.logQueue.done();return _context59.finish(11);case 14:_context59.next=17;break;case 16:return _context59.abrupt("break",19);case 17:_context59.next=1;break;case 19:case"end":return _context59.stop();}}},_callee57,this,[[3,8,11,14]])}));function report(_x91){return _report.apply(this,arguments)}return report}()}]);return Zg}(),Jg=/*#__PURE__*/function(){function Jg(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Jg);this.events={},this.initListeners("debug",e.debug),this.initListeners("info",e.info),this.initListeners("warn",e.warn),this.initListeners("error",e.error)}_createClass(Jg,[{key:"on",value:function on(e,t){var _this$events$e;(_this$events$e=this.events[e]).push.apply(_this$events$e,_toConsumableArray(Array.isArray(t)?t:[t]))}},{key:"initListeners",value:function initListeners(e,t){return this.events[e]=[],t&&this.on(e,t)}},{key:"emit",value:function emit(e,t){this.events[e].forEach(function(i){try{var _r35=i(t);_r35 instanceof Promise&&_r35["catch"](console.error)}catch(r){console.error(r)}})}}]);return Jg}();var Ar=P(require("react")),oo=P(require("react")),$a=P(require("react")),yy=P(require("bowser")),tl=P(require("react")),dn=P(require("react")),un=P(require("react")),ir=P(require("react")),Cy=P(require("@juggle/resize-observer")),Pd=P(require("react")),Uy=P(require("react")),Wy=P(require("react")),sl=P(require("react-dom")),pn=P(require("react")),ol=P(require("react")),qy=P(require("uuid")),Kk=Object.defineProperty,Gk=Object.defineProperties,$k=Object.getOwnPropertyDescriptors,ey=Object.getOwnPropertySymbols,Yk=Object.prototype.hasOwnProperty,Xk=Object.prototype.propertyIsEnumerable,ty=function ty(e,t,i){return t in e?Kk(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},V=function V(e,t){for(var i in t||(t={})){Yk.call(t,i)&&ty(e,i,t[i])}if(ey){var _iterator108=_createForOfIteratorHelper(ey(t)),_step108;try{for(_iterator108.s();!(_step108=_iterator108.n()).done;){var i=_step108.value;Xk.call(t,i)&&ty(e,i,t[i])}}catch(err){_iterator108.e(err)}finally{_iterator108.f()}}return e},je=function je(e,t){return Gk(e,$k(t))},bR=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")},S;(function(e){e.MouseDown="MouseDown",e.MouseMove="MouseMove",e.MouseUp="MouseUp",e.MouseLeave="MouseLeave",e.MouseWheel="MouseWheel",e.TouchStart="TouchStart",e.TouchMove="TouchMove",e.TouchEnd="TouchEnd",e.TouchCancel="TouchCancel",e.SortedTouchStart="SortedTouchStart",e.SortedTouchMove="SortedTouchMove",e.SortedTouchEnd="SortedTouchEnd",e.SortedTouchCancel="SortedTouchCancel",e.KeyDown="KeyDown",e.KeyUp="KeyUp",e.MetaKeyUp="MetaKeyUp"})(S||(S={}));var Er;(function(e){e[e.Normal=0]="Normal",e[e.Preview=1]="Preview"})(Er||(Er={}));var hd=/*#__PURE__*/function(){function hd(e){_classCallCheck(this,hd);this.definitions={},this.id="".concat(hd.nextId),this.orderIndex=e,hd.nextId+=1}_createClass(hd,[{key:"painToCanvas",value:function painToCanvas(e,t,i,r){}},{key:"addDefinition",value:function addDefinition(e){this.definitions[e.id]=e}}]);return hd}(),so=hd;so.nextId=0;var iy=/*#__PURE__*/function(){function iy(e,t,i){_classCallCheck(this,iy);this._ratio=1,this._visibility=!0,this._size=Object.freeze(V({},e)),this.dirtyNotify=t,this.onSetupCanvas=i}_createClass(iy,[{key:"size",get:function get(){return this._size},set:function set(e){(this._size.width!==e.width||this._size.height!==e.height)&&(this._size=Object.freeze(V({},e)),this.hasNextCanvasNode&&this._visibility&&this.refreshSize())}},{key:"visibility",get:function get(){return this._visibility},set:function set(e){this._visibility!==e&&(this._visibility=e,this.hasNextCanvasNode&&this._visibility&&this.refreshSize(),this.refreshVisibility())}},{key:"ratio",get:function get(){return this._ratio}},{key:"setRatio",value:function setRatio(e){this._ratio=e}},{key:"getRatioWithContext",value:function getRatioWithContext(e){var t=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return Math.max(1,(window.devicePixelRatio||1)/t)}}],[{key:"setCanvasSize",value:function setCanvasSize(e,t,i){(e.width!==t||e.height!==i)&&(e.width=t,e.height=i)}}]);return iy}(),ry;(function(e){e[e.Firefox=0]="Firefox",e[e.Opera=1]="Opera",e[e.Safari=2]="Safari",e[e.IE=3]="IE",e[e.Other=4]="Other",e[e.Unkown=5]="Unkown"})(ry||(ry={}));var Qk=/*#__PURE__*/function(){function Qk(){_classCallCheck(this,Qk);this.kind=5}_createClass(Qk,[{key:"getContext",value:function getContext(e){var t=e.getContext("2d");switch(t.imageSmoothingEnabled=!1,this.kind){case 0:{t.mozImageSmoothingEnabled=!1;break}case 1:{t.oImageSmoothingEnabled=!1;break}case 2:{t.webkitImageSmoothingEnabled=!1;break}case 3:{t.msImageSmoothingEnabled=!1;break}case 5:{t.mozImageSmoothingEnabled!==void 0?(t.mozImageSmoothingEnabled=!1,this.kind=0):t.oImageSmoothingEnabled!==void 0?(t.oImageSmoothingEnabled=!1,this.kind=1):t.webkitImageSmoothingEnabled!==void 0?(t.webkitImageSmoothingEnabled=!1,this.kind=2):t.msImageSmoothingEnabled!==void 0&&(t.msImageSmoothingEnabled=!1,this.kind=3);break}}return t}}]);return Qk}(),qk=new Qk;function cs(e){return qk.getContext(e)}var dd=/*#__PURE__*/function(_iy){_inherits(dd,_iy);var _super29=_createSuper(dd);function dd(){var _this112;_classCallCheck(this,dd);_this112=_super29.apply(this,arguments);_this112.canvas=null,_this112.canvasIndex=1,_this112.canvasSizeSetter=null;return _this112}_createClass(dd,[{key:"hasNextCanvasNode",get:function get(){return!!this.canvas}},{key:"nextCanvasNode",value:function nextCanvasNode(){var e=null;if(this.canvas){var _this$canvas=this.canvas,t=_this$canvas.node1,i=_this$canvas.node2;e=[t,i][this.canvasIndex-1]}return e}},{key:"updateToNextBuffering",value:function updateToNextBuffering(){if(this.canvas)switch(this.refreshVisibility(),this.canvasIndex){case 1:{this.canvasIndex=2;break}case 2:{this.canvasIndex=1;break}}}},{key:"get2DContext",value:function get2DContext(e){return cs(e.canvas)}},{key:"refreshSize",value:function refreshSize(){var e;if(this.canvas){var t=this.canvas.node1.canvas,i=this.canvas.node2.canvas;if(!(t.getContext("2d")&&i.getContext("2d")))throw new Error("cannot find 2d context from canvas");var _r36=Math.ceil(this.ratio*this.size.width),n=Math.ceil(this.ratio*this.size.height);dd.setCanvasSize(t,_r36,n),dd.setCanvasSize(i,_r36,n),(e=this.canvasSizeSetter)==null||e.call(this,{width:_r36/this.ratio,height:n/this.ratio})}}},{key:"refreshVisibility",value:function refreshVisibility(){if(this.canvas){var e=this.canvas.node1.canvas,t=this.canvas.node2.canvas;if(this.visibility)switch(this.canvasIndex){case 1:{e.style.visibility="visible",t.style.visibility="hidden";break}case 2:{e.style.visibility="hidden",t.style.visibility="visible";break}}else e.style.visibility="hidden",t.style.visibility="hidden"}}},{key:"setCanvas",value:function setCanvas(e){var t,i,r,n,s,o,a;var l=!1;if(e){var _e6=_slicedToArray(e,2),h=_e6[0],d=_e6[1];if(this.canvas){var _this$canvas2=this.canvas,u=_this$canvas2.node1,p=_this$canvas2.node2;(u.canvas!==h||p.canvas!==d)&&((t=u.dirty)==null||t.release(),(i=p.dirty)==null||i.release(),this.canvas=null)}this.canvas||(l=!0,this.canvas=Object.freeze({node1:Object.freeze({canvas:h,dirty:(r=this.dirtyNotify)==null?void 0:r.createDirty()}),node2:Object.freeze({canvas:d,dirty:(n=this.dirtyNotify)==null?void 0:n.createDirty()})}))}else this.canvas&&((s=this.canvas.node1.dirty)==null||s.release(),(o=this.canvas.node2.dirty)==null||o.release(),this.canvas=null);l&&(this.setRatio(this.getRatioWithCanvasPair(this.canvas)),this.refreshSize(),this.refreshVisibility(),(a=this.onSetupCanvas)==null||a.call(this))}},{key:"getRatioWithCanvasPair",value:function getRatioWithCanvasPair(e){var t=e.node1.canvas,i=e.node2.canvas;return Math.max(this.getRatioWithContext(cs(t)),this.getRatioWithContext(cs(i)))}},{key:"getRender",value:function getRender(){var e=this;var t=/*#__PURE__*/function(_oo$Component){_inherits(t,_oo$Component);var _super30=_createSuper(t);function t(r){var _this113;_classCallCheck(this,t);_this113=_super30.call(this,r);_this113.canvas1=null,_this113.canvas2=null,_this113.onSetCanvas1Ref=function(n){_this113.canvas1=n,_this113.refreshCanvas()},_this113.onSetCanvas2Ref=function(n){_this113.canvas2=n,_this113.refreshCanvas()},_this113.state=V({},e.size),e.canvasSizeSetter=function(n){return _this113.setState(n)};return _this113}_createClass(t,[{key:"componentWillUnmount",value:function componentWillUnmount(){e.canvasSizeSetter=null}},{key:"refreshCanvas",value:function refreshCanvas(){this.canvas1&&this.canvas2?e.setCanvas([this.canvas1,this.canvas2]):e.setCanvas(null)}},{key:"render",value:function render(){var _this$props=this.props,r=_this$props.className,n=_this$props.style,_this$state=this.state,s=_this$state.width,o=_this$state.height,a=je(V({},n),{width:s,height:o});return[(0,oo.createElement)("canvas",{key:"canvas1",className:r,ref:this.onSetCanvas1Ref,style:a}),(0,oo.createElement)("canvas",{key:"canvas2",className:r,ref:this.onSetCanvas2Ref,style:a})]}}]);return t}(oo.Component);return t}}]);return dd}(iy),ny=/*#__PURE__*/function(_iy2){_inherits(ny,_iy2);var _super31=_createSuper(ny);function ny(){var _this114;_classCallCheck(this,ny);_this114=_super31.apply(this,arguments);_this114.shouldWrapContext=!1,_this114.isCanvasReadyOnSarari=!1,_this114.canvasNode=null,_this114.canvasSizeSetter=null,_this114.setCanvas=function(e){var t,i,r,n;var s=!1;e?(_this114.canvasNode&&_this114.canvasNode.canvas!==e&&((t=_this114.canvasNode.dirty)==null||t.release(),_this114.canvasNode=null),_this114.canvasNode||(s=!0,_this114.canvasNode={canvas:e,dirty:(i=_this114.dirtyNotify)==null?void 0:i.createDirty()})):_this114.canvasNode&&((r=_this114.canvasNode.dirty)==null||r.release(),_this114.canvasNode=null),s&&(_this114.setRatio(_this114.getRatioWithContext(cs(_this114.canvasNode.canvas))),_this114.refreshSize(),_this114.refreshVisibility(),(n=_this114.onSetupCanvas)==null||n.call(_assertThisInitialized(_this114)))};return _this114}_createClass(ny,[{key:"hasNextCanvasNode",get:function get(){return!!this.canvasNode}},{key:"nextCanvasNode",value:function nextCanvasNode(){return this.canvasNode}},{key:"updateToNextBuffering",value:function updateToNextBuffering(){}},{key:"get2DContext",value:function get2DContext(e){return cs(e.canvas)}},{key:"refreshSize",value:function refreshSize(){var e;if(this.canvasNode){var t=this.canvasNode.canvas;if(!t.getContext("2d"))throw new Error("cannot find 2d context from canvas");var i=Math.ceil(this.ratio*this.size.width),_r37=Math.ceil(this.ratio*this.size.height);ny.setCanvasSize(t,i,_r37),(e=this.canvasSizeSetter)==null||e.call(this,{width:i/this.ratio,height:_r37/this.ratio})}this.refreshIsCanvasReadyOnSarari()}},{key:"refreshVisibility",value:function refreshVisibility(){if(this.canvasNode){var e=this.canvasNode.canvas;this.visibility?e.style.visibility="visible":e.style.visibility="hidden"}this.refreshIsCanvasReadyOnSarari()}},{key:"refreshIsCanvasReadyOnSarari",value:function refreshIsCanvasReadyOnSarari(){var e=this.size,t=this.visibility,i=this.hasNextCanvasNode&&t&&e.width>0&&e.height>0;this.isCanvasReadyOnSarari!==i&&(this.isCanvasReadyOnSarari=i,i&&(this.shouldWrapContext=!0))}},{key:"getRender",value:function getRender(){var e=this;var t=/*#__PURE__*/function(_$a$Component){_inherits(t,_$a$Component);var _super32=_createSuper(t);function t(r){var _this115;_classCallCheck(this,t);_this115=_super32.call(this,r);_this115.state=V({},e.size),e.canvasSizeSetter=function(n){return _this115.setState(n)};return _this115}_createClass(t,[{key:"componentWillUnmount",value:function componentWillUnmount(){e.canvasSizeSetter=null}},{key:"render",value:function render(){var _this$props2=this.props,r=_this$props2.className,n=_this$props2.style,_this$state2=this.state,s=_this$state2.width,o=_this$state2.height,a=je(V({},n),{width:s,height:o});return(0,$a.createElement)("canvas",{key:"canvas1",className:r,ref:e.setCanvas,style:a})}}]);return t}($a.Component);return t}}]);return ny}(iy);function sy(e,t,i){return new dd(e,t,i)}function Zk(e,t,i){return new ny(e,t,i)}var Jk=/*#__PURE__*/function(){function Jk(){_classCallCheck(this,Jk);this.paintFloatCount=0,this.generateCacheCount=0,this.paintCacheCount=0,this.fuseCacheCount=0,this.fuseCount=0,this.splitCount=0}_createClass(Jk,[{key:"recordPaintFloat",value:function recordPaintFloat(){this.paintFloatCount+=1}},{key:"recordGenerateCache",value:function recordGenerateCache(){this.generateCacheCount+=1}},{key:"recordPaintCache",value:function recordPaintCache(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;this.paintCacheCount+=e}},{key:"recordFuseCache",value:function recordFuseCache(){this.fuseCacheCount+=1}},{key:"recordFuse",value:function recordFuse(e){this.fuseCount+=e}},{key:"recordSplit",value:function recordSplit(){this.splitCount+=1}},{key:"clear",value:function clear(){this.paintFloatCount=0,this.generateCacheCount=0,this.paintCacheCount=0,this.fuseCacheCount=0,this.fuseCount=0,this.splitCount=0}},{key:"print",value:function print(){console.log("\n========="),console.log("paintFloatCount",this.paintFloatCount),console.log("generateCacheCount",this.generateCacheCount),console.log("paintCacheCount",this.paintCacheCount),console.log("fuseCacheCount",this.fuseCacheCount),console.log("fuseCount",this.fuseCount),console.log("splitCount",this.splitCount),this.clear()}}]);return Jk}(),oy=Object.freeze({forEach:function forEach(){return!1}});function ex(e,t){return new Xa(Ya.Fusion,e,t)}function tx(e,t){return new Xa(Ya.Rejection,e,t)}var Ya;(function(e){e[e.Fusion=0]="Fusion",e[e.Rejection=1]="Rejection"})(Ya||(Ya={}));var Xa=/*#__PURE__*/function(){function Xa(e,t,i){var _this116=this;_classCallCheck(this,Xa);this.cells={},this.forEach=function(r){if(_this116.mode===0)for(var n in _this116.cells){var _this116$cells$n=_this116.cells[n],s=_this116$cells$n.row,o=_this116$cells$n.column;if(r(s,o))return!0}return _this116.range.forEach(function(n,s){var o=Xa.key(n,s);return!!(!_this116.cells[o]&&r(n,s))})},this.mode=e,this.range=t;var _iterator109=_createForOfIteratorHelper(i),_step109;try{for(_iterator109.s();!(_step109=_iterator109.n()).done;){var _r38=_step109.value;var n=Xa.key(_r38.row,_r38.column);this.cells[n]=_r38}}catch(err){_iterator109.e(err)}finally{_iterator109.f()}}_createClass(Xa,null,[{key:"key",value:function key(e,t){return"".concat(e,":").concat(t)}}]);return Xa}(),ze=/*#__PURE__*/function(){function ze(e,t,i,r){var _this117=this;_classCallCheck(this,ze);this.row0=e,this.row1=t,this.column0=i,this.column1=r,this.forEach=function(n){var s=_this117.row0,o=_this117.row1,a=_this117.column0,l=_this117.column1;for(var h=s;h<o;++h){for(var d=a;d<l;++d){if(n(h,d))return!0}}return!1}}_createClass(ze,[{key:"toString",value:function toString(){return"[row0=".concat(this.row0," row1=").concat(this.row1," column0=").concat(this.column0," column1=").concat(this.column1,"]")}},{key:"excludeForEach",value:function excludeForEach(e){var t=this.row0,i=this.row1,r=this.column0,n=this.column1,s=t,o=this.clamp(t,e.row0,i),a=this.clamp(t,e.row1,i),l=i,h=r,d=this.clamp(r,e.column0,n),u=this.clamp(r,e.column1,n),p=n;return{forEach:function forEach(f){for(var m=s;m<o;++m){for(var g=r;g<n;++g){if(f(m,g))return!0}}for(var _m2=a;_m2<l;++_m2){for(var _g2=r;_g2<n;++_g2){if(f(_m2,_g2))return!0}}for(var _m3=o;_m3<a;++_m3){for(var _g3=h;_g3<d;++_g3){if(f(_m3,_g3))return!0}}for(var _m4=o;_m4<a;++_m4){for(var _g4=u;_g4<p;++_g4){if(f(_m4,_g4))return!0}}return!1}}}},{key:"clamp",value:function clamp(e,t,i){var r=t;return r<e?r=e:r>i&&(r=i),r}},{key:"rowsCount",get:function get(){return this.row1-this.row0}},{key:"columnsCount",get:function get(){return this.column1-this.column0}},{key:"includes",value:function includes(e,t){return this.row0<=e&&e<this.row1&&this.column0<=t&&t<this.column1}},{key:"includesRange",value:function includesRange(_ref41){var e=_ref41.row0,t=_ref41.row1,i=_ref41.column0,r=_ref41.column1;return this.row0<=e&&t<=this.row1&&this.column0<=i&&r<=this.column1}},{key:"merge",value:function merge(e,t,i){var r=new ze(Math.floor(this.row0/e),Math.ceil(this.row1/e),Math.floor(this.column0/t),Math.ceil(this.column1/t)),n=r.row0,s=r.row1,o=r.column0,a=r.column1;for(var l=n;l<s;++l){for(var h=o;h<a;++h){var d=!1,u=l*e,p=(l+1)*e,f=h*t,m=(h+1)*t;u<this.row0&&(u=this.row0,d=!0),p>this.row1&&(p=this.row1,d=!0),f<this.column0&&(f=this.column0,d=!0),m>this.column1&&(m=this.column1,d=!0);var g=new ze(u,p,f,m);g.rowsCount>0&&g.columnsCount>0&&i(l,h,g,d)}}return r}},{key:"fork",value:function fork(e,t,i){var r=this.row0,n=this.row1,s=this.column0,o=this.column1;for(var a=r;a<n;++a){for(var l=s;l<o;++l){i(a,l,new ze(a*e,(a+1)*e,l*t,(l+1)*t))}}return new ze(this.row0*e,this.row1*e,this.column0*t,this.column1*t)}}],[{key:"rectToRange",value:function rectToRange(e,t){var i=e.originX,r=e.originY,n=e.width,s=e.height,o=t.width,a=t.height,l=Math.floor(r/a),h=Math.floor(i/o),d=Math.floor((r+s)/a)+1,u=Math.floor((i+n)/o)+1;return new ze(l,d,h,u)}},{key:"cellToRect",value:function cellToRect(e,t,_ref42){var i=_ref42.width,r=_ref42.height;var n=t*i,s=e*r;return{originX:n,originY:s,width:i,height:r}}},{key:"calcIntersection",value:function calcIntersection(e,t){var i=Math.max(e.row0,t.row0),r=Math.min(e.row1,t.row1),n=Math.max(e.column0,t.column0),s=Math.min(e.column1,t.column1);return i<r&&n<s?new ze(i,r,n,s):null}},{key:"calcDiff",value:function calcDiff(e,t){var i=this.calcIntersection(e,t);return{addedRange:e.excludeForEach(t),removedRange:t.excludeForEach(e),keepRange:i?{forEach:i.forEach}:oy}}},{key:"isEquals",value:function isEquals(e,t){return e.row0===t.row0&&e.row1===t.row1&&e.column0===t.column0&&e.column1===t.column1}}]);return ze}(),cn=/*#__PURE__*/function(){function cn(){_classCallCheck(this,cn);this.nodes={}}_createClass(cn,[{key:"get",value:function get(e,t){var i;var r=cn.key(e,t);return(i=this.nodes[r])==null?void 0:i.element}},{key:"set",value:function set(e,t,i){var r=cn.key(e,t);return this.nodes[r]=Object.freeze({element:i,row:e,column:t,key:r}),i}},{key:"delete",value:function _delete(e,t){var i=cn.key(e,t),r=this.nodes[i];if(r)return delete this.nodes[i],r.element}},{key:"fill",value:function fill(e){var t=e.nodes;for(var i in t){this.nodes[i]=t[i]}}},{key:"clear",value:function clear(e){if(e)for(var t in this.nodes){e(this.nodes[t].element)}this.nodes={}}},{key:"forEach",value:function forEach(e){for(var t in this.nodes){var i=this.nodes[t];e(i.element,i.row,i.column)}}}],[{key:"key",value:function key(e,t){return"".concat(e,":").concat(t)}}]);return cn}();function pi(e,t){if(_typeof(e)!=_typeof(t))return!1;if(_typeof(e)!="object"||e===null)return e===t;if(e.constructor!==t.constructor)return!1;if(e.constructor===Object){for(var i in e){if(i in t){if(!pi(e[i],t[i]))return!1}else return!1}for(var _i29 in t){if(!(_i29 in e))return!1}return!0}else if(e.constructor===Array){var _i30=e,_r39=t;if(_i30.length===_r39.length){for(var n=0;n<_i30.length;++n){if(!pi(e[n],t[n]))return!1}}else return!1;return!0}else return!0}function gt(e){for(var t in e){return!0}return!1}var Qa=/*#__PURE__*/function(){function Qa(e){_classCallCheck(this,Qa);this.rate=e.rate,this.bucketUnitSize=Object.freeze(V({},e.bucketUnitSize)),this.favorBucketsCount=e.favorBucketsCount,this.tree=e.tree,this.visions=e.visions,this.bucketFactory=e.bucketFactory,this.visibleNodes=this.initVisibleNodes(this.visions),this.toScreenPoint=e.toScreenPoint,this.onLeafNodeVisible=e.onLeafNodeVisible,this.onLeafNodeInvisible=e.onLeafNodeInvisible,this.visionCover=this.calcVisionCover(e.visionRectangle),this._projectiveSize=this.calcProjectiveSize(this.visionCover,e.scale),this.buckets=new cn,this.searchAndFillVisibleNodes(this.visionCover.range,this._projectiveSize,this.visionCover.unitSize,e.ratio)}_createClass(Qa,[{key:"projectiveSize",get:function get(){return this._projectiveSize}},{key:"unitSize",get:function get(){return this.visionCover.unitSize}},{key:"range",get:function get(){return this.visionCover.range}},{key:"forEachBuckets",value:function forEachBuckets(e){this.buckets.forEach(e)}},{key:"bucket",value:function bucket(e,t){return this.buckets.get(e,t)}},{key:"update",value:function update(e){var _this118=this;this.refreshVisibleNodes(e.diff);var _this$updateVision=this.updateVision(e),t=_this$updateVision.addedRange,i=_this$updateVision.keepRange,r=_this$updateVision.projectiveSize,n=V({},e.updateSet),s=!!e.dirtyCells,o=[];return i.forEach(function(a,l){var h=_this118.buckets.get(a,l),_this118$appendDiff=_this118.appendDiff(a,l,h,e,s),d=_this118$appendDiff.movedLeaves,u=_this118$appendDiff.touchedLeaves;u&&o.push({row:a,column:l,touchedLeaves:u}),Object.assign(n,d)}),t.forEach(function(a,l){var h;var d=_this118.buckets.get(a,l),u=d.collectLeaves(),p=_this118.createProjectiveRect(a,l,_this118.visionCover.unitSize,r);(h=e.dirtyCells)==null||h.collect(a,l),Object.assign(n,u),d.updateProjectiveRect(p,e.ratio,e.refresh)}),i.forEach(function(a,l){var h=_this118.buckets.get(a,l),d=_this118.createProjectiveRect(a,l,_this118.visionCover.unitSize,r);h.updateProjectiveRect(d,e.ratio,e.refresh),h.handleUpdatedLeaves(n),h.fuseChunksWithNeighbours(),h.increaseChunksLife()}),e.shouldUpdateAll&&this.forEachBuckets(function(a){return a.notifyGlobalUpdate()}),this.callbackLeavesVisible(e),o}},{key:"initVisibleNodes",value:function initVisibleNodes(e){var t={};return e.forEach(function(i){t[i.id]=i}),t}},{key:"refreshVisibleNodes",value:function refreshVisibleNodes(_ref43){var e=_ref43.addedSet,t=_ref43.removedSet;for(var i in e){this.visibleNodes[i]=e[i]}for(var _i31 in t){delete this.visibleNodes[_i31]}}},{key:"updateVision",value:function updateVision(e){var t=oy,i=this.visionCover.range,r=null;if(e.visionRectangle){var n=this.calcVisionCover(e.visionRectangle,this.visionCover.exponent),s=this.calcProjectiveSize(n,e.scale);if(!Qa.isVisionCoversEquals(n,this.visionCover)){var o=this.forkOrMegeAndGetRangeDiff(n,s);this.searchAndFillVisibleNodes(o.addedRange,s,n.unitSize,e.scale),this.visionCover=n,t=o.addedRange,i=o.keepRange}pi(s,this._projectiveSize)||(this._projectiveSize=s,r=s)}return r||(r=this._projectiveSize),{addedRange:t,keepRange:i,projectiveSize:r}}},{key:"forkOrMegeAndGetRangeDiff",value:function forkOrMegeAndGetRangeDiff(e,t){var _this119=this;var i,r=e.exponent-this.visionCover.exponent;if(r>0){var n=Math.pow(this.rate,r),s=new cn,o=[],a=this.visionCover.range.merge(n,n,function(l,h,d,u){if(e.range.includes(l,h))if(u)o.push({row:l,column:h});else{var p=_this119.bucketFactory.merge(_this119.buckets,{range:d,unitSize:e.unitSize,projectiveRect:_this119.createProjectiveRect(l,h,e.unitSize,t)});s.set(l,h,p)}});if(i=ze.calcDiff(e.range,a),o.length>0){var l=ex(i.addedRange,o),h=tx(i.keepRange,o);i=je(V({},i),{addedRange:l,keepRange:h})}this.buckets.forEach(function(l){return l.dispose()}),this.buckets=s}else if(r<0){var _n25=Math.pow(this.rate,Math.abs(r)),_s14=new cn,_o12=this.visionCover.range.fork(_n25,_n25,function(a,l,h){var d=ze.calcIntersection(h,e.range),u=_this119.buckets.get(a,l);if(d&&u){var p=_this119.bucketFactory.fork(u,{range:d,unitSize:e.unitSize,projectiveRect:_this119.createProjectiveRect(a,l,e.unitSize,t)});_s14.fill(p)}});i=ze.calcDiff(e.range,_o12),this.buckets.forEach(function(a){return a.dispose()}),this.buckets=_s14}else i=ze.calcDiff(e.range,this.visionCover.range),i.removedRange.forEach(function(n,s){var o;(o=_this119.buckets["delete"](n,s))==null||o.dispose()});return i}},{key:"searchAndFillVisibleNodes",value:function searchAndFillVisibleNodes(e,t,i,r){var _this120=this;var n=null;e.forEach(function(s,o){if(!n){n={};for(var d in _this120.visibleNodes){var u=_this120.rangeOfLeafNode(_this120.visibleNodes[d],i);u&&(n[d]=u)}}var a=ze.cellToRect(s,o,i),l=_this120.createProjectiveRect(s,o,i,t),h=_this120.bucketFactory.build(_this120.tree,r,a,l,function(d){var u=n[d.id];return!!(u&&u.includes(s,o))});_this120.buckets.set(s,o,h)})}},{key:"createProjectiveRect",value:function createProjectiveRect(e,t,i,r){var n=this.toScreenPoint(e,t,i);return{originX:n.x,originY:n.y,width:r.width,height:r.height}}},{key:"appendDiff",value:function appendDiff(e,t,i,r,n){var s=r.diff,o=r.moveSet,_s15=s,a=_s15.addedSet,l=this.visionCover.unitSize,h=[],d=[],u=[];for(var m in a){var g=this.rangeOfLeafNode(a[m],l);g&&!g.includes(e,t)&&h.push(m)}var p={};for(var _m5 in o){var _g5=o[_m5],y=this.rangeOfLeafNode(_g5,l);if(y){var b=i.has(_m5),v=y.includes(e,t);b&&v?p[_m5]=_g5:b&&!v?u.push(_g5):!b&&v&&d.push(_g5)}}var f=n?{}:null;if(h.length>0||d.length>0||u.length>0){if(f){var _iterator110=_createForOfIteratorHelper(h),_step110;try{for(_iterator110.s();!(_step110=_iterator110.n()).done;){var _m6=_step110.value;f[_m6]=!0}}catch(err){_iterator110.e(err)}finally{_iterator110.f()}var _iterator111=_createForOfIteratorHelper(d),_step111;try{for(_iterator111.s();!(_step111=_iterator111.n()).done;){var _m7=_step111.value;f[_m7.id]=!0}}catch(err){_iterator111.e(err)}finally{_iterator111.f()}var _iterator112=_createForOfIteratorHelper(u),_step112;try{for(_iterator112.s();!(_step112=_iterator112.n()).done;){var _m8=_step112.value;f[_m8.id]=!0}}catch(err){_iterator112.e(err)}finally{_iterator112.f()}}s=s.decorate({maskAdded:h,insertToAdded:d,insertToRemoved:u})}if(f){for(var _m9 in p){f[_m9]=!0}for(var _m10 in r.updateSet){f[_m10]=!0}for(var _m11 in r.diff.sortedSet){f[_m11]=!0}for(var _m12 in r.diff.removedSet){f[_m12]=!0}gt(f)||(f=null)}return i.appendDiff(s),{movedLeaves:p,touchedLeaves:f}}},{key:"isLeavesTouchBucket",value:function isLeavesTouchBucket(e,t){var i=!1;for(var _r40 in t){if(e.has(_r40)){i=!0;break}}return i}},{key:"callbackLeavesVisible",value:function callbackLeavesVisible(e){var _e$diff=e.diff,t=_e$diff.addedSet,i=_e$diff.removedSet;for(var _r41 in t){this.onLeafNodeVisible(t[_r41])}for(var _r42 in i){this.onLeafNodeInvisible(i[_r42])}}},{key:"calcVisionCover",value:function calcVisionCover(e,t){var i=e.width*e.height;i===0&&(i=1);var r=this.rate,n=this.favorBucketsCount,s=this.bucketUnitSize,o=s.width*s.height,a=Math.log(i/(n*o))/(2*Math.log(r));if(t===void 0)a=Math.ceil(a);else{var u=t+Qa.ExponentBuffer,p=t-1-Qa.ExponentBuffer;a>u||a<p?a=Math.ceil(a):a=t}var l=Math.pow(r,a),h=Object.freeze({width:s.width*l,height:s.height*l}),d=ze.rectToRange(e,h);return Object.freeze({exponent:a,range:d,unitSize:h})}},{key:"calcProjectiveSize",value:function calcProjectiveSize(_ref44,i){var _ref44$unitSize=_ref44.unitSize,e=_ref44$unitSize.width,t=_ref44$unitSize.height;return Object.freeze({width:Math.ceil(e*i),height:Math.ceil(t*i)})}},{key:"rangeOfLeafNode",value:function rangeOfLeafNode(e,t){var i=this.visions.vision(e.id);return i?ze.rectToRange(i.sceneRect,t):null}}],[{key:"isVisionCoversEquals",value:function isVisionCoversEquals(e,t){return e.exponent===t.exponent&&e.unitSize.width===t.unitSize.width&&e.unitSize.height===t.unitSize.height&&ze.isEquals(e.range,t.range)}}]);return Qa}(),ay=Qa;ay.ExponentBuffer=.25;var ix=/*#__PURE__*/function(){function ix(e,t,i,r,n,s){var _this121=this;_classCallCheck(this,ix);this.touch=function(){_this121.onRepaint(_this121.leaf.value)},this.screen=e,this.visions=t,this.id=i.id,this.leaf=i,this.fixedSize=r,this.render=n,this.onRepaint=s}_createClass(ix,[{key:"refreshPayload",value:function refreshPayload(){this.render.updatePayload(this.leaf.value.payload)}},{key:"updateContext",value:function updateContext(e){this.render.updateContext(e)}},{key:"paint",value:function paint(e,t,i){var r=this.leaf.value,n=this.visions.vision(this.leaf.id),s=this.createPaintParams(e,n,r,t,i),o=n.screenRect.originX,a=n.screenRect.originY;if(i&&(o-=i.originX,a-=i.originY),e.translate(o,a),this.fixedSize){var l=n.scale;if(l!==1&&e.scale(l,l),n.rotation!==void 0){var _n$sceneRect=n.sceneRect,h=_n$sceneRect.width,d=_n$sceneRect.height,u=h/2,p=d/2;e.translate(u,p),e.rotate(n.rotation),e.translate(-u,-p)}}this.render.paint(s)}},{key:"remove",value:function remove(){this.render.remove()}},{key:"createPaintParams",value:function createPaintParams(e,t,i,r,n){var s,o,a,l=t.screenRect,h=this.touch,d=this.createTailor(t,n);if(this.fixedSize){a=t.scale,o={width:i.width,height:i.height};var f=t.scale,m=t.margin,g=l.width/f-o.width,y=l.height/f-o.height,b=g/(m.left+m.right),v=y/(m.top+m.bottom);s={left:m.left*b,right:m.right*b,top:m.top*v,bottom:m.bottom*v}}else a=t.scale,s=t.margin,o={width:l.width-s.left-s.right,height:l.height-s.top-s.bottom};var u={context:e,margin:s,scale:a,size:o,tailor:d,paintingMode:r,touch:h,screen:this.screen},p=this.createFakeScreenRect(o,d);return u.screenSize=p,u.screenRect=p,u}},{key:"createTailor",value:function createTailor(e,t){var i=e.tailor,r=i.left,n=i.top,s=i.right,o=i.bottom;if(t){var a=e.screenRect,l=a.originX,h=a.originY,d=l+a.width,u=h+a.height,p=l+r,f=h+n,m=d-s,g=u-o;p=Math.max(p,t.originX),f=Math.max(f,t.originY),m=Math.min(m,t.originX+t.width),g=Math.min(g,t.originY+t.width),r=p-l,n=f-h,s=d-m,o=u-g}if(this.fixedSize){var _a10=e.scale;r/=_a10,n/=_a10,s/=_a10,o/=_a10}return{left:r,top:n,right:s,bottom:o}}},{key:"createFakeScreenRect",value:function createFakeScreenRect(e,t){var i=t.left,r=t.top,n=e.width-t.right,s=e.height-t.bottom;return{originX:i,originY:r,width:n-i,height:s-r}}}]);return ix}(),ao=/*#__PURE__*/function(){function ao(e){_classCallCheck(this,ao);this.nodes=null,this.id="".concat(ao.nextId+=1),this.life=0,this.context=e}_createClass(ao,[{key:"isFuseable",get:function get(){return this.life>=ao.fuseThreshold}},{key:"isFloat",get:function get(){var e;return this.life<ao.floatThreshold&&((e=this.nodes)==null?void 0:e.length)===1}},{key:"onBeforeFuse",value:function onBeforeFuse(e,t){}},{key:"onSplit",value:function onSplit(){}},{key:"onRemoved",value:function onRemoved(){}},{key:Symbol.iterator,value:function value(){return new rx(this.getNodes())}},{key:"previousChunk",get:function get(){var e,t;return((t=(e=this.getNodes()[0])==null?void 0:e.previousNode)==null?void 0:t.value)||null}},{key:"nextChunk",get:function get(){var e,t;var i=this.getNodes();return((t=(e=i[i.length-1])==null?void 0:e.nextNode)==null?void 0:t.value)||null}},{key:"getSampleNode",value:function getSampleNode(){return this.nodes&&this.nodes.length>0?this.nodes[0]:null}},{key:"initWithNode",value:function initWithNode(e){if(this.nodes)throw new Error("it is not init chunk");return this.nodes=[e],e.value=this,this}},{key:"initWithShadowList",value:function initWithShadowList(e){if(this.nodes)throw new Error("it is not init chunk");this.nodes=[];var _iterator113=_createForOfIteratorHelper(e),_step113;try{for(_iterator113.s();!(_step113=_iterator113.n()).done;){var t=_step113.value;this.nodes.push(t),t.value=this}}catch(err){_iterator113.e(err)}finally{_iterator113.f()}return this}},{key:"increaseLife",value:function increaseLife(){var _this122=this;this.life<ao.floatThreshold&&this.watchIsFloatUpdate(function(){_this122.life+=1})}},{key:"cutOff",value:function cutOff(e,t){var _this123=this;return this.watchIsFloatUpdate(function(){var i=_this123.getNodes(),r=i.indexOf(e),n=i.indexOf(t);if(r===-1)throw new Error("cannot find begin node id=".concat(e.id," to cut off"));if(n===-1)throw new Error("cannot find end node id=".concat(e.id," to cut off"));var s=i.splice(n),o=_this123.createChunkWithNodes(s),a=i.splice(0,r+1);return{left:_this123.createChunkWithNodes(a),right:o,becomeBlank:i.length===0}})}},{key:"split",value:function split(e){var _this124=this;return this.watchIsFloatUpdate(function(){var t=_this124.getNodes(),i=t.indexOf(e),r=null,n=null;if(i===-1)throw new Error("cannot find node id=".concat(e.id," to split"));if(i<t.length-1){var s=t.splice(i+1);r=_this124.createChunkWithNodes(s)}if(i>0){var _s16=t.splice(0,i);n=_this124.createChunkWithNodes(_s16)}return _this124.onSplit(),{left:n,right:r}})}},{key:"createChunkWithNodes",value:function createChunkWithNodes(e){var t=this.context.create();t.nodes=e;var _iterator114=_createForOfIteratorHelper(e),_step114;try{for(_iterator114.s();!(_step114=_iterator114.n()).done;){var i=_step114.value;i.value=t}}catch(err){_iterator114.e(err)}finally{_iterator114.f()}return t.isFloat&&t.context.bind(t,e[0].related),t}},{key:"findFuseNeighboursBeforeMe",value:function findFuseNeighboursBeforeMe(){var e=this,t=[];for(;e&&(e=e.previousChunk,!!(e==null?void 0:e.isFuseable));){t.unshift(e)}return t}},{key:"findFuseNeighboursAfterMe",value:function findFuseNeighboursAfterMe(){var e=this,t=[];for(;e&&(e=e.nextChunk,!!(e==null?void 0:e.isFuseable));){t.push(e)}return t}},{key:"unshift",value:function unshift(e){var t=e.nodes;if(t){var _this$getNodes;(_this$getNodes=this.getNodes()).unshift.apply(_this$getNodes,_toConsumableArray(t));var _iterator115=_createForOfIteratorHelper(t),_step115;try{for(_iterator115.s();!(_step115=_iterator115.n()).done;){var i=_step115.value;i.value=this}}catch(err){_iterator115.e(err)}finally{_iterator115.f()}}}},{key:"push",value:function push(e){var t=e.nodes;if(t){var _this$getNodes2;(_this$getNodes2=this.getNodes()).push.apply(_this$getNodes2,_toConsumableArray(t));var _iterator116=_createForOfIteratorHelper(t),_step116;try{for(_iterator116.s();!(_step116=_iterator116.n()).done;){var i=_step116.value;i.value=this}}catch(err){_iterator116.e(err)}finally{_iterator116.f()}}}},{key:"resetLife",value:function resetLife(){this.life=0}},{key:"dispose",value:function dispose(){this.isFloat&&this.context.unbind(this,this.nodes[0].related),this.nodes=null,this.life=0,this.onRemoved()}},{key:"getNodes",value:function getNodes(){return this.nodes||(this.nodes=[]),this.nodes}},{key:"watchIsFloatUpdate",value:function watchIsFloatUpdate(e){var t=this.isFloat,i=this.nodes&&this.nodes[0].related,r=e(),n=this.isFloat;return!t&&n?this.context.bind(this,this.nodes[0].related):t&&!n&&this.context.unbind(this,i),r}}],[{key:"fuseEachNeighbours",value:function fuseEachNeighbours(e){var t=[],i={};for(var _r43 in e){if(!i[_r43]){(function(){i[_r43]=!0;var n=e[_r43];n.isFuseable&&n.watchIsFloatUpdate(function(){var s=n.findFuseNeighboursBeforeMe(),o=n.findFuseNeighboursAfterMe();(s.length>0||o.length>0)&&(n.life=0,n.onBeforeFuse(s,o));for(var a=s.length-1;a>=0;a--){n.unshift(s[a])}var _iterator117=_createForOfIteratorHelper(s),_step117;try{for(_iterator117.s();!(_step117=_iterator117.n()).done;){var _a11=_step117.value;i[_a11.id]=!0,t.push(_a11)}}catch(err){_iterator117.e(err)}finally{_iterator117.f()}var _iterator118=_createForOfIteratorHelper(o),_step118;try{for(_iterator118.s();!(_step118=_iterator118.n()).done;){var _a12=_step118.value;n.push(_a12),i[_a12.id]=!0,t.push(_a12)}}catch(err){_iterator118.e(err)}finally{_iterator118.f()}})})()}}return t}}]);return ao}(),lo=ao;lo.fuseThreshold=4,lo.floatThreshold=5,lo.nextId=0;var rx=/*#__PURE__*/function(){function rx(e){_classCallCheck(this,rx);this.nodes=e,this.index=0}_createClass(rx,[{key:"next",value:function next(){var e;return this.index<this.nodes.length?(e={value:this.nodes[this.index],done:!1},this.index+=1):e={value:void 0,done:!0},e}}]);return rx}();function ly(){return new qa({},{},{})}var ud=/*#__PURE__*/function(){function ud(e){_classCallCheck(this,ud);this.addedSet={},this.sortedSet={},this.removedSet={},this.id="".concat(ud.nextId),this.releaser=e,ud.nextId+=1}_createClass(ud,[{key:"fetchDiff",value:function fetchDiff(){var e=new qa(this.addedSet,this.sortedSet,this.removedSet);return this.addedSet={},this.sortedSet={},this.removedSet={},e}},{key:"release",value:function release(){this.releaser(this.id)}},{key:"markAdded",value:function markAdded(e){this.addedSet[e.id]=e,delete this.sortedSet[e.id],delete this.removedSet[e.id]}},{key:"markSorted",value:function markSorted(e){this.addedSet[e.id]||(this.sortedSet[e.id]=e)}},{key:"markRemoved",value:function markRemoved(e){this.removedSet[e.id]=e,delete this.addedSet[e.id],delete this.sortedSet[e.id]}}]);return ud}(),cy=ud;cy.nextId=0;var qa=/*#__PURE__*/function(){function qa(e,t,i){_classCallCheck(this,qa);this.addedSet=e,this.sortedSet=t,this.removedSet=i}_createClass(qa,[{key:"isBlank",get:function get(){return!gt(this.addedSet)&&!gt(this.sortedSet)&&!gt(this.removedSet)}},{key:"decorate",value:function decorate(_ref45){var e=_ref45.insertToAdded,t=_ref45.insertToRemoved,i=_ref45.maskAdded;var r=null,n=null;if(e&&e.length>0){r=V({},this.addedSet);var _iterator119=_createForOfIteratorHelper(e),_step119;try{for(_iterator119.s();!(_step119=_iterator119.n()).done;){var s=_step119.value;r[s.id]=s}}catch(err){_iterator119.e(err)}finally{_iterator119.f()}}if(i&&i.length>0){r=r||V({},this.addedSet);var _iterator120=_createForOfIteratorHelper(i),_step120;try{for(_iterator120.s();!(_step120=_iterator120.n()).done;){var _s17=_step120.value;delete r[_s17]}}catch(err){_iterator120.e(err)}finally{_iterator120.f()}}if(t&&t.length>0){n=V({},this.removedSet);var _iterator121=_createForOfIteratorHelper(t),_step121;try{for(_iterator121.s();!(_step121=_iterator121.n()).done;){var _s18=_step121.value;n[_s18.id]=_s18}}catch(err){_iterator121.e(err)}finally{_iterator121.f()}}return r=r||this.addedSet,n=n||this.removedSet,new qa(r,this.sortedSet,n)}}],[{key:"createInsertDiff",value:function createInsertDiff(e){var t={};var _iterator122=_createForOfIteratorHelper(e),_step122;try{for(_iterator122.s();!(_step122=_iterator122.n()).done;){var i=_step122.value;t[i.id]=i}}catch(err){_iterator122.e(err)}finally{_iterator122.f()}return new qa(t,{},{})}}]);return qa}(),nx=/*#__PURE__*/function(){function nx(e){_classCallCheck(this,nx);var t={};var _iterator123=_createForOfIteratorHelper(e),_step123;try{for(_iterator123.s();!(_step123=_iterator123.n()).done;){var i=_step123.value;t[i.id]={leaf:i,nex:null}}}catch(err){_iterator123.e(err)}finally{_iterator123.f()}this.nodes=t,this.leaves=e}_createClass(nx,[{key:"sort",value:function sort(){this.leaves.splice(0);for(var e in this.nodes){var t=this.nodes[e],i=this.findNextNode(t);i&&(t.nex=i,delete this.nodes[i.leaf.id])}for(var _e7 in this.nodes){var _t9=this.nodes[_e7];for(;_t9;){this.leaves.push(_t9.leaf),_t9=_t9.nex}}return this.leaves}},{key:"findNextNode",value:function findNextNode(e){var t=e.leaf.nexLeaf();for(;t;){var i=this.nodes[t.id];if(i)return i;t=t.nexLeaf()}return null}}]);return nx}(),pd=/*#__PURE__*/function(){function pd(e,t){_classCallCheck(this,pd);this.par=null,this.pre=null,this.nex=null,this.tree=e,this.value=t,this.id=String(pd.nextId),pd.nextId+=1}_createClass(pd,[{key:"parent",get:function get(){return this.par}},{key:"assertBlank",value:function assertBlank(e){if(this.assertBelongsTo(e),this.par||this.pre||this.nex)throw new Error("node is not empty")}},{key:"assertAddedTo",value:function assertAddedTo(e){if(this.assertBelongsTo(e),this.isFreeNode())throw new Error("this node did not add to any tree")}},{key:"assertBelongsTo",value:function assertBelongsTo(e){if(this.tree!==e)throw new Error("this node is belongs to another tree")}},{key:"isFreeNode",value:function isFreeNode(){return this.par===null}},{key:"preLeaf",value:function preLeaf(){return this.pre?this.pre.lastLeaf():this.par?this.par.preLeaf():null}},{key:"nexLeaf",value:function nexLeaf(){return this.nex?this.nex.firstLeaf():this.par?this.par.nexLeaf():null}}]);return pd}(),md=pd;md.nextId=0;var co=/*#__PURE__*/function(_md){_inherits(co,_md);var _super33=_createSuper(co);function co(e,t){_classCallCheck(this,co);return _super33.call(this,e,t)}_createClass(co,[{key:"firstLeaf",value:function firstLeaf(){return this}},{key:"lastLeaf",value:function lastLeaf(){return this}}]);return co}(md),hy=/*#__PURE__*/function(_md2){_inherits(hy,_md2);var _super34=_createSuper(hy);function hy(e,t){var _i32;var _this125;_classCallCheck(this,hy);_this125=_super34.call(this,e,t);_this125.fir=null,_this125.las=null,_this125.forEachLeaves=function(r){var n=_this125.fir;for(;n;){n instanceof co?r(n):n.forEachLeaves(r),n=n.nex}};var i=(_i32={},_defineProperty(_i32,Symbol.iterator,function(){return new ox(_assertThisInitialized(_this125))}),_defineProperty(_i32,"forEach",_this125.forEachLeaves),_i32);_this125.leaves=Object.freeze(i);return _this125}_createClass(hy,[{key:Symbol.iterator,value:function value(){return new sx(this.fir)}},{key:"nodes",get:function get(){var e=[],t=this.fir;for(;t;){e.push(t),t=t.nex}return e}},{key:"assertBlank",value:function assertBlank(e){if(_get(_getPrototypeOf(hy.prototype),"assertBlank",this).call(this,e),this.fir||this.las)throw new Error("node is not empty")}},{key:"firstLeaf",value:function firstLeaf(){var e=this.fir;for(;e;){var t=e.firstLeaf();if(t)return t;e=e.nex}return null}},{key:"lastLeaf",value:function lastLeaf(){var e=this.las;for(;e;){var t=e.lastLeaf();if(t)return t;e=e.pre}return null}},{key:"forEach",value:function forEach(e){var t=this.fir;for(;t;){e(t),t=t.nex}}},{key:"isFreeNode",value:function isFreeNode(){return _get(_getPrototypeOf(hy.prototype),"isFreeNode",this).call(this)&&this!==this.tree.root}}]);return hy}(md),sx=/*#__PURE__*/function(){function sx(e){_classCallCheck(this,sx);this.node=e}_createClass(sx,[{key:"next",value:function next(){var e;return this.node?(e={value:this.node,done:!1},this.node=this.node.nex):e={value:void 0,done:!0},e}}]);return sx}(),ox=/*#__PURE__*/function(){function ox(e){_classCallCheck(this,ox);this.node=e.firstLeaf(),this.lastLeaf=e.lastLeaf()}_createClass(ox,[{key:"next",value:function next(){var e;return this.node?(e={value:this.node,done:!1},this.node===this.lastLeaf?this.node=null:this.node=this.node.nexLeaf()):e={value:void 0,done:!0},e}}]);return ox}(),ax=/*#__PURE__*/function(){function ax(e){_classCallCheck(this,ax);this.bufferMap={},this._root=new hy(this),e&&e(this)}_createClass(ax,[{key:"root",get:function get(){return this._root}},{key:"createDiffBuffer",value:function createDiffBuffer(){var _this126=this;var e=new cy(function(t){return delete _this126.bufferMap[t]});return this.bufferMap[e.id]=e,e}},{key:"wrapLeaf",value:function wrapLeaf(e){return new co(this,e)}},{key:"wrapGroup",value:function wrapGroup(e){return new hy(this,e)}},{key:Symbol.iterator,value:function value(){return this._root.leaves[Symbol.iterator]()}},{key:"forEach",value:function forEach(e){return this._root.leaves.forEach(e)}},{key:"append",value:function append(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this._root;var i=e,r=t;i.assertBlank(this),r.assertAddedTo(this),this.appendTo(i,r),this.markAdded(i)}},{key:"addAfter",value:function addAfter(e,t){var i=e,r=t;if(i.assertBlank(this),r.assertAddedTo(this),r===this._root)throw new Error("cannot add after root");this.addAfterTo(i,r),this.markAdded(i)}},{key:"addBefore",value:function addBefore(e,t){var i=e,r=t;if(i.assertBlank(this),r.assertAddedTo(this),r===this._root)throw new Error("cannot add before root");this.addBeforeTo(i,r),this.markAdded(i)}},{key:"remove",value:function remove(e){var t=e;t.assertAddedTo(this),this.removeFrom(t),this.markRemoved(t)}},{key:"moveAppend",value:function moveAppend(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this._root;var i=e,r=t;i.assertAddedTo(this),r.assertAddedTo(this),this.removeFrom(i),this.appendTo(i,r),this.markSorted(i)}},{key:"moveAfter",value:function moveAfter(e,t){var i=e,r=t;i.assertAddedTo(this),r.assertAddedTo(this),this.removeFrom(i),this.addAfterTo(i,r),this.markSorted(i)}},{key:"moveBefore",value:function moveBefore(e,t){var i=e,r=t;i.assertAddedTo(this),r.assertAddedTo(this),this.removeFrom(i),this.addBeforeTo(i,r),this.markSorted(i)}},{key:"appendTo",value:function appendTo(e,t){e.par=t,t.las?(e.pre=t.las,t.las.nex=e,t.las=e):(t.fir=e,t.las=e)}},{key:"addAfterTo",value:function addAfterTo(e,t){var i=t.nex,r=t.par;if(!r)throw new Error("cannot add after root");e.pre=t,e.nex=i,e.par=r,t.nex=e,i&&(i.pre=e),r.las===t&&(r.las=e)}},{key:"addBeforeTo",value:function addBeforeTo(e,t){var i=t.pre,r=t.par;if(!r)throw new Error("cannot add before root");e.nex=t,e.pre=i,e.par=r,t.pre=e,i&&(i.nex=e),r.fir===t&&(r.fir=e)}},{key:"removeFrom",value:function removeFrom(e){var t=e.pre,i=e.nex,r=e.par;if(!r)throw new Error("cannot remove root");t&&(t.nex=i),i&&(i.pre=t),r.fir===e&&(r.fir=i),r.las===e&&(r.las=t),e.par=null,e.pre=null,e.nex=null}},{key:"sortLeaves",value:function sortLeaves(e){return e.length<=1?e:new nx(e).sort()}},{key:"sort",value:function sort(e,t){var i=e;i.assertAddedTo(this);var r=i.nodes,n=_toConsumableArray(r).sort(t);this.rebuildList(i,n),this.checkAndMarkSorted(r,n)}},{key:"rebuildList",value:function rebuildList(e,t){t.length>0&&(e.fir=t[0],e.las=t[t.length-1]);var i=null;for(var _r44=0;_r44<t.length;++_r44){var n=t[_r44];i&&(i.nex=n),n.pre=i,i=n}i&&(i.nex=null)}},{key:"checkAndMarkSorted",value:function checkAndMarkSorted(e,t){var i={},r={};for(var h=0;h<e.length;++h){var d=e[h];i[d.id]=h}var n=[],s=!1,o=null,a=0,l=-1;var _iterator124=_createForOfIteratorHelper(t),_step124;try{for(_iterator124.s();!(_step124=_iterator124.n()).done;){var _h8=_step124.value;var _d5=i[_h8.id];if(o){var _u4=!1,_p3=o.length,_f3=o[_p3-1];if(_d5<=_f3)_u4=!0;else switch(o.length){case 0:break;case 1:{s=_d5===_f3+1;break}default:{_d5===_f3+1!==s&&(_u4=!0);break}}_u4?(n.push(o),o.length>a&&(a=o.length,l=n.length-1),o=[_d5]):o.push(_d5)}else o=[_d5]}}catch(err){_iterator124.e(err)}finally{_iterator124.f()}if(o&&(n.push(o),o.length>a&&(a=o.length,l=n.length-1)),l!==-1){var _h6=n[l],_d4=_h6[0],u=_h6[_h6.length-1];for(var p=l-1;p>=0;p--){var f=n[p];if(f[f.length-1]<_d4)_d4=f[0];else{var _iterator125=_createForOfIteratorHelper(f),_step125;try{for(_iterator125.s();!(_step125=_iterator125.n()).done;){var m=_step125.value;var g=e[m];r[g.id]=g}}catch(err){_iterator125.e(err)}finally{_iterator125.f()}}}for(var _p2=l+1;_p2<n.length;_p2++){var _f2=n[_p2];if(_f2[0]>u)u=_f2[_f2.length-1];else{var _iterator126=_createForOfIteratorHelper(_f2),_step126;try{for(_iterator126.s();!(_step126=_iterator126.n()).done;){var _m13=_step126.value;var _g6=e[_m13];r[_g6.id]=_g6}}catch(err){_iterator126.e(err)}finally{_iterator126.f()}}}}for(var _h7 in r){this.markSorted(r[_h7])}}},{key:"markAdded",value:function markAdded(e){for(var t in this.bufferMap){var i=this.bufferMap[t];if(e instanceof co)i.markAdded(e);else{var _iterator127=_createForOfIteratorHelper(e.leaves),_step127;try{for(_iterator127.s();!(_step127=_iterator127.n()).done;){var _r45=_step127.value;i.markAdded(_r45)}}catch(err){_iterator127.e(err)}finally{_iterator127.f()}}}}},{key:"markSorted",value:function markSorted(e){for(var t in this.bufferMap){var i=this.bufferMap[t];if(e instanceof co)i.markSorted(e);else{var _iterator128=_createForOfIteratorHelper(e.leaves),_step128;try{for(_iterator128.s();!(_step128=_iterator128.n()).done;){var _r46=_step128.value;i.markSorted(_r46)}}catch(err){_iterator128.e(err)}finally{_iterator128.f()}}}}},{key:"markRemoved",value:function markRemoved(e){for(var t in this.bufferMap){var i=this.bufferMap[t];if(e instanceof co)i.markRemoved(e);else{var _iterator129=_createForOfIteratorHelper(e.leaves),_step129;try{for(_iterator129.s();!(_step129=_iterator129.n()).done;){var _r47=_step129.value;i.markRemoved(_r47)}}catch(err){_iterator129.e(err)}finally{_iterator129.f()}}}}}]);return ax}(),Za=/*#__PURE__*/function(){function Za(e){_classCallCheck(this,Za);this.pre=null,this.nex=null,this.id=e.id,this.related=e}_createClass(Za,[{key:"previousNode",get:function get(){return this.pre}},{key:"nextNode",get:function get(){return this.nex}}]);return Za}(),hn=/*#__PURE__*/function(){function hn(e){_classCallCheck(this,hn);this.nodesSet={},this._length=0,this.fir=null,this.las=null,this.valueInitializer=e}_createClass(hn,[{key:"length",get:function get(){return this._length}},{key:"firstNode",get:function get(){return this.fir}},{key:"node",value:function node(e){return this.nodesSet[e]||null}},{key:"findNode",value:function findNode(e){var t=this.fir;for(;t&&!e(t);){t=t.nex}return t}},{key:Symbol.iterator,value:function value(){return new lx(this.fir)}},{key:"forEach",value:function forEach(e){var t=this.fir;for(;t;){e(t),t=t.nex}}},{key:"appendDiff",value:function appendDiff(e){var t=[],i=[],r=[];for(var n in e.removedSet){var s=this.nodesSet[n];s&&(this.removeNode(s),delete this.nodesSet[n],t.push(s),this._length-=1)}for(var _n26 in e.sortedSet){var _s19=this.nodesSet[_n26];_s19&&!e.addedSet[_n26]&&(this.removeNode(_s19),r.push(_s19))}for(var _n27 in e.addedSet){if(!this.nodesSet[_n27]){var _s20=e.addedSet[_n27],o=new Za(_s20);o.value=this.valueInitializer(o),this.nodesSet[_n27]=o,i.push(o),this._length+=1}}for(var _i34=0,_i33=i;_i34<_i33.length;_i34++){var _n28=_i33[_i34];this.addNode(_n28)}for(var _i35=0,_r48=r;_i35<_r48.length;_i35++){var _n29=_r48[_i35];this.addNode(_n29)}return{removedNodes:t,addedNodes:i,sortedNodes:r}}},{key:"filter",value:function filter(e){var t=new hn(this.valueInitializer);var _iterator130=_createForOfIteratorHelper(this),_step130;try{for(_iterator130.s();!(_step130=_iterator130.n()).done;){var i=_step130.value;if(e(i)){var _r49=i.related,n=i.value,s=new Za(_r49);s.value=n,t.appendNode(s)}}}catch(err){_iterator130.e(err)}finally{_iterator130.f()}return t}},{key:"removeNode",value:function removeNode(e){var t=e.pre,i=e.nex;t&&(t.nex=i),i&&(i.pre=t),this.fir===e&&(this.fir=i),this.las===e&&(this.las=t),e.pre=null,e.nex=null}},{key:"appendNode",value:function appendNode(e){this.las?(e.pre=this.las,this.las.nex=e,this.las=e):(this.fir=e,this.las=e),this.nodesSet[e.id]=e,this._length+=1}},{key:"addNode",value:function addNode(e){var t=this.findPreNode(e),i=this.findNexNode(e);t?(t.nex=e,e.pre=t):this.fir=e,i?(i.pre=e,e.nex=i):this.las=e}},{key:"findPreNode",value:function findPreNode(e){var t=e.related.preLeaf();for(;t;){var i=this.nodesSet[t.id];if(i)return i;t=t.preLeaf()}return null}},{key:"findNexNode",value:function findNexNode(e){var t=e.related.nexLeaf();for(;t;){var i=this.nodesSet[t.id];if(i)return i;t=t.nexLeaf()}return null}}],[{key:"create",value:function create(e){var t=new hn(e.valueInitializer),i=e.initLeafFilter||hn.alwaysTrue;var _iterator131=_createForOfIteratorHelper(e.tree),_step131;try{for(_iterator131.s();!(_step131=_iterator131.n()).done;){var _r50=_step131.value;if(i(_r50)){var n=new Za(_r50);n.value=t.valueInitializer(n),t.appendNode(n)}}}catch(err){_iterator131.e(err)}finally{_iterator131.f()}return t}},{key:"alwaysTrue",value:function alwaysTrue(){return!0}},{key:"merge",value:function merge(e){if(e.length>0){var t=new hn(e[0].valueInitializer),i=t.nodesSet;var _iterator132=_createForOfIteratorHelper(e),_step132;try{for(_iterator132.s();!(_step132=_iterator132.n()).done;){var _r51=_step132.value;var _iterator133=_createForOfIteratorHelper(_r51),_step133;try{for(_iterator133.s();!(_step133=_iterator133.n()).done;){var _step133$value=_step133.value,n=_step133$value.id,s=_step133$value.related,o=_step133$value.value;if(!i[n]){var a=new Za(s);a.value=o,i[n]=a,t._length+=1,t.addNode(a)}}}catch(err){_iterator133.e(err)}finally{_iterator133.f()}}}catch(err){_iterator132.e(err)}finally{_iterator132.f()}return t}else return null}}]);return hn}(),lx=/*#__PURE__*/function(){function lx(e){_classCallCheck(this,lx);this.node=e}_createClass(lx,[{key:"next",value:function next(){var e;return this.node?(e={value:this.node,done:!1},this.node=this.node.nex):e={value:void 0,done:!0},e}}]);return lx}(),cx=/*#__PURE__*/function(){function cx(e){_classCallCheck(this,cx);this.visions=e}_createClass(cx,[{key:"build",value:function build(e,t,i,r,n){var s,o=this.canvasPool,a=this.chunkContext,l=hn.create({tree:e,initLeafFilter:n!=null?n:function(){return!1},valueInitializer:function valueInitializer(){return null}});if(n&&l.length>0){var h=a.create().initWithShadowList(l);s=_defineProperty({},h.id,h),h.isFloat&&a.bind(h,h.getSampleNode().related)}return this.create({ratio:t,canvasPool:o,rectangle:i,chunks:s,projectiveRect:r,shadowList:l,chunkContext:a})}},{key:"merge",value:function merge(e,_ref46){var t=_ref46.range,i=_ref46.unitSize,r=_ref46.projectiveRect;var n=[],s=1;t.forEach(function(f,m){var g=e.get(f,m);n.push(g.shadowList),s=g.ratio});var o=this.canvasPool,a=this.chunkContext,l=hn.merge(n),h={};if(l.length>0){var f=a.create().initWithShadowList(l);h[f.id]=f,f.isFloat&&a.bind(f,f.getSampleNode().related)}var d=t.row0*t.rowsCount,u=t.column0*t.columnsCount,p=ze.cellToRect(d,u,i);return this.create({ratio:s,canvasPool:o,rectangle:p,shadowList:l,chunks:h,projectiveRect:r,chunkContext:a})}},{key:"fork",value:function fork(e,_ref47){var _this127=this;var t=_ref47.range,i=_ref47.unitSize,r=_ref47.projectiveRect;var n=this.canvasPool,s=this.chunkContext,o={},a=new cn;return e.shadowList.forEach(function(l){var h=_this127.visions.vision(l.related.id);if(h){var d=ze.rectToRange(h.sceneRect,i);o[l.id]=d}}),t.forEach(function(l,h){var d=e.shadowList.filter(function(p){var f;return!!((f=o[p.id])==null?void 0:f.includes(l,h))}),u={};if(d.length>0){var p=s.create().initWithShadowList(d);u[p.id]=p,s.bind(p,p.getSampleNode().related)}a.set(l,h,_this127.create({canvasPool:n,shadowList:d,chunks:u,projectiveRect:r,chunkContext:s,ratio:e.ratio,rectangle:ze.cellToRect(l,h,i)}))}),a}}]);return cx}(),dy=/*#__PURE__*/function(){function dy(e){_classCallCheck(this,dy);this.id="".concat(dy.nextId+=1),this.chunkContext=e.chunkContext,this.rectangle=e.rectangle,this._ratio=e.ratio,this._projectiveRect=e.projectiveRect,this.shadowList=e.shadowList,this.chunks=e.chunks||{}}_createClass(dy,[{key:"ratio",get:function get(){return this._ratio}},{key:"projectiveRect",get:function get(){return this._projectiveRect}},{key:"firstChunk",get:function get(){var e=this.shadowList.firstNode;return e?e.value:null}},{key:Symbol.iterator,value:function value(){return new hx(this.firstChunk)}},{key:"has",value:function has(e){return this.shadowList.node(e)!==null}},{key:"findChunk",value:function findChunk(e){var t=null,i=this.shadowList.node(e.id);return i&&(t=this.findChunkByNode(i)),t}},{key:"collectLeaves",value:function collectLeaves(){var e={};for(var t in this.chunks){var _iterator134=_createForOfIteratorHelper(this.chunks[t]),_step134;try{for(_iterator134.s();!(_step134=_iterator134.n()).done;){var i=_step134.value;e[i.id]=i.related}}catch(err){_iterator134.e(err)}finally{_iterator134.f()}}return e}},{key:"appendDiff",value:function appendDiff(e){var _this$shadowList$appe=this.shadowList.appendDiff(e),t=_this$shadowList$appe.removedNodes,i=_this$shadowList$appe.addedNodes,r=_this$shadowList$appe.sortedNodes;var _iterator135=_createForOfIteratorHelper(r),_step135;try{for(_iterator135.s();!(_step135=_iterator135.n()).done;){var n=_step135.value;this.removeNode(n)}}catch(err){_iterator135.e(err)}finally{_iterator135.f()}var _iterator136=_createForOfIteratorHelper(t),_step136;try{for(_iterator136.s();!(_step136=_iterator136.n()).done;){var _n30=_step136.value;this.removeNode(_n30)}}catch(err){_iterator136.e(err)}finally{_iterator136.f()}var _iterator137=_createForOfIteratorHelper(i),_step137;try{for(_iterator137.s();!(_step137=_iterator137.n()).done;){var _n31=_step137.value;this.addNode(_n31)}}catch(err){_iterator137.e(err)}finally{_iterator137.f()}var _iterator138=_createForOfIteratorHelper(r),_step138;try{for(_iterator138.s();!(_step138=_iterator138.n()).done;){var _n32=_step138.value;this.addNode(_n32)}}catch(err){_iterator138.e(err)}finally{_iterator138.f()}}},{key:"removeNode",value:function removeNode(e){var t=this.findChunkByNode(e);if(t){var i=this.chunkContext,_t$split=t.split(e),_r52=_t$split.left,n=_t$split.right;_r52&&(this.chunks[_r52.id]=_r52,_r52.isFloat&&i.bind(_r52,_r52.getSampleNode().related)),n&&(this.chunks[n.id]=n,n.isFloat&&i.bind(n,n.getSampleNode().related)),delete this.chunks[t.id],t.dispose()}}},{key:"addNode",value:function addNode(e){var t=this.chunkContext,i=this.previousNode(e),r=i==null?void 0:i.value,n=this.nextNode(e),s=n==null?void 0:n.value;if(r&&r===s){var a=r,_a$cutOff=a.cutOff(i,n),l=_a$cutOff.left,h=_a$cutOff.right,d=_a$cutOff.becomeBlank;this.chunks[l.id]=l,this.chunks[h.id]=h,l.isFloat&&t.bind(l,l.getSampleNode().related),h.isFloat&&t.bind(h,h.getSampleNode().related),d?(delete this.chunks[a.id],a.dispose()):a.resetLife()}var o=this.chunkContext.create().initWithNode(e);this.chunks[o.id]=o,t.bind(o,o.getSampleNode().related)}},{key:"previousNode",value:function previousNode(e){var t=e.previousNode;for(;t&&!t.value;){t=t.previousNode}return t}},{key:"nextNode",value:function nextNode(e){var t=e.nextNode;for(;t&&!t.value;){t=t.nextNode}return t}},{key:"findChunkByNode",value:function findChunkByNode(e){var t=e.value,i=null;if(t&&(i=this.chunks[t.id],i!==t))throw new Error("invalid node");return i}},{key:"handleUpdatedLeaves",value:function handleUpdatedLeaves(e){for(var t in e){var i=this.shadowList.node(t);if(i==null?void 0:i.value){var _r53=i.value,_r53$split=_r53.split(i),n=_r53$split.left,s=_r53$split.right,o=this.chunkContext;n&&(this.chunks[n.id]=n,n.isFloat&&o.bind(n,n.getSampleNode().related)),s&&(this.chunks[s.id]=s,s.isFloat&&o.bind(s,s.getSampleNode().related)),_r53.resetLife()}}}},{key:"fuseChunksWithNeighbours",value:function fuseChunksWithNeighbours(){var e=this.chunks,t=lo.fuseEachNeighbours(e);var _iterator139=_createForOfIteratorHelper(t),_step139;try{for(_iterator139.s();!(_step139=_iterator139.n()).done;){var i=_step139.value;delete e[i.id],i.dispose()}}catch(err){_iterator139.e(err)}finally{_iterator139.f()}}},{key:"increaseChunksLife",value:function increaseChunksLife(){var e=this.chunks;for(var t in e){e[t].increaseLife()}}},{key:"updateProjectiveRect",value:function updateProjectiveRect(e,t,i){this._ratio=t,this._projectiveRect=Object.freeze({originX:e.originX,originY:e.originY,width:e.width,height:e.height})}},{key:"dispose",value:function dispose(){var e={};var _iterator140=_createForOfIteratorHelper(this.shadowList),_step140;try{for(_iterator140.s();!(_step140=_iterator140.n()).done;){var _t10=_step140.value;var i=_t10.value;i&&(e[i.id]=i)}}catch(err){_iterator140.e(err)}finally{_iterator140.f()}for(var t in e){e[t].dispose()}}},{key:"notifyGlobalUpdate",value:function notifyGlobalUpdate(){}}]);return dy}(),uy=dy;uy.nextId=0;var hx=/*#__PURE__*/function(){function hx(e){_classCallCheck(this,hx);this.chunk=e,this.didTouchChunk={}}_createClass(hx,[{key:"next",value:function next(){var e;var t;if(this.chunk){if(this.didTouchChunk[this.chunk.id])throw new Error("find duplicated chunk "+this.chunk.id);this.didTouchChunk[this.chunk.id]=this.chunk,t={value:this.chunk,done:!1},this.chunk=(e=this.chunk.nextChunk)!=null?e:null}else t={value:void 0,done:!0};return t}}]);return hx}(),dx=/*#__PURE__*/function(){function dx(e){_classCallCheck(this,dx);this.nodes={},this.factory=e}_createClass(dx,[{key:"create",value:function create(){return this.factory(this)}},{key:"forEachCandidateFloatNodes",value:function forEachCandidateFloatNodes(e){for(var t in this.nodes){e(this.nodes[t].leaf)}}},{key:"bind",value:function bind(e,t){var i=this.nodes[t.id];i||(i=this.nodes[t.id]={leaf:t,chunks:{}}),i.chunks[e.id]=e}},{key:"unbind",value:function unbind(e,t){var i=this.nodes[t.id];if(i){var _r54=i.chunks;delete _r54[e.id],gt(_r54)||delete this.nodes[t.id]}}}]);return dx}(),ux=/*#__PURE__*/function(){function ux(){_classCallCheck(this,ux);this.refManager=new px,this.pool=[]}_createClass(ux,[{key:"pull",value:function pull(){var e;if(this.pool.length===0){var t=document.createElement("canvas"),i=cs(t);e={canvas:t,context:i,size:{width:0,height:0}}}else e=this.pool.pop();return e}},{key:"push",value:function push(e){this.pool.push(e)}},{key:"clear",value:function clear(){this.pool=[]}}]);return ux}(),px=/*#__PURE__*/function(){function px(){_classCallCheck(this,px);this.refs={},this._length=0}_createClass(px,[{key:"has",value:function has(e){return e in this.refs}},{key:"set",value:function set(e,t){if(!this.has(e)){var i={id:e,value:t,prev:this.tail};this.tail?(this.tail.next=i,this.tail=i):this.head=this.tail=i,this.refs[e]=i,this._length+=1}}},{key:"delete",value:function _delete(e){if(this.has(e)){var _this$refs$e=this.refs[e],t=_this$refs$e.prev,i=_this$refs$e.next;t?t.next=i:this.head=i,i?i.prev=t:this.tail=t,delete this.refs[e],this._length-=1}}},{key:"shift",value:function shift(){var e=this.head;if(e)return this["delete"](e.id),e.value}},{key:"length",get:function get(){return this._length}}]);return px}(),Ja=/*#__PURE__*/function(){function Ja(e){_classCallCheck(this,Ja);this.canvasPool=e,this.id="".concat(Ja.id+=1),this.value=null}_createClass(Ja,[{key:"get",value:function get(){return this.value}},{key:"transformTo",value:function transformTo(){var e=new Ja(this.canvasPool);return e.value=this.value,this.value=null,e}},{key:"allocate",value:function allocate(e){if(this.value)throw new Error("can not call allocate on non empty canvasRef!");var t;if(this.canvasPool.refManager.length<Ja.MaxRefsSize)t=this.canvasPool.pull();else{var o=this.canvasPool.refManager.shift();t=o.value,o.value=null}this.value=t,this.canvasPool.refManager.set(this.id,this);var _t11=t,i=_t11.canvas,r=_t11.context,_t$size=t.size=e,n=_t$size.width,s=_t$size.height;return i.width=n,i.height=s,r.resetTransform(),t}},{key:"clear",value:function clear(){this.canvasPool.refManager["delete"](this.id),this.value&&(this.canvasPool.push(this.value),this.value=null)}},{key:"isEmpty",value:function isEmpty(){return this.value==null}},{key:"isSizeEquals",value:function isSizeEquals(e){return!!this.value&&pi(this.value.size,e)}}]);return Ja}(),el=Ja;el.MaxRefsSize=64,el.id=0;var fd=/*#__PURE__*/function(_lo){_inherits(fd,_lo);var _super35=_createSuper(fd);function fd(e,t,i,r){var _this128;_classCallCheck(this,fd);_this128=_super35.call(this,i);_this128.ratio=1,_this128.cacheSize=fd.initCacheSize,_this128.didCacheSizeUpdated=!1,_this128.projectiveRect=fd.initProjectiveReact,_this128.painter=e,_this128.statistical=r,_this128.canvasPool=t,_this128.canvasRef=new el(t);return _this128}_createClass(fd,[{key:"onSplit",value:function onSplit(){var e;this.canvasRef.clear(),(e=this.statistical)==null||e.recordSplit()}},{key:"onRemoved",value:function onRemoved(){this.canvasRef.clear()}},{key:"updatePaintingInfo",value:function updatePaintingInfo(e,t,i,r){this.projectiveRect=i,this.ratio=e,pi(this.cacheSize,t)||(this.cacheSize=t,this.didCacheSizeUpdated=!0),r&&this.didCacheSizeUpdated&&(this.canvasRef.clear(),this.didCacheSizeUpdated=!1)}},{key:"onGlobalUpdate",value:function onGlobalUpdate(){this.canvasRef.clear()}},{key:"paint",value:function paint(e){var t,i;var r=this.canvasRef.get(),n;if(r){n=r.canvas}else{var _this$canvasRef$alloc=this.canvasRef.allocate(this.cacheSize),s=_this$canvasRef$alloc.context,o=_this$canvasRef$alloc.canvas;this.paintNodes(s,this,mn.GenerateCache),(t=this.statistical)==null||t.recordGenerateCache(),n=o}if(this.canvasRef.isSizeEquals(this.cacheSize))e.drawImage(n,0,0);else{var _this$cacheSize=this.cacheSize,_s22=_this$cacheSize.width,_o13=_this$cacheSize.height;e.drawImage(n,0,0,_s22,_o13)}(i=this.statistical)==null||i.recordPaintCache()}},{key:"onBeforeFuse",value:function onBeforeFuse(e,t){var i;if(!this.canvasRef.isEmpty()||this.hasAnyCache(e)||this.hasAnyCache(t)){var _r55=[].concat(_toConsumableArray(e),[this],_toConsumableArray(t)),n=_r55[0],s=_r55.slice(1),o,a=null;n.canvasRef.isSizeEquals(this.cacheSize)?o=n.canvasRef.transformTo():(o=new el(this.canvasPool),a=n);var l=this.getCanvasRefContext(o);a&&this.mergeChunk(l,a);var _iterator141=_createForOfIteratorHelper(s),_step141;try{for(_iterator141.s();!(_step141=_iterator141.n()).done;){var h=_step141.value;this.mergeChunk(l,h)}}catch(err){_iterator141.e(err)}finally{_iterator141.f()}this.canvasRef.clear(),this.canvasRef=o}(i=this.statistical)==null||i.recordFuse(e.length+1+t.length)}},{key:"getCanvasRefContext",value:function getCanvasRefContext(e){var _e$allocate,_e$get;var t;return e.isEmpty()?(_e$allocate=e.allocate(this.cacheSize),t=_e$allocate.context,_e$allocate):(_e$get=e.get(),t=_e$get.context,_e$get),t}},{key:"hasAnyCache",value:function hasAnyCache(e){var _iterator142=_createForOfIteratorHelper(e),_step142;try{for(_iterator142.s();!(_step142=_iterator142.n()).done;){var t=_step142.value;if(!t.canvasRef.isEmpty())return!0}}catch(err){_iterator142.e(err)}finally{_iterator142.f()}return!1}},{key:"mergeChunk",value:function mergeChunk(e,t){var i,r;if(e.resetTransform(),t.canvasRef.isEmpty()){var n=this.paintNodes(e,t,mn.GenerateCache);(i=this.statistical)==null||i.recordPaintCache(n)}else{var _t$canvasRef$get=t.canvasRef.get(),_n33=_t$canvasRef$get.canvas;if(t.canvasRef.isSizeEquals(this.cacheSize))e.drawImage(_n33,0,0);else{var _this$cacheSize2=this.cacheSize,s=_this$cacheSize2.width,o=_this$cacheSize2.height;e.drawImage(_n33,0,0,s,o)}(r=this.statistical)==null||r.recordFuseCache()}}},{key:"paintNodes",value:function paintNodes(e,t,i){var r;var n=0;var _iterator143=_createForOfIteratorHelper(t),_step143;try{for(_iterator143.s();!(_step143=_iterator143.n()).done;){var s=_step143.value;e.resetTransform(),e.scale(this.ratio,this.ratio),(r=this.painter(s.id))==null||r.paint(e,i,this.projectiveRect),n+=1}}catch(err){_iterator143.e(err)}finally{_iterator143.f()}return n}}]);return fd}(lo),gd=fd;gd.initCacheSize=Object.freeze({width:1,height:1}),gd.initProjectiveReact=Object.freeze({originX:0,originY:0,width:1,height:1});var mx=/*#__PURE__*/function(_cx){_inherits(mx,_cx);var _super36=_createSuper(mx);function mx(e,t,i,r){var _this129;_classCallCheck(this,mx);_this129=_super36.call(this,t);_this129.canvasPool=i,_this129.chunkContext=new dx(function(n){return new gd(e,i,n,r)});return _this129}_createClass(mx,[{key:"create",value:function create(e){return new fx(e)}}]);return mx}(cx),fx=/*#__PURE__*/function(_uy){_inherits(fx,_uy);var _super37=_createSuper(fx);function fx(e){var _this130;_classCallCheck(this,fx);_this130=_super37.call(this,e);_this130._protoProjectiveRect=_this130.projectiveRect,_this130.cacheSize=Object.freeze({width:e.projectiveRect.width,height:e.projectiveRect.height});return _this130}_createClass(fx,[{key:"protoProjectiveRect",get:function get(){return this._protoProjectiveRect}},{key:"updateProjectiveRect",value:function updateProjectiveRect(e,t,i){var r=Math.ceil(e.originX*t),n=Math.ceil(e.originY*t),s=Math.ceil((e.originX+e.width)*t),o=Math.ceil((e.originY+e.height)*t),a=s-r,l=o-n,h={originX:r/t,originY:n/t,width:a/t,height:l/t};_get(_getPrototypeOf(fx.prototype),"updateProjectiveRect",this).call(this,h,t,i),this._protoProjectiveRect=Object.freeze(V({},e)),this.cacheSize=Object.freeze({width:a,height:l}),this.updatePaintingInfo(this.ratio,this.cacheSize,this.projectiveRect,i)}},{key:"updateRatioAndRefresh",value:function updateRatioAndRefresh(e,t){_get(_getPrototypeOf(fx.prototype),"updateProjectiveRect",this).call(this,this.projectiveRect,e,t),this.updatePaintingInfo(this.ratio,this.cacheSize,this.projectiveRect,t)}},{key:"updatePaintingInfo",value:function updatePaintingInfo(e,t,i,r){var _iterator144=_createForOfIteratorHelper(this),_step144;try{for(_iterator144.s();!(_step144=_iterator144.n()).done;){var n=_step144.value;n.updatePaintingInfo(e,t,i,r)}}catch(err){_iterator144.e(err)}finally{_iterator144.f()}}},{key:"notifyGlobalUpdate",value:function notifyGlobalUpdate(){var _iterator145=_createForOfIteratorHelper(this),_step145;try{for(_iterator145.s();!(_step145=_iterator145.n()).done;){var e=_step145.value;e.onGlobalUpdate()}}catch(err){_iterator145.e(err)}finally{_iterator145.f()}}},{key:"paint",value:function paint(e,t,i){var r=i||this[Symbol.iterator](),n,s=null;for(;n=r.next(),!n.done;){var o=n.value;if(t(o)){s=o;break}o.paint(e)}return{iterator:r,floatChunk:s}}}]);return fx}(uy),Or;(function(e){e[e.None=0]="None",e[e.CoverByTop=1]="CoverByTop",e[e.Repaint=2]="Repaint"})(Or||(Or={}));var ho;(function(e){e[e.None=0]="None",e[e.All=1]="All",e[e.Part=2]="Part"})(ho||(ho={}));function gx(){return new vx}var yx=/*#__PURE__*/function(){function yx(){_classCallCheck(this,yx);this.dirties=[]}_createClass(yx,[{key:"createDirty",value:function createDirty(){var _this131=this;var e=new yd(function(){var t=_this131.dirties.indexOf(e);t!==-1&&_this131.dirties.splice(t,1)});return this.dirties.push(e),e}},{key:"canBeMoreDirty",get:function get(){var e=!1;var _iterator146=_createForOfIteratorHelper(this.dirties),_step146;try{for(_iterator146.s();!(_step146=_iterator146.n()).done;){var t=_step146.value;if(t.canBeMoreDirty){e=!0;break}}}catch(err){_iterator146.e(err)}finally{_iterator146.f()}return e}},{key:"dirtyAll",value:function dirtyAll(){var _iterator147=_createForOfIteratorHelper(this.dirties),_step147;try{for(_iterator147.s();!(_step147=_iterator147.n()).done;){var e=_step147.value;e.dirtyAll()}}catch(err){_iterator147.e(err)}finally{_iterator147.f()}}},{key:"createDirtyCellsCollection",value:function createDirtyCellsCollection(){var _this132=this;return new py(null,function(e,t){var _iterator148=_createForOfIteratorHelper(_this132.dirties),_step148;try{for(_iterator148.s();!(_step148=_iterator148.n()).done;){var i=_step148.value;i.dirtyCells(e,t)}}catch(err){_iterator148.e(err)}finally{_iterator148.f()}})}}]);return yx}(),py=/*#__PURE__*/function(){function py(e,t){_classCallCheck(this,py);this.cells={},this.subCells={},this.parent=e,this.onCollectedCells=t}_createClass(py,[{key:"createSub",value:function createSub(){return new py(this,null)}},{key:"collect",value:function collect(e,t){var i=yd.key(e,t);i in this.cells||(this.cells[i]={row:e,column:t,level:0})}},{key:"complete",value:function complete(e){var t;var i=this.putLevelAndCollectMaxLevel(e);this.assignSubCells(),this.parent&&this.reportToParent(this.parent),(t=this.onCollectedCells)==null||t.call(this,i,this.cells)}},{key:"putLevelAndCollectMaxLevel",value:function putLevelAndCollectMaxLevel(e){var t=0;for(var i in this.cells){var _r56=this.cells[i].level;this.cells[i].level=Math.max(_r56,e),t=Math.max(t,e)}return Math.max(t,e)}},{key:"assignSubCells",value:function assignSubCells(){for(var e in this.subCells){if(e in this.cells){var t=this.cells[e].level;this.cells[e].level=Math.max(t,this.subCells[e].level)}else this.cells[e]=this.subCells[e]}}},{key:"reportToParent",value:function reportToParent(_ref48){var e=_ref48.subCells;for(var t in this.cells){var i=e[t],_r57=this.cells[t];i&&i.level>_r57.level&&(_r57=i),e[t]=_r57}}}]);return py}(),yd=/*#__PURE__*/function(){function yd(e){_classCallCheck(this,yd);this.phase=1,this.cells=null,this.release=e}_createClass(yd,[{key:"canBeMoreDirty",get:function get(){return this.phase!==1}},{key:"takeDirtyState",value:function takeDirtyState(){var e=new bx(this.phase,this.cells);return this.phase=0,this.cells=null,e}},{key:"dirtyAll",value:function dirtyAll(){this.phase=1,this.cells=null}},{key:"dirtyCells",value:function dirtyCells(e,t){this.phase!==1&&(e>=2&&(this.phase=2),this.cells?Object.assign(this.cells,t):this.cells=V({},t))}}],[{key:"key",value:function key(e,t){return"".concat(e,",").concat(t)}}]);return yd}(),bx=/*#__PURE__*/function(){function bx(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_classCallCheck(this,bx);this.cells=null,this.phase=e,this.cells=t}_createClass(bx,[{key:"isDirty",value:function isDirty(e,t){switch(this.phase){case 2:if(this.cells){var i=yd.key(e,t),_r58=this.cells[i];return _r58?_r58.level>=2:!1}else return!1;case 1:return!0;default:return!1;}}},{key:"forEachDirtyBuckets",value:function forEachDirtyBuckets(e,t,i){switch(this.phase){case 1:{e.forEachBuckets(i);break}case 2:{if(this.cells)for(var _r59 in this.cells){var _this$cells$_r=this.cells[_r59],n=_this$cells$_r.row,s=_this$cells$_r.column,o=_this$cells$_r.level;if(o>=t){var a=e.bucket(n,s);a&&i(a,n,s)}}break}}}}]);return bx}(),vx=/*#__PURE__*/function(){function vx(){_classCallCheck(this,vx);this.phase=1}_createClass(vx,[{key:"isDirty",value:function isDirty(){return!0}},{key:"forEachDirtyBuckets",value:function forEachDirtyBuckets(e,t,i){e.forEachBuckets(i)}}]);return vx}(),my=/*#__PURE__*/function(){function my(e){var _this133=this;_classCallCheck(this,my);this.paintableBucketsQueue=[],this.isFloatChunk=function(t){return t.id in _this133.chunkToFloatMap},this.grid=e.grid,this.cleanBucketsBackground=e.cleanBucketsBackground,this.dirtyState=e.dirtyState,this.floatLeafPainter=e.floatLeafPainter,this.paintBucket=e.bucketPainter,this.chunkToFloatMap=e.floatNodesInfo.chunkToFloatMap,this.pendingByFloats=e.floatNodesInfo.pendingByFloats}_createClass(my,[{key:"collectBuckets",value:function collectBuckets(){var _this134=this;this.dirtyState.forEachDirtyBuckets(this.grid,Or.CoverByTop,function(e,t,i){_this134.startToPaintBucket({bucket:e,row:t,column:i},_this134.cleanBucketsBackground)})}},{key:"runLoopToPaintAll",value:function runLoopToPaintAll(){var e=!1;for(;this.paintableBucketsQueue.length>0;){this.startToPaintBucket(this.paintableBucketsQueue.pop(),e)}gt(this.pendingByFloats)&&this.printPendingFloatNodesWarn()}},{key:"printPendingFloatNodesWarn",value:function printPendingFloatNodesWarn(){console.warn("found pending float nodes were never paint");for(var e in this.pendingByFloats){var _this$pendingByFloats=this.pendingByFloats[e],t=_this$pendingByFloats.untouched,i=_this$pendingByFloats.pending,_r60=Object.keys(t).join(", "),n=Object.keys(i).join(", ");console.warn("float ".concat(e," is waiting ").concat(_r60," to touch, and is padding buckets ").concat(n))}}},{key:"startToPaintBucket",value:function startToPaintBucket(e,t){var i=e.bucket,r=e.row,n=e.column,s=e.iterator,_this$paintBucket=this.paintBucket(i,r,n,this.isFloatChunk,t,s),o=_this$paintBucket.iterator,a=_this$paintBucket.floatChunk;if(a){var l=this.pendingByFloatInfo(a);if(l){var h=l.untouched,d=l.pending,u=a.getSampleNode();delete h[i.id],d[i.id]={bucket:i,row:r,column:n,iterator:o},gt(h)||this.startToPaintFloatNode(u,d)}}}},{key:"pendingByFloatInfo",value:function pendingByFloatInfo(e){var t=this.chunkToFloatMap[e.id];return t?t.info:null}},{key:"startToPaintFloatNode",value:function startToPaintFloatNode(e,t){this.floatLeafPainter(e.related),delete this.pendingByFloats[e.id];for(var i in t){var _r61=t[i];this.paintableBucketsQueue.unshift(_r61)}}}],[{key:"paintBuckets",value:function paintBuckets(e){var t=new my(e);t.collectBuckets(),t.runLoopToPaintAll()}}]);return my}();function Sx(e){return new wx(e).search()}var wx=/*#__PURE__*/function(){function wx(e){_classCallCheck(this,wx);this.chunkContext=e.chunkContext,this.grid=e.grid,this.visions=e.visions,this.dirtyCells=e.dirtyCells}_createClass(wx,[{key:"search",value:function search(){var _this135=this;var e={},t={},i={};return this.chunkContext.forEachCandidateFloatNodes(function(r){var n;var s=r,o=(n=_this135.dirtyCells)==null?void 0:n.createSub(),a=_this135.searchCoverBuckets(s,o);if(a){var l=a.buckets,h=a.range,d={},u=!0,p=!0,f=null;for(var m in l){var g=l[m].findChunk(s);if(g&&g.isFloat)f||(f={leaf:s,info:{untouched:l,pending:{}}}),g.nextChunk&&(p=!1),d[g.id]=f;else{u=!1;break}}u&&f&&(Object.assign(e,d),t[s.id]=f.info,p?i[s.id]={leaf:s,range:h,dirtyCells:o}:o==null||o.complete(Or.Repaint))}}),{chunkToFloatMap:e,pendingByFloats:t,topFloatNodes:i}}},{key:"searchCoverBuckets",value:function searchCoverBuckets(e,t){var _this136=this;var i=this.visions.visions(e.id);if(!i)return null;var r=this.visionSceneRect(i),n=ze.rectToRange(r,this.grid.unitSize),s=ze.calcIntersection(n,this.grid.range);if(!s)return null;var o={};return s.forEach(function(a,l){var h=_this136.grid.bucket(a,l);h&&(o[h.id]=h),t==null||t.collect(a,l)}),gt(o)?{range:s,buckets:o}:null}},{key:"visionSceneRect",value:function visionSceneRect(e){var t=e[0].sceneRect,i=e[1];if(i){var _r62=i.sceneRect,n=Math.min(t.originX,_r62.originX),s=Math.min(t.originY,_r62.originY),o=Math.max(t.originX+t.width,_r62.originX+_r62.width),a=Math.max(t.originY+t.height,_r62.originY+_r62.height);t={originX:n,originY:s,width:o-n,height:a-s}}return t}}]);return wx}(),bd=/*#__PURE__*/function(){function bd(e){var _this137=this;_classCallCheck(this,bd);this.painters={},this.canvasPool=new ux,this.floatCanvasSize=null,this.nextFloatNodesInfo=null,this.topFloatRangeSet={},this.toScreenPoint=function(t,i,r){var n=i*r.width,s=t*r.height,o=(n-_this137.camera.centerX)*_this137.camera.scale+_this137.screenSize.width/2,a=(s-_this137.camera.centerY)*_this137.camera.scale+_this137.screenSize.height/2;return{x:o,y:a}},this.onLeafNodeVisible=function(t){var i=t.value,r=_this137.getRenderConstructor(i.definition);if(r)try{var n=new r(i,_this137.context),s=new ix(_this137.screen,_this137.visions,t,_this137.fixedSize,n,_this137.onRepaint);_this137.painters[t.id]=s}catch(n){console.error(n)}},this.onLeafNodeInvisible=function(t){var i=_this137.painters[t.id];i&&(delete _this137.painters[t.id],i.remove())},this.fixedSize=e.fixedSize,this.willPrintGrid=!!e.willPrintGrid,this.onRepaint=e.onRepaint,this.getRenderConstructor=e.getRenderConstructor,this.screen=e.screen,this.dirtyNotify=e.dirtyNotify,this.visions=e.visions,this.camera=this.screen.camera,this.screenSize=Object.freeze({width:this.screen.width,height:this.screen.height}),this.context=e.context,this.statistical=e.statistical,this.visionRectangle=this.createVisionRectangle(this.camera,this.screenSize),this.bucketFactory=new mx(function(t){return _this137.painters[t]},this.visions,this.canvasPool,this.statistical),this.grid=new ay({tree:e.tree,ratio:e.ratio,visions:e.visions,bucketFactory:this.bucketFactory,visionRectangle:this.visionRectangle,scale:this.camera.scale,rate:e.rate,bucketUnitSize:e.bucketUnitSize,favorBucketsCount:e.favorBucketsCount,toScreenPoint:this.toScreenPoint,onLeafNodeVisible:this.onLeafNodeVisible,onLeafNodeInvisible:this.onLeafNodeInvisible});var _iterator149=_createForOfIteratorHelper(e.tree),_step149;try{for(_iterator149.s();!(_step149=_iterator149.n()).done;){var t=_step149.value;this.onLeafNodeVisible(t)}}catch(err){_iterator149.e(err)}finally{_iterator149.f()}}_createClass(bd,[{key:"dispose",value:function dispose(){this.canvasPool.clear()}},{key:"update",value:function update(e){var t;var i=!1,r=!1,n;if(e.context){for(var a in this.painters){this.painters[a].updateContext(e.context)}this.context=e.context,i=!0}e.camera&&(this.camera=e.camera,r=!0),e.screenSize&&(this.screenSize=e.screenSize,r=!0);for(var _a13 in e.updateSet){(t=this.painters[_a13])==null||t.refreshPayload()}r&&(this.visionRectangle=n=this.createVisionRectangle(this.camera,this.screenSize));var s;i||r?this.dirtyNotify.dirtyAll():this.dirtyNotify.canBeMoreDirty&&(s=this.dirtyNotify.createDirtyCellsCollection());var o=this.grid.update({shouldUpdateAll:i,dirtyCells:s,visionRectangle:n,scale:this.camera.scale,ratio:e.ratio,diff:e.diff,updateSet:e.updateSet,moveSet:e.moveSet,refresh:e.refresh});e.floatCanvasSize&&(this.floatCanvasSize=e.floatCanvasSize),this.nextFloatNodesInfo=this.searchFloatNodes({dirtyCells:s,visions:this.visions,grid:this.grid,chunkContext:this.bucketFactory.chunkContext}),s&&(this.dirtyTouchedBuckets(s,this.nextFloatNodesInfo,o),s.complete(Or.Repaint))}},{key:"dirtyTouchedBuckets",value:function dirtyTouchedBuckets(e,_ref49,i){var t=_ref49.topFloatNodes;if(t){var _r63=t.leaves;var _iterator150=_createForOfIteratorHelper(i),_step150;try{for(_iterator150.s();!(_step150=_iterator150.n()).done;){var _step150$value=_step150.value,n=_step150$value.row,s=_step150$value.column,o=_step150$value.touchedLeaves;bd.isAllKeysBelongTo(o,_r63)||e.collect(n,s)}}catch(err){_iterator150.e(err)}finally{_iterator150.f()}}else{var _iterator151=_createForOfIteratorHelper(i),_step151;try{for(_iterator151.s();!(_step151=_iterator151.n()).done;){var _step151$value=_step151.value,_r64=_step151$value.row,_n34=_step151$value.column;e.collect(_r64,_n34)}}catch(err){_iterator151.e(err)}finally{_iterator151.f()}}}},{key:"createVisionRectangle",value:function createVisionRectangle(e,t){var i,r,n,s;return e.scale===0?(i=0,r=0,n=0,s=0):(n=t.width/e.scale,s=t.height/e.scale,i=e.centerX-n/2,r=e.centerY-s/2),Object.freeze({originX:i,originY:r,width:n,height:s})}},{key:"paintTopFloatAndGetOrigin",value:function paintTopFloatAndGetOrigin(e,t,i){var r;var _this$getPaintFloatNo=this.getPaintFloatNodesInfo(),n=_this$getPaintFloatNo.topFloatNodes,s=null;if(n){var o=n.zone,a=n.leaves;s={x:o.originX,y:o.originY},t.resetTransform(),t.clearRect(0,0,e.width,e.height);for(var l in a){var h=this.painters[l];h&&(t.resetTransform(),t.scale(i,i),t.translate(-s.x,-s.y),h.paint(t,mn.Directly),(r=this.statistical)==null||r.recordPaintFloat())}}return s}},{key:"paintBackground",value:function paintBackground(_ref50){var _this138=this;var e=_ref50.context,t=_ref50.ratio,i=_ref50.refresh,r=_ref50.cleanBucketsBackground,n=_ref50.dirtyState;var s,o;var a=this.getPaintFloatNodesInfo(),l=(o=(s=a.topFloatNodes)==null?void 0:s.leaves)!=null?o:bd.voidLeaves;my.paintBuckets({grid:this.grid,floatNodesInfo:a,dirtyState:n,cleanBucketsBackground:r,floatLeafPainter:function floatLeafPainter(_ref51){var h=_ref51.id;var d;var u=_this138.painters[h];u&&!l[h]&&(e.resetTransform(),e.scale(t,t),u.paint(e,mn.Directly),(d=_this138.statistical)==null||d.recordPaintFloat())},bucketPainter:function bucketPainter(h,d,u,p,f,m){var g=h.protoProjectiveRect,y=Math.ceil(g.originX*t),b=Math.ceil(g.originY*t),v=Math.ceil((g.originX+g.width)*t),w=Math.ceil((g.originY+g.height)*t),M=v-y,x=w-b;return e.resetTransform(),e.translate(y,b),h.updateRatioAndRefresh(t,i),f&&e.clearRect(0,0,M,x),h.paint(e,p,m)}}),this.willPrintGrid&&(e.resetTransform(),e.scale(t,t),this.paintGrid(e))}},{key:"completePaint",value:function completePaint(){this.nextFloatNodesInfo=null}},{key:"getPaintFloatNodesInfo",value:function getPaintFloatNodesInfo(){var e;return(e=this.nextFloatNodesInfo)!=null?e:this.searchFloatNodes({visions:this.visions,grid:this.grid,chunkContext:this.bucketFactory.chunkContext})}},{key:"paintGrid",value:function paintGrid(e){var _this139=this;var _this$grid=this.grid,t=_this$grid.range,i=_this$grid.unitSize;e.lineWidth=1,e.strokeStyle="rgba(0,0,0,0.5)",e.fillStyle="rgba(0,0,0,0.5)",t.forEach(function(r,n){var _this139$toScreenPoin=_this139.toScreenPoint(r,n,i),s=_this139$toScreenPoin.x,o=_this139$toScreenPoin.y,a=Math.ceil(i.width*_this139.camera.scale),l=Math.ceil(i.height*_this139.camera.scale);e.strokeRect(s,o,a,l),e.fillText("".concat(r,",").concat(n),s+2,o+14)})}},{key:"searchFloatNodes",value:function searchFloatNodes(e){var t=Sx(e),i=null,r=null;if(this.floatCanvasSize){var _this$floatCanvasSize=this.floatCanvasSize,o=_this$floatCanvasSize.width,a=_this$floatCanvasSize.height,l=this.searchBorderRectange(t.topFloatNodes);l&&l.width<=o&&l.height<=a&&(i=l)}var n={},s=e.dirtyCells;if(i){var _o14={};for(var _a14 in t.topFloatNodes){var _l6=Or.CoverByTop,_t$topFloatNodes$_a=t.topFloatNodes[_a14],h=_t$topFloatNodes$_a.leaf,d=_t$topFloatNodes$_a.range,u=_t$topFloatNodes$_a.dirtyCells;_o14[_a14]=h,_a14 in this.topFloatRangeSet?delete this.topFloatRangeSet[_a14]:_l6=Or.Repaint,u==null||u.complete(_l6),n[_a14]=d}r={zone:i,leaves:_o14}}else for(var _o15 in t.topFloatNodes){var _a15=t.topFloatNodes[_o15].dirtyCells;_a15&&_a15.complete(Or.Repaint)}if(s)for(var _o16 in this.topFloatRangeSet){this.topFloatRangeSet[_o16].forEach(function(a,l){s.collect(a,l)})}return this.topFloatRangeSet=n,{topFloatNodes:r,chunkToFloatMap:t.chunkToFloatMap,pendingByFloats:t.pendingByFloats}}},{key:"searchBorderRectange",value:function searchBorderRectange(e){var t=null,i=0,r=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;for(var a in e){var l=this.visions.vision(a);if(l){var h=l.screenRect,d=h.originX,u=h.originX+h.width,p=h.originY,f=h.originY+h.height;r>d&&(r=d),n<u&&(n=u),s>p&&(s=p),o<f&&(o=f),i+=1}}if(i>0){var _a16=32,_l7=Math.floor(r/_a16)*_a16,_h9=Math.floor(s/_a16)*_a16,_d6=Math.ceil(n-_l7),_u5=Math.ceil(o-_h9);t={originX:_l7,originY:_h9,width:_d6,height:_u5}}return t}}],[{key:"isAllKeysBelongTo",value:function isAllKeysBelongTo(e,t){for(var i in e){if(!(i in t))return!1}return!0}}]);return bd}(),fy=bd;fy.voidLeaves={};var Cx=/*#__PURE__*/function(){function Cx(){_classCallCheck(this,Cx);typeof performance=="undefined"?this.fetch=this.fetchByMilliseconds:this.fetch=this.fetchByMicroseconds}_createClass(Cx,[{key:"fetchByMilliseconds",value:function fetchByMilliseconds(){return Date.now()*1e3}},{key:"fetchByMicroseconds",value:function fetchByMicroseconds(){return Math.floor(performance.now()*1e3)}}]);return Cx}(),kx=new Cx;function gy(){return kx.fetch()}var xx=function(){return(typeof window==="undefined"?"undefined":_typeof(window))=="object"?yy["default"].getParser(window.navigator.userAgent).getEngineName()==="WebKit":!1}();function by(){return xx}var uo=/*#__PURE__*/function(){function uo(e){var _this140=this;_classCallCheck(this,uo);this.dirtyNotify=new yx,this.refresh=!0,this.onRepaint=function(r){_this140.screen.scene.reportComponentUpdate(r,_e.PropertiesUpdated)},this.setupAfterCanvasReady=function(){_this140.backgroundCanvas.ratio!==1&&_this140.update({isTransition:!1,diff:ly(),updateSet:{},moveSet:{}}),_this140.paint()},this.renderMode=e.renderMode,this.engine=e.engine,this.screen=e.screen,this.onRenderDuration=e.onRenderDuration,this.statistical=e.willPrintStatistical?new Jk:void 0,this.className=e.className,this.style=Object.freeze(je(V({},e.style),{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:this.engine.orderIndex}));var t=sy;by()&&(t=Zk);var i=new Px(this.setupAfterCanvasReady);this.floatCanvas=t(this.createFloatSize(this.screen),void 0,i.createUnlockCall()),this.floatCanvas.visibility=!1,this.backgroundCanvas=sy({width:this.screen.width,height:this.screen.height},this.dirtyNotify,i.createUnlockCall()),this.painter=new fy({ratio:1,tree:e.tree,fixedSize:e.fixedSize,screen:e.screen,visions:e.visions,context:this.screen.context,statistical:this.statistical,dirtyNotify:this.dirtyNotify,getRenderConstructor:e.getRenderConstructor,onRepaint:this.onRepaint,rate:2,favorBucketsCount:12,bucketUnitSize:Object.freeze({width:256,height:256})})}_createClass(uo,[{key:"willInterruptEvent",value:function willInterruptEvent(){return!1}},{key:"findComponentWithTarget",value:function findComponentWithTarget(){}},{key:"update",value:function update(e){var t,i;var r=gy(),n;switch(e.screenSize&&(n=this.createFloatSize(e.screenSize),this.backgroundCanvas.size=e.screenSize,this.floatCanvas.size=n),this.renderMode){case mo.HighQuality:{this.refresh=!0;break}case mo.PerformanceWhileTransition:{this.refresh=!e.isTransition;break}}this.painter.update({context:e.context,camera:e.camera,screenSize:e.screenSize,floatCanvasSize:n,diff:e.diff,ratio:this.backgroundCanvas.ratio,updateSet:e.updateSet,moveSet:e.moveSet,refresh:this.refresh}),this.backgroundCanvas.hasNextCanvasNode?(this.paint(),(t=this.statistical)==null||t.print(),this.onRenderDuration&&this.onRenderDuration(gy()-r)):(i=this.statistical)==null||i.clear()}},{key:"painToCanvas",value:function painToCanvas(e,t,i,r){this.painter.update({camera:t,screenSize:i,ratio:r,refresh:!0,diff:ly(),updateSet:{},moveSet:{}}),this.painter.paintBackground({context:e,ratio:r,refresh:this.refresh,dirtyState:gx(),cleanBucketsBackground:!0})}},{key:"paint",value:function paint(){var _this141=this;var e=null,t=!1,i=this.floatCanvas.nextCanvasNode(),r=this.backgroundCanvas.nextCanvasNode();if(i){var n=this.floatCanvas.get2DContext(i);n.resetTransform(),e=this.painter.paintTopFloatAndGetOrigin(i.canvas,n,this.floatCanvas.ratio)}if(r){var _n35=r.dirty.takeDirtyState();if(_n35.phase!==ho.None){var s=this.backgroundCanvas.get2DContext(r),o=_n35.phase===ho.Part;if(s.resetTransform(),_n35.phase===ho.All){var _r$canvas=r.canvas,a=_r$canvas.width,l=_r$canvas.height;s.clearRect(0,0,a,l)}this.painter.paintBackground({context:s,ratio:this.backgroundCanvas.ratio,refresh:this.refresh,dirtyState:_n35,cleanBucketsBackground:o}),t=!0}}this.painter.completePaint(),(!i||!r)&&console.warn("cannot find canvas"),(i||r)&&Promise.resolve().then(function(){return _this141.doAfterPaint(e,i,t)})["catch"](function(n){return console.error(n)})}},{key:"doAfterPaint",value:function doAfterPaint(e,t,i){if(e&&t){var _r65=e.x,n=e.y;this.floatCanvas.visibility=!0,t.canvas.style.transform="translate(".concat(_r65,"px, ").concat(n,"px)"),this.floatCanvas.updateToNextBuffering()}else this.floatCanvas.visibility=!1;i&&this.backgroundCanvas.updateToNextBuffering()}},{key:"dispose",value:function dispose(){this.painter.dispose()}},{key:"createFloatSize",value:function createFloatSize(e){if(by())return uo.floatCanvasMaxSize;var t=uo.floatCanvasMaxSize,i=e.width*uo.floatCanvasRate,r=e.height*uo.floatCanvasRate;return i>t.width&&(i=t.width),r>t.height&&(r=t.height),i=Math.floor(i),r=Math.floor(r),{width:i,height:r}}},{key:"getRender",value:function getRender(){var e=this,t=this.backgroundCanvas.getRender(),i=this.floatCanvas.getRender();var r=/*#__PURE__*/function(_Ar$Component){_inherits(r,_Ar$Component);var _super38=_createSuper(r);function r(s){_classCallCheck(this,r);return _super38.call(this,s)}_createClass(r,[{key:"componentWillUnmount",value:function componentWillUnmount(){e.dispose()}},{key:"render",value:function render(){return(0,Ar.createElement)(Ar.Fragment,null,(0,Ar.createElement)(t,{className:e.className,style:e.style}),(0,Ar.createElement)(i,{className:e.className,style:e.style}))}}]);return r}(Ar.Component);return r}}]);return uo}(),vd=uo;vd.floatCanvasRate=.25,vd.floatCanvasMaxSize=Object.freeze({width:340,height:240});var Px=/*#__PURE__*/function(){function Px(e){_classCallCheck(this,Px);this.onUnlock=e,this.didUnLock=!1,this.unlockCount=0,this.lockCount=0}_createClass(Px,[{key:"createUnlockCall",value:function createUnlockCall(){var _this142=this;return this.lockCount+=1,function(){_this142.unlockCount+=1,!_this142.didUnLock&&_this142.unlockCount===_this142.lockCount&&(_this142.didUnLock=!0,setTimeout(_this142.onUnlock,0))}}}]);return Px}();function tr(e,t){return e===void 0?t:e}function po(e,t){return typeof e=="number"?e:t}var mo;(function(e){e[e.HighQuality=0]="HighQuality",e[e.PerformanceWhileTransition=1]="PerformanceWhileTransition"})(mo||(mo={}));var vy=/*#__PURE__*/function(_so){_inherits(vy,_so);var _super39=_createSuper(vy);function vy(e){var _this143;_classCallCheck(this,vy);_this143=_super39.call(this,e.orderIndex);_this143.constructors={},_this143.getRenderConstructor=function(t){return _this143.constructors[t.id]},_this143.fixedSize=e.fixedSize,_this143.renderMode=tr(e.renderMode,0);return _this143}_createClass(vy,[{key:"bind",value:function bind(e,t){if(!(e instanceof hs))throw new Error("it is not ComponentDefinition");if(this.constructors[e.id])throw new Error("define duplicated ComponentDefinition");this.constructors[e.id]=t,e.addEngine(this,{isVisible:t.isVisible}),this.addDefinition(e)}},{key:"createRenderLayout",value:function createRenderLayout(e){return new vd({engine:this,screen:e.screen,tree:e.tree,visions:e.visions,fixedSize:this.fixedSize,renderMode:this.renderMode,getRenderConstructor:this.getRenderConstructor,onRenderDuration:e.onRenderDuration})}}]);return vy}(so);function Sy(e){return new vy(e)}function Ix(e){return e instanceof vy}var Mx=/*#__PURE__*/function(){function Mx(e){var _this144=this;_classCallCheck(this,Mx);this.setCNodeElement=function(t,i){var r=t.treeNode.id,n=_this144.shadowList.node(r);n&&(n.value=i)},this.engine=e.engine,this.renderComponent=e.renderComponent,this.screen=e.screen,this.fixedSize=e.fixedSize,this.className=e.className,this.style=e.style,this.visions=e.visions,this.leafFilter=e.leafFilter,this.mode=e.mode,this.camera=e.initCamera||this.screen.camera,this.context=this.screen.context,this.screenSize=Object.freeze({width:this.screen.width,height:this.screen.height}),this.shadowList=hn.create({tree:e.tree,valueInitializer:function valueInitializer(){return null},initLeafFilter:function initLeafFilter(t){return _this144.visions.includes(t.id)&&e.leafFilter(t)}})}_createClass(Mx,[{key:"painToCanvas",value:function painToCanvas(){}},{key:"willInterruptEvent",value:function willInterruptEvent(e,t,i){var r=this.findComponentWithTarget(i);if(r){var n=this.engine.getDefinitionNode(r.definition);if(n)return n.willInterruptEvent(e,r,t)}return!1}},{key:"findComponentWithTarget",value:function findComponentWithTarget(e){var t=this.shadowList.findNode(function(i){var r=i.value;return!!(r&&(e===r||r.contains(e)))});if(t){var i=t.related;if(i.value)return i.value}}},{key:"update",value:function update(e){var t=this.shadowList.appendDiff(e.diff),i=!1;e.camera&&(this.camera=e.camera,i=!0),e.screenSize&&(this.screenSize=e.screenSize,i=!0),e.context&&(this.context=e.context,i=!0),(gt(e.updateSet)||gt(e.moveSet)||t.addedNodes.length>0||t.removedNodes.length>0||t.sortedNodes.length>0)&&(i=!0),this.setState&&i&&this.setState(this.getRenderLayoutState())}},{key:"getRender",value:function getRender(){var e={self:this},t=this.renderComponent;var i=/*#__PURE__*/function(_tl$Component){_inherits(i,_tl$Component);var _super40=_createSuper(i);function i(n){var _this145;_classCallCheck(this,i);_this145=_super40.call(this,n);_this145.state=e.self.getRenderLayoutState(),e.self.setState=function(s){return _this145.setState(s)};return _this145}_createClass(i,[{key:"componentWillUnmount",value:function componentWillUnmount(){this.setState({context:null}),e.self.setState=void 0,e.self=null}},{key:"render",value:function render(){var _this$state3=this.state,n=_this$state3.camera,s=_this$state3.screenSize,o=_this$state3.context,a=e.self;return(0,tl.createElement)(t,{engine:a.engine,screen:a.screen,mode:a.mode,visions:a.visions,leafFilter:a.leafFilter,camera:n,screenSize:s,context:o,fixedSize:a.fixedSize,className:a.className,style:a.style,onCNodeRef:a.setCNodeElement})}}]);return i}(tl.Component);return i}},{key:"getRenderLayoutState",value:function getRenderLayoutState(){return{camera:this.camera,screenSize:this.screenSize,context:this.context}}}]);return Mx}(),Tx=/*#__PURE__*/function(_un$Component){_inherits(Tx,_un$Component);var _super41=_createSuper(Tx);function Tx(){var _this146;_classCallCheck(this,Tx);_this146=_super41.apply(this,arguments);_this146.onRef=function(e){var _this146$props=_this146.props,t=_this146$props.onRef,i=_this146$props.context;t&&t(e);var r=i;r&&r.onRef(r.component,e)};return _this146}_createClass(Tx,[{key:"render",value:function render(){var _this$props3=this.props,e=_this$props3.context,t=_this$props3.children,i=_this$props3.fixedMode,r=_this$props3.style,n=e;if(n){var s=n.vision,o=n.component,a=n.margin,_s$screenRect=s.screenRect,l=_s$screenRect.originX,h=_s$screenRect.originY,d="absolute";if(i){var m=n.screen.bounding;l+=m.left,h+=m.top,d="fixed"}var u="translate(".concat(l,"px,").concat(h,"px) scale(").concat(n.scale,",").concat(n.scale,")"),p=V({WebkitTransform:u,transform:u,WebkitTransformOrigin:"0px 0px 0px",transformOrigin:"0px 0px 0px",position:d,overflow:"visible",width:n.size.width+n.margin.left+n.margin.right,height:n.size.height+n.margin.top+n.margin.bottom,margin:0,paddingLeft:a.left,paddingRight:a.right,paddingTop:a.top,paddingBottom:a.bottom,zIndex:o.orderIndex},r),f=V({},this.props);return delete f.context,delete f.fixedMode,delete f.onRef,(0,un.createElement)("div",je(V({},f),{style:p,ref:this.onRef}),t)}else return(0,un.createElement)(un.Fragment,null,t)}}]);return Tx}(un.Component),Oi=Tx,Ex=/*#__PURE__*/function(_dn$Component){_inherits(Ex,_dn$Component);var _super42=_createSuper(Ex);function Ex(){_classCallCheck(this,Ex);return _super42.apply(this,arguments)}_createClass(Ex,[{key:"getPreviewURL",value:function getPreviewURL(e){var t=this.props.mode;if(t===Er.Preview)return e.previewURL}},{key:"getPositionInfo",value:function getPositionInfo(e,t,i){var r=this.props.fixedSize,n,s,o;e.absoluteCoordinates?o=1:o=i,r?(s={left:t.margin.left/o,right:t.margin.right/o,top:t.margin.top/o,bottom:t.margin.bottom/o},n={width:e.width,height:e.height}):(s=t.margin,n={width:t.screenRect.width-s.left-s.right,height:t.screenRect.height-s.top-s.bottom});var a={x:t.screenRect.originX,y:t.screenRect.originY};return{margin:s,size:n,origin:a,cnodeScale:o}}},{key:"renderPreview",value:function renderPreview(e,t,i,r){var _this$props4=this.props,n=_this$props4.screen,s=_this$props4.onCNodeRef,_this$getPositionInfo=this.getPositionInfo(e,t,r),o=_this$getPositionInfo.margin,a=_this$getPositionInfo.size,l=_this$getPositionInfo.cnodeScale,h={vision:t,component:e,screen:n,onRef:s,margin:o,size:a,scale:l};return(0,dn.createElement)(Oi,{key:e.id,context:h},(0,dn.createElement)("img",{src:i,alt:"",width:a.width,height:a.height}))}},{key:"renderLeafNode",value:function renderLeafNode(e,t,i,r){var n=e.definition,_this$props5=this.props,s=_this$props5.engine,o=_this$props5.context,a=_this$props5.screen,l=_this$props5.onCNodeRef,h=s.getDefinitionNode(n);if(h){var _this$getPositionInfo2=this.getPositionInfo(e,t,r),d=_this$getPositionInfo2.margin,u=_this$getPositionInfo2.size,p=_this$getPositionInfo2.origin,f=_this$getPositionInfo2.cnodeScale,m=h.render,g={vision:t,component:e,margin:d,size:u,scale:f,screen:a,onRef:l};return(0,dn.createElement)(m,{key:e.id,id:e.id,cnode:g,screen:a,payload:e.payload,context:o,size:u,origin:p,margin:d,scale:i,layout:s.orderIndex})}else return null}},{key:"render",value:function render(){var _this147=this;var e=[],_this$props6=this.props,t=_this$props6.visions,i=_this$props6.leafFilter,r=_this$props6.style,n=_this$props6.className,s=_this$props6.engine,o=_this$props6.fixedSize;return t.forEach(function(a,l){if(i(a)){var h=a.value,d=_this147.getPreviewURL(h),u=o?l.scale:1;if(d)e.push(_this147.renderPreview(h,l,d,u));else{var p=o?1:l.scale,f=_this147.renderLeafNode(h,l,p,u);e.push(f)}}}),(0,dn.createElement)("div",{className:n,style:je(V({},r),{width:"100%",height:"100%",position:"absolute",overflow:"hidden",zIndex:s.orderIndex})},e)}}]);return Ex}(dn.Component),Ax=/*#__PURE__*/function(_ir$Component){_inherits(Ax,_ir$Component);var _super43=_createSuper(Ax);function Ax(){_classCallCheck(this,Ax);return _super43.apply(this,arguments)}_createClass(Ax,[{key:"shouldComponentUpdate",value:function shouldComponentUpdate(e){var _this$props7=this.props,t=_this$props7.origin,i=_this$props7.size,r=_this$props7.zIndex,n=_this$props7.margin,s=_this$props7.payload,o=_this$props7.context;return t.x!==e.origin.x||t.y!==e.origin.y||i.width!==e.size.width||i.height!==e.size.height||r!==e.zIndex||n.left!==e.margin.left||n.right!==e.margin.right||n.top!==e.margin.top||n.bottom!==e.margin.bottom||s!==e.payload||o!==e.context}},{key:"render",value:function render(){var _this$props8=this.props,e=_this$props8.render,t=_this$props8.screen,i=_this$props8.engine,r=_this$props8.component,n=_this$props8.context,s=_this$props8.origin,o=_this$props8.zIndex,a=_this$props8.size,l=_this$props8.margin,h=_this$props8.payload,d="translate(".concat(s.x,"px,").concat(s.y,"px)");return(0,ir.createElement)("g",{style:{transform:d,zIndex:o,WebkitTransform:d}},(0,ir.createElement)(e,{id:r.id,screen:t,payload:h,context:n,size:a,origin:s,margin:l,scale:1,layout:i.orderIndex}))}}]);return Ax}(ir.Component),Ox=/*#__PURE__*/function(_ir$Component2){_inherits(Ox,_ir$Component2);var _super44=_createSuper(Ox);function Ox(){_classCallCheck(this,Ox);return _super44.apply(this,arguments)}_createClass(Ox,[{key:"getPreviewURL",value:function getPreviewURL(e){var t=this.props.mode;if(t===Er.Preview)return e.previewURL}},{key:"createViewBox",value:function createViewBox(){var _this$props9=this.props,e=_this$props9.screenSize,_this$props9$camera=_this$props9.camera,t=_this$props9$camera.scale,i=_this$props9$camera.centerX,r=_this$props9$camera.centerY,n=e.width/t,s=e.height/t;return Number.isNaN(n)&&(n=0),Number.isNaN(s)&&(s=0),"".concat(i-n/2," ").concat(r-s/2," ").concat(n," ").concat(s)}},{key:"render",value:function render(){var _this148=this;var e=[],_this$props10=this.props,t=_this$props10.visions,i=_this$props10.leafFilter,r=_this$props10.className,n=_this$props10.screen,s=_this$props10.engine,o=_this$props10.context,a=_this$props10.style;return t.forEach(function(l,h){if(i(l)){var d=l.value,u=s.getDefinitionNode(d.definition);if(u){var p=_this148.getPreviewURL(d),f={x:d.originX,y:d.originY},m={width:d.width,height:d.height};if(p)e.push((0,ir.createElement)("image",{key:d.id,x:f.x,y:f.y,width:m.width,height:m.height,xlinkHref:p}));else{var g=h.margin,y=d.orderIndex;e.push((0,ir.createElement)(Ax,{key:d.id,screen:n,engine:s,render:u.render,context:o,component:d,margin:g,size:m,zIndex:y,origin:f,payload:d.payload}))}}}}),(0,ir.createElement)("svg",{className:r,fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:this.createViewBox(),preserveAspectRatio:"xMidYMid",style:je(V({},a),{width:"100%",height:"100%",position:"absolute",overflow:"hidden",zIndex:s.orderIndex})},e)}}]);return Ox}(ir.Component),Sd=/*#__PURE__*/function(_so2){_inherits(Sd,_so2);var _super45=_createSuper(Sd);function Sd(e){var _this149;_classCallCheck(this,Sd);_this149=_super45.call(this,e.orderIndex);_this149.definitionNodes={},_this149.fixedSize=e.fixedSize,_this149.isSVG=e.isSVG,_this149.className=e.className,_this149.style=e.style&&Object.freeze(V({},e.style));return _this149}_createClass(Sd,[{key:"getDefinitionNode",value:function getDefinitionNode(e){return this.definitionNodes[e.id]}},{key:"bind",value:function bind(e){var _this150=this;return function(t){if(!(e instanceof hs))throw new Error("it is not ComponentDefinition");if(_this150.definitionNodes[e.id])throw new Error("define duplicated ComponentDefinition");var i;if(typeof t.willInterruptEvent=="boolean"){var _r66=t.willInterruptEvent;i=function i(){return _r66}}else t.willInterruptEvent?i=t.willInterruptEvent.bind(t):i=function i(){return!1};return _this150.definitionNodes[e.id]=Object.freeze({willInterruptEvent:i,render:t}),e.addEngine(_this150,{isVisible:t.isVisible}),_this150.addDefinition(e),t}}},{key:"createRenderLayout",value:function createRenderLayout(e){var t;return this.isSVG?t=Ox:t=Ex,new Mx({engine:this,screen:e.screen,mode:e.mode,initCamera:e.initCamera,tree:e.tree,visions:e.visions,leafFilter:e.leafFilter,renderComponent:t,fixedSize:this.fixedSize,className:this.className,style:this.style})}}]);return Sd}(so);function wy(e){return new Sd(e)}function Rx(e){return e instanceof Sd}var wd=/*#__PURE__*/function(){function wd(){_classCallCheck(this,wd);this.nodes={},this.touched={}}_createClass(wd,[{key:"includes",value:function includes(e){return e in this.nodes}},{key:"leaf",value:function leaf(e){var t=this.nodes[e];return t?t.leaf:null}},{key:"vision",value:function vision(e){var t=this.nodes[e];return t?t.visions[0]:null}},{key:"visions",value:function visions(e){var t=this.nodes[e];return t?t.visions:null}},{key:"bindVision",value:function bindVision(e,t){var i=e.id,r=this.nodes[i];r?r.visions[0]=t:this.nodes[i]={leaf:e,visions:[t,null]},this.touched[i]=!0}},{key:"unbindVision",value:function unbindVision(e){delete this.nodes[e]}},{key:"forEach",value:function forEach(e){for(var t in this.nodes){var _this$nodes$t=this.nodes[t],i=_this$nodes$t.leaf,_r67=_this$nodes$t.visions;e(i,_r67[0])}}},{key:"completeFrame",value:function completeFrame(){var e=!1;for(var t in this.touched){var i=this.nodes[t];if(i){var _i$visions=_slicedToArray(i.visions,1),_r68=_i$visions[0];i.visions[1]=_r68,e=!0}}e&&(this.touched={})}},{key:"clean",value:function clean(){this.nodes={},this.touched={}}}]);return wd}(),il=0,Nx=/*#__PURE__*/function(){function Nx(e){var _this151=this;_classCallCheck(this,Nx);this.binder=e,this.isLeftButtonPressed=!1,this.onMouseDown=function(t){if(t.button===il&&(_this151.checkMouseDidUp(t),_this151.isLeftButtonPressed=!0,!_this151.binder.willInterruptMouseOrTouchEvent(t,t.target))){var i=_this151.binder.eventPosition(t),_r69={kind:S.MouseDown,nativeEvent:t,isOnScreen:!0,pointOnScreen:i,pointOnScene:_this151.binder.toPointInScene(i.x,i.y)};_this151.binder.fireEvent(_r69)}},this.onMouseMove=function(t){if(t.button===il){_this151.checkMouseDidUp(t);var i=_this151.binder.eventPosition(t),_r70={kind:S.MouseMove,nativeEvent:t,isOnScreen:_this151.binder.isEventFiredOnElement(t.target,_this151.binder.divElement),pointOnScreen:i,pointOnScene:_this151.binder.toPointInScene(i.x,i.y)};_this151.binder.fireEvent(_r70)}},this.onMouseLeave=function(t){if(t.button===il&&(_this151.checkMouseDidUp(t),t.target===_this151.binder.divElement)){var i=_this151.binder.eventPosition(t),_r71={kind:S.MouseLeave,nativeEvent:t,isOnScreen:_this151.binder.isEventFiredOnElement(t.target,_this151.binder.divElement),pointOnScreen:i,pointOnScene:_this151.binder.toPointInScene(i.x,i.y)};_this151.binder.fireEvent(_r71)}},this.onMouseUp=function(t){t.button===il&&(_this151.isLeftButtonPressed=!1,_this151.fireMouseUpEvent(t))}}_createClass(Nx,[{key:"checkMouseDidUp",value:function checkMouseDidUp(e){var t=e.which!==0;this.isLeftButtonPressed&&!t&&this.fireMouseUpEvent(e)}},{key:"fireMouseUpEvent",value:function fireMouseUpEvent(e){var t=this.binder.eventPosition(e),i={kind:S.MouseUp,nativeEvent:e,isOnScreen:this.binder.isEventFiredOnElement(e.target,this.binder.divElement),pointOnScreen:t,pointOnScene:this.binder.toPointInScene(t.x,t.y)};this.binder.fireEvent(i)}}]);return Nx}(),rl=/*#__PURE__*/function(){function rl(e){var _this152=this;_classCallCheck(this,rl);this.binder=e,this.latestScale=1,this.onMouseWheel=function(t){if(!_this152.binder.willInterruptMouseOrTouchEvent(t,t.target)){var i=_this152.binder.eventPosition(t),_r72=t.deltaX,n=t.deltaY,s=Math.sqrt(_r72*_r72+n*n),o=0,a=0;_this152.binder.getOS()==="Windows"&&(s=-s),_r72+n<0&&(s=-s),_this152.isMacTouchpadTwoFingerZoom(t)?s=-s*.5:_this152.isMacTouchpadTwoFingerScroll(t)?(o=-_r72,a=-n,s=0):s*=.035;var l={kind:S.MouseWheel,nativeEvent:t,isOnScreen:_this152.binder.isEventFiredOnElement(t.target,_this152.binder.divElement),offsetPoint:{x:o,y:a},scale:_this152.adjustScale(s),pointOnScreen:i,pointOnScene:_this152.binder.toPointInScene(i.x,i.y)};_this152.binder.fireEvent(l)}t.preventDefault()},this.onGestureStart=function(t){_this152.binder.willInterruptMouseOrTouchEvent(t,t.target)||(t.preventDefault(),_this152.latestScale=1)},this.onGestureChange=function(t){if(!_this152.binder.willInterruptMouseOrTouchEvent(t,t.target)){t.preventDefault();var i=(t.scale/_this152.latestScale-1)*rl.safariScaleNumber,_r73={x:t.layerX,y:t.layerY},n={kind:S.MouseWheel,nativeEvent:t,isOnScreen:_this152.binder.isEventFiredOnElement(t.target,_this152.binder.divElement),offsetPoint:{x:0,y:0},scale:_this152.adjustScale(i),pointOnScreen:_r73,pointOnScene:_this152.binder.toPointInScene(_r73.x,_r73.y)};_this152.binder.fireEvent(n)}},this.onGestureEnd=function(t){_this152.binder.willInterruptMouseOrTouchEvent(t,t.target)||t.preventDefault()},this.isMacTouchpadTwoFingerZoom=function(t){return navigator.platform.indexOf("Mac")!==-1?t.ctrlKey:!1},this.isMacTouchpadTwoFingerScroll=function(t){return navigator.platform.indexOf("Mac")!==-1?t.wheelDelta%120!=0||t.movementX!==0||t.deltaX!==0:!1}}_createClass(rl,[{key:"adjustScale",value:function adjustScale(e){return Math.max(e,rl.minScaleStep)*rl.scaleRate}}]);return rl}(),nl=rl;nl.safariScaleNumber=10,nl.minScaleStep=-40,nl.scaleRate=.02;var Lx=/*#__PURE__*/function(){function Lx(e){var _this153=this;_classCallCheck(this,Lx);this.binder=e,this.onTouchStart=function(t){var i=t.target,r=!i||i&&!i.classList.contains("ppt-event-source");t.cancelable&&r&&t.preventDefault();var n=[];for(var s=0;s<t.changedTouches.length;++s){var o=t.changedTouches.item(s);if(!_this153.binder.willInterruptMouseOrTouchEvent(t,o.target)){var a="".concat(o.identifier),l=_this153.binder.eventPosition(o);n.push({identifier:a,pointOnScreen:l,pointOnScene:_this153.binder.toPointInScene(l.x,l.y)})}}if(n.length>0){var _s23={kind:S.TouchStart,nativeEvent:t,touches:n};_this153.binder.fireEvent(_s23)}},this.onTouchMove=function(t){t.cancelable&&t.preventDefault();var i=[];for(var _r74=0;_r74<t.changedTouches.length;++_r74){var n=t.changedTouches.item(_r74),s="".concat(n.identifier),o=_this153.binder.eventPosition(n);i.push({identifier:s,pointOnScreen:o,pointOnScene:_this153.binder.toPointInScene(o.x,o.y)})}if(i.length>0){var _r75={kind:S.TouchMove,nativeEvent:t,touches:i};_this153.binder.fireEvent(_r75)}},this.onTouchEnd=function(t){var i=t.target,r=!i||i&&!i.classList.contains("ppt-event-source");t.cancelable&&r&&t.preventDefault();var n=_this153.cleanAcceptedTouchesByTouchEvent(t);if(n.length>0){var s={kind:S.TouchEnd,nativeEvent:t,touches:n};_this153.binder.fireEvent(s)}},this.onTouchCancel=function(t){t.cancelable&&t.preventDefault();var i=_this153.cleanAcceptedTouchesByTouchEvent(t);if(i.length>0){var _r76={kind:S.TouchCancel,nativeEvent:t,touches:i};_this153.binder.fireEvent(_r76)}}}_createClass(Lx,[{key:"cleanAcceptedTouchesByTouchEvent",value:function cleanAcceptedTouchesByTouchEvent(e){var t=[];for(var i=0;i<e.changedTouches.length;++i){var _r77=e.changedTouches.item(i),n="".concat(_r77.identifier),s=this.binder.eventPosition(_r77);t.push({identifier:n,pointOnScreen:s,pointOnScene:this.binder.toPointInScene(s.x,s.y)})}return t}}]);return Lx}(),Dx=function Dx(e){var _this154=this;_classCallCheck(this,Dx);this.binder=e,this.onKeyDown=function(t){if(!_this154.binder.willInterruptKeyboardEvent(t,t.target)){var i=t.key,_r78=t.altKey,n=t.ctrlKey,s=t.shiftKey,o={kind:S.KeyDown,nativeEvent:t,key:i,altKey:_r78,ctrlKey:n,shiftKey:s};_this154.binder.fireEvent(o)}},this.onKeyUp=function(t){var i=t.key,r=t.altKey,n=t.ctrlKey,s=t.shiftKey,o={kind:S.KeyUp,nativeEvent:t,key:i,altKey:r,ctrlKey:n,shiftKey:s};_this154.binder.fireEvent(o)}},Bx=/*#__PURE__*/function(){function Bx(e,t,i){_classCallCheck(this,Bx);this.mouseEventHandler=new Nx(this),this.touchEventHandler=new Lx(this),this.wheelEventHandler=new nl(this),this.keyboardEventHandler=new Dx(this),this.divElement=t,this.eventParamMap=this.createEventParamMap(e),this.delegate=i,this.addListeners()}_createClass(Bx,[{key:"createEventParamMap",value:function createEventParamMap(e){var t={};switch(e){case Ue.Desktop:{t=je(V({},t),{keyup:{method:this.keyboardEventHandler.onKeyUp,element:document.body},keydown:{method:this.keyboardEventHandler.onKeyDown,element:document.body},mousedown:{method:this.mouseEventHandler.onMouseDown},mousemove:{method:this.mouseEventHandler.onMouseMove,element:document},mouseup:{method:this.mouseEventHandler.onMouseUp,element:document},mouseleave:{method:this.mouseEventHandler.onMouseLeave},wheel:{method:this.wheelEventHandler.onMouseWheel},gesturestart:{method:this.wheelEventHandler.onGestureStart,element:document.body},gesturechange:{method:this.wheelEventHandler.onGestureChange,element:document.body},gestureend:{method:this.wheelEventHandler.onGestureEnd,element:document.body}});break}case Ue.Touch:{t=je(V({},t),{touchstart:{method:this.touchEventHandler.onTouchStart},touchmove:{method:this.touchEventHandler.onTouchMove},touchend:{method:this.touchEventHandler.onTouchEnd},touchcancel:{method:this.touchEventHandler.onTouchCancel}});break}case Ue.Surface:{t=je(V({},t),{keyup:{method:this.keyboardEventHandler.onKeyUp,element:document.body},keydown:{method:this.keyboardEventHandler.onKeyDown,element:document.body},mousedown:{method:this.mouseEventHandler.onMouseDown},mousemove:{method:this.mouseEventHandler.onMouseMove,element:document},mouseup:{method:this.mouseEventHandler.onMouseUp,element:document},mouseleave:{method:this.mouseEventHandler.onMouseLeave},wheel:{method:this.wheelEventHandler.onMouseWheel},gesturestart:{method:this.wheelEventHandler.onGestureStart,element:document.body},gesturechange:{method:this.wheelEventHandler.onGestureChange,element:document.body},gestureend:{method:this.wheelEventHandler.onGestureEnd,element:document.body},touchstart:{method:this.touchEventHandler.onTouchStart},touchmove:{method:this.touchEventHandler.onTouchMove},touchend:{method:this.touchEventHandler.onTouchEnd},touchcancel:{method:this.touchEventHandler.onTouchCancel}});break}}return Object.freeze(t)}},{key:"addListeners",value:function addListeners(){var e=!0;for(var t in this.eventParamMap){var _this$eventParamMap$t=this.eventParamMap[t],i=_this$eventParamMap$t.method,_r79=_this$eventParamMap$t.element;(_r79||this.divElement).addEventListener(t,i,e)}}},{key:"release",value:function release(){var e=!0;for(var t in this.eventParamMap){var _this$eventParamMap$t2=this.eventParamMap[t],i=_this$eventParamMap$t2.method,_r80=_this$eventParamMap$t2.element;(_r80||this.divElement).removeEventListener(t,i,e)}}},{key:"fireEvent",value:function fireEvent(e){this.delegate.fireEvent(e)}},{key:"getOS",value:function getOS(){var _window$navigator=window.navigator,e=_window$navigator.userAgent,t=_window$navigator.platform,i=["Macintosh","MacIntel","MacPPC","Mac68K"],r=["Win32","Win64","Windows","WinCE"],n=["iPhone","iPad","iPod"],s="";return i.indexOf(t)!==-1?s="Mac OS":n.indexOf(t)!==-1?s="iOS":r.indexOf(t)!==-1?s="Windows":/Android/.test(e)?s="Android":!s&&/Linux/.test(t)&&(s="Linux"),s}},{key:"toPointInScene",value:function toPointInScene(e,t){return this.delegate.toPointInScene(e,t)}},{key:"willInterruptMouseOrTouchEvent",value:function willInterruptMouseOrTouchEvent(e,t){return t?!this.isEventFiredOnElement(t,this.divElement)||this.delegate.willInterruptEvent(e,t):!1}},{key:"willInterruptKeyboardEvent",value:function willInterruptKeyboardEvent(e,t){return t?this.delegate.willInterruptEvent(e,t)?!0:t===document.body?!1:!this.isEventFiredOnElement(t,this.divElement):!1}},{key:"isEventFiredOnElement",value:function isEventFiredOnElement(e,t){var i=e;for(;i;){if(i===t)return!0;i=i.parentElement}return!1}},{key:"eventPosition",value:function eventPosition(e){var _this$divElement$getB=this.divElement.getBoundingClientRect(),t=_this$divElement$getB.left,i=_this$divElement$getB.top;return{x:Math.floor(e.clientX)-t,y:Math.floor(e.clientY)-i}}}]);return Bx}(),Yt=/*#__PURE__*/function(){function Yt(){_classCallCheck(this,Yt);this.listeners=[]}_createClass(Yt,[{key:"dispatch",value:function dispatch(e){var _iterator152=_createForOfIteratorHelper(this.listeners),_step152;try{for(_iterator152.s();!(_step152=_iterator152.n()).done;){var t=_step152.value;try{t(e)}catch(i){console.error(i)}}}catch(err){_iterator152.e(err)}finally{_iterator152.f()}}},{key:"addListener",value:function addListener(e){this.listeners.indexOf(e)===-1&&this.listeners.push(e)}},{key:"removeListener",value:function removeListener(e){var t=this.listeners.indexOf(e);t!==-1&&this.listeners.splice(t,1)}},{key:"removeAllListeners",value:function removeAllListeners(){this.listeners.splice(0)}}]);return Yt}(),rt;(function(e){e[e.Start=0]="Start",e[e.Update=1]="Update",e[e.End=2]="End",e[e.Other=3]="Other"})(rt||(rt={}));var Fx=/*#__PURE__*/function(){function Fx(e,t){_classCallCheck(this,Fx);this._disable=!1,this.onCancelEvent=e,this.adapterNodes=Object.freeze(t.map(function(i){var r={},n={};return i.setEventDescriptionStateGetter&&i.setEventDescriptionStateGetter(function(s){var o=r[s];if(o)return{payload:o,isCanceled:!!n[s]}}),{adapter:i,payloads:r,canceledMap:n}}))}_createClass(Fx,[{key:"disable",get:function get(){return this._disable},set:function set(e){this._disable!==e&&(this._disable=e,e&&this.cancel())}},{key:"cancel",value:function cancel(){var _iterator153=_createForOfIteratorHelper(this.adapterNodes),_step153;try{for(_iterator153.s();!(_step153=_iterator153.n()).done;){var _step153$value=_step153.value,e=_step153$value.adapter,t=_step153$value.payloads,i=_step153$value.canceledMap;var _r81={},n=!1;for(var s in t){s in i||(_r81[s]=t[s],i[s]=!0,n=!0)}if(n){var _s24=e.createCancelEvent(_r81);_s24&&this.onCancelEvent(_s24)}}}catch(err){_iterator153.e(err)}finally{_iterator153.f()}}},{key:"interruptEvent",value:function interruptEvent(e){if(this.isMetaUp(e))return{kind:S.MetaKeyUp,nativeEvent:e.nativeEvent};var t=this.adapterNodes.find(function(i){return i.adapter.isEventAccessible(e)});if(t){var i=t.adapter,_r82=t.canceledMap,n=i.takeEventDescription(e),s;n?typeof n.length=="number"?s=n:s=[n]:s=[];var o=[];var _iterator154=_createForOfIteratorHelper(s),_step154;try{for(_iterator154.s();!(_step154=_iterator154.n()).done;){var a=_step154.value;if(a.phase===3)o.push(a);else{var l=this.handleAndCheckIgnoreEventDescription(t,a),h=_r82[a.identifier];!l&&!h&&o.push(a)}}}catch(err){_iterator154.e(err)}finally{_iterator154.f()}return!this._disable&&o.length>0?i.convertToEvent(e,o):null}else return e}},{key:"isMetaUp",value:function isMetaUp(e){return e.kind===S.KeyUp&&e.nativeEvent.key==="Meta"}},{key:"handleAndCheckIgnoreEventDescription",value:function handleAndCheckIgnoreEventDescription(_ref52,_ref53){var e=_ref52.payloads,t=_ref52.canceledMap;var i=_ref53.identifier,r=_ref53.phase,n=_ref53.payload;switch(r){case 0:return i in e?!0:(e[i]=n,this._disable&&(t[i]=!0),!1);case 1:return i in e?(e[i]=n,!1):!0;case 2:if(i in e){var s=!!t[i];return delete e[i],delete t[i],s}else return!0;default:return!0;}}}]);return Fx}(),jx=/*#__PURE__*/function(){function jx(){_classCallCheck(this,jx);this.currentIdentifier=0}_createClass(jx,[{key:"setEventDescriptionStateGetter",value:function setEventDescriptionStateGetter(e){this.getDescriptionState=e}},{key:"isEventAccessible",value:function isEventAccessible(e){return e.kind===S.MouseDown||e.kind===S.MouseMove||e.kind===S.MouseUp||e.kind===S.MouseLeave}},{key:"convertToEvent",value:function convertToEvent(e,_ref54){var _ref55=_slicedToArray(_ref54,1),t=_ref55[0].payload;return{kind:e.kind,nativeEvent:e.nativeEvent,isOnScreen:t.isOnScreen,pointOnScreen:t.pointOnScreen,pointOnScene:t.pointOnScene}}},{key:"createCancelEvent",value:function createCancelEvent(e){var t;for(var i in e){t=e[i]}return{kind:S.MouseUp,isOnScreen:t.isOnScreen,pointOnScreen:t.pointOnScreen,pointOnScene:t.pointOnScene}}},{key:"takeEventDescription",value:function takeEventDescription(e){e.kind===S.MouseDown&&(this.currentIdentifier+=1);var t="".concat(this.currentIdentifier);e.kind===S.MouseUp&&(this.currentIdentifier+=1);var i;switch(e.kind){case S.MouseDown:{i=rt.Start;break}case S.MouseMove:case S.MouseLeave:{var n=this.getDescriptionState(t);if(n){if(n.isCanceled)return null;i=rt.Update}else if(e.isOnScreen)i=rt.Other;else return null;break}case S.MouseUp:{i=rt.End;break}default:return null;}var r={isOnScreen:e.isOnScreen,pointOnScreen:e.pointOnScreen,pointOnScene:e.pointOnScene};return{identifier:t,phase:i,payload:r}}}]);return jx}(),zx=/*#__PURE__*/function(){function zx(){_classCallCheck(this,zx)}_createClass(zx,[{key:"isEventAccessible",value:function isEventAccessible(e){return e.kind===S.TouchStart||e.kind===S.TouchMove||e.kind===S.TouchEnd||e.kind===S.TouchCancel}},{key:"convertToEvent",value:function convertToEvent(e,t){var i=[];var _iterator155=_createForOfIteratorHelper(t),_step155;try{for(_iterator155.s();!(_step155=_iterator155.n()).done;){var _step155$value=_step155.value,_r83=_step155$value.identifier,n=_step155$value.payload;i.push(V({identifier:_r83},n))}}catch(err){_iterator155.e(err)}finally{_iterator155.f()}return{kind:e.kind,nativeEvent:e.nativeEvent,touches:i}}},{key:"createCancelEvent",value:function createCancelEvent(e){var t=[];for(var i in e){t.push(V({identifier:i},e[i]))}return{kind:S.TouchCancel,touches:t}}},{key:"takeEventDescription",value:function takeEventDescription(e){var t;switch(e.kind){case S.TouchStart:{t=rt.Start;break}case S.TouchMove:{t=rt.Update;break}case S.TouchEnd:case S.TouchCancel:{t=rt.End;break}default:return null;}var i=[];var _iterator156=_createForOfIteratorHelper(e.touches),_step156;try{for(_iterator156.s();!(_step156=_iterator156.n()).done;){var _step156$value=_step156.value,_r84=_step156$value.identifier,n=_step156$value.pointOnScene,s=_step156$value.pointOnScreen;i.push({identifier:_r84,phase:t,payload:{pointOnScene:n,pointOnScreen:s}})}}catch(err){_iterator156.e(err)}finally{_iterator156.f()}return i}}]);return zx}(),Ux=/*#__PURE__*/function(){function Ux(){_classCallCheck(this,Ux)}_createClass(Ux,[{key:"isEventAccessible",value:function isEventAccessible(e){return e.kind===S.SortedTouchStart||e.kind===S.SortedTouchMove||e.kind===S.SortedTouchEnd||e.kind===S.SortedTouchCancel}},{key:"convertToEvent",value:function convertToEvent(e,_ref56){var _ref57=_slicedToArray(_ref56,1),_ref57$=_ref57[0],t=_ref57$.identifier,i=_ref57$.payload;return{kind:e.kind,nativeEvent:e.nativeEvent,identifier:t,pointOnScene:i.pointOnScene,pointOnScreen:i.pointOnScreen}}},{key:"createCancelEvent",value:function createCancelEvent(e){var t;for(var n in e){t=n}var _e$t2=e[t],i=_e$t2.pointOnScene,r=_e$t2.pointOnScreen;return{kind:S.SortedTouchCancel,identifier:t,pointOnScene:i,pointOnScreen:r}}},{key:"takeEventDescription",value:function takeEventDescription(e){var t;switch(e.kind){case S.SortedTouchStart:{t=rt.Start;break}case S.SortedTouchMove:{t=rt.Update;break}case S.SortedTouchEnd:case S.SortedTouchCancel:{t=rt.End;break}default:return null;}return[{identifier:e.identifier,phase:t,payload:{pointOnScene:e.pointOnScene,pointOnScreen:e.pointOnScreen}}]}}]);return Ux}(),Vx=/*#__PURE__*/function(){function Vx(){_classCallCheck(this,Vx)}_createClass(Vx,[{key:"isEventAccessible",value:function isEventAccessible(e){return e.kind===S.KeyUp||e.kind===S.KeyDown}},{key:"convertToEvent",value:function convertToEvent(e,_ref58){var _ref59=_slicedToArray(_ref58,1),t=_ref59[0].payload;return{kind:e.kind,nativeEvent:e.nativeEvent,key:t.key,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey}}},{key:"createCancelEvent",value:function createCancelEvent(e){var t;for(var i in e){t=e[i]}return{kind:S.KeyUp,key:t.key,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey}}},{key:"takeEventDescription",value:function takeEventDescription(e){var t;var i;if(e.key==="Meta"&&((t=e.nativeEvent)==null?void 0:t.metaKey))i=rt.Other;else switch(e.kind){case S.KeyDown:{i=rt.Start;break}case S.KeyUp:{i=rt.End;break}default:return null;}var r=e.key,n={key:e.key,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey};return{identifier:r,phase:i,payload:n}}}]);return Vx}(),Wx=/*#__PURE__*/function(){function Wx(){_classCallCheck(this,Wx);this.currentIdentifier=0}_createClass(Wx,[{key:"setEventDescriptionStateGetter",value:function setEventDescriptionStateGetter(e){this.getDescriptionState=e}},{key:"isEventAccessible",value:function isEventAccessible(e){return e.kind===S.MouseWheel}},{key:"takeEventDescription",value:function takeEventDescription(e){var t="".concat(this.currentIdentifier);this.getDescriptionState(t),this.currentIdentifier+=1;var i={isOnScreen:e.isOnScreen,pointOnScene:e.pointOnScene,pointOnScreen:e.pointOnScreen,offsetPoint:e.offsetPoint,scale:e.scale};return{identifier:t,phase:rt.Other,payload:i}}},{key:"convertToEvent",value:function convertToEvent(e,t){return e}},{key:"createCancelEvent",value:function createCancelEvent(e){return null}}]);return Wx}();function ky(e){return new Fx(e,[new jx,new zx,new Ux,new Vx,new Wx])}var Hx=/*#__PURE__*/function(){function Hx(e,t){var _this155=this;_classCallCheck(this,Hx);this.eventDispatcher=new Yt,this.binder=null,this.fireEvent=function(i){var r=_this155.continuityNode.interruptEvent(i);r&&_this155.eventDispatcher.dispatch(r)},this.screen=e,this.eventInterrupter=t,this.continuityNode=ky(function(i){return _this155.eventDispatcher.dispatch(i)})}_createClass(Hx,[{key:"bindDivElement",value:function bindDivElement(e){e!==(this.binder?this.binder.divElement:null)&&(this.binder&&this.binder.release(),e?this.binder=new Bx(this.screen.deviceType,e,this):this.binder=null)}},{key:"disable",get:function get(){return this.continuityNode.disable},set:function set(e){this.continuityNode.disable=e}},{key:"cancelCurrentContinuityEvent",value:function cancelCurrentContinuityEvent(){this.continuityNode.cancel()}},{key:"toPointInScene",value:function toPointInScene(e,t){return this.screen.convertPointToScene(e,t)}},{key:"willInterruptEvent",value:function willInterruptEvent(e,t){return!this.disable&&this.eventInterrupter(e)?!0:t?this.screen.willInterruptEvent(e,t):!1}},{key:"addListener",value:function addListener(e){this.eventDispatcher.addListener(e)}},{key:"removeListener",value:function removeListener(e){this.eventDispatcher.removeListener(e)}}]);return Hx}(),_x=/*#__PURE__*/function(){function _x(e){var _this156=this;_classCallCheck(this,_x);this.invoker=e,this.timer=null,this.fireAt=-1,this.invokeWhenTimeout=function(){var t=Date.now();if(t>=_this156.fireAt)_this156.timer=null,_this156.fireAt=-1,_this156.invoker();else{var i=_this156.fireAt-t;_this156.timer=setTimeout(_this156.invokeWhenTimeout,i)}}}_createClass(_x,[{key:"isRunning",get:function get(){return this.timer!==null}},{key:"refreshAndInvokeAfterInterval",value:function refreshAndInvokeAfterInterval(e){var t=Date.now();if(this.timer===null)this.timer=setTimeout(this.invokeWhenTimeout,e),this.fireAt=t+e;else{var i=t+e;i<=this.fireAt&&(clearTimeout(this.timer),this.timer=setTimeout(this.invokeWhenTimeout,e)),this.fireAt=i}}},{key:"cancel",value:function cancel(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)}}]);return _x}(),Kx=300,Gx=/*#__PURE__*/function(){function Gx(e){var _this157=this;_classCallCheck(this,Gx);this.onPushedBoundlessEvent=e,this.operationBuffer=[],this.willBlockOperation=!1,this.flushingOperationBufferTimer=null,this.flushOperationBuffer=function(){if(_this157.operationBuffer){var _iterator157=_createForOfIteratorHelper(_this157.operationBuffer),_step157;try{for(_iterator157.s();!(_step157=_iterator157.n()).done;){var t=_step157.value;t()}}catch(err){_iterator157.e(err)}finally{_iterator157.f()}_this157.operationBuffer.splice(0,_this157.operationBuffer.length),_this157.willBlockOperation=!1}_this157.flushingOperationBufferTimer=null}}_createClass(Gx,[{key:"unknownIsMultiFingers",get:function get(){return this.willBlockOperation}},{key:"startOperation",value:function startOperation(){this.willBlockOperation=!0,this.flushingOperationBufferTimer=setTimeout(this.flushOperationBuffer,Kx)}},{key:"assertMultiFingers",value:function assertMultiFingers(){this.operationBuffer.splice(0,this.operationBuffer.length),this.willBlockOperation=!1,this.flushingOperationBufferTimer!==null&&(clearTimeout(this.flushingOperationBufferTimer),this.flushingOperationBufferTimer=null)}},{key:"assertSingleFinger",value:function assertSingleFinger(){this.flushingOperationBufferTimer!==null&&clearTimeout(this.flushingOperationBufferTimer),this.flushOperationBuffer()}},{key:"pushBoundlessEvent",value:function pushBoundlessEvent(e){var _this158=this;this.willBlockOperation?this.operationBuffer.push(function(){return _this158.onPushedBoundlessEvent(e)}):this.onPushedBoundlessEvent(e)}}]);return Gx}(),$x=/*#__PURE__*/function(){function $x(){_classCallCheck(this,$x);this.pressedTouches={},this.emptyResolves=[],this.pressedTouchesCount=0}_createClass($x,[{key:"receiveTouchStartOrMoveEvent",value:function receiveTouchStartOrMoveEvent(_ref60){var e=_ref60.touches;var _iterator158=_createForOfIteratorHelper(e),_step158;try{for(_iterator158.s();!(_step158=_iterator158.n()).done;){var t=_step158.value;t.identifier in this.pressedTouches||(this.pressedTouchesCount+=1),this.pressedTouches[t.identifier]=t}}catch(err){_iterator158.e(err)}finally{_iterator158.f()}}},{key:"receiveTouchEndOrCancelEvent",value:function receiveTouchEndOrCancelEvent(_ref61){var e=_ref61.touches;var _iterator159=_createForOfIteratorHelper(e),_step159;try{for(_iterator159.s();!(_step159=_iterator159.n()).done;){var t=_step159.value;if(t.identifier in this.pressedTouches&&(this.pressedTouchesCount-=1,delete this.pressedTouches[t.identifier],this.pressedTouchesCount===0)){var _iterator160=_createForOfIteratorHelper(this.emptyResolves.splice(0)),_step160;try{for(_iterator160.s();!(_step160=_iterator160.n()).done;){var i=_step160.value;i()}}catch(err){_iterator160.e(err)}finally{_iterator160.f()}}}}catch(err){_iterator159.e(err)}finally{_iterator159.f()}}},{key:"waitUntilNoPressedTouches",value:function waitUntilNoPressedTouches(){var _this159=this;return this.pressedTouchesCount===0?Promise.resolve():new Promise(function(e){return _this159.emptyResolves.push(e)})}}]);return $x}(),Yx=3,xy;(function(e){e[e.None=0]="None",e[e.Event=1]="Event",e[e.Camera=2]="Camera",e[e.Cancel=3]="Cancel"})(xy||(xy={}));var Xx=/*#__PURE__*/function(){function Xx(e){_classCallCheck(this,Xx);this.pressedTouches=new $x,this.state=0,this.pinchTouches=null,this.previousTouchesCount=0,this.firstPressedTouch=null,this.firstPressedTouchBeginX=0,this.firstPressedTouchBeginY=0,this.blocker=new Gx(e.onReceivedSortedTouchEvent),this.callbacks=Object.freeze(V({},e))}_createClass(Xx,[{key:"pushTouchEvent",value:function pushTouchEvent(e){switch(e.kind){case S.TouchStart:{this.pressedTouches.receiveTouchStartOrMoveEvent(e),this.pushTouchStartEvent(e);break}case S.TouchMove:{this.pressedTouches.receiveTouchStartOrMoveEvent(e),this.pushTouchMoveEvent(e);break}case S.TouchEnd:case S.TouchCancel:{this.pressedTouches.receiveTouchEndOrCancelEvent(e),this.pushTouchEndOrCancelEvent(e);break}}}},{key:"cancel",value:function cancel(){var _this160=this;this.state!==0&&this.state!==3&&(this.state=3,this.pressedTouches.waitUntilNoPressedTouches().then(function(){_this160.state=0})["catch"](function(e){return console.error(e)}))}},{key:"pushTouchStartEvent",value:function pushTouchStartEvent(e){var t=e.touches;switch(this.state){case 0:{this.blocker.startOperation(),t.length===1?(this.state=1,this.firstPressedTouchBeginX=t[0].pointOnScreen.x,this.firstPressedTouchBeginY=t[0].pointOnScreen.y,this.firstPressedTouch={identifier:t[0].identifier,x:this.firstPressedTouchBeginX,y:this.firstPressedTouchBeginY},this.blocker.pushBoundlessEvent(this.covertToSortedTouchEvent(e,0))):(this.state=2,this.pinchTouches=t.map(function(i){return{identifier:i.identifier,x:i.pointOnScreen.x,y:i.pointOnScreen.y}}),this.handleTouchEvents(this.pinchTouches));break}case 1:{this.pinchTouches=[{identifier:this.firstPressedTouch.identifier,x:this.firstPressedTouch.x,y:this.firstPressedTouch.y}],this.blocker.unknownIsMultiFingers&&(this.blocker.assertMultiFingers(),this.firstPressedTouch=null),this.pushToPinchTouches(t),this.handleTouchEvents(this.pinchTouches),this.state=2;break}case 2:{this.pushToPinchTouches(t),this.handleTouchEvents(this.pinchTouches);break}}}},{key:"pushTouchMoveEvent",value:function pushTouchMoveEvent(e){var _this161=this;var t=e.touches;switch(this.refreshFirstPressedTouch(t),this.state){case 1:{var i=t.findIndex(function(r){return r.identifier===_this161.firstPressedTouch.identifier});this.blocker.pushBoundlessEvent(this.covertToSortedTouchEvent(e,i));break}case 2:{var _iterator161=_createForOfIteratorHelper(this.pinchTouches),_step161;try{var _loop21=function _loop21(){var i=_step161.value;var r=t.find(function(n){return n.identifier===i.identifier});r&&(i.x=r.pointOnScreen.x,i.y=r.pointOnScreen.y)};for(_iterator161.s();!(_step161=_iterator161.n()).done;){_loop21()}}catch(err){_iterator161.e(err)}finally{_iterator161.f()}this.handleTouchEvents(this.pinchTouches);break}}}},{key:"pushTouchEndOrCancelEvent",value:function pushTouchEndOrCancelEvent(e){var _this162=this;var t=e.touches;if(this.firstPressedTouch&&this.state!==3){var i=t.findIndex(function(r){return r.identifier===_this162.firstPressedTouch.identifier});if(i!==-1){var _r85=this.covertToSortedTouchEvent(e,i);this.callbacks.onReceivedPreEndTouchEvent(_r85),this.blocker.pushBoundlessEvent(_r85),this.firstPressedTouch=null}}switch(this.state){case 1:{this.blocker.assertSingleFinger(),this.completeOperation();break}case 2:{this.blocker.assertMultiFingers();var _iterator162=_createForOfIteratorHelper(t),_step162;try{var _loop22=function _loop22(){var i=_step162.value;var r=_this162.pinchTouches.findIndex(function(n){return n.identifier===i.identifier});r!==-1&&_this162.pinchTouches.splice(r,1)};for(_iterator162.s();!(_step162=_iterator162.n()).done;){_loop22()}}catch(err){_iterator162.e(err)}finally{_iterator162.f()}this.firstPressedTouch&&this.pinchTouches.length===1?(this.state=1,this.handleTouchEvents([]),this.pinchTouches=null):this.pinchTouches.length===0?(this.handleTouchEvents(this.pinchTouches),this.pinchTouches=null,this.completeOperation()):this.handleTouchEvents(this.pinchTouches);break}}}},{key:"handleTouchEvents",value:function handleTouchEvents(e){try{this.previousTouchesCount===0&&e.length>0&&this.callbacks.onBeginTransformCamera(e),this.previousTouchesCount>0&&e.length===0?this.callbacks.onAfterTransformCamera():this.callbacks.onTransformCamera(e)}finally{this.previousTouchesCount=e.length}}},{key:"pushToPinchTouches",value:function pushToPinchTouches(e){var _this163=this;if(this.pinchTouches){var _iterator163=_createForOfIteratorHelper(e),_step163;try{var _loop23=function _loop23(){var t=_step163.value;_this163.pinchTouches.some(function(i){return i.identifier===t.identifier})||_this163.pinchTouches.push({x:t.pointOnScreen.x,y:t.pointOnScreen.y,identifier:t.identifier})};for(_iterator163.s();!(_step163=_iterator163.n()).done;){_loop23()}}catch(err){_iterator163.e(err)}finally{_iterator163.f()}}}},{key:"refreshFirstPressedTouch",value:function refreshFirstPressedTouch(e){if(this.firstPressedTouch){var _iterator164=_createForOfIteratorHelper(e),_step164;try{for(_iterator164.s();!(_step164=_iterator164.n()).done;){var _t12=_step164.value;if(_t12.identifier===this.firstPressedTouch.identifier){this.firstPressedTouch.x=_t12.pointOnScreen.x,this.firstPressedTouch.y=_t12.pointOnScreen.y;break}}}catch(err){_iterator164.e(err)}finally{_iterator164.f()}if(this.blocker.unknownIsMultiFingers){var t=this.firstPressedTouch.x-this.firstPressedTouchBeginX,i=this.firstPressedTouch.y-this.firstPressedTouchBeginY,_r86=Yx;t*t+i*i>=_r86*_r86&&this.blocker.assertSingleFinger()}}}},{key:"completeOperation",value:function completeOperation(){this.state=0,this.blocker.unknownIsMultiFingers&&this.blocker.assertMultiFingers(),this.callbacks.onCompleteGroupOfEvents()}},{key:"covertToSortedTouchEvent",value:function covertToSortedTouchEvent(e,t){var _e$touches$t=e.touches[t],i=_e$touches$t.identifier,r=_e$touches$t.pointOnScreen,n=_e$touches$t.pointOnScene,s,o;switch(e.kind){case S.TouchStart:{s=S.SortedTouchStart;break}case S.TouchMove:{s=S.SortedTouchMove;break}case S.TouchEnd:{s=S.SortedTouchEnd;break}case S.TouchCancel:{s=S.SortedTouchCancel;break}default:throw new Error("unexpected kind ".concat(e.kind));}return this.firstPressedTouch&&(o={x:this.firstPressedTouchBeginX,y:this.firstPressedTouchBeginY}),{identifier:i,nativeEvent:e.nativeEvent,kind:s,pointOnScreen:r,pointOnScene:n,beginPointOnScreen:o}}}]);return Xx}();function Qx(e,t){return e.centerX===t.centerX&&e.centerY===t.centerY&&e.damping===t.damping&&e.width===t.width&&e.height===t.height&&e.minScale===t.minScale&&e.maxScale===t.maxScale}function Py(e,t,i,r){if(t===1/0||r===1/0)return{center:0,scale:1/0};var n=t/r;return Number.isNaN(n)&&(n=1),{center:i-e,scale:n}}var Iy=/*#__PURE__*/function(){function Iy(e){_classCallCheck(this,Iy);this.originBorder=e,this.currentBorder=e,this._transform=Object.freeze({deltaX:0,deltaY:0,scale:1})}_createClass(Iy,[{key:"transform",get:function get(){return this._transform}},{key:"adaptOriginBorder",get:function get(){return this._adaptOriginBorder}},{key:"setCurrentBorder",value:function setCurrentBorder(e){this.currentBorder=e;var _Py=Py(this.originBorder.centerX,this.originBorder.width,this.currentBorder.centerX,this.currentBorder.width),t=_Py.center,i=_Py.scale,_Py2=Py(this.originBorder.centerY,this.originBorder.height,this.currentBorder.centerY,this.currentBorder.height),r=_Py2.center,n=_Py2.scale,s=Math.min(i,n);s===1/0&&(s=1),this._transform=Object.freeze({deltaX:t,deltaY:r,scale:s}),this._adaptOriginBorder=Object.freeze({damping:e.damping,centerX:e.centerX-t,centerY:e.centerY-r,width:e.width*s,height:e.height*s,maxScale:e.maxScale/s,minScale:e.minScale/s})}}]);return Iy}(),Cd=/*#__PURE__*/function(){function Cd(){_classCallCheck(this,Cd);this.eccentricityRate=1,this.centroidXOffset=0,this.centroidYOffset=0,this.beginCentroidX=0,this.beginCentroidY=0,this.centroidX=0,this.centroidY=0,this._scale=1,this.isHanding=!1,this.previousTouchesCount=0}_createClass(Cd,[{key:"beginCentroid",get:function get(){return this.isHanding?{x:this.beginCentroidX,y:this.beginCentroidY}:Cd.zeroPoint}},{key:"centroid",get:function get(){return this.isHanding?{x:this.centroidX,y:this.centroidY}:Cd.zeroPoint}},{key:"scale",get:function get(){return this.isHanding?this._scale:1}},{key:"handleTouches",value:function handleTouches(e){var t=this.findTouchesExpression(e);this.isHanding?(this.previousTouchesCount!==e.length&&(this.centroidXOffset=this.centroidX-t.centroidX,this.centroidYOffset=this.centroidY-t.centroidY,this.eccentricityRate=this._scale/t.eccentricity,this.previousTouchesCount=e.length),this.centroidX=t.centroidX+this.centroidXOffset,this.centroidY=t.centroidY+this.centroidYOffset,this._scale=t.eccentricity*this.eccentricityRate):(this.centroidXOffset=0,this.centroidYOffset=0,this.eccentricityRate=1/t.eccentricity,this.beginCentroidX=t.centroidX,this.beginCentroidY=t.centroidY,this.centroidX=t.centroidX,this.centroidY=t.centroidY,this._scale=1,this.previousTouchesCount=e.length,this.isHanding=!0)}},{key:"findTouchesExpression",value:function findTouchesExpression(e){var t=0,i=0;var _iterator165=_createForOfIteratorHelper(e),_step165;try{for(_iterator165.s();!(_step165=_iterator165.n()).done;){var _step165$value=_step165.value,o=_step165$value.x,a=_step165$value.y;t+=o,i+=a}}catch(err){_iterator165.e(err)}finally{_iterator165.f()}var r=t/e.length,n=i/e.length,s=0;var _iterator166=_createForOfIteratorHelper(e),_step166;try{for(_iterator166.s();!(_step166=_iterator166.n()).done;){var _step166$value=_step166.value,_o17=_step166$value.x,_a17=_step166$value.y;var l=_o17-r,h=_a17-n;s+=Math.sqrt(l*l+h*h)}}catch(err){_iterator166.e(err)}finally{_iterator166.f()}return s===0&&(s=1),{eccentricity:s,centroidX:r,centroidY:n}}}]);return Cd}(),My=Cd;My.zeroPoint=Object.freeze({x:0,y:0});var qx=/*#__PURE__*/function(){function qx(e){_classCallCheck(this,qx);this.border={centerX:0,centerY:0,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},this.scaleStart=0,this.scaleEnd=Number.POSITIVE_INFINITY,this.screenSize=e}_createClass(qx,[{key:"findClosestValidCamera",value:function findClosestValidCamera(e){var t=this.findClosestValidScale(e.scale),i=e.centerX,r=e.centerY;if(this.pinPoint&&e.scale!==t){var n=i-this.pinPoint.x,s=r-this.pinPoint.y,o=t/e.scale;i=this.pinPoint.x+n/o,r=this.pinPoint.y+s/o}return i=this.findClosestValidCenter(i,t,this.screenSize.width,this.border.centerX,this.border.width),r=this.findClosestValidCenter(r,t,this.screenSize.height,this.border.centerY,this.border.height),{centerX:i,centerY:r,scale:t}}},{key:"findClosestValidScale",value:function findClosestValidScale(e){var t=e;return this.scaleStart>t?t=this.scaleStart:this.scaleEnd<t&&(t=this.scaleEnd),t}},{key:"findClosestValidCenter",value:function findClosestValidCenter(e,t,i,r,n){var s=i/n,o=e;if(t<=s)o=r;else{var a=i/t/2,l=n/2,h=r-l+a,d=r+l-a;o<h?o=h:o>d&&(o=d)}return o}}]);return qx}();function Ty(e,t){return{x:e.x-t.width/2,y:e.y-t.height/2}}function Ey(e,t,i){var r=e.x-t.width/2,n=e.y-t.height/2;return{x:i.centerX+r/i.scale,y:i.centerY+n/i.scale}}function Zx(e,t){return e.centerX===t.centerX&&e.centerY===t.centerY&&e.scale===t.scale}var Jx=/*#__PURE__*/function(){function Jx(e){_classCallCheck(this,Jx);this.pincher=null,this.damping=0,this.camera=null,this.lastValidCamera=null,this.domain=new qx(e)}_createClass(Jx,[{key:"isHandingPinch",get:function get(){return!!this.pincher}},{key:"screenSize",get:function get(){return this.domain.screenSize},set:function set(e){this.domain.screenSize=e}},{key:"setCameraBorder",value:function setCameraBorder(e){this.damping=e.damping,this.domain.scaleStart=e.minScale,this.domain.scaleEnd=e.maxScale,this.domain.border.centerX=e.centerX,this.domain.border.centerY=e.centerY,this.domain.border.width=e.width,this.domain.border.height=e.height}},{key:"beginWithCamera",value:function beginWithCamera(e){this.pincher=new My,this.camera=e}},{key:"handleTouchesAndGetCameraMoving",value:function handleTouchesAndGetCameraMoving(e){this.pincher.handleTouches(e);var t=this.pincher.centroid,i=this.currentTargetCamera();return this.transformToCombinedCamera(i,t)}},{key:"transformToCombinedCamera",value:function transformToCombinedCamera(e,t){var i=this.domain.screenSize,r=Ey(t,i,e);this.domain.pinPoint=r;var n=this.domain.findClosestValidCamera(e);this.lastValidCamera=n;var s;if(this.damping===0)s=e;else if(this.damping===1)s=n;else if(Zx(e,n))s=e;else{var o=Ey(t,i,n);s=this.viewCamera(r,o,e,n,this.damping)}return{valid:n,view:s}}},{key:"completeAndGetValidCamera",value:function completeAndGetValidCamera(){var e=this.lastValidCamera;return this.pincher=null,this.camera=null,this.lastValidCamera=null,e}},{key:"currentTargetCamera",value:function currentTargetCamera(){var e=this.camera,t=this.pincher,i=this.domain.screenSize,r=e.scale*t.scale,n=Ty(t.beginCentroid,i),s=Ty(t.centroid,i),o=n.x/e.scale-s.x/r,a=n.y/e.scale-s.y/r;return{centerX:e.centerX+o,centerY:e.centerY+a,scale:r}}},{key:"viewCamera",value:function viewCamera(e,t,i,r,n){var s=ib(i.centerX,i.centerY,e.x,e.y),o=ds(i.scale,r.scale,n),a=s*i.scale/o,l=ds(e.x,t.x,n),h=ds(e.y,t.y,n),d=tb(ds(i.centerX,r.centerX,n)-l,ds(i.centerY,r.centerY,n)-h),u=a*d.x,p=a*d.y;return{centerX:l+u,centerY:h+p,scale:o}}}]);return Jx}(),eP=/*#__PURE__*/function(){function eP(e){_classCallCheck(this,eP);this._isActive=!1,this._key=void 0,this.previousPressEvent=null,this.cameraman=e.cameraman,this.activeDispatch=e.activeDispatch}_createClass(eP,[{key:"active",get:function get(){return this._isActive},set:function set(e){this._isActive=e}},{key:"key",get:function get(){return this._key},set:function set(e){this._key=e}},{key:"willInterruptEvent",value:function willInterruptEvent(e){return this.active&&!!e&&(e.kind===S.SortedTouchMove||e.kind===S.MouseMove)}},{key:"moveCameraByEvent",value:function moveCameraByEvent(e){if(e&&this.previousPressEvent&&this.isMouseOrSortedTouch(this.previousPressEvent)&&this.isMouseOrSortedTouch(e)){var t=e.pointOnScreen.x-this.previousPressEvent.pointOnScreen.x,i=e.pointOnScreen.y-this.previousPressEvent.pointOnScreen.y,_this$cameraman$scree=this.cameraman.screen.camera,_r87=_this$cameraman$scree.centerX,n=_this$cameraman$scree.centerY,s=_this$cameraman$scree.scale;this.cameraman.transformCamera({centerX:_r87-t/s,centerY:n-i/s,scale:s,animationMode:$.Immediately,operatorId:this.cameraman.operatorId,boundCamera:!0})}}},{key:"handlePreviousEvent",value:function handlePreviousEvent(e){this.needUpdatePrevious(e)?this.previousPressEvent=e:this.needReleasePrevious(e)&&(this.previousPressEvent=null)}},{key:"isKeyEvent",value:function isKeyEvent(e){return!!e.nativeEvent&&e.nativeEvent instanceof KeyboardEvent&&e.nativeEvent.key===this.key}},{key:"handleKeyEvent",value:function handleKeyEvent(e){var t=this.active;e.kind===S.KeyDown&&t!==!0?this.active=!0:e.kind===S.KeyUp&&t!==!1&&(this.active=!1),t!==this.active&&this.activeDispatch(this.active)}},{key:"isMouseOrSortedTouch",value:function isMouseOrSortedTouch(e){var t=e.kind;return t===S.MouseDown||t===S.MouseUp||t===S.MouseLeave||t===S.MouseMove||t===S.SortedTouchStart||t===S.SortedTouchMove||t===S.SortedTouchEnd||t===S.SortedTouchCancel}},{key:"needUpdatePrevious",value:function needUpdatePrevious(e){return!!(e&&(!!this.previousPressEvent&&(e.kind===S.MouseMove||e.kind===S.SortedTouchMove)||e.kind===S.MouseDown||e.kind===S.SortedTouchStart))}},{key:"needReleasePrevious",value:function needReleasePrevious(e){return!!e&&(e.kind===S.MouseUp||e.kind===S.SortedTouchEnd||e.kind===S.SortedTouchCancel)}}]);return eP}(),Ay=/*#__PURE__*/function(){function Ay(e,t,i){var _this164=this;var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};_classCallCheck(this,Ay);this.disableCameraTransform=!1,this.boundlessEventDispatcher=new Yt,this.preEndTouchEventDisplayer=new Yt,this.transformationEventDispatcher=new Yt,this.handToolActiveEventDispatcher=new Yt,this.transformer=null,this.border=Object.freeze({damping:.75,centerX:0,centerY:0,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY,minScale:0,maxScale:Number.POSITIVE_INFINITY}),this.moveToCamera=null,this.didRelease=!1,this.isPaddingCameraOperations=!1,this.paddingCameraOperation=null,this.onBoundlessEvent=function(n){switch(_this164.screen.deviceType){case Ue.Surface:{_this164.handleBoundlessEventWhenItIsSurface(n);break}case Ue.Desktop:{_this164.handleBoundlessEventWhenItIsDesktop(n);break}case Ue.Touch:_this164.handleBoundlessEventWhenItIsTouch(n);}},this.onScreenUpdatedListener=function(_ref62){var n=_ref62.camera,s=_ref62.width,o=_ref62.height;var a=_this164.cameraView.screenSize;if(a.width!==s||a.height!==o){_this164.cameraView.screenSize=Object.freeze({width:s,height:o});var _this164$cameraView$t=_this164.cameraView.transformToCombinedCamera(_this164.screen.camera,{x:s/2,y:o/2}),l=_this164$cameraView$t.valid;(n.centerX!==l.centerX||n.centerY!==l.centerY||n.scale!==l.scale)&&_this164.screen.transformCamera(je(V({},l),{animationMode:$.Immediately}))}},this.dispatchBoundlessEvent=function(n){var s=_this164.continuityNode.interruptEvent(n);_this164.handTool.willInterruptEvent(s)?_this164.handTool.moveCameraByEvent(s):s&&_this164.boundlessEventDispatcher.dispatch(s),_this164.handTool.handlePreviousEvent(s)},this.dispatchPreEndTouchEvent=function(n){_this164.preEndTouchEventDisplayer.dispatch(n)},this.onAfterMouseWheel=function(){_this164.transformationEventDispatcher.dispatch(fi.End),_this164.screen.setTransition(!1,_this164.operatorId)},this.onBeginTransformCamera=function(n){_this164.disableCameraTransform||(_this164.isPaddingCameraOperations=!0,_this164.transformationEventDispatcher.dispatch(fi.Begin),_this164.cameraView.beginWithCamera(_this164.screen.camera),_this164.transformer=new Iy(_this164.border),_this164.onTransformCamera(n))},this.onTransformCamera=function(n){if(_this164.disableCameraTransform)return;var s=_this164.cameraView.handleTouchesAndGetCameraMoving(n),o=je(V({},_this164.cameraAppendBorderTransform(s.view)),{animationMode:$.Immediately,operatorId:_this164.operatorId});_this164.moveToCamera=s.view,_this164.screen.setCameraTransfrom(o,!0)},this.onAfterTransformCamera=function(){if(_this164.disableCameraTransform)return;var n=_this164.cameraView.completeAndGetValidCamera();_this164.isPaddingCameraOperations=!1,_this164.moveToCamera=_this164.cameraAppendBorderTransform(n),_this164.cameraView.setCameraBorder(_this164.border),_this164.paddingCameraOperation&&(_this164.paddingCameraOperation(),_this164.paddingCameraOperation=null),_this164.transformer=null,_this164.transformationEventDispatcher.dispatch(fi.End)},this.onCompleteGroupOfEvents=function(){if(_this164.moveToCamera){var n=_this164.screen.camera;if(_this164.moveToCamera.centerX!==n.centerX||_this164.moveToCamera.centerY!==n.centerY||_this164.moveToCamera.scale!==n.scale){var s=je(V({},_this164.moveToCamera),{animationMode:$.Continuous,operatorId:_this164.operatorId});_this164.screen.setCameraTransfrom(s,!1)}else _this164.screen.setTransition(!1,_this164.operatorId);_this164.moveToCamera=null}},this.onContinuityNodeCancel=function(n){_this164.boundlessEventDispatcher.dispatch(n),_this164.sorter&&_this164.sorter.cancel()},this.screen=e,this.operatorId=i,this.eventProxy=t,this.afterWheelDelayer=new _x(this.onAfterMouseWheel),this.continuityNode=ky(this.onContinuityNodeCancel),this.cameraView=new Jx({width:e.width,height:e.height}),this.handTool=new eP({cameraman:this,activeDispatch:function activeDispatch(n){return _this164.handToolActiveEventDispatcher.dispatch(n)}}),this.setCameraBorder(r),(e.deviceType===Ue.Touch||e.deviceType===Ue.Surface)&&(this.sorter=new Xx({onBeginTransformCamera:this.onBeginTransformCamera,onTransformCamera:this.onTransformCamera,onAfterTransformCamera:this.onAfterTransformCamera,onCompleteGroupOfEvents:this.onCompleteGroupOfEvents,onReceivedSortedTouchEvent:this.dispatchBoundlessEvent,onReceivedPreEndTouchEvent:this.dispatchPreEndTouchEvent})),t.addListener(this.onBoundlessEvent),e.addScreenUpdatedListener(this.onScreenUpdatedListener)}_createClass(Ay,[{key:"handToolActive",get:function get(){return this.handTool.active},set:function set(e){this.handTool.active=e}},{key:"handToolKey",get:function get(){return this.handTool.key},set:function set(e){this.handTool.key=e}},{key:"cameraBorder",get:function get(){return this.border}},{key:"cancelCurrentContinuityEvent",value:function cancelCurrentContinuityEvent(){this.continuityNode.cancel()}},{key:"setCameraBorder",value:function setCameraBorder(e){var t=this.border,i=this.border=Object.freeze(V(V({},this.border),e));if(!Qx(t,i)){var _r88;this.transformer?(_r88=this.transformer,_r88.setCurrentBorder(i),i=_r88.adaptOriginBorder):(_r88=new Iy(t),_r88.setCurrentBorder(i)),this.cameraView.setCameraBorder(i);var n=this.moveToCamera||this.screen.camera,_r89=_r88,s=_r89.transform;(s.deltaX!==0||s.deltaY!==0||s.scale!==1)&&this.screen.transformCamera({animationMode:$.Immediately,centerX:n.centerX+s.deltaX,centerY:n.centerY+s.deltaY,scale:n.scale*s.scale})}return this.border}},{key:"disableBoundlessEvent",get:function get(){return this.continuityNode.disable},set:function set(e){this.continuityNode.disable=e}},{key:"transformCamera",value:function transformCamera(e){var _this165=this;this.isPaddingCameraOperations?this.paddingCameraOperation=function(){return _this165.executeTransformCamera(e)}:this.executeTransformCamera(e)}},{key:"executeTransformCamera",value:function executeTransformCamera(e){var t=e;if(t.boundCamera){var _this$screen$camera=this.screen.camera,i=_this$screen$camera.centerX,_r90=_this$screen$camera.centerY,n=_this$screen$camera.scale,s={centerX:tr(t.centerX,i),centerY:tr(t.centerY,_r90),scale:tr(t.scale,n)},_this$cameraView$scre=this.cameraView.screenSize,o=_this$cameraView$scre.width,a=_this$cameraView$scre.height,_this$cameraView$tran=this.cameraView.transformToCombinedCamera(s,{x:o/2,y:a/2}),l=_this$cameraView$tran.valid;(l.centerX!==s.centerX||l.centerY!==s.centerY||l.scale!==s.scale)&&(t=je(V({},t),{centerX:l.centerX,centerY:l.centerY,scale:l.scale}))}this.screen.transformCamera(t)}},{key:"adaptRectangle",value:function adaptRectangle(e){var _this166=this;this.isPaddingCameraOperations?this.paddingCameraOperation=function(){return _this166.screen.adaptRectangle(e)}:this.screen.adaptRectangle(e)}},{key:"release",value:function release(){this.didRelease||(this.sorter&&this.sorter.cancel(),this.eventProxy.removeListener(this.onBoundlessEvent),this.screen.removeScreenUpdatedListener(this.onScreenUpdatedListener),this.afterWheelDelayer.cancel(),this.didRelease=!0)}},{key:"handleBoundlessEventWhenItIsDesktop",value:function handleBoundlessEventWhenItIsDesktop(e){switch(e.kind){case S.MouseWheel:{this.onMouseWheel(e);break}case S.TouchStart:case S.TouchMove:case S.TouchEnd:case S.TouchCancel:break;case S.KeyDown:case S.KeyUp:{this.handTool.isKeyEvent(e)?this.handTool.handleKeyEvent(e):this.dispatchBoundlessEvent(e);break}default:this.dispatchBoundlessEvent(e);}}},{key:"handleBoundlessEventWhenItIsTouch",value:function handleBoundlessEventWhenItIsTouch(e){switch(e.kind){case S.TouchStart:case S.TouchMove:case S.TouchEnd:case S.TouchCancel:{this.sorter.pushTouchEvent(e);break}case S.MouseDown:case S.MouseUp:case S.MouseMove:case S.MouseLeave:break;case S.KeyDown:case S.KeyUp:{this.handTool.isKeyEvent(e)?this.handTool.handleKeyEvent(e):this.dispatchBoundlessEvent(e);break}default:this.dispatchBoundlessEvent(e);}}},{key:"handleBoundlessEventWhenItIsSurface",value:function handleBoundlessEventWhenItIsSurface(e){switch(e.kind){case S.MouseWheel:{this.onMouseWheel(e);break}case S.TouchStart:case S.TouchMove:case S.TouchEnd:case S.TouchCancel:{this.sorter.pushTouchEvent(e);break}case S.MouseDown:case S.MouseUp:case S.MouseMove:case S.MouseLeave:default:this.dispatchBoundlessEvent(e);}}},{key:"onMouseWheel",value:function onMouseWheel(e){if(this.disableCameraTransform)return;var _this$screen$camera2=this.screen.camera,t=_this$screen$camera2.centerX,i=_this$screen$camera2.centerY,r=_this$screen$camera2.scale;if(e.scale!==0){var o=1+e.scale,a=e.pointOnScreen.x,l=e.pointOnScreen.y,h=(1-1/o)/r;t+=h*(a-this.screen.width/2),i+=h*(l-this.screen.height/2),r*=o}t-=e.offsetPoint.x/r,i-=e.offsetPoint.y/r;var n=this.cameraView.transformToCombinedCamera({centerX:t,centerY:i,scale:r},e.pointOnScreen),s=je(V({},this.cameraAppendBorderTransform(n.valid)),{animationMode:$.Immediately,operatorId:this.operatorId});this.transformationEventDispatcher.dispatch(fi.Begin),this.afterWheelDelayer.refreshAndInvokeAfterInterval(Ay.RefreshTimeoutOnDesktop),this.screen.setCameraTransfrom(s,!0)}},{key:"cameraAppendBorderTransform",value:function cameraAppendBorderTransform(e){if(this.transformer){var t=this.transformer.transform;return Object.freeze({centerX:e.centerX+t.deltaX,centerY:e.centerY+t.deltaY,scale:e.scale*t.scale})}else return e}},{key:"addHandToolActiveListener",value:function addHandToolActiveListener(e){this.handToolActiveEventDispatcher.addListener(e)}},{key:"removeHandToolActiveListener",value:function removeHandToolActiveListener(e){this.handToolActiveEventDispatcher.removeListener(e)}},{key:"addCameraTransformationListener",value:function addCameraTransformationListener(e){this.transformationEventDispatcher.addListener(e)}},{key:"removeCameraTransformationListener",value:function removeCameraTransformationListener(e){this.transformationEventDispatcher.removeListener(e)}},{key:"addBoundlessEventListener",value:function addBoundlessEventListener(e){this.boundlessEventDispatcher.addListener(e)}},{key:"removeBoundlessEventListener",value:function removeBoundlessEventListener(e){this.boundlessEventDispatcher.removeListener(e)}},{key:"addPreTouchEventListener",value:function addPreTouchEventListener(e){this.preEndTouchEventDisplayer.addListener(e)}},{key:"removePreTouchEventListener",value:function removePreTouchEventListener(e){this.preEndTouchEventDisplayer.removeListener(e)}}]);return Ay}(),Oy=Ay;Oy.RefreshTimeoutOnDesktop=200;function fo(e,t){var i=e.indexOf(t);i!==-1&&e.splice(i,1)}function Ry(e,t){e.indexOf(t)===-1&&e.push(t)}var tP=/*#__PURE__*/function(){function tP(){var _this167=this;_classCallCheck(this,tP);this.animationPriorities=[],this.animations={},this.afterAnimationsInvokers=[],this.animationId=null,this.isInAnimationFrame=!1,this.onAnimationFrame=function(){try{_this167.isInAnimationFrame=!0;var _iterator167=_createForOfIteratorHelper(_this167.animationPriorities),_step167;try{for(_iterator167.s();!(_step167=_iterator167.n()).done;){var _e8=_step167.value;for(var _i37=0,_arr3=_toConsumableArray(_this167.animations[_e8]);_i37<_arr3.length;_i37++){var t=_arr3[_i37];t()}}}catch(err){_iterator167.e(err)}finally{_iterator167.f()}for(var _i36=0,_arr2=_toConsumableArray(_this167.afterAnimationsInvokers);_i36<_arr2.length;_i36++){var e=_arr2[_i36];e()}_this167.animationPriorities.length>0?_this167.animationId=window.requestAnimationFrame(_this167.onAnimationFrame):_this167.animationId=null}finally{_this167.isInAnimationFrame=!1}}}_createClass(tP,[{key:"addAnimation",value:function addAnimation(e,t){var i=this.animations[e],r=!1;i||(i=this.animations[e]=[],this.animationPriorities.push(e),this.animationPriorities.sort(),r=this.animationPriorities.length===1),Ry(i,t),r&&this.animationId===null&&(this.animationId=window.requestAnimationFrame(this.onAnimationFrame))}},{key:"removeAnimation",value:function removeAnimation(e,t){var i=this.animations[e];i&&(fo(i,t),i.length===0&&(delete this.animations[e],fo(this.animationPriorities,e),this.animationPriorities.length===0&&!this.isInAnimationFrame&&this.animationId!==null&&(window.cancelAnimationFrame(this.animationId),this.animationId=null)))}},{key:"addAfterAnimationsInvoker",value:function addAfterAnimationsInvoker(e){Ry(this.afterAnimationsInvokers,e)}},{key:"removeAfterAnimationsInvoker",value:function removeAfterAnimationsInvoker(e){fo(this.afterAnimationsInvokers,e)}}]);return tP}(),rr=/*#__PURE__*/function(){function rr(){_classCallCheck(this,rr)}_createClass(rr,[{key:"createAnimationGroup",value:function createAnimationGroup(){return new iP}},{key:"createAnimation",value:function createAnimation(e,t){return new Ny(e,t)}},{key:"createAnimationFrameInvoker",value:function createAnimationFrameInvoker(e){return new rP(e)}},{key:"createAfterAnimationsInvoker",value:function createAfterAnimationsInvoker(e){return new Ly(e)}}]);return rr}();rr.animationFrames=new tP;var iP=/*#__PURE__*/function(){function iP(){_classCallCheck(this,iP);this.children=[]}_createClass(iP,[{key:"createAnimation",value:function createAnimation(e,t){var _this168=this;var i=new Ny(e,t,function(r){return fo(_this168.children,r)});return this.children.push(i),i}},{key:"createAfterAnimationsInvoker",value:function createAfterAnimationsInvoker(e){var _this169=this;var t=new Ly(e,function(i){return fo(_this169.children,i)});return this.children.push(t),t}},{key:"release",value:function release(){var _iterator168=_createForOfIteratorHelper(this.children.splice(0)),_step168;try{for(_iterator168.s();!(_step168=_iterator168.n()).done;){var e=_step168.value;e.release()}}catch(err){_iterator168.e(err)}finally{_iterator168.f()}}}]);return iP}(),Ny=/*#__PURE__*/function(){function Ny(e,t,i){var _this170=this;_classCallCheck(this,Ny);this.priority=e,this.onRefresh=t,this.onRelease=i,this.onAnimationFrame=function(){kd(_this170,_this170.onRefresh)},rr.animationFrames.addAnimation(this.priority,this.onAnimationFrame)}_createClass(Ny,[{key:"release",value:function release(){rr.animationFrames.removeAnimation(this.priority,this.onAnimationFrame),this.onRelease&&this.onRelease(this)}}]);return Ny}(),Ly=/*#__PURE__*/function(){function Ly(e,t){var _this171=this;_classCallCheck(this,Ly);this.onRefresh=e,this.onRelease=t,this.onAnimationFrame=function(){kd(_this171,_this171.onRefresh)},rr.animationFrames.addAfterAnimationsInvoker(this.onAnimationFrame)}_createClass(Ly,[{key:"release",value:function release(){rr.animationFrames.removeAfterAnimationsInvoker(this.onAnimationFrame),this.onRelease&&this.onRelease(this)}}]);return Ly}(),rP=/*#__PURE__*/function(){function rP(e){var _this172=this;_classCallCheck(this,rP);this.priority=e,this.nextHandler=null,this.banAnimationChange=!1,this.onAnimationFrame=function(){if(_this172.nextHandler){var t=_this172.nextHandler;_this172.nextHandler=null;try{_this172.banAnimationChange=!0,kd(_this172,t)}finally{_this172.banAnimationChange=!1}_this172.nextHandler===null&&rr.animationFrames.removeAnimation(_this172.priority,_this172.onAnimationFrame)}}}_createClass(rP,[{key:"invoke",value:function invoke(e){!this.banAnimationChange&&!this.nextHandler&&rr.animationFrames.addAnimation(this.priority,this.onAnimationFrame),this.nextHandler=e}},{key:"release",value:function release(){!this.banAnimationChange&&this.nextHandler&&(this.nextHandler=null,rr.animationFrames.removeAnimation(this.priority,this.onAnimationFrame))}}]);return rP}(),Dy=new rr;function kd(e,t){try{t(e)}catch(i){console.error(i)}}function By(e){var t=Math.abs(e),i=1/(1+t/2),r=i*Math.exp(-t*t-1.26551223+i*(1.00002368+i*(.37409196+i*(.09678418+i*(-.18628806+i*(.27886807+i*(-1.13520398+i*(1.48851587+i*(-.82215223+i*.17087277)))))))));return e>=0?r:2-r}function nP(e){if(e>=2)return-100;if(e<=0)return 100;var t=e<1?e:2-e,i=Math.sqrt(-2*Math.log(t/2)),r=-.70711*((2.30753+i*.27061)/(1+i*(.99229+i*.04481))-i);for(var n=0;n<2;n++){var s=By(r)-t;r+=s/(1.1283791670955126*Math.exp(-(r*r))-r*s)}return e<1?r:-r}function go(e,t){return new sP(e,t)}function Fy(e,t){return go(t/e,1/e)}var sP=/*#__PURE__*/function(){function sP(e,t){_classCallCheck(this,sP);this.mean=e,this.variance=t,this.standardDeviation=Math.sqrt(t)}_createClass(sP,[{key:"pdf",value:function pdf(e){var t=this.standardDeviation*Math.sqrt(2*Math.PI);return Math.exp(-Math.pow(e-this.mean,2)/(2*this.variance))/t}},{key:"cdf",value:function cdf(e){return .5*By(-(e-this.mean)/(this.standardDeviation*Math.sqrt(2)))}},{key:"ppf",value:function ppf(e){return this.mean-this.standardDeviation*Math.sqrt(2)*nP(2*e)}},{key:"mul",value:function mul(e){if(typeof e=="number")return this.scale(e);var t=1/this.variance,i=1/e.variance;return Fy(t+i,t*this.mean+i*e.mean)}},{key:"div",value:function div(e){if(typeof e=="number")return this.scale(1/e);var t=1/this.variance,i=1/e.variance;return Fy(t-i,t*this.mean-i*e.mean)}},{key:"add",value:function add(e){return go(this.mean+e.mean,this.variance+e.variance)}},{key:"sub",value:function sub(e){return go(this.mean-e.mean,this.variance+e.variance)}},{key:"scale",value:function scale(e){return go(this.mean*e,this.variance*e*e)}}]);return sP}(),jy=/*#__PURE__*/function(){function jy(){_classCallCheck(this,jy);for(var _len18=arguments.length,e=new Array(_len18),_key18=0;_key18<_len18;_key18++){e[_key18]=arguments[_key18]}this.configurations=Object.freeze(e.map(function(t){return Object.freeze(V({},t))}))}_createClass(jy,[{key:"create",value:function create(e,t,i){return new zy(e,_toConsumableArray(this.configurations),t,i)}}]);return jy}(),nr=/*#__PURE__*/function(){function nr(e,t,i,r){var _this173=this;_classCallCheck(this,nr);this.priority=e,this._point=i,this.onPointUpdate=r,this.completeTick=!1,this.playingAnimation=null,this.updateIdealPoint=function(a){nr.setPoint(_this173.idealPoint,a),!_this173.playingAnimation&&_this173.shouldContinueMoving()&&(_this173.playingAnimation=Dy.createAnimation(_this173.priority,_this173.onTick)),_this173.completeTick=!1},this.onTick=function(){if(_this173.completeTick)_this173.stop();else{_this173.executePhysicalSimulate();var a=!_this173.shouldContinueMoving();_this173.onPointUpdate&&_this173.onPointUpdate(_this173._point,a),a&&(_this173.completeTick=!0)}};var _t$splice=t.splice(0,1),_t$splice2=_slicedToArray(_t$splice,1),n=_t$splice2[0];this.configuration=n,this._point=_toConsumableArray(i),this.idealPoint=_toConsumableArray(i),this.velocity=i.map(function(){return 0}),t.length>0&&(this.guider=new nr(this.priority,t,i,this.updateIdealPoint));var s=this.configuration.pedesisSpeedMean,o=this.configuration.pedesisSpeedVariance;s!==0&&o!==0?this.gaussian=go(s,o):this.gaussian=null,this.noPedesisRadius=(s+Math.sqrt(o))*nr.noPedesisRadiusRate}_createClass(nr,[{key:"point",get:function get(){return this._point}},{key:"isPlayingAnimation",get:function get(){return!!this.playingAnimation}},{key:"moveRightNow",value:function moveRightNow(e){this.guider&&this.guider.moveRightNow(e),nr.setPoint(this.idealPoint,e),nr.setPoint(this._point,e),nr.setPointZero(this.velocity),this.playingAnimation&&(this.playingAnimation.release(),this.playingAnimation=null),this.completeTick=!1}},{key:"moveTo",value:function moveTo(e){this.guider?this.guider.moveTo(e):this.updateIdealPoint(e)}},{key:"moveToAndChangeCoordinate",value:function moveToAndChangeCoordinate(e,t){for(var i=0;i<this._point.length;++i){this._point[i]+=e[i]}this.guider?this.guider.moveToAndChangeCoordinate(e,t):this.updateIdealPoint(t)}},{key:"stop",value:function stop(){nr.setPoint(this.idealPoint,this._point),nr.setPointZero(this.velocity),this.playingAnimation&&(this.playingAnimation.release(),this.playingAnimation=null),this.completeTick=!1}},{key:"executePhysicalSimulate",value:function executePhysicalSimulate(){var e=this.squareDistanceToIdealPoint(),t=this.velocityDamping(e),i=e>this.noPedesisRadius*this.noPedesisRadius;for(var _r91=0;_r91<this._point.length;++_r91){var n=this.idealPoint[_r91]-this._point[_r91],s=this.configuration.kDistance*n;if(this.velocity[_r91]+=s,i&&this.gaussian){var o=this.gaussian.ppf(Math.random());Math.random()>=.5&&(o=-o),this.velocity[_r91]+=o}this._point[_r91]+=this.velocity[_r91],this.velocity[_r91]*=1-t}}},{key:"velocityDamping",value:function velocityDamping(e){var t=0;for(var n=0;n<this.velocity.length;++n){t+=this.velocity[n]*this.velocity[n]}var _this$configuration=this.configuration,i=_this$configuration.heavyDampingRadius,r=_this$configuration.heavyDampingSpeed;return t<r*r||e>i*i?this.configuration.velocityDamping:Math.min(1,t*this.configuration.velocityDamping)}},{key:"squareDistanceToIdealPoint",value:function squareDistanceToIdealPoint(){var e=0;for(var t=0;t<this.velocity.length;++t){var i=this.idealPoint[t]-this._point[t];e+=i*i}return e}},{key:"shouldContinueMoving",value:function shouldContinueMoving(){for(var e=0;e<this._point.length;++e){if(Math.abs(this._point[e]-this.idealPoint[e])>this.configuration.matchingDistance||Math.abs(this.velocity[e])>this.configuration.zeroSpeed)return!0}return!1}}],[{key:"setPoint",value:function setPoint(e,t){for(var i=0;i<e.length;++i){i in t?e[i]=t[i]:e[i]=0}}},{key:"setPointZero",value:function setPointZero(e){for(var t=0;t<e.length;++t){e[t]=0}}}]);return nr}(),zy=nr;zy.noPedesisRadiusRate=2.7;var yo;(function(e){e[e.ComponentMoving=0]="ComponentMoving",e[e.CameraMoving=1]="CameraMoving",e[e.Rendering=2]="Rendering"})(yo||(yo={}));var Rr=/*#__PURE__*/function(){function Rr(e,t){var _this174=this;_classCallCheck(this,Rr);this.referPoint=[],this._isTransition=!1;var i=t&&function(r,n){var s=_this174.convertPointToCamera(r,n),o=_this174._isTransition||!n;t(s,o,_this174.currentOperatorId),n&&(_this174.currentOperatorId=void 0)};this.referPoint[0]=e.centerX,this.referPoint[1]=e.centerY,this.referPoint[2]=e.scale*Rr.kScale,this.spaceSpring=Rr.spaceSpringFactory.create(yo.CameraMoving,[0,0,0],i)}_createClass(Rr,[{key:"isTransition",get:function get(){return this._isTransition}},{key:"convertPointToCamera",value:function convertPointToCamera(e,t){return t?{centerX:this.referPoint[0],centerY:this.referPoint[1],scale:this.referPoint[2]/Rr.kScale}:{centerX:this.referPoint[0]+e[0],centerY:this.referPoint[1]+e[1],scale:(this.referPoint[2]+e[2])/Rr.kScale}}},{key:"moveTo",value:function moveTo(e,t,i){var r=[this.referPoint[0]-e.centerX,this.referPoint[1]-e.centerY,this.referPoint[2]-e.scale*Rr.kScale];this._isTransition=t,this.currentOperatorId=i,this.referPoint[0]=e.centerX,this.referPoint[1]=e.centerY,this.referPoint[2]=e.scale*Rr.kScale,this.spaceSpring.moveToAndChangeCoordinate(r,[0,0,0])}},{key:"moveToRightNow",value:function moveToRightNow(e,t){this._isTransition=t,this.referPoint[0]=e.centerX,this.referPoint[1]=e.centerY,this.referPoint[2]=e.scale*Rr.kScale,this.spaceSpring.moveRightNow([0,0,0])}}]);return Rr}(),xd=Rr;xd.kScale=700,xd.spaceSpringFactory=new jy({matchingDistance:2,zeroSpeed:.55,kDistance:.17,velocityDamping:.55,heavyDampingRadius:15,heavyDampingSpeed:.25,pedesisSpeedMean:0,pedesisSpeedVariance:0},{matchingDistance:2,zeroSpeed:.55,kDistance:.12,velocityDamping:.35,heavyDampingRadius:15,heavyDampingSpeed:.35,pedesisSpeedMean:0,pedesisSpeedVariance:0});function Vy(e,t){var i=t;var _iterator169=_createForOfIteratorHelper(e),_step169;try{for(_iterator169.s();!(_step169=_iterator169.n()).done;){var _r92=_step169.value;i=(0,Uy.createElement)(_r92,null,i)}}catch(err){_iterator169.e(err)}finally{_iterator169.f()}return i}function Id(e){var t={};var _iterator170=_createForOfIteratorHelper(e.engines),_step170;try{var _loop24=function _loop24(){var i=_step170.value;t[i.id]=i.createRenderLayout({screen:e.screen,tree:e.tree,mode:e.mode,initCamera:e.initCamera,visions:e.visions,leafFilter:function leafFilter(r){return r.value.isVisible(i)},onRenderDuration:e.onRenderDuration})};for(_iterator170.s();!(_step170=_iterator170.n()).done;){_loop24()}}catch(err){_iterator170.e(err)}finally{_iterator170.f()}return t}var oP=/*#__PURE__*/function(){function oP(e){_classCallCheck(this,oP);this.className=e.screen.className,this.layouts=Object.freeze(Id({tree:e.tree,screen:e.screen,initCamera:e.initCamera,visions:e.visions,engines:e.engines,onRenderDuration:e.onRenderDuration,mode:Er.Preview}))}_createClass(oP,[{key:"render",value:function render(e){var t=[],i={width:"100%",height:"100%",position:"relative"};for(var _r93 in this.layouts){var n=this.layouts[_r93].getRender();t.push((0,Pd.createElement)(n,{key:_r93}))}return Vy(e,(0,Pd.createElement)("div",{className:this.className,style:i},t))}}]);return oP}(),Nr;(function(e){var t;(function(o){o[o.Disjoint=0]="Disjoint",o[o.Cross=1]="Cross",o[o.IncludeRectangle=2]="IncludeRectangle",o[o.IncludeByRectangle=3]="IncludeByRectangle"})(t=e.Result||(e.Result={}));function i(o,a,l,h,d,u){var p=o+l,f=a+h;return d>=o&&d<=p&&u>=a&&u<=f}e.testPoint=i;function r(o,a,l,h,d,u,p,f){var m=Hy(o,o+l,d,d+p),g=Hy(a,a+h,u,u+f);return m===0||g===0?0:m===1||g===1?1:m===2&&g===2?2:m===3&&g===3?3:1}e.testRectangle=r;function n(o,a,l,h,d){d(o,a),d(o+l,a),d(o+l,a+h),d(o,a+h)}e.iterate=n;function s(o,a,l,h){return[{x:o,y:a},{x:o+l,y:a},{x:o+l,y:a+h},{x:o,y:a+h}]}e.allPoints=s})(Nr||(Nr={}));function Hy(e,t,i,r){var n=e,s=t,o=i,a=r,l=n>o;if(l){var h=n,d=s;n=o,o=h,s=a,a=d}return s<o?Nr.Result.Disjoint:s<a?Nr.Result.Cross:l?Nr.Result.IncludeByRectangle:Nr.Result.IncludeRectangle}var aP=/*#__PURE__*/function(){function aP(e){_classCallCheck(this,aP);this.component=null,this.componentState={className:e.screen.className},this.layouts=Object.freeze(Id({tree:e.tree,screen:e.screen,engines:e.engines,visions:e.visions,onRenderDuration:e.onRenderDuration,mode:Er.Normal})),this.logger=e.screen.scene.logger,this.renderClass=this.createRender()}_createClass(aP,[{key:"setState",value:function setState(e){var t;this.componentState=V({},e),(t=this.component)==null||t.setState(e)}},{key:"renderLayouts",get:function get(){return this.layouts}},{key:"getRender",value:function getRender(){return this.renderClass}},{key:"createRender",value:function createRender(){var e={self:this};var t=/*#__PURE__*/function(_pn$Component){_inherits(t,_pn$Component);var _super46=_createSuper(t);function t(r){var _this175;_classCallCheck(this,t);_this175=_super46.call(this,r);_this175.state=V({},e.self.componentState),e.self.component=_assertThisInitialized(_this175);return _this175}_createClass(t,[{key:"componentWillUnmount",value:function componentWillUnmount(){e.self.component=null,e.self=null}},{key:"render",value:function render(){var r=[],_this$state4=this.state,n=_this$state4.className,s=_this$state4.style,o=je(V({},s),{width:"100%",height:"100%",position:"relative",overflow:"hidden"});for(var a in e.self.layouts){r.push((0,pn.createElement)(lP,{key:a,logger:e.self.logger,layout:e.self.layouts[a]}))}return(0,pn.createElement)("div",{className:n,style:o,tabIndex:-1},r)}}]);return t}(pn.Component);return t}}]);return aP}(),lP=/*#__PURE__*/function(_pn$Component2){_inherits(lP,_pn$Component2);var _super47=_createSuper(lP);function lP(e){var _this176;_classCallCheck(this,lP);_this176=_super47.call(this,e);_this176.state={error:void 0};return _this176}_createClass(lP,[{key:"shouldComponentUpdate",value:function shouldComponentUpdate(e,t){var i=this.props.layout,r=this.state.error;return i!==e.layout||r!==t.error}},{key:"componentDidCatch",value:function componentDidCatch(e,t){var _this$props11=this.props,i=_this$props11.layout,r=_this$props11.logger;r.error("boundless layout ".concat(i.engine.id," render catch error:"),e," stack: ",t.componentStack)}},{key:"render",value:function render(){var e=this.props.layout,t=this.state.error;if(t)return null;{var i=e.getRender();return(0,pn.createElement)(i,null)}}}],[{key:"getDerivedStateFromError",value:function getDerivedStateFromError(e){return console.error(e),{error:e}}}]);return lP}(pn.Component),cP=/*#__PURE__*/function(){function cP(e,t,i,r,n){_classCallCheck(this,cP);var s={};var _loop25=function _loop25(o){var a=e.renderLayouts[o],l={};t.forEach(function(h){h.value.isVisible(a.engine)&&(l[h.id]=!0)}),s[o]=Object.seal({layout:a,visibleSet:l})};for(var o in e.renderLayouts){_loop25(o)}this.camera=r,this.screenSize=n,this.context=i,this.engineNodes=Object.freeze(s)}_createClass(cP,[{key:"flush",value:function flush(e){var t,i,r;pi(this.camera,e.camera)||(t=this.camera=e.camera),pi(this.screenSize,e.screenSize)||(i=this.screenSize=e.screenSize),this.context!==e.context&&(r=this.context=e.context);for(var n in this.engineNodes){this.flushEngine(this.engineNodes[n],e,r,t,i)}}},{key:"flushEngine",value:function flushEngine(e,t,i,r,n){var s=e.visibleSet,o=e.layout.engine,a=t.testSet,l=t.updateSet,h=t.moveSet,d=t.isTransition,_t$diff=t.diff,u=_t$diff.addedSet,p=_t$diff.removedSet,f=[],m=[],g=[];for(var w in u){u[w].value.isVisible(o)?s[w]=!0:g.push(w)}for(var _w2 in a){var M=a[_w2],x=M.treeNode,T=M.isVisible(o),O=(_w2 in s);O&&!T?(m.push(x),delete s[_w2]):!O&&T&&(f.push(x),s[_w2]=!0)}for(var _w3 in p){delete s[_w3]}var y=t.diff.decorate({insertToAdded:f,insertToRemoved:m,maskAdded:g}),b={},v={};for(var _w4 in l){_w4 in s&&(b[_w4]=l[_w4].treeNode)}for(var _w5 in h){_w5 in s&&(v[_w5]=h[_w5].treeNode)}e.layout.update({context:i,camera:r,screenSize:n,isTransition:d,diff:y,updateSet:b,moveSet:v})}}]);return cP}(),hP=/*#__PURE__*/function(){function hP(e){var _this177=this;_classCallCheck(this,hP);this.frameInvoker=Dy.createAnimationFrameInvoker(yo.Rendering),this.didReceiveTransitionFalse=!1,this.onFrameInvoke=function(){var t=!_this177.didReceiveTransitionFalse;_this177.didReceiveTransitionFalse=!1,_this177.frameHandler(t)},this.frameHandler=e}_createClass(hP,[{key:"release",value:function release(){this.frameInvoker.release()}},{key:"fire",value:function fire(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!1;e||(this.didReceiveTransitionFalse=!0),this.frameInvoker.invoke(this.onFrameInvoke)}}]);return hP}();function _y(e,t,i,r){var n=Gy(t),s=e.treeNode;Md(s,n,i,r)}function dP(e,t,i,r){switch(e.kind){case Ri.Component:{var n=e,s=n.treeNode.parent,o=Ky(s,t);if(o){var a=Td(e,o);a?i(n,a):r(n)}break}case Ri.Group:{var _n36=e.treeNode,_s25=Ky(_n36,t);_s25&&Md(_n36,_s25,i,r);break}}}function Ky(e,t){var i=[],r=e;for(;r.parent;){i.push(r),r=r.parent}var n=Gy(t);for(var s=i.length-1;s>=0;s--){var o=i[s].value,a=Td(o,n);if(!a){n=null;break}n=$y(n,a,o)}return n}function Md(e,t,i,r){var _iterator171=_createForOfIteratorHelper(e),_step171;try{for(_iterator171.s();!(_step171=_iterator171.n()).done;){var n=_step171.value;var s=n.value,o=Td(s,t);switch(s.kind){case Ri.Component:{var a=s;o?i(a,o):r(a);break}case Ri.Group:{if(o){var _a18=s,l=_a18.treeNode,h=$y(t,o,_a18);Md(l,h,i,r)}break}}}}catch(err){_iterator171.e(err)}finally{_iterator171.f()}}function Gy(_ref63){var e=_ref63.camera,t=_ref63.width,i=_ref63.height;var r={dx:0,dy:0,scale:1},n={dx:-(e.centerX-t/e.scale/2)*e.scale,dy:-(e.centerY-i/e.scale/2)*e.scale,scale:e.scale};return{scene:r,screen:n,rect:{originX:0,originY:0,width:t,height:i},tailor:{left:0,right:0,top:0,bottom:0},absolute:uP(t,i)}}function uP(e,t){var i={dx:0,dy:0,scale:1},r={dx:e/2,dy:t/2,scale:1},n={scene:i,screen:r,rect:{originX:0,originY:0,width:e,height:t},tailor:{left:0,right:0,top:0,bottom:0},absolute:null};return n.absolute=n,n}function $y(e,_ref64,n){var t=_ref64.sceneRect,i=_ref64.screenRect,r=_ref64.tailor;var s={dx:t.originX,dy:t.originY,scale:e.scene.scale*n.scale},o={dx:i.originX,dy:i.originY,scale:e.screen.scale*n.scale};return{scene:s,screen:o,rect:i,tailor:r,absolute:e.absolute}}function Td(e,t){if(e.kind===Ri.Component&&!e.isVisible())return null;var i=t,r;e.absoluteCoordinates&&(i=i.absolute),e instanceof cl&&(r=e.rotation);var _i38=i,n=_i38.scene,_i38$screen=_i38.screen,s=_i38$screen.scale,o=_i38$screen.dx,a=_i38$screen.dy,l=pP(e,s),_Yy=Yy(e.originX*s+o-l.left,e.originY*s+a-l.top,e.width*s+l.left+l.right,e.height*s+l.top+l.bottom,r),h=_Yy.originX,d=_Yy.originY,u=_Yy.width,p=_Yy.height,f=i.rect,m=i.tailor,g=f.originX+m.left-h,y=f.originY+m.top-d,b=h+u-(f.originX+f.width-m.right),v=d+p-(f.originY+f.height-m.bottom);if(!e.disableVisionTrim&&(g>=u||b>=u||g+b>=u||y>=p||v>=p||y+v>=p))return null;var w={left:g,top:y,right:b,bottom:v},M={originX:h,originY:d,width:u,height:p},x=Xy(e,s),T=Yy(e.originX+n.dx-x.left,e.originY+n.dy-x.top,e.width*n.scale+x.left+x.right,e.height*n.scale+x.top+x.bottom,r);return{margin:l,scale:s,tailor:w,sceneRect:T,screenRect:M,rotation:r}}function Yy(e,t,i,r,n){if(n===void 0)return{originX:e,originY:t,width:i,height:r};{var s=i/2,o=r/2,a=-s,l=o,h=-s,d=-o,u=s,p=-o,f=s,m=o,g=Math.cos(n),y=Math.sin(n),b=a*g+l*y,v=l*g-a*y,w=h*g+d*y,M=d*g-h*y,x=u*g+p*y,T=p*g-u*y,O=f*g+m*y,R=m*g-f*y,W=Math.min(b,w,x,O),J=Math.max(b,w,x,O),ee=Math.min(v,M,T,R),z=Math.max(v,M,T,R),Re=e+s,Ht=t+o;return{originX:Re+W,originY:Ht+ee,width:J-W,height:z-ee}}}function pP(e,t){var i=e.sceneMargin,r=e.parallaxMargin,n=i.left*t+r.left,s=i.top*t+r.top,o=i.right*t+r.right,a=i.bottom*t+r.bottom;return Object.freeze({left:n,right:o,top:s,bottom:a})}function Xy(e,t){var i=e.sceneMargin,r=e.parallaxMargin,n=i.left+r.left/t,s=i.top+r.top/t,o=i.right+r.right/t,a=i.bottom+r.bottom/t;return Object.freeze({left:n,right:o,top:s,bottom:a})}function Ed(e,t,i){_y(t,i,function(r,n){e.bindVision(r.treeNode,n)},function(){})}var mP=/*#__PURE__*/function(){function mP(e){var _this178=this;_classCallCheck(this,mP);this.isCameraUpdated=!1,this.toTestAppearSet={},this.toTestVisibleSet={},this.toUpdateSet={},this.toSortSet={},this.toMoveSet={},this.toShowSet={},this.toHideSet={},this.onScreenUpdate=function(r){pi(_this178.screenState,r)||(_this178.isCameraUpdated=!0,_this178.screenState=r,_this178.refreshFrameNode.fire(r.isTransition))},this.onGroupSorted=function(r){_this178.toSortSet[r.treeNode.id]=r,_this178.refreshFrameNode.fire()},this.onComponentUpdate=function(_ref65){var r=_ref65.node,n=_ref65.behavior;switch(n){case _e.Removed:{delete _this178.toTestAppearSet[r.treeNode.id],delete _this178.toUpdateSet[r.treeNode.id],delete _this178.toTestVisibleSet[r.treeNode.id];break}case _e.Added:case _e.AppearUpdated:{_this178.toTestAppearSet[r.treeNode.id]=r;break}case _e.VisibleUpdated:{r instanceof cl&&(_this178.toTestVisibleSet[r.treeNode.id]=r);break}case _e.PropertiesUpdated:{r instanceof cl&&(_this178.toUpdateSet[r.treeNode.id]=r);break}}_this178.refreshFrameNode.fire()},this.handleFrame=function(r){try{_this178.sortAllGroups();var n=_this178.diffBuffer.fetchDiff();_this178.testComponents(n);var s=_this178.commitVisibleAndDecorateDiff(n);_this178.notify(s,r),_this178.cleanSet(),_this178.visions.completeFrame()}catch(n){_this178.logger.error(n)}},this.refreshComponent=function(r,n){var s=r.treeNode.id,o=_this178.visions.leaf(s),a=_this178.visions.vision(s);if(!a)_this178.toShowSet[s]={component:r,vision:n};else{var l=a.sceneRect,h=o.value;(!pi(l,n.sceneRect)||!pi(h.parallaxMargin,r.parallaxMargin)||!pi(h.sceneMargin,r.sceneMargin))&&(_this178.toMoveSet[s]={component:r,vision:n})}o&&_this178.visions.bindVision(o,n)},this.removeComponent=function(r){var n=r.treeNode;_this178.visions.includes(n.id)&&(_this178.toHideSet[n.id]=r),_this178.visions.unbindVision(n.id)},this.screen=e.screen,this.visions=e.visions,this.logger=this.screen.scene.logger,this.tree=this.screen.scene.tree,this.diffBuffer=this.tree.createDiffBuffer(),this.screenState={width:this.screen.width,height:this.screen.height,camera:Object.freeze(V({},this.screen.camera)),visionRectangle:this.screen.visionRectangle,isTransition:!1},Ed(this.visions,this.screen.scene,this.screenState),this.renderer=new aP({screen:this.screen,engines:e.engines,tree:this.tree,visions:this.visions,onRenderDuration:e.onRenderDuration});var _this$screen=this.screen,t=_this$screen.context,i=_this$screen.camera;this.notifier=new cP(this.renderer,this.visions,t,i,Object.freeze({width:this.screen.width,height:this.screen.height})),this.refreshFrameNode=new hP(this.handleFrame),this.screen.addScreenUpdatedListener(this.onScreenUpdate),this.screen.scene.addGroupSortedListener(this.onGroupSorted),this.screen.scene.addComponentUpdateListener(this.onComponentUpdate)}_createClass(mP,[{key:"willInterruptEvent",value:function willInterruptEvent(e,t){for(var i in this.renderer.renderLayouts){if(this.renderer.renderLayouts[i].willInterruptEvent(this.screen,e,t))return!0}return!1}},{key:"findComponentWithTarget",value:function findComponentWithTarget(e){for(var t in this.renderer.renderLayouts){var i=this.renderer.renderLayouts[t],_r94=i.findComponentWithTarget(e);if(_r94)return{component:_r94,engine:i.engine}}}},{key:"forEachVisibleComponent",value:function forEachVisibleComponent(e){var _iterator172=_createForOfIteratorHelper(this.tree),_step172;try{for(_iterator172.s();!(_step172=_iterator172.n()).done;){var t=_step172.value;e(t.value)}}catch(err){_iterator172.e(err)}finally{_iterator172.f()}}},{key:"release",value:function release(){this.refreshFrameNode.release(),this.diffBuffer.release(),this.screen.removeScreenUpdatedListener(this.onScreenUpdate),this.screen.scene.removeGroupSortedListener(this.onGroupSorted),this.screen.scene.removeComponentUpdateListener(this.onComponentUpdate)}},{key:"refreshScreenContext",value:function refreshScreenContext(){this.refreshFrameNode.fire()}},{key:"sortAllGroups",value:function sortAllGroups(){for(var e in this.toSortSet){this.toSortSet[e].sortIfNeed()}}},{key:"testComponents",value:function testComponents(e){for(var t in e.removedSet){this.visions.includes(t)&&(this.toHideSet[t]=e.removedSet[t].value)}if(this.isCameraUpdated)_y(this.screen.scene,this.screenState,this.refreshComponent,this.removeComponent),this.isCameraUpdated=!1;else for(var _t13 in this.toTestAppearSet){var i=this.toTestAppearSet[_t13];i.treeNode.parent&&dP(i,this.screenState,this.refreshComponent,this.removeComponent)}}},{key:"commitVisibleAndDecorateDiff",value:function commitVisibleAndDecorateDiff(e){var t=[],i=[],r=[];for(var n in this.toShowSet){var _this$toShowSet$n=this.toShowSet[n],s=_this$toShowSet$n.vision,o=_this$toShowSet$n.component,a=o.treeNode;e.addedSet[n]||t.push(a),this.visions.bindVision(a,s)}for(var _n37 in this.toMoveSet){var _this$toMoveSet$_n=this.toMoveSet[_n37],_s26=_this$toMoveSet$_n.vision,_o18=_this$toMoveSet$_n.component,_a19=_o18.treeNode;this.visions.bindVision(_a19,_s26)}for(var _n38 in this.toHideSet){var _s27=this.toHideSet[_n38].treeNode;e.removedSet[_n38]||i.push(_s27),this.visions.unbindVision(_n38)}for(var _n39 in e.addedSet){this.visions.includes(_n39)||r.push(_n39)}return e.decorate({insertToAdded:t,insertToRemoved:i,maskAdded:r})}},{key:"notify",value:function notify(e,t){var i={};for(var _r95 in this.toMoveSet){i[_r95]=this.toMoveSet[_r95].component}for(var _r96 in this.toUpdateSet){this.visions.includes(_r96)||delete this.toUpdateSet[_r96]}for(var _r97 in this.toTestVisibleSet){this.visions.includes(_r97)||delete this.toTestVisibleSet[_r97]}this.notifier.flush({context:this.screen.context,camera:this.screenState.camera,diff:e,isTransition:t,moveSet:i,testSet:this.toTestVisibleSet,updateSet:this.toUpdateSet,screenSize:Object.freeze({width:this.screen.width,height:this.screen.height})})}},{key:"cleanSet",value:function cleanSet(){this.toTestVisibleSet={},this.toUpdateSet={},gt(this.toTestAppearSet)&&(this.toTestAppearSet={}),gt(this.toSortSet)&&(this.toSortSet={}),gt(this.toMoveSet)&&(this.toMoveSet={}),gt(this.toShowSet)&&(this.toShowSet={}),gt(this.toHideSet)&&(this.toHideSet={})}}]);return mP}(),fP=/*#__PURE__*/function(){function fP(e){_classCallCheck(this,fP);this.context=null,this.screen=e.screen,this.engines=e.engines,this.onRenderDuration=e.onRenderDuration,this.visions=new wd,this._wrappedComponents=Object.freeze(_toConsumableArray(e.wrappedComponents))}_createClass(fP,[{key:"hitTest",value:function hitTest(e,t){var _this179=this;var i=[];if(this.context){var _r98=t/this.screen.camera.scale;this.context.visibleTestNode.forEachVisibleComponent(function(n){_this179.isHitComponent(n,e,_r98)&&i.push(n.id)})}return i.reverse()}},{key:"findComponentWithTarget",value:function findComponentWithTarget(e){if(this.context)return this.context.visibleTestNode.findComponentWithTarget(e)}},{key:"willInterruptEvent",value:function willInterruptEvent(e,t){return this.context?this.context.visibleTestNode.willInterruptEvent(e,t):!1}},{key:"refreshScreenRendererState",value:function refreshScreenRendererState(e){var t;(t=this.context)==null||t.visibleTestNode.renderer.setState(e)}},{key:"refreshScreenContext",value:function refreshScreenContext(){this.context&&this.context.visibleTestNode.refreshScreenContext()}},{key:"isHitComponent",value:function isHitComponent(e,_ref66,r){var t=_ref66.x,i=_ref66.y;if(e.rotation===void 0){var n=Xy(e,this.screen.camera.scale),s=Math.max(n.left,r),o=Math.max(n.right,r),a=Math.max(n.top,r),l=Math.max(n.bottom,r),h=e.originX-s,d=e.originY-a,u=e.width+s+o,p=e.height+a+l;if(Nr.testPoint(h,d,u,p,t,i))return e.definition.hitTest(this.screen,e,t,i,r)}return!1}},{key:"divElement",get:function get(){return this.context&&this.context.divElement},set:function set(e){e!==(this.context&&this.context.divElement)&&(this.context&&(this.context.visibleTestNode.release(),(0,sl.unmountComponentAtNode)(this.context.divElement)),e?this.context=Object.freeze({divElement:e,visibleTestNode:new mP({screen:this.screen,engines:this.engines,visions:this.visions,onRenderDuration:this.onRenderDuration})}):(this.visions.clean(),this.context=null),this.refreshScreenRender())}},{key:"wrappedComponents",get:function get(){return this._wrappedComponents},set:function set(e){this._wrappedComponents!==e&&(this._wrappedComponents=Object.freeze(_toConsumableArray(e)),this.refreshScreenRender())}},{key:"refreshScreenRender",value:function refreshScreenRender(){if(this.context){var e=(0,Wy.createElement)(this.context.visibleTestNode.renderer.getRender()),t=Vy(this._wrappedComponents,e);(0,sl.render)(t,this.context.divElement)}}}]);return fP}(),gP=/*#__PURE__*/function(){function gP(e){var _this180=this;_classCallCheck(this,gP);this.screenUpdatedDispatcher=new Yt,this.cameraUpdatedDispatcher=new Yt,this.renderErrorCatchedDispatcher=new Yt,this.sizeUpdatedDispatcher=new Yt,this.centerX=0,this.centerY=0,this.scale=1,this.adaptedRectangle=null,this.dispatchUpdatedEvent=function(t,i,r){var n=_this180.convertVisionRectangle(t,_this180._width,_this180._height);_this180.screenUpdatedDispatcher.dispatch({width:_this180._width,height:_this180._height,camera:t,visionRectangle:n,isTransition:i}),_this180.cameraUpdatedDispatcher.dispatch(je(V({},t),{operatorId:r}))},this.onResize=function(t){var i=t[0];if(i){var _i$contentRect=i.contentRect,_r99=_i$contentRect.width,n=_i$contentRect.height;_this180.refreshSize(_r99,n)}},this.deviceType=e.scene.deviceType,this.scene=e.scene,this._className=e.className,this._style=e.style,this._context=e.context,this._width=e.width,this._height=e.height,this.cameraAnimation=new xd(this.camera,this.dispatchUpdatedEvent),this.eventInterrupter=e.eventInterrupter,this.onRenderDuration=e.onRenderDuration,this.updater=new fP({screen:this,engines:e.engines,wrappedComponents:e.wrappedComponents,onRenderDuration:e.onRenderDuration}),e.autoResize&&((typeof window==="undefined"?"undefined":_typeof(window))=="object"&&"string"in window?this.resizeObserver=new window.ResizeObserver(this.onResize):this.resizeObserver=new Cy.ResizeObserver(this.onResize))}_createClass(gP,[{key:"className",get:function get(){return this._className},set:function set(e){this._className!==e&&(this._className=e,this.updater.refreshScreenRendererState({className:e}))}},{key:"style",get:function get(){return this._style},set:function set(e){this._style!==e&&(this._style=e,this.updater.refreshScreenRendererState({style:e}))}},{key:"wrappedComponents",get:function get(){return this.updater.wrappedComponents},set:function set(e){this.updater.wrappedComponents=e}},{key:"width",get:function get(){return this._width}},{key:"height",get:function get(){return this._height}},{key:"divElement",get:function get(){return this.updater.divElement},set:function set(e){var t=this.updater.divElement;if(t!==e){if(this.resizeObserver&&t&&this.resizeObserver.unobserve(t),this.updater.divElement=e,e){var i=e.clientWidth,_r100=e.clientHeight;this.refreshSize(i,_r100),this.resizeObserver&&this.resizeObserver.observe(e)}this._eventProxy&&this._eventProxy.bindDivElement(e)}}},{key:"eventProxy",get:function get(){return this._eventProxy||(this._eventProxy=new Hx(this,this.eventInterrupter),this._eventProxy.bindDivElement(this.divElement)),this._eventProxy}},{key:"context",get:function get(){return this._context},set:function set(e){this._context!==e&&(this._context=e,this.updater.refreshScreenContext())}},{key:"bounding",get:function get(){if(this.divElement){var e=this.divElement.getBoundingClientRect();return{left:e.left,right:e.right,top:e.top,bottom:e.bottom,width:e.width,height:e.height}}else return{left:0,right:0,top:0,bottom:0,width:0,height:0}}},{key:"bindCameraman",value:function bindCameraman(e,t){return new Oy(this,this.eventProxy,t,e)}},{key:"convertPointToScreen",value:function convertPointToScreen(e,t){return{x:(e-this.centerX)*this.scale+this._width/2,y:(t-this.centerY)*this.scale+this._height/2}}},{key:"convertPointToScene",value:function convertPointToScene(e,t){return{x:(e-this._width/2)/this.scale+this.centerX,y:(t-this._height/2)/this.scale+this.centerY}}},{key:"cameraWithAdaptRectangle",value:function cameraWithAdaptRectangle(e,t){var i=e.originX+e.width/2,r=e.originY+e.height/2,n=this._width/e.width,s=this._height/e.height;switch((Number.isNaN(n)||n<=0)&&(n=1),(Number.isNaN(s)||s<=0)&&(s=1),t){case mi.Centering:return{centerX:i,centerY:r,scale:Math.min(n,s)};case mi.Tailor:return{centerX:i,centerY:r,scale:Math.max(n,s)};default:throw new Error("invalid adapter mode ".concat(t));}}},{key:"adaptRectangle",value:function adaptRectangle(e){if(e.width===0||e.height===0)this.transformCamera({animationMode:e.animationMode,centerX:e.originX+e.width/2,centerY:e.originY+e.height/2,scale:1,operatorId:e.operatorId});else{var t=je(V({},this.cameraWithAdaptRectangle(e,e.adapterMode)),{animationMode:e.animationMode,operatorId:e.operatorId});this.setCameraTransfrom(t,!1),this.adaptedRectangle=Object.freeze({originX:e.originX,originY:e.originY,width:e.width,height:e.height,adapterMode:e.adapterMode})}}},{key:"transformCamera",value:function transformCamera(e){this.adaptedRectangle=null,this.setCameraTransfrom(e,!1)}},{key:"setTransition",value:function setTransition(e,t){e!==this.cameraAnimation.isTransition&&this.updateCameraAnimation(this.camera,$.Immediately,e,t)}},{key:"setCameraTransfrom",value:function setCameraTransfrom(e,t){var i=po(e.centerX,this.centerX),r=po(e.centerY,this.centerY),n=po(e.scale,this.scale);(i!==this.centerX||r!==this.centerY||n!==this.scale||t!==this.cameraAnimation.isTransition)&&(this.centerX=i,this.centerY=r,this.scale=n,this.updateCameraAnimation(this.camera,e.animationMode,t,e.operatorId))}},{key:"updateCameraAnimation",value:function updateCameraAnimation(e,t,i,r){switch(t){case $.Immediately:{this.dispatchUpdatedEvent(e,i,r),this.cameraAnimation.moveToRightNow(e,i);break}case $.Continuous:{this.cameraAnimation.moveTo(e,i,r);break}}}},{key:"camera",get:function get(){return{centerX:this.centerX,centerY:this.centerY,scale:this.scale}}},{key:"visionRectangle",get:function get(){return this.convertVisionRectangle(this.camera,this._width,this._height)}},{key:"willInterruptEvent",value:function willInterruptEvent(e,t){return this.updater.willInterruptEvent(e,t)}},{key:"convertVisionRectangle",value:function convertVisionRectangle(e,t,i){var r=t/e.scale,n=i/e.scale;return{originX:e.centerX-r/2,originY:e.centerY-n/2,width:r,height:n}}},{key:"hitTest",value:function hitTest(e,t,i){return this.updater.hitTest(this.convertPointToScene(e,t),i)}},{key:"findComponentWithTarget",value:function findComponentWithTarget(e){return this.updater.findComponentWithTarget(e)}},{key:"renderScreenshot",value:function renderScreenshot(e){var t=tr(e.camera,Object.freeze(this.camera)),i=tr(e.width,this._width),r=tr(e.height,this._height),n=new wd;return Ed(n,this.scene,{width:this._width,height:this._height,camera:t,isTransition:!1,visionRectangle:this.convertVisionRectangle(t,i,r)}),new oP({visions:n,tree:this.scene.tree,screen:this,initCamera:t,engines:this.updater.engines,onRenderDuration:this.onRenderDuration}).render(this.updater.wrappedComponents)}},{key:"renderScreenshotToCanvas",value:function renderScreenshotToCanvas(e,t,i,r){var n=new wd;Ed(n,this.scene,{width:this._width,height:this._height,camera:t,isTransition:!1,visionRectangle:this.convertVisionRectangle(t,i.width,i.height)});var s=Id({tree:this.scene.tree,screen:this,initCamera:t,visions:n,engines:this.updater.engines,mode:Er.Preview});for(var o in s){s[o].painToCanvas(e,t,i,r)}}},{key:"resize",value:function resize(){if(this.divElement&&!this.resizeObserver){var e=this.divElement;this.refreshSize(e.clientWidth,e.clientHeight)}}},{key:"refreshSize",value:function refreshSize(e,t){if(this._width!==e||this._height!==t){this._width=e,this._height=t;var i;this.adaptedRectangle?i=this.cameraWithAdaptRectangle(this.adaptedRectangle,this.adaptedRectangle.adapterMode):i=this.camera,this.setCameraTransfrom(je(V({},i),{animationMode:$.Immediately}),!1),this.dispatchUpdatedEvent(i,!1),this.sizeUpdatedDispatcher.dispatch({width:e,height:t})}}},{key:"addCameraUpdatedListener",value:function addCameraUpdatedListener(e){this.cameraUpdatedDispatcher.addListener(e)}},{key:"removeCameraUpdatedListener",value:function removeCameraUpdatedListener(e){this.cameraUpdatedDispatcher.removeListener(e)}},{key:"addRenderErrorCatchedListener",value:function addRenderErrorCatchedListener(e){this.renderErrorCatchedDispatcher.addListener(e)}},{key:"removeRenderErrorCatchedListener",value:function removeRenderErrorCatchedListener(e){this.renderErrorCatchedDispatcher.removeListener(e)}},{key:"addSizeUpdatedListener",value:function addSizeUpdatedListener(e){this.sizeUpdatedDispatcher.addListener(e)}},{key:"removeSizeUpdatedListener",value:function removeSizeUpdatedListener(e){this.sizeUpdatedDispatcher.removeListener(e)}},{key:"addScreenUpdatedListener",value:function addScreenUpdatedListener(e){this.screenUpdatedDispatcher.addListener(e)}},{key:"removeScreenUpdatedListener",value:function removeScreenUpdatedListener(e){this.screenUpdatedDispatcher.removeListener(e)}},{key:"layoutComponentWithTarget",value:function layoutComponentWithTarget(e){var t=this.findComponentWithTarget(e);if(t)return{componentId:t.component.id,layout:t.engine.orderIndex}}}]);return gP}();function yP(e,t,i){var r=t,n=e.orderIndex;var s=/*#__PURE__*/function(_ol$Component){_inherits(s,_ol$Component);var _super48=_createSuper(s);function s(){_classCallCheck(this,s);return _super48.apply(this,arguments)}_createClass(s,[{key:"render",value:function render(){var _this$props12=this.props,a=_this$props12.id,l=_this$props12.margin,h=_this$props12.origin,d=_this$props12.size,u=_this$props12.scale,p=_this$props12.payload,f=_this$props12.context,m=_this$props12.cnode;return(0,ol.createElement)(r,{id:a,layout:n,margin:l,origin:h,size:d,scale:u,payload:p,context:f,cnode:m})}}],[{key:"willInterruptEvent",value:function willInterruptEvent(a,l,h){return typeof t.willInterruptEvent=="function"?t.willInterruptEvent(a,l,n,h):typeof t.willInterruptEvent=="boolean"?t.willInterruptEvent:!1}}]);return s}(ol.Component);return s.isVisible=i,s}var Qy=/*#__PURE__*/function(){function Qy(e){_classCallCheck(this,Qy);this.definitionNodes=[];var t=_toConsumableArray(e).sort(function(n,s){return n.layout-s.layout}),i={},r={};var _iterator173=_createForOfIteratorHelper(t),_step173;try{for(_iterator173.s();!(_step173=_iterator173.n()).done;){var n=_step173.value;var s=this.createEngine(n);n.renderMode===So.Screen&&(r[s.id]=!0),i[s.id]=s}}catch(err){_iterator173.e(err)}finally{_iterator173.f()}this.engines=Object.freeze(V({},i)),this.absoluteCoordinatesSet=Object.freeze(V({},r))}_createClass(Qy,[{key:"createEngine",value:function createEngine(_ref67){var e=_ref67.layout,t=_ref67.kind,i=_ref67.renderMode,r=_ref67.className,n=_ref67.style;var s;switch(t){case fn.HTML:case fn.SVG:{s=wy({orderIndex:e,fixedSize:i===So.AbsoluteSize,isSVG:t===fn.SVG,className:r,style:n});break}case fn.CANVAS:{s=Sy({orderIndex:e,fixedSize:!0});break}default:throw new Error("invalid kind ".concat(t));}return s}},{key:"adaptComponentConstructor",value:function adaptComponentConstructor(e){if(e.definition)return e;var t=e,_this$findDefinitionN=this.findDefinitionNode(t),i=_this$findDefinitionN.definition,r=this.checkIsAbsoluteCoordinates(t);return{id:t.id,definition:i,originX:t.originX,originY:t.originY,width:t.width,height:t.height,parallaxMargin:t.parallaxMargin,sceneMargin:t.sceneMargin,disableVisionTrim:t.disableVisionTrim,absoluteCoordinates:r,payload:t.payload,orderIndex:t.orderIndex}}},{key:"checkIsAbsoluteCoordinates",value:function checkIsAbsoluteCoordinates(e){for(var t in e.render.layouts){var i=this.findEngineWithLayout(parseInt(t,10));if(i)return!!this.absoluteCoordinatesSet[i.id]}return!1}},{key:"findDefinitionNode",value:function findDefinitionNode(e){var t=null;var _iterator174=_createForOfIteratorHelper(this.definitionNodes),_step174;try{for(_iterator174.s();!(_step174=_iterator174.n()).done;){var i=_step174.value;if(i.render===e.render){t=i;break}}}catch(err){_iterator174.e(err)}finally{_iterator174.f()}return t||(t=Object.freeze({definition:this.createDefinition(e),render:e.render,painter:e.painter}),this.definitionNodes.push(t)),t}},{key:"createDefinition",value:function createDefinition(_ref68){var e=_ref68.render;var t;var i=new hs({name:e.name||"ComponentDefinition",hitTest:(t=e.hitTest)==null?void 0:t.bind(e)});for(var _r101 in e.layouts){var n=this.findEngineWithLayout(parseInt(_r101,10)),s=e.layouts[_r101].isVisible;n instanceof Sd&&n.bind(i)(yP(n,e,s))}return i}},{key:"findEngineWithLayout",value:function findEngineWithLayout(e){for(var t in this.engines){if(this.engines[t].orderIndex===e)return this.engines[t]}return null}}]);return Qy}(),_e;(function(e){e[e.Added=0]="Added",e[e.Removed=1]="Removed",e[e.VisibleUpdated=2]="VisibleUpdated",e[e.AppearUpdated=3]="AppearUpdated",e[e.PropertiesUpdated=4]="PropertiesUpdated"})(_e||(_e={}));var bP=Object.freeze({left:0,right:0,top:0,bottom:0}),vP=new jy({matchingDistance:2,zeroSpeed:.55,kDistance:.17,velocityDamping:.55,heavyDampingRadius:15,heavyDampingSpeed:.25,pedesisSpeedMean:0,pedesisSpeedVariance:0},{matchingDistance:2,zeroSpeed:.55,kDistance:.12,velocityDamping:.35,heavyDampingRadius:15,heavyDampingSpeed:.35,pedesisSpeedMean:0,pedesisSpeedVariance:0}),Zy=/*#__PURE__*/function(){function Zy(e,t,i){var _this181=this;_classCallCheck(this,Zy);this.onRemovedDispatcher=new Yt,this.onRectangleUpdatedDispatcher=new Yt,this.onRectanglePointUpdate=function(){_this181.reporter.update(_this181,_e.AppearUpdated),_this181.onRectangleUpdatedDispatcher.dispatch(_this181)},this.reporter=e,this.id=t.id||(0,qy.v4)().replace(/-/g,""),this.treeNode=i,this._parallaxMargin=ll(t.parallaxMargin),this._sceneMargin=ll(t.sceneMargin),this.disableVisionTrim=!!t.disableVisionTrim,this.absoluteCoordinates=!!t.absoluteCoordinates,this._orderIndex=t.orderIndex,this.rectangleTarget={originX:al(t.originX),originY:al(t.originY),width:al(t.width),height:al(t.height)};var r=[this.rectangleTarget.originX,this.rectangleTarget.originY,this.rectangleTarget.width,this.rectangleTarget.height];this.rectangleAnimation=vP.create(yo.ComponentMoving,r,this.onRectanglePointUpdate)}_createClass(Zy,[{key:"originX",get:function get(){return this.rectangleAnimation.point[0]}},{key:"originY",get:function get(){return this.rectangleAnimation.point[1]}},{key:"width",get:function get(){return this.rectangleAnimation.point[2]}},{key:"height",get:function get(){return this.rectangleAnimation.point[3]}},{key:"parallaxMargin",get:function get(){return this._parallaxMargin}},{key:"sceneMargin",get:function get(){return this._sceneMargin}},{key:"orderIndex",get:function get(){return this._orderIndex},set:function set(e){if(e!==this._orderIndex){var t=this.treeNode.parent.value;this._orderIndex=e,t.reportChildOrderUpdate()}}},{key:"moveTo",value:function moveTo(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:$.Immediately;(this.rectangleTarget.originX!==e||this.rectangleTarget.originY!==t)&&(this.rectangleTarget.originX=e,this.rectangleTarget.originY=t,this.syncRectangleTarget(i))}},{key:"resize",value:function resize(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:$.Immediately;(this.rectangleTarget.width!==e||this.rectangleTarget.height!==t)&&(this.rectangleTarget.width=e,this.rectangleTarget.height=t,this.syncRectangleTarget(i))}},{key:"setRectangle",value:function setRectangle(e,t,i,r){var n=arguments.length>4&&arguments[4]!==undefined?arguments[4]:$.Immediately;(this.rectangleTarget.originX!==e||this.rectangleTarget.originY!==t||this.rectangleTarget.width!==i||this.rectangleTarget.height!==r)&&(this.rectangleTarget.originX=e,this.rectangleTarget.originY=t,this.rectangleTarget.width=i,this.rectangleTarget.height=r,this.syncRectangleTarget(n))}},{key:"syncRectangleTarget",value:function syncRectangleTarget(e){var t=[this.rectangleTarget.originX,this.rectangleTarget.originY,this.rectangleTarget.width,this.rectangleTarget.height];switch(e){case $.Immediately:{this.rectangleAnimation.moveRightNow(t),this.reporter.update(this,_e.AppearUpdated);break}case $.Continuous:{this.rectangleAnimation.moveTo(t);break}}}},{key:"setParallaxMargin",value:function setParallaxMargin(e){Jy(this._parallaxMargin,e)||(this._parallaxMargin=ll(e),this.reporter.update(this,_e.AppearUpdated))}},{key:"setSceneMargin",value:function setSceneMargin(e){Jy(this._sceneMargin,e)||(this._sceneMargin=ll(e),this.reporter.update(this,_e.AppearUpdated))}},{key:"release",value:function release(){this.rectangleAnimation.stop(),this.onRemovedDispatcher.dispatch(this)}},{key:"addRemovedListener",value:function addRemovedListener(e){this.onRemovedDispatcher.addListener(e)}},{key:"removeRemovedListener",value:function removeRemovedListener(e){this.onRemovedDispatcher.removeListener(e)}},{key:"addRectangleUpdatedListener",value:function addRectangleUpdatedListener(e){this.onRectangleUpdatedDispatcher.addListener(e)}},{key:"removeRectangleUpdatedListener",value:function removeRectangleUpdatedListener(e){this.onRectangleUpdatedDispatcher.removeListener(e)}}]);return Zy}();function al(e){return typeof e=="number"?e:0}function ll(e){return e===void 0||e===0?bP:typeof e=="number"?Object.freeze({left:e,right:e,top:e,bottom:e}):Object.freeze(V({},e))}function Jy(e,t){return t===void 0?e.top===0&&e.left===0&&e.right===0&&e.bottom===0:typeof t=="number"?e.top===t&&e.left===t&&e.right===t&&e.bottom===t:e.top===t.top&&e.left===t.left&&e.right===t.right&&e.bottom===t.bottom}var SP=/*#__PURE__*/function(_Zy){_inherits(SP,_Zy);var _super49=_createSuper(SP);function SP(e,t,i,r){var _this182;_classCallCheck(this,SP);_this182=_super49.call(this,e,r,i);_this182.group=new eb(e,t,i),_this182._scale=tr(r.scale,1);return _this182}_createClass(SP,[{key:"kind",get:function get(){return Ri.Group}},{key:"scale",get:function get(){return this._scale},set:function set(e){this._scale!==e&&(this._scale=e)}},{key:"components",get:function get(){return this.group.components}},{key:"removeComponent",value:function removeComponent(e){return this.group.removeComponent(e)}},{key:"reportChildOrderUpdate",value:function reportChildOrderUpdate(){this.group.reportChildOrderUpdate()}},{key:"addComponent",value:function addComponent(e){return this.group.addComponent(e)}},{key:"addComponentGroup",value:function addComponentGroup(e){return this.group.addComponentGroup(e)}}]);return SP}(Zy),Ad=/*#__PURE__*/function(){function Ad(e){_classCallCheck(this,Ad);if(this.engineNodes={},this.enginesCache=null,this.id="".concat(Ad.nextId),this.name=e.name,Ad.nextId+=1,typeof e.hitTest=="boolean"){var t=e.hitTest;this.hitTest=function(){return t}}else e.hitTest?this.hitTest=e.hitTest:this.hitTest=function(){return!0}}_createClass(Ad,[{key:"engines",get:function get(){if(!this.enginesCache){var e=[],t=[];for(var i in this.engineNodes){var _r102=this.engineNodes[i].engine;_r102.orderIndex===void 0?t.push(_r102):e.push(_r102)}e.sort(function(i,r){return i.orderIndex-r.orderIndex}),this.enginesCache=Object.freeze([].concat(e,t))}return this.enginesCache}},{key:"addEngine",value:function addEngine(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(this.enginesCache)throw new Error("definition is frozon. you can only do it before bind with screen");if(!(e instanceof so))throw new Error("it is not RenderEngine");this.engineNodes[e.id]=Object.freeze({engine:e,options:Object.freeze({isVisible:tr(t.isVisible,!0)})})}},{key:"options",value:function options(e){var t;return(t=this.engineNodes[e.id])==null?void 0:t.options}}]);return Ad}(),hs=Ad;hs.nextId=0;var cl=/*#__PURE__*/function(_Zy2){_inherits(cl,_Zy2);var _super50=_createSuper(cl);function cl(e,t,i){var _this183;_classCallCheck(this,cl);_this183=_super50.call(this,e,t,i);if(_this183.visibleMap={},_this183.visibleCount=0,!(t.definition instanceof hs))throw new Error("it is not ComponentDefinition");_this183.definition=t.definition,_this183._rotation=t.rotation,_this183._payload=t.payload;var _iterator175=_createForOfIteratorHelper(_this183.definition.engines),_step175;try{for(_iterator175.s();!(_step175=_iterator175.n()).done;){var _r103=_step175.value;var _this183$definition$o=_this183.definition.options(_r103),n=_this183$definition$o.isVisible;n&&(_this183.visibleCount+=1),_this183.visibleMap[_r103.id]=n}}catch(err){_iterator175.e(err)}finally{_iterator175.f()}return _this183}_createClass(cl,[{key:"kind",get:function get(){return Ri.Component}},{key:"rotation",get:function get(){return this._rotation},set:function set(e){this._rotation!==e&&(this._rotation=e,this.reporter.update(this,_e.AppearUpdated))}},{key:"payload",get:function get(){return this._payload},set:function set(e){e!==this._payload&&(this._payload=e,this.reporter.update(this,_e.PropertiesUpdated))}},{key:"isVisible",value:function isVisible(e){return typeof e=="number"?this.visibleMap[e]||!1:e?this.visibleMap[e.id]||!1:this.visibleCount>0}},{key:"setVisible",value:function setVisible(e,t){var i;if(typeof e=="number"?i="".concat(e):i=e.id,this.visibleMap[i]!==void 0&&this.visibleMap[i]!==t){var _r104=this.visibleCount===0;this.visibleMap[i]=t,t?this.visibleCount+=1:this.visibleCount-=1;var n=this.visibleCount===0;_r104===n?this.reporter.update(this,_e.VisibleUpdated):this.reporter.update(this,_e.AppearUpdated)}}}]);return cl}(Zy),eb=/*#__PURE__*/function(){function eb(e,t,i){_classCallCheck(this,eb);this.shouldSort=!1,this.reporter=e,this.tree=t,this.treeNode=i}_createClass(eb,[{key:"components",get:function get(){this.sortIfNeed();var e=[];var _iterator176=_createForOfIteratorHelper(this.treeNode),_step176;try{for(_iterator176.s();!(_step176=_iterator176.n()).done;){var t=_step176.value;e.push(t.value)}}catch(err){_iterator176.e(err)}finally{_iterator176.f()}return e}},{key:"reportChildOrderUpdate",value:function reportChildOrderUpdate(){this.shouldSort=!0,this.reporter.sortGroup(this)}},{key:"sortIfNeed",value:function sortIfNeed(){this.shouldSort&&(this.shouldSort=!1,this.tree.sort(this.treeNode,function(e,t){var i=e.value.orderIndex,r=t.value.orderIndex;return i!==void 0&&r!==void 0?i-r:i!==void 0?-1:r!==void 0?1:e.id.localeCompare(t.id)}))}},{key:"removeComponent",value:function removeComponent(e){return this.treeNode===e.treeNode.parent?(this.tree.remove(e.treeNode),this.reporter.update(e,_e.Removed),e.release(),!0):!1}},{key:"addComponent",value:function addComponent(e){var t=this.tree.wrapLeaf(),i=new cl(this.reporter,e,t);return this.addNode(t,i)}},{key:"addComponentGroup",value:function addComponentGroup(e){var t=this.tree.wrapGroup(),i=new SP(this.reporter,this.tree,t,e);return this.addNode(t,i)}},{key:"addNode",value:function addNode(e,t){return e.value=t,this.tree.append(e,this.treeNode),this.reporter.update(t,_e.Added),t}}]);return eb}(),Od=/*#__PURE__*/function(_eb){_inherits(Od,_eb);var _super51=_createSuper(Od);function Od(e,t,i,r,n){var _this184;_classCallCheck(this,Od);_this184=_super51.call(this,r,n,n.root);_this184.componentUpdateDispatcher=new Yt,_this184.groupSortedDispatcher=new Yt,_this184.deviceType=e,_this184.logger=t,_this184.legacy=i;return _this184}_createClass(Od,[{key:"createScreen",value:function createScreen(e){return new gP({scene:this,context:e.context,className:e.className,autoResize:!!e.autoResize,width:po(e.width,0),height:po(e.height,0),engines:this.collectEngines(e),eventInterrupter:e.eventInterrupter||function(){return!1},wrappedComponents:e.wrappedComponents||[],onRenderDuration:e.onRenderDuration})}},{key:"collectEngines",value:function collectEngines(e){var t;if(e.engines){t={};var _iterator177=_createForOfIteratorHelper(e.engines),_step177;try{for(_iterator177.s();!(_step177=_iterator177.n()).done;){var n=_step177.value;if(!(n instanceof so))throw new Error("it is not RenderEngine");t[n.id]=n}}catch(err){_iterator177.e(err)}finally{_iterator177.f()}}else t=this.legacy.engines;var i=[],r=[];for(var _n40 in t){var s=t[_n40];s.orderIndex===void 0?r.push(s):i.push(s)}return Object.freeze([].concat(i,r))}},{key:"getEngineWithLegacyLayout",value:function getEngineWithLegacyLayout(e){for(var t in this.legacy.engines){var i=this.legacy.engines[t];if(i.orderIndex===e)return i}}},{key:"addComponentUpdateListener",value:function addComponentUpdateListener(e){this.componentUpdateDispatcher.addListener(e)}},{key:"removeComponentUpdateListener",value:function removeComponentUpdateListener(e){this.componentUpdateDispatcher.removeListener(e)}},{key:"reportComponentUpdate",value:function reportComponentUpdate(e,t){this.componentUpdateDispatcher.dispatch({node:e,behavior:t})}},{key:"addGroupSortedListener",value:function addGroupSortedListener(e){this.groupSortedDispatcher.addListener(e)}},{key:"removeGroupSortedListener",value:function removeGroupSortedListener(e){this.groupSortedDispatcher.removeListener(e)}}],[{key:"create",value:function create(e,t,i){var r,n=new ax,s={update:function update(o,a){return r.reportComponentUpdate(o,a)},sortGroup:function sortGroup(o){return r.groupSortedDispatcher.dispatch(o)}};return r=new Od(e,t,i,s,n),n.root.value=r,r}}]);return Od}(eb),Ue;(function(e){e.Desktop="desktop",e.Touch="touch",e.Surface="surface"})(Ue||(Ue={}));var bo=/*#__PURE__*/function(){function bo(e){_classCallCheck(this,bo);this.deviceType=e}_createClass(bo,[{key:"createScene",value:function createScene(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:bo.createDefaultLogger();return Od.create(this.deviceType,e,new Qy([]))}},{key:"createSceneWithLegacyLayoutDescriptions",value:function createSceneWithLegacyLayoutDescriptions(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:bo.createDefaultLogger();return Od.create(this.deviceType,t,new Qy(e))}}],[{key:"createDefaultLogger",value:function createDefaultLogger(){return no(new ls,"Boundless")}}]);return bo}(),mi;(function(e){e.Centering="centering",e.Tailor="tailor"})(mi||(mi={}));function vo(e){return new hs(e)}var Ri;(function(e){e[e.Group=0]="Group",e[e.Component=1]="Component"})(Ri||(Ri={}));var Rd;(function(e){e[e.Unchanged=0]="Unchanged",e[e.Overlay=1]="Overlay",e[e.Changed=2]="Changed"})(Rd||(Rd={}));var mn;(function(e){e[e.Directly=0]="Directly",e[e.GenerateCache=1]="GenerateCache",e[e.Overlay=2]="Overlay",e[e.OverlayOnCache=3]="OverlayOnCache"})(mn||(mn={}));var fi;(function(e){e.Begin="Begin",e.End="End"})(fi||(fi={}));var $;(function(e){e.Continuous="continuous",e.Immediately="immediately"})($||($={}));function ds(e,t,i){return e+(t-e)*i}function tb(e,t){var i=Math.sqrt(e*e+t*t);return i===0?{x:1,y:0}:{x:e/i,y:t/i}}function ib(e,t,i,r){var n=e-i,s=t-r;return Math.sqrt(n*n+s*s)}var fn;(function(e){e[e.HTML=0]="HTML",e[e.SVG=1]="SVG",e[e.CANVAS=2]="CANVAS"})(fn||(fn={}));var So;(function(e){e[e.AbsoluteSize=0]="AbsoluteSize",e[e.RelativeSize=1]="RelativeSize",e[e.Screen=2]="Screen"})(So||(So={}));var zT=P(require("mobx"));var _d={};Bn(_d,{MobXProviderContext:function MobXProviderContext(){return yl},Observer:function Observer(){return ps},PropTypes:function PropTypes(){return ZP},Provider:function Provider(){return zb},disposeOnUnmount:function disposeOnUnmount(){return Vb},enableStaticRendering:function enableStaticRendering(){return Co},inject:function inject(){return VP},isUsingStaticRendering:function isUsingStaticRendering(){return gi},observer:function observer(){return Li},observerBatching:function observerBatching(){return wo},useAsObservableSource:function useAsObservableSource(){return Po},useLocalObservable:function useLocalObservable(){return zd},useLocalStore:function useLocalStore(){return Ud},useObserver:function useObserver(){return wb},useStaticRendering:function useStaticRendering(){return Cb}});var oe=P(require("mobx")),ne=P(require("react"));var rb=P(require("mobx")),nb=P(require("react"));if(!nb.useState)throw new Error("mobx-react-lite requires React with Hooks support");if(!rb.makeObservable)throw new Error("mobx-react-lite@3 requires mobx at least version 6 to be available");var Ld=P(require("react-dom"));var sb=P(require("mobx"));function wP(e){e()}function wo(e){e||(e=wP),(0,sb.configure)({reactionScheduler:e})}var hl=P(require("react")),CP=function CP(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var r=i.call(e),n,s=[],o;try{for(;(t===void 0||t-->0)&&!(n=r.next()).done;){s.push(n.value)}}catch(a){o={error:a}}finally{try{n&&!n.done&&(i=r["return"])&&i.call(r)}finally{if(o)throw o.error}}return s},kP=[];function ob(){var e=CP((0,hl.useState)(0),2),t=e[1],i=(0,hl.useCallback)(function(){t(function(r){return r+1})},kP);return i}var Bd=P(require("mobx")),ko=P(require("react"));var ab=P(require("mobx"));function lb(e){return(0,ab.getDependencyTree)(e)}var Dd=typeof FinalizationRegistry=="undefined"?void 0:FinalizationRegistry;function dl(e){var t={reaction:e,mounted:!1,changedBeforeMount:!1,cleanAt:Date.now()+xP};return t}var xP=1e4,cb=1e4;function hb(e){var t=new Map,i=1,r=new e(function(s){var o=t.get(s);o&&(o.reaction.dispose(),t["delete"](s))});return{addReactionToTrack:function addReactionToTrack(n,s,o){var a=i++;return r.register(o,a,n),n.current=dl(s),n.current.finalizationRegistryCleanupToken=a,t.set(a,n.current),n.current},recordReactionAsCommitted:function recordReactionAsCommitted(n){r.unregister(n),n.current&&n.current.finalizationRegistryCleanupToken&&t["delete"](n.current.finalizationRegistryCleanupToken)},forceCleanupTimerToRunNowForTests:function forceCleanupTimerToRunNowForTests(){},resetCleanupScheduleForTests:function resetCleanupScheduleForTests(){}}}var PP=function PP(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function next(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function db(){var e=new Set,t;function i(){t&&(clearTimeout(t),a())}function r(){var l,h;if(e.size>0){try{for(var d=PP(e),u=d.next();!u.done;u=d.next()){var p=u.value,f=p.current;f&&(f.reaction.dispose(),p.current=null)}}catch(m){l={error:m}}finally{try{u&&!u.done&&(h=d["return"])&&h.call(d)}finally{if(l)throw l.error}}e.clear()}t&&(clearTimeout(t),t=void 0)}function n(){t===void 0&&(t=setTimeout(a,cb))}function s(l){e.add(l),n()}function o(l){e["delete"](l)}function a(){t=void 0;var l=Date.now();e.forEach(function(h){var d=h.current;d&&l>=d.cleanAt&&(d.reaction.dispose(),h.current=null,e["delete"](h))}),e.size>0&&n()}return{addReactionToTrack:function addReactionToTrack(l,h,d){return l.current=dl(h),s(l),l.current},recordReactionAsCommitted:o,forceCleanupTimerToRunNowForTests:i,resetCleanupScheduleForTests:r}}var ul=Dd?hb(Dd):db(),ub=ul.addReactionToTrack,pb=ul.recordReactionAsCommitted,IP=ul.resetCleanupScheduleForTests,LR=ul.forceCleanupTimerToRunNowForTests;var mb=!1;function Co(e){mb=e}function gi(){return mb}var MP=function MP(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var r=i.call(e),n,s=[],o;try{for(;(t===void 0||t-->0)&&!(n=r.next()).done;){s.push(n.value)}}catch(a){o={error:a}}finally{try{n&&!n.done&&(i=r["return"])&&i.call(r)}finally{if(o)throw o.error}}return s};function fb(e){return"observer"+e}var TP=function(){function e(){}return e}();function us(e,t){if(t===void 0&&(t="observed"),gi())return e();var i=MP(ko["default"].useState(new TP),1),r=i[0],n=ob(),s=ko["default"].useRef(null);if(!s.current)var o=new Bd.Reaction(fb(t),function(){a.mounted?n():a.changedBeforeMount=!0}),a=ub(s,o,r);var l=s.current.reaction;ko["default"].useDebugValue(l,lb),ko["default"].useEffect(function(){return pb(s),s.current?(s.current.mounted=!0,s.current.changedBeforeMount&&(s.current.changedBeforeMount=!1,n())):(s.current={reaction:new Bd.Reaction(fb(t),function(){n()}),mounted:!0,changedBeforeMount:!1,cleanAt:1/0},n()),function(){s.current.reaction.dispose(),s.current=null}},[]);var h,d;if(l.track(function(){try{h=e()}catch(u){d=u}}),d)throw d;return h}var xo=P(require("react"));var _Fd=function Fd(){return _Fd=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var n in t){Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}}return e},_Fd.apply(this,arguments)};function jd(e,t){if(gi())return e;var i=_Fd({forwardRef:!1},t),r=e.displayName||e.name,n=function n(o,a){return us(function(){return e(o,a)},r)};n.displayName=r;var s;return i.forwardRef?s=(0,xo.memo)((0,xo.forwardRef)(n)):s=(0,xo.memo)(n),AP(e,s),s.displayName=r,s}var EP={$$typeof:!0,render:!0,compare:!0,type:!0};function AP(e,t){Object.keys(e).forEach(function(i){EP[i]||Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))})}function ps(e){var t=e.children,i=e.render,r=t||i;return typeof r!="function"?null:us(r)}ps.displayName="Observer";var gb=P(require("mobx")),yb=P(require("react"));function zd(e,t){return(0,yb.useState)(function(){return(0,gb.observable)(e(),t,{autoBind:!0})})[0]}var vb=P(require("mobx")),Sb=P(require("react"));var pl=P(require("mobx")),bb=P(require("react")),OP=function OP(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var r=i.call(e),n,s=[],o;try{for(;(t===void 0||t-->0)&&!(n=r.next()).done;){s.push(n.value)}}catch(a){o={error:a}}finally{try{n&&!n.done&&(i=r["return"])&&i.call(r)}finally{if(o)throw o.error}}return s};function Po(e){var t=OP((0,bb.useState)(function(){return(0,pl.observable)(e,{},{deep:!1})}),1),i=t[0];return(0,pl.runInAction)(function(){Object.assign(i,e)}),i}function Ud(e,t){var i=t&&Po(t);return(0,Sb.useState)(function(){return(0,vb.observable)(e(i),void 0,{autoBind:!0})})[0]}wo(Ld.unstable_batchedUpdates);function wb(e,t){return t===void 0&&(t="observed"),us(e,t)}function Cb(e){Co(e)}var kb=0;function RP(e){if(typeof Symbol=="function")return Symbol(e);var t="__$mobx-react "+e+" ("+kb+")";return kb++,t}var Vd={};function Ni(e){return Vd[e]||(Vd[e]=RP(e)),Vd[e]}function xb(e,t){if(Pb(e,t))return!0;if(_typeof(e)!="object"||e===null||_typeof(t)!="object"||t===null)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(var n=0;n<i.length;n++){if(!Object.hasOwnProperty.call(t,i[n])||!Pb(e[i[n]],t[i[n]]))return!1}return!0}function Pb(e,t){return e===t?e!==0||1/e==1/t:e!==e&&t!==t}var NP={$$typeof:1,render:1,compare:1,type:1,childContextTypes:1,contextType:1,contextTypes:1,defaultProps:1,getDefaultProps:1,getDerivedStateFromError:1,getDerivedStateFromProps:1,mixins:1,displayName:1,propTypes:1};function LP(e,t){var i=Object.getOwnPropertyNames(Object.getPrototypeOf(e));Object.getOwnPropertyNames(e).forEach(function(r){!NP[r]&&i.indexOf(r)===-1&&Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))})}function sr(e,t,i){Object.hasOwnProperty.call(e,t)?e[t]=i:Object.defineProperty(e,t,{enumerable:!1,configurable:!0,writable:!0,value:i})}var Ib=Ni("patchMixins"),Mb=Ni("patchedDefinition");function DP(e,t){var i=e[Ib]=e[Ib]||{},r=i[t]=i[t]||{};return r.locks=r.locks||0,r.methods=r.methods||[],r}function Tb(e,t){for(var i=this,r=arguments.length,n=new Array(r>2?r-2:0),s=2;s<r;s++){n[s-2]=arguments[s]}t.locks++;try{var o;return e!=null&&(o=e.apply(this,n)),o}finally{t.locks--,t.locks===0&&t.methods.forEach(function(a){a.apply(i,n)})}}function Eb(e,t){var i=function i(){for(var n=arguments.length,s=new Array(n),o=0;o<n;o++){s[o]=arguments[o]}Tb.call.apply(Tb,[this,e,t].concat(s))};return i}function Ab(e,t,i){var r=DP(e,t);r.methods.indexOf(i)<0&&r.methods.push(i);var n=Object.getOwnPropertyDescriptor(e,t);if(!(n&&n[Mb])){var s=e[t],o=Ob(e,t,n?n.enumerable:void 0,r,s);Object.defineProperty(e,t,o)}}function Ob(e,t,i,r,n){var s,o=Eb(n,r);return s={},s[Mb]=!0,s.get=function(){return o},s.set=function(l){if(this===e)o=Eb(l,r);else{var h=Ob(this,t,i,r,l);Object.defineProperty(this,t,h)}},s.configurable=!0,s.enumerable=i,s}var Wd=oe.$mobx||"$mobx",Rb=Ni("isMobXReactObserver"),Nb=Ni("isUnmounted"),ml=Ni("skipRender"),fl=Ni("isForcingUpdate");function BP(e){var t=e.prototype;if(e[Rb]){var i=Hd(t);console.warn("The provided component class ("+i+") \n                has already been declared as an observer component.")}else e[Rb]=!0;if(t.componentWillReact)throw new Error("The componentWillReact life-cycle event is no longer supported");if(e.__proto__!==ne.PureComponent){if(!t.shouldComponentUpdate)t.shouldComponentUpdate=Lb;else if(t.shouldComponentUpdate!==Lb)throw new Error("It is not allowed to use shouldComponentUpdate in observer based components.")}Db(t,"props"),Db(t,"state");var r=t.render;return t.render=function(){return FP.call(this,r)},Ab(t,"componentWillUnmount",function(){var n;if(gi()!==!0&&((n=this.render[Wd])==null||n.dispose(),this[Nb]=!0,!this.render[Wd])){var s=Hd(this);console.warn("The reactive render of an observer class component ("+s+") \n                was overriden after MobX attached. This may result in a memory leak if the \n                overriden reactive render was not properly disposed.")}}),e}function Hd(e){return e.displayName||e.name||e.constructor&&(e.constructor.displayName||e.constructor.name)||"<component>"}function FP(e){var t=this;if(gi()===!0)return e.call(this);sr(this,ml,!1),sr(this,fl,!1);var i=Hd(this),r=e.bind(this),n=!1,s=new oe.Reaction(i+".render()",function(){if(!n&&(n=!0,t[Nb]!==!0)){var a=!0;try{sr(t,fl,!0),t[ml]||ne.Component.prototype.forceUpdate.call(t),a=!1}finally{sr(t,fl,!1),a&&s.dispose()}}});s.reactComponent=this,o[Wd]=s,this.render=o;function o(){n=!1;var a=void 0,l=void 0;if(s.track(function(){try{l=(0,oe._allowStateChanges)(!1,r)}catch(h){a=h}}),a)throw a;return l}return o.call(this)}function Lb(e,t){return gi()&&console.warn("[mobx-react] It seems that a re-rendering of a React component is triggered while in static (server-side) mode. Please make sure components are rendered only once server-side."),this.state!==t?!0:!xb(this.props,e)}function Db(e,t){var i=Ni("reactProp_"+t+"_valueHolder"),r=Ni("reactProp_"+t+"_atomHolder");function n(){return this[r]||sr(this,r,(0,oe.createAtom)("reactive "+t)),this[r]}Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function get(){var o=!1;return oe._allowStateReadsStart&&oe._allowStateReadsEnd&&(o=(0,oe._allowStateReadsStart)(!0)),n.call(this).reportObserved(),oe._allowStateReadsStart&&oe._allowStateReadsEnd&&(0,oe._allowStateReadsEnd)(o),this[i]},set:function set(o){!this[fl]&&!xb(this[i],o)?(sr(this,i,o),sr(this,ml,!0),n.call(this).reportChanged(),sr(this,ml,!1)):sr(this,i,o)}})}var Bb=typeof Symbol=="function"&&Symbol["for"],Fb=Bb?Symbol["for"]("react.forward_ref"):typeof ne.forwardRef=="function"&&(0,ne.forwardRef)(function(e){return null}).$$typeof,jb=Bb?Symbol["for"]("react.memo"):typeof ne.memo=="function"&&(0,ne.memo)(function(e){return null}).$$typeof;function Li(e){if(e.isMobxInjector===!0&&console.warn("Mobx observer: You are trying to use 'observer' on a component that already has 'inject'. Please apply 'observer' before applying 'inject'"),jb&&e.$$typeof===jb)throw new Error("Mobx observer: You are trying to use 'observer' on a function component wrapped in either another observer or 'React.memo'. The observer already applies 'React.memo' for you.");if(Fb&&e.$$typeof===Fb){var t=e.render;if(typeof t!="function")throw new Error("render property of ForwardRef was not a function");return(0,ne.forwardRef)(function(){var r=arguments;return(0,ne.createElement)(ps,null,function(){return t.apply(void 0,r)})})}return typeof e=="function"&&(!e.prototype||!e.prototype.render)&&!e.isReactClass&&!Object.prototype.isPrototypeOf.call(ne.Component,e)?jd(e):BP(e)}function gl(){return gl=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i){Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}}return e},gl.apply(this,arguments)}function jP(e,t){if(e==null)return{};var i={},r=Object.keys(e),n,s;for(s=0;s<r.length;s++){n=r[s],!(t.indexOf(n)>=0)&&(i[n]=e[n])}return i}var yl=ne["default"].createContext({});function zb(e){var t=e.children,i=jP(e,["children"]),r=ne["default"].useContext(yl),n=ne["default"].useRef(gl({},r,i)),s=n.current;if(!1)var o;return ne["default"].createElement(yl.Provider,{value:s},t)}zb.displayName="MobXProvider";function Ub(e,t,i,r){var n=ne["default"].forwardRef(function(s,o){var a=gl({},s),l=ne["default"].useContext(yl);return Object.assign(a,e(l||{},a)||{}),o&&(a.ref=o),ne["default"].createElement(t,a)});return r&&(n=Li(n)),n.isMobxInjector=!0,LP(t,n),n.wrappedComponent=t,n.displayName=zP(t,i),n}function zP(e,t){var i,r=e.displayName||e.name||e.constructor&&e.constructor.name||"Component";return t?i="inject-with-"+t+"("+r+")":i="inject("+r+")",i}function UP(e){return function(t,i){return e.forEach(function(r){if(!(r in i)){if(!(r in t))throw new Error("MobX injector: Store '"+r+"' is not available! Make sure it is provided by some Provider");i[r]=t[r]}}),i}}function VP(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++){t[i]=arguments[i]}if(typeof arguments[0]=="function"){var r=arguments[0];return function(n){return Ub(r,n,r.name,!0)}}else return function(n){return Ub(UP(t),n,t.join("-"),!1)}}var bl=Ni("disposeOnUnmountProto"),vl=Ni("disposeOnUnmountInst");function WP(){var e=this;[].concat(this[bl]||[],this[vl]||[]).forEach(function(t){var i=typeof t=="string"?e[t]:t;i!=null&&(Array.isArray(i)?i.map(function(r){return r()}):i())})}function Vb(e,t){if(Array.isArray(t))return t.map(function(l){return Vb(e,l)});var i=Object.getPrototypeOf(e).constructor,r=Object.getPrototypeOf(e.constructor),n=Object.getPrototypeOf(Object.getPrototypeOf(e));if(!(i===ne["default"].Component||i===ne["default"].PureComponent||r===ne["default"].Component||r===ne["default"].PureComponent||n===ne["default"].Component||n===ne["default"].PureComponent))throw new Error("[mobx-react] disposeOnUnmount only supports direct subclasses of React.Component or React.PureComponent.");if(typeof t!="string"&&typeof t!="function"&&!Array.isArray(t))throw new Error("[mobx-react] disposeOnUnmount only works if the parameter is either a property key or a function.");var s=typeof t=="string",o=!!e[bl]||!!e[vl],a=s?e[bl]||(e[bl]=[]):e[vl]||(e[vl]=[]);if(a.push(t),o||Ab(e,"componentWillUnmount",WP),typeof t!="string")return t}function Wb(e){function t(r,n,s,o,a,l){for(var h=arguments.length,d=new Array(h>6?h-6:0),u=6;u<h;u++){d[u-6]=arguments[u]}return(0,oe.untracked)(function(){if(o=o||"<<anonymous>>",l=l||s,n[s]==null){if(r){var p=n[s]===null?"null":"undefined";return new Error("The "+a+" `"+l+"` is marked as required in `"+o+"`, but its value is `"+p+"`.")}return null}else return e.apply(void 0,[n,s,o,a,l].concat(d))})}var i=t.bind(null,!1);return i.isRequired=t.bind(null,!0),i}function HP(e,t){return e==="symbol"||t["@@toStringTag"]==="Symbol"||typeof Symbol=="function"&&t instanceof Symbol}function Hb(e){var t=_typeof(e);return Array.isArray(e)?"array":e instanceof RegExp?"object":HP(t,e)?"symbol":t}function _P(e){var t=Hb(e);if(t==="object"){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function ms(e,t){return Wb(function(i,r,n,s,o){return(0,oe.untracked)(function(){if(e&&Hb(i[r])===t.toLowerCase())return null;var a;switch(t){case"Array":a=oe.isObservableArray;break;case"Object":a=oe.isObservableObject;break;case"Map":a=oe.isObservableMap;break;default:throw new Error("Unexpected mobxType: "+t);}var l=i[r];if(!a(l)){var h=_P(l),d=e?" or javascript `"+t.toLowerCase()+"`":"";return new Error("Invalid prop `"+o+"` of type `"+h+"` supplied to `"+n+"`, expected `mobx.Observable"+t+"`"+d+".")}return null})})}function _b(e,t){return Wb(function(i,r,n,s,o){for(var a=arguments.length,l=new Array(a>5?a-5:0),h=5;h<a;h++){l[h-5]=arguments[h]}return(0,oe.untracked)(function(){if(typeof t!="function")return new Error("Property `"+o+"` of component `"+n+"` has invalid PropType notation.");var d=ms(e,"Array")(i,r,n,s,o);if(d instanceof Error)return d;for(var u=i[r],p=0;p<u.length;p++){if(d=t.apply(void 0,[u,p,n,s,o+"["+p+"]"].concat(l)),d instanceof Error)return d}return null})})}var KP=ms(!1,"Array"),GP=_b.bind(null,!1),$P=ms(!1,"Map"),YP=ms(!1,"Object"),XP=ms(!0,"Array"),QP=_b.bind(null,!0),qP=ms(!0,"Object"),ZP={observableArray:KP,observableArrayOf:GP,observableMap:$P,observableObject:YP,arrayOrObservableArray:XP,arrayOrObservableArrayOf:QP,objectOrObservableObject:qP};if(!ne.Component)throw new Error("mobx-react requires React to be available");if(!oe.observable)throw new Error("mobx-react requires mobx to be available");var np={};Bn(np,{EmuToPt:function EmuToPt(){return yn},EmuToPx:function EmuToPx(){return Nt},RenderMode:function RenderMode(){return Kl},Slide:function Slide(){return dS},disableAutoPlayKey:function disableAutoPlayKey(){return dM},loadPPT:function loadPPT(){return xS},playLastStepKey:function playLastStepKey(){return uM},previewPPT:function previewPPT(){return rp},sequenceIndexesKey:function sequenceIndexesKey(){return hM},toNumber:function toNumber(){return ys},toPt:function toPt(){return E}});var lr=P(require("react")),Mv=P(require("eventemitter3")),Bo=P(require("react")),re=P(require("color")),Tv=P(require("@netless/xml-js")),Ke=P(require("react")),Eu=P(require("react")),Sn=P(require("react")),wn=P(require("react")),Dt=P(require("react"));var $b=P(require("mathjs")),Io,Sl,JP=Object.defineProperty,eI=Object.defineProperties,tI=Object.getOwnPropertyDescriptors,Kb=Object.getOwnPropertySymbols,iI=Object.prototype.hasOwnProperty,rI=Object.prototype.propertyIsEnumerable,Gb=function Gb(e,t,i){return t in e?JP(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},or=function or(e,t){for(var i in t||(t={})){iI.call(t,i)&&Gb(e,i,t[i])}if(Kb){var _iterator178=_createForOfIteratorHelper(Kb(t)),_step178;try{for(_iterator178.s();!(_step178=_iterator178.n()).done;){var i=_step178.value;rI.call(t,i)&&Gb(e,i,t[i])}}catch(err){_iterator178.e(err)}finally{_iterator178.f()}}return e},wl=function wl(e,t){return eI(e,tI(t))};(Sl=Io||(Io={}))[Sl.Cmd=1]="Cmd",Sl[Sl.State=2]="State";var Lr=/*#__PURE__*/function(){function Lr(_ref69){var t=_ref69.playerID,i=_ref69.players,_ref69$effectType=_ref69.effectType,r=_ref69$effectType===void 0?"clickEffect":_ref69$effectType;_classCallCheck(this,Lr);this.players=[],this._playerID=t,this.players=i,this.effectType=r,this.repeat=Math.max.apply(Math,_toConsumableArray(i.map(function(n){return n.repeat})).concat([1])),this.duration=Math.max.apply(Math,_toConsumableArray(i.map(function(n){return n.duration})).concat([0])),this.delay=i.length>0?Math.min.apply(Math,_toConsumableArray(i.map(function(n){return n.delay}))):0}_createClass(Lr,[{key:"playerID",get:function get(){return this._playerID||(this._playerID="par[".concat(this.players.map(function(t){return t.playerID}).join(","),"]")),this._playerID}},{key:"progressTime",get:function get(){return Math.max.apply(Math,_toConsumableArray(this.players.map(function(t){return t.progressTime})||0))}},{key:"isPlaying",get:function get(){return this.players.some(function(t){return t.isPlaying})}},{key:"isComplete",get:function get(){return this.players.every(function(t){return t.isComplete})}},{key:"play",value:function play(){this.players.forEach(function(t){return t.play()})}},{key:"pause",value:function pause(){this.players.forEach(function(t){return t.pause()})}},{key:"seek",value:function seek(t){if(t>this.progressTime)this.players.forEach(function(i){return i.seek(t)});else if(t<this.progressTime)for(var i=this.players.length-1;i>=0;i--){this.players[i].seek(t)}}},{key:"onFrame",value:function onFrame(t){if(t>this.progressTime)this.players.forEach(function(i){return i.onFrame(t)});else if(t<this.progressTime)for(var i=this.players.length-1;i>=0;i--){this.players[i].onFrame(t)}}},{key:"reset",value:function reset(){for(var t=this.players.length-1;t>=0;t--){this.players[t].reset()}}},{key:"stop",value:function stop(){this.players.forEach(function(t){return t.stop()})}},{key:"stopFinite",value:function stopFinite(){this.players.forEach(function(t){return t.stopFinite()})}}]);return Lr}();var _Ot=function Ot(){return(_Ot=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){for(var n in t=arguments[i]){Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}}return e}).apply(this,arguments)};function Kd(e,t){var i={};for(var r in e){Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r])}if(e!=null&&typeof Object.getOwnPropertySymbols=="function"){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++){t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]])}}return i}var Yb=function Yb(e,t){return function(i){return Math.max(Math.min(i,t),e)}},Cl=function Cl(e){return e%1?Number(e.toFixed(5)):e},Xb=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i,kl={test:function test(e){return typeof e=="number"},parse:parseFloat,transform:function transform(e){return e}},Mo=_Ot(_Ot({},kl),{transform:Yb(0,1)}),xl=_Ot(_Ot({},kl),{"default":1}),Gd=function Gd(e){return{test:function test(t){return typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1},parse:parseFloat,transform:function transform(t){return""+t+e}}},gn=Gd("deg"),To=Gd("%"),H=Gd("px"),Qb=_Ot(_Ot({},To),{parse:function parse(e){return To.parse(e)/100},transform:function transform(e){return To.transform(100*e)}}),nI=Yb(0,255),$d=function $d(e){return e.red!==void 0},Yd=function Yd(e){return e.hue!==void 0},qb=function qb(e){return function(t){if(typeof t!="string")return t;for(var i={},r=function(s){return s.substring(s.indexOf("(")+1,s.lastIndexOf(")"))}(t).replace(/(,|\/)/g," ").split(/ \s*/),n=0;n<4;n++){i[e[n]]=r[n]!==void 0?parseFloat(r[n]):1}return i}},Xd=_Ot(_Ot({},kl),{transform:function transform(e){return Math.round(nI(e))}});function Qd(e,t){return e.startsWith(t)&&Xb.test(e)}var qd,Pl={test:function test(e){return typeof e=="string"?Qd(e,"rgb"):$d(e)},parse:qb(["red","green","blue","alpha"]),transform:function transform(e){var t=e.red,i=e.green,r=e.blue,n=e.alpha,s=n===void 0?1:n;return function(o){var a=o.red,l=o.green,h=o.blue,d=o.alpha;return"rgba("+a+", "+l+", "+h+", "+(d===void 0?1:d)+")"}({red:Xd.transform(t),green:Xd.transform(i),blue:Xd.transform(r),alpha:Cl(Mo.transform(s))})}},Zd={test:function test(e){return typeof e=="string"?Qd(e,"hsl"):Yd(e)},parse:qb(["hue","saturation","lightness","alpha"]),transform:function transform(e){var t=e.hue,i=e.saturation,r=e.lightness,n=e.alpha,s=n===void 0?1:n;return function(o){var a=o.hue,l=o.saturation,h=o.lightness,d=o.alpha;return"hsla("+a+", "+l+", "+h+", "+(d===void 0?1:d)+")"}({hue:Math.round(t),saturation:To.transform(Cl(i)),lightness:To.transform(Cl(r)),alpha:Cl(Mo.transform(s))})}},Zb=_Ot(_Ot({},Pl),{test:function test(e){return typeof e=="string"&&Qd(e,"#")},parse:function parse(e){var t="",i="",r="";return e.length>4?(t=e.substr(1,2),i=e.substr(3,2),r=e.substr(5,2)):(t=e.substr(1,1),i=e.substr(2,1),r=e.substr(3,1),t+=t,i+=i,r+=r),{red:parseInt(t,16),green:parseInt(i,16),blue:parseInt(r,16),alpha:1}}}),Di={test:function test(e){return typeof e=="string"&&Xb.test(e)||$d(e)||Yd(e)},parse:function parse(e){return Pl.test(e)?Pl.parse(e):Zd.test(e)?Zd.parse(e):Zb.test(e)?Zb.parse(e):e},transform:function transform(e){return $d(e)?Pl.transform(e):Yd(e)?Zd.transform(e):e}},Jd=function Jd(e){return e},Xt=(qd=function qd(e,t,i){return Math.min(Math.max(i,e),t)},function(e,t,i){return i!==void 0?qd(e,t,i):function(r){return qd(e,t,r)}});Xt(0,1);var sI=typeof performance!="undefined"?function(){return performance.now()}:function(){return Date.now()},Jb=typeof window!="undefined"?function(e){return window.requestAnimationFrame(e)}:function(e){return setTimeout(function(){return e(sI())},16.666666666666668)},eu=!0,Eo=!1,tu=!1,Il={delta:0,timestamp:0},Ml=["read","update","preRender","render","postRender"],iu=Ml.reduce(function(e,t){var i,r,n,s,o,a,l;return e[t]=(i=function i(){return Eo=!0},r=[],n=[],s=0,o=!1,a=new WeakSet,l={schedule:function schedule(h,d,u){d===void 0&&(d=!1),u===void 0&&(u=!1);var p=u&&o,f=p?r:n;return d&&a.add(h),f.indexOf(h)===-1&&(f.push(h),p&&o&&(s=r.length)),h},cancel:function cancel(h){var d=n.indexOf(h);d!==-1&&n.splice(d,1),a["delete"](h)},process:function process(h){var d;if(o=!0,r=(d=[n,r])[0],(n=d[1]).length=0,s=r.length)for(var u=0;u<s;u++){var p=r[u];p(h),a.has(p)&&(l.schedule(p),i())}o=!1}}),e},{}),ar=Ml.reduce(function(e,t){var i=iu[t];return e[t]=function(r,n,s){return n===void 0&&(n=!1),s===void 0&&(s=!1),Eo||aI(),i.schedule(r,n,s)},e},{}),Tl=Ml.reduce(function(e,t){return e[t]=iu[t].cancel,e},{}),oI=function oI(e){return iu[e].process(Il)},ev=function ev(e){Eo=!1,Il.delta=eu?16.666666666666668:Math.max(Math.min(e-Il.timestamp,40),1),Il.timestamp=e,tu=!0,Ml.forEach(oI),tu=!1,Eo&&(eu=!1,Jb(ev))},aI=function aI(){Eo=!0,eu=!0,tu||Jb(ev)},fs=/*#__PURE__*/function(){function fs(_ref70){var t=_ref70.playerID,i=_ref70.players,_ref70$effectType=_ref70.effectType,r=_ref70$effectType===void 0?"clickEffect":_ref70$effectType,n=_ref70.repeat,_ref70$rewind=_ref70.rewind,s=_ref70$rewind===void 0?!1:_ref70$rewind,_ref70$reverse=_ref70.reverse,o=_ref70$reverse===void 0?!1:_ref70$reverse,_ref70$delay=_ref70.delay,a=_ref70$delay===void 0?0:_ref70$delay;_classCallCheck(this,fs);this.players=[],this.progressTime=0,this.loopCount=0,this.elapsed=0,this._playerID=t,this.players=i,this.effectType=r,this.roundDuration=Math.max.apply(Math,_toConsumableArray(i.map(function(l){return l.duration})).concat([0])),this.repeat=n!=null?Math.max(1,n):Math.max.apply(Math,_toConsumableArray(i.map(function(l){return l.repeat})).concat([1])),this.rewind=s,this.reverse=o,this.delay=a,this.duration=this.delay+this.roundDuration*(Number.isFinite(this.repeat)?this.repeat:1)*(this.reverse?2:1),this.loop=Number.isFinite(this.repeat)?this.reverse?2*(this.repeat-1)+1:this.repeat-1:this.repeat}_createClass(fs,[{key:"playerID",get:function get(){return this._playerID||(this._playerID="par-plus[".concat(this.players.map(function(t){return t.playerID}).join(","),"]")),this._playerID}},{key:"isPlaying",get:function get(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function get(){return this.progressTime>=this.duration}},{key:"play",value:function play(){var _this185=this;this.isPlaying||this.isComplete||(this.frameProcess=ar.update(function(_ref71){var t=_ref71.delta;if(_this185.progressTime+=t,!(_this185.progressTime<=_this185.delay)&&(_this185.elapsed+=t,_this185.update(),_this185.isPlaying&&_this185.elapsed>_this185.roundDuration)){if(_this185.loopCount<_this185.loop)return _this185.elapsed=0,void(_this185.loopCount+=1);_this185.pause()}},!0))}},{key:"pause",value:function pause(){this.frameProcess&&(Tl.update(this.frameProcess),this.frameProcess=void 0)}},{key:"seek",value:function seek(t){var i=this.progressTime;this.progressTime=Xt(0,this.duration,t),this.progressTime<=this.delay?(this.loopCount=0,this.elapsed=0):(this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration-1),this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1);var r=this.reverse&&this.loopCount%2!=0,n=r?this.roundDuration-this.elapsed:this.elapsed;if(i>t||r)for(var s=this.players.length-1;s>=0;s--){this.players[s].seek(n)}else i<t&&this.players.forEach(function(s){return s.seek(n)})}},{key:"onFrame",value:function onFrame(t){var i=this.progressTime;this.progressTime=Xt(0,this.duration,t),this.progressTime<=this.delay?(this.loopCount=0,this.elapsed=0):(this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration-1),this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1);var r=this.reverse&&this.loopCount%2!=0,n=r?this.roundDuration-this.elapsed:this.elapsed;if(i>t||r)for(var s=this.players.length-1;s>=0;s--){this.players[s].onFrame(n)}else i<t&&this.players.forEach(function(s){return s.onFrame(n)})}},{key:"reset",value:function reset(){if(this.progressTime>0){this.pause(),this.loopCount=0,this.elapsed=0,this.progressTime=0;for(var t=this.players.length-1;t>=0;t--){this.players[t].reset()}}}},{key:"stop",value:function stop(){this.pause(),this.seek(this.duration)}},{key:"stopFinite",value:function stopFinite(){Number.isFinite(this.repeat)&&this.stop()}},{key:"update",value:function update(){var _this186=this;if(this.reverse&&this.loopCount%2!=0)for(var t=this.players.length-1;t>=0;t--){this.players[t].onFrame(this.roundDuration-this.elapsed)}else this.players.forEach(function(t){return t.onFrame(_this186.elapsed)})}}]);return fs}(),Ao=/*#__PURE__*/function(){function Ao(_ref72){var t=_ref72.playerID,i=_ref72.players,_ref72$effectType=_ref72.effectType,r=_ref72$effectType===void 0?"clickEffect":_ref72$effectType;_classCallCheck(this,Ao);var n,s;this.players=[],this.index=0,this.progressTime=0,this._playerIndex=0,this.elapsed=0,this._playerID=t,this.players=i,this.effectType=r,this.duration=i.reduce(function(o,a){return o+a.duration},0),this.delay=(s=(n=this.players[0])==null?void 0:n.delay)!=null?s:0,this.blocks=[],this.indexBlocks=[];for(var o=0;o<this.players.length;o++){o!==0&&this.players[o].effectType!=="clickEffect"||this.blocks.push(o),this.indexBlocks.push(this.blocks.length-1)}}_createClass(Ao,[{key:"playerID",get:function get(){return this._playerID||(this._playerID="seq[".concat(this.players.map(function(t){return t.playerID}).join(","),"]")),this._playerID}},{key:"length",get:function get(){return this.blocks.length}},{key:"currentPlayer",get:function get(){return this.players[this._playerIndex]}},{key:"isPlaying",get:function get(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function get(){return this.index>=this.blocks.length}},{key:"repeat",get:function get(){var t,i;return(i=(t=this.currentPlayer)==null?void 0:t.repeat)!=null?i:1}},{key:"play",value:function play(){var _this187=this;!this.currentPlayer||this.isPlaying||this.isComplete||(this.currentPlayer.play(),this.frameProcess=ar.update(function(_ref73){var t=_ref73.delta;var i;var r=_this187.currentPlayer;if(r){if(_this187.elapsed+=t,_this187.progressTime+=t,r.isPlaying||r.play(),_this187.elapsed>r.duration){_this187._playerIndex<_this187.players.length&&(_this187._playerIndex+=1,_this187.elapsed=0,_this187.index=(i=_this187.indexBlocks[_this187._playerIndex])!=null?i:_this187.blocks.length);var n=_this187.players[_this187._playerIndex];if(n&&n.effectType!=="clickEffect")return void n.play();_this187.stopTimer()}}else _this187.stopTimer()},!0))}},{key:"pause",value:function pause(){var t;(t=this.currentPlayer)==null||t.pause(),this.stopTimer()}},{key:"seek",value:function seek(t){var i,r;if(t>this.duration){this.pause();for(var s=this._playerIndex;s<this.players.length;s++){var o=this.players[s];o.seek(o.duration)}this.progressTime=this.duration,this.elapsed=0,this._playerIndex=this.players.length,this.index=this.blocks.length}this.progressTime=Xt(0,this.duration,t),this.elapsed=this.progressTime;var n=0;for(;n<this.players.length;){var _s28=this.players[n];if(this.elapsed<=_s28.duration)break;this.elapsed-=_s28.duration,n++}if(this._playerIndex<n){for(var _s29=this._playerIndex;_s29<n;_s29++){var _o19=this.players[_s29];!Number.isFinite(_o19.repeat)&&_o19.isPlaying||_o19.seek(_o19.duration)}(i=this.players[n])==null||i.seek(this.elapsed)}else if(this._playerIndex>n)for(var _s30=this.safePlayerIndex(this._playerIndex);_s30>=n;_s30--){var _o20=this.players[_s30];_s30===n?(_o20.pause(),_o20.seek(this.elapsed)):_o20.reset()}this._playerIndex=n,this.index=(r=this.indexBlocks[this._playerIndex])!=null?r:this.blocks.length}},{key:"onFrame",value:function onFrame(t){throw new Error("onFrame not implemented in seq player")}},{key:"reset",value:function reset(){if(this.progressTime>0&&this.players.length>0)for(var t=this.safePlayerIndex(this._playerIndex);t>=0;t--){this.players[t].reset()}this._playerIndex=0,this.index=0,this.progressTime=0,this.elapsed=0}},{key:"stop",value:function stop(){this.pause(),this.seek(this.duration+1)}},{key:"stopFinite",value:function stopFinite(){this.players.forEach(function(t){return t.stopFinite()})}},{key:"seekIndex",value:function seekIndex(t){var i;this.seekPlayerIndex((i=this.blocks[t])!=null?i:this.players.length)}},{key:"next",value:function next(){this.elapsed>0&&this.seekIndex(this.index+1),this.play()}},{key:"back",value:function back(){this.pause(),this.progressTime<=0||(this.seekIndex(this.elapsed>0?this.index:this.index-1),this.pause())}},{key:"stopTimer",value:function stopTimer(){this.frameProcess&&(Tl.update(this.frameProcess),this.frameProcess=void 0)}},{key:"safePlayerIndex",value:function safePlayerIndex(t){return Math.min(t,this.players.length-1)}},{key:"seekPlayerIndex",value:function seekPlayerIndex(t){var i;if(t=Xt(0,this.players.length,t),this._playerIndex<t)for(var _r105=this._playerIndex;_r105<t;_r105++){this.players[_r105].stopFinite()}else for(var _r106=this.safePlayerIndex(this._playerIndex);_r106>=t;_r106--){this.players[_r106].reset()}this.progressTime=this.getProgressTimeByPlayerIndex(t),this._playerIndex=t,this.index=(i=this.indexBlocks[t])!=null?i:this.blocks.length,this.elapsed=0}},{key:"getProgressTimeByPlayerIndex",value:function getProgressTimeByPlayerIndex(t){var i=0;for(var _r107=0;_r107<t;_r107++){i+=this.players[_r107].duration}return i}}]);return Ao}();function lI(e,t){return function(i){return t(e(i))}}function Dr(e,t,i){return(t-e)*i+e}var tv={exports:{}},iv={exports:{}},cI=function cI(e){return!(!e||typeof e=="string")&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&e.constructor.name!=="String"))},hI=Array.prototype.concat,dI=Array.prototype.slice,rv=iv.exports=function(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i];cI(n)?t=hI.call(t,dI.call(n)):t.push(n)}return t};rv.wrap=function(e){return function(){return e(rv(arguments))}};var El={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Oo=iv.exports,nv={};for(Al in El){El.hasOwnProperty(Al)&&(nv[El[Al]]=Al)}var Al,Qt=tv.exports={to:{},get:{}};function Br(e,t,i){return Math.min(Math.max(t,e),i)}function Ol(e){var t=e.toString(16).toUpperCase();return t.length<2?"0"+t:t}Qt.get=function(e){var t,i;switch(e.substring(0,3).toLowerCase()){case"hsl":t=Qt.get.hsl(e),i="hsl";break;case"hwb":t=Qt.get.hwb(e),i="hwb";break;default:t=Qt.get.rgb(e),i="rgb";}return t?{model:i,value:t}:null},Qt.get.rgb=function(e){if(!e)return null;var t,i,r,n=[0,0,0,1];if(t=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=t[2],t=t[1],i=0;i<3;i++){var s=2*i;n[i]=parseInt(t.slice(s,s+2),16)}r&&(n[3]=parseInt(r,16)/255)}else if(t=e.match(/^#([a-f0-9]{3,4})$/i)){for(r=(t=t[1])[3],i=0;i<3;i++){n[i]=parseInt(t[i]+t[i],16)}r&&(n[3]=parseInt(r+r,16)/255)}else if(t=e.match(/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)){for(i=0;i<3;i++){n[i]=parseInt(t[i+1],0)}t[4]&&(n[3]=parseFloat(t[4]))}else{if(!(t=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)))return(t=e.match(/(\D+)/))?t[1]==="transparent"?[0,0,0,0]:(n=El[t[1]])?(n[3]=1,n):null:null;for(i=0;i<3;i++){n[i]=Math.round(2.55*parseFloat(t[i+1]))}t[4]&&(n[3]=parseFloat(t[4]))}for(i=0;i<3;i++){n[i]=Br(n[i],0,255)}return n[3]=Br(n[3],0,1),n},Qt.get.hsl=function(e){if(!e)return null;var t=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var i=parseFloat(t[4]);return[(parseFloat(t[1])+360)%360,Br(parseFloat(t[2]),0,100),Br(parseFloat(t[3]),0,100),Br(isNaN(i)?1:i,0,1)]}return null},Qt.get.hwb=function(e){if(!e)return null;var t=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var i=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,Br(parseFloat(t[2]),0,100),Br(parseFloat(t[3]),0,100),Br(isNaN(i)?1:i,0,1)]}return null},Qt.to.hex=function(){var e=Oo(arguments);return"#"+Ol(e[0])+Ol(e[1])+Ol(e[2])+(e[3]<1?Ol(Math.round(255*e[3])):"")},Qt.to.rgb=function(){var e=Oo(arguments);return e.length<4||e[3]===1?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},Qt.to.rgb.percent=function(){var e=Oo(arguments),t=Math.round(e[0]/255*100),i=Math.round(e[1]/255*100),r=Math.round(e[2]/255*100);return e.length<4||e[3]===1?"rgb("+t+"%, "+i+"%, "+r+"%)":"rgba("+t+"%, "+i+"%, "+r+"%, "+e[3]+")"},Qt.to.hsl=function(){var e=Oo(arguments);return e.length<4||e[3]===1?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},Qt.to.hwb=function(){var e=Oo(arguments),t="";return e.length>=4&&e[3]!==1&&(t=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+t+")"},Qt.to.keyword=function(e){return nv[e.slice(0,3)]};var yi,Rl,uI=tv.exports;(Rl=yi||(yi={}))[Rl.RGB=0]="RGB",Rl[Rl.HSL=1]="HSL";var Ro=/*#__PURE__*/function(){function Ro(t){_classCallCheck(this,Ro);this.animBox=t,this.$=1}_createClass(Ro,[{key:"snapshot",get:function get(){if(!this._snapshot){var t=this;this._snapshot={$ppt_x:this.animBox.initState.ppt_x,$ppt_y:this.animBox.initState.ppt_y,$ppt_w:this.animBox.initState.ppt_w,$ppt_h:this.animBox.initState.ppt_h,ppt_x:Number(t.animBox.currentState.ppt_x),ppt_y:Number(t.animBox.currentState.ppt_y),ppt_w:Number(t.animBox.currentState.ppt_w),ppt_h:Number(t.animBox.currentState.ppt_h),get $(){return t.$}}}return this._snapshot}}]);return Ro}(),Fr=/*#__PURE__*/function(){function Fr(t,i){_classCallCheck(this,Fr);this.expr=t,this.scope=i}_createClass(Fr,[{key:"valueOf",value:function valueOf(){var t;return(t=this.value)!=null?t:this.evaluate(1)}},{key:"evaluate",value:function evaluate(t){this.scope.$=t;try{return this.value=this.formula.evaluate(this.scope.snapshot),this.value}catch(i){return console.error(i),t}}},{key:"formula",get:function get(){if(!this._formula)try{this._formula=(0,$b.compile)(this.expr.replace(/#/g,"$"))}catch(t){console.error(t),this._formula={evaluate:function evaluate(i){return i}}}return this._formula}}]);return Fr}(),pI=Object.prototype.hasOwnProperty;function Rt(e,t){return pI.call(e,t)}function qt(e){return e instanceof Fr||typeof e=="number"&&!Number.isNaN(e)}function sv(e){return e/12700+"pt"}function mI(e){return!!(e&&Rt(e,"r")&&Rt(e,"g")&&Rt(e,"b")&&Rt(e,"a"))}function fI(e){return!!(e&&Rt(e,"h")&&Rt(e,"s")&&Rt(e,"l")&&Rt(e,"a"))}var ve=/*#__PURE__*/function(){function ve(t){_classCallCheck(this,ve);if(typeof t=="string"){var i=uI.get(t);if(i){var _r108=i.model,n=i.value;switch(_r108){case"hsl":return this.model=yi.HSL,void(this._hslCache={h:n[0],s:n[1],l:n[2],a:n[3]});case"rgb":return this.model=yi.RGB,void(this._rgbCache={r:n[0],g:n[1],b:n[2],a:n[3]});}}}else{if(mI(t))return this.model=yi.RGB,this._rgbCache=t,void(this._hslCache=void 0);if(fI(t))return this.model=yi.HSL,this._hslCache=t,void(this._rgbCache=void 0)}throw new TypeError("[Animatic] incorrect color: ".concat(t))}_createClass(ve,[{key:"rgb",get:function get(){if(!this._rgbCache){if(!this._hslCache)throw new Error("[Animatic] No color available");this._rgbCache=this.hslToRgb(this._hslCache)}return this._rgbCache}},{key:"hsl",get:function get(){if(!this._hslCache){if(!this._rgbCache)throw new Error("[Animatic] No color available");this._hslCache=this.rbgToHsl(this._rgbCache)}return this._hslCache}},{key:"toString",value:function toString(){if(this.model===yi.HSL){var _this$hsl=this.hsl,s=_this$hsl.h,o=_this$hsl.s,a=_this$hsl.l,l=_this$hsl.a;return"hsla(".concat(s,",").concat(o,",").concat(a,",").concat(l,")")}var _this$rgb=this.rgb,t=_this$rgb.r,i=_this$rgb.g,r=_this$rgb.b,n=_this$rgb.a;return"rgba(".concat(t,",").concat(i,",").concat(r,",").concat(n,")")}},{key:"lighten",value:function lighten(t){var i=this.hsl;return new ve(wl(or({},i),{l:Xt(0,100,i.l*(1+t))}))}},{key:"darken",value:function darken(t){var i=this.hsl;return new ve(wl(or({},i),{l:Xt(0,100,i.l*(1-t))}))}},{key:"alpha",value:function alpha(t){var i=this.model===yi.HSL?this.hsl:this.rgb;if(t==null)return i.a;var r=Xt(0,1,t);return r===i.a?this:new ve(wl(or({},i),{a:r}))}},{key:"rbgToHsl",value:function rbgToHsl(t){var i=t.r/255,r=t.g/255,n=t.b/255,s=Math.min(i,r,n),o=Math.max(i,r,n),a=o-s,l=0,h=0;o===s?l=0:i===o?l=(r-n)/a:r===o?l=2+(n-i)/a:n===o&&(l=4+(i-r)/a),l=Math.min(60*l,360),l<0&&(l+=360);var d=(s+o)/2;return h=o===s?0:d<=.5?a/(o+s):a/(2-o-s),{h:l,s:100*h,l:100*d,a:t.a}}},{key:"hslToRgb",value:function hslToRgb(t){var i=t.s/100,r=t.l/100;if(i===0){var d=255*r;return{r:d,g:d,b:d,a:t.a}}var n=t.h/360,s,o,a;s=r<.5?r*(1+i):r+i-r*i;var l=2*r-s,h=[0,0,0];for(var _d7=0;_d7<3;_d7++){o=n+1/3*-(_d7-1),o<0&&o++,o>1&&o--,a=6*o<1?l+6*(s-l)*o:2*o<1?s:3*o<2?l+(s-l)*(2/3-o)*6:l,h[_d7]=255*a}return{r:h[0],g:h[1],b:h[2],a:t.a}}}]);return ve}();function ru(e,t,i){if(e.model===yi.HSL||t.model===yi.HSL){var _r109=e.hsl,n=t.hsl;return new ve({h:Dr(_r109.h,n.h,i),s:Dr(_r109.s,n.s,i),l:Dr(_r109.l,n.l,i),a:Dr(_r109.a,n.a,i)})}{var _r110=e.rgb,_n41=t.rgb;return new ve({r:nu(_r110.r,_n41.r,i),g:nu(_r110.g,_n41.g,i),b:nu(_r110.b,_n41.b,i),a:Dr(_r110.a,_n41.a,i)})}}function nu(e,t,i){var r=e*e,n=t*t;return Math.sqrt(Math.max(0,i*(n-r)+r))}function su(e,t){var i=Object.keys(t),r=i.reduce(function(n,s){switch(s){case"visible":{var o=e[s],a=t[s];n[s]=function(l){return l<=0?o:a};break}case"fillcolor":{var _o21=e[s],_a20=t[s];if(!_o21||!_a20)throw new Error("Mismatch color animation (Key: ".concat(s,", From: ").concat(_o21,", To: ").concat(_a20,")"));n[s]=function(l){return ru(_o21,_a20,l)};break}default:{var _o22=e[s],_a21=t[s];if(!qt(_o22)||!qt(_a21))throw new Error("Mismatch number animation (Key: ".concat(s,", From: ").concat(_o22,", To: ").concat(_a21,")"));n[s]=function(l){return Dr(_o22,_a21,l)};break}}return n},{});return function(n){return i.reduce(function(s,o){var a;var l=(a=r[o])==null?void 0:a.call(r,n);return l!=null&&(s[o]=l),s},{})}}function Bi(e,t){var i;return function(r){return i||(i=su(e(),t)),i(r)}}var Xe=/*#__PURE__*/function(){function Xe(_ref74){var t=_ref74.animBox,i=_ref74.eventSource,r=_ref74.playerID,_ref74$effectType=_ref74.effectType,n=_ref74$effectType===void 0?"clickEffect":_ref74$effectType,s=_ref74.duration,o=_ref74.transform,_ref74$ease=_ref74.ease,a=_ref74$ease===void 0?Jd:_ref74$ease,_ref74$repeat=_ref74.repeat,l=_ref74$repeat===void 0?0:_ref74$repeat,_ref74$rewind=_ref74.rewind,h=_ref74$rewind===void 0?!1:_ref74$rewind,_ref74$reverse=_ref74.reverse,d=_ref74$reverse===void 0?!1:_ref74$reverse,_ref74$delay=_ref74.delay,u=_ref74$delay===void 0?0:_ref74$delay,_ref74$by=_ref74.by,p=_ref74$by===void 0?!1:_ref74$by;_classCallCheck(this,Xe);this.progressTime=0,this.loopCount=0,this.fvTime=0,this.elapsed=0,this.animBox=t,this.eventSource=i,this.playerID=r,this.effectType=n,this.roundDuration=s,this.ease=a,this.repeat=Math.max(1,l),this.rewind=h,this.reverse=d,this.delay=u,this.by=p,this.duration=this.delay+this.roundDuration*(Number.isFinite(this.repeat)?this.repeat:1)*(this.reverse?2:1),this.loop=Number.isFinite(this.repeat)?this.reverse?2*(this.repeat-1)+1:this.repeat-1:this.repeat,this.transform=lI(a,o!=null?o:this.noopTransform)}_createClass(Xe,[{key:"isPlaying",get:function get(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function get(){return this.progressTime>=this.duration}},{key:"play",value:function play(){var _this188=this;this.isPlaying||this.isComplete||(this.preAnimationState||(this.preAnimationState=or({},this.animBox.currentPureState)),this.frameProcess=ar.update(function(_ref75){var t=_ref75.delta;if(_this188.progressTime+=t,_this188.progressTime<=_this188.delay)_this188.fvTime=0;else if(_this188.fvTime<=0&&(_this188.fvTime=Date.now()),_this188.elapsed+=t,_this188.update(),_this188.isPlaying&&_this188.elapsed>_this188.roundDuration){if(_this188.loopCount<_this188.loop)return _this188.elapsed=0,void(_this188.loopCount+=1);_this188.pause()}},!0))}},{key:"pause",value:function pause(){this.frameProcess&&(Tl.update(this.frameProcess),this.frameProcess=void 0)}},{key:"seek",value:function seek(t){var _this189=this;this.preAnimationState||(this.preAnimationState=or({},this.animBox.currentPureState)),t<=0&&(this.fvTime=0),this.progressTime=Xt(0,this.duration,t),this.progressTime<=this.delay?(this.loopCount=0,this.elapsed=0):(this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration-1),this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1),ar.update(function(){return _this189.update()},!1,!1)}},{key:"onFrame",value:function onFrame(t){if(t<=0){if(this.progressTime<=0)return;this.fvTime=0}if(!(t>=this.duration&&this.progressTime>=this.duration)){if(this.preAnimationState||(this.preAnimationState=or({},this.animBox.currentPureState)),this.progressTime=Xt(0,this.duration,t),this.progressTime<=this.delay)return this.loopCount=0,this.elapsed=0,void(this.by&&this.update());this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration),this.reverse?this.elapsed=(this.progressTime-this.delay)%this.roundDuration:this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1,this.update()}}},{key:"reset",value:function reset(){var _this190=this;this.progressTime>0&&(this.pause(),this.loopCount=0,this.fvTime=0,this.elapsed=0,this.progressTime=0),this.preAnimationState&&ar.update(function(){_this190.preAnimationState&&(_this190.animBox.resetState(_this190.playerID,_this190.preAnimationState),_this190.preAnimationState=void 0)},!1,!1)}},{key:"stop",value:function stop(){this.pause(),this.seek(this.duration)}},{key:"stopFinite",value:function stopFinite(){Number.isFinite(this.repeat)&&this.stop()}},{key:"update",value:function update(){var t=Xt(0,1,this.elapsed/this.roundDuration),i=this.transform(this.reverse&&this.loopCount%2!=0?1-t:t);i!=null&&this.animBox.handleStateEvent({type:Io.State,playerID:this.playerID,srcID:this.eventSource,by:this.by,fvTime:this.fvTime,value:i})}},{key:"noopTransform",value:function noopTransform(){return{}}}]);return Xe}(),No=/*#__PURE__*/function(){function No(_ref76){var t=_ref76.cmd,i=_ref76.animBox,r=_ref76.eventSource,n=_ref76.playerID,_ref76$effectType=_ref76.effectType,s=_ref76$effectType===void 0?"clickEffect":_ref76$effectType,_ref76$rewind=_ref76.rewind,o=_ref76$rewind===void 0?!1:_ref76$rewind,_ref76$delay=_ref76.delay,a=_ref76$delay===void 0?0:_ref76$delay;_classCallCheck(this,No);this.repeat=1,this.progressTime=0,this.fvTime=0,this.cmd=t,this.animBox=i,this.eventSource=r,this.playerID=n,this.effectType=s,this.rewind=o,this.delay=a,this.duration=this.delay+1}_createClass(No,[{key:"isPlaying",get:function get(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function get(){return this.progressTime>=this.duration}},{key:"play",value:function play(){var _this191=this;if(!this.isPlaying&&!this.isComplete)return this.duration===1?(this.progressTime=1,void ar.update(function(){return _this191.sendEvent()},!1,!1)):void(this.frameProcess=ar.update(function(_ref77){var t=_ref77.delta;_this191.progressTime+=t,_this191.progressTime<=_this191.delay?_this191.fvTime=0:(_this191.fvTime<=0&&(_this191.fvTime=Date.now()),_this191.sendEvent(),_this191.pause())},!0))}},{key:"pause",value:function pause(){this.frameProcess&&(Tl.update(this.frameProcess),this.frameProcess=void 0)}},{key:"seek",value:function seek(t){t<=0&&(this.fvTime=0),this.progressTime=Xt(0,this.duration,t),t<=0&&this.cmd.name!=="pause"&&this.cmd.name!=="stop"&&this.animBox.handleCmdEvent({type:Io.Cmd,playerID:this.playerID,srcID:this.eventSource,fvTime:Date.now(),value:{name:"pause"}})}},{key:"onFrame",value:function onFrame(t){t<=0&&(this.fvTime=0,this.progressTime<=0)||t>=this.duration&&this.progressTime>=this.duration||(this.progressTime=Xt(0,this.duration,t),this.progressTime>=this.delay&&this.sendEvent())}},{key:"reset",value:function reset(){this.progressTime>0&&(this.pause(),this.fvTime=0,this.progressTime=0)}},{key:"stop",value:function stop(){this.pause(),this.seek(this.duration)}},{key:"stopFinite",value:function stopFinite(){Number.isFinite(this.repeat)&&this.stop()}},{key:"sendEvent",value:function sendEvent(){this.animBox.handleCmdEvent({type:Io.Cmd,playerID:this.playerID,srcID:this.eventSource,fvTime:this.fvTime,value:this.cmd})}}]);return No}();function ou(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:.5;if(e.model===yi.HSL&&e.model===t.model){var _r111=e.hsl,n=t.hsl,s=_r111.h,o=n.h;return new ve({h:s+i*(o>s&&o-s>180?o-(s+360):o<s&&s-o>180?o+360-s:o-s),s:_r111.s+i*(n.s-_r111.s),l:_r111.l+i*(n.l-_r111.l),a:_r111.a*i+n.a*(1-i)})}{var _r112=e.rgb,_n42=t.rgb,_s31=2*i-1,_o23=_r112.a-_n42.a,a=((_s31*_o23==-1?_s31:(_s31+_o23)/(1+_s31*_o23))+1)/2,l=1-a;return new ve({r:a*_r112.r+l*_n42.r,g:a*_r112.g+l*_n42.g,b:a*_r112.b+l*_n42.b,a:_r112.a*i+_n42.a*(1-i)})}}var au=new ve({r:0,g:0,b:0,a:0}),lu,cu=0,ov=typeof window!="undefined"&&window.requestAnimationFrame!==void 0?function(e){return window.requestAnimationFrame(e)}:function(e){var t=Date.now(),i=Math.max(0,16.7-(t-cu));cu=t+i,setTimeout(function(){return e(cu)},i)},av=1/60*1e3,Nl=!0,Lo=!1,hu=!1,Do={delta:0,timestamp:0},du=["read","update","preRender","render","postRender"],gI=function gI(e){return Lo=e},lv=du.reduce(function(e,t){var i,r,n,s,o,a,l,h,d;return e[t]=(i=gI,r=[],n=[],s=0,o=!1,a=0,l=new WeakSet,h=new WeakSet,d={cancel:function cancel(u){var p=n.indexOf(u);l.add(u),p!==-1&&n.splice(p,1)},process:function process(u){var p,f;if(o=!0,r=(p=[n,r])[0],(n=p[1]).length=0,s=r.length)for(a=0;a<s;a++){(f=r[a])(u),h.has(f)!==!0||l.has(f)||(d.schedule(f),i(!0))}o=!1},schedule:function schedule(u,p,f){p===void 0&&(p=!1),f===void 0&&(f=!1);var m=f&&o,g=m?r:n;l["delete"](u),p&&h.add(u),g.indexOf(u)===-1&&(g.push(u),m&&(s=r.length))}}),e},{}),yI=du.reduce(function(e,t){var i=lv[t];return e[t]=function(r,n,s){return n===void 0&&(n=!1),s===void 0&&(s=!1),Lo||vI(),i.schedule(r,n,s),r},e},{}),bI=function bI(e){return lv[e].process(Do)},cv=function cv(e){Lo=!1,Do.delta=Nl?av:Math.max(Math.min(e-Do.timestamp,40),1),Nl||(av=Do.delta),Do.timestamp=e,hu=!0,du.forEach(bI),hu=!1,Lo&&(Nl=!1,ov(cv))},vI=function vI(){Lo=!0,Nl=!0,hu||ov(cv)},uu=function uu(e){var t=e.onRead,i=e.onRender,r=e.uncachedValues,n=r===void 0?new Set:r,s=e.useCache,o=s===void 0||s;return function(a){a===void 0&&(a={});var l=Kd(a,[]),h={},d=[],u=!1;function p(m,g){m.startsWith("--")&&(l.hasCSSVariable=!0);var y=h[m];h[m]=g,h[m]!==y&&(d.indexOf(m)===-1&&d.push(m),u||(u=!0,yI.render(f.render)))}var f={get:function get(m,g){return g===void 0&&(g=!1),!g&&o&&!n.has(m)&&h[m]!==void 0?h[m]:t(m,l)},set:function set(m,g){if(typeof m=="string")p(m,g);else for(var y in m){p(y,m[y])}return this},render:function render(m){return m===void 0&&(m=!1),(u||m===!0)&&(i(h,l,d),u=!1,d.length=0),this}};return f}},SI=/([a-z])([A-Z])/g,Ll=function Ll(e){return e.replace(SI,"$1-$2").toLowerCase()},hv=new Map,pu=new Map,dv=["Webkit","Moz","O","ms",""],wI=dv.length,CI=typeof document!="undefined",uv=function uv(e,t){return pu.set(e,Ll(t))},pv=function pv(e,t){t===void 0&&(t=!1);var i=t?pu:hv;return i.has(e)||(CI?function(r){lu=lu||document.createElement("div");for(var n=0;n<wI;n++){var s=dv[n],o=s==="",a=o?r:s+r.charAt(0).toUpperCase()+r.slice(1);if(a in lu.style||o){if(o&&r==="clipPath"&&pu.has(r))return;hv.set(r,a),uv(r,(o?"":"-")+Ll(a))}}}(e):function(r){uv(r,r)}(e)),i.get(e)||e},kI=["","X","Y","Z"],mu=["translate","scale","rotate","skew","transformPerspective"].reduce(function(e,t){return kI.reduce(function(i,r){return i.push(t+r),i},e)},["x","y","z"]),xI=mu.reduce(function(e,t){return e[t]=!0,e},{});function fu(e){return xI[e]===!0}function PI(e,t){return mu.indexOf(e)-mu.indexOf(t)}var II=new Set(["originX","originY","originZ"]);function MI(e){return II.has(e)}var mv=_Ot(_Ot({},kl),{transform:Math.round}),TI={color:Di,backgroundColor:Di,outlineColor:Di,fill:Di,stroke:Di,borderColor:Di,borderTopColor:Di,borderRightColor:Di,borderBottomColor:Di,borderLeftColor:Di,borderWidth:H,borderTopWidth:H,borderRightWidth:H,borderBottomWidth:H,borderLeftWidth:H,borderRadius:H,radius:H,borderTopLeftRadius:H,borderTopRightRadius:H,borderBottomRightRadius:H,borderBottomLeftRadius:H,width:H,maxWidth:H,height:H,maxHeight:H,size:H,top:H,right:H,bottom:H,left:H,padding:H,paddingTop:H,paddingRight:H,paddingBottom:H,paddingLeft:H,margin:H,marginTop:H,marginRight:H,marginBottom:H,marginLeft:H,rotate:gn,rotateX:gn,rotateY:gn,rotateZ:gn,scale:xl,scaleX:xl,scaleY:xl,scaleZ:xl,skew:gn,skewX:gn,skewY:gn,distance:H,translateX:H,translateY:H,translateZ:H,x:H,y:H,z:H,perspective:H,opacity:Mo,originX:Qb,originY:Qb,originZ:H,zIndex:mv,fillOpacity:Mo,strokeOpacity:Mo,numOctaves:mv},gu=function gu(e){return TI[e]},EI=function EI(e,t){return t&&typeof e=="number"?t.transform(e):e},fv=new Set(["scrollLeft","scrollTop"]),AI=new Set(["scrollLeft","scrollTop","transform"]),OI={x:"translateX",y:"translateY",z:"translateZ"};function gv(e){return typeof e=="function"}function RI(e,t,i,r,n,s,o,a){t===void 0&&(t=!0),i===void 0&&(i={}),r===void 0&&(r={}),n===void 0&&(n={}),s===void 0&&(s=[]),o===void 0&&(o=!1),a===void 0&&(a=!0);var l=!0,h=!1,d=!1;for(var u in e){var p=e[u],f=gu(u),m=EI(p,f);fu(u)?(h=!0,r[u]=m,s.push(u),l&&(f["default"]&&p!==f["default"]||!f["default"]&&p!==0)&&(l=!1)):MI(u)?(n[u]=m,d=!0):AI.has(u)&&gv(m)||(i[pv(u,o)]=m)}return(h||typeof e.transform=="function")&&(i.transform=function(g,y,b,v,w,M){M===void 0&&(M=!0);var x="",T=!1;b.sort(PI);for(var O=b.length,R=0;R<O;R++){var W=b[R];x+=(OI[W]||W)+"("+y[W]+") ",T=W==="z"||T}return!T&&w?x+="translateZ(0)":x=x.trim(),gv(g.transform)?x=g.transform(y,v?"":x):M&&v&&(x="none"),x}(e,r,s,l,t,a)),d&&(i.transformOrigin=(n.originX||"50%")+" "+(n.originY||"50%")+" "+(n.originZ||0)),i}function yu(e){var t=e===void 0?{}:e,i=t.enableHardwareAcceleration,r=i===void 0||i,n=t.isDashCase,s=n===void 0||n,o=t.allowTransformNone,a=o===void 0||o,l={},h={},d={},u=[];return function(p){return u.length=0,RI(p,r,l,h,d,u,s,a),l}}var NI=uu({onRead:function onRead(e,t){var i=t.element,r=t.preparseOutput,n=gu(e);if(fu(e))return n&&n["default"]||0;if(fv.has(e))return i[e];var s=window.getComputedStyle(i,null).getPropertyValue(pv(e,!0))||0;return r&&n&&n.test(s)&&n.parse?n.parse(s):s},onRender:function onRender(e,t,i){var r=t.element,n=t.buildStyles,s=t.hasCSSVariable;if(Object.assign(r.style,n(e)),s)for(var o=i.length,a=0;a<o;a++){var l=i[a];l.startsWith("--")&&r.style.setProperty(l,e[l])}i.indexOf("scrollLeft")!==-1&&(r.scrollLeft=e.scrollLeft),i.indexOf("scrollTop")!==-1&&(r.scrollTop=e.scrollTop)},uncachedValues:fv}),yv=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues"]),bu=function bu(e,t){return H.transform(e*t)},LI={x:0,y:0,width:0,height:0};function bv(e,t,i){return typeof e=="string"?e:H.transform(t+i*e)}var vv={enableHardwareAcceleration:!1,isDashCase:!1};function DI(e,t,i,r,n,s){t===void 0&&(t=LI),r===void 0&&(r=yu(vv)),n===void 0&&(n={style:{}}),s===void 0&&(s=!0);var o=e.attrX,a=e.attrY,l=e.originX,h=e.originY,d=e.pathLength,u=e.pathSpacing,p=u===void 0?1:u,f=e.pathOffset,m=f===void 0?0:f,g=r(Kd(e,["attrX","attrY","originX","originY","pathLength","pathSpacing","pathOffset"]));for(var y in g){y==="transform"?n.style.transform=g[y]:n[s&&!yv.has(y)?Ll(y):y]=g[y]}return(l!==void 0||h!==void 0||g.transform)&&(n.style.transformOrigin=function(b,v,w){return bv(v,b.x,b.width)+" "+bv(w,b.y,b.height)}(t,l!==void 0?l:.5,h!==void 0?h:.5)),o!==void 0&&(n.x=o),a!==void 0&&(n.y=a),i!==void 0&&d!==void 0&&(n[s?"stroke-dashoffset":"strokeDashoffset"]=bu(-m,i),n[s?"stroke-dasharray":"strokeDasharray"]=bu(d,i)+" "+bu(p,i)),n}function BI(e,t,i){i===void 0&&(i=!0);var r={style:{}},n=yu(vv);return function(s){return DI(s,e,t,n,r,i)}}var yt,Sv,FI=uu({onRead:function onRead(e,t){var i=t.element;if(fu(e=yv.has(e)?e:Ll(e))){var r=gu(e);return r&&r["default"]||0}return i.getAttribute(e)},onRender:function onRender(e,t){var i=t.element,r=(0,t.buildAttrs)(e);for(var n in r){n==="style"?Object.assign(i.style,r.style):i.setAttribute(n,r[n])}}}),jI=uu({useCache:!1,onRead:function onRead(e){return e==="scrollTop"?window.pageYOffset:window.pageXOffset},onRender:function onRender(e){var t=e.scrollTop,i=t===void 0?0:t,r=e.scrollLeft,n=r===void 0?0:r;return window.scrollTo(n,i)}}),vu=new WeakMap,zI=function zI(e,t){var i,r,n,s;return e===window?i=jI(e):function(o){return o instanceof HTMLElement||typeof o.click=="function"}(e)?i=function(o,a){a===void 0&&(a={});var l=a.enableHardwareAcceleration,h=a.allowTransformNone,d=Kd(a,["enableHardwareAcceleration","allowTransformNone"]);return NI(_Ot({element:o,buildStyles:yu({enableHardwareAcceleration:l,allowTransformNone:h}),preparseOutput:!0},d))}(e,t):function(o){return o instanceof SVGElement||"ownerSVGElement"in o}(e)&&(n=function(o){try{return function(a){return typeof a.getBBox=="function"?a.getBBox():a.getBoundingClientRect()}(o)}catch(a){return{x:0,y:0,width:0,height:0}}}(r=e),s=function(o){return o.tagName==="path"}(r)&&r.getTotalLength?r.getTotalLength():void 0,i=FI({element:r,buildAttrs:BI(n,s)})),vu.set(e,i),i};function wv(e,t){return function(i,r){return vu.has(i)?vu.get(i):zI(i,r)}(typeof e=="string"?document.querySelector(e):e,t)}function UI(e){switch(e){case"rotate":case"scaleX":case"scaleY":case"fillcolor":return!0;default:return!1;}}(Sv=yt||(yt={})).Paragraph="anim-p",Sv.Text="anim-t";var Su=/*#__PURE__*/function(){function Su(_ref78){var _this192=this;var t=_ref78.target,i=_ref78.pIndex,r=_ref78.tIndex,n=_ref78.constants,_ref78$initState=_ref78.initState,s=_ref78$initState===void 0?{}:_ref78$initState,o=_ref78.applyStyles;_classCallCheck(this,Su);this.handleStateEvent=function(f){var m=f.playerID,g=f.by,y=f.value,b=Object.keys(y).filter(function(v){return y[v]!=null});if(g){var v=_this192.byStates.get(m);v||(v={},_this192.byStates.set(m,v));var _iterator179=_createForOfIteratorHelper(b),_step179;try{for(_iterator179.s();!(_step179=_iterator179.n()).done;){var w=_step179.value;UI(w)?(v[w]=y[w],_this192.currentState[w]=_this192.currentPureState[w]):(_this192.currentState[w]=y[w],_this192.currentPureState[w]=y[w])}}catch(err){_iterator179.e(err)}finally{_iterator179.f()}}else{_this192.lastStateEvent=f;var _iterator180=_createForOfIteratorHelper(b),_step180;try{for(_iterator180.s();!(_step180=_iterator180.n()).done;){var _v2=_step180.value;_this192.currentState[_v2]=y[_v2],_this192.currentPureState[_v2]=y[_v2]}}catch(err){_iterator180.e(err)}finally{_iterator180.f()}}var _iterator181=_createForOfIteratorHelper(_this192.byStates.values()),_step181;try{for(_iterator181.s();!(_step181=_iterator181.n()).done;){var _v3=_step181.value;var _iterator182=_createForOfIteratorHelper(b),_step182;try{for(_iterator182.s();!(_step182=_iterator182.n()).done;){var _w6=_step182.value;_this192.mergeByStates(_w6,_v3)}}catch(err){_iterator182.e(err)}finally{_iterator182.f()}}}catch(err){_iterator181.e(err)}finally{_iterator181.f()}_this192.applyStyles(_this192.convertStyles(_this192.currentState))},this.handleCmdEvent=function(f){_this192.lastCmdEvent=f,f.value.name==="playFrom"?window==null||window.postMessage({type:"_changeAudioState",targetID:_this192.target,play:1,stop:0},"*"):f.value.name==="playSF"?window==null||window.postMessage({type:"_playSoundEffect",targetID:_this192.target,soundEffectId:f.value.value},"*"):window==null||window.postMessage({type:"_changeAudioState",targetID:_this192.target,play:0,stop:1},"*")},this.byStates=new Map,this.target=t,this.pIndex=i,this.tIndex=r,this.constants=n,this.withSubElem=this.pIndex!=null||this.tIndex!=null;var a=n.x,l=n.y,h=n.slideWidth,d=n.slideHeight,u=n.width,p=n.height;this.initState=wl(or({scaleX:1,scaleY:1,rotate:0,opacity:1,xshear:0,yshear:0,fillcolor:au,visible:!0},s),{ppt_x:a/h,ppt_y:l/d,ppt_w:u/h,ppt_h:p/d}),this.currentState=or({},this.initState),this.currentPureState=or({},this.initState),o&&(this.applyStyles=o)}_createClass(Su,[{key:"resetState",value:function resetState(t,i){this.lastStateEvent=void 0,this.lastCmdEvent=void 0,this.byStates["delete"](t),Object.assign(this.currentPureState,i),Object.assign(this.currentState,this.currentPureState);var _iterator183=_createForOfIteratorHelper(this.byStates.values()),_step183;try{for(_iterator183.s();!(_step183=_iterator183.n()).done;){var _r113=_step183.value;for(var n in _r113){this.mergeByStates(n,_r113)}}}catch(err){_iterator183.e(err)}finally{_iterator183.f()}this.applyStyles(this.convertStyles(this.currentState))}},{key:"applyStyles",value:function applyStyles(t){var i=this.getStyler();i&&i.forEach(function(r,n){n?r.set({"pointer-events":t["pointer-events"]}):r.set(t)})}},{key:"applyPreAnimation",value:function applyPreAnimation(){this.preAnimationState&&this.applyStyles(this.convertStyles(this.preAnimationState))}},{key:"preAnimation",value:function preAnimation(t){if(!t)return this.preAnimationState;{this.preAnimationState||(this.preAnimationState={});var i=Object.keys(t);for(var _i40=0,_i39=i;_i40<_i39.length;_i40++){var _r114=_i39[_i40];var n=t[_r114];n!=null&&(this.preAnimationState[_r114]=n,this.currentState[_r114]=n,this.currentPureState[_r114]=n)}}}},{key:"clearCache",value:function clearCache(){this._stylerList=void 0}},{key:"mergeByStates",value:function mergeByStates(t,i){var r,n,s,o,a,l;switch(t){case"rotate":this.currentState.rotate=((r=this.currentState.rotate)!=null?r:0)+((n=i.rotate)!=null?n:0);break;case"scaleX":this.currentState.scaleX=((s=this.currentState.scaleX)!=null?s:1)*((o=i.scaleX)!=null?o:1);break;case"scaleY":this.currentState.scaleY=((a=this.currentState.scaleY)!=null?a:1)*((l=i.scaleY)!=null?l:1);break;case"fillcolor":this.currentState.fillcolor&&i.fillcolor?this.currentState.fillcolor=ou(this.currentState.fillcolor,i.fillcolor):i.fillcolor&&(this.currentState.fillcolor=i.fillcolor);}}},{key:"convertStyles",value:function convertStyles(t){var i,r,n,s,o,a,l,h;var d={"will-change":"opacity,transform"},_this$constants=this.constants,u=_this$constants.x,p=_this$constants.y,f=_this$constants.width,m=_this$constants.height,g=_this$constants.slideWidth,y=_this$constants.slideHeight;for(var b in t){if(Rt(t,b))switch(b){case"ppt_x":{var v=(i=t.ppt_x)!=null?i:this.currentState.ppt_x;d.translateX=sv(v*g-u);break}case"ppt_y":{var _v4=(r=t.ppt_y)!=null?r:this.currentState.ppt_y;d.translateY=sv(_v4*y-p);break}case"scaleX":{var _v5=(n=t.scaleX)!=null?n:1,w=this.currentState.ppt_w;d.scaleX=_v5*w*g/f;break}case"ppt_w":{var _v6=(s=this.currentState.scaleX)!=null?s:1,_w7=(o=t.ppt_w)!=null?o:this.currentState.ppt_w;d.scaleX=_v6*_w7*g/f;break}case"scaleY":{var _v7=(a=t.scaleY)!=null?a:1,_w8=this.currentState.ppt_h;d.scaleY=_v7*_w8*y/m;break}case"ppt_h":{var _v8=(l=this.currentState.scaleY)!=null?l:1,_w9=(h=t.ppt_h)!=null?h:this.currentState.ppt_h;d.scaleY=_v8*_w9*y/m;break}case"fillcolor":if(t.fillcolor!=null){var _v9=t.fillcolor.hsl;d["--sp-fill"]="hsla(".concat(_v9.h,",").concat(_v9.s,"%,").concat(_v9.l,"%,").concat(_v9.a,")"),d["--sp-fill-h"]=_v9.h,d["--sp-fill-s"]=_v9.s+"%",d["--sp-fill-l"]=_v9.l+"%",d["--sp-fill-a"]=_v9.a}break;case"visible":t.visible!=null&&(d.opacity=this.currentState.opacity*(t.visible?1:0),d["pointer-events"]=t.visible?"initial":"none");break;case"opacity":t.opacity!=null&&(d.opacity=t.opacity*(this.currentState.visible?1:0));break;case"rotate":t.rotate!=null&&(d.rotate=Number(t.rotate));break;case"xshear":t.xshear!=null&&(d.skewX=45*t.xshear);break;case"yshear":t.yshear!=null&&(d.skewY=45*t.yshear);break;default:t[b]!=null&&(d[b]=t[b]);}}return this.constants.flipH&&Rt(d,"scaleX")&&(d.scaleX*=-1),this.constants.flipV&&Rt(d,"scaleY")&&(d.scaleY*=-1),Rt(d,"rotate")&&(d.scaleX<0&&(d.rotate*=-1),d.scaleY<0&&(d.rotate*=-1)),d}},{key:"getStyler",value:function getStyler(){if(!this._stylerList){var t=document.getElementById(this.target);if(t&&this.pIndex!=null&&(t=t.querySelectorAll(".".concat(yt.Paragraph))[this.pIndex]),t&&this.tIndex!=null&&(t=t.querySelectorAll(".".concat(yt.Text))[this.tIndex]),t){this._stylerList=[wv(t)];for(var i=0;i<t.children.length;i+=1){t.children[i].classList.contains("ppt-event-source")&&this._stylerList.push(wv(t.children[i]))}}}return this._stylerList}}]);return Su}(),Cv={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,i="~";function r(){}function n(l,h,d){this.fn=l,this.context=h,this.once=d||!1}function s(l,h,d,u,p){if(typeof d!="function")throw new TypeError("The listener must be a function");var f=new n(d,u||l,p),m=i?i+h:h;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],f]:l._events[m].push(f):(l._events[m]=f,l._eventsCount++),l}function o(l,h){--l._eventsCount==0?l._events=new r:delete l._events[h]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(i=!1)),a.prototype.eventNames=function(){var l,h,d=[];if(this._eventsCount===0)return d;for(h in l=this._events){t.call(l,h)&&d.push(i?h.slice(1):h)}return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(l)):d},a.prototype.listeners=function(l){var h=i?i+l:l,d=this._events[h];if(!d)return[];if(d.fn)return[d.fn];for(var u=0,p=d.length,f=new Array(p);u<p;u++){f[u]=d[u].fn}return f},a.prototype.listenerCount=function(l){var h=i?i+l:l,d=this._events[h];return d?d.fn?1:d.length:0},a.prototype.emit=function(l,h,d,u,p,f){var m=i?i+l:l;if(!this._events[m])return!1;var g,y,b=this._events[m],v=arguments.length;if(b.fn){switch(b.once&&this.removeListener(l,b.fn,void 0,!0),v){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,h),!0;case 3:return b.fn.call(b.context,h,d),!0;case 4:return b.fn.call(b.context,h,d,u),!0;case 5:return b.fn.call(b.context,h,d,u,p),!0;case 6:return b.fn.call(b.context,h,d,u,p,f),!0;}for(y=1,g=new Array(v-1);y<v;y++){g[y-1]=arguments[y]}b.fn.apply(b.context,g)}else{var w,M=b.length;for(y=0;y<M;y++){switch(b[y].once&&this.removeListener(l,b[y].fn,void 0,!0),v){case 1:b[y].fn.call(b[y].context);break;case 2:b[y].fn.call(b[y].context,h);break;case 3:b[y].fn.call(b[y].context,h,d);break;case 4:b[y].fn.call(b[y].context,h,d,u);break;default:if(!g)for(w=1,g=new Array(v-1);w<v;w++){g[w-1]=arguments[w]}b[y].fn.apply(b[y].context,g);}}}return!0},a.prototype.on=function(l,h,d){return s(this,l,h,d,!1)},a.prototype.once=function(l,h,d){return s(this,l,h,d,!0)},a.prototype.removeListener=function(l,h,d,u){var p=i?i+l:l;if(!this._events[p])return this;if(!h)return o(this,p),this;var f=this._events[p];if(f.fn)f.fn!==h||u&&!f.once||d&&f.context!==d||o(this,p);else{for(var m=0,g=[],y=f.length;m<y;m++){(f[m].fn!==h||u&&!f[m].once||d&&f[m].context!==d)&&g.push(f[m])}g.length?this._events[p]=g.length===1?g[0]:g:o(this,p)}return this},a.prototype.removeAllListeners=function(l){var h;return l?(h=i?i+l:l,this._events[h]&&o(this,h)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,e.exports=a})(Cv);var VI=Cv.exports,wu=/*#__PURE__*/function(_VI){_inherits(wu,_VI);var _super52=_createSuper(wu);function wu(){_classCallCheck(this,wu);return _super52.call(this)}return wu}(VI);var Wv=P(require("react")),nt=P(require("react")),xs=P(require("react")),Bt=P(require("react"));var Ge=P(require("react")),G=P(require("react")),ju=P(require("react")),Uu=P(require("react")),Vu=P(require("react")),Wu=P(require("react")),Hl=P(require("react")),_r=P(require("react")),Ft=P(require("react")),aS=P(require("react-dom")),Ms=P(require("react")),Ts=P(require("react")),Kr=P(require("react")),Uo=P(require("react")),hr=P(require("react")),Hu=P(require("color"));var wS=P(require("bezier-js"));var vi=P(require("react")),PS=P(require("react-dom")),IS=P(require("eventemitter3")),ot=P(require("react")),jt=P(require("react")),Os=P(require("react")),WI=Object.defineProperty,HI=Object.defineProperties,_I=Object.getOwnPropertyDescriptors,kv=Object.getOwnPropertySymbols,KI=Object.prototype.hasOwnProperty,GI=Object.prototype.propertyIsEnumerable,xv=function xv(e,t,i){return t in e?WI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},A=function A(e,t){for(var i in t||(t={})){KI.call(t,i)&&xv(e,i,t[i])}if(kv){var _iterator184=_createForOfIteratorHelper(kv(t)),_step184;try{for(_iterator184.s();!(_step184=_iterator184.n()).done;){var i=_step184.value;GI.call(t,i)&&xv(e,i,t[i])}}catch(err){_iterator184.e(err)}finally{_iterator184.f()}}return e},F=function F(e,t){return HI(e,_I(t))},wN=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")},yn=12700,Nt=9525,K=1e5,Pv=45720,Iv=91440,Lt=6e4,CN=4.5*yn,$I=1;function Te(e){if(typeof e=="number")return e/K;var t=e.endsWith("%");return parseFloat(e)/(t?100:K)}function E(e){return"".concat(ys(e)/yn,"pt")}function gs(e){return e===0?0:e/Lt}function ys(e){return typeof e=="string"?parseFloat(e):e}function Cu(e){return ys(e)*.75}function bs(e){return ys(e)/.75}function YI(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;return _defineProperty({},Av(e,t),Ev(e,t))}function Ev(e,t){var i=XI(e.elements)||t;if(e.elements.length>0){var _r115={},n=i&&e.elements.length>1;var _iterator185=_createForOfIteratorHelper(e.elements),_step185;try{for(_iterator185.s();!(_step185=_iterator185.n()).done;){var s=_step185.value;var o=Av(s,n),a=Ev(s,t);s.text===void 0?_r115[o]=a:_r115[o]=F(A({},a),{body:s.text})}}catch(err){_iterator185.e(err)}finally{_iterator185.f()}return _r115}else return null}function XI(e){var t={};var _iterator186=_createForOfIteratorHelper(e),_step186;try{for(_iterator186.s();!(_step186=_iterator186.n()).done;){var i=_step186.value;var _r116=i.name||"";if(_r116 in t)return!0;t[_r116]=!0}}catch(err){_iterator186.e(err)}finally{_iterator186.f()}return!1}function Av(e,t){var i=[];e.attr.forEach(function(n){var s=e.attr.getOptional(n);typeof s=="string"?i.push("".concat(n,"=").concat(JSON.stringify(s))):i.push("".concat(n,"=").concat(s))});var r="";return t&&(r+="[".concat(e.index,"] ")),r+="<".concat(e.name),i.length>0&&(r+=" "+i.join(" ")),r+=">",r}var ku=/*#__PURE__*/function(){function ku(e){_classCallCheck(this,ku);this.tagName=e}_createClass(ku,[{key:"get",value:function get(e,t){return this.assignDefaultValue(e,this.getOptional(e),t)}},{key:"getString",value:function getString(e,t){return this.assignDefaultValue(e,this.getStringOptional(e),t)}},{key:"getNumber",value:function getNumber(e,t){return this.assignDefaultValue(e,this.getNumberOptional(e),t)}},{key:"getBoolean",value:function getBoolean(e,t){return this.assignDefaultValue(e,this.getBooleanOptional(e),t)}},{key:"getColor",value:function getColor(e,t){return this.assignDefaultValue(e,this.getColorOptional(e),t)}},{key:"getColorOptional",value:function getColorOptional(e){return this.getOptional(e)}},{key:"getStringOptional",value:function getStringOptional(e){var t=this.getOptional(e);return typeof t=="number"&&(t="".concat(t)),t}},{key:"getNumberOptional",value:function getNumberOptional(e){var t=this.getOptional(e);if(!(typeof t=="string"&&(t=parseInt(t,10),Number.isNaN(t))))return t}},{key:"getBooleanOptional",value:function getBooleanOptional(e){var t=this.getOptional(e);return t==="true"||t==="1"||t==="on"?t=!0:t==="false"||t==="0"||t==="off"?t=!1:t!==void 0&&(t=!!t),t}},{key:"assignDefaultValue",value:function assignDefaultValue(e,t,i){var r=t;if(r===void 0&&(r=i),r===void 0)throw new Error("can't find attribute ".concat(JSON.stringify(e)," from ").concat(this.tagName));return r}}]);return ku}(),QI=/*#__PURE__*/function(_ku){_inherits(QI,_ku);var _super53=_createSuper(QI);function QI(e){_classCallCheck(this,QI);return _super53.call(this,e)}_createClass(QI,[{key:"length",value:function length(){return 0}},{key:"forEach",value:function forEach(e){}},{key:"getOptional",value:function getOptional(e){}},{key:"has",value:function has(e){return!1}}]);return QI}(ku),qI=/*#__PURE__*/function(_ku2){_inherits(qI,_ku2);var _super54=_createSuper(qI);function qI(e,t){var _this193;_classCallCheck(this,qI);_this193=_super54.call(this,e);_this193.attributes=t;return _this193}_createClass(qI,[{key:"length",value:function length(){return Object.keys(this.attributes).length}},{key:"forEach",value:function forEach(e){for(var t in this.attributes){e(t)}}},{key:"has",value:function has(e){return e in this.attributes}},{key:"getOptional",value:function getOptional(e){return this.attributes[e]}}]);return qI}(ku),ZI=/*#__PURE__*/function(_ku3){_inherits(ZI,_ku3);var _super55=_createSuper(ZI);function ZI(e,t,i){var _this194;_classCallCheck(this,ZI);_this194=_super55.call(this,e.name);_this194.xml=e,_this194.picker=t,_this194.resourceType=i;return _this194}_createClass(ZI,[{key:"length",value:function length(){return-1}},{key:"forEach",value:function forEach(e){this.tagName!==void 0&&this.picker.forEachAttributes(this.tagName,e)}},{key:"has",value:function has(e){return this.getOptional(e)!==void 0}},{key:"getOptional",value:function getOptional(e){var t;return this.cachedValues&&e in this.cachedValues?t=this.cachedValues[e]:this.tagName!==void 0&&(this.cachedXMLMap||(this.cachedXMLMap={}),t=this.picker.getAttribute(this.tagName,e,this.xml,this.cachedXMLMap,this.resourceType),this.cachedValues||(this.cachedValues={}),this.cachedValues[e]=t),t}}]);return ZI}(ku),bn=/*#__PURE__*/function(){function bn(e,t){_classCallCheck(this,bn);this.picker=t,this.resourceType=e}_createClass(bn,[{key:"parse",value:function parse(e){return new Ov(this.picker,null,0,(0,Tv.xml2js)(e,{compact:!1,captureSpacesBetweenElements:!0}),this.resourceType)}}]);return bn}(),Y=/*#__PURE__*/function(){function Y(){_classCallCheck(this,Y);for(var _len19=arguments.length,e=new Array(_len19),_key19=0;_key19<_len19;_key19++){e[_key19]=arguments[_key19]}this.tagNames=e}_createClass(Y,[{key:"execute",value:function execute(e){return this.tagNames.find(function(t){return t===e})!==void 0}},{key:"toString",value:function toString(){return this.tagNames.join(" or ")}}]);return Y}(),Ov=/*#__PURE__*/function(){function Ov(e,t,i,r,n){_classCallCheck(this,Ov);this.picker=e,this.parent=t,this.index=i,this.resourceType=n,this.name=r.name,this.type=r.type,this.attr=new qI(this.name,Object.freeze(A({},r.attributes))),this.extraAttr=e?new ZI(this,e,n):new QI(this.name);var s=[];if(r.elements)for(var o=0;o<r.elements.length;++o){var a=r.elements[o];a.type==="text"?this.text=a.text:s.push(new Ov(e,this,o,a,n))}this.elements=Object.freeze(s)}_createClass(Ov,[{key:"element",get:function get(){return this.elements[0]}},{key:"displayer",value:function displayer(e){return YI(this,e)}},{key:"elementWithName",value:function elementWithName(e){var _iterator187=_createForOfIteratorHelper(this.elements),_step187;try{for(_iterator187.s();!(_step187=_iterator187.n()).done;){var t=_step187.value;if(t.name===e)return t}}catch(err){_iterator187.e(err)}finally{_iterator187.f()}}},{key:"extraElementWithName",value:function extraElementWithName(e){if(this.picker&&this.name)return this.cachedXMLMap||(this.cachedXMLMap={}),this.picker.getChild(this.name,e,this,this.cachedXMLMap,this.resourceType)}},{key:"elementsWithName",value:function elementsWithName(e){var t=[];var _iterator188=_createForOfIteratorHelper(this.elements),_step188;try{for(_iterator188.s();!(_step188=_iterator188.n()).done;){var i=_step188.value;i.name===e&&t.push(i)}}catch(err){_iterator188.e(err)}finally{_iterator188.f()}return t}},{key:"childElementOptional",value:function childElementOptional(){for(var _len20=arguments.length,e=new Array(_len20),_key20=0;_key20<_len20;_key20++){e[_key20]=arguments[_key20]}var _this$searchChildElem=this.searchChildElement(e),t=_this$searchChildElem.xml,i=_this$searchChildElem.found;if(i)return t}},{key:"childElement",value:function childElement(){for(var _len21=arguments.length,e=new Array(_len21),_key21=0;_key21<_len21;_key21++){e[_key21]=arguments[_key21]}var _this$searchChildElem2=this.searchChildElement(e),t=_this$searchChildElem2.xml,i=_this$searchChildElem2.found;if(i)return t;typeof this.name=="string"&&e.unshift(this.name);var r=e.join(" -> "),n=e.findIndex(function(a){return a===t.name}),s=e.splice(n+1)[0],o=e.join(" -> ");throw new Error("can't find child ".concat(r,": lack of child ").concat(s," from ").concat(o))}},{key:"searchChildElement",value:function searchChildElement(e){var t=this;for(var i=0;i<e.length;++i){var _r117=e[i],n=t;var _iterator189=_createForOfIteratorHelper(t.elements),_step189;try{for(_iterator189.s();!(_step189=_iterator189.n()).done;){var s=_step189.value;if(typeof _r117=="string"){if(s.name===_r117){t=s;break}}else if(_r117.execute(s.name)){t=s;break}}}catch(err){_iterator189.e(err)}finally{_iterator189.f()}if(n===t)return{xml:t,found:!1}}return{xml:t,found:!0}}},{key:"hasChildElementWithName",value:function hasChildElementWithName(e){var t=this;var _iterator190=_createForOfIteratorHelper(t.elements),_step190;try{for(_iterator190.s();!(_step190=_iterator190.n()).done;){var i=_step190.value;if(i.name===e)return!0}}catch(err){_iterator190.e(err)}finally{_iterator190.f()}return!1}},{key:"parentElement",value:function parentElement(e){var t=this.parentElementOptional(e);if(t)return t;throw new Error("can't find parent ".concat(e," from ").concat(this.name))}},{key:"parentElementOptional",value:function parentElementOptional(e){var t=this.parent;for(;t;){if(typeof e=="string"){if(t.name===e)return t}else if(e.execute(t.name))return t;t=t.parent}}}]);return Ov}(),Rv={"Arial Rounded MT Bold":"https://convertcdn.netless.link/fonts/ArialRoundedMTBold.woff",Arial:"https://convertcdn.netless.link/fonts/arial.woff","Cooper Black":"https://convertcdn.netless.link/fonts/COOPBL.woff",Calibri:"https://convertcdn.netless.link/fonts/Calibri.woff",:"https://convertcdn.netless.link/fonts/msyh.woff",:"https://convertcdn.netless.link/fonts/HuaWenXinWei-1.woff","\u96C5\u75DE-\u7B80":"https://convertcdn.netless.link/fonts/yuppy.woff",:"https://convertcdn.netless.link/fonts/simhei.woff",:"https://convertcdn.netless.link/fonts/simkai.woff",Heiti:"https://convertcdn.netless.link/fonts/simhei.woff",Aharoni:"https://convertcdn.netless.link/fonts/Aharoni.woff","Aharoni Bold":"https://convertcdn.netless.link/fonts/Aharoni%20Bold.woff","source-han-sans":"https://convertcdn.netless.link/fonts/simhei.woff"},Nv="netless-ppt-font-face";function JI(e,t,i){if(document&&i){var _r118=document.getElementById("".concat(Nv,"-").concat(t));if(!_r118)_r118=document.createElement("style"),_r118.id="".concat(Nv,"-").concat(t),document.head.appendChild(_r118);else return;var n=i.filter(function(s){return s.src}).map(function(s){var o=s.src.split("."),a=o[(o==null?void 0:o.length)-1],l={"font-style":s.fontStyle,"font-weight":s.fontWeight,"font-family":"\"".concat(s.fontFamily,"-").concat(t,"\""),src:"url(\"".concat(e,"/fonts/").concat(s.src,"\") format(\"").concat(a,"\")")};return JSON.parse(JSON.stringify(l))}).map(function(s){return"@font-face {".concat(Object.keys(s).reduce(function(o,a){return"".concat(o,"\n").concat(a,": ").concat(s[a],";")},""),"}")});_r118.innerHTML=n.join("\n")}}var xu=new Map;function Lv(_x92,_x93){return _Lv.apply(this,arguments)}function _Lv(){_Lv=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee111(e,t){return regeneratorRuntime.wrap(function _callee111$(_context115){while(1){switch(_context115.prev=_context115.next){case 0:xu.has(e)||(xu.set(e,!0),t&&t[e]?vs(e,t[e]).then(function(){},function(){}):t&&t["*"]?(vs(e,t["*"]).then(function(){},function(){}),vs(e,t["*-bold"],{weight:"500"}).then(function(){},function(){}),vs(e,t["*-italic"],{style:"italic"}).then(function(){},function(){}),vs(e,t["*-bold-italic"],{weight:"500",style:"italic"}).then(function(){},function(){})):Rv[e]&&vs(e,Rv[e]).then(function(){},function(){}));case 1:case"end":return _context115.stop();}}},_callee111)}));return _Lv.apply(this,arguments)}function vs(_x94,_x95,_x96){return _vs.apply(this,arguments)}function _vs(){_vs=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee112(e,t,i){var r,n;return regeneratorRuntime.wrap(function _callee112$(_context116){while(1){switch(_context116.prev=_context116.next){case 0:_context116.t0=t;if(!_context116.t0){_context116.next=7;break}_context116.next=4;return fetch(t,{cache:"force-cache"});case 4:_context116.next=6;return _context116.sent.arrayBuffer();case 6:r=_context116.sent;case 7:if(!r){_context116.next=20;break}n=new FontFace(e,r,i);_context116.prev=9;_context116.next=12;return n.load();case 12:document.fonts.add(n);_context116.next=18;break;case 15:_context116.prev=15;_context116.t1=_context116["catch"](9);console.error("".concat(e," load error font"),_context116.t1);case 18:_context116.next=21;break;case 20:xu["delete"](e);case 21:case"end":return _context116.stop();}}},_callee112,null,[[9,15]])}));return _vs.apply(this,arguments)}function Dv(e,t){if(t.masterThemeColorMapping[e]){var i="a:".concat(t.masterThemeColorMapping[e]),_r119=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",i,"a:srgbClr");if(_r119)return _r119.attr.getString("val");{var n=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",i,"a:sysClr");return n?n.attr.getString("lastClr",e):e}}else{var _i41="a:".concat(e),_r120=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",_i41,"a:srgbClr");if(_r120)return _r120.attr.getString("val");{var _n43=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",_i41,"a:sysClr");return _n43?_n43.attr.getString("lastClr",e):e}}}function Bv(e){var t=Dl(e).childElementOptional("a:majorFont");return t===void 0?{}:Pu(t)}function Fv(e){var t=Dl(e).childElementOptional("a:minorFont");return t===void 0?{}:Pu(t)}function Pu(e){var t={},i=e.childElementOptional("a:latin"),r=e.childElementOptional("a:ea"),n=e.childElementOptional("a:cs");i&&(t.latin=i.attr.getString("typeface","")===""?[]:[i.attr.getString("typeface")]),r&&(t.ea=r.attr.getString("typeface","")===""?[]:[r.attr.getString("typeface")]),n&&(t.cs=n.attr.getString("typeface","")===""?[]:[n.attr.getString("typeface")]);var s=e.elementsWithName("a:font").filter(function(o){return["Hans","Hant","Jpan","Hang"].includes(o.attr.getString("script"))}).map(function(o){return o.attr.getString("typeface")});return t.ea!==void 0?t.ea=t.ea.concat(s):t.ea=s,t}function Dl(e){return e.theme.childElement("a:theme","a:themeElements","a:fontScheme")}function e2(e,t){if(e!=="none"){var i=Dl(t).childElement("a:".concat(e,"Font")),_r121=Pu(i);return Iu(_r121).filter(function(n){return!n.startsWith("+")&&n!==""}).map(function(n){return Lv(n,t.userFonts),n})}else return[]}function Iu(e){var t=[];return e.latin!==void 0&&t.concat(e.latin),e.ea!==void 0&&t.concat(e.ea),e.cs!==void 0&&t.concat(e.cs),t}var Ss=["a:blipFill","a:gradFill","a:grpFill","a:noFill","a:pattFill","a:solidFill"],Fi=["a:hslClr","a:schemeClr","a:srgbClr","a:scrgbClr","a:sysClr","a:prstClr"];function Mu(e,t){var i=t.theme.childElement("a:theme","a:themeElements","a:fmtScheme"),r=e.childElement("a:effectRef"),n=r.childElement(_construct(Y,Fi)),s=r.attr.getNumber("idx"),o=i.childElement("a:effectStyleLst").elements[s-1],a=e.childElement("a:fillRef"),l=a.childElement(_construct(Y,Fi)),h=a.attr.getNumber("idx"),d=i.childElement("a:fillStyleLst").elements[h-1],u=e.childElement("a:fontRef"),p=u.attr.getString("idx"),f;p!=="none"&&(f=Dl(t).childElement("a:".concat(p,"Font")));var m=e.childElement("a:lnRef"),g=m.childElement(_construct(Y,Fi)),y=m.attr.getNumber("idx"),b=i.childElement("a:lnStyleLst").elements[y-1];return{effect:{xml:o,phClr:n},fill:{xml:d,phClr:l},font:{xml:f,fontRef:u},ln:{xml:b,phClr:g}}}var jr=(0,re["default"])("#FFFFFF").alpha(0),cr=(0,re["default"])("#FFFFFF").alpha(0),Zt;(function(e){e.None="none",e.Norm="norm",e.Lighten="lighten",e.LightenLess="lightenLess",e.Darken="darken",e.DarkenLess="darkenLess"})(Zt||(Zt={}));var Bl=/*#__PURE__*/function(){function Bl(){_classCallCheck(this,Bl);this.fillColor=jr.hsl()}_createClass(Bl,[{key:"setFillColor",value:function setFillColor(e){e?this.fillColor=e:this.fillColor=jr.hsl()}},{key:"hsl",value:function hsl(){return this.fillColor.hsl()}},{key:"rgb",value:function rgb(){return this.fillColor.rgb()}}]);return Bl}(),Fl=/*#__PURE__*/function(){function Fl(e){_classCallCheck(this,Fl);this.alphaModFix=1,this.resId=e.childElement("a:blip").attr.getString("r:embed"),e.childElementOptional("a:tile")!==void 0?this.tile=!0:this.tile=!1;var t=e.childElement("a:blip").childElementOptional("a:alphaModFix");if(t!==void 0){var i=t.attr.getNumberOptional("amt");i&&(this.alphaModFix=Te(i))}}_createClass(Fl,[{key:"getResId",value:function getResId(){return this.resId}},{key:"getAlphaModFix",value:function getAlphaModFix(){return this.alphaModFix}},{key:"hsl",value:function hsl(){return jr.hsl()}},{key:"rgb",value:function rgb(){return jr.rgb()}}]);return Fl}(),Fo=/*#__PURE__*/function(){function Fo(e,t,i,r){_classCallCheck(this,Fo);this.colors=[],this.rotation=0,this.path=void 0;var n=e.hasChildElementWithName("a:gsLst")?e.childElement("a:gsLst").elementsWithName("a:gs"):[];if(this.colors=n.sort(function(s,o){var a=s.attr.getNumber("pos")/K,l=o.attr.getNumber("pos")/K;return a-l}).map(function(s){var o=s.attr.getNumber("pos")/K,a=vn(s.childElement(_construct(Y,Fi)),t,i,r);return{stop:o,color:a}}),e.hasChildElementWithName("a:lin")&&(this.rotation=gs(e.childElement("a:lin").attr.getNumber("ang",0))),e.hasChildElementWithName("a:path")){var s=e.childElement("a:path"),o=s.attr.getStringOptional("path"),a=s.childElementOptional("a:fillToRect");if(!a){this.path={path:o,fillToRect:{left:0,top:0,bottom:0,right:0}};return}var l=a.attr.getNumber("l",0),h=a.attr.getNumber("t",0),d=a.attr.getNumber("b",0),u=a.attr.getNumber("r",0);this.path={path:o,fillToRect:{left:l,top:h,bottom:d,right:u}}}}_createClass(Fo,[{key:"getGradientPath",value:function getGradientPath(){return this.path}},{key:"getColors",value:function getColors(){return this.colors}},{key:"getRotation",value:function getRotation(){return this.rotation}},{key:"hsl",value:function hsl(){return this.colors&&this.colors.length>0&&this.colors[0].color?this.colors[0].color.hsl():jr.hsl()}},{key:"rgb",value:function rgb(){return this.colors&&this.colors.length>0&&this.colors[0].color?this.colors[0].color.rgb():jr.rgb()}},{key:"getGradientStyles",value:function getGradientStyles(){var e="linear-gradient(".concat(this.rotation+90,"deg, ");return e+=this.colors.filter(function(t){return t.color}).map(function(t){var i;return"".concat((i=t.color)==null?void 0:i.rgb().string()," ").concat(t.stop*100,"%")}).join(","),e+=")",e}}]);return Fo}();function vn(e,t,i,r){var n;if(e.attr.has("val")){var s=e.childElementOptional("a:alpha"),o=e.childElementOptional("a:shade"),a=e.childElementOptional("a:tint"),l=e.childElementOptional("a:lumMod"),h=e.childElementOptional("a:satMod"),d=e.childElementOptional("a:satOff"),u=e.childElementOptional("a:lumOff"),p=e.childElementOptional("a:hueMod"),f=e.childElementOptional("a:hueOff");switch(e.name){case"a:prstClr":return ws((0,re["default"])(e.attr.getString("val")),s,o,l,a,h,u,d,p,f);case"a:srgbClr":return ws((0,re["default"])("#".concat(e.attr.getString("val"))),s,o,l,a,h,u,d,p,f);case"a:schemeClr":{var m=e.attr.getString("val");return m==="phClr"&&(r?m=r:i.name==="a:sysClr"?m=(n=i.attr.getStringOptional("lastClr"))!=null?n:"accent1":m=i.attr.getString("val")),ws((0,re["default"])("#".concat(Dv(m,t))),s,o,l,a,h,u,d,p,f)}case"a:hslClr":{var _m14=e.attr.getNumber("hue")/Lt,g=e.attr.getNumber("sat")/K,y=e.attr.getNumber("lum")/K;return ws((0,re["default"])({h:_m14,s:g,l:y}),s,o,l,a,h,u)}case"a:scrgbClr":{var _m15=e.attr.getNumber("r")*255/K,_g7=e.attr.getNumber("g")*255/K,_y2=e.attr.getNumber("b")*255/K;return ws((0,re["default"])({r:_m15,g:_g7,b:_y2}),s,o,l,a,h,u)}case"a:sysClr":return ws((0,re["default"])("#".concat(e.attr.getString("lastClr"))),s,o,l,a,h,u,d,p,f);default:return;}}}function Tu(e,t){var i,r,n,s,o,a,l,h,d;var u=Number((i=e.alpha)==null?void 0:i.val),p=Number((r=e.shade)==null?void 0:r.val),f=Number((n=e.tint)==null?void 0:n.val),m=Number((s=e.lumMod)==null?void 0:s.val),g=Number((o=e.satMod)==null?void 0:o.val),y=Number((a=e.satOff)==null?void 0:a.val),b=Number((l=e.lumOff)==null?void 0:l.val),v=Number((h=e.hueMod)==null?void 0:h.val),w=Number((d=e.hueOff)==null?void 0:d.val);return t2((0,re["default"])("#".concat(Dv(e.val,t))),u,p,m,f,g,b,y,v,w)}function ws(e,t,i,r,n,s,o,a,l,h){var d=e;if(n&&(d=d.mix((0,re["default"])("white"),1-n.attr.getNumber("val")/K)),i&&(d=d.mix((0,re["default"])("black"),1-i.attr.getNumber("val")/K)),s){var _d$hsl$object=d.hsl().object(),u=_d$hsl$object.h,p=_d$hsl$object.s,f=_d$hsl$object.l,m=p*s.attr.getNumber("val")/K;d=(0,re["default"])({l:f,s:m,h:u})}if(a){var _d$hsl$object2=d.hsl().object(),_u6=_d$hsl$object2.h,_p4=_d$hsl$object2.s,_f4=_d$hsl$object2.l,_m16=a.attr.getNumber("val")/K*100+_p4;d=(0,re["default"])({l:_f4,s:_m16,h:_u6})}if(r){var _d$hsl$object3=d.hsl().object(),_u7=_d$hsl$object3.h,_p5=_d$hsl$object3.s,_f5=_d$hsl$object3.l,_m17=_f5*r.attr.getNumber("val")/K;d=(0,re["default"])({l:_m17,s:_p5,h:_u7})}if(o){var _d$hsl$object4=d.hsl().object(),_u8=_d$hsl$object4.h,_p6=_d$hsl$object4.s,_f6=_d$hsl$object4.l,_m18=o.attr.getNumber("val")/K*100+_f6;d=(0,re["default"])({l:_m18,s:_p6,h:_u8})}if(l){var _d$hsl$object5=d.hsl().object(),_u9=_d$hsl$object5.h,_p7=_d$hsl$object5.s,_f7=_d$hsl$object5.l,_m19=_u9*l.attr.getNumber("val")/K;d=(0,re["default"])({l:_f7,s:_p7,h:_m19})}if(h){var _d$hsl$object6=d.hsl().object(),_u10=_d$hsl$object6.h,_p8=_d$hsl$object6.s,_f8=_d$hsl$object6.l,_m20=h.attr.getNumber("val")/Lt+_u10;d=(0,re["default"])({l:_f8,s:_p8,h:_m20})}return t&&(d=d.alpha(t.attr.getNumber("val")/K)),d}function t2(e,t,i,r,n,s,o,a,l,h){var d=e;if(n&&(d=e.mix((0,re["default"])("white"),1-n/K)),i&&(d=e.mix((0,re["default"])("black"),1-i/K)),s){var _e$hsl$object=e.hsl().object(),u=_e$hsl$object.h,p=_e$hsl$object.s,f=_e$hsl$object.l,m=p*s/K;d=(0,re["default"])({l:f,s:m,h:u})}if(a){var _e$hsl$object2=e.hsl().object(),_u11=_e$hsl$object2.h,_p9=_e$hsl$object2.s,_f9=_e$hsl$object2.l,_m21=a/K*100+_p9;d=(0,re["default"])({l:_f9,s:_m21,h:_u11})}if(r){var _e$hsl$object3=e.hsl().object(),_u12=_e$hsl$object3.h,_p10=_e$hsl$object3.s,_f10=_e$hsl$object3.l,_m22=_f10*r/K;d=(0,re["default"])({l:_m22,s:_p10,h:_u12})}if(o){var _e$hsl$object4=e.hsl().object(),_u13=_e$hsl$object4.h,_p11=_e$hsl$object4.s,_f11=_e$hsl$object4.l,_m23=o/K*100+_f11;d=(0,re["default"])({l:_m23,s:_p11,h:_u13})}if(l){var _e$hsl$object5=e.hsl().object(),_u14=_e$hsl$object5.h,_p12=_e$hsl$object5.s,_f12=_e$hsl$object5.l,_m24=_u14*l/K;d=(0,re["default"])({l:_f12,s:_p12,h:_m24})}if(h){var _e$hsl$object6=e.hsl().object(),_u15=_e$hsl$object6.h,_p13=_e$hsl$object6.s,_f13=_e$hsl$object6.l,_m25=h/Lt+_u15;d=(0,re["default"])({l:_f13,s:_p13,h:_m25})}return t&&(d=e.alpha(t/K)),d}var zr=/*#__PURE__*/function(){function zr(e){_classCallCheck(this,zr);this.placeHolderColor=e}_createClass(zr,[{key:"read",value:function read(e,t){if(e===void 0)return cr;switch(e.name){case"a:noFill":return jr;case"a:solidFill":return vn(e.childElement(_construct(Y,Fi)),t,this.placeHolderColor);case"a:gradFill":return new Fo(e,t,this.placeHolderColor);case"a:blipFill":return(e.hasChildElementWithName("a:blip")?e.childElement("a:blip").attr.getStringOptional("r:embed"):void 0)!==void 0?new Fl(e):jr;case"a:grpFill":return new Bl;case"a:pattFill":default:return cr;}}}]);return zr}();function X(e){return e instanceof Fl||e===void 0?"none":e.rgb().string()}function jv(e,t){if(e==="none")return e;switch(t){case Zt.None:return"none";case Zt.Norm:return e;case Zt.Darken:return(0,re["default"])(e).darken(.4).rgb().string();case Zt.DarkenLess:return(0,re["default"])(e).darken(.2).rgb().string();case Zt.Lighten:return(0,re["default"])(e).lighten(.4).rgb().string();case Zt.LightenLess:return(0,re["default"])(e).lighten(.2).rgb().string();default:return e;}}var i2=/*#__PURE__*/function(){function i2(){_classCallCheck(this,i2);this.tasks={slideDidUpdate:!1},this.isLoadFinished=!1}_createClass(i2,[{key:"reset",value:function reset(e){this.tasks={slideDidUpdate:!1},this.eventHub=e}},{key:"endLoadTask",value:function endLoadTask(e){var _this195=this;return this.tasks[e]=!0,Object.keys(this.tasks).every(function(t){return _this195.tasks[t]})?(this.eventHub.emit("__PresetTransactionReady__"),!0):!1}},{key:"addLoadTask",value:function addLoadTask(e){this.tasks[e]=!1}},{key:"loadImage",value:function(){var _loadImage=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee58(e){var t,i,_r122,n;return regeneratorRuntime.wrap(function _callee58$(_context60){while(1){switch(_context60.prev=_context60.next){case 0:_context60.prev=0;_context60.next=3;return fetch(e);case 3:t=_context60.sent;i=new FileReader;_context60.next=7;return t.blob();case 7:_r122=_context60.sent;n=new Promise(function(s){i.onload=function(o){var a;s((a=o.target)==null?void 0:a.result)},i.onerror=function(){s(e)}});i.readAsDataURL(_r122);_context60.next=12;return n;case 12:return _context60.abrupt("return",_context60.sent);case 15:_context60.prev=15;_context60.t0=_context60["catch"](0);return _context60.abrupt("return",e);case 18:case"end":return _context60.stop();}}},_callee58,null,[[0,15]])}));function loadImage(_x97){return _loadImage.apply(this,arguments)}return loadImage}()}]);return i2}(),ji=new i2,r2=/*#__PURE__*/function(_Bo$default$Component){_inherits(r2,_Bo$default$Component);var _super56=_createSuper(r2);function r2(e){var _this196;_classCallCheck(this,r2);_this196=_super56.call(this,e);_this196.imageUrl="",_this196.state={imageBase64Url:""},_this196.updateImageUrl(_this196.props);return _this196}_createClass(r2,[{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(e){this.updateImageUrl(e)}},{key:"updateImageUrl",value:function updateImageUrl(e){var _this197=this;var t=e.cSld.extraAttr.getStringOptional("backgroundResId"),i=e.cSld.extraAttr.getStringOptional("backgroundImageResourceType");if(t&&i){var _r123=e.resourceLoader.loadURL(i,t);this.imageUrl!==_r123&&(this.imageUrl=_r123,ji.addLoadTask(_r123),ji.loadImage(_r123).then(function(n){_this197.setState({imageBase64Url:n},function(){ji.endLoadTask(_r123)})},function(){}))}}},{key:"renderImage",value:function renderImage(e,t){var i=this.props.cSld,r=this.state.imageBase64Url,n=i.extraAttr.getStringOptional("backgroundResId"),s=i.extraAttr.getStringOptional("backgroundImageResourceType");if(n&&s){var o=i.extraElementWithName("getBackgroundImageFill");if(o===void 0||o.childElementOptional("a:blip")===void 0)return null;{var a=o.childElement("a:blip").childElementOptional("a:alphaModFix"),l=!!o.childElementOptional("a:tile"),h=1;if(a){var u=a.attr.getNumberOptional("amt");u&&(h=Te(u))}var d={position:"absolute",left:0,top:0,width:E(e),height:E(t),opacity:h,backgroundImage:"url(".concat(r,")"),backgroundSize:l?"auto":"".concat(E(e)," ").concat(E(t))};return Bo["default"].createElement("div",{style:d})}}else{var _o24=i.extraAttr.getColorOptional("backgroundColor"),_a22;return _o24 instanceof Fo?_a22=_o24.getGradientStyles():_a22=X(_o24),_o24?Bo["default"].createElement("div",{style:{position:"absolute",left:0,top:0,width:E(e),height:E(t),background:_a22}}):null}}},{key:"render",value:function render(){var _this$props13=this.props,e=_this$props13.slideContext,t=_this$props13.slideRef,i=_this$props13.className,r=_this$props13.children,n={position:"relative",width:E(e.slideWidth),height:E(e.slideHeight),overflow:"hidden"};return Bo["default"].createElement("div",{id:"ppt-animation-hub",ref:t,className:i,style:n},this.renderImage(e.slideWidth,e.slideHeight),r)}}]);return r2}(Bo["default"].Component),zv=/*#__PURE__*/function(){function zv(e){_classCallCheck(this,zv);this.mapper=e}_createClass(zv,[{key:"map",value:function map(e,t,i){return(!this.buffer||this.buffer.source!==e)&&(this.buffer={source:e,target:this.mapper(e,t,void 0,i)}),this.buffer.target}}]);return zv}();function Uv(e){switch(e){case"b":return"flex-end";case"ctr":return"center";default:return"flex-start";}}function Au(e){switch(e){case"l":return"left";case"r":return"right";case"ctr":return"center";case"just":return"justify";case"dist":return"justify";default:return"left";}}function n2(e){switch(e){case"sng":return"underline";default:return"none";}}function Vv(e,t){var i=t.scaleX,r=t.scaleY;return Math.abs(Math.cos(e/180*Math.PI))>=Math.abs(Math.sin(e/180*Math.PI))?{scaleX:i,scaleY:r}:{scaleX:r,scaleY:i}}var s2=/*#__PURE__*/function(_Wv$default$Component){_inherits(s2,_Wv$default$Component);var _super57=_createSuper(s2);function s2(){_classCallCheck(this,s2);return _super57.apply(this,arguments)}_createClass(s2,[{key:"renderAutoNum",value:function renderAutoNum(e){var _this$props14=this.props,t=_this$props14.buIndexCounter,i=_this$props14.paragraphXML,r=_this$props14.firstRangeXML,n=e.attr.getString("type"),s=e.attr.getNumber("startAt",1),o=t.get(i,s,r)+s;return _v(o,n)}},{key:"renderBuChar",value:function renderBuChar(e){return Hv(e)}},{key:"render",value:function render(){var _this$props15=this.props,e=_this$props15.buXML,t=_this$props15.buIndexCounter;switch(e.name){case"a:buChar":return t.reset(),this.renderBuChar(e.attr.getString("char"));case"a:buAutoNum":return this.renderAutoNum(e);case"a:buNone":case"a:buBlip":return t.reset(),"";}return""}}]);return s2}(Wv["default"].Component);function o2(e){return e<=20?String.fromCodePoint(e+9311):e<=35?String.fromCodePoint(e+12860):e<=50?String.fromCodePoint(e+12941):"".concat(e)}function Hv(e){switch(e){case String.fromCodePoint(159):case" ":case"l":return"\u25CF";case"\xFC":return"\u2713";case"\u2022":return"\u2022";case"n":return"\u25FE";case"\u2013":return"\u2013";case"v":return"\u2756";case"u":return"\u25C6";case"&":return"\uD83D\uDD6E";case"\xD8":return"\u27A3";case"p":return"\u25A1";default:return e;}}function Cs(e){var t=64,i=26,r=e%i;r=r===0?26:r;var n=Math.ceil(e/i);return String.fromCodePoint(r+t).repeat(n)}function ks(e){var t={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},i="",r=e;for(var n in t){for(;r>=t[n];){i+=n,r-=t[n]}}return i}function _v(e,t){switch(t){case"alphaLcParenBoth":return"(".concat(Cs(e),")");case"alphaLcParenR":return"".concat(Cs(e).toLowerCase(),")");case"alphaLcPeriod":return"".concat(Cs(e).toLowerCase(),".");case"alphaUcParenBoth":return"(".concat(Cs(e),")");case"alphaUcParenR":return"".concat(Cs(e),")");case"alphaUcPeriod":return"".concat(Cs(e),".");case"arabicParenBoth":return"(".concat(e,")");case"arabicParenR":return"".concat(e,")");case"arabicPeriod":return"".concat(e,".");case"arabicPlain":return"".concat(e);case"ea1JpnChsDbParenBoth":return"(".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"),")");case"ea1JpnChsDbParenR":return"".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"),")");case"ea1JpnChsDbPeriod":return"".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"),".");case"ea1JpnChsDbPlain":return"".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"));case"circleNumDbPlain":return o2(e);case"romanLcParenBoth":return"(".concat(ks(e).toLowerCase(),")");case"romanLcParenR":return"".concat(ks(e).toLowerCase(),")");case"romanLcPeriod":return"".concat(ks(e).toLowerCase(),".");case"romanUcParenBoth":return"(".concat(ks(e),")");case"romanUcParenR":return"".concat(ks(e),")");case"romanUcPeriod":return"".concat(ks(e),".");default:return"".concat(e,".");}}var a2=/*#__PURE__*/function(_nt$default$Component){_inherits(a2,_nt$default$Component);var _super58=_createSuper(a2);function a2(e){_classCallCheck(this,a2);return _super58.call(this,e)}_createClass(a2,[{key:"hasUnderLine",value:function hasUnderLine(e){switch(e){case"none":return"none";default:return"underline";}}},{key:"render",value:function render(){var _this$props16=this.props,e=_this$props16.text,t=_this$props16.highlightColor,i=_this$props16.underLineStyle,r=_this$props16.indent,n=_this$props16.lineHeight,s=_this$props16.isTextWrap,o=_this$props16.fontFamily,a=_this$props16.isBold,l=_this$props16.color,h=_this$props16.isItalic,d=_this$props16.letterSpacing,u=_this$props16.fontSize;return e?nt["default"].createElement("span",{style:{display:"inline-flex",justifyContent:"space-between",backgroundColor:X(t),textDecoration:this.hasUnderLine(i),width:"100%"}},Array.from(e).map(function(p,f){return f===0&&r?nt["default"].createElement("span",{key:"run-text-".concat(f),style:{display:r?"inline-block":"inline",lineHeight:n,whiteSpace:s?"pre-wrap":"pre",fontSize:"".concat(u,"pt"),fontFamily:o,fontWeight:a?500:400,color:X(l),fontStyle:h?"italic":"normal",letterSpacing:"".concat(d/100,"pt"),textIndent:r?E(r):0}},p):nt["default"].createElement("span",{key:"run-text-".concat(f),style:{display:"inline",lineHeight:n,whiteSpace:s?"pre-wrap":"pre",fontSize:"".concat(u,"pt"),fontFamily:o,fontWeight:a?500:400,color:X(l),fontStyle:h?"italic":"normal",letterSpacing:"".concat(d/100,"pt")}},p)})):null}}]);return a2}(nt["default"].Component),l2=/*#__PURE__*/function(_nt$default$Component2){_inherits(l2,_nt$default$Component2);var _super59=_createSuper(l2);function l2(e){var _this198;_classCallCheck(this,l2);_this198=_super59.call(this,e);_this198.defaultPtSize=18;var t=e.rNodeOrBrNode,i=e.lineHeight,r=e.fontScale,n=t.extraAttr.getNumberOptional("sz"),s;n===void 0?s=_this198.defaultPtSize:s=n,typeof i=="string"?_this198.lineHeight=i:_this198.lineHeight="".concat(s*r*1.2*i,"pt"),_this198.fontSize="".concat(s*r,"pt");return _this198}_createClass(l2,[{key:"hasUnderLine",value:function hasUnderLine(e){switch(e){case"none":return"none";default:return"underline";}}},{key:"renderText",value:function renderText(){var e,_this$props17=this.props,t=_this$props17.rNodeOrBrNode,i=_this$props17.slideIndex,r=_this$props17.fontScale,n=_this$props17.lineHeight,s=_this$props17.indent,o=_this$props17.isTextWrap,a=_this$props17.runIndex,l=_this$props17.align,h=_this$props17.lastRunInParagraph,d=t.attr.getStringOptional("type");if(d)switch(d){case"slidenum":{e=i;break}default:e=new Date(Date.now()).toLocaleDateString();}var u=t.childElementOptional("a:t");if(u===void 0)return nt["default"].createElement("span",null);var p=t.extraAttr.getBoolean("b",!1),f=t.extraAttr.getString("u","none"),m=t.extraAttr.getNumber("spc",0),g=t.extraAttr.getBoolean("i",!1),y=t.extraAttr.getColorOptional("color"),b=t.extraAttr.getNumber("sz",0)*r,v=t.extraAttr.getString("fontType",""),w=t.extraAttr.getColorOptional("highlight",void 0),M,x=t.childElementOptional("a:rPr");x!==void 0&&(M=x.attr.getNumberOptional("baseline"));var T;if(M===void 0)T=e||u.text;else{var R;M>0?(R=40,T=nt["default"].createElement("sup",{style:{fontSize:"small",verticalAlign:"".concat(R+M/K*100,"%")}},e||u.text)):M<0?(R=0,T=nt["default"].createElement("sub",{style:{fontSize:"small",verticalAlign:"".concat(R+M/K*100,"%")}},e||u.text)):T=e||u.text}var O;if(typeof n=="string"?O=n:O="".concat(b*1.2*n,"pt"),l==="dist")return nt["default"].createElement(a2,{fontSize:b,text:"".concat(T),lineHeight:O,indent:s,isTextWrap:o,isBold:p,isItalic:g,underLineStyle:f,fontFamily:v,letterSpacing:m,color:y,highlightColor:w});{var _R={display:s?"inline-block":"inline",lineHeight:n,whiteSpace:o?"pre-wrap":"pre",backgroundColor:X(w),fontSize:"".concat(b,"pt"),textDecoration:this.hasUnderLine(f),fontFamily:v,fontWeight:p?500:400,color:X(y),fontStyle:g?"italic":"normal",letterSpacing:"".concat(m/100,"pt"),overflowWrap:"break-word",textIndent:s?E(s):0};if(h&&(typeof T=="string"||typeof T=="number")){var W="",J=T;if(typeof T=="string")T.length>0&&(J=T.substring(0,T.length-1),W=T.substring(T.length-1));else if(typeof T=="number"){var ee=T+"";J=ee.substring(0,ee.length-1),W=ee.substring(ee.length-1)}return _R["--data-last-word-indent"]=s?"".concat(E(-s)):"0pt",nt["default"].createElement("span",{className:"netless-ppt-last-run","data-last-word":W,key:"run-".concat(a),style:_R},J)}else return nt["default"].createElement("span",{key:"run-".concat(a),style:_R},T)}}},{key:"render",value:function render(){var _this$props18=this.props,e=_this$props18.rNodeOrBrNode,t=_this$props18.runIndex,i=_this$props18.prevElement;switch(e.name){case"a:fld":case"a:r":return this.renderText();case"a:br":return nt["default"].createElement("span",{key:"br-".concat(t),style:{lineHeight:this.lineHeight,fontSize:this.fontSize}},nt["default"].createElement("br",null));case"a:endParaRPr":return i&&i.name==="a:br"?nt["default"].createElement("span",{key:"endParaRPr-".concat(t),style:{lineHeight:this.lineHeight,display:"inline",fontSize:this.fontSize}},nt["default"].createElement("br",null)):null;default:return null;}}}]);return l2}(nt["default"].Component),U;(function(e){e.Horz="horz",e.Vert="vert",e.Vert270="vert270",e.WordArtVert="wordArtVert",e.EaVert="eaVert",e.MongolianVert="mongolianVert",e.WordArtVertRtl="wordArtVertRtl"})(U||(U={}));function Kv(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:U.Horz;switch(e){case U.MongolianVert:case U.WordArtVert:return"vertical-lr";case U.WordArtVertRtl:case U.EaVert:return"vertical-rl";default:return"horizontal-tb";}}function c2(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:U.Horz;return e!==U.Horz?{maxHeight:"100%",width:void 0}:{}}function h2(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:U.Horz;return e===U.WordArtVert||e===U.WordArtVertRtl?{padding:"0.1em"}:{}}function d2(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:U.Horz;switch(e){case U.EaVert:return["\uFF5E","\uFF08","\uFF09","\uFF5B","\uFF5D","\u3010","\u3011","\u300A","\u300B","\u3008","\u3009"];case U.WordArtVertRtl:case U.WordArtVert:return["\u300A","\u300B","\u2026","\u2026","[","]","{","}","<",">","\uFF5E","\u3008","\u3009","(",")","\uFF08","\uFF09"];default:return[];}}function u2(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:U.Horz;switch(e){case U.EaVert:return["\u201C","\u201D","\u2018","\u2019","\uFF1A"];default:return[];}}function Gv(e,t,i){var r,n,s;var o=(r=e.left)!=null?r:0,a=(n=e.right)!=null?n:0,l=0,h=0;((s=e.textBodyWrapResource)==null?void 0:s.prop)?(l=e.textBodyWrapResource.prop.width*Nt,h=e.textBodyWrapResource.prop.height*Nt):(l=e.width,h=e.height);var d=a?a-h/2+l/2:h/2-l/2;if(i===U.Vert270&&t.paddingTop&&typeof t.paddingTop=="string"){var u=parseFloat(t.paddingTop)*yn;Number.isNaN(u)||(d-=u)}return{left:E(o?o-l/2+h/2:l/2-h/2),top:E(d),width:E(h),height:E(l)}}function p2(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:U.Horz;var t=arguments.length>1?arguments[1]:undefined;var i=arguments.length>2?arguments[2]:undefined;var r,n;switch(e){case U.EaVert:return F(A({},t),{writingMode:Kv(e)});case U.WordArtVert:case U.WordArtVertRtl:return F(A({},t),{writingMode:Kv(e),textOrientation:"upright"});case U.Vert:{var s=Gv(i,t,e),o=(r=t.transform)!=null?r:"";return F(A(A({},t),s),{position:"absolute",minHeight:i.insideTable?void 0:s.height,paddingLeft:t.paddingBottom,paddingTop:t.paddingLeft,paddingRight:t.paddingTop,paddingBottom:t.paddingRight,transform:"".concat(o," rotate(90deg)")})}case U.Vert270:{var _s32=Gv(i,t,e),_o25=(n=t.transform)!=null?n:"";return F(A(A({},t),_s32),{position:"absolute",minHeight:i.insideTable?void 0:_s32.height,paddingLeft:t.paddingTop,paddingTop:t.paddingRight,paddingRight:t.paddingBottom,paddingBottom:t.paddingLeft,transform:"".concat(_o25," rotate(-90deg)")})}default:return t;}}function $v(e){var t=e.childElement("a:bodyPr").attr.getStringOptional("vert");if(!t){var i=e.parentElementOptional("a:tc");if(i){var _r124=i.childElementOptional("a:tcPr");_r124&&(t=_r124.attr.getStringOptional("vert"))}}return t||U.Horz}function m2(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:U.Horz;var t=arguments.length>1?arguments[1]:undefined;return e===U.WordArtVertRtl?F(A({},t),{marginTop:t.marginLeft,marginLeft:t.marginBottom,marginRight:t.marginTop}):e===U.EaVert||e===U.WordArtVert?F(A({},t),{marginTop:t.marginLeft,marginLeft:t.marginTop,marginRight:t.marginBottom}):t}function f2(e,t,i){var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:!1;var n,s,o,a,l,h,d,u,p,f,m,g;var y=0,b;return t.includes("m")?b=(a=(o=(s=(n=e==null?void 0:e.master)==null?void 0:n.shapes)==null?void 0:s[t.replace("m","")])==null?void 0:o.textBodyMap)==null?void 0:a[0]:t.includes("l")?b=(u=(d=(h=(l=e==null?void 0:e.layout)==null?void 0:l.shapes)==null?void 0:h[t.replace("l","")])==null?void 0:d.textBodyMap)==null?void 0:u[0]:b=(g=(m=(f=(p=e==null?void 0:e.slide)==null?void 0:p.shapes)==null?void 0:f[t])==null?void 0:m.textBodyMap)==null?void 0:g[0],b&&(i==null?b.paragraphs:b.paragraphs.slice(i,i+1)).forEach(function(v){v.runs.forEach(function(w){w.text&&(r&&w.prop.language==="en"?y+=1:y+=w.text.length)})}),y}function g2(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:U.Horz;var t=arguments.length>1?arguments[1]:undefined;var i=arguments.length>2?arguments[2]:undefined;var r={};return e===U.Horz?r.height="".concat(i,"px"):(r.height="".concat(t,"px"),r.width="".concat(i,"px"),(e===U.Vert||e===U.Vert270)&&(r.width="".concat(t,"px"),r.height="".concat(i,"px")),e===U.WordArtVert||e===U.WordArtVertRtl?r.margin="0 0.6em":r.whiteSpace="nowrap",(e===U.EaVert||e===U.WordArtVertRtl)&&(r.transformOrigin="100% 0")),r}function y2(e){var t;var i=e.childElementOptional("p:txBody","a:bodyPr");return(t=i==null?void 0:i.attr.getStringOptional("vert"))!=null?t:U.Horz}function b2(e){if(e===void 0)return e;if(/^#([A-Fa-f0-9]{8})$/.test(e)){var t=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),_r125=parseInt(e.slice(5,7),16),n=parseInt(e.slice(7,9),16);return n===255?"rgb(".concat(t,",").concat(i,",").concat(_r125,")"):"rgba(".concat(t,",").concat(i,",").concat(_r125,",").concat(n/256,")")}else return e}function Ou(e){var t;var i=e.run.prop,r;i.underLine&&(r="underline"),i.strikeThrough&&(r=r?"".concat(r," line-through"):"line-through");var n;e.run.runType==="tab"&&(n={display:"inline-block",width:e.run.prop.width});var s="'".concat(i.font,"-").concat(e.uuid,"','").concat(i.font,"'"),o=(1-Math.abs(i.baseline))*i.size,a={fontSize:"".concat(o/e.transformScale,"px"),lineHeight:"".concat(i.lineSpacing/e.transformScale,"px")};return A(A({color:b2((t=i.fillType)==null?void 0:t.color),fontFamily:s,fontSize:"".concat(o,"px"),fontStyle:i.italic?"italic":"normal",fontWeight:v2(i),letterSpacing:"".concat(i.kerning||0,"px"),lineHeight:"".concat(i.lineSpacing,"px"),backgroundColor:i.highlightColor,verticalAlign:i.baseline?"".concat(i.baseline*100,"%"):void 0,textDecoration:r},n),a)}function v2(e){return e.fontWeight?e.fontWeight:e.bold?"bold":"normal"}var jl={display:"inline-block",textIndent:0},S2=/*#__PURE__*/function(_Bt$default$Component){_inherits(S2,_Bt$default$Component);var _super60=_createSuper(S2);function S2(e){var _this199;_classCallCheck(this,S2);_this199=_super60.call(this,e);_this199.styles=Ou(e);return _this199}_createClass(S2,[{key:"renderSingleTextNodes",value:function renderSingleTextNodes(e){return e.split("").map(function(t,i){return Bt["default"].createElement("span",{key:i,className:yt.Text,style:jl},t)})}},{key:"render",value:function render(){var _this$props19=this.props,e=_this$props19.run,t=_this$props19.withAnimation,i=_this$props19.isSplitRun,r=e.text||" ",n=r.split("").map(function(o,a){return Bt["default"].createElement("span",{key:a,className:yt.Text,style:jl},o)}),s=Bt["default"].createElement("span",{style:F(A({},this.styles),{whiteSpace:"pre"})}," ");return Bt["default"].createElement("span",{style:F(A({},this.styles),{whiteSpace:"nowrap",display:"inline-block",minWidth:i&&e.runType==="text"?void 0:e.prop.width})},t?n:r.split("").map(function(o){return o===" "?s:o}))}}]);return S2}(Bt["default"].Component),w2=/*#__PURE__*/function(_Bt$default$Component2){_inherits(w2,_Bt$default$Component2);var _super61=_createSuper(w2);function w2(e){var _this200;_classCallCheck(this,w2);_this200=_super61.call(this,e);_this200.horizontalText="",_this200.needSideWayCharacterList=d2(e.vert),_this200.needUpRightCharacterList=u2(e.vert);var t=Ou(e);_this200.fontSpanStyle=A(F(A({},t),{maxHeight:t.fontSize}),h2(e.vert));return _this200}_createClass(w2,[{key:"renderHorizontalNumber",value:function renderHorizontalNumber(e,t){if(!this.horizontalText)return null;var i=this.horizontalText,_this$props20=this.props,r=_this$props20.run,n=_this$props20.vert;return this.horizontalText="",r.prop.kumimoji&&n===U.EaVert?Bt["default"].createElement("span",{className:yt.Text,key:t+i,style:A(F(A({},e),{writingMode:"horizontal-tb"}),jl)},i):Bt["default"].createElement("span",{key:t+i,style:e},Bt["default"].createElement("span",{className:yt.Text,style:jl},i))}},{key:"render",value:function render(){var _this201=this;var _this$props21=this.props,e=_this$props21.run,t=_this$props21.vert,i=e.runType==="tab"?" ":e.text||" ",r=Ou(this.props),n=F(A({},this.fontSpanStyle),{display:"inline-block",verticalAlign:"middle",textIndent:0});return Bt["default"].createElement("span",{style:A({},r)},i&&i.split("").map(function(s,o){return t===U.EaVert&&!Number.isNaN(parseInt(s,10))?(_this201.horizontalText+=s,_this201.horizontalText.length===2?_this201.renderHorizontalNumber(_this201.fontSpanStyle,o):Number.isNaN(parseInt(i[o+1],10))?_this201.renderHorizontalNumber(_this201.fontSpanStyle,o):null):_this201.needSideWayCharacterList.includes(s)?Bt["default"].createElement("span",{className:yt.Text,key:o,style:F(A({},n),{transform:"rotate(90deg)",display:"inline-block"})},s):_this201.needUpRightCharacterList.includes(s)?Bt["default"].createElement("span",{className:yt.Text,key:o,style:F(A({},n),{transform:"rotate(-90deg)",display:"inline-block"})},s):Bt["default"].createElement("span",{className:yt.Text,key:o,style:F(A({},_this201.fontSpanStyle),{display:"inline-block"})},s)}))}}]);return w2}(Bt["default"].Component),C2=/*#__PURE__*/function(_xs$default$Component){_inherits(C2,_xs$default$Component);var _super62=_createSuper(C2);function C2(){_classCallCheck(this,C2);return _super62.apply(this,arguments)}_createClass(C2,[{key:"getScaleStyle",value:function getScaleStyle(e){var t=e.reduce(function(s,o){return(1-Math.abs(o.prop.baseline))*o.prop.size<(1-Math.abs(s.prop.baseline))*s.prop.size?o:s}),i=(1-Math.abs(t.prop.baseline))*t.prop.size,r={},n=1;return i<12&&(n=i/12,r.transform="scale(".concat(n,")"),r.transformOrigin="0 0",r.lineHeight="1",r.display="block"),{scaleStyle:r,transformScale:n}}},{key:"splitRuns",value:function splitRuns(e){function t(i){var r=i.codePointAt(0)||0;return r>=65&&r<=122}return(e.text||"").split("").reduce(function(i,r){var n=i[i.length-1];if(n===void 0)return i.push(F(A({},e),{text:r})),i;var s=n.text||"",o=s[s.length-1],a=t(o),l=t(r);return a&&l?n.text="".concat(s).concat(r):i.push(F(A({},e),{text:r})),i},[])}},{key:"render",value:function render(){var _this202=this;var _this$props22=this.props,e=_this$props22.line,t=_this$props22.justify,i=_this$props22.vert,r=_this$props22.lineIndent,n=_this$props22.align,s=_this$props22.textBodyWrapResource,o=e,a=this.props.uuid,l=!1,h={};t?(l=!0,o=e.reduce(function(b,v){var w=v.runType==="text"?_this202.splitRuns(v):[v],M=b;return M=M.concat(w),M},[]),h={display:"flex",justifyContent:"space-between",width:"calc(100% - ".concat(r||0,"px"),position:"relative",left:r}):h={textIndent:r};var d=o.reduce(function(b,v){return v.prop.lineSpacing>b.prop.lineSpacing?v:b}).prop.lineSpacing,u=0;o.forEach(function(b){u+=Number(b.prop.width)});var p=g2(i,u,d);n==="dist"&&i!==U.Horz&&(p.height=s==null?void 0:s.prop.height);var _this$getScaleStyle=this.getScaleStyle(o),f=_this$getScaleStyle.scaleStyle,m=_this$getScaleStyle.transformScale,g=F(A(A(A({},h),p),f),{whiteSpace:"pre"}),y=this.props.withAnimation;return i!==U.Horz?xs["default"].createElement("div",{style:g},o.map(function(b,v){return xs["default"].createElement(w2,{withAnimation:y,transformScale:m,vert:i,uuid:a,key:v,run:b,firstRun:v===0})})):xs["default"].createElement("div",{style:g},o.map(function(b,v){return xs["default"].createElement(S2,{withAnimation:y,transformScale:m,isSplitRun:l,uuid:a,key:v,run:b,firstRun:v===0})}))}}]);return C2}(xs["default"].Component),zl;(function(e){e.r="r",e.l="l",e.crl="ctr",e.dist="dist",e.just="just"})(zl||(zl={}));var k2=/*#__PURE__*/function(_Dt$default$Component){_inherits(k2,_Dt$default$Component);var _super63=_createSuper(k2);function k2(e){var _this203;_classCallCheck(this,k2);_this203=_super63.call(this,e);if(!e.paragraphXML||!e.bodyPrXML)return _possibleConstructorReturn(_this203);var t=e.bodyPrXML,i=e.paragraphXML;_this203.runElements=i.elements.filter(function(n){return["a:fld","a:r","a:br","a:endParaRPr"].includes(n.name)}),_this203.biggestFontSize=_toConsumableArray(_this203.runElements).filter(function(n){return n.name==="a:r"}).map(function(n){return n.extraAttr.getNumber("sz",0)}).sort(function(n,s){return n-s})[0],_this203.fontScale=.01;var r=t.childElementOptional("a:normAutofit");if(r&&(_this203.fontScale=Te(r.attr.getNumber("fontScale",K))/100),_this203.buChar=i.extraElementWithName("bu"),_this203.indent=i.extraAttr.getNumber("indent",0),_this203.marL=i.extraAttr.getNumber("marL",0),_this203.lineHeightInXml=i.extraAttr.get("lineHeight"),typeof _this203.lineHeightInXml!="number")_this203.lineHeight="".concat(parseFloat(_this203.lineHeightInXml)*_this203.fontScale*100,"pt");else{var n=_this203.getBigestLineHeight(_toConsumableArray(_this203.runElements),_this203.lineHeightInXml,_this203.fontScale);_this203.lineHeight=n===void 0?void 0:"".concat(n,"pt")}_this203.buClr=i.extraAttr.getColorOptional("buClr"),_this203.noneBuChar=_this203.buChar===void 0||_this203.buChar.name==="a:buNone",_this203.paddingBottom=_this203.getPaddingBottom(i.extraAttr.getStringOptional("a:spcAft"),_this203.biggestFontSize),_this203.paddingBottom=_this203.getPaddingTop(i.extraAttr.getStringOptional("a:spcBef"),_this203.biggestFontSize),_this203.align=i.extraAttr.getStringOptional("algn");return _this203}_createClass(k2,[{key:"getPaddingBottom",value:function getPaddingBottom(e,t){var _this$props23=this.props,i=_this$props23.isLast,r=_this$props23.spcFirstLastPara;return i&&!r?"0pt":this.getPadding(e,t)}},{key:"getPaddingTop",value:function getPaddingTop(e,t){var _this$props24=this.props,i=_this$props24.isFirst,r=_this$props24.spcFirstLastPara;return i&&!r?"0pt":this.getPadding(e,t)}},{key:"getPadding",value:function getPadding(e,t){if(e){if(e.indexOf("pt")!==-1)return e;if(t)return"".concat(t*parseFloat(e)/100,"pt")}return"0pt"}},{key:"getBigestLineHeight",value:function getBigestLineHeight(e,t,i){var r;return e.forEach(function(n){switch(n.name){case"a:fld":case"a:r":case"a:br":case"a:endParaRPr":{var s=n.extraAttr.getNumber("sz",0)*1.2*t*i;(r===void 0||r<s)&&(r=s)}}}),r}},{key:"isFlexSpaceBetween",value:function isFlexSpaceBetween(e,t,i){return e===zl.dist?!0:e===zl.just&&t!==i-1}},{key:"renderWrapParagraph",value:function renderWrapParagraph(e){var _this$props25=this.props,t=_this$props25.paragraphWrapResource,i=_this$props25.bulletInfo,r=_this$props25.vert,n=t,_n$prop=n.prop,s=_n$prop.spaceBefore,o=_n$prop.spaceAfter,a=_n$prop.firstLineIndent,_n$prop2=n.prop,l=_n$prop2.align,h=_n$prop2.bulletChar,d=_n$prop2.indent,u=_n$prop2.marginLeft,p=_n$prop2.marginRight;if(e.length===0&&n.endParagraphRunProp){var _n$endParagraphRunPro=n.endParagraphRunProp,g=_n$endParagraphRunPro.spaceBefore,y=_n$endParagraphRunPro.spaceAfter;s=g,o=y}i.order===0&&(s=0),i.order+1===i.count&&(o=0);var f=m2(r,{marginLeft:u,marginRight:p,marginTop:s,marginBottom:o}),m=F(A({textAlign:Au(l),position:"relative",fontSize:"0",lineHeight:"0"},f),{whiteSpace:"pre"});return a===void 0&&(a=Math.max(d,-u),h&&(a=d>=0?d:Math.max(0,-(u+d)))),Dt["default"].createElement("div",{className:yt.Paragraph,style:m},h&&this.renderBulletCharNode(e),this.renderLines(e,a,l))}},{key:"renderBulletCharNode",value:function renderBulletCharNode(e){var t;var _this$props26=this.props,i=_this$props26.paragraphWrapResource,r=_this$props26.bulletInfo,n=_this$props26.vert,s=i,_s$prop=s.prop,o=_s$prop.bulletChar,a=_s$prop.indent;if(!o)return;var l=e.length===0,h=r.number,d=e.slice(0,1),u=d[0]&&d[0][0],p=o.colorFollowText&&u?(t=u.prop.fillType)==null?void 0:t.color:o.color,f=o.fontFollowText&&u?u.prop.font:o.font,m=o.sizeFollowText&&u?u.prop.size:o.size,g=u?"".concat(u.prop.lineSpacing,"px"):void 0,y=o.autoNumber!==void 0&&o.autoNumberType!==void 0,b=a>=0?0:a,v="";l||(y&&h&&(v=_v(h,o.autoNumberType)),y||(v+=Hv(o.character||"l")));var w={position:"absolute",fontFamily:f,fontSize:m,textIndent:b,color:p,lineHeight:g};return n===U.EaVert&&(w.textOrientation="sideways"),Dt["default"].createElement("div",{style:w},v)}},{key:"renderLines",value:function renderLines(e,t,i){var _this204=this;var _this$props27=this.props,r=_this$props27.paragraphWrapResource,n=_this$props27.uuid,s=_this$props27.vert,o=_this$props27.withAnimation,a=_this$props27.textBodyWrapResource;if(e.length===0){var l={},h=r.endParagraphRunProp?r.endParagraphRunProp.lineSpacing:void 0,d=r.endParagraphRunProp?r.endParagraphRunProp.size:void 0,u;if(d&&d<12){var p=d/12;d=12,h=h?h*p:void 0,u="scale(".concat(p,")"),l.display="inline-block"}return l.lineHeight="".concat(h,"px"),l.fontSize="".concat(d,"px"),l.transform=u,Dt["default"].createElement("span",{style:{lineHeight:"".concat(h,"px"),fontSize:"".concat(d,"px"),transform:u}},Dt["default"].createElement("br",null))}return e.map(function(l,h){return Dt["default"].createElement(C2,{key:h,withAnimation:o,uuid:n,vert:s,lineIndent:h===0?t:void 0,line:l,align:i,textBodyWrapResource:a,justify:_this204.isFlexSpaceBetween(i,h,e.length)})})}},{key:"renderRunOrBrOrEnd",value:function renderRunOrBrOrEnd(e,t,i,r,n,s,o,a,l){var _this$props28=this.props,h=_this$props28.isTextWrap,d=_this$props28.slideContext;return Dt["default"].createElement(l2,{key:"".concat(t,"-").concat(i),isTextWrap:h,paragraphHasRange:a!==void 0,rNodeOrBrNode:e,fontScale:r,runIndex:i,indent:i===0&&this.noneBuChar&&this.marL!==0?s:void 0,slideIndex:d.slideIndex,prevElement:l,lineHeight:n,align:this.align?this.align:"l",lastRunInParagraph:o})}},{key:"render",value:function render(){var _this205=this;var _this$props29=this.props,e=_this$props29.paragraphXML,t=_this$props29.resourceType,i=_this$props29.paragraphIndex,r=_this$props29.paragraphWrapResource,n=_this$props29.firstRangeXML,s=_this$props29.buIndexCounter,o=_this$props29.isTextWrap,a=e==null?void 0:e.extraAttr.getBoolean("placeHolderType");if(t!=="slide"&&a)return Dt["default"].createElement("div",{key:"".concat(i)});if(r)return this.renderWrapParagraph(r.lines);if(!e)return null;var l,h=Au(this.align),d=this.runElements.map(function(p,f){var m=h==="left"&&f===_this205.runElements.length-1,g=_this205.renderRunOrBrOrEnd(p,i,f,_this205.fontScale,_this205.lineHeightInXml,_this205.indent,m,n,l);return l=p,g}),u=0;if(n){if(this.buChar&&this.buChar.name!=="a:buNone"){var p=n.extraAttr.getNumber("sz",0),f=n.extraAttr.getString("fontType","");d.unshift(Dt["default"].createElement("span",{key:"bu-".concat(u+=1),style:{display:"inline-block",position:"absolute",color:this.buClr!==void 0?X(this.buClr):X(n.extraAttr.getColorOptional("color")),fontSize:"".concat(p*this.fontScale,"pt"),lineHeight:this.lineHeight,fontFamily:f,textIndent:E(this.indent)}},Dt["default"].createElement(s2,{paragraphXML:e,firstRangeXML:n,buXML:this.buChar,buIndexCounter:s})))}}else{var _p14=0,_f14=e.childElementOptional("a:endParaRPr");if(_f14){var m=_f14.extraAttr.getNumberOptional("sz");_p14=m===void 0?0:m}else _p14=e.extraAttr.getNumber("sz",0);d.push(Dt["default"].createElement("span",{key:"end-".concat(u+=1),style:{display:"block",lineHeight:this.lineHeight,fontSize:"".concat(_p14*this.fontScale,"pt")}},Dt["default"].createElement("br",null)))}return this.buChar&&this.buChar.name==="a:buNone"&&s.reset(),Dt["default"].createElement("li",{key:"".concat(i),className:"".concat(yt.Paragraph," Paragraph-").concat(i),style:{whiteSpace:o?"normal":"nowrap",paddingTop:this.paddingTop,paddingBottom:this.paddingBottom,marginLeft:E(e.extraAttr.getNumber("marL",0)),marginRight:E(e.extraAttr.getNumber("marR",0)),lineHeight:"1pt",listStyleType:"none",textAlign:h}},d)}}]);return k2}(Dt["default"].Component),Ru={"*/":function _(e,t,i){return e*t/i},"+-":function _(e,t,i){return e+t-i},"+/":function _(e,t,i){return(e+t)/i},"?:":function _(e,t,i){return e>0?t:i},abs:function abs(e){return Math.abs(e)},at2:function at2(e,t){return x2(Math.atan2(t,e))},cat2:function cat2(e,t,i){return e*Math.cos(Math.atan2(i,t))},cos:function cos(e,t){return e*Math.cos(Nu(t))},max:function max(e,t){return e>t?e:t},min:function min(e,t){return e<t?e:t},mod:function mod(e,t,i){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(i,2))},pin:function pin(e,t,i){return t<e?e:t>i?i:t},sat2:function sat2(e,t,i){return e*Math.sin(Math.atan2(i,t))},sin:function sin(e,t){return e*Math.sin(Nu(t))},sqrt:function sqrt(e){return Math.sqrt(e)},tan:function tan(e,t){return e*Math.tan(Nu(t))},val:function val(e){return e}};function Nu(e){return e/Lt*(Math.PI/180)}function x2(e){return e*(180/Math.PI)*Lt}var Z=/*#__PURE__*/function(){function Z(e){_classCallCheck(this,Z);this.expr=e}_createClass(Z,[{key:"standardizationTokenSplit",value:function standardizationTokenSplit(e){return e.replace(/\s+/g," ")}},{key:"eval",value:function _eval(e){var t=this.standardizationTokenSplit(this.expr).split(" "),i=t.slice(1,t.length).map(function(r){return Number.isNaN(Number(r))?e.getRequiredVariable(r):parseInt(r,10)});if(Ru[t[0]]===void 0)throw new Error("Formula ".concat(t[0]," not supported"));return Ru[t[0]].apply(Ru,_toConsumableArray(i))}}],[{key:"deconstructShapeGuide",value:function deconstructShapeGuide(e){var _e$split=e.split(" "),_e$split2=_toArray(_e$split),t=_e$split2[0],i=_e$split2.slice(1),r=i.map(function(n){return parseInt(n,10)});return Ru[t].apply(Ru,_toConsumableArray(r))}}]);return Z}();function Ur(_x98,_x99){return _Ur.apply(this,arguments)}function _Ur(){_Ur=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee113(e,t){var i,_r249;return regeneratorRuntime.wrap(function _callee113$(_context117){while(1){switch(_context117.prev=_context117.next){case 0:_context117.next=2;return Xv(e,void 0,t,5e3);case 2:i=_context117.sent;if(!(i.status!==200)){_context117.next=8;break}_context117.next=6;return i.text();case 6:_r249=_context117.sent;throw Yv(e,i.status,t,new Error(_r249)).then(function(){},function(){}),new Error("fetch ".concat(e," failed with ").concat(i.status));case 8:_context117.next=10;return i.text();case 10:return _context117.abrupt("return",_context117.sent);case 11:case"end":return _context117.stop();}}},_callee113)}));return _Ur.apply(this,arguments)}function Vr(_x100,_x101){return _Vr.apply(this,arguments)}function _Vr(){_Vr=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee114(e,t){var i,_r250;return regeneratorRuntime.wrap(function _callee114$(_context118){while(1){switch(_context118.prev=_context118.next){case 0:_context118.next=2;return Xv(e,{headers:{"content-type":"application/json",Accept:"application/json"}},t,5e3);case 2:i=_context118.sent;if(!(i.status!==200)){_context118.next=8;break}_context118.next=6;return i.text();case 6:_r250=_context118.sent;throw Yv(e,i.status,t,new Error(_r250)).then(function(){},function(){}),new Error("fetch ".concat(e," failed with ").concat(i.status));case 8:_context118.next=10;return i.json();case 10:return _context118.abrupt("return",_context118.sent);case 11:case"end":return _context118.stop();}}},_callee114)}));return _Vr.apply(this,arguments)}function Yv(_x102,_x103,_x104,_x105){return _Yv.apply(this,arguments)}function _Yv(){_Yv=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee115(e,t,i,r){return regeneratorRuntime.wrap(function _callee115$(_context119){while(1){switch(_context119.prev=_context119.next){case 0:window&&window.postMessage({name:"pptDataLoadError",src:e,event:"PPT data load failed",status:t},"*"),i==null||i.error("fetch ".concat(JSON.stringify(e)," failed with ").concat(t," : "),r);case 1:case"end":return _context119.stop();}}},_callee115)}));return _Yv.apply(this,arguments)}function Xv(_x106,_x107,_x108,_x109){return _Xv.apply(this,arguments)}function _Xv(){_Xv=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee116(e,t,i,r){var n,s;return regeneratorRuntime.wrap(function _callee116$(_context120){while(1){switch(_context120.prev=_context120.next){case 0:n=setTimeout(function(){i==null||i.warn("fetch ".concat(e," for ").concat(r,"ms"))},r);_context120.prev=1;_context120.next=4;return fetch(e,A({},t));case 4:s=_context120.sent;return _context120.abrupt("return",(clearTimeout(n),s));case 8:_context120.prev=8;_context120.t0=_context120["catch"](1);throw clearTimeout(n),i==null||i.error("fetch ".concat(e," with error ").concat(_context120.t0)),_context120.t0;case 11:case"end":return _context120.stop();}}},_callee116,null,[[1,8]])}));return _Xv.apply(this,arguments)}var P2=/*#__PURE__*/function(){function P2(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"keyval-store";var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"keyval";_classCallCheck(this,P2);this.storeName=t,this._dbp=new Promise(function(i,r){var n=indexedDB.open(e,1);n.onerror=function(){return r(n.error)},n.onsuccess=function(){return i(n.result)},n.onupgradeneeded=function(){n.result.createObjectStore(t)}})}_createClass(P2,[{key:"_withIDBStore",value:function _withIDBStore(e,t){var _this206=this;return this._dbp.then(function(i){return new Promise(function(r,n){var s=i.transaction(_this206.storeName,e);s.oncomplete=function(){return r()},s.onabort=s.onerror=function(){return n(s.error)},t(s.objectStore(_this206.storeName))})})}}]);return P2}(),Lu;function Qv(){return Lu||(Lu=new P2),Lu}function I2(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Qv();var i;return t._withIDBStore("readonly",function(r){i=r.get(e)}).then(function(){return i.result})}function M2(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:Qv();return i._withIDBStore("readwrite",function(r){r.put(t,e)})}var T2=/*#__PURE__*/function(){function T2(){_classCallCheck(this,T2);this.attributePickers={},this.childPickers={}}_createClass(T2,[{key:"createPickers",value:function createPickers(){return new E2(this.attributePickers,this.childPickers)}},{key:"bindAttributePicker",value:function bindAttributePicker(e,t,i){this.bindPicker(e,t,i,this.attributePickers)}},{key:"bindChildPicker",value:function bindChildPicker(e,t,i){this.bindPicker(e,t,i,this.childPickers)}},{key:"bindPicker",value:function bindPicker(e,t,i,r){typeof e=="string"&&(e=[e]),typeof t=="string"&&(t=[t]);var _iterator191=_createForOfIteratorHelper(e),_step191;try{for(_iterator191.s();!(_step191=_iterator191.n()).done;){var n=_step191.value;this.bindPickerWithAttributeNames(n,t,i,r)}}catch(err){_iterator191.e(err)}finally{_iterator191.f()}}},{key:"bindPickerWithAttributeNames",value:function bindPickerWithAttributeNames(e,t,i,r){var n=r[e];if(n||(n=r[e]={}),_typeof(n)=="object"){var _iterator192=_createForOfIteratorHelper(t),_step192;try{for(_iterator192.s();!(_step192=_iterator192.n()).done;){var s=_step192.value;n[s]=i}}catch(err){_iterator192.e(err)}finally{_iterator192.f()}}}}]);return T2}(),qv=/*#__PURE__*/function(){function qv(e){_classCallCheck(this,qv);this.pickers=e}_createClass(qv,[{key:"forEach",value:function forEach(e,t){var i=this.pickers[e];if(i)for(var _r126 in i){_r126!=="*"&&t(_r126)}}},{key:"has",value:function has(e,t){var i=this.pickers[e];return i?t in i||"*"in i:!1}},{key:"get",value:function get(e,t,i,r,n,s){var o=this.pickers[t];if(o){var a=o[i];if(a||(a=o["*"]),a)return a(r,e,i,n,s)}}}]);return qv}(),E2=/*#__PURE__*/function(){function E2(e,t){_classCallCheck(this,E2);this.attributePickers=new qv(e),this.childPickers=new qv(t)}_createClass(E2,[{key:"forEachAttributes",value:function forEachAttributes(e,t){this.attributePickers.forEach(e,t)}},{key:"hasAttribute",value:function hasAttribute(e,t){return this.attributePickers.has(e,t)}},{key:"getAttribute",value:function getAttribute(e,t,i,r,n){if(this.context)return this.attributePickers.get(this.context,e,t,i,r,n)}},{key:"getChild",value:function getChild(e,t,i,r,n){if(this.context)return this.childPickers.get(this.context,e,t,i,r,n)}}]);return E2}(),jo=/*#__PURE__*/function(){function jo(e){_classCallCheck(this,jo);this.resourceScheme=e}_createClass(jo,[{key:"loadLumiaPSD",value:function(){var _loadLumiaPSD=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee59(e,t){var i,r;return regeneratorRuntime.wrap(function _callee59$(_context61){while(1){switch(_context61.prev=_context61.next){case 0:r="https://convertcdn.netless.link/publicFiles/xml/PresetShapeDefinitions.xml";this.resourceScheme&&(r=r.replace(/^[a-zA-z]+[^://]/,this.resourceScheme));if(!(e===!1)){_context61.next=8;break}_context61.next=5;return Ur(r,t);case 5:i=_context61.sent;_context61.next=18;break;case 8:_context61.next=10;return I2("PresetShapeDefinitions");case 10:i=_context61.sent;_context61.t0=i===void 0;if(!_context61.t0){_context61.next=18;break}_context61.next=15;return Ur(r,t);case 15:i=_context61.sent;_context61.next=18;return M2("PresetShapeDefinitions",i);case 18:jo.presetShapeDefinitons=new bn("slide").parse(i).childElement("presetShapeDefinitons");case 19:case"end":return _context61.stop();}}},_callee59,this)}));function loadLumiaPSD(_x111,_x112){return _loadLumiaPSD.apply(this,arguments)}return loadLumiaPSD}()},{key:"preLoad",value:function(){var _preLoad=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee60(e,t,i,r){var n,s,o,a;return regeneratorRuntime.wrap(function _callee60$(_context62){while(1){switch(_context62.prev=_context62.next){case 0:_context62.next=2;return this.fetchAllResourceUrl(t,i,r.logger);case 2:n=_context62.sent;s=0;case 4:if(!(s<n.length)){_context62.next=12;break}o=s+1,a=n[s];_context62.next=8;return this.prefetchPageResource(a);case 8:r.preloadProgress&&r.preloadProgress((o/n.length).toFixed(2));case 9:s++;_context62.next=4;break;case 12:case"end":return _context62.stop();}}},_callee60,this)}));function preLoad(_x113,_x114,_x115,_x116){return _preLoad.apply(this,arguments)}return preLoad}()},{key:"prefetchPageResource",value:function(){var _prefetchPageResource=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee61(e){var t,_i42,_Object$keys,i;return regeneratorRuntime.wrap(function _callee61$(_context63){while(1){switch(_context63.prev=_context63.next){case 0:t=[];for(_i42=0,_Object$keys=Object.keys(e);_i42<_Object$keys.length;_i42++){i=_Object$keys[_i42];t.push(this.prefetchResource(e[i]))}_context63.next=4;return Promise.all(t);case 4:case"end":return _context63.stop();}}},_callee61,this)}));function prefetchPageResource(_x117){return _prefetchPageResource.apply(this,arguments)}return prefetchPageResource}()},{key:"prefetchResource",value:function(){var _prefetchResource=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee62(e){var t,i,_i43,_t14,_r127,n,s;return regeneratorRuntime.wrap(function _callee62$(_context64){while(1){switch(_context64.prev=_context64.next){case 0:if(!(Object.keys(e).length>0)){_context64.next=15;break}t=Object.keys(e),i=[];_i43=0,_t14=t;case 3:if(!(_i43<_t14.length)){_context64.next=13;break}_r127=_t14[_i43];n=e[_r127];if(!n.endsWith(".mp4")){_context64.next=8;break}return _context64.abrupt("continue",10);case 8:s=n;this.resourceScheme&&(s=n.replace(/^[a-zA-z]+[^://]/,this.resourceScheme)),i.push(this.fetch(s));case 10:_i43++;_context64.next=3;break;case 13:_context64.next=15;return Promise.all(i);case 15:case"end":return _context64.stop();}}},_callee62,this)}));function prefetchResource(_x118){return _prefetchResource.apply(this,arguments)}return prefetchResource}()},{key:"fetch",value:function(_fetch2){function fetch(_x110){return _fetch2.apply(this,arguments)}fetch.toString=function(){return _fetch2.toString()};return fetch}(/*#__PURE__*/function(){var _ref80=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee63(e){return regeneratorRuntime.wrap(function _callee63$(_context65){while(1){switch(_context65.prev=_context65.next){case 0:_context65.prev=0;_context65.next=3;return fetch(e);case 3:_context65.next=8;break;case 5:_context65.prev=5;_context65.t0=_context65["catch"](0);console.debug("cache fail",_context65.t0);case 8:case"end":return _context65.stop();}}},_callee63,null,[[0,5]])}));return function(_x119){return _ref80.apply(this,arguments)}}())},{key:"fetchAllResourceUrl",value:function(){var _fetchAllResourceUrl=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee64(e,t,i){var r,n;return regeneratorRuntime.wrap(function _callee64$(_context66){while(1){switch(_context66.prev=_context66.next){case 0:r=[];for(n=1;n<=t;n++){r.push(Vr("".concat(e,"/resources/resource").concat(n,".json"),i))}_context66.next=4;return Promise.all(r);case 4:return _context66.abrupt("return",_context66.sent);case 5:case"end":return _context66.stop();}}},_callee64)}));function fetchAllResourceUrl(_x120,_x121,_x122){return _fetchAllResourceUrl.apply(this,arguments)}return fetchAllResourceUrl}()},{key:"fetchPageResource",value:function(){var _fetchPageResource=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee65(e,t,i){return regeneratorRuntime.wrap(function _callee65$(_context67){while(1){switch(_context67.prev=_context67.next){case 0:_context67.next=2;return Vr("".concat(e,"/resources/resource").concat(t,".json"),i);case 2:return _context67.abrupt("return",_context67.sent);case 3:case"end":return _context67.stop();}}},_callee65)}));function fetchPageResource(_x123,_x124,_x125){return _fetchPageResource.apply(this,arguments)}return fetchPageResource}()}]);return jo}(),Zv=/*#__PURE__*/function(){function Zv(e){_classCallCheck(this,Zv);this.foundStartPostion=!1,this.variablesMap=e,this.injectConstant()}_createClass(Zv,[{key:"injectConstant",value:function injectConstant(){this.setVariable("3cd4",162e5),this.setVariable("3cd8",81e5),this.setVariable("5cd8",135e5),this.setVariable("7cd8",189e5),this.setVariable("b",new Z("val h").eval(this)),this.setVariable("cd2",108e5),this.setVariable("cd4",54e5),this.setVariable("cd8",27e5),this.setVariable("hc",new Z("*/ w 1.0 2.0").eval(this)),this.setVariable("hd2",new Z("*/ h 1.0 2.0").eval(this)),this.setVariable("hd3",new Z("*/ h 1.0 3.0").eval(this)),this.setVariable("hd4",new Z("*/ h 1.0 4.0").eval(this)),this.setVariable("hd5",new Z("*/ h 1.0 5.0").eval(this)),this.setVariable("hd6",new Z("*/ h 1.0 6.0").eval(this)),this.setVariable("hd8",new Z("*/ h 1.0 8.0").eval(this)),this.setVariable("l",0),this.setVariable("ls",new Z("max w h").eval(this)),this.setVariable("r",new Z("val w").eval(this)),this.setVariable("ss",new Z("min w h").eval(this)),this.setVariable("ssd2",new Z("*/ ss 1.0 2.0").eval(this)),this.setVariable("ssd4",new Z("*/ ss 1.0 4.0").eval(this)),this.setVariable("ssd6",new Z("*/ ss 1.0 6.0").eval(this)),this.setVariable("ssd8",new Z("*/ ss 1.0 8.0").eval(this)),this.setVariable("ssd16",new Z("*/ ss 1.0 16.0").eval(this)),this.setVariable("ssd32",new Z("*/ ss 1.0 32.0").eval(this)),this.setVariable("t",0),this.setVariable("vc",new Z("*/ h 1.0 2.0").eval(this)),this.setVariable("wd2",new Z("*/ w 1.0 2.0").eval(this)),this.setVariable("wd3",new Z("*/ w 1.0 3.0").eval(this)),this.setVariable("wd4",new Z("*/ w 1.0 4.0").eval(this)),this.setVariable("wd5",new Z("*/ w 1.0 5.0").eval(this)),this.setVariable("wd6",new Z("*/ w 1.0 6.0").eval(this)),this.setVariable("wd8",new Z("*/ w 1.0 8.0").eval(this)),this.setVariable("wd10",new Z("*/ w 1.0 10.0").eval(this)),this.setVariable("wd12",new Z("*/ w 1.0 12.0").eval(this)),this.setVariable("wd32",new Z("*/ w 1.0 32.0").eval(this))}},{key:"getVariable",value:function getVariable(e,t){return this.variablesMap[e]!==void 0?this.variablesMap[e]:t}},{key:"getRequiredVariable",value:function getRequiredVariable(e){if(this.variablesMap[e]!==void 0)return this.variablesMap[e];throw new Error("".concat(e," is required"))}},{key:"setVariable",value:function setVariable(e,t){this.variablesMap[e]=t}},{key:"setVariableIfNotExist",value:function setVariableIfNotExist(e,t){this.variablesMap[e]===void 0&&(this.variablesMap[e]=t)}},{key:"isNumeric",value:function isNumeric(e){return /^-{0,1}\d+$/.test(e)}},{key:"accessValue",value:function accessValue(e){var t;return this.isNumeric(e)?t=parseInt(e,10):t=this.getRequiredVariable(e),t}},{key:"setLatestPostion",value:function setLatestPostion(e,t){this.latestPostionX=e,this.latestPostionY=t,this.foundStartPostion||(this.startPostionX=e,this.startPostionY=t,this.foundStartPostion=!0)}},{key:"getLatestPostion",value:function getLatestPostion(){return{x:this.latestPostionX,y:this.latestPostionY}}},{key:"getStartPostion",value:function getStartPostion(){return{x:this.startPostionX,y:this.startPostionY}}},{key:"inspect",value:function inspect(){console.debug(JSON.stringify(this.variablesMap))}}]);return Zv}(),Jv=/*#__PURE__*/function(){function Jv(){_classCallCheck(this,Jv)}_createClass(Jv,[{key:"renderLumiaPath",value:function renderLumiaPath(e,t){var _this207=this;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";var r=e.childElementOptional("".concat(i,"avLst"));r&&r.elementsWithName("".concat(i,"gd")).forEach(function(l){var h=l.attr.getString("fmla"),d=new Z(h).eval(t),u=l.attr.getString("name");t.setVariableIfNotExist(u,d)});var n=e.childElementOptional("".concat(i,"gdLst"));n&&n.elementsWithName("".concat(i,"gd")).forEach(function(l){var h=l.attr.getString("fmla"),d=new Z(h).eval(t),u=l.attr.getString("name");t.setVariable(u,d)});var s=e.childElementOptional("".concat(i,"rect"));s?(t.setVariable("rectLeft",t.accessValue(s.attr.getString("l"))),t.setVariable("rectTop",t.accessValue(s.attr.getString("t"))),t.setVariable("rectRight",t.accessValue(s.attr.getString("r"))),t.setVariable("rectBottom",t.accessValue(s.attr.getString("b")))):(t.setVariable("rectLeft",t.accessValue("l")),t.setVariable("rectTop",t.accessValue("t")),t.setVariable("rectRight",t.accessValue("r")),t.setVariable("rectBottom",t.accessValue("b")));var o=e.childElement("".concat(i,"pathLst")).elementsWithName("".concat(i,"path")),a=[];return o.forEach(function(l){var h;var d={fill:void 0,pathD:"",isBorder:(h=l.attr.getBooleanOptional("stroke"))!=null?h:!0};d.fill=l.attr.getStringOptional("fill")||void 0;var _this207$calcPathScal=_this207.calcPathScale(l,t),u=_this207$calcPathScal.pathWidthScale,p=_this207$calcPathScal.pathHeightScale,f=l.elements.map(function(m){return new A2(m,i,u,p).generate(t)});d.pathD=f.join(" "),a.push(d)}),a}},{key:"calcPathScale",value:function calcPathScale(e,t){var i=e.attr.getNumberOptional("w"),r=e.attr.getNumberOptional("h"),n=1,s=1;return i&&(n=t.accessValue("w")/i),r&&(s=t.accessValue("h")/r),{pathWidthScale:n,pathHeightScale:s}}}]);return Jv}(),A2=/*#__PURE__*/function(){function A2(e,t,i,r){_classCallCheck(this,A2);this.actionXML=e,this.namespace=t,this.pathWidthScale=i,this.pathHeightScale=r}_createClass(A2,[{key:"xUnitTransformAndPathScale",value:function xUnitTransformAndPathScale(e){return e*this.pathWidthScale/Nt}},{key:"yUnitTransformAndPathScale",value:function yUnitTransformAndPathScale(e){return e*this.pathHeightScale/Nt}},{key:"generate",value:function generate(e){var _this208=this;var t=this.actionXML.elementsWithName("".concat(this.namespace,"pt")).map(function(l){return{x:l.attr.getString("x"),y:l.attr.getString("y")}}).map(function(l){var h=_this208.getPtValue(l,e,"x"),d=_this208.getPtValue(l,e,"y");return{x:h,y:d}}),i=t.length>0?t[0].x:0,r=t.length>0?t[0].y:0,n=t.length>1?t[1].x:0,s=t.length>1?t[1].y:0,o=t.length>2?t[2].x:0,a=t.length>2?t[2].y:0;switch(this.actionXML.name){case"".concat(this.namespace,"moveTo"):return e.setLatestPostion(i,r),["M",this.xUnitTransformAndPathScale(i),this.yUnitTransformAndPathScale(r)].join(" ");case"".concat(this.namespace,"lnTo"):return e.setLatestPostion(i,r),["L",this.xUnitTransformAndPathScale(i),this.yUnitTransformAndPathScale(r)].join(" ");case"".concat(this.namespace,"arcTo"):{var l=e.accessValue(this.actionXML.attr.getString("wR")),h=e.accessValue(this.actionXML.attr.getString("hR")),d=e.accessValue(this.actionXML.attr.getString("stAng"))/Lt,u=e.accessValue(this.actionXML.attr.getString("swAng"))/Lt,_e$getLatestPostion=e.getLatestPostion(),p=_e$getLatestPostion.x,f=_e$getLatestPostion.y,m=this.getSvgArc(l,h,d,u,p,f);return u>=360?(e.setLatestPostion(m.endX,m.endY),["A",this.xUnitTransformAndPathScale(m.radiusX),this.yUnitTransformAndPathScale(m.radiusY),m.xAxisRotation,m.largeArcFlag,m.sweepFlag,this.xUnitTransformAndPathScale(m.middleX),this.yUnitTransformAndPathScale(m.middleY),"A",this.xUnitTransformAndPathScale(m.radiusX),this.yUnitTransformAndPathScale(m.radiusY),m.xAxisRotation,m.largeArcFlag,m.sweepFlag,this.xUnitTransformAndPathScale(m.endX),this.yUnitTransformAndPathScale(m.endY)].join(" ")):(e.setLatestPostion(m.endX,m.endY),["A",this.xUnitTransformAndPathScale(m.radiusX),this.yUnitTransformAndPathScale(m.radiusY),m.xAxisRotation,m.largeArcFlag,m.sweepFlag,this.xUnitTransformAndPathScale(m.endX),this.yUnitTransformAndPathScale(m.endY)].join(" "))}case"".concat(this.namespace,"cubicBezTo"):return e.setLatestPostion(o,a),["C",this.xUnitTransformAndPathScale(i),this.yUnitTransformAndPathScale(r),this.xUnitTransformAndPathScale(n),this.yUnitTransformAndPathScale(s),this.xUnitTransformAndPathScale(o),this.yUnitTransformAndPathScale(a)].join(" ");case"".concat(this.namespace,"quadBezTo"):return e.setLatestPostion(t[1].x,t[1].y),["Q",this.xUnitTransformAndPathScale(i),this.yUnitTransformAndPathScale(r),this.xUnitTransformAndPathScale(n),this.yUnitTransformAndPathScale(s)].join(" ");case"".concat(this.namespace,"close"):return e.setLatestPostion(e.getStartPostion().x,e.getStartPostion().y),"Z";default:throw new Error("unknow ".concat(this.actionXML.name));}}},{key:"getPtValue",value:function getPtValue(e,t,i){return t.accessValue(e[i])}},{key:"getSvgArc",value:function getSvgArc(e,t,i,r,n,s){var o=e,a=t,l,h,d,u,p;if(r===0)l=n,h=s,p=0;else if(r>=360)l=n,h=s,d=n+2*e*Math.abs(Math.cos(-i/180*Math.PI)),u=s+2*t*Math.sin(-i/180*Math.PI),p=1;else{var f=-i,m=-(i+r),_this$getCoordinateOn=this.getCoordinateOnEllipse(f,o,a),g=_this$getCoordinateOn.x,y=_this$getCoordinateOn.y,b=n-g,v=s+y,_this$getCoordinateOn2=this.getCoordinateOnEllipse(m,o,a),w=_this$getCoordinateOn2.x,M=_this$getCoordinateOn2.y;l=w+b,h=v-M,r>=-360&&r<-180?p=1:r>=-180&&r<0||r>0&&r<180?p=0:p=1}return{radiusX:o,radiusY:a,xAxisRotation:0,largeArcFlag:p,sweepFlag:r>0?1:0,endX:l,endY:h,middleX:d,middleY:u}}},{key:"getCoordinateOnEllipse",value:function getCoordinateOnEllipse(e,t,i){var r,n,s=e%360;if(s%180==0)r=Math.cos(s*(Math.PI/180))*t,n=0;else if(s%90==0)r=0,n=Math.sin(s*(Math.PI/180))*i;else{var o=this.getTanDeg(s);r=t*i/Math.sqrt(Math.pow(i,2)+Math.pow(t*o,2)),(s>90&&s<270||s<-90&&s>-270)&&(r=-r),n=o*r}return{x:r,y:n}}},{key:"getTanDeg",value:function getTanDeg(e){var t=e*Math.PI/180;return Math.tan(t)}}]);return A2}();function Ul(e){return jo.presetShapeDefinitons.childElementOptional(e)||(console.warn("".concat(e," not include preset shape.")),jo.presetShapeDefinitons.childElement("rect"))}var Ps;(function(e){e[e.none=0]="none",e[e.triangle=1]="triangle",e[e.stealth=2]="stealth",e[e.diamond=3]="diamond",e[e.oval=4]="oval",e[e.arrow=5]="arrow"})(Ps||(Ps={}));function eS(e){switch(e){case"none":return 0;case"triangle":return 1;case"stealth":return 2;case"diamond":return 3;case"oval":return 4;case"arrow":return 5;default:return 0;}}var tS=10*1e3,Cn=/*#__PURE__*/function(){function Cn(e){_classCallCheck(this,Cn);this.logger=e}_createClass(Cn,[{key:"createMonitor",value:function createMonitor(){return new O2(this.logger).ref}}]);return Cn}(),O2=/*#__PURE__*/function(){function O2(e){var _this209=this;_classCallCheck(this,O2);this.logger=e,this.image=null,this.timer=null,this.beginTimestamp=0,this.ref=function(t){t?_this209.bindImage(t):_this209.releaseImage()},this.onLoad=function(){_this209.beginTimestamp!==0&&(_this209.beginTimestamp=0,_this209.clearTimer())},this.onError=function(t){var i;if(_this209.beginTimestamp!==0){_this209.beginTimestamp=0,_this209.clearTimer();var _r128;typeof t=="string"?_r128=new Error(t):_r128=new Error("".concat(t.message)),(i=_this209.logger)==null||i.error("loading image ".concat(_this209.getImageUrl()," with error: ").concat(_r128))}},this.onTimeout=function(){var t;_this209.beginTimestamp=0,(t=_this209.logger)==null||t.warn("loading image ".concat(_this209.getImageUrl()," timeout for ").concat(tS,"ms"))},this.getImageUrl=function(){var t,i;var r;return _this209.image&&_this209.image instanceof SVGImageElement?r=(t=_this209.image)==null?void 0:t.href.animVal:r=(i=_this209.image)==null?void 0:i.src,r}}_createClass(O2,[{key:"bindImage",value:function bindImage(e){e.onload=this.onLoad,e.onerror=this.onError,this.image=e,this.timer=setTimeout(this.onTimeout,tS),this.beginTimestamp=Date.now()}},{key:"releaseImage",value:function releaseImage(){this.image&&(this.image.onload=null,this.image.onerror=null,this.image=null,this.beginTimestamp=0,this.clearTimer())}},{key:"clearTimer",value:function clearTimer(){this.timer!==null&&clearTimeout(this.timer)}}]);return O2}(),R2="other",zo="body";function N2(e){switch(e){case"title":case"ctrTitle":return!0;default:return!1;}}function Wr(e,t,i){var r=L2(e),n=!0;if(i==="master"){var s=Vl(e);if(!s)return n=!1,{allShape:[e],masterStyleXML:Du(t),isTextBox:r,hasPlaceHolder:n};var o=s.type||zo,a=Wl(o,t,r);return{placeHolderType:o,masterShape:e,masterStyleXML:a,allShape:[e],isTextBox:r,hasPlaceHolder:n}}else if(i==="layout"){var _s33=Vl(e);if(!_s33)return n=!1,{allShape:[e],masterStyleXML:Du(t),isTextBox:r,hasPlaceHolder:n};var _o26=_s33.type||zo,_a23=Bu(_o26),l=t.masterIndex.typeIndex[_a23],h=[e];l&&h.push(l);var d=Wl(_a23,t,r);return{allShape:h,placeHolderType:_a23,layoutShape:e,masterShape:l,masterStyleXML:d,isTextBox:r,hasPlaceHolder:n}}else{var _s34=Vl(e);if(!_s34)return n=!1,{allShape:[e],masterStyleXML:Du(t),isTextBox:r,hasPlaceHolder:n};D2(_s34)&&(_s34.idx="1");var _o27;if(_s34.idx?(_o27=t.layoutIndex.idxIndex[_s34.idx],_s34.type&&_o27===void 0&&(_o27=t.layoutIndex.typeIndex[_s34.type])):_s34.type&&(_o27=t.layoutIndex.typeIndex[_s34.type]),_o27){var _a24=Vl(_o27);if(_a24){var _l8=_a24.type||zo,_h10=Bu(_l8),_d8=t.masterIndex.typeIndex[_h10],u=[e];_o27&&u.push(_o27),_d8&&u.push(_d8);var p=Wl(_h10,t,r);return{allShape:u,placeHolderType:_h10,layoutShape:_o27,masterShape:_d8,masterStyleXML:p,isTextBox:r,hasPlaceHolder:n}}else throw new Error("layout ph not existed.")}else{var _a25=_s34.type||zo,_l9=Bu(_a25),_h11=t.masterIndex.typeIndex[_l9],_d9=[e];_h11&&_d9.push(_h11);var _u16=Wl(_l9,t,r);return{allShape:_d9,placeHolderType:_l9,layoutShape:e,masterShape:_h11,masterStyleXML:_u16,isTextBox:r,hasPlaceHolder:n}}}}function L2(e){var t=!1,i=e.childElementOptional("p:nvSpPr");return i&&i.childElement("p:cNvSpPr").attr.getBooleanOptional("txBox")&&(t=!0),t}function D2(e){return e!==void 0&&e.idx!==void 0&&e.idx==="4294967295"}function Vl(e){if(e){var t=e.childElementOptional(new Y("p:nvSpPr","p:nvCxnSpPr"));if(t){var i=t.childElementOptional("p:nvPr","p:ph");if(i){var _r129=i.attr.getStringOptional("idx"),n=i.attr.getStringOptional("type");return(n==="title"||n==="ctrTitle")&&(_r129=_r129||"0"),{idx:_r129,type:n}}}}}function Wl(e,t,i){if(!t.masterIndex.txStyle)return;var r=t.masterIndex.txStyle[e];return r||(i?r=t.masterIndex.txStyle[zo]:r=t.masterIndex.txStyle[R2]),r}function Du(e){return e.main.childElementOptional("p:presentation","p:defaultTextStyle")}function Bu(e){switch(e){case"ctrTitle":case"title":return"title";case"dt":return"dt";case"ftr":return"ftr";case"sldNum":return"sldNum";default:return"body";}}var Is=12700/2;function B2(e){e.bindChildPicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"a:prstGeom",iS),e.bindChildPicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"a:custGeom",iS),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"fillColor",U2),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderWidth",rS),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderType",nS),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderColor",V2),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderStrokeDashArray",W2),e.bindAttributePicker("p:sp","spId",function(t,i,r,n,s){return Hr(s)+t.childElement("p:nvSpPr","p:cNvPr").attr.getOptional("id")}),e.bindAttributePicker("p:cxnSp","spId",function(t,i,r,n,s){return Hr(s)+t.childElement("p:nvCxnSpPr","p:cNvPr").attr.getOptional("id")}),e.bindAttributePicker("p:pic","spId",function(t,i,r,n,s){return Hr(s)+t.childElement("p:nvPicPr","p:cNvPr").attr.getOptional("id")}),e.bindAttributePicker("p:grpSp","spId",function(t,i,r,n,s){return Hr(s)+t.childElement("p:nvGrpSpPr","p:cNvPr").attr.getOptional("id")}),e.bindAttributePicker("p:spTree","spId",function(t,i,r,n,s){return Hr(s)+t.childElement("p:nvGrpSpPr","p:cNvPr").attr.getOptional("id")}),e.bindAttributePicker("p:graphicFrame","spId",function(t,i,r,n,s){return Hr(s)+t.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getOptional("id")}),e.bindAttributePicker("p:graphicFrame","borderWidth",function(){return 0}),e.bindAttributePicker("p:graphicFrame","borderType",function(){return"none"}),e.bindAttributePicker("p:graphicFrame","borderColor",function(){return"black"}),e.bindAttributePicker("p:graphicFrame","borderStrokeDashArray",function(){return"0"})}function Hr(e){var t="";return e==="master"?t="m":e==="layout"&&(t="l"),t}function Fu(e,t,i,r){var n=i.lnStyleXMLDescription;return n||(n=i.lnStyleXMLDescription=Object.freeze(j2(e,t,r))),n}function F2(e,t,i,r){var n=i.fillStyleXMLDescription;return n||(n=i.fillStyleXMLDescription=Object.freeze(z2(e,t,r))),n}function j2(e,t,i){var r=[],n,_Wr=Wr(e,t,i),s=_Wr.allShape,o=_Wr.placeHolderType;var _iterator193=_createForOfIteratorHelper(s),_step193;try{for(_iterator193.s();!(_step193=_iterator193.n()).done;){var a=_step193.value;var l=a.childElementOptional(new Y("p:spPr","p:grpSpPr"));if(l){var d=l.childElementOptional("a:ln");d&&r.push(d)}var h=a.childElementOptional("p:style");if(h){var _d10=Mu(h,t);_d10.ln.xml&&r.push(_d10.ln.xml),n=_d10.ln.phClr}}}catch(err){_iterator193.e(err)}finally{_iterator193.f()}return{shapeStyleXMLList:r,placeHolderType:o,placeHolderColor:n}}function z2(e,t,i){var r=[],n,_Wr2=Wr(e,t,i),s=_Wr2.allShape,o=_Wr2.placeHolderType;var _iterator194=_createForOfIteratorHelper(s),_step194;try{for(_iterator194.s();!(_step194=_iterator194.n()).done;){var a=_step194.value;var l=a.childElementOptional(new Y("p:spPr","p:grpSpPr"),_construct(Y,Ss));l&&r.push(l);var h=a.childElementOptional("p:style");if(h){var d=Mu(h,t);d.fill.xml&&r.push(d.fill.xml),n=d.fill.phClr}}}catch(err){_iterator194.e(err)}finally{_iterator194.f()}return{shapeStyleXMLList:r,placeHolderType:o,placeHolderColor:n}}var iS=function iS(e,t,i,r,n){var _Wr3=Wr(e,t,n),s=_Wr3.allShape;var _iterator195=_createForOfIteratorHelper(s),_step195;try{for(_iterator195.s();!(_step195=_iterator195.n()).done;){var o=_step195.value;var a=o.childElementOptional("p:spPr",i);if(a)return a}}catch(err){_iterator195.e(err)}finally{_iterator195.f()}},U2=function U2(e,t,i,r,n){if(e.attr.getBoolean("useBgFill",!1)){var o=e.parentElement("p:cSld");if(o){var a=o.extraAttr.getColorOptional("backgroundColor");if(a)return a}}var s=F2(e,t,r,n);var _iterator196=_createForOfIteratorHelper(s.shapeStyleXMLList),_step196;try{for(_iterator196.s();!(_step196=_iterator196.n()).done;){var _o28=_step196.value;return new zr(s.placeHolderColor).read(_o28,t)||void 0}}catch(err){_iterator196.e(err)}finally{_iterator196.f()}},V2=function V2(e,t,i,r,n){var s=Fu(e,t,r,n);var _iterator197=_createForOfIteratorHelper(s.shapeStyleXMLList),_step197;try{for(_iterator197.s();!(_step197=_iterator197.n()).done;){var o=_step197.value;var a=o.childElementOptional(_construct(Y,Ss));if(a){var l=new zr(s.placeHolderColor).read(a,t);if(l)return l}}}catch(err){_iterator197.e(err)}finally{_iterator197.f()}return cr},rS=function rS(e,t,i,r,n){var s=Fu(e,t,r,n);var _iterator198=_createForOfIteratorHelper(s.shapeStyleXMLList),_step198;try{for(_iterator198.s();!(_step198=_iterator198.n()).done;){var o=_step198.value;if(o&&o.attr.has("w")){var a=o.attr.getNumber("w");return a>Is?a:Is}}}catch(err){_iterator198.e(err)}finally{_iterator198.f()}return Is},nS=function nS(e,t,i,r,n){var s=Fu(e,t,r,n);var _iterator199=_createForOfIteratorHelper(s.shapeStyleXMLList),_step199;try{for(_iterator199.s();!(_step199=_iterator199.n()).done;){var o=_step199.value;var a=o.childElementOptional("a:prstDash");if(a&&a.attr.has("val"))return a.attr.getString("val")}}catch(err){_iterator199.e(err)}finally{_iterator199.f()}return"solid"},W2=function W2(e,t,i,r,n){var s=rS(e,t,i,r,n)/yn;switch(nS(e,t,i,r,n)){case"solid":return"0";case"dash":return"".concat(5*s);case"dashDot":return" ".concat(5*s,", ").concat(5*s,", ").concat(s,", ").concat(5*s);case"dot":return"".concat(s,",  ").concat(5*s);case"lgDash":return"".concat(2*s,", ").concat(s);case"lgDashDot":return"".concat(10*s,", ").concat(5*s,", ").concat(s,", ").concat(5*s,", ").concat(s,", ").concat(5*s);case"sysDash":return"".concat(5*s,", ").concat(2*s);case"sysDashDot":return"".concat(5*s,", ").concat(2*s,", ").concat(s,", ").concat(5*s);case"sysDashDotDot":return"".concat(5*s,", ").concat(2*s,", ").concat(s,", ").concat(5*s,", ").concat(s,", ").concat(5*s);case"sysDot":return"".concat(2*s,", ").concat(5*s);default:return"0";}},sS=/*#__PURE__*/function(_ju$default$Component){_inherits(sS,_ju$default$Component);var _super64=_createSuper(sS);function sS(e){var _this210;_classCallCheck(this,sS);_this210=_super64.call(this,e);_this210.isRender=!1,_this210.state={dataUrl:""};var t=e.xlinkHref||e.href;t&&ji.addLoadTask(t);return _this210}_createClass(sS,[{key:"componentDidMount",value:function componentDidMount(){this.isRender=!0,this.loadImage()}},{key:"getSnapshotBeforeUpdate",value:function getSnapshotBeforeUpdate(e){var _this$props30=this.props,t=_this$props30.xlinkHref,i=_this$props30.href,r=e.xlinkHref||e.href,n=t||i;return r!==n&&n?(ji.addLoadTask(n),!0):!1}},{key:"componentDidUpdate",value:function componentDidUpdate(e,t,i){i&&this.loadImage()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.isRender=!1}},{key:"updateImageState",value:function updateImageState(e,t){this.isRender&&this.setState({dataUrl:e},t)}},{key:"loadImage",value:function loadImage(){var _this211=this;var _this$props31=this.props,e=_this$props31.xlinkHref,t=_this$props31.href,i=e||t;i&&ji.loadImage(i).then(function(r){_this211.updateImageState(r,function(){ji.endLoadTask(i)})}).then(function(){},function(){})}},{key:"render",value:function render(){var e=this.state.dataUrl,_this$props32=this.props,t=_this$props32.innerref,i=_this$props32.vertTextType,r=_this$props32.width,n=_this$props32.height,s=_this$props32.x,o=_this$props32.y,a=_this$props32.opacity,l=_this$props32.clipPath,h=_this$props32.preserveAspectRatio;if(e){var d={};i&&(d.transform="scale(".concat(r/n,", ").concat(n/r,") rotate(270deg)"),d.transformOrigin="center");var u={xlinkHref:e,href:e,width:E(r),height:E(n),opacity:a,clipPath:l,preserveAspectRatio:h,x:s,y:o};return ju["default"].createElement("image",F(A({},u),{style:d,ref:t}))}return null}}]);return sS}(ju["default"].Component),H2=/*#__PURE__*/function(_G$default$Component){_inherits(H2,_G$default$Component);var _super65=_createSuper(H2);function H2(e){var _this212;_classCallCheck(this,H2);_this212=_super65.call(this,e);_this212.pathElements={},_this212.imageElement=G["default"].createRef();var t=e.shapeXML;_this212.spId=e.spId,_this212.graphType=e.shapeXML.name==="p:sp"?"shape":"connection",_this212.prestGeomXML=t.extraElementWithName("a:prstGeom"),_this212.custGeomXML=t.extraElementWithName("a:custGeom"),_this212.svgLoadingMonitor=new Cn(e.logger).createMonitor();return _this212}_createClass(H2,[{key:"getCssVaribleColor",value:function getCssVaribleColor(e){switch(e){case Zt.Darken:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*0.6),var(--sp-fill-a))";case Zt.DarkenLess:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*0.8),var(--sp-fill-a))";case Zt.Lighten:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*1.4),var(--sp-fill-a))";case Zt.LightenLess:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*1.2),var(--sp-fill-a))";default:return"hsla(var(--sp-fill-h),var(--sp-fill-s),var(--sp-fill-l),var(--sp-fill-a))";}}},{key:"updateFillColor",value:function updateFillColor(e){var _this213=this;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;var i,r=[],n=0,s,o;if(e instanceof Fo)r=e.getColors(),n=e.getRotation(),s=e.getGradientPath(),i="url(#".concat(this.identification(),"-gradient-fill)");else if(e instanceof Fl)o=e.getResId();else if(e instanceof Bl){var a=this.props.groupFillColor;i=X(a)}else i=X(e);if(t&&(Object.keys(this.pathElements).forEach(function(a){var l=_this213.pathElements[a];l&&i&&(o!==void 0?l.setAttribute("fill","none"):l.setAttribute("fill",i))}),this.imageElement.current&&e)){var _a26=e.getAlphaModFix();this.imageElement.current.setAttribute("opacity",_a26.toString())}return{path:s,imageResId:o,colorStops:r,rotation:n,fillColor:i}}},{key:"identification",value:function identification(){var _this$props33=this.props,e=_this$props33.slideIndex,t=_this$props33.spId;return"".concat(e,"-").concat(t,"-")}},{key:"injectAdjustValue",value:function injectAdjustValue(e,t){var i=e.childElementOptional("a:avLst");i&&i.elementsWithName("a:gd").forEach(function(r){var n=r.attr.getString("fmla"),s=new Z(n).eval(t),o=r.attr.getString("name");t.setVariable(o,s)})}},{key:"renderSVG",value:function renderSVG(e,t,i,r){var n;var s=null,o=null,_this$props34=this.props,a=_this$props34.shapeXML,l=_this$props34.width,h=_this$props34.height,d=_this$props34.fillColor,u=_this$props34.resourceLoader,p=_this$props34.resourceType,f=_this$props34.borderStyle,m=_this$props34.vertTextType,g=(n=a.childElementOptional("p:nvSpPr","p:cNvSpPr"))==null?void 0:n.attr.getBooleanOptional("txBox"),y=a.childElementOptional("p:spPr","a:blipFill","a:stretch","a:fillRect"),b=(y?y.attr.getNumber("l",0)/K:0)*l,v=(y?y.attr.getNumber("b",0)/K:0)*h,w=(y?y.attr.getNumber("r",0)/K:0)*l,M=(y?y.attr.getNumber("t",0)/K:0)*h;if(r){var R=d.getAlphaModFix();g||(s=G["default"].createElement("clipPath",{id:"clippath-".concat(this.identification())},e));var W=u.loadURL(p,r);o=G["default"].createElement(sS,{innerref:this.imageElement,xlinkHref:W,vertTextType:m,href:W,width:l-w-b,height:h-v-M,x:E(b),y:E(M),opacity:R,clipPath:"url(#clippath-".concat(this.identification(),")"),preserveAspectRatio:"none"})}var x=this.graphType==="connection"&&f.color||this.graphType==="shape",T,O;return ys(h)/Nt<1?T="1px":T=E(h),ys(l)/Nt<1?O="1px":O=E(l),x?G["default"].createElement("svg",{style:{position:"absolute",width:O,height:T,overflow:"visible"}},G["default"].createElement("defs",null,s,t,G["default"].createElement("marker",{id:"".concat(this.identification(),"-arrow-end"),viewBox:"0 0 10 10",refX:"10",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i*1.5,markerHeight:i*1.5,stroke:X(f.color),fill:X(f.color),orient:"auto"},G["default"].createElement("path",{d:"M 1 0 L 10 5 L 1 10 L 0 9 L 7.18 5 L 0 1 Z",fill:X(f.color)})),G["default"].createElement("marker",{id:"".concat(this.identification(),"-arrow-start"),viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i*1.5,markerHeight:i*1.5,stroke:X(f.color),fill:X(f.color),orient:"auto"},G["default"].createElement("path",{d:"M 9 0 L 0 5 L 9 10 L 10 9 L 2.82 5 L 10 1 L 9 0 Z",fill:X(f.color)})),G["default"].createElement("marker",{id:"".concat(this.identification(),"-triangle-end"),viewBox:"0 0 10 10",refX:"10",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i,markerHeight:i,orient:"auto"},G["default"].createElement("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:X(f.color)})),G["default"].createElement("marker",{id:"".concat(this.identification(),"-triangle-start"),viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i,markerHeight:i,orient:"auto"},G["default"].createElement("path",{d:"M 10 0 L 0 5 L 10 10 z",fill:X(f.color)})),G["default"].createElement("marker",{id:"".concat(this.identification(),"-stealth-end"),viewBox:"0 0 10 10",refX:"10",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i,markerHeight:i,orient:"auto"},G["default"].createElement("path",{d:"M 0 0 L 10 5 L 0 10 L 3 5 z",fill:X(f.color)})),G["default"].createElement("marker",{id:"".concat(this.identification(),"-stealth-start"),viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i,markerHeight:i,orient:"auto"},G["default"].createElement("path",{d:"M 10 0 L 0 5 L 10 10 L 7 5 z",fill:X(f.color)})),G["default"].createElement("marker",{id:"".concat(this.identification(),"-diamond-end"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i,markerHeight:i,orient:"auto"},G["default"].createElement("path",{d:"M 5 0 L 10 5 L 5 10 L 0 5 z",fill:X(f.color)})),G["default"].createElement("marker",{id:"".concat(this.identification(),"-diamond-start"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i,markerHeight:i,orient:"auto"},G["default"].createElement("path",{d:"M 5 0 L 10 5 L 5 10 L 0 5 z",fill:X(f.color)})),G["default"].createElement("marker",{id:"".concat(this.identification(),"-oval-end"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i,markerHeight:i,orient:"auto"},G["default"].createElement("ellipse",{cx:"5",cy:"5",rx:"5",ry:"5",fill:X(f.color)})),G["default"].createElement("marker",{id:"".concat(this.identification(),"-oval-start"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i,markerHeight:i,orient:"auto"},G["default"].createElement("ellipse",{cx:"5",cy:"5",rx:"5",ry:"5",fill:X(f.color)})),G["default"].createElement("marker",{id:"".concat(this.identification(),"-none")})),o,e):null}},{key:"render",value:function render(){var _this214=this;var e,t;this.pathElements={};var i,_this$props35=this.props,r=_this$props35.width,n=_this$props35.height,s=_this$props35.shapeXML,o=_this$props35.fillColor,a=_this$props35.borderStyle,l=_this$props35.children,h=new Zv({w:r,h:n}),d="";if(this.prestGeomXML){var z=this.prestGeomXML.attr.getString("prst");this.injectAdjustValue(this.prestGeomXML,h),i=Ul(z)}else this.custGeomXML?(i=this.custGeomXML,d="a:"):i=Ul("rect");var u=Ps.none,p=Ps.none,f=s.childElementOptional("p:spPr","a:ln","a:headEnd"),m=s.childElementOptional("p:spPr","a:ln","a:tailEnd"),g=((e=f==null?void 0:f.parent)==null?void 0:e.attr.getNumber("w",Is))||((t=m==null?void 0:m.parent)==null?void 0:t.attr.getNumber("w",Is))||Is,y=Math.max(3*(g/Nt),10);if(f){var _z=f.attr.getString("type","none");u=eS(_z)}if(m){var _z2=m.attr.getString("type","none");p=eS(_z2)}var _this$updateFillColor=this.updateFillColor(o,!1),b=_this$updateFillColor.fillColor,v=_this$updateFillColor.colorStops,w=_this$updateFillColor.imageResId,M=_this$updateFillColor.path,x=null;v.length>0&&(M?x=G["default"].createElement("radialGradient",{id:"".concat(this.identification(),"-gradient-fill")},v.map(function(z,Re){return G["default"].createElement("stop",{key:"index-".concat(Re),offset:z.stop,stopColor:X(z.color)})})):x=G["default"].createElement("linearGradient",{id:"".concat(this.identification(),"-gradient-fill")},v.map(function(z,Re){return G["default"].createElement("stop",{key:"index-".concat(Re),offset:z.stop,stopColor:X(z.color)})})));var T=new Jv().renderLumiaPath(i,h,d).map(function(z,Re){var Ht=z.fill!=="none"?b:"none",Ne=z.isBorder?X(a.color):"none";v.length===0&&(b&&z.fill&&(Ht=jv(b,z.fill)),!s.childElementOptional("p:spPr","a:ln","a:solidFill")&&b!=="none"&&(Ne=jv(Ne,Zt.Darken)));var St={};return z.fill!=="none"&&v.length===0&&(St.fill=_this214.getCssVaribleColor(z.fill)),G["default"].createElement("path",{ref:function ref(Je){_this214.pathElements[Re.toString()]=Je},key:"path".concat(Re),d:z.pathD,style:St,fill:w?"none":Ht,height:E(n),width:E(r),stroke:Ne,strokeWidth:E(a.width),strokeDasharray:a.strokeDashArray,markerStart:"url(#".concat(_this214.identification(),"-").concat(Ps[u],"-start)"),markerEnd:"url(#".concat(_this214.identification(),"-").concat(Ps[p],"-end)")})}),O=h.accessValue("rectLeft"),R=h.accessValue("rectTop"),W=h.accessValue("rectRight")-h.accessValue("rectLeft"),J=h.accessValue("rectBottom")-h.accessValue("rectTop"),ee=G["default"].Children.map(l,function(z){return G["default"].cloneElement(z,{left:O,right:R,width:W,height:J})});return G["default"].createElement(G["default"].Fragment,null,ee,this.renderSVG(T,x,y,w))}}]);return H2}(G["default"].Component),_2=["textPlain"],zu;(function(e){e.textNoShape="textNoShape",e.textPlain="textPlain",e.textRingInside="textRingInside",e.textRingOutside="textRingOutside"})(zu||(zu={}));var K2=/*#__PURE__*/function(_Ge$default$Component){_inherits(K2,_Ge$default$Component);var _super66=_createSuper(K2);function K2(e){var _this215;_classCallCheck(this,K2);_this215=_super66.call(this,e);_this215.contentWidth=0,_this215.fontRowCount=0;var t;var i=e.textBodyWrapResource;_this215.gbDataList=e.shapeGuideList.map(function(n){var s=n.attr.getString("name"),o=n.attr.getString("fmla");return _defineProperty({},s,o)}),_this215.textContent=(t=e.textBodyWrapResource.paragraphs[0].runs)==null?void 0:t.map(function(n){return n.text}).join(""),_this215.height=Cu(i.prop.height),_this215.width=Cu(i.prop.width);var r=0;i.paragraphs.forEach(function(n){_this215.fontRowCount+=n.lines.length,n.lines.forEach(function(s){var o=0;s.forEach(function(a){o+=parseInt(a.prop.width,10),r||(r=a.prop.lineSpacing),_this215.fontSize||(_this215.fontSize=Cu(a.prop.size))}),_this215.contentWidth=Math.max(_this215.contentWidth,o)})}),_this215.contentHeight=bs((_this215.fontRowCount-1)*r+_this215.fontSize||_this215.fontSize);return _this215}_createClass(K2,[{key:"textNoShape",value:function textNoShape(){var _this216=this;var e={display:"flex",fontSize:"".concat(this.fontSize,"pt"),transformOrigin:"50%, 0",height:"".concat(this.height,"pt"),width:"".concat(this.width,"pt"),justifyContent:"center",alignItems:"center"},t=this.height,i=this.width,r=this.contentWidth,n=this.contentHeight,s=Number.isNaN(i/r)?1:bs(i/r),o=Number.isNaN(t/n)?1:bs(t/n),a={margin:0,padding:0,fontSize:"".concat(this.fontSize,"pt"),lineHeight:"".concat(this.fontSize,"pt"),height:"".concat(this.fontSize,"pt"),width:"".concat(this.fontSize,"pt"),display:"inline-block"},l=this.props.textBodyWrapResource;return Ge["default"].createElement("div",{style:e},Ge["default"].createElement("div",{ref:function ref(h){_this216.spanRef=h},style:{whiteSpace:"initial",transform:"scaleX(".concat(s,") scaleY(").concat(o,")")}},l.paragraphs.map(function(h,d){var u;return Ge["default"].createElement("span",{key:d,style:{whiteSpace:"initial"}},(u=h.lines)==null?void 0:u.map(function(p,f){return Ge["default"].createElement(Ge["default"].Fragment,null,p.map(function(m){var g;return(g=m.text)==null?void 0:g.split("").map(function(y,b){return Ge["default"].createElement("pre",{style:a,key:"".concat(f,"-").concat(b)},y)})}),Ge["default"].createElement("br",null))}))})))}},{key:"textRing",value:function textRing(e){var _this217=this;var t,i,r;var n=Math.atan(this.height/this.width),s=n*180/Math.PI,o=6e4;((t=this.gbDataList[0])==null?void 0:t.adj)&&(o=Z.deconstructShapeGuide(this.gbDataList[0].adj));var a=200,l=100,h=(1-Te(o)*l)/this.fontSize;if(!((i=this.textContent)==null?void 0:i.length))return this.textNoShape();var d=this.textContent.length;return Ge["default"].createElement("div",{style:{display:"inline-block",position:"relative",fontSize:"".concat(this.fontSize,"pt"),transformOrigin:"50%, 0",height:"".concat(l,"pt"),width:"".concat(a,"pt"),transform:"scale(".concat(this.width/a,", ").concat(this.height/l/(Math.cos(n/180)*Math.PI),")")}},Ge["default"].createElement("div",{style:{transformStyle:"preserve-3d",height:"".concat(l,"pt"),width:"".concat(a,"pt"),transform:"rotateX(".concat(-s,"deg)")}},(r=this.textContent)==null?void 0:r.split("").map(function(u,p){return Ge["default"].createElement("span",{style:{position:"absolute",lineHeight:"".concat(_this217.fontSize,"pt"),left:"".concat(a/2-_this217.fontSize/2,"pt"),top:"".concat((l-_this217.fontSize)/2,"pt"),transform:e(p,d,h)},key:p},u)})))}},{key:"textRingInside",value:function textRingInside(){var e=function e(t,i,r){return"rotateY(".concat(70-340/i*t,"deg) translateZ(").concat(-100,"pt) scaleY(").concat(r,")")};return this.textRing(e)}},{key:"textRingOutside",value:function textRingOutside(){var e=function e(t,i,r){return"rotateY(".concat(320*t/(i-1)-60,"deg) translateZ(",100,"pt) scaleY(").concat(r,")")};return this.textRing(e)}},{key:"textPlain",value:function textPlain(){var _this218=this;var e=this.gbDataList[0]?Z.deconstructShapeGuide(this.gbDataList[0].adj):5e4,t=this.width,i=this.height,r=Te(e),n=r>.5?(2*r-1)*t:(1-r*2)*t,s=Math.atan(n/i),o=s*180/Math.PI;r<.5&&(o=-o);var a={display:"flex",fontSize:"".concat(this.fontSize,"pt"),transformOrigin:"0, 0",height:"".concat(i,"pt"),width:"".concat(t,"pt"),justifyContent:"center",alignItems:"center"},l={display:"block",lineHeight:"".concat(this.fontSize,"pt"),textAlign:"center"},h={display:"inline-block",fontSize:"".concat(this.fontSize,"pt"),lineHeight:"".concat(this.fontSize,"pt"),height:"".concat(this.fontSize,"pt"),transformOrigin:"50% 0",margin:0,padding:"0"},d=this.contentWidth,u=this.contentHeight,p=Number.isNaN(t/d)?1:bs(t)/(d+Math.tan(s)*bs(i)),f=Number.isNaN(i/u)?1:bs(i/u),m=0,g=this.props.textBodyWrapResource;return Ge["default"].createElement("div",{style:A({},a)},Ge["default"].createElement("div",{ref:function ref(y){_this218.spanRef=y},style:F(A({},l),{whiteSpace:"initial",transform:"skew(".concat(o,"deg) scaleY(").concat(f,") scaleX(").concat(p,")")})},g.paragraphs.map(function(y,b){var v;return Ge["default"].createElement("div",{key:"wordart-".concat(b),style:F(A({},l),{whiteSpace:"initial"})},(v=y.lines)==null?void 0:v.map(function(w,M){var x=_this218.fontRowCount===1?_this218.fontSize:w[0].prop.lineSpacing,T={};return(m===0||m===_this218.fontRowCount-1)&&(x=(x+_this218.fontSize)/2,T.display="flex",m===_this218.fontRowCount-1&&(T.alignItems="flex-end")),y.prop.align==="l"||y.prop.align==="just"?T.justifyContent="flex-start":y.prop.align==="r"?T.justifyContent="flex-end":y.prop.align==="dist"?T.justifyContent="space-between":y.prop.align==="ctr"&&(T.justifyContent="center"),m+=1,Ge["default"].createElement("div",{key:w[0].text+M.toString(),style:A({whiteSpace:"nowrap",lineHeight:"".concat(x,"pt")},T)},w.map(function(O){var R;return(R=O.text)==null?void 0:R.split("").map(function(W,J){return Ge["default"].createElement("pre",{style:F(A({},h),{fontFamily:O.prop.font}),key:J},W)})}),Ge["default"].createElement("br",null))}))})))}},{key:"render",value:function render(){var e=this.props.presetType;return this[e]?this[e]():this.textNoShape()}}]);return K2}(Ge["default"].Component),G2=9999,$2=/*#__PURE__*/function(){function $2(){_classCallCheck(this,$2);this.indexByLevel=new Map,this.startAtByLevel=new Map}_createClass($2,[{key:"get",value:function get(e,t,i){var r=e.extraAttr.getNumber("level");this.indexByLevel.has(r)||(this.indexByLevel.set(r,0),this.startAtByLevel.set(r,-1));var n=this.startAtByLevel.get(r);if(t!==n)this.indexByLevel.set(r,0),this.startAtByLevel.set(r,t);else{var s=this.indexByLevel.get(r);i&&(s+=1,this.indexByLevel.set(r,s))}return this.indexByLevel.get(r)}},{key:"reset",value:function reset(){this.indexByLevel=new Map,this.startAtByLevel=new Map}}]);return $2}(),oS=/*#__PURE__*/function(_wn$default$Component){_inherits(oS,_wn$default$Component);var _super67=_createSuper(oS);function oS(e){var _this219;_classCallCheck(this,oS);_this219=_super67.call(this,e);_this219.buIndexCounter=new $2,_this219.paragraphBulletInfo=[],_this219.numCol=1;var _this219$props=_this219.props,t=_this219$props.txBodyXML,i=_this219$props.textBodyWrapResource,r=_this219$props.flipH,n=_this219$props.flipV,s=_this219$props.insideTable,o=_this219$props.totalPadding,a=_this219$props.height,l=_this219$props.width,h=_this219$props.right,d=_this219$props.left;_this219.bodyPrXML=t.childElement("a:bodyPr"),_this219.paragraphXMLs=t.elementsWithName("a:p");var u=_this219.bodyPrXML.childElementOptional("a:prstTxWarp");u&&(_this219.presetType=u.attr.getString("prst","textNoShape"));var p=_this219.bodyPrXML.extraAttr.getString("anchor","t"),f=_this219.bodyPrXML.extraAttr.getString("wrap","square");_this219.isTextWrap=f==="square",_this219.spcFirstLastPara=_this219.bodyPrXML.extraAttr.getBoolean("spcFirstLastPara",!1),_this219.anchorCtr=_this219.bodyPrXML.extraAttr.getBoolean("anchorCtr",!1),_this219.numCol=_this219.bodyPrXML.extraAttr.getNumber("numCol",1);var m=0,g=0;if(i){var b=i.prop;_this219.vert=b.vert,_this219.paddingLeft=b.lIns*Nt,_this219.paddingRight=b.rIns*Nt,m=b.tIns*Nt,g=b.bIns*Nt}else _this219.vert=$v(t),_this219.paddingLeft=_this219.bodyPrXML.extraAttr.getNumber("lIns",Iv),_this219.paddingRight=_this219.bodyPrXML.extraAttr.getNumber("rIns",Iv),m=_this219.bodyPrXML.extraAttr.getNumber("tIns",Pv),g=_this219.bodyPrXML.extraAttr.getNumber("bIns",Pv);var y;r!==n&&(y="scale(-1, 1)"),_this219.rectStyle=s?{position:"relative",left:0,top:0,width:E(l),paddingTop:E(m-o/2),paddingBottom:E(g-o/2),height:"calc(100% - ".concat(E(o),")"),transform:y}:{position:"absolute",left:E(d===void 0?0:d),top:E(h===void 0?0:h),width:E(l),height:E(a),transform:y},_this219.rectStyle=A({display:"inline-flex",flexDirection:"column",alignItems:_this219.anchorCtr?"center":"flex-start",justifyContent:Uv(p),zIndex:G2,paddingLeft:E(_this219.paddingLeft),paddingTop:E(m),paddingRight:E(_this219.paddingRight),paddingBottom:E(g),boxSizing:"border-box",whiteSpace:_this219.isTextWrap?"normal":"nowrap"},_this219.rectStyle),_this219.updateRectStyleByWrapResource(),_this219.generateParagraphBulletInfo();return _this219}_createClass(oS,[{key:"updateRectStyleByWrapResource",value:function updateRectStyleByWrapResource(){var e=this.props.textBodyWrapResource;if(e===void 0)return;var t=e.prop.anchor;this.rectStyle=F(A({},this.rectStyle),{justifyContent:Uv(t)}),this.rectStyle=p2(this.vert,this.rectStyle,this.props)}},{key:"generateParagraphBulletInfo",value:function generateParagraphBulletInfo(){var e=this.props.textBodyWrapResource;if(e===void 0)return;var t=e.paragraphs.map(function(r){var n,s;return{autoNumber:(n=r.prop.bulletChar)==null?void 0:n.autoNumber,autoNumberType:(s=r.prop.bulletChar)==null?void 0:s.autoNumberType,level:r.prop.level,empty:r.lines.length===0}}),i=[0,0,0,0,0,0,0,0,0];this.paragraphBulletInfo=t.map(function(r,n){var s=r.level,o=r.autoNumberType;if(i=i.map(function(a,l){return l>s?0:l===s?o?a:0:a}),o){var a=r.autoNumber;if(n>0&&t[n-1].autoNumber!==a&&(i[s]=0),r.empty)return{order:n,count:t.length};var l=i[s];return i[s]=l+1,{number:l+(a||1),order:n,count:t.length}}else return{order:n,count:t.length}})}},{key:"renderParagraph",value:function renderParagraph(e,t,i,r,n,s,o,a){var l=0,h=e==null?void 0:e.elements.find(function(b){return b.name==="a:r"}),_this$props36=this.props,d=_this$props36.slideContext,u=_this$props36.width,p=_this$props36.height,f=_this$props36.uuid,m=_this$props36.resourceType,g=_this$props36.withAnimation,y=_this$props36.textBodyWrapResource;return wn["default"].createElement(k2,{key:"".concat(i),slideContext:d,isTextWrap:o,width:u,height:p,paragraphIndex:i,firstRangeXML:h,buIndexCounter:this.buIndexCounter,paragraphXML:e,bodyPrXML:t,uuid:f,round:l,spcFirstLastPara:r,isFirst:n,isLast:s,vert:this.vert,resourceType:m,paragraphWrapResource:a,textBodyWrapResource:y,withAnimation:!!g,bulletInfo:this.paragraphBulletInfo[i]})}},{key:"render",value:function render(){var _this220=this;var _this$props37=this.props,e=_this$props37.textBodyWrapResource,t=_this$props37.width;if(this.presetType&&this.presetType!==zu.textNoShape&&_2.includes(this.presetType)&&e){var n=this.bodyPrXML.childElementOptional("a:prstTxWarp"),s=n==null?void 0:n.childElementOptional("a:avLst"),o=(s==null?void 0:s.elementsWithName("a:gd"))||[];return wn["default"].createElement("div",{style:F(A({},this.rectStyle),{display:"flex",justifyContent:"center",alignItems:"center",padding:0}),className:"txBody"},wn["default"].createElement(K2,{presetType:this.presetType,shapeGuideList:o,textBodyWrapResource:e}))}var i=c2(this.vert),r;return e?r=e.paragraphs.map(function(n,s){return _this220.renderParagraph(void 0,void 0,s,_this220.spcFirstLastPara,s===0,s===e.paragraphs.length-1,_this220.isTextWrap,n)}):r=this.paragraphXMLs.map(function(n,s){return _this220.renderParagraph(n,_this220.bodyPrXML,s,_this220.spcFirstLastPara,s===0,s===_this220.paragraphXMLs.length-1,_this220.isTextWrap)}),this.buIndexCounter.reset(),wn["default"].createElement("div",{className:"txBoby",style:this.rectStyle},wn["default"].createElement("ol",{style:A({width:E(t-this.paddingLeft-this.paddingRight),marginBlockEnd:0,marginBlockStart:0,paddingBlockStart:0,paddingBlockEnd:0,marginInlineEnd:0,marginInlineStart:0,paddingInlineStart:0,paddingInlineEnd:0,margin:0,padding:0,whiteSpace:this.isTextWrap?"normal":"nowrap",columnCount:this.numCol===1?void 0:this.numCol},i)},r))}}]);return oS}(wn["default"].Component),Y2=/*#__PURE__*/function(_Sn$default$Component){_inherits(Y2,_Sn$default$Component);var _super68=_createSuper(Y2);function Y2(){_classCallCheck(this,Y2);return _super68.apply(this,arguments)}_createClass(Y2,[{key:"renderCol",value:function renderCol(e,t,i,r,n,s){var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var a;var l=function l(){var _ref82;return(_ref82=[]).concat.apply(_ref82,arguments).reduce(function(Qc,qc){return Qc+qc},0)},h=e.childElementOptional("a:tcPr");if(!h)return null;var d=h.extraAttr.getColor("".concat(t,"-").concat(i,"-fillColor"),cr),u;d instanceof Fo?u=d.getGradientStyles():u=X(d);var p=h.extraAttr.getStringOptional("".concat(t,"-").concat(i,"-fontFamily")),f=h.extraAttr.getBoolean("".concat(t,"-").concat(i,"-isBold"),!1),m=h.extraAttr.getBoolean("".concat(t,"-").concat(i,"-isItalic"),!1),g=h.extraAttr.getString("".concat(t,"-").concat(i,"-bottomBorderStyle"),"none"),y=h.extraAttr.getNumber("".concat(t,"-").concat(i,"-bottomBorderWidth"),0),b=h.extraAttr.getColorOptional("".concat(t,"-").concat(i,"-bottomBorderColor"),cr),v=h.extraAttr.getString("".concat(t,"-").concat(i,"-topBorderStyle"),"none"),w=h.extraAttr.getNumber("".concat(t,"-").concat(i,"-topBorderWidth"),0),M=h.extraAttr.getColorOptional("".concat(t,"-").concat(i,"-topBorderColor"),cr),x=h.extraAttr.getString("".concat(t,"-").concat(i,"-leftBorderStyle"),"none"),T=h.extraAttr.getNumber("".concat(t,"-").concat(i,"-leftBorderWidth"),0),O=h.extraAttr.getColorOptional("".concat(t,"-").concat(i,"-leftBorderColor"),cr),R=h.extraAttr.getString("".concat(t,"-").concat(i,"-rightBorderStyle"),"none"),W=h.extraAttr.getNumber("".concat(t,"-").concat(i,"-rightBorderWidth"),0),J=h.extraAttr.getColorOptional("".concat(t,"-").concat(i,"-rightBorderColor"),cr),ee=e.childElementOptional("a:txBody");if(ee===void 0)return null;var z=e.attr.getNumber("gridSpan",1),Re=e.attr.getNumber("rowSpan",1),Ht=e.attr.getBoolean("hMerge",!1),Ne=e.attr.getBoolean("vMerge",!1),St=l(s.slice(i,i+z)),Je="".concat(t,"-").concat(i),_this$props38=this.props,wt=_this$props38.slideContext,ki=_this$props38.uuid,Ws=_this$props38.shapeWrapResource;return Ht||Ne?null:Sn["default"].createElement("td",{colSpan:z,rowSpan:Re,style:{position:"relative",fontFamily:p&&p,fontWeight:f?500:400,fontStyle:m?"italic":"normal",borderBottomStyle:g,borderTopStyle:v,borderLeftStyle:x,borderRightStyle:R,borderBottomWidth:E(y),borderTopWidth:E(w),borderLeftWidth:E(T),borderRightWidth:E(W),borderBottomColor:X(b),borderTopColor:X(M),borderLeftColor:X(O),borderRightColor:X(J),width:E(St),height:E(n),background:u,boxSizing:"border-box",fontSize:0,lineHeight:0},key:"tc-".concat(t,"-").concat(i),className:"tc-".concat(t,"-").concat(i)},Sn["default"].createElement(oS,{slideContext:wt,insideTable:!0,width:St,height:n,totalPadding:o,uuid:ki,txBodyXML:ee,resourceType:"slide",textBodyWrapResource:(a=Ws==null?void 0:Ws.textBodyMap)==null?void 0:a[Je]}))}},{key:"render",value:function render(){var _this221=this;var e=this.props.graphXML,t=e.childElementOptional("a:graphic","a:graphicData","a:tbl"),i=t&&t.childElement("a:tblGrid"),r=i?i.elementsWithName("a:gridCol"):[],n=t?t.elementsWithName("a:tr"):[],s=n.length,o=0;if(s>0){var l=0;n.forEach(function(h,d){if(d===0){var p=0;h.elementsWithName("a:tc").forEach(function(f,m){var g=f.childElement("a:tcPr").extraAttr.getNumber("".concat(d,"-").concat(m,"-topBorderWidth"),0);p=Math.max(g,p)}),l+=p}var u=0;h.elementsWithName("a:tc").forEach(function(p,f){var m=p.childElement("a:tcPr").extraAttr.getNumber("".concat(d,"-").concat(f,"-bottomBorderWidth"),0);u=Math.max(m,u)}),l+=u}),o=l/s}var a=n.map(function(l,h){var d=l.attr.getNumber("h"),u=l.elementsWithName("a:tc").map(function(f,m){return r[m].attr.getNumber("w")}),p=l.elementsWithName("a:tc").map(function(f,m){var g=r[m].attr.getNumber("w");return _this221.renderCol(f,h,m,g,d,u,o)});return Sn["default"].createElement("tr",{key:"tr-"+h},p)});return Sn["default"].createElement("table",{style:{borderCollapse:"collapse"},cellSpacing:"0",cellPadding:"0"},Sn["default"].createElement("tbody",null,a))}}]);return Y2}(Sn["default"].Component),X2=/*#__PURE__*/function(_Uu$default$Component){_inherits(X2,_Uu$default$Component);var _super69=_createSuper(X2);function X2(e){var _this222;_classCallCheck(this,X2);_this222=_super69.call(this,e);_this222.url=_this222.getUrl(),_this222.imageLoadingMonitor=new Cn(e.logger).createMonitor();return _this222}_createClass(X2,[{key:"getId",value:function getId(){var e=this.props.graphXML,t=e.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getStringOptional("id");if(t)return"spId".concat(t);if(e.parent&&e.parent.name==="mc:Choice")return this.getResId()}},{key:"getResId",value:function getResId(){var e;var t=this.props.graphXML,i=(e=t.parent)==null?void 0:e.parent;if(!i)return;var r=i.childElementOptional("mc:Fallback","p:pic","p:blipFill","a:blip");if(r)return r.attr.getStringOptional("r:embed")}},{key:"getUrl",value:function getUrl(){var _this$props39=this.props,e=_this$props39.slideContext,t=_this$props39.resourceType,i=this.getId();return i?e.resourceLoader.loadURL(t,i):void 0}},{key:"render",value:function render(){if(!this.url)return null;var _this$props40=this.props,e=_this$props40.width,t=_this$props40.height;return Uu["default"].createElement("img",{src:this.url,alt:"graph",style:{width:E(e),height:E(t)},ref:this.imageLoadingMonitor})}}]);return X2}(Uu["default"].Component),Q2=/*#__PURE__*/function(_Vu$default$Component){_inherits(Q2,_Vu$default$Component);var _super70=_createSuper(Q2);function Q2(e){var _this223;_classCallCheck(this,Q2);_this223=_super70.call(this,e);_this223.url=_this223.getUrl(),_this223.imageLoadingMonitor=new Cn(e.logger).createMonitor();return _this223}_createClass(Q2,[{key:"getId",value:function getId(){var e=this.props.graphXML;return e.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getString("id")}},{key:"getUrl",value:function getUrl(){var _this$props41=this.props,e=_this$props41.slideContext,t=_this$props41.resourceType,i=this.getId();return e.resourceLoader.loadURL(t,"spId".concat(i))}},{key:"render",value:function render(){var _this$props42=this.props,e=_this$props42.width,t=_this$props42.height;return Vu["default"].createElement("img",{src:this.url,alt:"diagram",style:{width:E(e),height:E(t)},ref:this.imageLoadingMonitor})}}]);return Q2}(Vu["default"].Component),q2=/*#__PURE__*/function(_Wu$default$PureCompo){_inherits(q2,_Wu$default$PureCompo);var _super71=_createSuper(q2);function q2(){_classCallCheck(this,q2);return _super71.apply(this,arguments)}_createClass(q2,[{key:"render",value:function render(){return Wu["default"].createElement("div",null)}}]);return q2}(Wu["default"].PureComponent),Z2=/*#__PURE__*/function(_Hl$default$Component){_inherits(Z2,_Hl$default$Component);var _super72=_createSuper(Z2);function Z2(e){var _this224;_classCallCheck(this,Z2);_this224=_super72.call(this,e);_this224.url=_this224.getUrl(),_this224.imageLoadingMonitor=new Cn(e.logger).createMonitor();return _this224}_createClass(Z2,[{key:"getId",value:function getId(){var e=this.props.graphXML;return e.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getString("id")}},{key:"getUrl",value:function getUrl(){var _this$props43=this.props,e=_this$props43.slideContext,t=_this$props43.resourceType,i=this.getId();return e.resourceLoader.loadURL(t,"spId".concat(i))}},{key:"render",value:function render(){if(this.url){var _this$props44=this.props,e=_this$props44.width,t=_this$props44.height;return Hl["default"].createElement("img",{src:this.url,alt:"oleGraph",style:{width:E(e),height:E(t)},ref:this.imageLoadingMonitor})}else return Hl["default"].createElement("div",null)}}]);return Z2}(Hl["default"].Component),J2=/*#__PURE__*/function(_Eu$default$Component){_inherits(J2,_Eu$default$Component);var _super73=_createSuper(J2);function J2(e){var _this225;_classCallCheck(this,J2);_this225=_super73.call(this,e);var t=_this225.props.graphXML;_this225.uri=t.childElement("a:graphic","a:graphicData").attr.getStringOptional("uri");return _this225}_createClass(J2,[{key:"subGraphClassWithURI",value:function subGraphClassWithURI(e){switch(e){case"http://schemas.openxmlformats.org/drawingml/2006/table":return Y2;case"http://schemas.microsoft.com/office/drawing/2014/chartex":case"http://schemas.openxmlformats.org/drawingml/2006/chart":return X2;case"http://schemas.openxmlformats.org/drawingml/2006/diagram":return Q2;case"http://schemas.openxmlformats.org/presentationml/2006/ole":return Z2;default:return console.debug("Unsupported graph",e),q2;}}},{key:"render",value:function render(){var _this$props45=this.props,e=_this$props45.shapeGroupTransform,t=_this$props45.width,i=_this$props45.height,r=this.subGraphClassWithURI(this.uri),n,s;if(e){var a=e.scaleX,l=e.scaleY;n=t*a,s=i*l}else n=t,s=i;var o=F(A({},this.props),{height:s,width:n});return Eu["default"].createElement(r,A({},o))}}]);return J2}(Eu["default"].Component),eM="https://convertcdn.netless.link/publicFiles/icon/play.png",tM="https://convertcdn.netless.link/publicFiles/icon/pause.png",lS=function lS(e){var t=e.startTime,i=e.endTime,r=e.duration;return t&&(r-=t),i&&(r-=i),r},cS=/*#__PURE__*/function(_Ft$default$Component){_inherits(cS,_Ft$default$Component);var _super74=_createSuper(cS);function cS(e){var _this226;_classCallCheck(this,cS);_this226=_super74.call(this,e);_this226.state={total:lS(e)};return _this226}_createClass(cS,[{key:"componentDidMount",value:function componentDidMount(){var e=this.props.protalId;this.controllerPortal=document.getElementById(e)}},{key:"onPlayClick",value:function onPlayClick(e){var t=this.props.onPlayClick;e.stopPropagation(),t()}},{key:"onPauseClick",value:function onPauseClick(e){var t=this.props.onPauseClick;e.stopPropagation(),t()}},{key:"onBarClick",value:function onBarClick(e){var _this$props46=this.props,t=_this$props46.duration,i=_this$props46.startTime,r=_this$props46.endTime,n=_this$props46.onSeekClick;if(e.stopPropagation(),t){var s=this.props.duration;i&&(s-=i),r&&(s-=r);var o=e.nativeEvent.offsetX/e.currentTarget.clientWidth*s;i&&(o+=i),n(Math.floor(o))}}},{key:"computedCurrent",value:function computedCurrent(){var e=this.props.startTime,t=this.props.currentTime,i=this.state.total;return e&&(t>e?t-=e:t=0),t>i&&(t=i),t}},{key:"formatTime",value:function formatTime(e){var t="00:00";if(e){var i=Math.floor(e/60),_r130=String(i<0?0:i).padStart(2,"0"),n=Math.floor(e%60),s=String(n<0?0:n).padStart(2,"0");t="".concat(_r130,":").concat(s)}return t}},{key:"renderController",value:function renderController(e){var _this$props47=this.props,t=_this$props47.display,i=_this$props47.style,r=_this$props47.controllerRef,n=_this$props47.resourceLoader,s=_this$props47.playing,o=this.state.total;return Ft["default"].createElement("div",{className:"ppt-event-source",style:A({background:"#FFFFFF",borderRadius:50,height:50,width:300,display:t?"flex":"none",flexDirection:"row",alignItems:"center"},i),ref:r},Ft["default"].createElement("div",{className:"ppt-event-source",style:{marginLeft:15,marginRight:10,fontSize:0,height:20,display:s?"none":"block"},onClick:this.onPlayClick.bind(this)},Ft["default"].createElement("img",{style:{height:20},alt:"play",src:n.replaceProtocolByresourceScheme(eM)})),Ft["default"].createElement("div",{className:"ppt-event-source",style:{marginLeft:15,marginRight:10,fontSize:0,height:20,display:s?"block":"none"},onClick:this.onPauseClick.bind(this)},Ft["default"].createElement("img",{style:{height:20},alt:"pause",src:n.replaceProtocolByresourceScheme(tM)})),Ft["default"].createElement("div",{style:{width:100},className:"timer"},Ft["default"].createElement("span",{className:"current"},this.formatTime(this.computedCurrent())),Ft["default"].createElement("span",null,"/"),Ft["default"].createElement("span",{className:"total"},this.formatTime(o))),Ft["default"].createElement("div",{className:"ppt-event-source",style:{flex:1,position:"relative",marginRight:10},onMouseDown:this.onBarClick.bind(this)},Ft["default"].createElement("div",{style:{background:"#D9D9D9",position:"relative",height:10,display:"flex"},className:"total"},Ft["default"].createElement("div",{style:{background:"#4F4F4F",top:0,left:0,height:10,flex:e},className:"played"}))))}},{key:"render",value:function render(){var _this$props48=this.props,e=_this$props48.duration,t=_this$props48.endTime,i=_this$props48.currentTime,r=_this$props48.playing,n=_this$props48.onMediaEnd,s=this.state.total;if(t){var a=i+t;e>0&&a>=e&&r&&n()}var o=0;return e&&(o=this.computedCurrent()/s),this.controllerPortal?(0,aS.createPortal)(this.renderController(o),this.controllerPortal):this.renderController(o)}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(e){return{total:lS(e)}}}]);return cS}(Ft["default"].Component),iM="https://convertcdn.netless.link/publicFiles/icon/audio.png",rM=/*#__PURE__*/function(_r$default$Component){_inherits(rM,_r$default$Component);var _super75=_createSuper(rM);function rM(e){var _this227;_classCallCheck(this,rM);_this227=_super75.call(this,e);_this227.videoIntervalId=void 0,_this227.lastAnimeState={stop:0,play:0},_this227.player=_r["default"].createRef(),_this227.controller=_r["default"].createRef(),e.mediaState?_this227.state={displayController:!1,playing:e.mediaState.playing,currentTime:e.mediaState.currentTime||e.startTimePerfix,duration:0,controllerPositionTop:0,controllerPositionLeft:0}:_this227.state={displayController:!1,playing:!1,currentTime:e.startTimePerfix||0,duration:0,controllerPositionTop:0,controllerPositionLeft:0};var t=_this227.state.playing,_this227$props=_this227.props,i=_this227$props.mediaSlideActionUserIds,r=_this227$props.userId;t&&_this227.hasControl(i,r)&&_this227.syncPlayTimeLoop();return _this227}_createClass(rM,[{key:"componentDidMount",value:function componentDidMount(){var _this228=this;var e=this.props.targetID;window==null||window.addEventListener("message",function(t){t.data.type==="_changeAudioState"&&t.data.targetID===e&&_this228.updateAnimation(t.data)})}},{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(e){var _this$props49=this.props,t=_this$props49.disableAnimation,i=_this$props49.outsidePausing,r=_this$props49.mediaState,n=_this$props49.rtcClient,s=this.state.playing;if(t===!0){this.player.current&&this.pauseAudio();return}if(!i&&e.outsidePausing){this.player.current&&this.pauseAudio();return}else if(i&&!e.outsidePausing){this.player.current&&this.playAudio();return}if(r!==void 0&&r.playing===e.mediaState.playing&&r.currentTime===e.mediaState.currentTime){s!==r.playing&&this.setState({playing:r.playing});return}this.hasControl(e.mediaSlideActionUserIds,e.userId)||this.stopSyncPlayTime(),r===void 0&&e.mediaState!==void 0?r===void 0&&e.mediaState!==void 0&&(this.player.current&&(this.pauseAudio(),this.player.current.currentTime=e.mediaState.currentTime,e.mediaState.playing===!0?this.playAudio():this.pauseAudio()),this.setState(e.mediaState)):r!==void 0&&e.mediaState!==void 0&&this.player.current&&(r.playing?Math.abs(e.mediaState.currentTime-this.player.current.currentTime)>1.5&&(this.player.current.currentTime=e.mediaState.currentTime,e.mediaState.playing&&(n==null||n.setAudioMixingPosition(Math.floor(this.player.current.currentTime*1e3)))):this.player.current.currentTime=e.mediaState.currentTime,s&&!e.mediaState.playing?this.pauseAudio():!s&&e.mediaState.playing&&this.playAudio(),this.setState({playing:e.mediaState.playing,currentTime:e.mediaState.currentTime}))}},{key:"onMediaCanPlay",value:function onMediaCanPlay(){var _this$props50=this.props,e=_this$props50.disableAnimation,t=_this$props50.mediaState,i=_this$props50.rtcClient;e===!0?this.pauseAudio():t&&t.playing&&(i&&!this.audioMixing||this.player.current.paused===!0&&(this.player.current.currentTime=t.currentTime,this.playAudio()))}},{key:"onMouseOver",value:function onMouseOver(e){var t=this.state.displayController,i=this.props.slideRef;if(t!==!0){var _r131=e.target,_r131$getBoundingClie=_r131.getBoundingClientRect(),n=_r131$getBoundingClie.x,s=_r131$getBoundingClie.y,o=_r131$getBoundingClie.height,_i$current$getBoundin=i.current.getBoundingClientRect(),a=_i$current$getBoundin.x,l=_i$current$getBoundin.y,h=_i$current$getBoundin.width,d=_i$current$getBoundin.height,u=getComputedStyle(this.controller.current),p=h/parseFloat(getComputedStyle(i.current).width),f=0,m=0;u!==null&&u.width!==null&&(f=parseInt(u.width,10)*p),u!==null&&u.height!==null&&(m=parseInt(u.height,10)*p);var g=0,y=0;n<a?y=0:a+h<n+f?y=h-f:y=n-a,s+o-m<l?g=0:s+o>l+d?g=d-m:g=s+o-l-m,this.setState({displayController:!0,controllerPositionTop:g/p,controllerPositionLeft:y/p})}}},{key:"onMediaPlay",value:function onMediaPlay(){var _this$props51=this.props,e=_this$props51.onMediaPlay,t=_this$props51.shapeId,i=this.state.currentTime;e&&e(t,"audio",i)}},{key:"onMediaPause",value:function onMediaPause(){var _this$props52=this.props,e=_this$props52.onMediaPause,t=_this$props52.shapeId,i=this.state.currentTime;this.stopSyncPlayTime(),e&&e(t,"audio",i)}},{key:"stopSyncPlayTime",value:function stopSyncPlayTime(){this.videoIntervalId&&clearInterval(this.videoIntervalId)}},{key:"syncPlayTime",value:function syncPlayTime(e){if(this.player.current){var _this$props53=this.props,t=_this$props53.mediaRef,i=_this$props53.onMediaChange,_r132=_this$props53.shapeId,n=this.state.currentTime,s=t.startTime,o=t.endTime,a=e||n,l=this.player.current.duration;o&&(l-=o);var h=a;this.player.current&&a>=l&&(h=s||0),s&&h<s&&(h=s),i({playing:!0,currentTime:h},_r132)}}},{key:"syncPlayTimeLoop",value:function syncPlayTimeLoop(e){var _this229=this;var t=this.props.onMediaChange;t&&(this.syncPlayTime(e),this.videoIntervalId=window.setInterval(function(){_this229.syncPlayTime()},1e3))}},{key:"pauseAudio",value:function pauseAudio(){var _this230=this;if(this.player.current){var e=this.props.rtcClient;e!==void 0?this.stopMixAudio(function(){return _this230.player.current.pause()}):this.player.current.pause()}}},{key:"stopMixAudio",value:function stopMixAudio(e){var _this231=this;var _this$props54=this.props,t=_this$props54.rtcClient,i=_this$props54.logger;t.stopAudioMixing(function(r,n){r===714?(i==null||i.error("rtc mixing error : ".concat(n)),console.error(" stop audio mixing error :",n)):(_this231.audioMixing=!1,e())})}},{key:"playLocalAudio",value:function playLocalAudio(){var e=this.player.current.play();if(e!==void 0){var _this$props55=this.props,t=_this$props55.onMediaPlayError,i=_this$props55.logger,_r133=_this$props55.shapeId;e.then(function(){})["catch"](function(n){i?i.error("play audio exception: ".concat(n)):console.error(n),t&&t(_r133,"audio",n)})}}},{key:"playAudio",value:function playAudio(){if(this.player.current){var e=this.props.rtcClient;e!==void 0?this.mixAudio(this.player.current.currentTime,this.playLocalAudio.bind(this)):this.playLocalAudio()}}},{key:"mixAudio",value:function mixAudio(e,t){var _this232=this;var _this$props56=this.props,i=_this$props56.rtcClient,r=_this$props56.audioURL,n=_this$props56.logger,s=this.state.playing;s?(i==null||i.setAudioMixingPosition(Math.floor(e*1e3)),t()):i==null||i.startAudioMixing(r,!0,!1,1,function(o,a){o===714?(n==null||n.error("rtc mixing error : ".concat(a)),console.error("rtc mixing error :",a)):(i==null||i.setAudioMixingPosition(Math.floor(e*1e3)),_this232.audioMixing=!0,t())})}},{key:"updateAnimation",value:function updateAnimation(e){if(this.player.current){var _this$props57=this.props,t=_this$props57.startTime,i=_this$props57.startTimePerfix,_r134=this.state.playing;e.play===1&&this.player.current.paused&&(t?this.player.current.currentTime=i+t:this.player.current.currentTime=i,this.playAudio(),this.setState({playing:!0,currentTime:this.player.current.currentTime})),e.stop===1&&this.player.current&&_r134&&(this.pauseAudio(),this.setState({playing:!1}))}}},{key:"hasControl",value:function hasControl(e,t){var i=this.props.shapeId;return!e||t===void 0?!1:e[i]===t}},{key:"UNSAFE_componentWillReceivePropseslintreact",value:function UNSAFE_componentWillReceivePropseslintreact(){this.pauseAudio(),this.stopSyncPlayTime(),window==null||window.removeEventListener("_changeAudioState",function(){})}},{key:"render",value:function render(){var _this233=this;var _this$props58=this.props,e=_this$props58.resourceLoader,t=_this$props58.width,i=_this$props58.height,r=_this$props58.rtcClient,n=_this$props58.audioURL,s=_this$props58.logger,o=_this$props58.controllerProtalId,a=_this$props58.mediaRef,_this$state5=this.state,l=_this$state5.controllerPositionTop,h=_this$state5.controllerPositionLeft,d=_this$state5.displayController,u=_this$state5.duration,p=_this$state5.playing,f=_this$state5.currentTime;return _r["default"].createElement("div",{style:{position:"relative"},onMouseLeave:function onMouseLeave(){return _this233.setState({displayController:!1})}},_r["default"].createElement("img",{className:"ppt-event-source",alt:"audio",src:e.replaceProtocolByresourceScheme(iM),style:{width:E(t),height:E(i)},onMouseOver:this.onMouseOver.bind(this)}),_r["default"].createElement("audio",{src:n,ref:this.player,muted:!!r,onPlay:this.onMediaPlay.bind(this),onPause:this.onMediaPause.bind(this),onLoadedMetadata:function onLoadedMetadata(){return _this233.setState({duration:_this233.player.current.duration})},onTimeUpdate:function onTimeUpdate(){return _this233.setState({currentTime:_this233.player.current.currentTime})},onLoadedMetadataCapture:function onLoadedMetadataCapture(){window.__platform==="ios"&&_this233.onMediaCanPlay()},onCanPlay:function onCanPlay(){window.__platform!=="ios"&&_this233.onMediaCanPlay()},onError:function onError(m){var g;m.target.error!==null&&(g=m.target.error),g!==void 0?s==null||s.error("load media: ".concat(n," error, code: ").concat(g.code,", message: ").concat(g.message)):s==null||s.error("load media: ".concat(n," error without error message"))}}),_r["default"].createElement(cS,{controllerRef:this.controller,protalId:o,style:{position:"absolute",top:l,left:h,zIndex:1},resourceLoader:e,mediaRef:this.player,display:d,playing:p,duration:u,currentTime:f,onPlayClick:function onPlayClick(){_this233.stopSyncPlayTime(),_this233.syncPlayTimeLoop()},onPauseClick:function onPauseClick(){var _this233$props=_this233.props,m=_this233$props.onMediaChange,g=_this233$props.shapeId,y=_this233.state.currentTime;_this233.stopSyncPlayTime(),_this233.pauseAudio(),m&&m({playing:!1,currentTime:y},g)},onSeekClick:function onSeekClick(m){_this233.stopSyncPlayTime(),_this233.syncPlayTimeLoop(m)},onMediaEnd:function onMediaEnd(){_this233.stopSyncPlayTime(),_this233.pauseAudio(),_this233.setState({playing:!1})},endTime:a.endTime,startTime:a.startTime}))}}]);return rM}(_r["default"].Component),nM=/*#__PURE__*/function(_Ts$default$Component){_inherits(nM,_Ts$default$Component);var _super76=_createSuper(nM);function nM(){_classCallCheck(this,nM);return _super76.apply(this,arguments)}_createClass(nM,[{key:"identification",value:function identification(){var _this$props59=this.props,e=_this$props59.slideIndex,t=_this$props59.spId;return"".concat(e,"-").concat(t,"-")}},{key:"injectAdjustValue",value:function injectAdjustValue(e,t){var i=e.childElementOptional("a:avLst");i&&i.elementsWithName("a:gd").forEach(function(r){var n=r.attr.getString("fmla"),s=new Z(n).eval(t),o=r.attr.getString("name");t.setVariable(o,s)})}},{key:"render",value:function render(){var _this$props60=this.props,e=_this$props60.shapeXML,t=_this$props60.width,i=_this$props60.height,r=_this$props60.fillColor,n=_this$props60.borderStyle,s=_this$props60.children,o=e.childElementOptional("p:spPr","a:prstGeom"),a=e.childElementOptional("p:spPr","a:custGeom"),l,h=new Zv({w:t,h:i}),d="";if(o){var p=o.attr.getString("prst");this.injectAdjustValue(o,h),l=Ul(p)}else a?(l=a,d="a:"):l=Ul("rect");var u=new Jv().renderLumiaPath(l,h,d).map(function(p,f){return Ts["default"].createElement("path",{key:"path".concat(f),d:p.pathD,fill:X(r),height:E(i),width:E(t),stroke:X(n.color),strokeWidth:E(n.width),strokeDasharray:n.strokeDashArray})});return Ts["default"].createElement("svg",{style:{position:"absolute",width:E(t),height:E(i),overflow:"visible"}},Ts["default"].createElement("defs",null,Ts["default"].createElement("clipPath",{id:"clippath-".concat(this.identification())},u)),s,u)}}]);return nM}(Ts["default"].Component),sM=/*#__PURE__*/function(_Ms$default$Component){_inherits(sM,_Ms$default$Component);var _super77=_createSuper(sM);function sM(e){var _this234;_classCallCheck(this,sM);_this234=_super77.call(this,e);_this234.spId="",_this234.opacity=1,_this234.imageLoadingMonitor=new Cn(e.logger).createMonitor(),_this234.svgLoadingMonitor=new Cn(e.logger).createMonitor(),_this234.spId=e.imageXML.extraAttr.getString("spId"),_this234.getAlphaModFix();return _this234}_createClass(sM,[{key:"hasSoftEdge",get:function get(){var e=this.props.imageXML,t=e.childElementOptional("p:spPr","a:effectLst","a:softEdge");return Boolean(t)}},{key:"hasBlipChild",get:function get(){var e=this.props.imageXML,t=e.childElementOptional("p:blipFill","a:blip");return Boolean(t==null?void 0:t.elements.length)}},{key:"needSpUrl",get:function get(){return this.hasSoftEdge||this.hasBlipChild}},{key:"getAlphaModFix",value:function getAlphaModFix(){var e=this.props.imageXML,t=e.childElement("p:blipFill"),i=new Fl(t).getAlphaModFix();i&&(this.opacity=i)}},{key:"identification",value:function identification(){var e=this.props.slideIndex;return"".concat(e,"-").concat(this.spId,"-")}},{key:"render",value:function render(){var _this$props61=this.props,e=_this$props61.imageXML,t=_this$props61.width,i=_this$props61.height,r=_this$props61.spURL,n=_this$props61.imageURL,s=_this$props61.margin,o=_this$props61.uuid,a=_this$props61.slideIndex,l=_this$props61.borderStyle,h=e.childElementOptional("p:blipFill","a:stretch","a:fillRect"),d=(h?h.attr.getNumber("l",0)/K:0)*t,u=(h?h.attr.getNumber("b",0)/K:0)*i,p=(h?h.attr.getNumber("r",0)/K:0)*t,f=(h?h.attr.getNumber("t",0)/K:0)*i;if(e.childElementOptional("p:spPr",new Y("a:prstGeom","a:custGeom"))===void 0){var m=e.childElementOptional("p:blipFill","a:srcRect"),g={top:0,left:0,right:0,bottom:0};return m&&(g.top=Te(m.attr.getNumber("t",0)),g.left=Te(m.attr.getNumber("l",0)),g.right=Te(m.attr.getNumber("r",0)),g.bottom=Te(m.attr.getNumber("b",0))),Ms["default"].createElement("div",{style:{overflow:"hidden",height:"100%"}},Ms["default"].createElement("img",{src:n,style:{width:E(t),height:E(i),position:"relative",top:"".concat(E(i*-g.top)),left:"".concat(E(t*-g.left))},alt:"",ref:this.imageLoadingMonitor}))}else{var _m26=this.needSpUrl?r:n,_g8=this.needSpUrl?1:this.opacity,y,b,v,w;return this.needSpUrl&&r?(y=t-s.left-s.right,b=i-s.top-s.bottom,v=void 0,w=void 0):(y=t-d-p,b=i-f-u,v=E(-s.left+d),w=E(-s.top+f)),Ms["default"].createElement(nM,{uuid:o,slideIndex:a,borderStyle:l,width:t-s.left-s.right,height:i-s.top-s.bottom,shapeXML:e,spId:this.spId},Ms["default"].createElement(sS,{innerref:this.svgLoadingMonitor,preserveAspectRatio:"none",xlinkHref:_m26||n,href:_m26||n,x:v,y:w,width:y,height:b,clipPath:"url(#clippath-".concat(this.identification(),")"),opacity:_g8}))}}}]);return sM}(Ms["default"].Component),oM=/*#__PURE__*/function(_Kr$default$Component){_inherits(oM,_Kr$default$Component);var _super78=_createSuper(oM);function oM(e){var _this235;_classCallCheck(this,oM);_this235=_super78.call(this,e);_this235.videoIntervalId=void 0,_this235.lastAnimeState={stop:0,play:0},_this235.player=Kr["default"].createRef(),_this235.controller=Kr["default"].createRef(),_this235.imageLoadingMonitor=new Cn(e.logger).createMonitor(),e.mediaState?_this235.state={displayController:!1,playing:e.mediaState.playing,currentTime:e.mediaState.currentTime||e.startTimePerfix,duration:0,controllerPositionTop:0,controllerPositionLeft:0}:_this235.state={displayController:!1,playing:!1,currentTime:e.startTimePerfix||0,duration:0,controllerPositionTop:0,controllerPositionLeft:0};var t=_this235.state.playing,_this235$props=_this235.props,i=_this235$props.mediaSlideActionUserIds,r=_this235$props.userId;t&&_this235.hasControl(i,r)&&_this235.syncPlayTimeLoop();return _this235}_createClass(oM,[{key:"componentDidMount",value:function componentDidMount(){var _this236=this;var e=this.props.targetID;window==null||window.addEventListener("message",function(t){t.data.type==="_changeAudioState"&&t.data.targetID===e&&_this236.updateAnimation(t.data)})}},{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(e){var t=this.state.playing,_this$props62=this.props,i=_this$props62.disableAnimation,r=_this$props62.outsidePausing,n=_this$props62.mediaState,s=_this$props62.rtcClient;if(i===!0){this.player.current&&this.pauseVideo();return}if(!r&&e.outsidePausing){this.player.current&&this.pauseVideo();return}else if(r&&!e.outsidePausing){this.player.current&&this.playVideo();return}if(n!==void 0&&n.playing===e.mediaState.playing&&n.currentTime===e.mediaState.currentTime){t!==n.playing&&this.setState({playing:n.playing});return}n===void 0&&e.mediaState!==void 0?(this.hasControl(e.mediaSlideActionUserIds,e.userId)||this.stopSyncPlayTime(),n===void 0&&e.mediaState!==void 0&&(this.player.current&&(this.pauseVideo(),this.player.current.currentTime=e.mediaState.currentTime,e.mediaState.playing===!0?this.playVideo():this.pauseVideo()),this.setState(e.mediaState))):n!==void 0&&e.mediaState!==void 0&&(this.hasControl(e.mediaSlideActionUserIds,e.userId)||this.stopSyncPlayTime(),this.player.current&&(n.playing?Math.abs(e.mediaState.currentTime-this.player.current.currentTime)>1.5&&(this.player.current.currentTime=e.mediaState.currentTime,e.mediaState.playing&&(s==null||s.setAudioMixingPosition(Math.floor(this.player.current.currentTime*1e3)))):this.player.current.currentTime=e.mediaState.currentTime,t&&!e.mediaState.playing?this.pauseVideo():!t&&e.mediaState.playing&&this.playVideo(),this.setState({playing:e.mediaState.playing,currentTime:e.mediaState.currentTime})))}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.pauseVideo(),this.stopSyncPlayTime(),window==null||window.removeEventListener("_changeAudioState",function(){})}},{key:"onMediaPause",value:function onMediaPause(){var e=this.state.currentTime,_this$props63=this.props,t=_this$props63.onMediaPause,i=_this$props63.shapeId;this.stopSyncPlayTime(),t&&t(i,"video",e)}},{key:"onMediaPlay",value:function onMediaPlay(){var e=this.state.currentTime,_this$props64=this.props,t=_this$props64.onMediaPlay,i=_this$props64.shapeId;t&&t(i,"video",e)}},{key:"onMouseOver",value:function onMouseOver(e){var t=this.state.displayController,i=this.props.slideRef;if(t!==!0){var _r135=e.target,_r135$getBoundingClie=_r135.getBoundingClientRect(),n=_r135$getBoundingClie.x,s=_r135$getBoundingClie.y,o=_r135$getBoundingClie.height,_i$current$getBoundin2=i.current.getBoundingClientRect(),a=_i$current$getBoundin2.x,l=_i$current$getBoundin2.y,h=_i$current$getBoundin2.width,d=_i$current$getBoundin2.height,u=getComputedStyle(this.controller.current),p=h/parseFloat(getComputedStyle(i.current).width),f=0,m=0;u!==null&&u.width!==null&&(f=parseInt(u.width,10)*p),u!==null&&u.height!==null&&(m=parseInt(u.height,10)*p);var g=0,y=0;n<a?y=0:a+h<n+f?y=h-f:y=n-a,s+o-m<l?g=0:s+o>l+d?g=d-m:g=s+o-l-m,this.setState({displayController:!0,controllerPositionTop:g/p,controllerPositionLeft:y/p})}}},{key:"onMediaCanPlay",value:function onMediaCanPlay(){var _this$props65=this.props,e=_this$props65.disableAnimation,t=_this$props65.mediaState,i=_this$props65.rtcClient;e===!0?this.pauseVideo():t&&t.playing&&(i&&!this.audioMixing||this.player.current.paused===!0&&(this.player.current.currentTime=t.currentTime,this.playVideo()))}},{key:"hasControl",value:function hasControl(e,t){var i=this.props.shapeId;return!e||t===void 0?!1:e[i]===t}},{key:"stopSyncPlayTime",value:function stopSyncPlayTime(){this.videoIntervalId&&clearInterval(this.videoIntervalId)}},{key:"mixAudio",value:function mixAudio(e,t){var _this237=this;var i=this.state.playing,_this$props66=this.props,r=_this$props66.rtcClient,n=_this$props66.logger,s=_this$props66.videoURL;i?(r==null||r.setAudioMixingPosition(Math.floor(e*1e3)),t()):r==null||r.startAudioMixing(s,!0,!1,1,function(o,a){o===714?(n==null||n.error("rtc mixing error : ".concat(a)),console.error("rtc mixing error :",a)):(r==null||r.setAudioMixingPosition(Math.floor(e*1e3)),_this237.audioMixing=!0,t())})}},{key:"updateAnimation",value:function updateAnimation(e){if(this.player.current&&this.lastAnimeState){var t=this.state.playing,_this$props67=this.props,i=_this$props67.startTime,_r136=_this$props67.startTimePerfix;this.lastAnimeState.play===0&&e.play===1&&this.player.current&&(e.stop===1?t&&(this.pauseVideo(),this.setState({playing:!1})):t||(i?this.player.current.currentTime=_r136+i:this.player.current.currentTime=_r136,this.playVideo(),this.setState({playing:!0}))),this.lastAnimeState.stop===0&&e.stop===1&&this.player.current&&t&&(this.pauseVideo(),this.setState({playing:!1}))}this.lastAnimeState=e}},{key:"syncPlayTime",value:function syncPlayTime(e){if(this.player.current){var t=this.state.currentTime,_this$props68=this.props,i=_this$props68.mediaRef,_r137=_this$props68.onMediaChange,n=_this$props68.shapeId,s=i.startTime,o=i.endTime,a=e||t,l=this.player.current.duration;o&&(l-=o);var h=a;this.player.current&&a>=l&&(h=s||0),s&&h<=s&&(h=s),_r137({playing:!0,currentTime:h},n)}}},{key:"pauseVideo",value:function pauseVideo(){var _this238=this;var e=this.props.rtcClient;this.player.current&&(e!==void 0?this.stopMixAudio(function(){return _this238.player.current.pause()}):this.player.current.pause())}},{key:"syncPlayTimeLoop",value:function syncPlayTimeLoop(e){var _this239=this;var t=this.props.onMediaChange;t&&(this.syncPlayTime(e),this.videoIntervalId=window.setInterval(function(){_this239.syncPlayTime()},1e3))}},{key:"stopMixAudio",value:function stopMixAudio(e){var _this240=this;var _this$props69=this.props,t=_this$props69.rtcClient,i=_this$props69.logger;t.stopAudioMixing(function(r,n){r===714?(i==null||i.error("rtc mixing error : ".concat(n)),console.error(" stop audio mixing error :",n)):(_this240.audioMixing=!1,e())})}},{key:"playLocalVideo",value:function playLocalVideo(){var e=this.player.current.play();if(e!==void 0){var _this$props70=this.props,t=_this$props70.onMediaPlayError,i=_this$props70.logger,_r138=_this$props70.shapeId;e.then(function(){})["catch"](function(n){i?i.error("play video exception: ".concat(n)):console.error(n),t&&t(_r138,"video",n)})}}},{key:"playVideo",value:function playVideo(){if(this.player.current){var e=this.props.rtcClient;e!==void 0?this.mixAudio(this.player.current.currentTime,this.playLocalVideo.bind(this)):this.playLocalVideo()}}},{key:"render",value:function render(){var _this241=this;var _this$props71=this.props,e=_this$props71.mediaRef,t=_this$props71.videoURL,i=_this$props71.width,r=_this$props71.height,n=_this$props71.rtcClient,s=_this$props71.logger,o=_this$props71.controllerProtalId,a=_this$props71.resourceLoader,l=_this$props71.onMediaChange,h=_this$props71.shapeId,_this$state6=this.state,d=_this$state6.controllerPositionTop,u=_this$state6.controllerPositionLeft,p=_this$state6.displayController,f=_this$state6.playing,m=_this$state6.duration,g=_this$state6.currentTime,y=e.startTime?e.startTime*1e3:1e4,b="".concat(t,"?x-oss-process=video/snapshot,t_").concat(y,",m_fast,w_800,f_png,ar_auto");return Kr["default"].createElement("div",{className:"ppt-event-source",style:{position:"relative",width:E(i),height:E(r)},onMouseLeave:function onMouseLeave(){return _this241.setState({displayController:!1})}},Kr["default"].createElement("img",{src:b,alt:"poster",style:{position:"absolute",zIndex:0,top:0,left:0,width:E(i),height:E(r)},ref:this.imageLoadingMonitor}),Kr["default"].createElement("video",{className:"ppt-event-source","webkit-playsinline":"true",playsInline:!0,src:t,ref:this.player,muted:!!n,style:{position:"absolute",zIndex:1,top:0,left:0,width:E(i),height:E(r),objectFit:"fill"},poster:b,onPlay:this.onMediaPlay.bind(this),onPause:this.onMediaPause.bind(this),onLoadedMetadata:function onLoadedMetadata(){return _this241.setState({duration:_this241.player.current.duration})},onTimeUpdate:function onTimeUpdate(){return _this241.setState({currentTime:_this241.player.current.currentTime})},onLoadedMetadataCapture:function onLoadedMetadataCapture(){window.__platform==="ios"&&_this241.onMediaCanPlay()},onCanPlay:function onCanPlay(){window.__platform!=="ios"&&_this241.onMediaCanPlay()},onError:function onError(v){var w;v.target.error!==null&&(w=v.target.error),w!==void 0?s==null||s.error("load media: ".concat(t," error,\n                                code: ").concat(w.code,", message: ").concat(w.message)):s==null||s.error("load media: ".concat(t," error without error message"))},onMouseOver:this.onMouseOver.bind(this),preload:"auto"}),Kr["default"].createElement(cS,{protalId:o,style:{position:"absolute",top:d,left:u,zIndex:2,backfaceVisibility:"hidden"},resourceLoader:a,controllerRef:this.controller,mediaRef:this.player,display:p,playing:f,duration:m,currentTime:g,onPlayClick:function onPlayClick(){_this241.stopSyncPlayTime(),_this241.syncPlayTimeLoop()},onPauseClick:function onPauseClick(){_this241.stopSyncPlayTime(),l&&l({playing:!1,currentTime:g},h)},onSeekClick:function onSeekClick(v){_this241.stopSyncPlayTime(),_this241.syncPlayTimeLoop(v)},onMediaEnd:function onMediaEnd(){_this241.stopSyncPlayTime(),_this241.pauseVideo(),_this241.setState({playing:!1})},endTime:e.endTime,startTime:e.startTime}))}}]);return oM}(Kr["default"].Component),aM=/*#__PURE__*/function(){function aM(e){_classCallCheck(this,aM);this.spTreeXML=e}_createClass(aM,[{key:"indexBySpId",value:function indexBySpId(){var e={},t=0;var _iterator200=_createForOfIteratorHelper(this.spTreeXML.elements),_step200;try{for(_iterator200.s();!(_step200=_iterator200.n()).done;){var i=_step200.value;var _r139=i.extraAttr.getStringOptional("spId");typeof _r139=="string"&&(e[_r139]=t,t+=1)}}catch(err){_iterator200.e(err)}finally{_iterator200.f()}return e}}]);return aM}(),lM=/*#__PURE__*/function(_Uo$default$PureCompo){_inherits(lM,_Uo$default$PureCompo);var _super79=_createSuper(lM);function lM(e){var _this242;_classCallCheck(this,lM);_this242=_super79.call(this,e);_this242.lumiaRef=Uo["default"].createRef();var t;var i=0,r=e.shapeGroupTransform,n=e.shapeXML;if(n.name==="p:sp"){var a=n.childElementOptional("p:spPr","a:xfrm");if(a){var l=a.attr.getNumber("rot",0);i=Number(l)/Lt}}var s=y2(n),o=(t=r==null?void 0:r.rotate)!=null?t:0;s===U.EaVert&&i+o===270&&(_this242.vertTextType=!0);return _this242}_createClass(lM,[{key:"renderTextBody",value:function renderTextBody(e){var t;var _this$props72=this.props,i=_this$props72.shapeWrapResource,r=_this$props72.slideContext,n=_this$props72.width,s=_this$props72.height,o=_this$props72.resourceType,a=_this$props72.flipH,l=_this$props72.flipV,h=_this$props72.uuid,d=_this$props72.withAnimation,u;return i&&!i.prop.specialShape&&(u=(t=i.textBodyMap)==null?void 0:t["0"]),Uo["default"].createElement(oS,{slideContext:r,txBodyXML:e,width:n,height:s,resourceType:o,flipH:a,flipV:l,uuid:h,textBodyWrapResource:u,withAnimation:d})}},{key:"renderShape",value:function renderShape(e,t){var i,r,n=0,s=this.vertTextType,o=this.lumiaRef,_this$props73=this.props,a=_this$props73.shapeGroupTransform,l=_this$props73.width,h=_this$props73.height,d=_this$props73.fillColor,u=_this$props73.groupFillColor,p=_this$props73.borderStyle,f=_this$props73.slideIndex,m=_this$props73.uuid,g=_this$props73.resourceLoader,y=_this$props73.resourceType,b=_this$props73.logger;if(e.name==="p:sp"){var v=e.childElementOptional("p:spPr","a:xfrm");if(v){var w=v.attr.getNumber("rot",0);n=Number(w)/Lt}}if(a){var _v10=Vv(n,a),_w10=_v10.scaleX,M=_v10.scaleY;i=l*_w10,r=h*M}else i=l,r=h;return Uo["default"].createElement(H2,{vertTextType:s,ref:o,fillColor:d,groupFillColor:u,spId:e.extraAttr.getString("spId"),borderStyle:p,width:i,height:r,slideIndex:f,uuid:m,resourceLoader:g,resourceType:y,logger:b,shapeXML:e},t?this.renderTextBody(t):null)}},{key:"render",value:function render(){var e=this.props.shapeXML,t=e.childElementOptional("p:txBody");return this.renderShape(e,t)}}]);return lM}(Uo["default"].PureComponent);function bi(e,t,i){return"".concat(i,"_").concat(t,"_").concat(e)}function cM(e,t){if(!t)return 1;var i=t.slideIndex,r=t.slideCount,n=t.preSlideIndex,s=1;switch(e){case"firstslide":{s=1;break}case"previousslide":{s=i-1;break}case"endshow":{s=r;break}case"lastslide":{s=r;break}case"nextslide":{s=i+1;break}case"lastslideviewed":s=n+1;}return s<1&&(s=1),s>r&&(s=r),s}function hS(e,t,i,r){var n=U.Horz,s=e.childElementOptional("p:txBody");s&&s.name==="p:txBody"&&(n=$v(s));var o={x:e.extraAttr.getNumber("x"),y:e.extraAttr.getNumber("y"),width:e.extraAttr.getNumber("width"),height:e.extraAttr.getNumber("height")},a=e.extraAttr.getBoolean("hidden"),l=e.extraAttr.getBoolean("flipV"),h=e.extraAttr.getBoolean("flipH"),d=e.extraAttr.getNumberOptional("rot");if(n===U.EaVert&&d===162e5){d=0;var _o29=o,b=_o29.x,v=_o29.y,w=_o29.width,M=_o29.height;o=F(A({},o),{x:b+(w-M)/2,y:v+(M-w)/2,width:M,height:w})}var u={color:e.extraAttr.getColor("borderColor"),width:e.extraAttr.getNumber("borderWidth"),type:e.extraAttr.getString("borderType"),strokeDashArray:e.extraAttr.getString("borderStrokeDashArray")},p;e.extraAttr.getOptional("fillColor")&&(p=e.extraAttr.getColor("fillColor"),p instanceof Bl&&p.setFillColor(r.fillColor));var f=e.childElementOptional("p:blipFill","a:srcRect"),m;if(f){var _b2=Te(f.attr.getNumber("l",0)),_v11=Te(f.attr.getNumber("r",0)),_w11=Te(f.attr.getNumber("t",0)),_M2=Te(f.attr.getNumber("b",0)),x=1-_b2-_v11,T=1-_w11-_M2,O=o.width/x,R=o.height/T,W=O*_b2,J=R*_w11,ee=O*_v11,z=R*_M2;m={width:O,height:R,margin:{left:W,top:J,right:ee,bottom:z}}}var g=e.childElementOptional(new Y("p:nvSpPr","p:nvPicPr"),"p:cNvPr","a:hlinkClick"),y;if(g&&(y=g.attr.getStringOptional("r:id"),!y)){var _b3=g==null?void 0:g.attr.getStringOptional("action"),_v12=new URL(_b3!=null?_b3:"");if(_v12.pathname==="//hlinkshowjump"){var _w12=["firstslide","previousslide","nextslide","lastslide","endshow","lastslideviewed"],_M3=_v12.searchParams.get("jump");_w12.includes(_M3)&&(y=cM(_M3,t))}}return{rectangle:o,borderStyle:u,fillColor:p,tailor:m,flipV:l,flipH:h,rotate:d,parentGroupShapeId:i,hidden:a,hyperLinkDestination:y}}var _u=/*#__PURE__*/function(_hr$default$Component){_inherits(_u,_hr$default$Component);var _super80=_createSuper(_u);function _u(e){var _this243;_classCallCheck(this,_u);_this243=_super80.call(this,e);_this243.animeTarget=hr["default"].createRef(),_this243.shapeMap=new zv(hS),_this243.childrenRef=hr["default"].createRef(),_this243.eventSourceId=void 0,_this243.emptyClick=function(){},_this243.onClick=function(s){var _this243$props=_this243.props,o=_this243$props.onHyperLinkClick,a=_this243$props.onEventSourceClick;if(_this243.shapeWrapperParams.hyperLinkDestination!==void 0)return o?o(_this243.shapeWrapperParams.hyperLinkDestination,s):void 0;if(_this243.eventSourceId!==void 0)return a?a(_this243.eventSourceId):void 0},_this243.state={soundEffectUrl:null};var t=e.shapeXML,i=e.resourceType,r=e.shapeGroupTransform,n=e.onEventSourceClick;if(_this243.spId=t.extraAttr.getString("spId"),_this243.resourceType=i,_this243.player=hr["default"].createRef(),_this243.shapeWrapperParams=_this243.shapeMap.map(t,e.slideContext,r),e.eventSourceId!==void 0)_this243.eventSourceId=e.eventSourceId;else{var s=bi(e.slideContext.uuid,e.slideContext.slideIndex,_this243.spId);e.interactiveSeqsKeys&&e.interactiveSeqsKeys.indexOf(s)!==-1&&n!==void 0&&(_this243.eventSourceId=s)}return _this243}_createClass(_u,[{key:"componentDidMount",value:function componentDidMount(){var _this244=this;var e=this.props.slideContext;window==null||window.addEventListener("message",function(t){t.data.type==="_playSoundEffect"&&t.data.targetID===bi(e.uuid,e.slideIndex,_this244.spId)&&_this244.playEffectSound(t.data.targetID,t.data.soundEffectId)})}},{key:"getPositionAndSize",value:function getPositionAndSize(){var e,t,i,r,n=0,_this$props74=this.props,s=_this$props74.shapeXML,o=_this$props74.shapeGroupTransform;if(s.name==="p:sp"||s.name==="p:pic"){var a=s.childElementOptional("p:spPr","a:xfrm");if(a){var l=a.attr.getNumber("rot",0);n=Number(l)/Lt}}if(o){var _this$shapeWrapperPar=this.shapeWrapperParams.rectangle,_a27=_this$shapeWrapperPar.x,_l10=_this$shapeWrapperPar.y,h=_this$shapeWrapperPar.width,d=_this$shapeWrapperPar.height,u=o.scaleX,p=o.scaleY,f=o.translateX,m=o.translateY;Math.abs(Math.cos(n/180*Math.PI))>=Math.abs(Math.sin(n/180*Math.PI))?(e=(_a27+f)*u,t=(_l10+m)*p,i=h*u,r=d*p):(e=(_a27+f+h/2)*u-h*p/2,t=(_l10+m+d/2)*p-d*u/2,i=h*p,r=d*u)}else e=this.shapeWrapperParams.rectangle.x,t=this.shapeWrapperParams.rectangle.y,i=this.shapeWrapperParams.rectangle.width,r=this.shapeWrapperParams.rectangle.height;return{left:E(e),top:E(t),width:E(i),height:E(r)}}},{key:"transform",value:function transform(e){var t={translateX:0,translateY:0,scaleX:1,scaleY:1,rotate:0},_this$transformWithSh=this.transformWithShapeParams(e,t),i=_this$transformWithSh.translateX,r=_this$transformWithSh.translateY,n=_this$transformWithSh.scaleX,s=_this$transformWithSh.scaleY,o=_this$transformWithSh.rotate,a=(e.rotate||0)+o;return n<0&&(a=-a),s<0&&(a=-a),"translate(".concat(E(i),", ").concat(E(r),") scale(").concat(n,",").concat(s,") rotate(").concat(gs(a),"deg)")}},{key:"transformWithShapeParams",value:function transformWithShapeParams(e,t){var i=t.translateX,r=t.translateY,n=e.flipH?-t.scaleX:t.scaleX,s=e.flipV?-t.scaleY:t.scaleY,o=0;return t.rotate&&typeof t.rotate=="number"&&(o=t.rotate),{translateX:i,translateY:r,scaleX:n,scaleY:s,rotate:o}}},{key:"playEffectSound",value:function playEffectSound(e,t){if(t!==void 0){var _this$props75=this.props,i=_this$props75.resourceType,_r140=_this$props75.slideContext;if(i==="slide"){var n=_r140.resourceLoader.loadURL(i,t);if(n){var s=document.getElementById("".concat(e));if(s){var o=document.createElement("audio");return o.id="".concat(e,"-").concat(t),o.onpause=function(){o.remove()},o.src=n,o.controls=!1,s.appendChild(o),o.play().then(function(){},function(){}),!0}}}}return!1}},{key:"renderShape",value:function renderShape(e){var t=e.tailor,i={left:0,right:0,top:0,bottom:0},r=e.rectangle;t&&(r=F(A({},r),{width:t.width,height:t.height}),i=t.margin);var _this$props76=this.props,n=_this$props76.flipH,s=_this$props76.flipV,o=_this$props76.shapeGroupTransform,a=_this$props76.resourceType,l=!!n!==e.flipH,h=!!s!==e.flipV;return this.renderChildren({play:e.play,stop:e.stop,width:r.width,height:r.height,borderStyle:e.borderStyle,fillColor:e.fillColor,rotate:e.rotate,margin:i,shapeGroupTransform:o,flipH:l,flipV:h,resoureType:a})}},{key:"renderChildren",value:function renderChildren(e){var t=this.props.children;if(typeof t=="function"){var i=t(e);return i&&hr["default"].cloneElement(i,{ref:this.childrenRef})}else return hr["default"].cloneElement(t,{ref:this.childrenRef})}},{key:"render",value:function render(){var e;var t=this.state.soundEffectUrl,_this$getPositionAndS=this.getPositionAndSize(),i=_this$getPositionAndS.left,r=_this$getPositionAndS.top,n=_this$getPositionAndS.height,s=_this$getPositionAndS.width,o;this.shapeWrapperParams.hidden===!0&&(o="none");var a=(e=this.shapeWrapperParams.hyperLinkDestination)!=null?e:this.eventSourceId!==void 0,l=X(this.shapeWrapperParams.fillColor)!=="none"?(0,Hu["default"])(X(this.shapeWrapperParams.fillColor)):(0,Hu["default"])("#FFFFFF00"),h=l.hsl().array(),_this$props77=this.props,d=_this$props77.slideContext,u=_this$props77.zIndex;return hr["default"].createElement("div",{className:"spId-".concat(this.spId," ").concat(a?" ppt-event-source":""),id:bi(d.uuid,d.slideIndex,this.spId),ref:this.animeTarget,style:{position:"absolute",display:o,zIndex:u,left:i,top:r,width:s,height:n,transform:this.transform(this.shapeWrapperParams),opacity:1,backfaceVisibility:"hidden","--sp-fill-h":l&&h[0],"--sp-fill-s":l&&h[1]+"%","--sp-fill-l":l&&h[2]+"%","--sp-fill-a":l?l.alpha():0},onClick:a?this.onClick.bind(this,this.spId):this.emptyClick},t&&hr["default"].createElement("audio",{src:t,ref:this.player,controls:!1}),this.renderShape(this.shapeWrapperParams))}}]);return _u}(hr["default"].Component);function Ku(e,t,i,r){var n=e.childElementOptional("p:grpSpPr","a:xfrm"),s=0,o=0,a=0,l=0,h=1,d=1,u=1,p;e.extraAttr.getOptional("fillColor")&&(p=e.extraAttr.getColor("fillColor"),p instanceof Bl&&p.setFillColor(r.fillColor));var f=!1,m=!1,g=0,y,b={},v={x:0,y:0,width:t?t.slideWidth:0,height:t?t.slideHeight:0},w=0;if(n){var T=e.childElementOptional("p:grpSpPr","a:xfrm","a:chExt"),O=e.childElementOptional("p:grpSpPr","a:xfrm","a:ext"),R=e.childElementOptional("p:grpSpPr","a:xfrm","a:chOff");a=T?T.attr.getNumber("cx"):0,l=T?T.attr.getNumber("cy"):0,h=a===0||!O?1:O.attr.getNumber("cx")/a,h=Number.isNaN(h)?1:h,d=a===0||!O?1:O.attr.getNumber("cy")/l,d=Number.isNaN(d)?1:d,s=R?-R.attr.getNumber("x"):0,o=R?-R.attr.getNumber("y"):0,w=n.attr.getNumber("rot",0),g=w/Lt,f=n.attr.getBoolean("flipV",!1),m=n.attr.getBoolean("flipH",!1);var W=e.childElementOptional("p:grpSpPr","a:xfrm","a:off");v={x:W?W.attr.getNumber("x"):0,y:W?W.attr.getNumber("y"):0,width:O?O.attr.getNumber("cx"):0,height:O?O.attr.getNumber("cy"):0}}var M={translateX:s,translateY:o,scaleX:h,scaleY:d,rotate:g,fillColor:p},x=e.extraAttr.getBooleanOptional("hidden");return{rectangle:v,borderStyle:b,opacity:u,tailor:y,flipV:f,flipH:m,transform:M,parentGroupShapeId:i,fillColor:p,rotate:w,hidden:x}}var _l=/*#__PURE__*/function(_Ke$default$Component){_inherits(_l,_Ke$default$Component);var _super81=_createSuper(_l);function _l(e){var _this245;_classCallCheck(this,_l);_this245=_super81.call(this,e);_this245.animeTarget=Ke["default"].createRef(),_this245.eventSourceId=void 0,_this245.shapeWrappers=[],_this245.shapeMap=new zv(Ku),_this245.renderShape=function(s,o,a,l,h,d,u){var p=o.extraAttr.getString("spId"),f=p.replace("l","").replace("m",""),_this245$props=_this245.props,m=_this245$props.slideContext,g=_this245$props.interactiveSeqsKeys,y=_this245$props.onEventSourceClick,b=_this245$props.onHyperLinkClick,v=_this245$props.resourceType,w=_this245$props.uuid,M=_this245$props.wrapResource,x=_this245$props.animationManager,T=!1,O=o.childElementOptional(new Y("p:nvSpPr","p:nvCxnSpPr"));if(O&&(T=!!O.childElementOptional("p:nvPr","p:ph")),!(v!=="slide"&&T))return Ke["default"].createElement(_u,{key:"".concat(a),ref:function ref(R){return _this245.shapeWrappers.push(R)},shapeXML:o,slideContext:m,shapeGroupTransform:l,interactiveSeqsKeys:g,eventSourceId:_this245.eventSourceId,onEventSourceClick:y,onHyperLinkClick:b,zIndex:_this245.zIndex(s,o),resourceType:v,flipV:u,flipH:d},function(R){return Ke["default"].createElement(lM,{uuid:w,width:R.width,fillColor:R.fillColor,slideContext:m,height:R.height,slideIndex:m.slideIndex,groupFillColor:h.fillColor,borderStyle:R.borderStyle,shapeGroupTransform:R.shapeGroupTransform,shapeXML:o,resourceLoader:m.resourceLoader,resourceType:v,shapeWrapResource:M==null?void 0:M.shapes[f],withAnimation:x==null?void 0:x.withTextAnimation(p),flipV:R.flipV,flipH:R.flipH})})},_this245.renderPicture=function(s,o,a,l){var _this245$props2=_this245.props,h=_this245$props2.slideContext,d=_this245$props2.interactiveSeqsKeys,u=_this245$props2.onEventSourceClick,p=_this245$props2.onHyperLinkClick,f=_this245$props2.resourceType;return Ke["default"].createElement(_u,{key:"".concat(a),shapeXML:o,ref:function ref(m){return _this245.shapeWrappers.push(m)},slideContext:h,interactiveSeqsKeys:d,shapeGroupTransform:l,eventSourceId:_this245.eventSourceId,onEventSourceClick:u,onHyperLinkClick:p,zIndex:_this245.zIndex(s,o),resourceType:f},function(m){return _this245.renderPictureContent(o,m,h.resourceLoader,l)})},_this245.renderGraph=function(s,o,a,l){var h=o.extraAttr.getString("spId"),_this245$props3=_this245.props,d=_this245$props3.slideContext,u=_this245$props3.interactiveSeqsKeys,p=_this245$props3.onEventSourceClick,f=_this245$props3.onHyperLinkClick,m=_this245$props3.resourceType,g=_this245$props3.uuid,y=_this245$props3.wrapResource;return Ke["default"].createElement(_u,{key:"".concat(a),shapeXML:o,ref:function ref(b){return _this245.shapeWrappers.push(b)},slideContext:d,interactiveSeqsKeys:u,eventSourceId:_this245.eventSourceId,onEventSourceClick:p,onHyperLinkClick:f,zIndex:_this245.zIndex(s,o),resourceType:m,shapeGroupTransform:l},function(b){return Ke["default"].createElement(J2,{uuid:g,slideContext:d,width:b.width,height:b.height,rotate:b.rotate,borderStyle:b.borderStyle,fillColor:b.fillColor,key:"".concat(a),shapeGroupTransform:b.shapeGroupTransform,graphXML:o,shapeWrapResource:y==null?void 0:y.shapes[h],resourceType:b.resoureType})})},_this245.renderShapeGroup=function(s,o,a,l,h,d){var u=_this245.zIndex(s,o),_this245$props4=_this245.props,p=_this245$props4.uuid,f=_this245$props4.slideRef,m=_this245$props4.slideContext,g=_this245$props4.interactiveSeqsKeys,y=_this245$props4.resourceType,b=_this245$props4.onEventSourceClick,v=_this245$props4.onHyperLinkClick,w=_this245$props4.meidaStates,M=_this245$props4.disableAnimation,x=_this245$props4.onMediaChange,T=_this245$props4.onMediaPause,O=_this245$props4.onMediaPlay,R=_this245$props4.onMediaPlayError,W=_this245$props4.mediaSlideActionUserIds,J=_this245$props4.rtcClient,ee=_this245$props4.userId,z=_this245$props4.wrapResource;return Ke["default"].createElement(_l,{key:"".concat(a),uuid:p,slideRef:f,slideContext:m,zIndex:u,shapeGroupXML:o,interactiveSeqsKeys:g,eventSourceId:_this245.eventSourceId,resourceType:y,onEventSourceClick:b,onHyperLinkClick:v,shapeGroupTransform:l,flipH:h,flipV:d,meidaStates:w,disableAnimation:M,onMediaChange:x,onMediaPlay:O,onMediaPause:T,onMediaPlayError:R,userId:ee,mediaSlideActionUserIds:W,wrapResource:z,rtcClient:J})},_this245.state={soundEffectUrl:null};var _this245$props5=_this245.props,t=_this245$props5.shapeGroupXML,i=_this245$props5.onEventSourceClick,r=t.extraAttr.getString("spId");_this245.shapeId=r;var n=bi(e.slideContext.uuid,e.slideContext.slideIndex,r);e.interactiveSeqsKeys&&e.interactiveSeqsKeys.indexOf(n)!==-1&&i!==void 0&&(_this245.eventSourceId=n),_this245.player=Ke["default"].createRef();return _this245}_createClass(_l,[{key:"componentDidMount",value:function componentDidMount(){var _this246=this;var e=this.props.slideContext;window==null||window.addEventListener("message",function(t){t.data.type==="_playSoundEffect"&&t.data.targetID===bi(e.uuid,e.slideIndex,_this246.shapeId)&&_this246.playEffectSound(t.data.targetID,t.data.soundEffectId)})}},{key:"componentDidCatch",value:function componentDidCatch(e,t){var i=this.props.logger;i&&i.error("catch render error: ",e," stack: ",t.componentStack),this.setState({error:!0})}},{key:"transformWithShapeParams",value:function transformWithShapeParams(e,t){var i=t.translateX,r=t.translateY,n=e.flipH?-t.scaleX:t.scaleX,s=e.flipV?-t.scaleY:t.scaleY,o=0;return t.rotate&&typeof t.rotate=="number"&&(o=t.rotate),{translateX:i,translateY:r,scaleX:n,scaleY:s,rotate:o}}},{key:"transform",value:function transform(e){var t=this.props.shapeGroupTransform,i={translateX:0,translateY:0,scaleX:1,scaleY:1,rotate:0};t&&(i.rotate=t.rotate+i.rotate);var _this$transformWithSh2=this.transformWithShapeParams(e,i),r=_this$transformWithSh2.translateX,n=_this$transformWithSh2.translateY,s=_this$transformWithSh2.scaleX,o=_this$transformWithSh2.scaleY,a=_this$transformWithSh2.rotate;return"translate(".concat(E(r),", ").concat(E(n),") scale(").concat(s,",").concat(o,") rotate(").concat(gs(a)+e.transform.rotate,"deg)")}},{key:"updateAnimation",value:function updateAnimation(e){var t;((t=this.player)==null?void 0:t.current)&&(e.play===1&&e.stop===0?this.player.current.play().then(function(){},function(){}):e.play===0&&e.stop===1&&this.player.current.pause())}},{key:"playEffectSound",value:function playEffectSound(e,t){if(t!==void 0){var _this$props78=this.props,i=_this$props78.resourceType,_r141=_this$props78.slideContext;if(i==="slide"){var n=_r141.resourceLoader.loadURL(i,t);if(n){var s=document.getElementById("".concat(e));if(s){var o=document.createElement("audio");return o.id="".concat(e,"-").concat(t),o.onpause=function(){o.remove()},o.src=n,o.controls=!1,s.appendChild(o),o.play().then(function(){},function(){}),!0}}}}return!1}},{key:"parseMediaRef",value:function parseMediaRef(e,t){if(t){var i=this.props.resourceType,_r142=t.childElementOptional(new Y("a:videoFile","a:audioFile"));if(_r142){var n=_r142.name==="a:videoFile"?"video":"audio",s=_r142.attr.getString("r:link"),o=e.loadURL(i,s);if(o)return{resURL:o,mediaType:n};var a=t.childElementOptional("p:extLst","p:ext");if(a&&a.attr.getString("uri")==="{DAA4B4D4-6D71-4841-9C94-3DE7FCFB9230}"){var l=a.childElement("p14:media"),h=l.attr.getStringOptional("r:link"),d=l.attr.getStringOptional("r:embed"),u=h||d||"unknow";if(l.hasChildElementWithName("p14:trim")){var p=l.childElement("p14:trim"),f=p.attr.getNumberOptional("st"),m=p.attr.getNumberOptional("end");return f&&(f/=1e3),m&&(m/=1e3),{resURL:e.loadURL(i,u),mediaType:n,startTime:f,endTime:m}}else return{resURL:e.loadURL(i,u),mediaType:n}}}return}else return}},{key:"zIndex",value:function zIndex(e,t){var i=t.extraAttr.getStringOptional("spId");if(typeof i=="string"){var _r143=new aM(e).indexBySpId();if(i in _r143)return _r143[i]}return 999}},{key:"renderPictureContent",value:function renderPictureContent(e,_ref83,o,a){var t=_ref83.width,i=_ref83.height,r=_ref83.fillColor,n=_ref83.borderStyle,s=_ref83.margin;var l=e.childElementOptional("p:nvPicPr","p:nvPr"),h=e.childElement("p:nvPicPr","p:cNvPr").attr.getString("id"),d=this.parseMediaRef(o,l),u=e.childElementOptional("p:blipFill","a:blip"),p=0,f=e==null?void 0:e.childElementOptional("p:spPr","a:xfrm");if(f){var Je=f.attr.getNumber("rot",0);p=Number(Je)/Lt}var m,g,y=A({},s);if(a){var _Je=Vv(p,a),wt=_Je.scaleX,ki=_Je.scaleY;m=t*wt,g=i*ki,y.left*=wt,y.right*=wt,y.top*=ki,y.bottom*=ki}else m=t,g=i;var _this$props79=this.props,b=_this$props79.meidaStates,v=_this$props79.uuid,w=_this$props79.slideContext,M=_this$props79.logger,x=_this$props79.slideRef,T=_this$props79.pausing,O=_this$props79.disableAnimation,R=_this$props79.onMediaChange,W=_this$props79.onMediaPause,J=_this$props79.onMediaPlay,ee=_this$props79.onMediaPlayError,z=_this$props79.userId,Re=_this$props79.mediaSlideActionUserIds,Ht=_this$props79.rtcClient,Ne=_this$props79.resourceType,St=b?b[h]:void 0;if(d&&d.mediaType==="video")return Ke["default"].createElement(oM,{width:m,uuid:v,controllerProtalId:"netless-media-controller-portal-".concat(w.uuid),logger:M,slideRef:x,startTimePerfix:d.startTime?d.startTime:0,outsidePausing:T,height:g,fillColor:r,borderStyle:n,videoURL:d.resURL,shapeId:h,targetID:bi(w.uuid,w.slideIndex,h),mediaState:St,resourceLoader:o,disableAnimation:O,onMediaChange:R,onMediaPlay:J,onMediaPause:W,onMediaPlayError:ee,userId:z,mediaSlideActionUserIds:Re,rtcClient:Ht,mediaRef:d});if(d&&d.mediaType==="audio")return Ke["default"].createElement(rM,{width:m,controllerProtalId:"netless-media-controller-portal-".concat(w.uuid),logger:M,slideRef:x,startTimePerfix:d.startTime?d.startTime:0,outsidePausing:T,height:g,borderStyle:n,uuid:v,audioURL:d.resURL,shapeId:h,targetID:bi(w.uuid,w.slideIndex,h),mediaState:St,resourceLoader:o,disableAnimation:O,onMediaChange:R,onMediaPlay:J,onMediaPause:W,onMediaPlayError:ee,userId:z,mediaSlideActionUserIds:Re,rtcClient:Ht,mediaRef:d});if(u){var _Je2=u.attr.getStringOptional("r:embed");if(_Je2===void 0)return null;{var _wt=o.loadURL(Ne,_Je2),_ki;return h&&(_ki=o.loadURL(Ne,"spId".concat(h))),Ke["default"].createElement(sM,{width:m,uuid:w.uuid,logger:M,resourceType:Ne,resId:_Je2,height:g,slideIndex:w.slideIndex,fillColor:r,borderStyle:n,imageURL:_wt,margin:y,imageXML:e,preload:w.preload,spURL:_ki})}}else return null}},{key:"renderShapeGroupContent",value:function renderShapeGroupContent(e){var _this247=this;var _this$props80=this.props,t=_this$props80.shapeGroupXML,i=_this$props80.shapeGroupTransform,r=_this$props80.flipH,n=_this$props80.flipV,s=t.elementsWithName("p:sp"),o=t.elementsWithName("p:cxnSp"),a=t.elementsWithName("p:pic"),l=t.elementsWithName("p:graphicFrame"),h=t.elementsWithName("p:grpSp");t.elementsWithName("mc:AlternateContent").forEach(function(m){var g=m.childElementOptional("mc:Choice","p:graphicFrame");if(g)l.push(g);else{var y=m.childElementOptional("mc:Fallback","p:pic");y&&a.push(y)}});var d=A({},e.transform),u=i;u&&(d.rotate+=u.rotate,d.scaleX*=u.scaleX,d.scaleY*=u.scaleY);var p=!!r!==e.flipH,f=!!n!==e.flipV;return Ke["default"].createElement(Ke["default"].Fragment,null,s.map(function(m,g){return _this247.renderShape(t,m,g,d,e,p,f)}),o.map(function(m,g){return _this247.renderShape(t,m,g,d,e,p,f)}),a.map(function(m,g){return _this247.renderPicture(t,m,g,d)}),l.map(function(m,g){return _this247.renderGraph(t,m,g,d)}),h.map(function(m,g){return _this247.renderShapeGroup(t,m,g,d,p,f)}))}},{key:"render",value:function render(){this.shapeWrappers=[];var _this$state7=this.state,e=_this$state7.error,t=_this$state7.soundEffectUrl;if(e)return Ke["default"].createElement("div",{"data-reason":"render error"});var _this$props81=this.props,i=_this$props81.shapeGroupXML,r=_this$props81.slideContext,n=_this$props81.shapeGroupTransform,s=_this$props81.zIndex,o=this.shapeMap.map(i,r,n),a=i.extraAttr.getString("spId"),l,h,d,u;return n?(l=E((o.rectangle.x+n.translateX)*n.scaleX),h=E((o.rectangle.y+n.translateY)*n.scaleY),d=E(o.rectangle.width*n.scaleX),u=E(o.rectangle.height*n.scaleY)):(l=E(o.rectangle.x),h=E(o.rectangle.y),d=E(o.rectangle.width),u=E(o.rectangle.height)),Ke["default"].createElement("div",{ref:this.animeTarget,className:"spGoupId-"+a,id:bi(r.uuid,r.slideIndex,a),style:{position:"absolute",left:l,top:h,transform:this.transform(o),width:d,height:u,zIndex:s,opacity:o.opacity}},t&&Ke["default"].createElement("audio",{src:t,ref:this.player,controls:!1}),this.renderShapeGroupContent(o))}}]);return _l}(Ke["default"].Component),de="-1",hM="sequenceIndexes",dM="disableAutoPlay",uM="playLastStep",Kl;(function(e){e[e.Normal=0]="Normal",e[e.Preview=1]="Preview"})(Kl||(Kl={}));var dS=/*#__PURE__*/function(_lr$default$Component){_inherits(dS,_lr$default$Component);var _super82=_createSuper(dS);function dS(e){var _this248;_classCallCheck(this,dS);_this248=_super82.call(this,e);_this248.eventHub=new Mv["default"],_this248.isImageLoadFinished=!1,_this248.shapeGroupRef=lr["default"].createRef(),_this248.onHyperLinkClick=function(n,s){var o,a;var _this248$props=_this248.props,l=_this248$props.data,h=_this248$props.stateAdapter,d=_this248.getTurnToSlide(n,s);if(d){var u=d.match(/slide(\S*)/);u!==null&&((o=h==null?void 0:h.onPageJumpTo)==null||o.call(h,l.uuid,parseInt(u[1],10)))}typeof n=="number"&&((a=h==null?void 0:h.onPageJumpTo)==null||a.call(h,l.uuid,n))},_this248.onEventSourceClick=function(n){_this248.mainAnimationManager.interactiveSeqs.get(n)&&_this248.onMasterEventSourceClick(n)},_this248.onMediaPlay=function(n,s,o){window!==void 0&&window.postMessage({shapeId:n,mediaType:s,action:"play"},"*");var a=_this248.props.callbacks;a&&a.onMediaPlay&&a.onMediaPlay(n,s)},_this248.onMediaPause=function(n,s,o){var _this248$props2=_this248.props,a=_this248$props2.userId,l=_this248$props2.callbacks,h=_this248.state.mediaActionUserIds;a!==void 0&&h!==void 0&&h[_this248.currentSlideKey]!==void 0&&h[_this248.currentSlideKey][n]===a&&_this248.setMediaState({playing:!1,currentTime:o},n),window!==void 0&&window.postMessage({shapeId:n,mediaType:s,action:"pause"},"*"),l&&l.onMediaPause&&l.onMediaPause(n,s)},_this248.setMediaState=function(n,s){var _this248$props3=_this248.props,o=_this248$props3.pptState,a=_this248$props3.userId,l=_this248$props3.stateAdapter,h=_this248$props3.data,d,u;if(o===void 0||o.mediaStates===void 0)d=_defineProperty({},_this248.currentSlideKey,_defineProperty({},s,n)),a!==void 0&&(u=_defineProperty({},_this248.currentSlideKey,_defineProperty({},s,a)));else{var p=o.mediaStates[_this248.currentSlideKey];if(p===void 0?p=_defineProperty({},s,n):p[s]=n,a!==void 0){var f=_this248.state.mediaActionUserIds;f!==void 0?f[_this248.currentSlideKey]!==void 0?u=F(A({},f),_defineProperty({},_this248.currentSlideKey,F(A({},f[_this248.currentSlideKey]),_defineProperty({},s,a)))):u=F(A({},f),_defineProperty({},_this248.currentSlideKey,_defineProperty({},s,a))):u=_defineProperty({},_this248.currentSlideKey,_defineProperty({},s,a))}d=F(A({},o.mediaStates),_defineProperty({},_this248.currentSlideKey,p))}l.setState(h.uuid,h.index,F(A({},o),{mediaStates:d,mediaActionUserIds:u}))};var t,i;var r=e.data;_this248.preSlideIndex=(i=(t=e.pptState)==null?void 0:t.preSlideIndex)!=null?i:0,_this248.currentSlideKey="".concat(r.uuid,"-").concat(r.index),_this248.masterAnimationManager=r.animations.masterAnimationManager,_this248.layoutAnimationManager=r.animations.layoutAnimationManager,_this248.slideAnimationManager=r.animations.slideAnimationManager,_this248.mainAnimationManager=r.animations.mainAnimationManager,_this248.animationCount=r.animations.animationCount,_this248.initSlideStates(),_this248.masterInteractiveSeqsKeys=Array.from(_this248.masterAnimationManager.interactiveSeqs.keys()),_this248.layoutInteractiveSeqsKeys=Array.from(_this248.layoutAnimationManager.interactiveSeqs.keys()),_this248.slideInteractiveSeqsKeys=Array.from(_this248.slideAnimationManager.interactiveSeqs.keys()),_this248.slide=lr["default"].createRef(),_this248.isRenderMaster=e.data.layoutXML.childElement("p:sldLayout").attr.getBoolean("showMasterSp",!0),_this248.changeStep.bind(_assertThisInitialized(_this248)),ji.reset(_this248.eventHub);return _this248}_createClass(dS,[{key:"componentDidMount",value:function componentDidMount(){this.isImageLoadFinished=ji.endLoadTask("slideDidUpdate"),this.mainAnimationManager.animBoxes.forEach(function(s){return s.applyPreAnimation()});var e=this.getMainStepsFromSequences();this.mainAnimationManager.mainSeq.effectType!=="clickEffect"&&e===1?(this.mainAnimationManager.mainSeq.seekIndex(0),this.mainAnimationManager.mainSeq.play()):e&&this.mainAnimationManager.mainSeq.seekIndex(e);var t=this.state[this.currentSlideKey],i=t.sequenceSteps,r=t.layoutSequenceSteps,n=t.masterSequenceSteps;this.mainAnimationManager.interactiveSeqs.forEach(function(s,o){i&&i[o]?s.seekIndex(i[o]):r&&r[o]?s.seekIndex(r[o]):n&&n[o]?s.seekIndex(n[o]):s.seekIndex(0)})}},{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(e){var _this249=this;if(e.pptState!==void 0){var t=this.props.pptState;if(this.setState(e.pptState),!t||!t[this.currentSlideKey]){this.playAnime(t,e.pptState,this.mainAnimationManager.mainSeq,de),this.mainAnimationManager.interactiveSeqs.forEach(function(i,r){_this249.playAnime(t,e.pptState,i,r)});return}if(this.mainAnimationManager.interactiveSeqs.forEach(function(i,r){_this249.playAnime(t,e.pptState,i,r)}),!e.pptState[this.currentSlideKey])return;this.playAnime(t,e.pptState,this.mainAnimationManager.mainSeq,de)}}},{key:"componentDidUpdate",value:function componentDidUpdate(e,t){var _this250=this;var i=this.props.data;e.data.index!==i.index&&ji.endLoadTask("slideDidUpdate");var r=this.state[this.currentSlideKey],n=t[this.currentSlideKey];n!==void 0&&r===void 0&&(this.resetAnimation(),this.mainAnimationManager.mainSeq.seekIndex(0),setTimeout(function(){_this250.mainAnimationManager.mainSeq.effectType!=="clickEffect"&&_this250.mainAnimationManager.mainSeq.play();var s=_this250.initSlideAnimationState();e.stateAdapter.setState(i.uuid,i.index,A({},_this250.composeSlideStateIntoPPTState(s)))},80))}},{key:"componentDidCatch",value:function componentDidCatch(e){console.error("catched error: ",e);var _this$props82=this.props,t=_this$props82.data,i=_this$props82.userId;t.logger&&t.logger.error("catched ppt: ".concat(t.uuid,",\n                index: ").concat(t.index,", user: ").concat(i," render error : "),e)}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.masterAnimationManager.triggerEvent.emit("onUnmount",{target:"master"}),this.layoutAnimationManager.triggerEvent.emit("onUnmount",{target:"layout"}),this.slideAnimationManager.triggerEvent.emit("onUnmount",{target:"slide"}),this.mainAnimationManager.triggerEvent.emit("onUnmount",{target:"slide"})}},{key:"onPageToNext",value:function onPageToNext(){var e=this.props.stateAdapter;return this.setDisableAutoPlay(!1),this.pauseAllAnimation(!0),e.onPageToNext?e.onPageToNext():void 0}},{key:"onPageToPrev",value:function onPageToPrev(){var e=this.props.stateAdapter;return this.pauseAllAnimation(),e.onPageToPrev?e.onPageToPrev():void 0}},{key:"onMasterEventSourceClick",value:function onMasterEventSourceClick(e){var _this$composeSlideSta,_this251=this;var t=this.mainAnimationManager.interactiveSeqs.get(e),i=this.state[this.currentSlideKey],_this$props83=this.props,r=_this$props83.stateAdapter,n=_this$props83.data,s=i.masterSequenceSteps,o=i.layoutSequenceSteps,a=i.sequenceSteps,l=s[e],h="masterSequenceSteps",d=s;if(l===void 0&&(l=o[e],h="layoutSequenceSteps",d=o),l===void 0&&(l=a[e],h="sequenceSteps",d=a),l===void 0)return;var u;t!==void 0&&e!==de&&(l>t.length||l===t.length&&!t.isPlaying)?u=0:u=l+1,r.setState(n.uuid,n.index,this.composeSlideStateIntoPPTState((_this$composeSlideSta={},_defineProperty(_this$composeSlideSta,h,F(A({},d),_defineProperty({},e,u))),_defineProperty(_this$composeSlideSta,"hasChangeStep",!0),_this$composeSlideSta))),l!==0&&u===0&&setTimeout(function(){var _this251$composeSlide;r.setState(n.uuid,n.index,_this251.composeSlideStateIntoPPTState((_this251$composeSlide={},_defineProperty(_this251$composeSlide,h,F(A({},d),_defineProperty({},e,u+1))),_defineProperty(_this251$composeSlide,"hasChangeStep",!0),_this251$composeSlide)))},80)}},{key:"getTurnToSlide",value:function getTurnToSlide(e,t){var i=this.props.data,r=i.resourceLoader;if(t)return /m/.test(t)?r.resource.master[e]:/l/.test(t)?r.resource.layout[e]:r.resource.slide[e];var n=r.resource.master[e];return n||(n=r.resource.layout[e],n)||(n=r.resource.slide[e]),n}},{key:"getCurrentSequences",value:function getCurrentSequences(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!1;var _ref84=t!=null?t:this.state,r=_ref84[this.currentSlideKey];if(!r)return[void 0,"masterSequenceSteps"];var n=r.sequenceSteps,s=r.layoutSequenceSteps,o=r.masterSequenceSteps;if(typeof e=="number"){var _this$animationCount=this.animationCount,a=_this$animationCount.slide,l=_this$animationCount.layout,h=_this$animationCount.master;if(e<h||i&&e<=h)return[o,"masterSequenceSteps"];if(e<h+l||i&&e<=h+l)return[s,"layoutSequenceSteps"];if(e<h+l+a||i&&e<=h+l+a)return[n,"sequenceSteps"]}return o[e]!==void 0?[o,"masterSequenceSteps"]:s[e]!==void 0?[s,"layoutSequenceSteps"]:[n,"sequenceSteps"]}},{key:"getCurrentSequenceAnimationCount",value:function getCurrentSequenceAnimationCount(e){return e==="sequenceSteps"?this.animationCount.slide:e==="layoutSequenceSteps"?this.animationCount.layout:e==="masterSequenceSteps"?this.animationCount.master:0}},{key:"getMainStepsFromSequences",value:function getMainStepsFromSequences(e){var _ref85=e!=null?e:this.state,t=_ref85[this.currentSlideKey];if(!t)return;var i=t.sequenceSteps,r=t.layoutSequenceSteps,n=t.masterSequenceSteps,s=0;return n&&n[de]&&n[de]>0&&(s+=n[de]),r&&r[de]&&r[de]>0&&(s+=r[de]),i&&i[de]&&i[de]>0&&(s+=i[de]),s}},{key:"getSequencesByKey",value:function getSequencesByKey(e,t){var _ref86=t!=null?t:this.state,i=_ref86[this.currentSlideKey];if(!i)return[void 0,void 0];var r=i.sequenceSteps,n=i.layoutSequenceSteps,s=i.masterSequenceSteps;return r&&r[e]!==void 0?[r,"sequenceSteps"]:n&&n[e]!==void 0?[n,"layoutSequenceSteps"]:s&&s[e]!==void 0?[s,"masterSequenceSteps"]:[void 0,void 0]}},{key:"setDisableAutoPlay",value:function setDisableAutoPlay(e){var _this$props84=this.props,t=_this$props84.stateAdapter,i=_this$props84.data,r=this.state[this.currentSlideKey],n=r.masterSequenceSteps,s=r.layoutSequenceSteps,o=r.sequenceSteps;t.setState(i.uuid,i.index,this.composeSlideStateIntoPPTState({masterSequenceSteps:n,layoutSequenceSteps:s,sequenceSteps:o},e))}},{key:"pauseAllAnimation",value:function pauseAllAnimation(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!1;if(this.mainAnimationManager.mainSeq.pause(),e){var _this$animationCount2=this.animationCount,i=_this$animationCount2.slide,_r144=_this$animationCount2.layout,n=_this$animationCount2.master;this.mainAnimationManager.mainSeq.seekIndex(i+_r144+n)}var t=this.getMainStepsFromSequences();t&&this.mainAnimationManager.mainSeq.seekIndex(t),this.mainAnimationManager.interactiveSeqs.forEach(function(i){return i.pause()})}},{key:"initSlideAnimationState",value:function initSlideAnimationState(){var e=_defineProperty({},de,0),t=_defineProperty({},de,0),i=_defineProperty({},de,0),r=!1,n=!1;return this.animationCount.master>0&&this.masterAnimationManager.mainSeq.effectType!=="clickEffect"&&(i[de]=1,r=!0),this.masterAnimationManager.interactiveSeqs.forEach(function(s,o){i[o]=0}),this.animationCount.layout>0&&this.layoutAnimationManager.mainSeq.effectType!=="clickEffect"&&!r&&(t[de]=1,n=!0),this.layoutAnimationManager.interactiveSeqs.forEach(function(s,o){t[o]=0}),this.animationCount.slide>0&&this.slideAnimationManager.mainSeq.effectType!=="clickEffect"&&!r&&!n&&(e[de]=1),this.slideAnimationManager.interactiveSeqs.forEach(function(s,o){e[o]=0}),{masterSequenceSteps:i,layoutSequenceSteps:t,sequenceSteps:e,hasChangeStep:!1}}},{key:"initSlideStates",value:function initSlideStates(){var e,t;var i=this.initSlideAnimationState(),r=i.hasChangeStep,n=i.sequenceSteps,s=i.layoutSequenceSteps,o=i.masterSequenceSteps,a=this.props.pptState,l={};a!==void 0&&(l=a);var h=l[this.currentSlideKey];h&&(o=(e=h.masterSequenceSteps)!=null?e:o,s=(t=h.layoutSequenceSteps)!=null?t:s,n=h.sequenceSteps),this.state=A({},this.composeSlideStateIntoPPTState({masterSequenceSteps:o,layoutSequenceSteps:s,sequenceSteps:n,hasChangeStep:r}))}},{key:"composeSlideStateIntoPPTState",value:function composeSlideStateIntoPPTState(e,t){var _F7,_F8,_F9;var _this$props85=this.props,i=_this$props85.pptState,r=_this$props85.data;if(!this.state)return F(A({},i),(_F7={},_defineProperty(_F7,this.currentSlideKey,A({},e)),_defineProperty(_F7,"uuid",r.uuid),_defineProperty(_F7,"pageIndex",r.index),_F7));var n=this.state[this.currentSlideKey];return t!==void 0?F(A({},i),(_F8={},_defineProperty(_F8,this.currentSlideKey,A(A({},n),e)),_defineProperty(_F8,"uuid",r.uuid),_defineProperty(_F8,"pageIndex",r.index),_defineProperty(_F8,"disableAutoPlay",t),_F8)):F(A({},i),(_F9={},_defineProperty(_F9,this.currentSlideKey,A(A({},n),e)),_defineProperty(_F9,"uuid",r.uuid),_defineProperty(_F9,"pageIndex",r.index),_F9))}},{key:"playAnime",value:function playAnime(e,t,i,r){var n;var s,o;if(r===de)s=this.getMainStepsFromSequences(e),o=this.getMainStepsFromSequences(t);else{var _this$getSequencesByK=this.getSequencesByKey(r,e),_this$getSequencesByK2=_slicedToArray(_this$getSequencesByK,1),a=_this$getSequencesByK2[0],_this$getSequencesByK3=this.getSequencesByKey(r,t),_this$getSequencesByK4=_slicedToArray(_this$getSequencesByK3,1),l=_this$getSequencesByK4[0];a&&(s=a[r]),l&&(o=l[r])}if(s!==o)if(o){if(o!==s)if(s===-1)i.seekIndex(((n=this.slideAnimationManager.mainSeq)==null?void 0:n.length)||0);else if(o<=i.length&&o>=0){var _a28=o-(s||0);_a28>0?((i.index===o-2&&i.isPlaying||_a28>1)&&i.seekIndex(o-1),i.play()):_a28<0&&(i.pause(),i.seekIndex(o))}else o>i.length&&(i.pause(),i.seekIndex(i.length))}else i.pause(),i.seekIndex(0)}},{key:"resetAnimationSteps",value:function resetAnimationSteps(){var e={},t={},i={};return this.masterAnimationManager.interactiveSeqs.forEach(function(r,n){i[n]=0}),i[de]=0,this.layoutAnimationManager.interactiveSeqs.forEach(function(r,n){t[n]=0}),t[de]=0,this.masterAnimationManager.interactiveSeqs.forEach(function(r,n){e[n]=0}),e[de]=0,{sequenceSteps:e,layoutSequenceSteps:t,masterSequenceSteps:i,hasChangeStep:!1}}},{key:"resetAnimation",value:function resetAnimation(){var _this$props86=this.props,e=_this$props86.stateAdapter,t=_this$props86.data,i=this.resetAnimationSteps(),r=F(A({},this.state),_defineProperty({},this.currentSlideKey,i));e.setState(t.uuid,t.index,r)}},{key:"resetCurrentSlideAnimation",value:function resetCurrentSlideAnimation(){var _this$props87=this.props,e=_this$props87.stateAdapter,t=_this$props87.data,i=F(A({},this.state),_defineProperty({},this.currentSlideKey,void 0));e.setState(t.uuid,t.index,i)}},{key:"resetCurrentPPTAnimation",value:function resetCurrentPPTAnimation(){var _this252=this;var _this$state8=this.state,e=_this$state8.disableAutoPlay,t=_this$state8.pageIndex,i=_this$state8.playLastStep,r=_this$state8.progressIndex,n=_this$state8.uuid,s=_this$state8[this.currentSlideKey];if(!s)return;var _this$props88=this.props,o=_this$props88.data,a=_this$props88.stateAdapter,l=_this$props88.pptState,h=l.preSlideIndex,d={disableAutoPlay:e,pageIndex:t,playLastStep:i,progressIndex:r,uuid:n,preSlideIndex:h},u=Object.keys(this.state).filter(function(f){return f.includes(o.uuid)}).map(function(f){var m=_this252.state[f];return A({key:f},m)}),p={};u.forEach(function(f){var m=f.key;p[m]=void 0}),d=A(A({},d),p),a.setState(o.uuid,o.index,d)}},{key:"toNextPage",value:function toNextPage(){var e=this.props.stateAdapter;e.onPageToNext&&e.onPageToNext()}},{key:"toPrevPage",value:function toPrevPage(){var e=this.props.stateAdapter;e.onPageToPrev&&e.onPageToPrev()}},{key:"changeStep",value:function changeStep(e){var _this$composeSlideSta2,_this$composeSlideSta3;var _this$props89=this.props,t=_this$props89.stateAdapter,i=_this$props89.data,r=this.getMainStepsFromSequences(),_this$getCurrentSeque=this.getCurrentSequences(r!=null?r:1,void 0,e<0),_this$getCurrentSeque2=_slicedToArray(_this$getCurrentSeque,2),n=_this$getCurrentSeque2[0],s=_this$getCurrentSeque2[1];if(n===void 0||s===void 0)return;var o=n[de];if(o===void 0||this.mainAnimationManager.mainSeq.length===0){e>0?this.onPageToNext():e<0&&this.onPageToPrev();return}o<0&&(this.masterAnimationManager.triggerEvent.emit("onEnd",{target:"slide"}),o=this.mainAnimationManager.mainSeq.length);var a=o+e;a<0?this.onPageToPrev():a>this.getCurrentSequenceAnimationCount(s)?this.onPageToNext():o===1&&a===0?t.setState(i.uuid,i.index,A({},this.composeSlideStateIntoPPTState((_this$composeSlideSta2={},_defineProperty(_this$composeSlideSta2,s,F(A({},n),_defineProperty({},de,a))),_defineProperty(_this$composeSlideSta2,"hasChangeStep",!0),_this$composeSlideSta2),!0))):t.setState(i.uuid,i.index,A({},this.composeSlideStateIntoPPTState((_this$composeSlideSta3={},_defineProperty(_this$composeSlideSta3,s,F(A({},n),_defineProperty({},de,a))),_defineProperty(_this$composeSlideSta3,"hasChangeStep",!0),_this$composeSlideSta3))))}},{key:"renderMediaControllerPortal",value:function renderMediaControllerPortal(e){var t=this.props.renderMode;return t===0?lr["default"].createElement("div",{id:"netless-media-controller-portal-".concat(e.uuid),style:{position:"absolute",zIndex:1e3}}):null}},{key:"render",value:function render(){var e,t,i,r,n,s,o;var _this$props90=this.props,a=_this$props90.disableAnimation,l=_this$props90.renderMode,h=_this$props90.className,d=_this$props90.data,u=_this$props90.pausing,p=_this$props90.userId,f=_this$props90.callbacks,m=_this$props90.pptState,g=d.slideXML.childElement("p:sld","p:cSld","p:spTree"),y=d.masterXML.childElement("p:sldMaster","p:cSld","p:spTree"),b=d.layoutXML.childElement("p:sldLayout","p:cSld","p:spTree"),v=d.slideXML.childElement("p:sld","p:cSld"),w={uuid:d.uuid,resourceLoader:d.resourceLoader,slideWidth:d.width,slideHeight:d.height,preSlideIndex:this.preSlideIndex,slideIndex:d.index+1,preload:d.preload,slideCount:d.slidesCount},M=a;l!==void 0&&l===1&&(M=!0);var x=(e=m==null?void 0:m.mediaStates)==null?void 0:e[this.currentSlideKey];return lr["default"].createElement(r2,{className:h,slideContext:w,slideRef:this.slide,cSld:v,resourceLoader:d.resourceLoader},this.renderMediaControllerPortal(d),this.isRenderMaster&&lr["default"].createElement(_l,{uuid:d.uuid,logger:d.logger,slideRef:this.slide,slideContext:w,shapeGroupXML:y,resourceType:"master",disableAnimation:M,zIndex:0,wrapResource:(t=d.WrapResource)==null?void 0:t.master,ref:this.shapeGroupRef,pausing:u,userId:p,interactiveSeqsKeys:this.masterInteractiveSeqsKeys||[],onEventSourceClick:this.onEventSourceClick,onHyperLinkClick:this.onHyperLinkClick,meidaStates:x,mediaSlideActionUserIds:(i=m==null?void 0:m.mediaActionUserIds)==null?void 0:i[this.currentSlideKey],onMediaChange:this.setMediaState,onMediaPlay:this.onMediaPlay,onMediaPlayError:f?f.onMediaPlayError:void 0,onMediaPause:this.onMediaPause,rtcClient:d.rtcClient,animationManager:this.masterAnimationManager}),lr["default"].createElement(_l,{uuid:d.uuid,logger:d.logger,slideRef:this.slide,slideContext:w,shapeGroupXML:b,resourceType:"layout",disableAnimation:M,zIndex:1,wrapResource:(r=d.WrapResource)==null?void 0:r.layout,ref:this.shapeGroupRef,pausing:u,userId:p,interactiveSeqsKeys:this.layoutInteractiveSeqsKeys||[],onEventSourceClick:this.onEventSourceClick,onHyperLinkClick:this.onHyperLinkClick,meidaStates:x,mediaSlideActionUserIds:(n=m==null?void 0:m.mediaActionUserIds)==null?void 0:n[this.currentSlideKey],onMediaChange:this.setMediaState,onMediaPlay:this.onMediaPlay,onMediaPlayError:f?f.onMediaPlayError:void 0,onMediaPause:this.onMediaPause,rtcClient:d.rtcClient,animationManager:this.layoutAnimationManager}),lr["default"].createElement(_l,{uuid:d.uuid,ref:this.shapeGroupRef,shapeGroupXML:g,pausing:u,userId:p,logger:d.logger,slideRef:this.slide,slideContext:w,resourceType:"slide",interactiveSeqsKeys:this.slideInteractiveSeqsKeys||[],zIndex:2,onEventSourceClick:this.onEventSourceClick,onHyperLinkClick:this.onHyperLinkClick,meidaStates:x,mediaSlideActionUserIds:(s=m==null?void 0:m.mediaActionUserIds)==null?void 0:s[this.currentSlideKey],disableAnimation:M,onMediaChange:this.setMediaState,onMediaPlay:this.onMediaPlay,onMediaPlayError:f?f.onMediaPlayError:void 0,onMediaPause:this.onMediaPause,rtcClient:d.rtcClient,wrapResource:(o=d.WrapResource)==null?void 0:o.slide,animationManager:this.slideAnimationManager}))}}]);return dS}(lr["default"].Component);function uS(e,t){var i={},r={},n={};var _iterator201=_createForOfIteratorHelper(e.elements),_step201;try{for(_iterator201.s();!(_step201=_iterator201.n()).done;){var s=_step201.value;var o=s.childElementOptional(new Y("p:nvSpPr","p:nvCxnSpPr"));if(o){var a=o.childElement("p:cNvPr").attr.getStringOptional("id"),l=o.childElementOptional("p:nvPr","p:ph"),h=l&&l.attr.getStringOptional("idx"),d=l&&l.attr.getStringOptional("type");a!==void 0&&(i[a]=s),h!==void 0?r[h]=s:(d==="title"||d==="ctrTitle")&&(r[0]=s),d==="title"||d==="ctrTitle"?(n.title=s,n.ctrTitle=s):d!==void 0&&(n[d]=s)}}}catch(err){_iterator201.e(err)}finally{_iterator201.f()}return Object.freeze(t?{idIndex:Object.freeze(i),idxIndex:Object.freeze(r),typeIndex:Object.freeze(n),txStyle:Object.freeze(pM(t))}:{idIndex:Object.freeze(i),idxIndex:Object.freeze(r),typeIndex:Object.freeze(n)})}function pM(e){var t={},i=e.elementWithName("p:bodyStyle");i&&(t.body=i);var r=e.elementWithName("p:titleStyle");r&&(t.title=r,t.subTitle=r,t.ctrTitle=r);var n=e.elementWithName("p:otherStyle");return n&&(t.other=n),t}var mM=/*#__PURE__*/function(){function mM(e,t){_classCallCheck(this,mM);this.resource=e,this.resourceScheme=t}_createClass(mM,[{key:"loadURL",value:function loadURL(e,t){var i=this.resource[e]&&this.resource[e][t];return typeof i=="undefined"||(i=this.replaceProtocolByresourceScheme(i)),i}},{key:"replaceProtocolByresourceScheme",value:function replaceProtocolByresourceScheme(e){var t=e;return this.resourceScheme&&(t=t.replace(/^[a-zA-z]+[^://]/,this.resourceScheme)),t}}]);return mM}();function fM(e){e.bindAttributePicker("a:p","*",vM),e.bindAttributePicker("a:p","indent",pS(-342900,0)),e.bindAttributePicker("a:p","marL",pS(342900,0)),e.bindAttributePicker("a:p","level",SM),e.bindAttributePicker("a:bodyPr","*",gM),e.bindAttributePicker(["a:r","a:br","a:endParaRPr","a:fld"],"*",Gu),e.bindAttributePicker(["a:r","a:br","a:endParaRPr","a:fld","a:p"],"sz",kM),e.bindAttributePicker(["a:r"],"highlight",CM),e.bindAttributePicker(["a:r","a:fld"],"color",IM),e.bindAttributePicker(["a:r","a:fld"],"fontType",MM),e.bindAttributePicker("a:p","placeHolderType",TM),e.bindChildPicker("a:p","bu",EM),e.bindAttributePicker("a:p","buClr",AM),e.bindAttributePicker("a:p","lineHeight",RM),e.bindAttributePicker("a:p",["a:spcBef","a:spcAft"],NM)}var gM=function gM(e,t,i,r,n){var _yM=yM(e,t,r,n),s=_yM.pPrXMLList;var _iterator202=_createForOfIteratorHelper(s),_step202;try{for(_iterator202.s();!(_step202=_iterator202.n()).done;){var o=_step202.value;var a=o.attr.getOptional(i);if(a!==void 0)return a}}catch(err){_iterator202.e(err)}finally{_iterator202.f()}};function yM(e,t,i,r){var n=i.bodyPrXMlList;return n||(n=i.bodyPrXMlList=Object.freeze(bM(e,t,r))),n}function bM(e,t,i){var r=[],n=e.parentElement(new Y("p:sp","p:graphicFrame")),_Wr4=Wr(n,t,i),s=_Wr4.allShape,o=_Wr4.hasPlaceHolder;var _iterator203=_createForOfIteratorHelper(s),_step203;try{for(_iterator203.s();!(_step203=_iterator203.n()).done;){var a=_step203.value;var l=a.childElementOptional("p:txBody","a:bodyPr");l&&r.push(l)}}catch(err){_iterator203.e(err)}finally{_iterator203.f()}return{pPrXMLList:r,hasPlaceHolder:o}}var vM=function vM(e,t,i,r,n){var _kn=kn(e,t,r,n),s=_kn.pPrXMLList;var _iterator204=_createForOfIteratorHelper(s),_step204;try{for(_iterator204.s();!(_step204=_iterator204.n()).done;){var o=_step204.value;var a=o.attr.getOptional(i);if(a!==void 0)return a}}catch(err){_iterator204.e(err)}finally{_iterator204.f()}},pS=function pS(e,t){return function(i,r,n,s,o){var _kn2=kn(i,r,s,o),a=_kn2.pPrXMLList,l=_kn2.hasPlaceHolder;var _iterator205=_createForOfIteratorHelper(a),_step205;try{for(_iterator205.s();!(_step205=_iterator205.n()).done;){var h=_step205.value;var d=h.attr.getOptional(n);if(d!==void 0)return d}}catch(err){_iterator205.e(err)}finally{_iterator205.f()}return l?e:t}},SM=function SM(e,t,i,r,n){return kn(e,t,r,n).level};function kn(e,t,i,r){var n=i.pPrXMlList;return n||(n=i.pPrXMlList=Object.freeze(wM(e,t,r))),n}function wM(e,t,i){var r=[],n=e.parentElement(new Y("p:sp","p:graphicFrame")),s=e.childElementOptional("a:pPr"),o=0;s&&(r.push(s),o=s.attr.getNumber("lvl",0));var a="a:lvl".concat(o+1,"pPr"),_Wr5=Wr(n,t,i),l=_Wr5.allShape,h=_Wr5.placeHolderType,d=_Wr5.masterStyleXML,u=_Wr5.hasPlaceHolder;var _iterator206=_createForOfIteratorHelper(l),_step206;try{for(_iterator206.s();!(_step206=_iterator206.n()).done;){var _p16=_step206.value;var f=_p16.childElementOptional("p:txBody","a:lstStyle",a);f&&r.push(f)}}catch(err){_iterator206.e(err)}finally{_iterator206.f()}if(d){var p=d.childElementOptional(a);p&&r.push(p)}return{pPrXMLList:r,placeHolderType:h,level:o,hasPlaceHolder:u}}var Gu=function Gu(e,t,i,r,n){var _$u=$u(e,t,r,n),s=_$u.pPrXMLList;var _iterator207=_createForOfIteratorHelper(s),_step207;try{for(_iterator207.s();!(_step207=_iterator207.n()).done;){var o=_step207.value;var a=o.attr.getOptional(i);if(a!==void 0)return a}}catch(err){_iterator207.e(err)}finally{_iterator207.f()}},CM=function CM(e,t){var i=e.childElementOptional("a:rPr","a:highlight",_construct(Y,Fi));if(i)return vn(i,t)},kM=function kM(e,t,i,r,n){var s=Gu(e,t,"sz",r,n),o=Gu(e,t,"kern",r,n);return s||o};function $u(e,t,i,r){var n=i.rangeXMlList;return n||(n=i.rangeXMlList=Object.freeze(xM(e,t,r))),n}function xM(e,t,i){var r=e.elementWithName("a:rPr"),n;e.name==="a:p"?n=e:n=e.parentElement("a:p");var _PM=PM(n,t,i),s=_PM.placeHolderType,o=_PM.pPrXMLList,a=_PM.level,l=_PM.hasPlaceHolder;return r?{placeHolderType:s,pPrXMLList:[e,r].concat(_toConsumableArray(o)),level:a,hasPlaceHolder:l}:{placeHolderType:s,pPrXMLList:[e].concat(_toConsumableArray(o)),level:a,hasPlaceHolder:l}}function PM(e,t,i){var r=[],n=e.parentElement(new Y("p:sp","p:graphicFrame")),s=e.childElementOptional("a:pPr"),o=0;if(s){o=s.attr.getNumber("lvl",0);var p=s.childElementOptional("a:defRPr");p&&r.push(p)}var a="a:lvl".concat(o+1,"pPr"),_Wr6=Wr(n,t,i),l=_Wr6.allShape,h=_Wr6.placeHolderType,d=_Wr6.masterStyleXML,u=_Wr6.hasPlaceHolder;var _iterator208=_createForOfIteratorHelper(l),_step208;try{for(_iterator208.s();!(_step208=_iterator208.n()).done;){var _p18=_step208.value;var f=_p18.childElementOptional("p:txBody","a:lstStyle",a,"a:defRPr");f&&r.push(f);var m=_p18.childElementOptional("p:style");if(m){var g=Mu(m,t);r.push(g.font.fontRef),g.font.xml&&r.push(g.font.xml)}}}catch(err){_iterator208.e(err)}finally{_iterator208.f()}if(d){var _p17=d.childElementOptional(a,"a:defRPr");_p17&&r.push(_p17)}return{pPrXMLList:r,placeHolderType:h,level:o,hasPlaceHolder:u}}var IM=function IM(e,t,i,r,n){var _$u2=$u(e,t,r,n),s=_$u2.pPrXMLList;var _iterator209=_createForOfIteratorHelper(s),_step209;try{for(_iterator209.s();!(_step209=_iterator209.n()).done;){var o=_step209.value;var a=o.childElementOptional(_construct(Y,Ss));if(a)return new zr().read(a,t);var l=o.childElementOptional(_construct(Y,Fi));if(l)return vn(l,t)}}catch(err){_iterator209.e(err)}finally{_iterator209.f()}},MM=function MM(e,t,i,r,n){var s=$u(e,t,r,n),o=s.pPrXMLList,a=[];var _iterator210=_createForOfIteratorHelper(o),_step210;try{for(_iterator210.s();!(_step210=_iterator210.n()).done;){var u=_step210.value;var p=u.childElementOptional("a:latin"),f=u.childElementOptional("a:ea");if(p){var m=p.attr.getOptional("typeface");typeof m=="string"&&a.push(m)}if(f){var _m27=f.attr.getOptional("typeface");typeof _m27=="string"&&a.push(_m27)}}}catch(err){_iterator210.e(err)}finally{_iterator210.f()}N2(s.placeHolderType)?a=a.concat(Iu(Bv(t))):a=a.concat(Iu(Fv(t))),a=a.filter(function(u){return u!==""});var l=[],h=Bv(t),d=Fv(t);return a.forEach(function(u){switch(u){case"+mj-lt":{l=h.latin?l.concat(h.latin):l;break}case"+mj-ea":{l=h.ea?l.concat(h.ea):l;break}case"+mj-cs":{l=h.cs?l.concat(h.cs):l;break}case"+mn-lt":{l=d.latin?l.concat(d.latin):l;break}case"+mn-ea":{l=d.ea?l.concat(d.ea):l;break}case"+mn-cs":{l=h.cs?l.concat(h.cs):l;break}default:{l.push(u);break}}}),l.forEach(function(u){Lv(u,t.userFonts).then(function(){},function(){})}),l.join(",")},TM=function TM(e){var t=e.parentElement(new Y("p:sp","p:graphicFrame")).childElementOptional(new Y("p:nvSpPr","p:nvCxnSpPr"));return t&&t.childElementOptional("p:nvPr","p:ph")?"true":"false"},EM=function EM(e,t,i,r,n){var _kn3=kn(e,t,r,n),s=_kn3.pPrXMLList;var _iterator211=_createForOfIteratorHelper(s),_step211;try{for(_iterator211.s();!(_step211=_iterator211.n()).done;){var o=_step211.value;var a=o.childElementOptional(new Y("a:buChar","a:buNone","a:buAutoNum","a:buBlip"));if(a!==void 0)return a}}catch(err){_iterator211.e(err)}finally{_iterator211.f()}},AM=function AM(e,t,i,r,n){var _kn4=kn(e,t,r,n),s=_kn4.pPrXMLList;var _iterator212=_createForOfIteratorHelper(s),_step212;try{for(_iterator212.s();!(_step212=_iterator212.n()).done;){var o=_step212.value;var a=o.childElementOptional("a:buClr");if(a)return vn(a.childElement(_construct(Y,Fi)),t)}}catch(err){_iterator212.e(err)}finally{_iterator212.f()}};function OM(e){var t=e.childElementOptional("a:lnSpc",new Y("a:spcPct","a:spcPts"));if(t){var i=0,_r145=e.parentElementOptional("p:txBody");if(_r145){var n=_r145.childElementOptional("a:bodyPr","a:normAutofit");n&&(i=Te(n.attr.getNumber("lnSpcReduction",0)))}switch(t.name){case"a:spcPct":return Te(t.attr.getString("val"))*1.2-i;case"a:spcPts":return"".concat(t.attr.getNumber("val")/100*(1-i),"pt");default:return;}}else return}var RM=function RM(e,t,i,r,n){var _kn5=kn(e,t,r,n),s=_kn5.pPrXMLList;var _iterator213=_createForOfIteratorHelper(s),_step213;try{for(_iterator213.s();!(_step213=_iterator213.n()).done;){var o=_step213.value;var a=OM(o);if(a!==void 0)return a}}catch(err){_iterator213.e(err)}finally{_iterator213.f()}return $I},NM=function NM(e,t,i,r,n){var _kn6=kn(e,t,r,n),s=_kn6.pPrXMLList;var _iterator214=_createForOfIteratorHelper(s),_step214;try{for(_iterator214.s();!(_step214=_iterator214.n()).done;){var o=_step214.value;var a=LM(o,i);if(a!==void 0)return a}}catch(err){_iterator214.e(err)}finally{_iterator214.f()}};function LM(e,t){var i=e.childElementOptional(t,new Y("a:spcPct","a:spcPts"));if(i)switch(i.name){case"a:spcPct":return Te(i.attr.getString("val"));case"a:spcPts":return"".concat(i.attr.getNumber("val")/100,"pt");default:return;}else return}function DM(e){e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"x",function(t,i,r,n,s){var o=mS(t,i,s);return o?o.attr.getOptional("x"):0}),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"y",function(t,i,r,n,s){var o=mS(t,i,s);return o?o.attr.getOptional("y"):0}),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"width",function(t,i,r,n,s){var o=fS(t,i,s);return o?o.attr.getOptional("cx"):0}),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"height",function(t,i,r,n,s){var o=fS(t,i,s);return o?o.attr.getOptional("cy"):0}),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"flipV",function(t,i){var r=Vo(t,i,"slide");return r===void 0?"false":r.attr.getOptional("flipV")?r.attr.getOptional("flipV"):"false"}),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"flipH",function(t,i){var r=Vo(t,i,"slide");return r===void 0?"false":r.attr.getOptional("flipH")?r.attr.getOptional("flipH"):"false"}),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"hidden",function(t){var i=t.childElementOptional(new Y("p:nvGraphicFramePr","p:nvSpPr","p:nvCxnSpPr","p:nvPicPr"),"p:cNvPr");return i?i.attr.get("hidden","false"):"false"}),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp"],"rot",function(t,i){var r=Vo(t,i,"slide");return r?r.attr.getOptional("rot"):0})}function mS(e,t,i){var _Wr7=Wr(e,t,i),r=_Wr7.allShape;var _iterator215=_createForOfIteratorHelper(r),_step215;try{for(_iterator215.s();!(_step215=_iterator215.n()).done;){var s=_step215.value;var o=s.childElementOptional("p:spPr","a:xfrm","a:off");if(o!==void 0||(o=s.childElementOptional("p:xfrm","a:off"),o!==void 0))return o}}catch(err){_iterator215.e(err)}finally{_iterator215.f()}var n=Vo(e,t,i);return n&&n.childElementOptional("a:off")}function fS(e,t,i){var _Wr8=Wr(e,t,i),r=_Wr8.allShape;var _iterator216=_createForOfIteratorHelper(r),_step216;try{for(_iterator216.s();!(_step216=_iterator216.n()).done;){var s=_step216.value;var o=s.childElementOptional("p:spPr","a:xfrm","a:ext");if(o!==void 0||(o=s.childElementOptional("p:xfrm","a:ext"),o!==void 0))return o}}catch(err){_iterator216.e(err)}finally{_iterator216.f()}var n=Vo(e,t,i);return n&&n.childElementOptional("a:ext")}function Vo(e,t,i){var r;if(i!=="slide")return;var n=e.childElementOptional("p:spPr","a:xfrm");if(n)return n;var s=(r=e.childElementOptional("p:nvPicPr","p:nvPr","p:ph"))==null?void 0:r.attr.getStringOptional("idx");if(!s)return;var o=t.layoutIndex.idxIndex[s];if(o)return o.childElementOptional("p:spPr","a:xfrm");var a=t.masterIndex.idxIndex[s];if(a)return a.childElementOptional("p:spPr","a:xfrm")}var Yu=["\u65E0\u6837\u5F0F\uFF0C\u65E0\u7F51\u683C","styleName","wholeTbl","tcTxStyle","fontRef","minor","idx","scrgbClr","0","r","g","b","schemeClr","tx1","val","\u65E0\u6837\u5F0F\uFF0C\u7F51\u683C\u578B","tcStyle","tcBdr","left","ln","12700","w","sng","cmpd","solidFill","right","top","bottom","insideH","insideV","\u4E3B\u9898\u6837\u5F0F 1 - \u5F3A\u8C03 1","tblBg","fillRef","2","accent1","effectRef","1","dk1","lnRef","band1H","fill","alpha","40000","band1V","lastCol","on","firstCol","lastRow","firstRow","lt1","\u4E3B\u9898\u6837\u5F0F 1 - \u5F3A\u8C03 2","accent2","\u4E3B\u9898\u6837\u5F0F 1 - \u5F3A\u8C03 3","accent3","\u4E3B\u9898\u6837\u5F0F 1 - \u5F3A\u8C03 4","accent4","\u4E3B\u9898\u6837\u5F0F 1 - \u5F3A\u8C03 5","accent5","\u4E3B\u9898\u6837\u5F0F 1 - \u5F3A\u8C03 6","accent6","\u4E3B\u9898\u6837\u5F0F 2 - \u5F3A\u8C03 1","3","tint","50000","20000","\u4E3B\u9898\u6837\u5F0F 2 - \u5F3A\u8C03 2","\u4E3B\u9898\u6837\u5F0F 2 - \u5F3A\u8C03 3","\u4E3B\u9898\u6837\u5F0F 2 - \u5F3A\u8C03 4","\u4E3B\u9898\u6837\u5F0F 2 - \u5F3A\u8C03 5","\u4E3B\u9898\u6837\u5F0F 2 - \u5F3A\u8C03 6","\u6D45\u8272\u6837\u5F0F 1","\u6D45\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 1","\u6D45\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 2","\u6D45\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 3","\u6D45\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 4","\u6D45\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 5","\u6D45\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 6","\u6D45\u8272\u6837\u5F0F 2","band2V","50800","dbl","bg1","\u6D45\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 1","\u6D45\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 2","\u6D45\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 3","\u6D45\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 4","\u6D45\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 5","\u6D45\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 6","\u6D45\u8272\u6837\u5F0F 3","25400","\u6D45\u8272\u6837\u5F0F 3 - \u5F3A\u8C03 1","\u6D45\u8272\u6837\u5F0F 3 - \u5F3A\u8C03 2","\u6D45\u8272\u6837\u5F0F 3 - \u5F3A\u8C03 3","\u6D45\u8272\u6837\u5F0F 3 - \u5F3A\u8C03 4","\u6D45\u8272\u6837\u5F0F 3 - \u5F3A\u8C03 5","\u6D45\u8272\u6837\u5F0F 3 - \u5F3A\u8C03 6","\u4E2D\u5EA6\u6837\u5F0F 1","\u4E2D\u5EA6\u6837\u5F0F 1 - \u5F3A\u8C03 1","\u4E2D\u5EA6\u6837\u5F0F 1 - \u5F3A\u8C03 2","\u4E2D\u5EA6\u6837\u5F0F 1 - \u5F3A\u8C03 3","\u4E2D\u5EA6\u6837\u5F0F 1 - \u5F3A\u8C03 4","\u4E2D\u5EA6\u6837\u5F0F 1 - \u5F3A\u8C03 5","\u4E2D\u5EA6\u6837\u5F0F 1 - \u5F3A\u8C03 6","\u4E2D\u5EA6\u6837\u5F0F 2","prstClr","black","38100","\u4E2D\u5EA6\u6837\u5F0F 2 - \u5F3A\u8C03 1","\u4E2D\u5EA6\u6837\u5F0F 2 - \u5F3A\u8C03 2","\u4E2D\u5EA6\u6837\u5F0F 2 - \u5F3A\u8C03 3","\u4E2D\u5EA6\u6837\u5F0F 2 - \u5F3A\u8C03 4","\u4E2D\u5EA6\u6837\u5F0F 2 - \u5F3A\u8C03 5","\u4E2D\u5EA6\u6837\u5F0F 2 - \u5F3A\u8C03 6","\u4E2D\u5EA6\u6837\u5F0F 3","seCell","swCell","\u4E2D\u5EA6\u6837\u5F0F 3 - \u5F3A\u8C03 1","\u4E2D\u5EA6\u6837\u5F0F 3 - \u5F3A\u8C03 2","\u4E2D\u5EA6\u6837\u5F0F 3 - \u5F3A\u8C03 3","\u4E2D\u5EA6\u6837\u5F0F 3 - \u5F3A\u8C03 4","\u4E2D\u5EA6\u6837\u5F0F 3 - \u5F3A\u8C03 5","\u4E2D\u5EA6\u6837\u5F0F 3 - \u5F3A\u8C03 6","\u4E2D\u5EA6\u6837\u5F0F 4","\u4E2D\u5EA6\u6837\u5F0F 4 - \u5F3A\u8C03 1","\u4E2D\u5EA6\u6837\u5F0F 4 - \u5F3A\u8C03 2","\u4E2D\u5EA6\u6837\u5F0F 4 - \u5F3A\u8C03 3","\u4E2D\u5EA6\u6837\u5F0F 4 - \u5F3A\u8C03 4","\u4E2D\u5EA6\u6837\u5F0F 4 - \u5F3A\u8C03 5","\u4E2D\u5EA6\u6837\u5F0F 4 - \u5F3A\u8C03 6","\u6DF1\u8272\u6837\u5F0F 1","60000","\u6DF1\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 1","shade","\u6DF1\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 2","\u6DF1\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 3","\u6DF1\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 4","\u6DF1\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 5","\u6DF1\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 6","\u6DF1\u8272\u6837\u5F0F 2","\u6DF1\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 1/\u5F3A\u8C03 2","\u6DF1\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 3/\u5F3A\u8C03 4","\u6DF1\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 5/\u5F3A\u8C03 6"],c=[{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"12":{"14":13}},{"19":{"21":20,"23":22,"24":{"12":{"14":13}}}},{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"12":{"14":37}},{"38":{"6":36,"12":{"14":34}}},{"6":33,"12":{"14":34}},{"6":36,"12":{"14":34}},{"14":42},{"11":45},{"38":{"6":33,"12":{"14":34}}},{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":49}},{"24":{"12":{"14":34}}},{"38":{"6":33,"12":{"14":49}}},{"38":{"6":36,"12":{"14":51}}},{"6":33,"12":{"14":51}},{"6":36,"12":{"14":51}},{"38":{"6":33,"12":{"14":51}}},{"24":{"12":{"14":51}}},{"38":{"6":36,"12":{"14":53}}},{"6":33,"12":{"14":53}},{"6":36,"12":{"14":53}},{"38":{"6":33,"12":{"14":53}}},{"24":{"12":{"14":53}}},{"38":{"6":36,"12":{"14":55}}},{"6":33,"12":{"14":55}},{"6":36,"12":{"14":55}},{"38":{"6":33,"12":{"14":55}}},{"24":{"12":{"14":55}}},{"38":{"6":36,"12":{"14":57}}},{"6":33,"12":{"14":57}},{"6":36,"12":{"14":57}},{"38":{"6":33,"12":{"14":57}}},{"24":{"12":{"14":57}}},{"38":{"6":36,"12":{"14":59}}},{"6":33,"12":{"14":59}},{"6":36,"12":{"14":59}},{"38":{"6":33,"12":{"14":59}}},{"24":{"12":{"14":59}}},{"16":{"40":{"24":{"12":{"14":49,"41":{"14":64}}}}}},{"3":{"11":45},"16":{"17":{"18":{"38":{"6":33,"12":{"14":49}}}}}},{"3":{"11":45},"16":{"17":{"25":{"38":{"6":33,"12":{"14":49}}}}}},{"3":{"11":45},"16":{"17":{"26":{"38":{"6":33,"12":{"14":49}}}}}},{"3":{"11":45},"16":{"17":{"27":{"38":{"6":61,"12":{"14":49}}}}}},{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"12":{"14":49}},{"38":{"6":36,"12":{"14":34,"62":{"14":63}}}},{"14":34},{"38":{"6":36,"12":{"14":51,"62":{"14":63}}}},{"14":51},{"38":{"6":36,"12":{"14":53,"62":{"14":63}}}},{"14":53},{"38":{"6":36,"12":{"14":55,"62":{"14":63}}}},{"14":55},{"38":{"6":36,"12":{"14":57,"62":{"14":63}}}},{"14":57},{"38":{"6":36,"12":{"14":59,"62":{"14":63}}}},{"14":59},{"16":{"40":{"24":{"12":{"14":13,"41":{"14":64}}}}}},{"3":{"11":45}},{"16":{"40":{"24":{"12":{"14":34,"41":{"14":64}}}}}},{"19":{"21":20,"23":22,"24":{"12":{"14":34}}}},{"16":{"40":{"24":{"12":{"14":51,"41":{"14":64}}}}}},{"19":{"21":20,"23":22,"24":{"12":{"14":51}}}},{"16":{"40":{"24":{"12":{"14":53,"41":{"14":64}}}}}},{"19":{"21":20,"23":22,"24":{"12":{"14":53}}}},{"16":{"40":{"24":{"12":{"14":55,"41":{"14":64}}}}}},{"19":{"21":20,"23":22,"24":{"12":{"14":55}}}},{"16":{"40":{"24":{"12":{"14":57,"41":{"14":64}}}}}},{"19":{"21":20,"23":22,"24":{"12":{"14":57}}}},{"16":{"40":{"24":{"12":{"14":59,"41":{"14":64}}}}}},{"19":{"21":20,"23":22,"24":{"12":{"14":59}}}},{"38":{"6":36,"12":{"14":13}}},{"12":{"14":13}},{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":81}},{"6":36,"12":{"14":13}},{"26":{"19":{"21":79,"23":80,"24":{"12":{"14":34}}}}},{"26":{"19":{"21":79,"23":80,"24":{"12":{"14":51}}}}},{"26":{"19":{"21":79,"23":80,"24":{"12":{"14":53}}}}},{"26":{"19":{"21":79,"23":80,"24":{"12":{"14":55}}}}},{"26":{"19":{"21":79,"23":80,"24":{"12":{"14":57}}}}},{"26":{"19":{"21":79,"23":80,"24":{"12":{"14":59}}}}},{"12":{"14":34}},{"12":{"14":51}},{"12":{"14":53}},{"12":{"14":55}},{"12":{"14":57}},{"12":{"14":59}},{"16":{"40":{"24":{"12":{"14":37,"62":{"14":64}}}}}},{"3":{"11":45},"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":{"14":37}}}}},"40":{"24":{"12":{"14":49}}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":49}},"16":{"40":{"24":{"12":{"14":37}}}}},{"24":{"12":{"14":49}}},{"19":{"21":20,"23":22,"24":{"12":{"14":37}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":49}},"16":{"40":{"24":{"12":{"14":34}}}}},{"40":{"24":{"12":{"14":34,"62":{"14":64}}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":49}},"16":{"40":{"24":{"12":{"14":51}}}}},{"40":{"24":{"12":{"14":51,"62":{"14":64}}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":49}},"16":{"40":{"24":{"12":{"14":53}}}}},{"40":{"24":{"12":{"14":53,"62":{"14":64}}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":49}},"16":{"40":{"24":{"12":{"14":55}}}}},{"40":{"24":{"12":{"14":55,"62":{"14":64}}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":49}},"16":{"40":{"24":{"12":{"14":57}}}}},{"40":{"24":{"12":{"14":57,"62":{"14":64}}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":49}},"16":{"40":{"24":{"12":{"14":59}}}}},{"40":{"24":{"12":{"14":59,"62":{"14":64}}}}},{"16":{"40":{"24":{"12":{"14":37,"62":{"14":42}}}}}},{"4":{"6":5,"104":{"14":105}},"12":{"14":37}},{"18":{"19":{"21":20,"23":22,"24":{"12":{"14":49}}}},"25":{"19":{"21":20,"23":22,"24":{"12":{"14":49}}}},"26":{"19":{"21":20,"23":22,"24":{"12":{"14":49}}}},"27":{"19":{"21":20,"23":22,"24":{"12":{"14":49}}}},"28":{"19":{"21":20,"23":22,"24":{"12":{"14":49}}}},"29":{"19":{"21":20,"23":22,"24":{"12":{"14":49}}}}},{"24":{"12":{"14":37,"62":{"14":64}}}},{"4":{"6":5,"104":{"14":105}},"11":45,"12":{"14":49}},{"40":{"24":{"12":{"14":37}}}},{"26":{"19":{"21":106,"23":22,"24":{"12":{"14":49}}}}},{"24":{"12":{"14":37}}},{"27":{"19":{"21":106,"23":22,"24":{"12":{"14":49}}}}},{"16":{"40":{"24":{"12":{"14":34,"62":{"14":42}}}}}},{"24":{"12":{"14":34,"62":{"14":64}}}},{"40":{"24":{"12":{"14":34}}}},{"16":{"40":{"24":{"12":{"14":51,"62":{"14":42}}}}}},{"24":{"12":{"14":51,"62":{"14":64}}}},{"40":{"24":{"12":{"14":51}}}},{"16":{"40":{"24":{"12":{"14":53,"62":{"14":42}}}}}},{"24":{"12":{"14":53,"62":{"14":64}}}},{"40":{"24":{"12":{"14":53}}}},{"16":{"40":{"24":{"12":{"14":55,"62":{"14":42}}}}}},{"24":{"12":{"14":55,"62":{"14":64}}}},{"40":{"24":{"12":{"14":55}}}},{"16":{"40":{"24":{"12":{"14":57,"62":{"14":42}}}}}},{"24":{"12":{"14":57,"62":{"14":64}}}},{"40":{"24":{"12":{"14":57}}}},{"16":{"40":{"24":{"12":{"14":59,"62":{"14":42}}}}}},{"24":{"12":{"14":59,"62":{"14":64}}}},{"40":{"24":{"12":{"14":59}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":37}}},{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":{"14":37}}}},"27":{"19":{"21":89,"23":22,"24":{"12":{"14":37}}}}},"40":{"24":{"12":{"14":49}}}},{"14":37},{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":37}}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"12":{"14":37}},"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":{"14":37}}}},"27":{"19":{"21":89,"23":22,"24":{"12":{"14":37}}}}},"40":{"24":{"12":{"14":49}}}}},{"19":{"21":89,"23":22,"24":{"12":{"14":37}}}},{"40":{"24":{"12":{"14":37,"62":{"14":64}}}}},{"3":{"11":45},"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},"40":{"24":{"12":{"14":37}}}}},{"18":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},{"24":{"12":{"14":37,"62":{"14":130}}}},{"25":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},{"26":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},{"24":{"12":{"14":34,"132":{"14":130}}}},{"24":{"12":{"14":51,"132":{"14":130}}}},{"24":{"12":{"14":53,"132":{"14":130}}}},{"24":{"12":{"14":55,"132":{"14":130}}}},{"24":{"12":{"14":57,"132":{"14":130}}}},{"24":{"12":{"14":59,"132":{"14":130}}}},{"26":{"19":{"21":79,"23":80,"24":{"12":{"14":37}}}}}],BM={"{2D5ABB26-0587-4C30-8999-92F81FD0307C}":{"1":0,"2":{"3":c[0]}},"{5940675A-B579-460E-94D1-54222C63F5DA}":{"1":15,"2":{"3":c[0],"16":{"17":{"18":c[1],"25":c[1],"26":c[1],"27":c[1],"28":c[1],"29":c[1]}}}},"{3C2FFA5D-87B4-456A-9821-1D502468CF0F}":{"1":30,"2":{"3":c[2],"16":{"17":{"18":c[3],"25":c[3],"26":c[3],"27":c[3],"28":c[3],"29":c[3]}}},"31":{"32":c[4],"35":c[5]},"39":{"16":{"40":{"24":{"12":{"14":34,"41":c[6]}}}}},"43":{"16":{"17":{"26":c[3],"27":c[3]},"40":{"24":{"12":{"14":34,"41":c[6]}}}}},"44":{"3":c[7],"16":{"17":{"18":{"38":c[4]},"25":c[3],"26":c[3],"27":c[3],"28":c[3]}}},"46":{"3":c[7],"16":{"17":{"18":c[3],"25":{"38":c[4]},"26":c[3],"27":c[3],"28":c[3]}}},"47":{"3":c[7],"16":{"17":{"18":c[3],"25":c[3],"26":{"38":c[4]},"27":{"38":c[4]}}}},"48":{"3":c[9],"16":{"17":{"18":c[3],"25":c[3],"26":c[3],"27":c[11]},"40":c[10]}}},"{284E427A-3D55-4303-BF80-6455036E1DE7}":{"1":50,"2":{"3":c[2],"16":{"17":{"18":c[12],"25":c[12],"26":c[12],"27":c[12],"28":c[12],"29":c[12]}}},"31":{"32":c[13],"35":c[14]},"39":{"16":{"40":{"24":{"12":{"14":51,"41":c[6]}}}}},"43":{"16":{"17":{"26":c[12],"27":c[12]},"40":{"24":{"12":{"14":51,"41":c[6]}}}}},"44":{"3":c[7],"16":{"17":{"18":{"38":c[13]},"25":c[12],"26":c[12],"27":c[12],"28":c[12]}}},"46":{"3":c[7],"16":{"17":{"18":c[12],"25":{"38":c[13]},"26":c[12],"27":c[12],"28":c[12]}}},"47":{"3":c[7],"16":{"17":{"18":c[12],"25":c[12],"26":{"38":c[13]},"27":{"38":c[13]}}}},"48":{"3":c[9],"16":{"17":{"18":c[12],"25":c[12],"26":c[12],"27":c[11]},"40":c[16]}}},"{69C7853C-536D-4A76-A0AE-DD22124D55A5}":{"1":52,"2":{"3":c[2],"16":{"17":{"18":c[17],"25":c[17],"26":c[17],"27":c[17],"28":c[17],"29":c[17]}}},"31":{"32":c[18],"35":c[19]},"39":{"16":{"40":{"24":{"12":{"14":53,"41":c[6]}}}}},"43":{"16":{"17":{"26":c[17],"27":c[17]},"40":{"24":{"12":{"14":53,"41":c[6]}}}}},"44":{"3":c[7],"16":{"17":{"18":{"38":c[18]},"25":c[17],"26":c[17],"27":c[17],"28":c[17]}}},"46":{"3":c[7],"16":{"17":{"18":c[17],"25":{"38":c[18]},"26":c[17],"27":c[17],"28":c[17]}}},"47":{"3":c[7],"16":{"17":{"18":c[17],"25":c[17],"26":{"38":c[18]},"27":{"38":c[18]}}}},"48":{"3":c[9],"16":{"17":{"18":c[17],"25":c[17],"26":c[17],"27":c[11]},"40":c[21]}}},"{775DCB02-9BB8-47FD-8907-85C794F793BA}":{"1":54,"2":{"3":c[2],"16":{"17":{"18":c[22],"25":c[22],"26":c[22],"27":c[22],"28":c[22],"29":c[22]}}},"31":{"32":c[23],"35":c[24]},"39":{"16":{"40":{"24":{"12":{"14":55,"41":c[6]}}}}},"43":{"16":{"17":{"26":c[22],"27":c[22]},"40":{"24":{"12":{"14":55,"41":c[6]}}}}},"44":{"3":c[7],"16":{"17":{"18":{"38":c[23]},"25":c[22],"26":c[22],"27":c[22],"28":c[22]}}},"46":{"3":c[7],"16":{"17":{"18":c[22],"25":{"38":c[23]},"26":c[22],"27":c[22],"28":c[22]}}},"47":{"3":c[7],"16":{"17":{"18":c[22],"25":c[22],"26":{"38":c[23]},"27":{"38":c[23]}}}},"48":{"3":c[9],"16":{"17":{"18":c[22],"25":c[22],"26":c[22],"27":c[11]},"40":c[26]}}},"{35758FB7-9AC5-4552-8A53-C91805E547FA}":{"1":56,"2":{"3":c[2],"16":{"17":{"18":c[27],"25":c[27],"26":c[27],"27":c[27],"28":c[27],"29":c[27]}}},"31":{"32":c[28],"35":c[29]},"39":{"16":{"40":{"24":{"12":{"14":57,"41":c[6]}}}}},"43":{"16":{"17":{"26":c[27],"27":c[27]},"40":{"24":{"12":{"14":57,"41":c[6]}}}}},"44":{"3":c[7],"16":{"17":{"18":{"38":c[28]},"25":c[27],"26":c[27],"27":c[27],"28":c[27]}}},"46":{"3":c[7],"16":{"17":{"18":c[27],"25":{"38":c[28]},"26":c[27],"27":c[27],"28":c[27]}}},"47":{"3":c[7],"16":{"17":{"18":c[27],"25":c[27],"26":{"38":c[28]},"27":{"38":c[28]}}}},"48":{"3":c[9],"16":{"17":{"18":c[27],"25":c[27],"26":c[27],"27":c[11]},"40":c[31]}}},"{08FB837D-C827-4EFA-A057-4D05807E0F7C}":{"1":58,"2":{"3":c[2],"16":{"17":{"18":c[32],"25":c[32],"26":c[32],"27":c[32],"28":c[32],"29":c[32]}}},"31":{"32":c[33],"35":c[34]},"39":{"16":{"40":{"24":{"12":{"14":59,"41":c[6]}}}}},"43":{"16":{"17":{"26":c[32],"27":c[32]},"40":{"24":{"12":{"14":59,"41":c[6]}}}}},"44":{"3":c[7],"16":{"17":{"18":{"38":c[33]},"25":c[32],"26":c[32],"27":c[32],"28":c[32]}}},"46":{"3":c[7],"16":{"17":{"18":c[32],"25":{"38":c[33]},"26":c[32],"27":c[32],"28":c[32]}}},"47":{"3":c[7],"16":{"17":{"18":c[32],"25":c[32],"26":{"38":c[33]},"27":{"38":c[33]}}}},"48":{"3":c[9],"16":{"17":{"18":c[32],"25":c[32],"26":c[32],"27":c[11]},"40":c[36]}}},"{D113A9D2-9D6B-4929-AA2D-F23B5EE8CBE7}":{"1":60,"2":{"3":c[42],"16":{"17":{"18":c[43],"25":c[43],"26":c[43],"27":c[43]}}},"31":{"32":{"6":61,"12":c[44]},"35":{"6":61,"12":c[44]}},"39":c[37],"43":c[37],"44":{"3":c[7],"16":{"17":{"18":c[11]}}},"46":{"3":c[7],"16":{"17":{"25":c[11]}}},"47":{"3":c[7],"16":{"17":{"26":c[11]}}},"48":{"3":c[7],"16":{"17":{"27":{"38":{"6":61,"12":{"14":49}}}}}}},"{18603FDC-E32A-4AB5-989C-0864C3EAD2B8}":{"1":65,"2":{"3":c[42],"16":{"17":{"18":c[45],"25":c[45],"26":c[45],"27":c[45]}}},"31":{"32":{"6":61,"12":c[46]},"35":{"6":61,"12":c[46]}},"39":c[37],"43":c[37],"44":{"3":c[7],"16":{"17":{"18":c[11]}}},"46":{"3":c[7],"16":{"17":{"25":c[11]}}},"47":{"3":c[7],"16":{"17":{"26":c[11]}}},"48":{"3":c[7],"16":{"17":{"27":{"38":{"6":61,"12":{"14":49}}}}}}},"{306799F8-075E-4A3A-A7F6-7FBC6576F1A4}":{"1":66,"2":{"3":c[42],"16":{"17":{"18":c[47],"25":c[47],"26":c[47],"27":c[47]}}},"31":{"32":{"6":61,"12":c[48]},"35":{"6":61,"12":c[48]}},"39":c[37],"43":c[37],"44":{"3":c[7],"16":{"17":{"18":c[11]}}},"46":{"3":c[7],"16":{"17":{"25":c[11]}}},"47":{"3":c[7],"16":{"17":{"26":c[11]}}},"48":{"3":c[7],"16":{"17":{"27":{"38":{"6":61,"12":{"14":49}}}}}}},"{E269D01E-BC32-4049-B463-5C60D7B0CCD2}":{"1":67,"2":{"3":c[42],"16":{"17":{"18":c[49],"25":c[49],"26":c[49],"27":c[49]}}},"31":{"32":{"6":61,"12":c[50]},"35":{"6":61,"12":c[50]}},"39":c[37],"43":c[37],"44":{"3":c[7],"16":{"17":{"18":c[11]}}},"46":{"3":c[7],"16":{"17":{"25":c[11]}}},"47":{"3":c[7],"16":{"17":{"26":c[11]}}},"48":{"3":c[7],"16":{"17":{"27":{"38":{"6":61,"12":{"14":49}}}}}}},"{327F97BB-C833-4FB7-BDE5-3F7075034690}":{"1":68,"2":{"3":c[42],"16":{"17":{"18":c[51],"25":c[51],"26":c[51],"27":c[51]}}},"31":{"32":{"6":61,"12":c[52]},"35":{"6":61,"12":c[52]}},"39":c[37],"43":c[37],"44":{"3":c[7],"16":{"17":{"18":c[11]}}},"46":{"3":c[7],"16":{"17":{"25":c[11]}}},"47":{"3":c[7],"16":{"17":{"26":c[11]}}},"48":{"3":c[7],"16":{"17":{"27":{"38":{"6":61,"12":{"14":49}}}}}}},"{638B1855-1B75-4FBE-930C-398BA8C253C6}":{"1":69,"2":{"3":c[42],"16":{"17":{"18":c[53],"25":c[53],"26":c[53],"27":c[53]}}},"31":{"32":{"6":61,"12":c[54]},"35":{"6":61,"12":c[54]}},"39":c[37],"43":c[37],"44":{"3":c[7],"16":{"17":{"18":c[11]}}},"46":{"3":c[7],"16":{"17":{"25":c[11]}}},"47":{"3":c[7],"16":{"17":{"26":c[11]}}},"48":{"3":c[7],"16":{"17":{"27":{"38":{"6":61,"12":{"14":49}}}}}}},"{9D7B26C5-4107-4FEC-AEDC-1716B250A1EF}":{"1":70,"2":{"3":c[0],"16":{"17":{"26":c[1],"27":c[1]}}},"39":c[55],"43":c[55],"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":c[1]}}},"48":{"3":c[7],"16":{"17":{"27":c[1]}}}},"{3B4B98B0-60AC-42C2-AFA5-B58CD77FA1E5}":{"1":71,"2":{"3":c[0],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":c[44]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[44]}}}}}},"39":c[57],"43":c[57],"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":c[44]}}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":20,"23":22,"24":{"12":c[44]}}}}}}},"{0E3FDE45-AF77-4B5C-9715-49D594BDF05E}":{"1":72,"2":{"3":c[0],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":c[46]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[46]}}}}}},"39":c[59],"43":c[59],"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":c[46]}}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":20,"23":22,"24":{"12":c[46]}}}}}}},"{C083E6E3-FA7D-4D7B-A595-EF9225AFEA82}":{"1":73,"2":{"3":c[0],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":c[48]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[48]}}}}}},"39":c[61],"43":c[61],"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":c[48]}}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":20,"23":22,"24":{"12":c[48]}}}}}}},"{D27102A9-8310-4765-A935-A1911B00CA55}":{"1":74,"2":{"3":c[0],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":c[50]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[50]}}}}}},"39":c[63],"43":c[63],"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":c[50]}}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":20,"23":22,"24":{"12":c[50]}}}}}}},"{5FD0F851-EC5A-4D38-B0AD-8093EC10F338}":{"1":75,"2":{"3":c[0],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":c[52]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[52]}}}}}},"39":c[65],"43":c[65],"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":c[52]}}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":20,"23":22,"24":{"12":c[52]}}}}}}},"{68D230F3-CF80-4859-8CE7-A43EE81993B5}":{"1":76,"2":{"3":c[0],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":c[54]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[54]}}}}}},"39":c[67],"43":c[67],"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":c[54]}}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":20,"23":22,"24":{"12":c[54]}}}}}}},"{7E9639D4-E3E2-4D34-9284-5A2195B3D0D7}":{"1":77,"2":{"3":c[0],"16":{"17":{"18":c[69],"25":c[69],"26":c[69],"27":c[69]}}},"39":{"16":{"17":{"26":c[69],"27":c[69]}}},"43":{"16":{"17":{"18":c[69],"25":c[69]}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":c[70]}}}}},"48":{"3":c[71],"16":{"32":c[72]}},"78":{"16":{"17":{"18":c[69],"25":c[69]}}}},"{69012ECD-51FC-41F1-AA8D-1B2483CD663E}":{"1":82,"2":{"3":c[0],"16":{"17":{"18":c[3],"25":c[3],"26":c[3],"27":c[3]}}},"39":{"16":{"17":{"26":c[3],"27":c[3]}}},"43":{"16":{"17":{"18":c[3],"25":c[3]}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[44]}}}}}},"48":{"3":c[71],"16":{"32":c[5]}},"78":{"16":{"17":{"18":c[3],"25":c[3]}}}},"{72833802-FEF1-4C79-8D5D-14CF1EAF98D9}":{"1":83,"2":{"3":c[0],"16":{"17":{"18":c[12],"25":c[12],"26":c[12],"27":c[12]}}},"39":{"16":{"17":{"26":c[12],"27":c[12]}}},"43":{"16":{"17":{"18":c[12],"25":c[12]}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[46]}}}}}},"48":{"3":c[71],"16":{"32":c[14]}},"78":{"16":{"17":{"18":c[12],"25":c[12]}}}},"{F2DE63D5-997A-4646-A377-4702673A728D}":{"1":84,"2":{"3":c[0],"16":{"17":{"18":c[17],"25":c[17],"26":c[17],"27":c[17]}}},"39":{"16":{"17":{"26":c[17],"27":c[17]}}},"43":{"16":{"17":{"18":c[17],"25":c[17]}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[48]}}}}}},"48":{"3":c[71],"16":{"32":c[19]}},"78":{"16":{"17":{"18":c[17],"25":c[17]}}}},"{17292A2E-F333-43FB-9621-5CBBE7FDCDCB}":{"1":85,"2":{"3":c[0],"16":{"17":{"18":c[22],"25":c[22],"26":c[22],"27":c[22]}}},"39":{"16":{"17":{"26":c[22],"27":c[22]}}},"43":{"16":{"17":{"18":c[22],"25":c[22]}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[50]}}}}}},"48":{"3":c[71],"16":{"32":c[24]}},"78":{"16":{"17":{"18":c[22],"25":c[22]}}}},"{5A111915-BE36-4E01-A7E5-04B1672EAD32}":{"1":86,"2":{"3":c[0],"16":{"17":{"18":c[27],"25":c[27],"26":c[27],"27":c[27]}}},"39":{"16":{"17":{"26":c[27],"27":c[27]}}},"43":{"16":{"17":{"18":c[27],"25":c[27]}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[52]}}}}}},"48":{"3":c[71],"16":{"32":c[29]}},"78":{"16":{"17":{"18":c[27],"25":c[27]}}}},"{912C8C85-51F0-491E-9774-3900AFEF0FD7}":{"1":87,"2":{"3":c[0],"16":{"17":{"18":c[32],"25":c[32],"26":c[32],"27":c[32]}}},"39":{"16":{"17":{"26":c[32],"27":c[32]}}},"43":{"16":{"17":{"18":c[32],"25":c[32]}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[54]}}}}}},"48":{"3":c[71],"16":{"32":c[34]}},"78":{"16":{"17":{"18":c[32],"25":c[32]}}}},"{616DA210-FB5B-4158-B5E0-FEB733F419BA}":{"1":88,"2":{"3":c[0],"16":{"17":{"18":c[1],"25":c[1],"26":c[1],"27":c[1],"28":c[1],"29":c[1]}}},"39":c[55],"43":c[55],"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":c[70]}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":c[70]}}}}}},"{BC89EF96-8CEA-46FF-86C4-4CE0E7609802}":{"1":90,"2":{"3":c[0],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[44]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[44]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[44]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[44]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[44]}}},"29":{"19":{"21":20,"23":22,"24":{"12":c[44]}}}}}},"39":c[57],"43":c[57],"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[44]}}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":c[44]}}}}}}},"{5DA37D80-6434-44D0-A028-1B22A696006F}":{"1":91,"2":{"3":c[0],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[46]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[46]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[46]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[46]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[46]}}},"29":{"19":{"21":20,"23":22,"24":{"12":c[46]}}}}}},"39":c[59],"43":c[59],"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[46]}}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":c[46]}}}}}}},"{8799B23B-EC83-4686-B30A-512413B5E67A}":{"1":92,"2":{"3":c[0],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[48]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[48]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[48]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[48]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[48]}}},"29":{"19":{"21":20,"23":22,"24":{"12":c[48]}}}}}},"39":c[61],"43":c[61],"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[48]}}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":c[48]}}}}}}},"{ED083AE6-46FA-4A59-8FB0-9F97EB10719F}":{"1":93,"2":{"3":c[0],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[50]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[50]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[50]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[50]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[50]}}},"29":{"19":{"21":20,"23":22,"24":{"12":c[50]}}}}}},"39":c[63],"43":c[63],"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[50]}}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":c[50]}}}}}}},"{BDBED569-4797-4DF1-A0F4-6AAB3CD982D8}":{"1":94,"2":{"3":c[0],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[52]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[52]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[52]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[52]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[52]}}},"29":{"19":{"21":20,"23":22,"24":{"12":c[52]}}}}}},"39":c[65],"43":c[65],"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[52]}}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":c[52]}}}}}}},"{E8B1032C-EA38-4F05-BA0D-38AFFFC7BED3}":{"1":95,"2":{"3":c[0],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[54]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[54]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[54]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[54]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[54]}}},"29":{"19":{"21":20,"23":22,"24":{"12":c[54]}}}}}},"39":c[67],"43":c[67],"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[54]}}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":c[54]}}}}}}},"{793D81CF-94F2-401A-BA57-92F5A7B2D0C5}":{"1":96,"2":{"3":c[2],"16":{"17":{"18":c[89],"25":c[89],"26":c[89],"27":c[89],"28":c[89]},"40":c[88]}},"39":c[85],"43":c[85],"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[131]}}}},"40":c[88]}},"48":{"3":c[9],"16":c[107]}},"{B301B821-A1FF-4177-AEE7-76D212191A09}":{"1":97,"2":{"3":c[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[44]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[44]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[44]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[44]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[44]}}}},"40":c[88]}},"39":{"16":c[91]},"43":{"16":c[91]},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[44]}}}},"40":c[88]}},"48":{"3":c[9],"16":{"40":c[10]}}},"{9DCAF9ED-07DC-4A11-8D7F-57B35C25682E}":{"1":98,"2":{"3":c[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[46]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[46]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[46]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[46]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[46]}}}},"40":c[88]}},"39":{"16":c[93]},"43":{"16":c[93]},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[46]}}}},"40":c[88]}},"48":{"3":c[9],"16":{"40":c[16]}}},"{1FECB4D8-DB02-4DC6-A0A2-4F2EBAE1DC90}":{"1":99,"2":{"3":c[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[48]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[48]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[48]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[48]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[48]}}}},"40":c[88]}},"39":{"16":c[95]},"43":{"16":c[95]},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[48]}}}},"40":c[88]}},"48":{"3":c[9],"16":{"40":c[21]}}},"{1E171933-4619-4E11-9A3F-F7608DF75F80}":{"1":100,"2":{"3":c[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[50]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[50]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[50]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[50]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[50]}}}},"40":c[88]}},"39":{"16":c[97]},"43":{"16":c[97]},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[50]}}}},"40":c[88]}},"48":{"3":c[9],"16":{"40":c[26]}}},"{FABFCF23-3B69-468F-B69F-88F6DE6A72F2}":{"1":101,"2":{"3":c[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[52]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[52]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[52]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[52]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[52]}}}},"40":c[88]}},"39":{"16":c[99]},"43":{"16":c[99]},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[52]}}}},"40":c[88]}},"48":{"3":c[9],"16":{"40":c[31]}}},"{10A1B5D5-9B99-4C35-A422-299274C87663}":{"1":102,"2":{"3":c[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[54]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[54]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[54]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[54]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[54]}}}},"40":c[88]}},"39":{"16":c[101]},"43":{"16":c[101]},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[54]}}}},"40":c[88]}},"48":{"3":c[9],"16":{"40":c[36]}}},"{073A0DAA-6AF3-43AB-8588-CEC1D06C72B9}":{"1":103,"2":{"3":c[103],"16":{"17":c[104],"40":c[105]}},"39":{"16":{"40":{"24":{"12":{"14":37,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":37,"62":c[6]}}}}},"44":{"3":c[106],"16":c[107]},"46":{"3":c[106],"16":c[107]},"47":{"3":c[106],"16":{"17":c[108],"40":c[109]}},"48":{"3":c[106],"16":{"17":c[110],"40":c[109]}}},"{5C22544A-7EE6-4342-B048-85BDC9FD1C3A}":{"1":107,"2":{"3":c[103],"16":{"17":c[104],"40":c[112]}},"39":{"16":{"40":{"24":{"12":{"14":34,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":34,"62":c[6]}}}}},"44":{"3":c[106],"16":{"40":c[10]}},"46":{"3":c[106],"16":{"40":c[10]}},"47":{"3":c[106],"16":{"17":c[108],"40":c[10]}},"48":{"3":c[106],"16":{"17":c[110],"40":c[10]}}},"{21E4AEA4-8DFA-4A89-87EB-49C32662AFE0}":{"1":108,"2":{"3":c[103],"16":{"17":c[104],"40":c[115]}},"39":{"16":{"40":{"24":{"12":{"14":51,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":51,"62":c[6]}}}}},"44":{"3":c[106],"16":{"40":c[16]}},"46":{"3":c[106],"16":{"40":c[16]}},"47":{"3":c[106],"16":{"17":c[108],"40":c[16]}},"48":{"3":c[106],"16":{"17":c[110],"40":c[16]}}},"{F5AB1C69-6EDB-4FF4-983F-18BD219EF322}":{"1":109,"2":{"3":c[103],"16":{"17":c[104],"40":c[118]}},"39":{"16":{"40":{"24":{"12":{"14":53,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":53,"62":c[6]}}}}},"44":{"3":c[106],"16":{"40":c[21]}},"46":{"3":c[106],"16":{"40":c[21]}},"47":{"3":c[106],"16":{"17":c[108],"40":c[21]}},"48":{"3":c[106],"16":{"17":c[110],"40":c[21]}}},"{00A15C55-8517-42AA-B614-E9B94910E393}":{"1":110,"2":{"3":c[103],"16":{"17":c[104],"40":c[121]}},"39":{"16":{"40":{"24":{"12":{"14":55,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":55,"62":c[6]}}}}},"44":{"3":c[106],"16":{"40":c[26]}},"46":{"3":c[106],"16":{"40":c[26]}},"47":{"3":c[106],"16":{"17":c[108],"40":c[26]}},"48":{"3":c[106],"16":{"17":c[110],"40":c[26]}}},"{7DF18680-E054-41AD-8BC1-D1AEF772440D}":{"1":111,"2":{"3":c[103],"16":{"17":c[104],"40":c[124]}},"39":{"16":{"40":{"24":{"12":{"14":57,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":57,"62":c[6]}}}}},"44":{"3":c[106],"16":{"40":c[31]}},"46":{"3":c[106],"16":{"40":c[31]}},"47":{"3":c[106],"16":{"17":c[108],"40":c[31]}},"48":{"3":c[106],"16":{"17":c[110],"40":c[31]}}},"{93296810-A885-4BE3-A3E7-6D5BEEA58F35}":{"1":112,"2":{"3":c[103],"16":{"17":c[104],"40":c[127]}},"39":{"16":{"40":{"24":{"12":{"14":59,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":59,"62":c[6]}}}}},"44":{"3":c[106],"16":{"40":c[36]}},"46":{"3":c[106],"16":{"40":c[36]}},"47":{"3":c[106],"16":{"17":c[108],"40":c[36]}},"48":{"3":c[106],"16":{"17":c[110],"40":c[36]}}},"{8EC20E35-A176-4012-BC5E-935CFFF8708E}":{"1":113,"2":{"3":{"4":{"6":5},"12":c[131]},"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":c[131]}}},"27":{"19":{"21":89,"23":22,"24":{"12":c[131]}}}},"40":c[88]}},"39":c[85],"43":c[85],"44":{"3":c[9],"16":c[107]},"46":{"3":c[9],"16":c[107]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[131]}}}},"40":c[88]}},"48":{"3":c[9],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":c[131]}}}},"40":c[109]}},"114":c[129],"115":c[129]},"{6E25E649-3F16-4E02-A733-19D2CDBF48F0}":{"1":116,"2":{"3":c[2],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":c[131]}}},"27":{"19":{"21":89,"23":22,"24":{"12":c[131]}}}},"40":c[88]}},"39":c[85],"43":c[85],"44":{"3":c[9],"16":{"40":c[10]}},"46":{"3":c[9],"16":{"40":c[10]}},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[131]}}}},"40":c[88]}},"48":{"3":c[9],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":c[131]}}}},"40":c[10]}},"114":c[129],"115":c[129]},"{85BE263C-DBD7-4A20-BB59-AAB30ACAA65A}":{"1":117,"2":{"3":c[2],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":c[131]}}},"27":{"19":{"21":89,"23":22,"24":{"12":c[131]}}}},"40":c[88]}},"39":c[85],"43":c[85],"44":{"3":c[9],"16":{"40":c[16]}},"46":{"3":c[9],"16":{"40":c[16]}},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[131]}}}},"40":c[88]}},"48":{"3":c[9],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":c[131]}}}},"40":c[16]}},"114":c[129],"115":c[129]},"{EB344D84-9AFB-497E-A393-DC336BA19D2E}":{"1":118,"2":{"3":c[2],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":c[131]}}},"27":{"19":{"21":89,"23":22,"24":{"12":c[131]}}}},"40":c[88]}},"39":c[85],"43":c[85],"44":{"3":c[9],"16":{"40":c[21]}},"46":{"3":c[9],"16":{"40":c[21]}},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[131]}}}},"40":c[88]}},"48":{"3":c[9],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":c[131]}}}},"40":c[21]}},"114":c[129],"115":c[129]},"{EB9631B5-78F2-41C9-869B-9F39066F8104}":{"1":119,"2":{"3":c[2],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":c[131]}}},"27":{"19":{"21":89,"23":22,"24":{"12":c[131]}}}},"40":c[88]}},"39":c[85],"43":c[85],"44":{"3":c[9],"16":{"40":c[26]}},"46":{"3":c[9],"16":{"40":c[26]}},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[131]}}}},"40":c[88]}},"48":{"3":c[9],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":c[131]}}}},"40":c[26]}},"114":c[129],"115":c[129]},"{74C1A8A3-306A-4EB7-A6B1-4F7E0EB9C5D6}":{"1":120,"2":{"3":c[2],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":c[131]}}},"27":{"19":{"21":89,"23":22,"24":{"12":c[131]}}}},"40":c[88]}},"39":c[85],"43":c[85],"44":{"3":c[9],"16":{"40":c[31]}},"46":{"3":c[9],"16":{"40":c[31]}},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[131]}}}},"40":c[88]}},"48":{"3":c[9],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":c[131]}}}},"40":c[31]}},"114":c[129],"115":c[129]},"{2A488322-F2BA-4B5B-9748-0D474271808F}":{"1":121,"2":{"3":c[2],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":c[131]}}},"27":{"19":{"21":89,"23":22,"24":{"12":c[131]}}}},"40":c[88]}},"39":c[85],"43":c[85],"44":{"3":c[9],"16":{"40":c[36]}},"46":{"3":c[9],"16":{"40":c[36]}},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[131]}}}},"40":c[88]}},"48":{"3":c[9],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":c[131]}}}},"40":c[36]}},"114":c[129],"115":c[129]},"{D7AC3CCA-C797-4891-BE02-D94E43425B78}":{"1":122,"2":{"3":c[2],"16":{"17":{"18":c[89],"25":c[89],"26":c[89],"27":c[89],"28":c[89],"29":c[89]},"40":c[105]}},"39":{"16":{"40":{"24":{"12":{"14":37,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":37,"62":c[6]}}}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":c[131]}}}},"40":c[105]}},"48":{"3":c[7],"16":{"40":c[105]}}},"{69CF1AB2-1976-4502-BF36-3FF5EA218861}":{"1":123,"2":{"3":c[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[44]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[44]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[44]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[44]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[44]}}},"29":{"19":{"21":20,"23":22,"24":{"12":c[44]}}}},"40":c[112]}},"39":{"16":{"40":{"24":{"12":{"14":34,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":34,"62":c[6]}}}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":c[44]}}}},"40":c[112]}},"48":{"3":c[7],"16":c[91]}},"{8A107856-5554-42FB-B03E-39F5DBC370BA}":{"1":124,"2":{"3":c[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[46]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[46]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[46]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[46]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[46]}}},"29":{"19":{"21":20,"23":22,"24":{"12":c[46]}}}},"40":c[115]}},"39":{"16":{"40":{"24":{"12":{"14":51,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":51,"62":c[6]}}}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":c[46]}}}},"40":c[115]}},"48":{"3":c[7],"16":c[93]}},"{0505E3EF-67EA-436B-97B2-0124C06EBD24}":{"1":125,"2":{"3":c[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[48]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[48]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[48]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[48]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[48]}}},"29":{"19":{"21":20,"23":22,"24":{"12":c[48]}}}},"40":c[118]}},"39":{"16":{"40":{"24":{"12":{"14":53,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":53,"62":c[6]}}}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":c[48]}}}},"40":c[118]}},"48":{"3":c[7],"16":c[95]}},"{C4B1156A-380E-4F78-BDF5-A606A8083BF9}":{"1":126,"2":{"3":c[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[50]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[50]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[50]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[50]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[50]}}},"29":{"19":{"21":20,"23":22,"24":{"12":c[50]}}}},"40":c[121]}},"39":{"16":{"40":{"24":{"12":{"14":55,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":55,"62":c[6]}}}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":c[50]}}}},"40":c[121]}},"48":{"3":c[7],"16":c[97]}},"{22838BEF-8BB2-4498-84A7-C5851F593DF1}":{"1":127,"2":{"3":c[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[52]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[52]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[52]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[52]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[52]}}},"29":{"19":{"21":20,"23":22,"24":{"12":c[52]}}}},"40":c[124]}},"39":{"16":{"40":{"24":{"12":{"14":57,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":57,"62":c[6]}}}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":c[52]}}}},"40":c[124]}},"48":{"3":c[7],"16":c[99]}},"{16D9F66E-5EB9-4882-86FB-DCBF35E3C3E4}":{"1":128,"2":{"3":c[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":c[54]}}},"25":{"19":{"21":20,"23":22,"24":{"12":c[54]}}},"26":{"19":{"21":20,"23":22,"24":{"12":c[54]}}},"27":{"19":{"21":20,"23":22,"24":{"12":c[54]}}},"28":{"19":{"21":20,"23":22,"24":{"12":c[54]}}},"29":{"19":{"21":20,"23":22,"24":{"12":c[54]}}}},"40":c[127]}},"39":{"16":{"40":{"24":{"12":{"14":59,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":59,"62":c[6]}}}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":c[54]}}}},"40":c[127]}},"48":{"3":c[7],"16":c[101]}},"{E8034E78-7F5D-4C2E-B375-FC64B27BC917}":{"1":129,"2":{"3":c[42],"16":{"40":c[105]}},"39":{"16":{"40":{"24":{"12":{"14":37,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":37,"62":c[6]}}}}},"44":{"3":c[7],"16":{"17":c[137],"40":c[138]}},"46":{"3":c[7],"16":{"17":c[139],"40":c[138]}},"47":{"3":c[7],"16":{"17":c[140],"40":c[138]}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},"40":c[109]}}},"{125E5076-3810-47DD-B79F-674D7AD40C01}":{"1":131,"2":{"3":c[42],"16":{"40":c[10]}},"39":{"16":{"40":c[141]}},"43":{"16":{"40":c[141]}},"44":{"3":c[7],"16":{"17":c[137],"40":c[141]}},"46":{"3":c[7],"16":{"17":c[139],"40":c[141]}},"47":{"3":c[7],"16":{"17":c[140],"40":{"24":{"12":{"14":34,"132":c[6]}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},"40":c[109]}}},"{37CE84F3-28C3-443E-9E96-99CF82512B78}":{"1":133,"2":{"3":c[42],"16":{"40":c[16]}},"39":{"16":{"40":c[142]}},"43":{"16":{"40":c[142]}},"44":{"3":c[7],"16":{"17":c[137],"40":c[142]}},"46":{"3":c[7],"16":{"17":c[139],"40":c[142]}},"47":{"3":c[7],"16":{"17":c[140],"40":{"24":{"12":{"14":51,"132":c[6]}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},"40":c[109]}}},"{D03447BB-5D67-496B-8E87-E561075AD55C}":{"1":134,"2":{"3":c[42],"16":{"40":c[21]}},"39":{"16":{"40":c[143]}},"43":{"16":{"40":c[143]}},"44":{"3":c[7],"16":{"17":c[137],"40":c[143]}},"46":{"3":c[7],"16":{"17":c[139],"40":c[143]}},"47":{"3":c[7],"16":{"17":c[140],"40":{"24":{"12":{"14":53,"132":c[6]}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},"40":c[109]}}},"{E929F9F4-4A8F-4326-A1B4-22849713DDAB}":{"1":135,"2":{"3":c[42],"16":{"40":c[26]}},"39":{"16":{"40":c[144]}},"43":{"16":{"40":c[144]}},"44":{"3":c[7],"16":{"17":c[137],"40":c[144]}},"46":{"3":c[7],"16":{"17":c[139],"40":c[144]}},"47":{"3":c[7],"16":{"17":c[140],"40":{"24":{"12":{"14":55,"132":c[6]}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},"40":c[109]}}},"{8FD4443E-F989-4FC4-A0C8-D5A2AF1F390B}":{"1":136,"2":{"3":c[42],"16":{"40":c[31]}},"39":{"16":{"40":c[145]}},"43":{"16":{"40":c[145]}},"44":{"3":c[7],"16":{"17":c[137],"40":c[145]}},"46":{"3":c[7],"16":{"17":c[139],"40":c[145]}},"47":{"3":c[7],"16":{"17":c[140],"40":{"24":{"12":{"14":57,"132":c[6]}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},"40":c[109]}}},"{AF606853-7671-496A-8E4F-DF71F8EC918B}":{"1":137,"2":{"3":c[42],"16":{"40":c[36]}},"39":{"16":{"40":c[146]}},"43":{"16":{"40":c[146]}},"44":{"3":c[7],"16":{"17":c[137],"40":c[146]}},"46":{"3":c[7],"16":{"17":c[139],"40":c[146]}},"47":{"3":c[7],"16":{"17":c[140],"40":{"24":{"12":{"14":59,"132":c[6]}}}}},"48":{"3":c[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},"40":c[109]}}},"{5202B0CA-FC54-4496-8BCA-5EF66A818D29}":{"1":138,"2":{"3":c[2],"16":{"40":c[105]}},"39":{"16":{"40":{"24":{"12":{"14":37,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":37,"62":c[6]}}}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[131]}}}},"40":c[105]}},"48":{"3":c[9],"16":c[107]}},"{0660B408-B3CF-4A94-85FC-2B1E0A45F4A2}":{"1":139,"2":{"3":c[2],"16":c[91]},"39":{"16":{"40":{"24":{"12":{"14":34,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":34,"62":c[6]}}}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[131]}}}},"40":c[112]}},"48":{"3":c[9],"16":{"40":c[16]}}},"{91EBBBCC-DAD2-459C-BE2E-F6DE35CF9A28}":{"1":140,"2":{"3":c[2],"16":c[95]},"39":{"16":{"40":{"24":{"12":{"14":53,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":53,"62":c[6]}}}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[131]}}}},"40":c[118]}},"48":{"3":c[9],"16":{"40":c[26]}}},"{46F890A9-2807-4EBB-B81D-B2AA78EC7F39}":{"1":141,"2":{"3":c[2],"16":c[99]},"39":{"16":{"40":{"24":{"12":{"14":57,"62":c[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":57,"62":c[6]}}}}},"44":{"3":c[7]},"46":{"3":c[7]},"47":{"3":c[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":c[131]}}}},"40":c[124]}},"48":{"3":c[9],"16":{"40":c[36]}}}};function gS(e){var t={};return Object.keys(e).forEach(function(i){_typeof(e[i])=="object"?t[Yu[Number(i)]]=gS(e[i]):t[Yu[Number(i)]]=Yu[e[i]]}),t}function FM(e){var t=BM[e];return t?gS(t):void 0}function jM(e){e.bindAttributePicker("a:tcPr","*",zM)}var zM=function zM(e,t,i,r,n){var s=VM(e,t,i,r,n),o=i.split("-"),a=parseInt(o[0],10),l=parseInt(o[1],10),h=o[2],d=e.parentElement("a:tbl").childElementOptional("a:tblPr"),u=UM(e,t,h,d);if(u!==void 0&&u!==cr)return u;var p=s.tableStyle,f=s.bandRow,m=s.bandCol;if(p){var g=p.band1H,y=p.band2H,b=p.band1V,v=p.band2V,w=p.firstRow,M=p.firstCol,x=p.wholeTbl,T=(a+1)%2==1,O=(l+1)%2==1;return w&&a===0?Gl(w,t,h,x,p):M&&a===0?Gl(M,t,h,x,p):f?Gl(w?T?y:g:T?g:y,t,h,x,p):m?Gl(M?O?v:b:O?b:v,t,h,x,p):$l(x,t,h,p)}};function Gl(e,t,i,r,n){if(e){var s=$l(e,t,i,n);return s===void 0?$l(r,t,i,n):s}else return $l(r,t,i,n)}function $l(e,t,i,r){var n,s,o,a,l,h,d,u,p,f,m,g;switch(i){case"isBold":{var y=e&&(e==null?void 0:e.tcTxStyle);return y?(n=y.b)!=null?n:"off":"false"}case"isItalic":{var _y3=e&&(e==null?void 0:e.tcTxStyle);return _y3?(s=_y3.i)!=null?s:"off":"false"}case"fillColor":{var _y4=e&&((l=(a=(o=e.tcStyle)==null?void 0:o.fill)==null?void 0:a.solidFill)==null?void 0:l.schemeClr);if(_y4)return Tu(_y4,t);if(_y4=(d=(h=r.tblBg)==null?void 0:h.fillRef)==null?void 0:d.schemeClr,_y4){var b=Number((p=(u=r.tblBg)==null?void 0:u.fillRef)==null?void 0:p.idx),v=t.theme.childElementOptional("a:theme","a:themeElements","a:fmtScheme","a:fillStyleLst");if(b&&v)return new Fo(v==null?void 0:v.elements[b],t,void 0,_y4.val)}return}case"fontFamily":{var _y5=e&&((f=e.tcTxStyle)==null?void 0:f.fontRef);return _y5?e2((m=_y5.idx)!=null?m:"none",t).join(","):void 0}case"fontColor":{var _y6=e&&((g=e.tcTxStyle)==null?void 0:g.schemeClr);return _y6?Tu(_y6,t):void 0}case"bottomBorderWidth":return new ni(e,"bottom").getBorderWidth();case"bottomBorderColor":return new ni(e,"bottom").getBorderColor(t);case"bottomBorderStyle":return new ni(e,"bottom").getBorderType();case"topBorderWidth":return new ni(e,"top").getBorderWidth();case"topBorderColor":return new ni(e,"top").getBorderColor(t);case"topBorderStyle":return new ni(e,"top").getBorderType();case"leftBorderWidth":return new ni(e,"left").getBorderWidth();case"leftBorderColor":return new ni(e,"left").getBorderColor(t);case"leftBorderStyle":return new ni(e,"left").getBorderType();case"rightBorderWidth":return new ni(e,"right").getBorderWidth();case"rightBorderColor":return new ni(e,"right").getBorderColor(t);case"rightBorderStyle":return new ni(e,"right").getBorderType();default:return;}}function UM(e,t,i,r){switch(i){case"isBold":return;case"isItalic":return;case"fillColor":{var n=e.childElementOptional(_construct(Y,Ss));return n?new zr().read(n,t):new zr().read(r,t)}case"fontFamily":return;case"fontColor":return;case"bottomBorderWidth":return new st(e,"a:lnB").getBorderWidth();case"bottomBorderColor":return new st(e,"a:lnB").getBorderColor(t);case"bottomBorderStyle":return new st(e,"a:lnB").getBorderType();case"bottomBorderStrokeDashArray":return new st(e,"a:lnB").getBorderStrokeDashArray();case"topBorderWidth":return new st(e,"a:lnT").getBorderWidth();case"topBorderColor":return new st(e,"a:lnT").getBorderColor(t);case"topBorderStyle":return new st(e,"a:lnT").getBorderType();case"topBorderStrokeDashArray":return new st(e,"a:lnT").getBorderStrokeDashArray();case"leftBorderWidth":return new st(e,"a:lnL").getBorderWidth();case"leftBorderColor":return new st(e,"a:lnL").getBorderColor(t);case"leftBorderStyle":return new st(e,"a:lnL").getBorderType();case"leftBorderStrokeDashArray":return new st(e,"a:lnL").getBorderStrokeDashArray();case"rightBorderWidth":return new st(e,"a:lnR").getBorderWidth();case"rightBorderColor":return new st(e,"a:lnR").getBorderColor(t);case"rightBorderStyle":return new st(e,"a:lnR").getBorderType();case"rightBorderStrokeDashArray":return new st(e,"a:lnR").getBorderStrokeDashArray();default:return;}}function VM(e,t,i,r,n){var s=r.tableStyleXML;return s||(s=r.tableStyleXML=Object.freeze(WM(e,t))),s}function WM(e,t){var i=e.parentElement("a:tbl").childElementOptional("a:tblPr");if(i&&i.hasChildElementWithName("a:tableStyleId")){var _r146=i.childElement("a:tableStyleId").text,n=FM(_r146),s=i.attr.getBoolean("bandCol",!1),o=i.attr.getBoolean("bandRow",!1),a=i.attr.getBoolean("firstCol",!1),l=i.attr.getBoolean("firstRow",!1),h=i.attr.getBoolean("lastCol",!1),d=i.attr.getBoolean("lastRow",!1),u=i.attr.getBoolean("rtl",!1);return{tableStyle:n,bandCol:s,bandRow:o,firstCol:a,firstRow:l,lastCol:h,lastRow:d,rtl:u}}else return{tableStyle:void 0,bandCol:!1,bandRow:!1,firstCol:!1,firstRow:!1,lastCol:!1,lastRow:!1,rtl:!1}}var ni=/*#__PURE__*/function(){function ni(e,t){_classCallCheck(this,ni);this.tcStyle=e,this.lnKey=t}_createClass(ni,[{key:"getBorderColor",value:function getBorderColor(e){var t,i,r,n,s;var o=this.tcStyle&&((s=(n=(r=(i=(t=this.tcStyle.tcStyle)==null?void 0:t.tcBdr)==null?void 0:i[this.lnKey])==null?void 0:r.ln)==null?void 0:n.solidFill)==null?void 0:s.schemeClr);if(o)return Tu(o,e)}},{key:"getBorderWidth",value:function getBorderWidth(){var e,t,i;var r=this.tcStyle&&((i=(t=(e=this.tcStyle.tcStyle)==null?void 0:e.tcBdr)==null?void 0:t[this.lnKey])==null?void 0:i.ln);if(r)return Number(r.w)}},{key:"getBorderType",value:function getBorderType(){var e,t,i;var r=this.tcStyle&&((i=(t=(e=this.tcStyle.tcStyle)==null?void 0:e.tcBdr)==null?void 0:t[this.lnKey])==null?void 0:i.ln);if(r){var n=r.prstDash;if(n&&n.val)return n.val}return"solid"}}]);return ni}(),st=/*#__PURE__*/function(){function st(e,t){_classCallCheck(this,st);this.tcPrXMl=e,this.lnKey=t}_createClass(st,[{key:"getBorderColor",value:function getBorderColor(e){var t=this.tcPrXMl.childElementOptional(this.lnKey);if(t)return new zr().read(t.childElement(_construct(Y,Ss)),e)}},{key:"getBorderWidth",value:function getBorderWidth(){var e=this.tcPrXMl.childElementOptional(this.lnKey);if(e)return e.attr.getNumber("w",0)}},{key:"getBorderType",value:function getBorderType(){var e=this.tcPrXMl.childElementOptional(this.lnKey);if(e){var t=e.childElementOptional("a:prstDash");if(t&&t.attr.has("val")){var i=t.attr.getStringOptional("val");return i==="dot"||i==="sysDot"?"dotted":i==="dash"||i==="sysDash"?"dashed":"solid"}}}},{key:"getBorderStrokeDashArray",value:function getBorderStrokeDashArray(){var e=this.getBorderWidth(),t=this.getBorderType();if(!(e===void 0||t===void 0))switch(t){case"solid":return"0";case"dash":return"".concat(5*e);case"dashDot":return" ".concat(5*e,", ").concat(5*e,", ").concat(e,", ").concat(5*e);case"dot":return"".concat(e,",  ").concat(5*e);case"lgDash":return"".concat(2*e,", ").concat(e);case"lgDashDot":return"".concat(10*e,", ").concat(5*e,", ").concat(e,", ").concat(5*e,", ").concat(e,", ").concat(5*e);case"sysDash":return"".concat(5*e,", ").concat(2*e);case"sysDashDot":return"".concat(5*e,", ").concat(2*e,", ").concat(e,", ").concat(5*e);case"sysDashDotDot":return"".concat(5*e,", ").concat(2*e,", ").concat(e,", ").concat(5*e,", ").concat(e,", ").concat(5*e);case"sysDot":return"".concat(2*e,", ").concat(5*e);default:return"0";}}}]);return st}();function HM(e){e.bindChildPicker(["p:cSld"],"getBackgroundImageFill",_M),e.bindAttributePicker(["p:cSld"],"backgroundResId",KM),e.bindAttributePicker(["p:cSld"],"backgroundImageResourceType",GM),e.bindAttributePicker(["p:cSld"],"backgroundColor",$M)}var _M=function _M(e,t,i,r,n){var s=Yl(e,t,i,r,n);if(s.bgXML&&s.bgXML.hasChildElementWithName("p:bgRef")){var o=s.bgXML.childElement("p:bgRef").attr.getNumber("idx");return t.theme.childElement("a:theme","a:themeElements","a:fmtScheme","a:bgFillStyleLst").elements[o-1e3-1]}else return s.bgXML.childElementOptional("p:bgPr","a:blipFill")},KM=function KM(e,t,i,r,n){var s=Yl(e,t,i,r,n);if(s.bgXML&&s.bgXML.hasChildElementWithName("p:bgRef")){var o=s.bgXML.childElement("p:bgRef").attr.getNumber("idx"),a=t.theme.childElement("a:theme","a:themeElements","a:fmtScheme","a:bgFillStyleLst").elements[o-1e3-1];if(a.name==="a:blipFill")return yS(a)}else{var _o30=s.bgXML.childElementOptional("p:bgPr","a:blipFill");return yS(_o30)}};function yS(e){if(e)return e.childElement("a:blip").attr.getStringOptional("r:embed")}var GM=function GM(e,t,i,r,n){var s=Yl(e,t,i,r,n);return s.bgXML&&s.bgXML.hasChildElementWithName("p:bgRef")?"theme":s.resourceType},$M=function $M(e,t,i,r,n){var s=Yl(e,t,i,r,n);if(s.bgXML&&s.bgXML.hasChildElementWithName("p:bgRef")){var o=s.bgXML.childElement("p:bgRef").attr.getNumber("idx"),a=t.theme.childElement("a:theme","a:themeElements","a:fmtScheme","a:bgFillStyleLst").elements[o-1e3-1];return new zr(s.bgXML.childElement("p:bgRef").childElementOptional("a:schemeClr")).read(a,t)}else return new zr().read(s.bgXML.childElement("p:bgPr",_construct(Y,Ss)),t)};function Yl(e,t,i,r,n){var s=r.bgXML;return s||(s=r.bgXML=Object.freeze(YM(e,t))),s}function YM(e,t){return e.hasChildElementWithName("p:bg")?{bgXML:e.childElement("p:bg"),resourceType:"slide"}:t.layout.childElementOptional("p:sldLayout","p:cSld","p:bg")?{bgXML:t.layout.childElement("p:sldLayout","p:cSld","p:bg"),resourceType:"layout"}:{bgXML:t.master.childElement("p:sldMaster","p:cSld","p:bg"),resourceType:"master"}}var Es=new T2;fM(Es);B2(Es);DM(Es);jM(Es);HM(Es);function XM(){return Es.createPickers()}var Xu=/*#__PURE__*/function(){function Xu(e,t){_classCallCheck(this,Xu);this.slideXML=e,this.context=t,this.animations=[]}_createClass(Xu,[{key:"collect",value:function collect(){var e=this.slideXML.childElementOptional(new Y("p:sld","p:sldMaster","p:sldLayout"),"p:timing","p:tnLst","p:par","p:cTn","p:childTnLst");if(e){var t=e.elementsWithName("p:seq");for(var i=0;i<t.length;++i){var _r147=t[i],n=_r147.childElement("p:cTn").attr.getString("nodeType","afterEffect");this.searchAndIndexParXMLs(_r147,n,[i],0,void 0)}}return this.animations}},{key:"searchAndIndexParXMLs",value:function searchAndIndexParXMLs(e,t,i,r,n){var s=e.childElementOptional("p:cTn","p:childTnLst"),o=s?s.elementsWithName("p:par"):[],a=e.childElementOptional("p:cTn","p:stCondLst","p:cond"),l=n,h=0;if(a){h=a&&a.attr.getNumberOptional("delay")||0;var d=a.childElementOptional("p:tgtEl","p:spTgt");if(d&&(l=Hr(this.context.resourceType)+d.attr.getString("spid"),this.context.shapeParamsIndex[l].hidden))return}if(o.length===0)this.handleLeafParXML(e,t,i,r,l);else for(var _d12=0;_d12<o.length;++_d12){this.searchAndIndexParXMLs(o[_d12],t,[].concat(_toConsumableArray(i),[_d12]),r+h,l)}}},{key:"handleLeafParXML",value:function handleLeafParXML(e,t,i,r,n){var s,o,a;var l=e.childElementOptional("p:cTn","p:iterate"),h=(s=l==null?void 0:l.attr)==null?void 0:s.getStringOptional("type"),d,u,p=l==null?void 0:l.childElementOptional("p:tmPct");if(p&&(u=Te(p.attr.getString("val"))),u==null){var Ne=l==null?void 0:l.childElementOptional("p:tmAbs");Ne&&(d=Ne.attr.getNumberOptional("val"))}var f=function f(Ne){return d!=null?d:u!=null?u*Ne:0},m=e.childElementOptional("p:cTn","p:childTnLst"),g=m&&m.element.childElementOptional("p:cBhvr","p:tgtEl","p:spTgt"),y=g?Hr(this.context.resourceType)+g.attr.getString("spid"):"",b=g==null?void 0:g.childElementOptional("p:txEl","p:pRg"),v=(o=b==null?void 0:b.attr)==null?void 0:o.getNumberOptional("st"),w=(a=b==null?void 0:b.attr)==null?void 0:a.getNumberOptional("end"),M=!!(g==null?void 0:g.childElementOptional("p:bg")),x=v!=null&&w!=null?{start:v,end:w}:null;if(!this.context.shapeParamsIndex[y]||this.context.shapeParamsIndex[y].hidden)return;var T=e.childElement("p:cTn"),O=e.childElementOptional("p:cTn","p:stCondLst","p:cond"),R=m?m.elements:[],W=Number.MIN_SAFE_INTEGER;R.forEach(function(Ne){var St=0,Je=Ne.childElementOptional("p:cBhvr","p:cTn","p:stCondLst","p:cond");Je&&(St=Je.attr.getNumberOptional("delay")||0);var wt=Ne.childElement("p:cBhvr","p:cTn").attr.getNumberOptional("dur");wt===void 0&&(wt=1),wt+St>W&&(W=wt+St)});var J,ee=T.childElementOptional("p:endCondLst");ee!==void 0&&ee.childElement("p:cond").attr.getStringOptional("evt")==="onNext"&&(J="onNext");var z=T.attr.get("repeatCount","none");z!=="indefinite"&&z!=="none"&&(z=z/1e3,z===0&&(z="none"));var Re=T.attr.getStringOptional("presetClass");Re||(Re="entr");var Ht=Object.freeze({eventSourceShapeId:n,spId:y,pRg:x,pBg:M,textAnimMode:h,textAnimIterateDelay:f,sequenceType:t,animationXML:m,sequenceIndex:i[1],parallelIndex:i[3],isLoop:T.attr.has("repeatCount"),id:T.attr.getStringOptional("id")||"",presetClass:Re,presetID:T.attr.getStringOptional("presetID")||"",presetSubtype:T.attr.getStringOptional("presetSubtype"),repeatCount:z,repeatEndCondition:J,nodeType:T.attr.getStringOptional("nodeType")||"afterEffect",delay:O&&O.attr.getNumberOptional("delay")||0,parentDelay:r,duration:W,autoRev:T.attr.getBoolean("autoRev",!1),soundEffectId:this.parseAnimeSoundEffect(e),dimAfter:this.parseDimAfter(e)});this.animations.push(Ht)}},{key:"parseAnimeSoundEffect",value:function parseAnimeSoundEffect(e){var t=e.childElementOptional("p:cTn","p:subTnLst","p:audio");if(t!==void 0)return t.childElement("p:cMediaNode","p:tgtEl","p:sndTgt").attr.getString("r:embed")}},{key:"parseDimAfter",value:function parseDimAfter(e){var t,i;var r=e.childElementOptional("p:cTn","p:subTnLst","p:set","p:cBhvr");if(!r)return;var n=r.childElementOptional("p:attrNameLst","p:attrName");if(!!n&&!!String(n.text).includes("visibility"))return((i=(t=r.childElementOptional("p:cTn"))==null?void 0:t.attr)==null?void 0:i.getStringOptional("masterRel"))==="nextClick"?"next":"same"}}]);return Xu}();function QM(e){if(!e)return Jd;var t=e.replace(/\s+/g,"").split(";").map(function(s){var _s$split=s.split(","),_s$split2=_slicedToArray(_s$split,2),o=_s$split2[0],a=_s$split2[1];return{input:parseFloat(o),output:parseFloat(a)}});t[t.length-1].input<1&&t.push({input:1,output:1});var i=t.length-1,r=0,n=0;return function(s){if(s>=r)for(var o=n;o<i;o++){var a=t[o],l=t[o+1];if(s>=a.input&&s<=l.input)return n=o,r=s,bS(s,a,l)}else for(var _o31=n;_o31>=0;_o31--){var _a29=t[_o31],_l11=t[_o31+1];if(s>=_a29.input&&s<=_l11.input)return n=_o31,r=s,bS(s,_a29,_l11)}return n=0,r=0,s}}function bS(e,_ref87,_ref88){var t=_ref87.input,i=_ref87.output;var r=_ref88.input,n=_ref88.output;return(e-t)/(r-t)*(n-i)+i}var Gr=/*#__PURE__*/function(){function Gr(e){_classCallCheck(this,Gr);this.behaviorNode=e.childElement("p:cBhvr"),this.timingNode=this.behaviorNode.childElement("p:cTn")}_createClass(Gr,[{key:"animeId",value:function animeId(){var e;return String((e=this.timingNode.attr.getNumberOptional("id"))!=null?e:Date.now())}},{key:"duration",value:function duration(){var e=this.timingNode.attr.getStringOptional("dur");return e?e==="indefinite"?1/0:parseInt(e,10):1}},{key:"delay",value:function delay(){var e=this.timingNode.childElementOptional("p:stCondLst","p:cond");return e?e.attr.getNumber("delay",0):0}},{key:"ease",value:function ease(){var e=QM(this.timingNode.attr.getStringOptional("tmFilter")),t=this.timingNode.attr.getStringOptional("spd");if(t){var i=Te(t);if(!Number.isNaN(i)&&i!==1&&i!==0)return i>0?function(r){return e(r/i)}:function(r){return 1-e(r/-i)}}return e}},{key:"reverse",value:function reverse(){return Boolean(this.timingNode.attr.getBooleanOptional("autoRev"))}},{key:"rewind",value:function rewind(){var e=this.timingNode.attr.getStringOptional("fill");return e==="transition"||e==="remove"}},{key:"repeat",value:function repeat(){var e=this.timingNode.attr.get("repeatCount","");if(!e)return 1;if(e==="indefinite")return 1/0;var t=Number(e)/1e3;return Number.isNaN(t)?1:t}},{key:"attrNames",value:function attrNames(){var e=this.behaviorNode.childElementOptional("p:attrNameLst"),t=[];if(e){var i=e.elementsWithName("p:attrName");var _iterator217=_createForOfIteratorHelper(i),_step217;try{for(_iterator217.s();!(_step217=_iterator217.n()).done;){var _r148=_step217.value;var n=this.mapAttrName(_r148.text);n&&t.push(n)}}catch(err){_iterator217.e(err)}finally{_iterator217.f()}}return t}},{key:"mapAttrName",value:function mapAttrName(e){if(typeof e!="string")return;var t=e.toLowerCase();switch(t){case"ppt_x":case"ppt_y":case"ppt_w":case"ppt_h":case"xshear":case"yshear":case"fillcolor":return t;case"scalex":return"scaleX";case"scaley":return"scaleY";case"style.rotation":case"r":return"rotate";case"style.visibility":return"visible";case"style.opacity":return"opacity";default:break;}}}]);return Gr}();function qM(e){var t=ZM(e.split(/,|\s/i)),i=[],r,n,s;var _iterator218=_createForOfIteratorHelper(t),_step218;try{for(_iterator218.s();!(_step218=_iterator218.n()).done;){var o=_step218.value;if(/^[a-zA-Z]$/.test(o)){if(s!==void 0)throw new Error("invalid path: lack of number");r!==void 0&&i.push({sign:r,points:n}),r=o,n=[]}else{var a=parseFloat(o);if(Number.isNaN(a))throw new Error("invalid path: unrecognized number ".concat(JSON.stringify(o)));s===void 0?s=a:(n.push({x:s,y:a}),s=void 0)}}}catch(err){_iterator218.e(err)}finally{_iterator218.f()}if(s!==void 0)throw new Error("invalid path: lack of number");return r!==void 0&&i.push({sign:r,points:n}),i}function ZM(e){var t=[];var _iterator219=_createForOfIteratorHelper(e),_step219;try{for(_iterator219.s();!(_step219=_iterator219.n()).done;){var i=_step219.value;if(i!=="")if(i.length===1)t.push(i);else{var _r149=i[0];/[a-zA-Z]/.test(_r149)?(t.push(_r149),t.push(i.substring(1))):t.push(i)}}}catch(err){_iterator219.e(err)}finally{_iterator219.f()}return t}var vS=/*#__PURE__*/function(){function vS(){_classCallCheck(this,vS);for(var _len22=arguments.length,e=new Array(_len22),_key22=0;_key22<_len22;_key22++){e[_key22]=arguments[_key22]}if(e.length===0)throw new Error("expect 1 curve minimum");var t=[],i=0;for(var _i45=0,_e10=e;_i45<_e10.length;_i45++){var _r150=_e10[_i45];t.push(_r150.rectangle),i+=_r150.length}this.curves=Object.freeze(e),this.length=i,this.rectangle=vS.unionRectangles(t)}_createClass(vS,[{key:"get",value:function get(e){var t=0,i=0,r;var _iterator220=_createForOfIteratorHelper(this.curves),_step220;try{for(_iterator220.s();!(_step220=_iterator220.n()).done;){var n=_step220.value;if(r=n,i=t,e<t+n.length)break;t+=n.length}}catch(err){_iterator220.e(err)}finally{_iterator220.f()}return r.get(e-i)}}],[{key:"unionRectangles",value:function unionRectangles(e){var t=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;var _iterator221=_createForOfIteratorHelper(e),_step221;try{for(_iterator221.s();!(_step221=_iterator221.n()).done;){var s=_step221.value;s.left<t&&(t=s.left),s.right>i&&(i=s.right),s.top<r&&(r=s.top),s.bottom>n&&(n=s.bottom)}}catch(err){_iterator221.e(err)}finally{_iterator221.f()}return Object.freeze({left:t,right:i,top:r,bottom:n})}}]);return vS}(),SS=/*#__PURE__*/function(){function SS(e,t){_classCallCheck(this,SS);this.beginX=e.x,this.beginY=e.y,this.deltaX=t.x-e.x,this.deltaY=t.y-e.y,this.length=Math.sqrt(this.deltaX*this.deltaX+this.deltaY*this.deltaY),this.rectangle=Object.freeze({left:Math.min(e.x,t.x),right:Math.max(e.x,t.x),top:Math.min(e.y,t.y),bottom:Math.max(e.y,t.y)})}_createClass(SS,[{key:"get",value:function get(e){if(this.length===0)return{x:this.beginX,y:this.beginY};var t=e/this.length;return t=Math.max(0,t),t=Math.min(1,t),{x:this.beginX+t*this.deltaX,y:this.beginY+t*this.deltaY}}}]);return SS}(),Qu=/*#__PURE__*/function(){function Qu(e,t,i,r){_classCallCheck(this,Qu);this.bezier=new wS["default"]([e,t,i,r]),this.length=this.bezier.length(),this.rectangle=this.createRectangle()}_createClass(Qu,[{key:"createRectangle",value:function createRectangle(){var e=this.bezier.bbox();return Object.freeze({left:e.x.min,right:e.x.max,top:e.y.min,bottom:e.y.max})}},{key:"get",value:function get(e){var t=e/this.length;return t=Math.max(0,t),t=Math.min(1,t),this.bezier.get(t)}}]);return Qu}();function JM(e){var t=qM(e),i=[],r,n,s;var _iterator222=_createForOfIteratorHelper(t),_step222;try{for(_iterator222.s();!(_step222=_iterator222.n()).done;){var _step222$value=_step222.value,o=_step222$value.sign,a=_step222$value.points;switch(o){case"M":{xn(o,a,1),r=a[0],n=a[0],s=void 0;break}case"L":{xn(o,a,1),As(n),i.push(new SS(n,a[0])),n=a[0],s=void 0;break}case"Z":{xn(o,a,0),As(n),i.push(new SS(n,r)),n=r,s=void 0;break}case"C":{xn(o,a,3),As(n),i.push(new Qu(n,a[0],a[1],a[2])),s={controller:a[1],end:a[2]},n=a[2];break}case"S":{if(!s)throw new Error("invalid path: expect C or S before S");xn(o,a,2),As(n);var l=CS(s);i.push(new Qu(n,l,a[0],a[1])),s={controller:a[0],end:a[1]},n=a[1];break}case"Q":{xn(o,a,2),As(n),i.push(new Qu(n,a[0],a[1])),s={controller:a[0],end:a[1]},n=a[1];break}case"T":{if(!s)throw new Error("invalid path: expect Q or T before T");xn(o,a,1),As(n);var _l12=CS(s);s={controller:_l12,end:a[0]},s={controller:_l12,end:a[0]},n=a[0];break}case"E":break;default:throw new Error("invalid path: unrecognized sign ".concat(JSON.stringify(o)));}}}catch(err){_iterator222.e(err)}finally{_iterator222.f()}return _construct(vS,i)}function CS(e){var t=e.controller,i=e.end,r=i.x-t.x,n=i.y-t.y;return{x:i.x+r,y:i.y+n}}function xn(e,t,i){if(t.length!==i)throw new Error("invalid path: sign ".concat(e," should have ").concat(i," points (").concat(2*i," number)"))}function As(e){if(!e)throw new Error("invalid path: expect M")}var eT=function eT(_ref89){var e=_ref89.node,t=_ref89.animation,i=_ref89.animBox;var r=new Gr(e),n=e.attr.getString("path","M 0 0"),s=JM(n),_i$initState=i.initState,o=_i$initState.ppt_x,a=_i$initState.ppt_y;return new Xe({animBox:i,effectType:t.nodeType,playerID:r.animeId(),eventSource:t.eventSourceShapeId,duration:r.duration(),ease:r.ease(),repeat:r.repeat(),delay:r.delay(),reverse:r.reverse(),rewind:r.rewind(),transform:function transform(l){var _s$get=s.get(l*s.length),h=_s$get.x,d=_s$get.y;return{ppt_x:(h||0)+o,ppt_y:(d||0)+a}}})},qu=/*#__PURE__*/function(){function qu(_ref90){var e=_ref90.context,t=_ref90.animBox;_classCallCheck(this,qu);this.context=e,this.animBox=t}_createClass(qu,[{key:"parse",value:function parse(e,t){var i=e==null?void 0:e.childElementOptional(new Y("p:strVal","p:fltVal","p:clrVal","p:intVal"));if(i)switch(i.name){case"p:fltVal":case"p:intVal":{var _r151=parseFloat(i.attr.getString("val"));return qt(_r151)?_r151:void 0}case"p:clrVal":{var _r152=vn(i.childElement(_construct(Y,Fi)),this.context.slideContext);if(_r152){var _r152$rgb$object=_r152.rgb().object(),n=_r152$rgb$object.r,s=_r152$rgb$object.g,o=_r152$rgb$object.b;return new ve({r:n,g:s,b:o,a:1})}return}default:return qt(this.animBox.initState[t])?new Fr(i.attr.getString("val"),this.formulaScope):t==="visible"?i.attr.getString("val")!=="hidden":i.attr.getString("val");}}},{key:"formulaScope",get:function get(){return this._formulaScope?this._formulaScope:this._formulaScope=new Ro(this.animBox)}}]);return qu}(),tT=function tT(_ref91){var e=_ref91.node,t=_ref91.animation,i=_ref91.context,r=_ref91.animBox;var n=new Gr(e),s=n.attrNames(),o={},a=new qu({context:i,animBox:r});var _iterator223=_createForOfIteratorHelper(s),_step223;try{for(_iterator223.s();!(_step223=_iterator223.n()).done;){var l=_step223.value;switch(l){case"visible":{var h=a.parse(e.childElementOptional("p:to"),"visible");h!=null&&(o.visible=h,r.preAnimation()||r.preAnimation({visible:!h}));break}case"opacity":case"xshear":case"yshear":{var _h12=a.parse(e.childElementOptional("p:to"),l);_h12!=null&&(o[l]=_h12);break}default:break;}}}catch(err){_iterator223.e(err)}finally{_iterator223.f()}return new Xe({animBox:r,effectType:t.nodeType,playerID:n.animeId(),eventSource:t.eventSourceShapeId,duration:n.duration(),delay:n.delay(),transform:Bi(function(){var l={};for(var h in o){if(Rt(o,h))switch(h){case"visible":{l.visible=!o.visible;break}case"opacity":case"xshear":case"yshear":{l[h]=r.currentState[h];break}default:break;}}return l},o)})},iT=function iT(_ref92){var e=_ref92.animBox,t=_ref92.node,i=_ref92.animation;var r=t.attr.getStringOptional("transition");if(!r)return;var n=new Gr(t),s=0,o=1;return r==="out"&&(s=1,o=0),new Xe({animBox:e,effectType:i.nodeType,playerID:n.animeId(),eventSource:i.eventSourceShapeId,duration:n.duration(),ease:n.ease(),repeat:n.repeat(),delay:n.delay(),reverse:n.reverse(),rewind:n.rewind(),by:!0,transform:su({opacity:s},{opacity:o})})},rT=function rT(_ref93){var e=_ref93.node,t=_ref93.animation,i=_ref93.animBox,r=_ref93.context;var n=new Gr(e);if(!n.attrNames().includes("fillcolor"))return;var s=!1,o;if(o=Zu(r.slideContext,e.childElementOptional("p:to")),o||(s=!0,o=Zu(r.slideContext,e.childElementOptional("p:by"))),!o)return;var a=o,l=Zu(r.slideContext,e.childElementOptional("p:from")),h;return new Xe({animBox:i,effectType:t.nodeType,playerID:n.animeId(),eventSource:t.eventSourceShapeId,duration:n.duration(),ease:n.ease(),repeat:n.repeat(),delay:n.delay(),reverse:n.reverse(),rewind:n.rewind(),by:s,transform:function transform(d){l||(l=i.currentState.fillcolor,h=l.alpha());var u=ru(l,a,d);return{fillcolor:h>0?u.alpha(h):u}}})};function Zu(e,t){if(!t)return;var i=t.childElementOptional(new Y("p:rgb","p:hsl"));if(i)switch(i.name){case"p:rgb":return new ve({r:i.attr.getNumber("r"),g:i.attr.getNumber("g"),b:i.attr.getNumber("b"),a:1});case"p:hsl":return new ve({h:i.attr.getNumber("h")/Lt,s:i.attr.getNumber("s")/K*100,l:i.attr.getNumber("l")/K*100,a:1});}else{var _r153=t.childElement(_construct(Y,Fi)),n=vn(_r153,e);if(n){var _n$rgb$object=n.rgb().object(),s=_n$rgb$object.r,o=_n$rgb$object.g,a=_n$rgb$object.b;return new ve({r:s,g:o,b:a,a:1})}}}var nT=function nT(_ref94){var e=_ref94.node,t=_ref94.animation,i=_ref94.context,r=_ref94.animBox;var n=new Gr(e),s=!1,o=Ju(e.attr.getStringOptional("to"));if(o==null&&(s=!0,o=Ju(e.attr.getStringOptional("by"))),o==null){var h=new qu({context:i,animBox:r}).parse(e.childElementOptional("p:by"),"rotate");qt(h)&&(o=gs(Number(h)))}if(o==null)return;var a=o,l=Ju(e.attr.getStringOptional("from"));return new Xe({animBox:r,effectType:t.nodeType,playerID:n.animeId(),eventSource:t.eventSourceShapeId,duration:n.duration(),ease:n.ease(),repeat:n.repeat(),delay:n.delay(),reverse:n.reverse(),rewind:n.rewind(),by:s,transform:Bi(function(){var h;return{rotate:l!=null?l:s?0:(h=r.currentState.rotate)!=null?h:0}},{rotate:a})})};function Ju(e){var t=Number(e);if(!Number.isNaN(t))return gs(t)}var sT=function sT(_ref95){var e=_ref95.node,t=_ref95.animation,i=_ref95.animBox;var r=new Gr(e),n=!1,s=ep(e.childElementOptional("p:to"));if(s==null&&(n=!0,s=ep(e.childElementOptional("p:by"))),s==null)return;var o=s,a=ep(e.childElementOptional("p:from"));return new Xe({animBox:i,effectType:t.nodeType,playerID:r.animeId(),eventSource:t.eventSourceShapeId,duration:r.duration(),ease:r.ease(),repeat:r.repeat(),delay:r.delay(),reverse:r.reverse(),rewind:r.rewind(),by:n,transform:Bi(function(){var l,h;return a!=null?a:n?{scaleX:1,scaleY:1}:{scaleX:(l=i.currentState.scaleX)!=null?l:1,scaleY:(h=i.currentState.scaleY)!=null?h:1}},o)})};function ep(e){if(e)return{scaleX:Te(e.attr.getString("x")),scaleY:Te(e.attr.getString("y"))}}var oT=function oT(_ref96){var e=_ref96.node,t=_ref96.animation,i=_ref96.animBox;var r=new Gr(e),n=aT(e.attr.getString("cmd"));return new No({animBox:i,effectType:t.nodeType,playerID:r.animeId(),eventSource:t.eventSourceShapeId,duration:1,delay:r.delay(),reverse:r.reverse(),rewind:r.rewind(),cmd:n})};function aT(e){var t=/^playFrom\(([^)]+)\)$/.exec(e);return t?{name:"playFrom",value:parseFloat(t[1])}:e.includes("pause")?{name:"pause"}:{name:"stop"}}function lT(_ref97,r,n){var e=_ref97.node,t=_ref97.context,i=_ref97.animBox;function s(h){if(h){if(qt(i.initState[n]))return new Fr(h,a.formulaScope);console.error("Expr ".concat(h," cannot work with targetKey ").concat(n))}}var o=e.childElementOptional("p:tavLst");if(!o)return;var a=new qu({context:t,animBox:i}),l=o.elementsWithName("p:tav").map(function(h){var d=a.parse(h.childElement("p:val"),n);if(d==null)return;var u=Te(h.attr.getString("tm")),p=s(h.attr.getStringOptional("fmla"));return{val:d,progress:u,fmla:p}}).filter(function(h){return Boolean(h)});if(!(l.length<=0))if(r==="lin"){if(qt(l[0].val))return tp(l,n,Dr);if(l[0].val instanceof ve)return tp(l,n,ou)}else return tp(l,n,cT)}function tp(e,t,i){return function(r){for(var o=1;o<e.length;o++){var a=e[o-1],l=e[o];if(r>=a.progress&&r<=l.progress){var h=i(a.val,l.val,(r-a.progress)/(l.progress-a.progress));return _defineProperty({},t,a.fmla?a.fmla.evaluate(h):h)}}var _e11=e[e.length-1],n=_e11.fmla,s=_e11.val;return _defineProperty({},t,n?n.evaluate(s):s)}}function cT(e,t,i){return i<1?e:t}var hT=/*#__PURE__*/function(){function hT(e,t){_classCallCheck(this,hT);this.node=e,this.animBox=t}_createClass(hT,[{key:"parse",value:function parse(e,t){var i=this.node.attr.getStringOptional(e);if(!i)return;var r=this.animBox.initState[t];if(r instanceof ve)try{return new ve(i)}catch(n){return}if(qt(r)){var n=Number(i);return qt(n)?n:(e==="by"&&(t==="ppt_x"||t==="ppt_y")&&(i+="+#".concat(t)),new Fr(i,this.formulaScope))}if(t==="visible")return i!=="hidden"}},{key:"formulaScope",get:function get(){return this._formulaScope?this._formulaScope:this._formulaScope=new Ro(this.animBox)}}]);return hT}(),dT=function dT(e){var t=e.node,i=e.animation,r=e.animBox,n=new Gr(t),s=t.attr.getString("calcmode","lin"),o=n.attrNames()[0];if(!o){console.error("Missing attrName for p:anim",n.animeId());return}var a=new hT(t,r),l=!1,h=lT(e,s,o);if(!h){var d=a.parse("from",o),u=a.parse("to",o);if(u||(l=!0,u=a.parse("by",o)),!u)return;h=Bi(function(){return _defineProperty({},o,d!=null?d:r.currentState[o])},_defineProperty({},o,u))}return new Xe({animBox:r,effectType:i.nodeType,playerID:n.animeId(),eventSource:i.eventSourceShapeId,duration:n.duration(),ease:n.ease(),repeat:n.repeat(),delay:n.delay(),reverse:n.reverse(),rewind:n.rewind(),by:l,transform:h})},uT=function uT(e){switch(e.node.name){case"p:animMotion":return eT(e);case"p:set":return tT(e);case"p:animEffect":return iT(e);case"p:anim":return dT(e);case"p:animClr":return rT(e);case"p:animRot":return nT(e);case"p:animScale":return sT(e);case"p:cmd":return oT(e);default:console.error("failed parsing ".concat(e.node.name," animation node"));}};function pT(e,t){if(e.soundEffectId)return new No({animBox:t,effectType:e.nodeType,playerID:"SF".concat(String(Date.now())),eventSource:e.eventSourceShapeId,duration:1,delay:0,cmd:{name:"playSF",value:e.soundEffectId}})}function kS(e,t,i){return new Xe({animBox:e,effectType:t,playerID:"Dim".concat(String(Date.now())),duration:1,delay:i,transform:Bi(function(){return{visible:e.currentState.visible}},{visible:!1})})}function mT(e){return typeof e=="number"?e:e==="indefinite"?1/0:1}var Xl=/*#__PURE__*/function(){function Xl(e,t){var _this253=this;_classCallCheck(this,Xl);this.animations=e,this.context=t,this.mainPlayerSeq=[],this.interactivePlayerSeqs=new Map,this.subNextPlayerAnimBoxes=new Map,this.textAnimSpIds=new Set,this.triggerEvent=new wu,this.animBoxes=new Map,this.textCount=0;var i,r,n;this.type=t.resourceType;for(var s=0;s<this.animations.length;s+=1){var o=this.animations[s],a=this.getAnimationSeq(o);if(!a)continue;var l=this.getAnimBox(o.spId,(i=o.pRg)==null?void 0:i.start),h=void 0;if((o.textAnimMode==="lt"||o.textAnimMode==="wd")&&!o.pBg)this.textAnimSpIds.add(o.spId),h=this.getTextAnimationPlayer(o,l);else if(h=this.getAnimationPlayer(o,l),h&&o.parentDelay>0){var u=o.parentDelay-a.reduce(function(p,f){return p+f.duration},0);u>0&&(h=new fs({players:[h],effectType:h.effectType,delay:u}))}if(!h)continue;h=this.joinSubSamePlayers(h,o,l);var d=this.getSubNextPlayerAnimBoxes(this.getSeqId(o));a.length>0&&h.effectType!==a[a.length-1].effectType&&this.squashLastSeqPlayers(a),h.effectType!=="withEffect"&&this.joinLastSubNextIntoPlayers(this.getSeqId(o),a),(h.effectType!=="withEffect"||s===0)&&d.push([]),o.dimAfter==="next"&&d[d.length-1].push(l),a.push(h)}this.squashLastSeqPlayers(this.mainPlayerSeq),this.joinLastSubNextIntoPlayers("mainSeq",this.mainPlayerSeq),this.interactivePlayerSeqs.forEach(function(s,o){_this253.squashLastSeqPlayers(s),_this253.joinLastSubNextIntoPlayers(o,s)}),this.mainSeq=new Ao({playerID:"mainSeq",players:this.mainPlayerSeq,effectType:(n=(r=this.mainPlayerSeq[0])==null?void 0:r.effectType)!=null?n:"clickEffect"}),this.interactiveSeqs=new Map,this.interactivePlayerSeqs.forEach(function(s,o){var a,l;_this253.interactiveSeqs.set(o,new Ao({playerID:"interactiveSeq"+o,players:s,effectType:(l=(a=s[0])==null?void 0:a.effectType)!=null?l:"clickEffect"}))})}_createClass(Xl,[{key:"withTextAnimation",value:function withTextAnimation(e){return this.textAnimSpIds.has(e)}},{key:"end",value:function end(){console.log("[animation manager]: end"),this.mainSeq.seek(this.mainSeq.duration+1)}},{key:"pause",value:function pause(){console.log("[animation manager]: pause");var _iterator224=_createForOfIteratorHelper(this.mainSeq.players),_step224;try{for(_iterator224.s();!(_step224=_iterator224.n()).done;){var e=_step224.value;e.pause()}}catch(err){_iterator224.e(err)}finally{_iterator224.f()}this.interactiveSeqs.forEach(function(e){var _iterator225=_createForOfIteratorHelper(e.players),_step225;try{for(_iterator225.s();!(_step225=_iterator225.n()).done;){var t=_step225.value;t.pause()}}catch(err){_iterator225.e(err)}finally{_iterator225.f()}})}},{key:"reset",value:function reset(){var _this254=this;console.log("[animation manager]: reset"),this.mainSeq.reset(),this.interactiveSeqs.forEach(function(e){return e.reset()}),ar.render(function(){_this254.animBoxes.forEach(function(e){return e.clearCache()})},!1,!1)}},{key:"logSeq",value:function logSeq(){var e="";e+="mainSeq\n",t(this.mainSeq,"  "),e+="interactiveSeqs\n",this.interactiveSeqs.forEach(function(i){return t(i,"  ")}),console.log(e);function t(i){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";i instanceof Ao?(e+="".concat(r,"seq ").concat(i.effectType,"\n"),i.players.forEach(function(n){return t(n,r+"  ")})):i instanceof Lr?(e+="".concat(r,"par ").concat(i.effectType,"\n"),i.players.forEach(function(n){return t(n,r+"  ")})):i instanceof fs?(e+="".concat(r,"par2 ").concat(i.effectType,"\n"),i.players.forEach(function(n){return t(n,r+"  ")})):e+="".concat(r).concat(i.playerID," ").concat(i.effectType,"\n")}}},{key:"getPlayer",value:function getPlayer(e,t){var i=t;i||(i=[this.mainSeq].concat(_toConsumableArray(Array.from(this.interactiveSeqs.values()))));var _iterator226=_createForOfIteratorHelper(i),_step226;try{for(_iterator226.s();!(_step226=_iterator226.n()).done;){var _r154=_step226.value;if(_r154.playerID===e)return _r154;var n=_r154.players;if(n){var s=this.getPlayer(e,n);if(s)return s}}}catch(err){_iterator226.e(err)}finally{_iterator226.f()}}},{key:"getAnimationSeq",value:function getAnimationSeq(e){switch(e.sequenceType){case"mainSeq":return this.mainPlayerSeq;case"interactiveSeq":{if(e.eventSourceShapeId!==void 0)return this.getInteractiveSeq(bi(this.context.pptUUID,this.context.slideIndex,e.eventSourceShapeId));console.error("interactiveSeq animation ".concat(e.id," does not have eventSourceShapeId"),e);break}default:console.error("not support sequenceType: \"".concat(e.sequenceType,"\""),e);}}},{key:"getInteractiveSeq",value:function getInteractiveSeq(e){var t=this.interactivePlayerSeqs.get(e);return t||(t=[],this.interactivePlayerSeqs.set(e,t)),t}},{key:"getTextScale",value:function getTextScale(e){var t=1/0;return e.forEach(function(i){i.prop.size<t&&(t=i.prop.size)}),t>=12?1:t/12}},{key:"getTextRect",value:function getTextRect(e,t){var i,r,n,s,o,a,l;var h=0;if(e){var _iterator227=_createForOfIteratorHelper(e.paragraphs),_step227;try{for(_iterator227.s();!(_step227=_iterator227.n()).done;){var d=_step227.value;var _iterator228=_createForOfIteratorHelper(d.lines),_step228;try{for(_iterator228.s();!(_step228=_iterator228.n()).done;){var u=_step228.value;var p=this.getTextScale(u);var _iterator229=_createForOfIteratorHelper(u),_step229;try{for(_iterator229.s();!(_step229=_iterator229.n()).done;){var f=_step229.value;if(h<=t&&h+((r=(i=f.text)==null?void 0:i.length)!=null?r:0)>t){var m=Number(f.prop.width)/p/((s=(n=f.text)==null?void 0:n.length)!=null?s:1);return{height:(o=f.prop.height)!=null?o:f.prop.size,width:m,textScale:p}}else h+=(l=(a=f.text)==null?void 0:a.length)!=null?l:0}}catch(err){_iterator229.e(err)}finally{_iterator229.f()}}}catch(err){_iterator228.e(err)}finally{_iterator228.f()}}}catch(err){_iterator227.e(err)}finally{_iterator227.f()}}}},{key:"getParagraphRect",value:function getParagraphRect(e,t){var i=e==null?void 0:e.paragraphs[t],r=e==null?void 0:e.prop.width,n=i==null?void 0:i.lines.map(function(s){return Math.max.apply(Math,_toConsumableArray(s.map(function(o){var a;return(a=o.prop.height)!=null?a:o.prop.size})))}).reduce(function(s,o){return s+o},0);if(r&&n)return{height:n,width:r,textScale:1}}},{key:"getTextWrapper",value:function getTextWrapper(e){var t,i,r,n,s,o,a,l,h,d,u,p,f,m,g;return e.includes("m")?(s=(n=(r=(i=(t=this.context.wrapResource)==null?void 0:t.master)==null?void 0:i.shapes)==null?void 0:r[e.replace("m","")])==null?void 0:n.textBodyMap)==null?void 0:s[0]:e.includes("l")?(d=(h=(l=(a=(o=this.context.wrapResource)==null?void 0:o.layout)==null?void 0:a.shapes)==null?void 0:l[e.replace("l","")])==null?void 0:h.textBodyMap)==null?void 0:d[0]:(g=(m=(f=(p=(u=this.context.wrapResource)==null?void 0:u.slide)==null?void 0:p.shapes)==null?void 0:f[e])==null?void 0:m.textBodyMap)==null?void 0:g[0]}},{key:"getAnimBox",value:function getAnimBox(e,t,i){var r,n,s;var o=e,a=i!=null,l=t!=null;l?(o+=",".concat(t),a&&(o+=",".concat(i))):a&&(o+=",,".concat(i));var h=this.animBoxes.get(o);if(!h){var d=this.context.shapeParamsIndex[e],u=au;if(d.fillColor){var _d$fillColor$rgb$obje=d.fillColor.rgb().object(),g=_d$fillColor$rgb$obje.r,y=_d$fillColor$rgb$obje.g,b=_d$fillColor$rgb$obje.b,v=_d$fillColor$rgb$obje.alpha;u=new ve({r:g,g:y,b:b,a:v!=null?v:1})}var p,f=bi(this.context.pptUUID,this.context.slideIndex,e),m=d.rotate?gs(d.rotate):0;if(a||l){m=0;var _g9=this.getTextWrapper(e);a?(p=this.getTextRect(_g9,this.textCount),this.textCount+=1):l&&(p=this.getParagraphRect(_g9,t))}h=new Su({target:f,pIndex:p?t:void 0,tIndex:p?i:void 0,constants:{x:d.rectangle.x,y:d.rectangle.y,width:p?p.width*Nt:d.rectangle.width||1,height:p?p.height*Nt:d.rectangle.height||1,slideWidth:this.context.slideWidth/((r=p==null?void 0:p.textScale)!=null?r:1),slideHeight:this.context.slideHeight/((n=p==null?void 0:p.textScale)!=null?n:1),flipH:d.flipH,flipV:d.flipV},initState:{opacity:(s=d.opacity)!=null?s:1,fillcolor:u,rotate:m}}),this.animBoxes.set(o,h)}return h}},{key:"squashLastSeqPlayers",value:function squashLastSeqPlayers(e,t){var i,r;if(e.length<=1)return;var n=e[e.length-1].effectType;if(n!=="withEffect")return;var s=e.length-1;for(;s>0&&e[s].effectType===n;){s-=1}var o=e.splice(s,e.length-s);e.push(new Lr({players:o,effectType:(r=t!=null?t:(i=o[0])==null?void 0:i.effectType)!=null?r:"clickEffect"}))}},{key:"getAnimationPlayer",value:function getAnimationPlayer(e,t){if(!e.animationXML)return;var i=[],r=e.animationXML.elements;var _iterator230=_createForOfIteratorHelper(r),_step230;try{for(_iterator230.s();!(_step230=_iterator230.n()).done;){var _s35=_step230.value;var o=uT({node:_s35,animation:e,context:this.context,triggerEvent:this.triggerEvent,animBox:t});!o||(t.preAnimation()||t.preAnimation({}),i.push(o))}}catch(err){_iterator230.e(err)}finally{_iterator230.f()}if(i.length<=0)return;if(e.soundEffectId){var s=pT(e,t);s&&i.push(s)}var n=mT(e.repeatCount);return e.delay>0||n>1||e.autoRev?new fs({playerID:"parr"+e.id,players:i,effectType:e.nodeType,delay:e.delay,repeat:n,reverse:Boolean(e.autoRev)}):i.length>1?new Lr({playerID:"par"+e.id,players:i,effectType:e.nodeType}):i[0]}},{key:"getTextAnimationPlayer",value:function getTextAnimationPlayer(e,t){var _this255=this;var i;var r=f2(this.context.wrapResource,e.spId,(i=e.pRg)==null?void 0:i.start,e.textAnimMode==="wd");if(r===0)return this.getAnimationPlayer(e,t);var n=Array(r).fill(0).map(function(s,o){var a;var l=_this255.getAnimBox(e.spId,(a=e.pRg)==null?void 0:a.start,o),h=_this255.getAnimationPlayer(e,l);return h?new fs({effectType:e.nodeType,delay:e.textAnimIterateDelay(h.duration-h.delay)*o,players:[h]}):null}).filter(function(s){return Boolean(s)});return n.length<=1?n[0]:new Lr({effectType:e.nodeType,players:n})}},{key:"joinSubSamePlayers",value:function joinSubSamePlayers(e,t,i){return t.sequenceType!=="mainSeq"||t.dimAfter!=="same"?e:new Lr({players:[e,kS(i,"withEffect",e.duration+32)],effectType:e.effectType})}},{key:"joinLastSubNextIntoPlayers",value:function joinLastSubNextIntoPlayers(e,t){var i=this.getSubNextPlayerAnimBoxes(e),r=t[t.length-1],n=i[i.length-2];if(!r||!n||n.length<=0)return;var s=[r];var _iterator231=_createForOfIteratorHelper(n),_step231;try{for(_iterator231.s();!(_step231=_iterator231.n()).done;){var o=_step231.value;s.push(kS(o,"withEffect",r.delay))}}catch(err){_iterator231.e(err)}finally{_iterator231.f()}t[t.length-1]=new Lr({players:s,effectType:r.effectType})}},{key:"getSubNextPlayerAnimBoxes",value:function getSubNextPlayerAnimBoxes(e){var t=this.subNextPlayerAnimBoxes.get(e);return t||(t=[],this.subNextPlayerAnimBoxes.set(e,t)),t}},{key:"getSeqId",value:function getSeqId(e){return e.sequenceType==="interactiveSeq"&&e.eventSourceShapeId!==void 0?bi(this.context.pptUUID,this.context.slideIndex,e.eventSourceShapeId):"mainSeq"}}]);return Xl}();function fT(e,t){var i=new Xu(t.slideContext.master,F(A({},t),{resourceType:"master",shapeParamsIndex:t.masterShapeParamsIndex})).collect(),r=new Xu(t.slideContext.layout,F(A({},t),{resourceType:"layout",shapeParamsIndex:t.layoutShapeParamsIndex})).collect(),n=new Xu(e,F(A({},t),{resourceType:"slide",shapeParamsIndex:t.slideShapeParamsIndex})).collect(),s=new Xl(i,F(A({},t),{resourceType:"master",shapeParamsIndex:t.masterShapeParamsIndex})),o=new Xl(r,F(A({},t),{resourceType:"layout",shapeParamsIndex:t.layoutShapeParamsIndex})),a=new Xl(n,F(A({},t),{resourceType:"slide",shapeParamsIndex:t.slideShapeParamsIndex})),l=new Xl(i.concat.apply(i,_toConsumableArray(r).concat(_toConsumableArray(n))),F(A({},t),{resourceType:"main",shapeParamsIndex:A(A(A({},t.slideShapeParamsIndex),t.layoutShapeParamsIndex),t.masterShapeParamsIndex)})),h={slide:0,layout:0,master:0};return h.slide=a.mainSeq.length,h.layout=o.mainSeq.length,h.master=s.mainSeq.length,a.mainSeq.effectType!=="clickEffect"&&(h.layout>0?h.layout-=1:h.master>0&&(h.master-=1)),o.mainSeq.effectType!=="clickEffect"&&h.master>0&&(h.master-=1),[a,o,s].forEach(function(d){d.triggerEvent.on("onEnd",function(_ref101){var u=_ref101.target;u==="slide"?(a.end(),l.end()):u==="layout"?o.end():u==="master"&&s.end()}),d.triggerEvent.on("onUnmount",function(_ref102){var u=_ref102.target;u==="slide"?(a.reset(),l.reset()):u==="layout"?o.reset():u==="master"&&s.reset()})}),{masterAnimationManager:s,layoutAnimationManager:o,slideAnimationManager:a,mainAnimationManager:l,animationCount:h,sequenceAnimesCounts:{get"-1"(){return a.mainSeq.length}}}}var gT="masterPartName",yT="layoutPartName";function bT(_x126,_x127){return _bT.apply(this,arguments)}function _bT(){_bT=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee117(e,t){var i,r,n,s,o;return regeneratorRuntime.wrap(function _callee117$(_context121){while(1){switch(_context121.prev=_context121.next){case 0:_context121.next=2;return Vr("".concat(e,"/text/slide/slide").concat(t,".json"));case 2:i=_context121.sent;r=i[gT].replace("/ppt/slideMasters/slideMaster","/text/master/master").replace(".xml",".json");n=i[yT].replace("/ppt/slideLayouts/slideLayout","/text/layout/layout").replace(".xml",".json");_context121.next=7;return Vr("".concat(e).concat(r));case 7:s=_context121.sent;_context121.next=10;return Vr("".concat(e).concat(n));case 10:o=_context121.sent;return _context121.abrupt("return",{slide:i,master:s,layout:o});case 12:case"end":return _context121.stop();}}},_callee117)}));return _bT.apply(this,arguments)}function xS(_x128,_x129){return _xS.apply(this,arguments)}function _xS(){_xS=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee118(e,t){var i,r,n,s,o,a,l,h,_yield$Promise$all11,_yield$Promise$all12,d,u,_ref135,_ref135$useServerWrap,p,_args122=arguments;return regeneratorRuntime.wrap(function _callee118$(_context122){while(1){switch(_context122.prev=_context122.next){case 0:i=_args122.length>2&&_args122[2]!==undefined?_args122[2]:!1;r=_args122.length>3?_args122[3]:undefined;n=_args122.length>4?_args122[4]:undefined;s=_args122.length>5?_args122[5]:undefined;o=_args122.length>6?_args122[6]:undefined;s&&s.info("Start load ppt ".concat(t," resource."));a=e.replace(/\/$/i,"");o&&o.scheme&&(l=o.scheme,a=a.replace(/^[a-zA-z]+[^://]/,l));h=new jo(l);_context122.next=11;return Promise.all([Vr(a+"/info.json",s),Ur(a+"/pptxml/ppt.xml",s)]);case 11:_yield$Promise$all11=_context122.sent;_yield$Promise$all12=_slicedToArray(_yield$Promise$all11,2);d=_yield$Promise$all12[0];u=_yield$Promise$all12[1];_context122.next=17;return h.loadLumiaPSD(i,s);case 17:s&&s.info("load ppt ".concat(t," resource success"));_ref135=o||{},_ref135$useServerWrap=_ref135.useServerWrap,p=_ref135$useServerWrap===void 0?!0:_ref135$useServerWrap;return _context122.abrupt("return",(p&&JI(a,t,d.fonts),new vT({uuid:t,url:a,width:d.width,height:d.height,slidesCount:d.totalPageSize,mainXMLContent:u,userFonts:n,preload:i,logger:s,resourceScheme:l,rtcClient:o==null?void 0:o.rtcClient,useServerWrap:p})));case 20:case"end":return _context122.stop();}}},_callee118)}));return _xS.apply(this,arguments)}var vT=/*#__PURE__*/function(){function vT(e){_classCallCheck(this,vT);this.url=e.url,this.uuid=e.uuid,this.width=e.width*yn,this.height=e.height*yn,this.slidesCount=e.slidesCount,this.userFonts=e.userFonts,this.preload=e.preload,this.logger=e.logger,this.resourceScheme=e.resourceScheme,this.mainXMLContent=e.mainXMLContent,this.rtcClient=e.rtcClient,this.useServerWrap=e.useServerWrap}_createClass(vT,[{key:"loadSlide",value:function(){var _loadSlide=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee66(e){var _this256=this;var t,i,r,n,s,o,a,_yield$this$fetchSlid,l,h,d,u,p,f,m,g,y,b,v,w,M,x,T,O,R,W;return regeneratorRuntime.wrap(function _callee66$(_context68){while(1){switch(_context68.prev=_context68.next){case 0:(t=this.logger)==null||t.debug("begin load slide ".concat(e+1));s=XM(),o=new bn("main",s).parse(this.mainXMLContent);if(!(e<0||e>=this.slidesCount)){_context68.next=4;break}throw new Error("index should be in 0 ~ ".concat(this.slidesCount-1));case 4:a=e+1;_context68.next=7;return this.fetchSlideInfo(a);case 7:_yield$this$fetchSlid=_context68.sent;l=_yield$this$fetchSlid.slideXMLContent;h=_yield$this$fetchSlid.slideRefXMLContent;d=_yield$this$fetchSlid.layoutXMLContent;u=_yield$this$fetchSlid.masterXMLContent;p=_yield$this$fetchSlid.themeXMLContent;f=_yield$this$fetchSlid.resource;m=_yield$this$fetchSlid.wrapResource;this.preload===!0&&((i=this.logger)==null||i.debug("begin preload slide ".concat(a+1)),this.prefetch(a+1)["catch"](function(J){var ee;(ee=_this256.logger)==null||ee.debug("prefetch slide ".concat(a+1," error: "),J)}),(r=this.logger)==null||r.debug("preloaded slide ".concat(a+1)));g=new bn("layout",s).parse(d),y=uS(g.childElement("p:sldLayout","p:cSld","p:spTree")),b=new bn("master",s).parse(u),v=uS(b.childElement("p:sldMaster","p:cSld","p:spTree"),b.childElementOptional("p:sldMaster","p:txStyles")),w=new bn("theme",s).parse(p),M=new mM(f,this.resourceScheme),x=new bn("slide",s).parse(l),T=new bn("slideRef",s).parse(h),O={};T.element!==void 0&&T.element.elements.forEach(function(J){O[J.attr.getString("Id")]=J.attr.getStringOptional("Target")});R={slide:x,layout:g,layoutIndex:y,master:b,masterIndex:v,masterThemeColorMapping:b.childElement("p:sldMaster","p:clrMap").attr.attributes,theme:w,main:o,userFonts:this.userFonts};s.context=Object.freeze(R);W=fT(x,Object.freeze({pptUUID:this.uuid,slideIndex:a,slideContext:R,slideWidth:this.width,slideHeight:this.height,masterShapeParamsIndex:this.getShapeIndexMap(b.childElement("p:sldMaster","p:cSld","p:spTree")),layoutShapeParamsIndex:this.getShapeIndexMap(g.childElement("p:sldLayout","p:cSld","p:spTree")),slideShapeParamsIndex:this.getShapeIndexMap(x.childElement("p:sld","p:cSld","p:spTree")),wrapResource:m}));return _context68.abrupt("return",((n=this.logger)==null||n.debug("loaded slide ".concat(a)),this.slideIndex=e,Object.freeze({uuid:this.uuid,url:this.url,index:e,width:this.width,height:this.height,masterXML:b,masterIndex:v,layoutXML:g,layoutIndex:y,mainXML:o,themeXML:w,slideXML:x,slideRefIndex:O,resourceLoader:M,animations:W,slidesCount:this.slidesCount,preload:this.preload,logger:this.logger,rtcClient:this.rtcClient,WrapResource:m,preSlideIndex:this.preSlideIndex})));case 22:case"end":return _context68.stop();}}},_callee66,this)}));function loadSlide(_x130){return _loadSlide.apply(this,arguments)}return loadSlide}()},{key:"fetchSlideInfo",value:function(){var _fetchSlideInfo=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee67(e){var t,_yield$Promise$all7,_yield$Promise$all8,i,r,n,s,o,a,l;return regeneratorRuntime.wrap(function _callee67$(_context69){while(1){switch(_context69.prev=_context69.next){case 0:t=[Ur("".concat(this.url,"/slide/slide").concat(e,".xml"),this.logger),Ur("".concat(this.url,"/slideRef/slideRef").concat(e,".xml"),this.logger)["catch"](function(h){return console.log("error ",h),""}),Ur("".concat(this.url,"/layout/layout").concat(e,".xml"),this.logger),Ur("".concat(this.url,"/master/master").concat(e,".xml"),this.logger),Ur("".concat(this.url,"/theme/theme").concat(e,".xml"),this.logger),Vr("".concat(this.url,"/resources/resource").concat(e,".json"),this.logger)];_context69.next=3;return Promise.all(t);case 3:_yield$Promise$all7=_context69.sent;_yield$Promise$all8=_slicedToArray(_yield$Promise$all7,6);i=_yield$Promise$all8[0];r=_yield$Promise$all8[1];n=_yield$Promise$all8[2];s=_yield$Promise$all8[3];o=_yield$Promise$all8[4];a=_yield$Promise$all8[5];if(!this.useServerWrap){_context69.next=20;break}_context69.prev=12;_context69.next=15;return bT(this.url,e);case 15:l=_context69.sent;_context69.next=20;break;case 18:_context69.prev=18;_context69.t0=_context69["catch"](12);case 20:return _context69.abrupt("return",{slideXMLContent:i,slideRefXMLContent:r,layoutXMLContent:n,masterXMLContent:s,themeXMLContent:o,resource:a,wrapResource:l});case 21:case"end":return _context69.stop();}}},_callee67,this,[[12,18]])}));function fetchSlideInfo(_x131){return _fetchSlideInfo.apply(this,arguments)}return fetchSlideInfo}()},{key:"prefetch",value:function(){var _prefetch=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee68(e){var t,i,r,n;return regeneratorRuntime.wrap(function _callee68$(_context70){while(1){switch(_context70.prev=_context70.next){case 0:if(!(e>this.slidesCount)){_context70.next=3;break}(t=this.logger)==null||t.debug("no slide need prefetch");return _context70.abrupt("return");case 3:r=new jo(this.resourceScheme);_context70.next=6;return r.fetchPageResource(this.url,e);case 6:n=_context70.sent;r.prefetchPageResource(n).then(function(){},function(){}),(i=this.logger)==null||i.debug("prefetch slide ".concat(e," finish"));case 8:case"end":return _context70.stop();}}},_callee68,this)}));function prefetch(_x132){return _prefetch.apply(this,arguments)}return prefetch}()},{key:"getShapeIndexMap",value:function getShapeIndexMap(e){var t={},i=e.extraAttr.getString("spId"),r=Ku(e);return this.getShapeGroupIndexMap(e,t,i,r.transform),t}},{key:"getShapeGroupIndexMap",value:function getShapeGroupIndexMap(e,t,i,r){var _this257=this;var n=e.elementsWithName("p:sp");this.getChildShapesIndexMap(n,t,i,r);var s=e.elementsWithName("p:cxnSp");this.getChildShapesIndexMap(s,t,i,r);var o=e.elementsWithName("p:pic");this.getChildShapesIndexMap(o,t,i,r);var a=e.elementsWithName("p:graphicFrame");this.getChildShapesIndexMap(a,t,i,r);var l=e.elementsWithName("p:grpSp");l.length>0&&l.forEach(function(h){var d=h.extraAttr.getString("spId"),u=Ku(h,void 0,i,r);_this257.getShapeGroupIndexMap(h,t,d,u.transform),t[d]=u})}},{key:"getChildShapesIndexMap",value:function getChildShapesIndexMap(e,t,i,r){e.forEach(function(n){var s=n.extraAttr.getString("spId"),o=hS(n,void 0,i,r);t[s]=o})}}]);return vT}(),ST=/*#__PURE__*/function(_ot$default$Component){_inherits(ST,_ot$default$Component);var _super83=_createSuper(ST);function ST(e){var _this258;_classCallCheck(this,ST);_this258=_super83.call(this,e);_this258.state={disableJumpTo:!1};return _this258}_createClass(ST,[{key:"UNSAFE_componentWillMount",value:function UNSAFE_componentWillMount(){var e=this.props.emitter;e.on("nextStep",this.onNextStepHandler,this),e.on("preStep",this.onPreStepHandler,this),e.on("nextPage",this.onNextPageHandler,this),e.on("prePage",this.onPrePageHandler,this),e.on("resetSlideAnimation",this.resetCurrentSlideAnimation,this),e.on("resetPPTAnimation",this.resetCurrentPPTAnimation,this),e.on("changePageTo",this.onClickJumpToHandler,this),e.on("displaySidebar",this.displaySidebar,this),e.on("hideSidebar",this.hideSidebar,this),e.on("displayNote",this.displayNote,this),e.on("hideNote",this.hideNote,this)}},{key:"componentWillUnmount",value:function componentWillUnmount(){var e=this.props.emitter;e.removeAllListeners()}},{key:"onPrePageHandler",value:function onPrePageHandler(){var _this$props91=this.props,e=_this$props91.slideIndex,t=_this$props91.changeToPage;e>0&&t(e-1)}},{key:"onNextPageHandler",value:function onNextPageHandler(){var _this$props92=this.props,e=_this$props92.slideIndex,t=_this$props92.changeToPage,i=_this$props92.total;e<i-1&&t(e+1)}},{key:"onClickJumpToHandler",value:function onClickJumpToHandler(e){var _this$props93=this.props,t=_this$props93.total,i=_this$props93.changeToPage,r=(e||parseInt(this.inputRef.value,10))-1;if(Number.isNaN(r)||r<0){this.inputRef.value="1",i(0);return}if(r>t-1){this.inputRef.value="".concat(t),i(t-1);return}this.inputRef.value=(r+1).toString(),i(r)}},{key:"onPreStepHandler",value:function onPreStepHandler(){var e=this.props.changeStep;e(-1)}},{key:"onNextStepHandler",value:function onNextStepHandler(){var e=this.props.changeStep;e(1)}},{key:"invalidJumpTo",value:function invalidJumpTo(){Number.isNaN(parseInt(this.inputRef.value,10))?this.setState({disableJumpTo:!0}):this.setState({disableJumpTo:!1})}},{key:"resetCurrentSlideAnimation",value:function resetCurrentSlideAnimation(){var e=this.props.resetCurrentSlideAnimation;e()}},{key:"resetCurrentPPTAnimation",value:function resetCurrentPPTAnimation(){var e=this.props.resetCurrentPPTAnimation;e()}},{key:"displaySidebar",value:function displaySidebar(){var e=this.props.changeIsExtendSidebar;e(!0)}},{key:"hideSidebar",value:function hideSidebar(){var e=this.props.changeIsExtendSidebar;e(!1)}},{key:"displayNote",value:function displayNote(){var e=this.props.changeIsShowNote;e(!0)}},{key:"hideNote",value:function hideNote(){var e=this.props.changeIsShowNote;e(!1)}},{key:"render",value:function render(){var _this259=this;var e=this.state.disableJumpTo,_this$props94=this.props,t=_this$props94.slideIndex,i=_this$props94.total,r=_this$props94.isExtendSidebar,n=_this$props94.isShowNote,s=_this$props94.international,o=_this$props94.disableSidebar,a=_this$props94.disableNote;return ot["default"].createElement("div",{className:"ppt-preview-beauty-scroll-bar ppt-preview-controls"},ot["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",disabled:t===0,onClick:function onClick(){_this259.onPrePageHandler()}},s&&s.prePage||"\u4E0A\u4E00\u9875"),ot["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this259.onPreStepHandler()}},s&&s.preStep||"\u4E0A\u4E00\u6B65"),ot["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this259.onNextStepHandler()}},s&&s.nextStep||"\u4E0B\u4E00\u6B65"),ot["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",disabled:t===i-1,onClick:function onClick(){_this259.onNextPageHandler()}},s&&s.nextPage||"\u4E0B\u4E00\u9875"),ot["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this259.resetCurrentSlideAnimation()}},s&&s.resetCurrentSlideAnimation||"\u91CD\u7F6E\u5F53\u524D\u9875\u52A8\u753B"),ot["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this259.resetCurrentPPTAnimation()}},s&&s.resetCurrentPPTAnimation||"\u91CD\u7F6E\u6240\u6709\u52A8\u753B"),ot["default"].createElement("input",{className:"ppt-preview-controls-input",type:"text",onInput:function onInput(){_this259.invalidJumpTo()},ref:function ref(l){_this259.inputRef=l}}),ot["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this259.onClickJumpToHandler()},disabled:e},s&&s.jumpTo||"\u8DF3\u8F6C\u5230\u6B64\u9875"),r?ot["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this259.hideSidebar()}},s&&s.hideSidebar||"\u9690\u85CF\u4FA7\u8FB9\u680F"):ot["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this259.displaySidebar()},disabled:o},s&&s.displaySidebar||"\u663E\u793A\u4FA7\u8FB9\u680F"),n?ot["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this259.hideNote()}},s&&s.hideNote||"\u9690\u85CF\u5907\u6CE8"):ot["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this259.displayNote()},disabled:a},s&&s.displayNote||"\u663E\u793A\u5907\u6CE8"),ot["default"].createElement("p",{className:"ppt-preview-controls-page"},s&&s.pageNumber||"\u9875\u7801","\uFF1A",t+1," ","/",i))}}]);return ST}(ot["default"].Component),wT=/*#__PURE__*/function(_jt$default$PureCompo){_inherits(wT,_jt$default$PureCompo);var _super84=_createSuper(wT);function wT(e){_classCallCheck(this,wT);return _super84.call(this,e)}_createClass(wT,[{key:"render",value:function render(){var _this$props95=this.props,e=_this$props95.isShow,t=_this$props95.noteList;return jt["default"].createElement("div",{style:{width:"100%",height:"200px",overflow:"auto",position:"absolute",bottom:e?0:"-200px",transition:"1s",zIndex:"2",fontSize:"12px",padding:"12px",boxSizing:"border-box",fontFamily:"\u7B49\u7EBF"},className:"ppt-preview-beauty-scroll-bar ppt-preview-note"},t.map(function(i,r){var n;var s={textAlign:Au((n=i.align)!=null?n:"l"),marginLeft:i.marginLeft?"".concat(i.marginLeft,"px"):0,marginRight:i.marginRight?"".concat(i.marginRight,"px"):0,textIndent:i.indent?"".concat(i.indent,"px"):0};return jt["default"].createElement("div",{key:r,style:s},i.buchar&&jt["default"].createElement("span",null,parseInt(i.buchar,10)?i.buchar+".":i.buchar,"\xA0\xA0"),!i.runs&&jt["default"].createElement("br",null),i.runs&&i.runs.map(function(o,a){var l;var h={letterSpacing:o.wordSpace?"".concat(o.wordSpace,"px"):0,verticalAlign:o.baseline?"".concat(o.baseline,"px"):0,textDecoration:o.underLine?n2(o.underLine):"none",strikeThrough:o.strikeThrough?"":"none",fontWeight:o.bold?"bolder":"normal",fontStyle:o.italic?"italic":"normal"},d=o.text?o.text:"";if((l=o.text)==null?void 0:l.includes("\t")){var u=[];for(var p=0;p<o.text.length;p+=1){o.text[p]==="\t"?u.push(jt["default"].createElement("span",{key:"tab"+p},"\t")):u.push(jt["default"].createElement("span",{key:"tab"+p,style:{fontFamily:"\u7B49\u7EBF"}},o.text[p]))}return jt["default"].createElement("pre",{key:d+r+a,style:{margin:"0",display:"inline"}},u)}return o.strikeThrough==="sngStrike"?jt["default"].createElement("span",{key:d+r+a,style:h},jt["default"].createElement("s",null,o.text)):o.runType==="br"?jt["default"].createElement("br",null):o.runType==="text"?jt["default"].createElement("span",{key:d+r+a,style:h},o.text):jt["default"].createElement("span",{key:d+r+a})}))}))}}]);return wT}(jt["default"].PureComponent),CT=/*#__PURE__*/function(_Os$default$Component){_inherits(CT,_Os$default$Component);var _super85=_createSuper(CT);function CT(){_classCallCheck(this,CT);return _super85.apply(this,arguments)}_createClass(CT,[{key:"clickHandler",value:function clickHandler(e){var t=this.props.changeToPage;t(e)}},{key:"render",value:function render(){var _this260=this;var _this$props96=this.props,e=_this$props96.isExtend,t=_this$props96.previewList,i={display:"flex",flexDirection:"column",justifyContent:"flex-start",position:"absolute",right:e?0:"-20%",width:"20%",overflow:"auto",transition:"1s",top:0,bottom:0,zIndex:"3",borderLeft:"1px solid #ccc",backgroundColor:"#eee"},r={display:"flex",flexDirection:"column",justifyContent:"space-around"};return Os["default"].createElement("div",{style:i,className:"ppt-preview-beauty-scroll-bar ppt-preview-sidebar"},t.map(function(n,s){return Os["default"].createElement("div",{className:"ppt-preview-sidebar-item ppt-event-source",key:n,style:r,onClick:function onClick(){_this260.clickHandler(s)}},Os["default"].createElement("img",{className:"ppt-preview-sidebar-img",src:n,alt:"PPT\u7565\u7F29\u56FE"}),Os["default"].createElement("span",{className:"ppt-preview-sidebar-span"},s+1))}))}}]);return CT}(Os["default"].Component),ip;(function(e){e.waiting="Waiting",e.converting="Converting",e.finished="Finished",e.fail="Fail"})(ip||(ip={}));var MS;(function(e){e.packaging="Packaging",e.extracting="Extracting",e.generatingPreview="GeneratingPreview",e.mediaTranscode="MediaTranscode"})(MS||(MS={}));var TS;(function(e){e.dynamic="dynamic",e["static"]="static"})(TS||(TS={}));var kT=/*#__PURE__*/function(_vi$default$Component){_inherits(kT,_vi$default$Component);var _super86=_createSuper(kT);function kT(e){var _this261;_classCallCheck(this,kT);_this261=_super86.call(this,e);_this261.previewList=[],_this261.PPTSliderList=[],_this261.stateAdapter={disableInteractive:!1,setState:function(){var _setState=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee69(t,i,r){return regeneratorRuntime.wrap(function _callee69$(_context71){while(1){switch(_context71.prev=_context71.next){case 0:_this261.setState({globalPPTState:r});case 1:case"end":return _context71.stop();}}},_callee69)}));function setState(_x133,_x134,_x135){return _setState.apply(this,arguments)}return setState}(),onPageToPrev:function onPageToPrev(){var t=_this261.state.slideIndex;_this261.changePageTo(t-1).then(function(){},function(){})},onPageToNext:function onPageToNext(){var t=_this261.state.slideIndex;_this261.changePageTo(t+1).then(function(){},function(){})},onPageJumpTo:function(){var _onPageJumpTo=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee70(t,i){return regeneratorRuntime.wrap(function _callee70$(_context72){while(1){switch(_context72.prev=_context72.next){case 0:_this261.changePageTo(i-1).then(function(){},function(){});case 1:case"end":return _context72.stop();}}},_callee70)}));function onPageJumpTo(_x136,_x137){return _onPageJumpTo.apply(this,arguments)}return onPageJumpTo}(),setSlideStateAdapterCallbacks:function setSlideStateAdapterCallbacks(t){}},_this261.clickSidebarHandler=function(t){_this261.changePageTo(t).then(function(){},function(){})},_this261.clickControllerHandler=function(t){_this261.changePageTo(t).then(function(){},function(){})},_this261.changeIsExtendSidebar=function(t){_this261.previewList.length!==0&&_this261.setState({isExtendingSidebar:t})},_this261.changeIsShowNote=function(t){var i=_this261.state.noteList;i.length!==0&&_this261.setState({isShownNote:t})},_this261.resetCurrentSlideAnimation=function(){_this261.slideRef&&_this261.slideRef.resetCurrentSlideAnimation()},_this261.resetCurrentPPTAnimation=function(){_this261.slideRef&&_this261.slideRef.resetCurrentPPTAnimation()},_this261.state={slide:void 0,slideIndex:0,globalPPTState:void 0,isExtendingSidebar:!1,isShownNote:!1,noteList:[],isLoading:!0},_this261.isGotNodeList=!1,e.conversionResponse.status===ip.finished&&(_this261.uuid=e.conversionResponse.uuid,e.conversionResponse.progress.convertedFileList.forEach(function(t){_this261.PPTSliderList.push(F(A({},t),{conversionFileUrl:t.conversionFileUrl.replace(/\d.slide/g,"")})),t.preview&&_this261.previewList.push(t.preview)}),_this261.total=_this261.PPTSliderList.length);return _this261}_createClass(kT,[{key:"UNSAFE_componentWillMount",value:function(){var _UNSAFE_componentWillMount=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee71(){var e,_this$props97,t,i,r,n,s;return regeneratorRuntime.wrap(function _callee71$(_context73){while(1){switch(_context73.prev=_context73.next){case 0:e=this.state.slideIndex,_this$props97=this.props,t=_this$props97.preloadProgress,i=_this$props97.userFonts,r=_this$props97.logger,n=this.PPTSliderList[e];_context73.next=3;return xS(n.conversionFileUrl,this.uuid,!0,t,i,r,{scheme:"https",useServerWrap:!0});case 3:this.ppt=_context73.sent;_context73.next=6;return this.ppt.loadSlide(e);case 6:s=_context73.sent;_context73.next=9;return this.getNoteList();case 9:this.setState({slide:s,isLoading:!1});case 10:case"end":return _context73.stop();}}},_callee71,this)}));function UNSAFE_componentWillMount(){return _UNSAFE_componentWillMount.apply(this,arguments)}return UNSAFE_componentWillMount}()},{key:"componentWillUnmount",value:function componentWillUnmount(){var e=this.props.emitter;e.removeAllListeners()}},{key:"getNoteList",value:function(){var _getNoteList=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee72(){var e,t,i;return regeneratorRuntime.wrap(function _callee72$(_context74){while(1){switch(_context74.prev=_context74.next){case 0:e=this.state.slideIndex,t=this.PPTSliderList[e];_context74.prev=1;_context74.next=4;return Vr("".concat(t.conversionFileUrl.replace("pptx","https"),"notes/note").concat(e+1,".json"));case 4:i=_context74.sent;this.setState({noteList:i});_context74.next=11;break;case 8:_context74.prev=8;_context74.t0=_context74["catch"](1);this.setState({noteList:[]});case 11:this.isGotNodeList=!0;case 12:case"end":return _context74.stop();}}},_callee72,this,[[1,8]])}));function getNoteList(){return _getNoteList.apply(this,arguments)}return getNoteList}()},{key:"changePageTo",value:function(){var _changePageTo=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee73(e){var t,i;return regeneratorRuntime.wrap(function _callee73$(_context75){while(1){switch(_context75.prev=_context75.next){case 0:if(!(e<0||e>=this.total)){_context75.next=2;break}return _context75.abrupt("return");case 2:t=this.state.isLoading;if(!t){_context75.next=5;break}return _context75.abrupt("return");case 5:this.setState({isLoading:!0});_context75.next=8;return this.ppt.loadSlide(e);case 8:i=_context75.sent;this.setState({slide:i,slideIndex:e,isLoading:!1,isShownNote:!1});_context75.next=12;return this.getNoteList();case 12:case"end":return _context75.stop();}}},_callee73,this)}));function changePageTo(_x138){return _changePageTo.apply(this,arguments)}return changePageTo}()},{key:"changeStep",value:function changeStep(e){var t=this.state.isLoading;t||this.slideRef.changeStep(e)}},{key:"emitData",value:function emitData(){var _this262=this;clearTimeout(this.emitSetTimeout),this.emitSetTimeout=setTimeout(function(){if(!_this262.isGotNodeList)return;var e=_this262.total,_this262$state=_this262.state,t=_this262$state.slideIndex,i=_this262$state.isExtendingSidebar,r=_this262$state.isShownNote,n=_this262$state.noteList,s=_this262.props.emitter,o=!_this262.previewList.length,a=!n.length;s.emit("update",{index:t+1,total:e,disableNote:a,disableSidebar:o,isShowNote:r,isExtendSidebar:i})},500)}},{key:"render",value:function render(){var _this263=this;var e=this.total,t=this.PPTSliderList,_this$state9=this.state,i=_this$state9.globalPPTState,r=_this$state9.slide,n=_this$state9.slideIndex,s=_this$state9.isExtendingSidebar,o=_this$state9.isShownNote,a=_this$state9.noteList,l=_this$state9.isLoading,_this$props98=this.props,h=_this$props98.parentElement,d=_this$props98.config,u=_this$props98.emitter,p=!this.previewList.length,f=!a.length,m=t[0].width;this.emitData();var g=t[0].height+40,y={width:"".concat(m,"px"),height:"".concat(g,"px"),transform:""},b=Math.min(h.offsetWidth/m,h.offsetHeight/g);return h.style.width&&(y.transform="scale(".concat(b,", ").concat(b,")")),vi["default"].createElement("div",{style:y,className:"ppt-preview-container"},vi["default"].createElement(ST,{international:d&&d.international,isShowNote:o,emitter:u,disableNote:f,disableSidebar:p,isExtendSidebar:s,changeStep:function changeStep(v){_this263.changeStep(v)},changeIsShowNote:this.changeIsShowNote,changeIsExtendSidebar:this.changeIsExtendSidebar,total:e,resetCurrentSlideAnimation:this.resetCurrentSlideAnimation,resetCurrentPPTAnimation:this.resetCurrentPPTAnimation,changeToPage:this.clickControllerHandler,slideIndex:n}),vi["default"].createElement("div",{style:{position:"relative",display:"inline-block",overflow:"hidden",width:"100%",fontSize:"0"},className:"ppt-preview-main-container"},vi["default"].createElement("div",{style:{display:"inline-block"},className:"ppt-preview-slide-container"},!l&&r&&vi["default"].createElement(dS,{ref:function ref(v){_this263.slideRef=v},stateAdapter:this.stateAdapter,pptState:i,data:r,renderMode:Kl.Normal}),l&&vi["default"].createElement("div",{style:y})),this.previewList.length>0&&vi["default"].createElement(CT,{isExtend:s,previewList:this.previewList,changeToPage:this.clickSidebarHandler}),a.length>0&&vi["default"].createElement(wT,{isShow:o,noteList:a})))}}]);return kT}(vi["default"].Component);function rp(e,t,i){var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:!1;var n=arguments.length>4?arguments[4]:undefined;var s=arguments.length>5?arguments[5]:undefined;var o=arguments.length>6?arguments[6]:undefined;var a=arguments.length>7?arguments[7]:undefined;t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center";var l=a!=null?a:new IS["default"];return PS["default"].render(vi["default"].createElement(kT,{conversionResponse:e,parentElement:t,preload:r,userFonts:n,logger:s,config:i,pptPrams:o,emitter:l}),t),l}var NS=P(require("react")),LS=P(require("url-parse")),DS=P(require("textarea-caret-ts"));var xT=Object.defineProperty,ES=Object.getOwnPropertySymbols,PT=Object.prototype.hasOwnProperty,IT=Object.prototype.propertyIsEnumerable,AS=function AS(e,t,i){return t in e?xT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},MT=function MT(e,t){for(var i in t||(t={})){PT.call(t,i)&&AS(e,i,t[i])}if(ES){var _iterator232=_createForOfIteratorHelper(ES(t)),_step232;try{for(_iterator232.s();!(_step232=_iterator232.n()).done;){var i=_step232.value;IT.call(t,i)&&AS(e,i,t[i])}}catch(err){_iterator232.e(err)}finally{_iterator232.f()}}return e},UN=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")};function TT(e){var t=e.split("/");return t.pop(),t.join("/")}var ET=/*#__PURE__*/function(){function ET(){var _this264=this;_classCallCheck(this,ET);this.libraryMap={},this.paddingMap={},this.freeInterrupters={},this.defineLibrary=function(i,r){if(i.libName in _this264.libraryMap)throw new Error("found duplicated library ".concat(JSON.stringify(i.libName)));r&&(_this264.freeInterrupters[i.libName]=r),_this264.libraryMap[i.libName]=Object.freeze(MT({},i))},this.requireModules=function(i){return new Promise(function(r,n){var s=_this264.paddingMap[i];s||(s=_this264.paddingMap[i]=[]),s.push({resolve:r,reject:n})})},this.loader=function(i,r,n){if(r||n){var s=i;_this264.handlePanddingNodes(s,r,n);return}else{var _s36=i;return _this264.createRequireFunction(_s36)}};var e="__netlessJavaScriptLoader",t=window;if(t[e]!==void 0)throw new Error("window.".concat(e," was override"));Object.defineProperty(t,e,{enumerable:!1,configurable:!1,writable:!1,value:this.loader})}_createClass(ET,[{key:"handlePanddingNodes",value:function handlePanddingNodes(e,t,i){var r=this.paddingMap[e];if(r){delete this.paddingMap[e];var _iterator233=_createForOfIteratorHelper(r),_step233;try{for(_iterator233.s();!(_step233=_iterator233.n()).done;){var n=_step233.value;if(i)n.reject(i);else try{n.resolve(this.handleModules(t))}catch(s){n.reject(s)}}}catch(err){_iterator233.e(err)}finally{_iterator233.f()}}else if(!i&&t){var _n44=TT(e),s=this.freeInterrupters[_n44];s&&s(e,t)}else console.warn("find invalid async module ".concat(JSON.stringify(e)))}},{key:"createRequireFunction",value:function createRequireFunction(e){var t=this.libraryMap[e];if(!t)throw new Error("undefined library ".concat(JSON.stringify(e)));return function(i){var r=t.dependencies,n=r&&r[i];if(!n)throw new Error("cannot find module ".concat(JSON.stringify(i)," of library ").concat(JSON.stringify(e)));return n}}},{key:"handleModules",value:function handleModules(e){for(var t in e){var i=e[t];"__esModule"in i||Object.defineProperty(i,"__esModule",{value:!0})}return Object.freeze(e)}}]);return ET}(),AT=new ET,OT=AT.requireModules,RT=AT.defineLibrary;function NT(e,t){var i=window.atob(e),r=new Uint8Array(i.length);for(var n=0;n<i.length;n++){r[n]=i.charCodeAt(n)}return new Blob([r],t)}function LT(e){return new Promise(function(t,i){try{var _r155=new FileReader;_r155.onload=function(n){var s;var o=(s=n.target)==null?void 0:s.result;typeof o=="string"?t(o):i(new Error("blob load wrong type "+_typeof(o)))},_r155.readAsDataURL(e)}catch(r){i(r)}})}var DT="__netlessJavaScriptCache",BT=1,Wo="modules";function sp(e){return new Promise(function(t,i){e.onsuccess=function(){return t(e.result)},e.onerror=function(){if(e.error){var _r156=new Error(e.error.message);_r156.name=e.error.name,i(_r156)}else i(new Error("failed with null Error"))}})}var Ql=/*#__PURE__*/function(){function Ql(e,t,i){_classCallCheck(this,Ql);var _URL3=new URL(t),r=_URL3.protocol,n=_URL3.host,s=new $i({fetcher:window.fetch.bind(window),retryCount:Ql.retryCount,retryLoopsCount:0,configmap:{module:{useSSL:r==="https:",hosts:{"*":n}}}});this.fetcher=s.fetch("module"),this.storeBase64=e,this.findPath=i}_createClass(Ql,[{key:"findObjectURL",value:function(){var _findObjectURL=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee74(e){var t;return regeneratorRuntime.wrap(function _callee74$(_context76){while(1){switch(_context76.prev=_context76.next){case 0:_context76.next=2;return this.readBlob(e);case 2:t=_context76.sent;_context76.t0=t;if(_context76.t0){_context76.next=10;break}_context76.next=7;return this.fetchBuffer(e);case 7:t=_context76.sent;_context76.next=10;return this.writeBlob(e,t);case 10:return _context76.abrupt("return",URL.createObjectURL(t,{oneTimeOnly:!0}));case 11:case"end":return _context76.stop();}}},_callee74,this)}));function findObjectURL(_x139){return _findObjectURL.apply(this,arguments)}return findObjectURL}()},{key:"readBlob",value:function(){var _readBlob=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee75(e){var i,r,_r$split,_r$split2,n,s,o;return regeneratorRuntime.wrap(function _callee75$(_context77){while(1){switch(_context77.prev=_context77.next){case 0:_context77.next=2;return Ql.dbp;case 2:i=_context77.sent.transaction([Wo],"readonly").objectStore(Wo).get(e);_context77.next=5;return sp(i);case 5:r=_context77.sent;if(typeof r=="string"){_r$split=r.split(/;base64,/im),_r$split2=_slicedToArray(_r$split,2),n=_r$split2[0],s=_r$split2[1],o=n.replace(/^data:/im,"");r=NT(s,{type:o})}return _context77.abrupt("return",r);case 8:case"end":return _context77.stop();}}},_callee75)}));function readBlob(_x140){return _readBlob.apply(this,arguments)}return readBlob}()},{key:"writeBlob",value:function(){var _writeBlob=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee76(e,t){var i,n;return regeneratorRuntime.wrap(function _callee76$(_context78){while(1){switch(_context78.prev=_context78.next){case 0:i=t;_context78.t0=this.storeBase64;if(!_context78.t0){_context78.next=6;break}_context78.next=5;return LT(i);case 5:i=_context78.sent;case 6:_context78.next=8;return Ql.dbp;case 8:n=_context78.sent.transaction([Wo],"readwrite").objectStore(Wo).put(i,e);_context78.next=11;return sp(n);case 11:case"end":return _context78.stop();}}},_callee76,this)}));function writeBlob(_x141,_x142){return _writeBlob.apply(this,arguments)}return writeBlob}()},{key:"fetchBuffer",value:function(){var _fetchBuffer2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee77(e){var t,i;return regeneratorRuntime.wrap(function _callee77$(_context79){while(1){switch(_context79.prev=_context79.next){case 0:t="http://module"+this.findPath(e);_context79.next=3;return this.fetcher(t,{method:"get",headers:{Accept:"application/javascript"}});case 3:i=_context79.sent;if(!(i.status!==200)){_context79.next=6;break}throw new Error("failed to fetch ".concat(JSON.stringify(t)," with status ").concat(i.status));case 6:_context79.next=8;return i.blob();case 8:return _context79.abrupt("return",_context79.sent);case 9:case"end":return _context79.stop();}}},_callee77,this)}));function fetchBuffer(_x143){return _fetchBuffer2.apply(this,arguments)}return fetchBuffer}()}],[{key:"dbp",get:function get(){if(!this._dbp){var e=indexedDB.open(DT,BT);e.onupgradeneeded=function(t){t.target.result.createObjectStore(Wo)},this._dbp=sp(e)}return this._dbp}}]);return Ql}(),OS=Ql;OS.retryCount=5;var FT=/*#__PURE__*/function(){function FT(e){_classCallCheck(this,FT);this.params=e,this.completeCallbacks=[]}_createClass(FT,[{key:"load",value:function(){var _load=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee78(){var e,_iterator234,_step234,t;return regeneratorRuntime.wrap(function _callee78$(_context80){while(1){switch(_context80.prev=_context80.next){case 0:e=[];this.params.timeout!==void 0&&e.push(this.startTimeout(this.params.timeout)),e.push(this.loadScript());_context80.prev=2;_context80.next=5;return Promise.race(e);case 5:_context80.prev=5;_iterator234=_createForOfIteratorHelper(this.completeCallbacks);try{for(_iterator234.s();!(_step234=_iterator234.n()).done;){t=_step234.value;t()}}catch(err){_iterator234.e(err)}finally{_iterator234.f()}return _context80.finish(5);case 9:case"end":return _context80.stop();}}},_callee78,this,[[2,,5,9]])}));function load(){return _load.apply(this,arguments)}return load}()},{key:"loadScript",value:function(){var _loadScript=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee79(){var _this$params2,e,t,i,r,n;return regeneratorRuntime.wrap(function _callee79$(_context81){while(1){switch(_context81.prev=_context81.next){case 0:_this$params2=this.params,e=_this$params2.origin,t=_this$params2.findPath,i=_this$params2.identifier,r=_this$params2.storage;if(!r){_context81.next=13;break}_context81.prev=2;_context81.next=5;return r.findObjectURL(i);case 5:n=_context81.sent;_context81.next=11;break;case 8:_context81.prev=8;_context81.t0=_context81["catch"](2);console.warn("read from storage failed: ".concat(_context81.t0.message)),n="".concat(e).concat(t(i));case 11:_context81.next=14;break;case 13:n="".concat(e).concat(t(i));case 14:_context81.next=16;return this.loadScriptWithURL(n);case 16:case"end":return _context81.stop();}}},_callee79,this,[[2,8]])}));function loadScript(){return _loadScript.apply(this,arguments)}return loadScript}()},{key:"loadScriptWithURL",value:function loadScriptWithURL(e){var _this265=this;return new Promise(function(t,i){var r=document.createElement("script");_this265.completeCallbacks.push(function(){r.onerror=null,r.onload=null,r.remove()}),r.charset="utf-8",r.src=e,r.onload=function(){t()},r.onerror=function(n){var s=n&&(n.type==="load"?"missing":n.type);i(new Error("fetch ".concat(JSON.stringify(e)," failed: ").concat(s)))},document.head.appendChild(r)})}},{key:"startTimeout",value:function startTimeout(e){var _this266=this;var t=null;return this.completeCallbacks.push(function(){t!==null&&(clearTimeout(t),t=null)}),new Promise(function(i,r){t=setTimeout(function(){t=null,r(new Error("fetch ".concat(_this266.params.identifier," timeout")))},e)})}}]);return FT}();function RS(e){return new jT(e)}var jT=/*#__PURE__*/function(){function jT(e){var _this267=this;_classCallCheck(this,jT);this.modulesMap={},this.taskPromises={},this.onInterruptFreeModules=function(i,r){_this267.modulesMap[i]||(_this267.modulesMap[i]=r)};var t={libName:e.libName,dependencies:e.dependencies};RT(t,this.onInterruptFreeModules),this.origin=e.origin,this.findPath=e.findPath,this.timeout=e.timeout,this.storage=e.cache?new OS(!!e.storeBase64,e.origin,e.findPath):void 0}_createClass(jT,[{key:"require",value:function(){var _require=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee81(e,t){var _this268=this;var i,n,r;return regeneratorRuntime.wrap(function _callee81$(_context83){while(1){switch(_context83.prev=_context83.next){case 0:i=this.modulesMap[e];if(i){_context83.next=7;break}n=this.taskPromises[e];n===void 0&&(n=this.taskPromises[e]=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee80(){var s,_yield$Promise$all9,_yield$Promise$all10,o;return regeneratorRuntime.wrap(function _callee80$(_context82){while(1){switch(_context82.prev=_context82.next){case 0:_context82.prev=0;s={identifier:e,origin:_this268.origin,findPath:_this268.findPath,timeout:_this268.timeout,storage:_this268.storage};_context82.next=4;return Promise.all([OT(e),new FT(s).load()]);case 4:_yield$Promise$all9=_context82.sent;_yield$Promise$all10=_slicedToArray(_yield$Promise$all9,1);o=_yield$Promise$all10[0];return _context82.abrupt("return",o);case 8:_context82.prev=8;delete _this268.taskPromises[e];return _context82.finish(8);case 11:case"end":return _context82.stop();}}},_callee80,null,[[0,,8,11]])}))());_context83.next=6;return n;case 6:i=this.modulesMap[e]=_context83.sent;case 7:r=i[t];if(r){_context83.next=10;break}throw new Error("can't find module ".concat(JSON.stringify(t)," from ").concat(e));case 10:return _context83.abrupt("return",r);case 11:case"end":return _context83.stop();}}},_callee81,this)}));function require(_x144,_x145){return _require.apply(this,arguments)}return require}()}]);return jT}();var ae=op(k);function op(e){if(_typeof(e)!="object"||e===null)return e;if(e.constructor===Object){var t={};for(var i in e){t[i]=op(e[i])}return Object.freeze(t)}else if(Array.isArray(e)){var _t16=[];for(var _i46=0;_i46<e.length;++_i46){_t16[_i46]=op(e[_i46])}return Object.freeze(_t16)}else return e}var $r;(function(r){r.DisableCache="disableCache",r.StoreAsBlob="storeAsBlob",r.StoreAsBase64="storeAsBase64"})($r||($r={}));var ql=$r.StoreAsBase64,Zl=null;function BS(e){if(ql===void 0)throw new Error("cannot set async module load mode after joined or replay any room");ql=e}function FS(_x146,_x147){return _FS.apply(this,arguments)}function _FS(){_FS=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee119(e,t){var i;return regeneratorRuntime.wrap(function _callee119$(_context123){while(1){switch(_context123.prev=_context123.next){case 0:Zl||(Zl=UT(ql,t),ql=void 0);_context123.next=3;return Promise.all([Zl.require(e,"white-model"),Zl.require(e,"white-render")]);case 3:i=_context123.sent;return _context123.abrupt("return",Object.freeze({WhiteModel:i[0],WhiteRender:i[1]}));case 5:case"end":return _context123.stop();}}},_callee119)}));return _FS.apply(this,arguments)}function UT(e,t){var i,r;switch(e){case $r.DisableCache:{i=!1,r=!1;break}case $r.StoreAsBlob:{i=!0,r=!1;break}case $r.StoreAsBase64:{i=!0,r=!0;break}}return RS({libName:ae.modules.identifier,timeout:2*60*1e3,cache:i,storeBase64:r,origin:t||ae.modules.origin,findPath:function findPath(n){return"/dynamic-libraries/".concat(n,".js")},dependencies:{akko:ad,boundless:Nd,mobx:zT,"mobx-react":_d,react:NS["default"],"netless-ppt":np,"url-parse":LS["default"],"textarea-caret-ts":DS["default"]}})}function jS(e){var t=document.createElement("style"),i=document.createTextNode(e);t.appendChild(i),document.head.appendChild(t)}var zS=".netless-whiteboard div.highlight-box{border:1px solid;box-shadow:0 0 1px #fff,inset 0 0 1px #fff}.netless-whiteboard div.editor-box>*.cursor-nwse{cursor:nwse-resize}.netless-whiteboard div.editor-box>*.cursor-nesw{cursor:nesw-resize}.netless-whiteboard div.editor-box>*.cursor-ns{cursor:ns-resize}.netless-whiteboard div.editor-box>*.cursor-ew{cursor:ew-resize}.netless-whiteboard div.editor-box>*.cursor-move{cursor:move}.netless-whiteboard.cursor-move{cursor:move}.netless-whiteboard div.editor-box{pointer-events:none;border:1px solid;box-shadow:0 0 1px #fff,inset 0 0 1px #fff}.netless-whiteboard div.editor-box>.lock{pointer-events:none;position:absolute;width:22px;height:22px;top:-11px;left:-11px}.netless-whiteboard div.editor-box>div.operation-point-desktop{width:7px;height:7px;position:absolute;pointer-events:auto}.netless-whiteboard div.editor-box>div.operation-point-touch{width:33px;height:33px;background-color:#fff0;position:absolute;pointer-events:auto;display:flex;align-items:center;justify-content:center}.netless-whiteboard div.editor-box>div.operation-point-touch>*{pointer-events:none;width:7px;height:7px}.netless-whiteboard div.editor-box>.operation-point-desktop.left-top{left:-4px;top:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.right-top{right:-4px;top:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.left-bottom{left:-4px;bottom:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.right-bottom{right:-4px;bottom:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.top{top:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.right{right:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.bottom{bottom:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.left{left:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.rotation{cursor:move;display:flex;align-items:center;justify-content:center;width:16px;height:16px;left:-32px;bottom:-32px;border-radius:8px}.netless-whiteboard div.editor-box>.operation-point-desktop.rotation>img{pointer-events:none;width:10;height:10px}.netless-whiteboard div.editor-box>.operation-point-touch.left-top{left:-17px;top:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.right-top{right:-17px;top:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.left-bottom{left:-17px;bottom:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.right-bottom{right:-17px;bottom:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.top{top:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.right{right:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.bottom{bottom:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.left{left:-17px}.netless-whiteboard div.editor-box-others{border:1px solid}.netless-whiteboard textarea{-webkit-appearance:none;-webkit-user-select:text;-moz-user-select:text;user-select:text;padding:0;margin:0;outline:none;border:none;resize:none;overflow:hidden}.netless-whiteboard .textarea-border{position:absolute;top:0;left:0;pointer-events:none;border-width:1px;border-style:dashed}.netless-whiteboard .textarea-border>*{position:absolute;pointer-events:auto}.netless-whiteboard .textarea-layout{position:absolute;top:0;left:0;pointer-events:none;border-width:1px;border-style:dashed;border-style:solid;border-color:#0000}.netless-whiteboard .textarea-layout>*{position:absolute;pointer-events:auto}.netless-whiteboard textarea.readonly-textarea{background:rgba(255,255,255,0)}.netless-whiteboard textarea.editable-textarea{background:rgba(255,255,255,0)}.netless-whiteboard textarea.my-textarea{pointer-events:auto}.netless-whiteboard div.float-bar{display:flex;flex-direction:row;align-items:center;background:#ffffff;border:1px solid #EFEFEF;box-shadow:0 6px 12px #0000001f;border-radius:4px;color-scheme:light;pointer-events:auto}.netless-whiteboard div.float-bar div,.netless-whiteboard div.float-bar input{pointer-events:auto}.netless-whiteboard div.float-bar img{pointer-events:none}.netless-whiteboard div.float-bar .button{display:flex;justify-content:center;align-items:center;cursor:pointer;border:none}.netless-whiteboard div.float-bar .button:hover{background:#EEF0F6}.netless-whiteboard div.float-bar .button.disable{opacity:.5;cursor:not-allowed;background:transparent}.netless-whiteboard div.float-bar>.decorator{height:40px;display:flex;justify-content:center;align-items:center;cursor:pointer;border:none}.netless-whiteboard div.float-bar>.normal-button{width:40px;height:40px}.netless-whiteboard div.float-bar>.highlight-button{background:#EEF0F6}.netless-whiteboard div.float-bar img.font-size-icon{width:16px;height:16px;margin-left:12px}.netless-whiteboard div.float-bar>input.font-size-input::-webkit-outer-spin-button,.netless-whiteboard div.float-bar>input.font-size-input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.netless-whiteboard div.float-bar>input.middle:focus,.netless-whiteboard div.float-bar>input:focus{outline-width:0}.netless-whiteboard div.float-bar>input.font-size-input{-moz-appearance:textfield;width:29px;height:20px;margin-left:10px;font-size:12px;font-family:PingFang SC,Microsoft Yahei;font-weight:normal;color:#212324;line-height:14px;border-radius:2px;border:1px solid #e7e7e7;text-align:center}.netless-whiteboard div.float-bar div.font-size-buttons{display:flex;flex-direction:column;flex-wrap:none;justify-content:space-between;align-items:stretch;margin-left:5px;margin-right:7px}.netless-whiteboard div.float-bar div.font-size-buttons>div.arrow-button{display:flex;flex-direction:column;flex-wrap:none;align-items:center;width:16px;height:18px}.netless-whiteboard div.float-bar div.font-size-buttons>div.arrow-button>img{width:6px;height:3px}.netless-whiteboard div.float-bar div.font-size-buttons>div.up{justify-content:flex-end;padding-bottom:2px}.netless-whiteboard div.float-bar div.font-size-buttons>div.down{justify-content:flex-start;padding-top:2px}.netless-whiteboard div.float-bar div.font-size-menu{position:absolute;display:flex;flex-direction:column;justify-content:center;align-items:stretch;background:#ffffff;box-shadow:0 3px 6px #0000001f;border-radius:2px}.netless-whiteboard div.float-bar div.font-size-menu>div.hover{background:#e7e7e7}.netless-whiteboard div.float-bar div.font-size-menu>div.cell{display:flex;flex-direction:row;justify-content:center;align-items:center;width:64px;height:24px}.netless-whiteboard div.float-bar div.font-size-menu>div.cell>span{padding-left:4px;padding-right:4px;font-size:12px;font-family:PingFang SC,Microsoft Yahei;font-weight:normal;color:#000}.netless-whiteboard div.float-bar div.font-size-menu>div.cell>.check{width:8px;height:8px}.netless-whiteboard div.float-bar div.font-colors-icon{position:relative;width:16px;height:16px}.netless-whiteboard div.float-bar div.font-colors-icon>img{position:absolute;top:0;left:0;width:16px;height:16px;z-index:1}.netless-whiteboard div.float-bar div.font-colors-icon>div.bar{position:absolute;left:2px;right:2px;top:12.5px;height:1.5px;z-index:2}.netless-whiteboard div.float-bar div.font-colors-menu{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:flex-start;align-items:center;position:absolute;padding:8px;background:#ffffff;box-shadow:0 3px 6px #0000001f;border-radius:2px}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-selected{border-color:#a7a7a7}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-not-selected{border-color:#fff}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-button{display:flex;justify-content:center;align-items:center;cursor:pointer;margin:4px;width:20px;height:20px;border-radius:50%;border-width:1px;border-style:solid}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-button>.core{width:16px;height:16px;border-radius:50%;border:1px solid rgba(0,0,0,.12)}.netless-whiteboard div.float-bar div.image-layer-menu{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:flex-start;align-items:center;position:absolute;padding:4px;background:#ffffff;box-shadow:0 3px 6px #0000001f;border-radius:2px}.netless-whiteboard div.float-bar div.image-layer-menu>.normal-button{width:32px;height:32px}.netless-whiteboard div.rotation-indicator{pointer-events:auto;display:flex;align-items:center;justify-content:center;border-radius:5px;color:#fff;background-color:#000;opacity:.75;font-size:12px;width:32px;height:20px}.netless-whiteboard *{-webkit-user-select:none;-moz-user-select:none;user-select:none;pointer-events:none}.cursor-selector .ppt-event-source{cursor:pointer;pointer-events:auto;-webkit-user-select:auto;-moz-user-select:auto;user-select:auto}.cursor-clicker .ppt-event-source{pointer-events:auto;-webkit-user-select:auto;-moz-user-select:auto;user-select:auto}.netless-whiteboard{text-align:start;outline:none;line-height:1.2}.netless-whiteboard *{box-sizing:border-box}.netless-whiteboard *>svg{text-align:start}.netless-ppt-last-run:after{content:attr(data-last-word);margin-left:var(--data-last-word-indent);display:inline-block;width:0}.ppt-preview-beauty-scroll-bar::-webkit-scrollbar{width:12px;height:6px}.ppt-preview-beauty-scroll-bar::-webkit-scrollbar-track{border-radius:3px;background:rgba(0,0,0,.06);-webkit-box-shadow:inset 0 0 5px rgba(0,0,0,.08);box-shadow:inset 0 0 5px #00000014}.ppt-preview-beauty-scroll-bar::-webkit-scrollbar-thumb{border-radius:3px;background:rgba(0,0,0,.12);-webkit-box-shadow:inset 0 0 10px rgba(0,0,0,.2);box-shadow:inset 0 0 10px #0003}.ppt-preview-main-container{border:1px solid #222}.ppt-preview-show-note-svg{width:40px;height:40px}.ppt-preview-show-sidebar-svg{width:40px;height:40px}.ppt-preview-controls{height:40px;width:100%}.ppt-preview-controls-button{margin:0 2px}.ppt-preview-sidebar{border-left:1px solid #ccc;background-color:#eee}.ppt-preview-sidebar-item{margin:14px 14px 16px}.ppt-preview-sidebar-span{font-size:10pt;text-align:center}.ppt-preview-note{background-color:#eee}.ppt-preview-animation-svg{width:20px;height:20px}.ppt-preview-controls-page{float:right;line-height:16px;font-size:16px;padding:0;margin:0}\n";jS(zS);var Yc=P(require("mobx"));var Xw=P(require("detect-it")),$c=P(require("react"));var US=P(require("mobx")),ap=P(require("mobx"));var Pn=/*#__PURE__*/function(){function Pn(e){_classCallCheck(this,Pn);this.onChanged=null,this.atoms=[],this.observers={},this.id=e}_createClass(Pn,[{key:"addObservedAtom",value:function addObservedAtom(e,t){this.observers&&this.atoms&&(this.observers[e.identifier]=e,this.atoms.push(t))}},{key:"takeObservers",value:function takeObservers(){var e=this.observers;return this.observers=null,e}},{key:"replay",value:function replay(){if(this.atoms){var _iterator235=_createForOfIteratorHelper(this.atoms),_step235;try{for(_iterator235.s();!(_step235=_iterator235.n()).done;){var e=_step235.value;e.reportObserved()}}catch(err){_iterator235.e(err)}finally{_iterator235.f()}}}},{key:"reportChanged",value:function reportChanged(){if(this.atoms){var e=this.onChanged;this.atoms=null,this.observers=null,this.onChanged=null,e==null||e()}}}],[{key:"collectObservations",value:function collectObservations(e,t){var i=new Pn("".concat(Pn.nextId));Pn.nextId+=1,Pn.hub=i;try{return e()}finally{Pn.hub=null;try{t(i)}catch(r){console.error(r)}}}},{key:"observedHub",value:function observedHub(){return Pn.hub}}]);return Pn}(),Jl=Pn;Jl.nextId=0;var WT=/*#__PURE__*/function(){function WT(e,t){_classCallCheck(this,WT);this.atoms={},this.keysHubs={},this.iterationAtom=null,this.iterationHubs=null,this.identifier=e,this.debugName=t}_createClass(WT,[{key:"releaseHubs",value:function releaseHubs(){for(var e in this.keysHubs){delete this.keysHubs[e]}this.iterationHubs=null}},{key:"reportChanged",value:function reportChanged(e,t,i){this.reportAtomChanged(e,i),this.disposeHubs(e)}},{key:"reportAtomChanged",value:function reportAtomChanged(e,t){var i=this.atoms[e];if(i&&i.reportChanged(),this.iterationAtom)switch(t){case B.Removed:case B.Inserted:{this.iterationAtom.reportChanged();break}}i&&t===B.Removed&&delete this.atoms[e]}},{key:"disposeHubs",value:function disposeHubs(e){for(var i in this.iterationHubs){this.iterationHubs[i].reportChanged()}this.iterationHubs=null;var t=this.keysHubs[e];if(t){for(var _i47 in t){t[_i47].reportChanged()}delete this.keysHubs[e]}}},{key:"reportObservedIteration",value:function reportObservedIteration(){var e=this.iterationAtom;e||(e=this.iterationAtom=(0,ap.createAtom)(this.debugName)),e.reportObserved();var t=Jl.observedHub();if(t){var i=this.iterationHubs;i||(i=this.iterationHubs={}),i[t.id]||(i[t.id]=t,t.addObservedAtom(this,e))}}},{key:"reportObservedKey",value:function reportObservedKey(e){var t=this.atoms[e];t||(t=this.atoms[e]=(0,ap.createAtom)(this.debugName)),t.reportObserved();var i=Jl.observedHub();if(i){var _r157=this.keysHubs[e];_r157||(_r157=this.keysHubs[e]={}),_r157[i.id]||(_r157[i.id]=i,i.addObservedAtom(this,t))}}}]);return WT}(),HT=/*#__PURE__*/function(){function HT(){_classCallCheck(this,HT);this.observers={}}_createClass(HT,[{key:"addObserverHub",value:function addObserverHub(e){var t=e.takeObservers();for(var i in t){this.observers[i]=t[i]}}},{key:"clean",value:function clean(){for(var e in this.observers){this.observers[e].releaseHubs()}}}]);return HT}(),VS=/*#__PURE__*/function(){function VS(){_classCallCheck(this,VS)}_createClass(VS,[{key:"observeUpdate",value:function observeUpdate(e){(0,US.runInAction)(e)}},{key:"create",value:function create(e,t){return new WT(e,t)}},{key:"createObserverCollection",value:function createObserverCollection(){return new HT}},{key:"collectObservations",value:function collectObservations(e,t){return Jl.collectObservations(e,t)}}]);return VS}();var lp=/*#__PURE__*/function(){function lp(){_classCallCheck(this,lp);this.listenerNodes=[]}_createClass(lp,[{key:"isOnline",get:function get(){return navigator.onLine}},{key:"addListener",value:function addListener(t){var i={origin:t,onOffline:function onOffline(){return t.onOffline()},onOnline:function onOnline(){return t.onOnline()}};this.listenerNodes.push(i),window.addEventListener("online",i.onOnline),window.addEventListener("offline",i.onOffline)}},{key:"removeListener",value:function removeListener(t){var i=this.listenerNodes.findIndex(function(r){return r.origin===t});if(i!==-1){var _this$listenerNodes$s=this.listenerNodes.splice(i,1),_this$listenerNodes$s2=_slicedToArray(_this$listenerNodes$s,1),_r158=_this$listenerNodes$s2[0];window.removeEventListener("online",_r158.onOnline),window.removeEventListener("offline",_r158.onOffline)}}}]);return lp}();var QS=P(require("query-string"));var ec=new $i({fetcher:window.fetch.bind(window),retryCount:2,retryLoopsCount:0,configmap:{api:{hosts:{"*":ae.shuntApiHosts}},"ppt-api":{hosts:{"*":ae.hosts.pptApi}}}});var tc=/*#__PURE__*/function(){function tc(){_classCallCheck(this,tc);this.map={}}_createClass(tc,[{key:"values",value:function values(t){return this.map[t]}},{key:"has",value:function has(t,i){var r=this.map[t];return r?r.indexOf(i)!==-1:!1}},{key:"put",value:function put(t,i){var r=this.map[t];r||(r=this.map[t]=[]),r.indexOf(i)===-1&&r.push(i)}},{key:"remove",value:function remove(t,i){if(t){if(!i)delete this.map[t];else{var _r159=this.map[t];if(_r159){var n=_r159.indexOf(i);n!==-1&&(_r159.splice(n,1),_r159.length===0&&delete this.map[t])}}}else for(var _r160 in this.map){delete this.map[_r160]}}}]);return tc}();var Qe=/*#__PURE__*/function(){function Qe(t){_classCallCheck(this,Qe);this.listeners=new tc;this.oncesListeners=new tc;if(t)for(var i in t){var _r161=t[i];_r161&&this.listeners.put(i,_r161)}}_createClass(Qe,[{key:"dispatch",value:function dispatch(t,i){var r=0;return r+=this.dispatchTo(t,this.listeners,i),r+=this.dispatchTo(t,this.oncesListeners,i),this.oncesListeners.remove(t),r}},{key:"dispatchTo",value:function dispatchTo(t,i,r){var n=i.values(t);if(n){var _iterator236=_createForOfIteratorHelper(n),_step236;try{for(_iterator236.s();!(_step236=_iterator236.n()).done;){var s=_step236.value;try{r(s)}catch(o){console.error(o)}}}catch(err){_iterator236.e(err)}finally{_iterator236.f()}return n.length}else return 0}},{key:"on",value:function on(t,i){this.listeners.put(t,i)}},{key:"once",value:function once(t,i){this.oncesListeners.put(t,i)}},{key:"off",value:function off(t,i){this.listeners.remove(t,i),this.oncesListeners.remove(t,i)}},{key:"forwardTo",value:function forwardTo(t,i){var r=function r(){for(var _len23=arguments.length,n=new Array(_len23),_key23=0;_key23<_len23;_key23++){n[_key23]=arguments[_key23]}i.dispatch(t,function(s){return s.apply(void 0,n)})};return this.on(t,r),r}}]);return Qe}();var Si;(function(i){i.Mac="mac",i.Windows="windows"})(Si||(Si={}));function _T(){return function(e,t){var i=e.key,r=e.ctrlKey;switch(t){case Si.Mac:return i==="Meta"&&!r;case Si.Windows:return i==="Control";default:return!1;}}}function KT(){return function(e){var t=e.key;return t==="Alt"}}function ic(e){return function(t,i){var r=t.key,n=t.altKey,s=t.ctrlKey,o=t.shiftKey,a=t.nativeEvent;switch(i){case Si.Mac:return r===e&&!s&&!n&&!o&&!!(a==null?void 0:a.metaKey);case Si.Windows:return r===e&&s&&!n&&!o&&t.kind==="KeyDown";default:return!1;}}}var cp=Object.freeze({"delete":Object.freeze(["Backspace","Delete"]),undo:ic("z"),redo:ic("y"),copy:ic("c"),paste:ic("v"),lockCenter:_T(),pencilPaintCircular:KT(),lock:Object.freeze({key:"Shift",altKey:!1,ctrlKey:null,shiftKey:null})}),hp=/*#__PURE__*/function(){function hp(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:cp;_classCallCheck(this,hp);var i=[];for(var _r162 in t){var n=t[_r162];n&&i.push(Object.freeze({kind:_r162,checker:this.toHotKeyChecker(n)}))}this.nodes=Object.freeze(i)}_createClass(hp,[{key:"checkHotKey",value:function checkHotKey(t){var i=this.getKeyboardKind();var _iterator237=_createForOfIteratorHelper(this.nodes),_step237;try{for(_iterator237.s();!(_step237=_iterator237.n()).done;){var _r163=_step237.value;if(_r163.checker(t,i))return _r163.kind}}catch(err){_iterator237.e(err)}finally{_iterator237.f()}}},{key:"getKeyboardKind",value:function getKeyboardKind(){return /^Mac/i.test(navigator.platform)?Si.Mac:Si.Windows}},{key:"toHotKeyChecker",value:function toHotKeyChecker(t){var i=t;if(typeof i!="function"&&(i instanceof Array||(i=[i]),i instanceof Array)){var _r164=Object.freeze(i.map(function(n){var s=n;return typeof s=="string"&&(s={key:s,altKey:!1,ctrlKey:!1,shiftKey:!1}),Object.freeze(I({},s))}));i=function i(n,s){var d;if(s===Si.Windows&&n.kind!=="KeyDown")return!1;var o=n.key,a=n.altKey,l=n.shiftKey,h=n.ctrlKey||!!((d=n.nativeEvent)==null?void 0:d.metaKey);var _iterator238=_createForOfIteratorHelper(_r164),_step238;try{for(_iterator238.s();!(_step238=_iterator238.n()).done;){var u=_step238.value;if(u.key===o&&(u.altKey===null||u.altKey===a)&&(u.ctrlKey===null||u.ctrlKey===h)&&(u.shiftKey===null||u.shiftKey===l))return!0}}catch(err){_iterator238.e(err)}finally{_iterator238.f()}return!1}}return i}}]);return hp}();var dp=P(require("mobx"));var WS=/*#__PURE__*/function(){function WS(){_classCallCheck(this,WS)}_createClass(WS,[{key:"parse",value:function parse(t){var i=t.split("/");if(i[0]!=="")throw new Error("path ".concat(JSON.stringify(t)," should start with \"/\""));i[i.length-1]===""&&i.pop();var r=[];for(var n=1;n<i.length;++n){r.push(i[n].trim())}return r}},{key:"stringify",value:function stringify(t){return"/".concat(t.join("/"))}}]);return WS}(),te=new WS;var up=/*#__PURE__*/function(){function up(t){_classCallCheck(this,up);this.hub={};this.constr=Object.freeze(I({},t))}_createClass(up,[{key:"refresh",value:function refresh(t){this.constr=Object.freeze(I({},t));var _this$constr=this.constr,i=_this$constr.applianceManager,r=_this$constr.sceneNodeClass;for(var n in this.hub){var s=te.parse(n),o=this.hub[n],a=i.scenes.findSceneOrGroup(s);!a||Ye(a,r)?o.zombie():o.setGroup(a)}}},{key:"create",value:function create(t,i){var _this269=this;var _this$constr2=this.constr,r=_this$constr2.applianceManager,n=_this$constr2.sceneNodeClass,s=te.parse(t),o=r.scenes.findSceneOrGroup(s),a=null;if(o){var l,h;if(Ye(o,n)?(s.pop(),l=te.stringify(s),h=r.scenes.findSceneOrGroup(s)):(l=t,h=o),l in this.hub)throw new Error("did create scenes callbacks of path ".concat(JSON.stringify(l),". you should call dispose() before create another one"));a=this.hub[l]=new HS(l,h,function(){return delete _this269.hub[l]},i)}return a}}]);return up}(),HS=/*#__PURE__*/function(_Qe){_inherits(HS,_Qe);var _super87=_createSuper(HS);function HS(t,i,r,n){var _this270;_classCallCheck(this,HS);_this270=_super87.call(this,n);_this270._scenesCount=0;_this270._sceneGroupsCount=0;_this270.state=null;_this270.didZombie=!1;_this270.didDispose=!1;_this270.onGroupsUpdate=function(t){var _iterator239=_createForOfIteratorHelper(t),_step239;try{var _loop26=function _loop26(){var i=_step239.value;switch(i.kind){case B.Inserted:{_this270.dispatch("onAddSceneGroup",function(r){return r(_assertThisInitialized(_this270),i.key)});break}case B.Removed:{_this270.dispatch("onRemoveSceneGroup",function(r){return r(_assertThisInitialized(_this270),i.key)});break}}};for(_iterator239.s();!(_step239=_iterator239.n()).done;){_loop26()}}catch(err){_iterator239.e(err)}finally{_iterator239.f()}};_this270.onScenesUpdate=function(t){var _iterator240=_createForOfIteratorHelper(t),_step240;try{var _loop27=function _loop27(){var i=_step240.value;switch(i.kind){case B.Inserted:{_this270.dispatch("onAddScene",function(r){return r(_assertThisInitialized(_this270),i.key)});break}case B.Removed:{_this270.dispatch("onRemoveScene",function(r){return r(_assertThisInitialized(_this270),i.key)});break}}};for(_iterator240.s();!(_step240=_iterator240.n()).done;){_loop27()}}catch(err){_iterator240.e(err)}finally{_iterator240.f()}};_this270.path=t,_this270.setGroup(i),_this270.onDispose=r;return _this270}_createClass(HS,[{key:"scenes",get:function get(){var t=[];if(this.state){var _iterator241=_createForOfIteratorHelper(this.state.group.scenesList),_step241;try{for(_iterator241.s();!(_step241=_iterator241.n()).done;){var i=_step241.value;t.push(i.name)}}catch(err){_iterator241.e(err)}finally{_iterator241.f()}}return t}},{key:"scenesCount",get:function get(){return this._scenesCount}},{key:"sceneGroups",get:function get(){var t=[];if(this.state){var _iterator242=_createForOfIteratorHelper(this.state.group.groupsList),_step242;try{for(_iterator242.s();!(_step242=_iterator242.n()).done;){var i=_step242.value;t.push(i.name)}}catch(err){_iterator242.e(err)}finally{_iterator242.f()}}return t}},{key:"sceneGroupsCount",get:function get(){return this._sceneGroupsCount}},{key:"setGroup",value:function setGroup(t){var _this271=this;if(!this.didZombie){this.state&&this.cleanState(this.state);var i=t.groupsMap,_r165=t.groupsList,n=t.scenesMap,s=t.scenesList;on(i,this.onGroupsUpdate),on(n,this.onScenesUpdate),this._sceneGroupsCount=_r165.length,this._scenesCount=s.length;var o=[(0,dp.reaction)(function(){return _r165.length},function(a){_this271._sceneGroupsCount=a,_this271.dispatch("onScenesGroupCountUpdate",function(l){return l(_this271,a)})}),(0,dp.reaction)(function(){return s.length},function(a){_this271._scenesCount=a,_this271.dispatch("onScenesCountUpdate",function(l){return l(_this271,a)})})];this.state={group:t,disposers:o}}}},{key:"zombie",value:function zombie(){this.didZombie||(this.didZombie=!0,this.state&&(this.cleanState(this.state),this.state=null))}},{key:"cleanState",value:function cleanState(_ref104){var t=_ref104.group,i=_ref104.disposers;var _iterator243=_createForOfIteratorHelper(i),_step243;try{for(_iterator243.s();!(_step243=_iterator243.n()).done;){var _r166=_step243.value;_r166()}}catch(err){_iterator243.e(err)}finally{_iterator243.f()}an(t.groupsMap,this.onGroupsUpdate),an(t.scenesMap,this.onScenesUpdate),this._scenesCount=0,this._sceneGroupsCount=0}},{key:"dispose",value:function dispose(){this.didDispose||(this.didDispose=!0,this.zombie(),this.onDispose())}}]);return HS}(Qe);var ur=P(require("mobx"));var rc=P(require("mobx"));function ue(e){var t=_typeof(e);return t!=="object"||e===null?t==="function"?void 0:e:He(e)?At(e):e instanceof Array?GT(e):(0,rc.isObservable)(e)?$T(e):YT(e)}function GT(e){var t=[],i=e.length;for(var _r167=0;_r167<i;++_r167){t[_r167]=ue(e[_r167])}return t}function $T(e){var t={};var _iterator244=_createForOfIteratorHelper((0,rc.keys)(e)),_step244;try{for(_iterator244.s();!(_step244=_iterator244.n()).done;){var i=_step244.value;t[i]=ue(e[i])}}catch(err){_iterator244.e(err)}finally{_iterator244.f()}return t}function YT(e){var t={};for(var i in e){t[i]=ue(e[i])}return t}var In=P(require("mobx"));function _S(e,t){return(0,In.isObservable)(e)?(0,In.has)(e,t):t in e}function KS(e){return(0,In.isObservable)(e)?(0,In.keys)(e):Object.keys(e)}function dr(e,t){if(_typeof(e)!=_typeof(t))return!1;if(_typeof(e)!="object"||e===null)return e===t;if(e.constructor!==t.constructor)return!1;if(e.constructor===Object){var _iterator245=_createForOfIteratorHelper(KS(e)),_step245;try{for(_iterator245.s();!(_step245=_iterator245.n()).done;){var i=_step245.value;if(_S(t,i)){if(!dr(e[i],t[i]))return!1}else return!1}}catch(err){_iterator245.e(err)}finally{_iterator245.f()}var _iterator246=_createForOfIteratorHelper(KS(t)),_step246;try{for(_iterator246.s();!(_step246=_iterator246.n()).done;){var _i48=_step246.value;if(!_S(e,_i48))return!1}}catch(err){_iterator246.e(err)}finally{_iterator246.f()}return!0}else if(e.constructor===Array){var _i49=e,_r168=t;if(_i49.length===_r168.length){for(var n=0;n<_i49.length;++n){if(!dr(_i49[n],_r168[n]))return!1}return!0}else return!1}else if(_typeof(e)=="object"){for(var _i50 in e){if(_i50 in t){if(!dr(e[_i50],t[_i50]))return!1}else return!1}for(var _i51 in t){if(!(_i51 in e))return!1}return!0}else return!0}var Ho=/*#__PURE__*/function(){function Ho(_ref105){var _this272=this;var t=_ref105.disableMaskKey,i=_ref105.useMobXMode,r=_ref105.propertyGetters,n=_ref105.onStateChanged;_classCallCheck(this,Ho);this.didStateReady=!1;this.updatedState={};this.activeUpdateKey=null;this.updateState=function(){var t=_this272.updatedState;_this272._state=_this272.patchState(t),_this272.updatedState={},_this272.onStateChanged&&_this272.onStateChanged(t)};this.disableActiveCallback=t,this.useMobXMode=i,this.updateLimiter=new dt(0,this.updateState),this.onStateChanged=n,this.disposers=this.createAutoRun(r),(0,ur.makeObservable)(this,{activeUpdate:ur.action,patchState:ur.action})}_createClass(Ho,[{key:"state",get:function get(){return this._state}},{key:"release",value:function release(){var _iterator247=_createForOfIteratorHelper(this.disposers),_step247;try{for(_iterator247.s();!(_step247=_iterator247.n()).done;){var t=_step247.value;t()}}catch(err){_iterator247.e(err)}finally{_iterator247.f()}}},{key:"activeUpdate",value:function activeUpdate(t,i){try{this.activeUpdateKey=t;var _r169=i();return this._state=this.setState(t,_r169),this.onStateChanged&&!this.disableActiveCallback&&this.onStateChanged(_defineProperty({},t,_r169)),_r169}finally{this.activeUpdateKey=null}}},{key:"createAutoRun",value:function createAutoRun(t){var _this273=this;var i=[],r={fireImmediately:!0};var _loop28=function _loop28(n){var s=t[n],o=function o(a){if(!_this273.didStateReady)_this273.updatedState[n]=a;else{var l=n in _this273.updatedState?_this273.updatedState[n]:_this273._state[n];_this273.activeUpdateKey!==n&&!dr(a,l)&&(_this273.updatedState[n]=a,_this273.updateLimiter.invoke())}};i.push((0,ur.reaction)(function(){return s()},o,r))};for(var n in t){_loop28(n)}return this._state=this.createState(this.updatedState),this.updatedState={},this.didStateReady=!0,i}},{key:"createState",value:function createState(t){return this.useMobXMode?(0,ur.observable)(t):Object.freeze(ue(t))}},{key:"patchState",value:function patchState(t){if(this.useMobXMode){for(var i in t){this._state[i]=t[i]}return this._state}else{var _i52=I({},this._state);for(var _r170 in t){_i52[_r170]=ue(t[_r170])}return Object.freeze(_i52)}}},{key:"setState",value:function setState(t,i){return this.useMobXMode?(this._state[t]=i,this._state):Object.freeze(D(I({},this._state),_defineProperty({},t,ue(i))))}}]);return Ho}();function _o(e){switch(e){case Jt.Desktop:return 2.42;case Jt.Phone:return 2.42;case Jt.Pad:return 2.42;case Jt.TV:return 2.42;default:return 1;}}var q={"arrow-down-disabled":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsPSIjRTdFN0U3IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-down-hover":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsPSIjN0Q3RDdEIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-down-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsPSIjNUI5MDhFIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-down":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up-disabled":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsPSIjRTdFN0U3IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up-hover":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsPSIjN0Q3RDdEIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsPSIjNUI5MDhFIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","bold-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQuNSAySDhhMi41IDIuNSAwIDAgMSAwIDVINS41aDBtLTEgMGg0YTMgMyAwIDAgMSAwIDZoLTQgMG0wIDFWMiIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",bold:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQuNSAySDhhMi41IDIuNSAwIDAgMSAwIDVINS41aDBtLTEgMGg0YTMgMyAwIDAgMSAwIDZoLTQgMG0wIDFWMiIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",check:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOCIgaGVpZ2h0PSI4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIG9wYWNpdHk9Ii4wMSIgZD0iTTAgMGg4djhIMHoiLz48cGF0aCBkPSJNNy4xMjUgMS40ODRoLS41NDZhLjI0OS4yNDkgMCAwIDAtLjE5Ni4wOTZMMy4xNjIgNS42NiAxLjYxNyAzLjcwM2EuMjUuMjUgMCAwIDAtLjE5Ni0uMDk1SC44NzVhLjA2Mi4wNjIgMCAwIDAtLjA1LjFsMi4xNCAyLjcxMmEuMjUuMjUgMCAwIDAgLjM5NCAwbDMuODE1LTQuODM2YS4wNjIuMDYyIDAgMCAwLS4wNDktLjF6Ii8+PC9zdmc+","delete":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDZ2NmEyIDIgMCAwIDEtMiAySDZhMiAyIDAgMCAxLTItMlY2aDBtMS0yYTIgMiAwIDAgMSAyLTJoMmEyIDIgMCAwIDEgMiAyaDBNMyA0aDEwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==",duplicate:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0xMSAySDZhMSAxIDAgMCAwLTEgMXY4YTEgMSAwIDAgMCAxIDFoNmExIDEgMCAwIDAgMS0xVjRoMGwtMi0yeiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+PHBhdGggZD0iTTExIDJ2MWExIDEgMCAwIDAgMSAxaDFsLTItMnoiLz48cGF0aCBkPSJNOSAxNEg0YTEgMSAwIDAgMS0xLTFWNWgwIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48L2c+PC9zdmc+","eraser-cursor":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANKSURBVHgB1VTdS5NhFD/7iuXa8KNw7SK/IjBYo13soqvEITENtj9AwZiCOCTvQrNWF9rFFPGLrC1iF10Oiy68mBSUF2KB4YabhKKyTfFCc+3Lzb2ds72LsfbxCkZ04Mf7Puc5z/k95+M5AP+R8OAvCW9nZ6cyHo8/SSaTc4RQKKQ+S0JyxFtbW6va39//ZjKZmMbGRkar1TJOp5MhYtwXwBkQkgMROnyXIcmGw+FgYrHY00JkQm4cqYPCaDQ6ZrFY7i4sLPxhMDg4SJ8hTOOWRCJ5jf8npyUiEgE6eGy1Wk12u72gIZHJZDLr4eHhVnl5+YdsslL5pH1+JBIx22y2h9PT01BKpFIpLC4ufhKJRFpcxhEM6fmlSMLh8P35+XlOJCTBYBC2t7dr8fdctv+iRHjI4HK5LAMDA8BVFAoFyOVyH/6KIKsxCtVIgC188+Dg4CV2GJxGpqamYHR09AHklEWQY5d6K/gg67HD3huNRrlKpYLNzU3gIsPDw8Dn84fa29s/4zIK6Rol8xIhSUMikXB2dXXV4AHo6en5KhaLFcvLy0VJent7QaPRzKrV6le4DCEi2UTCnGgE1dXVj3Q6XY1er08drKiosK2urnbjnrFQQxBJU1PTC3y4kyxJGHEMWe2dTUSNIcLZVXl0dAStra3BiYmJOTqgVCqfu91uull3LhlFjbZv6urqiCTIElHaEsC2dq4QqXRlZeUePsrUDFtfX/eZzebbqL+GuIFks1js32OHRtHu7u5H3FMiahFViPNQYuZRO8oQVzY2NibJocFgYAKBgLuzs/M66hsQKuzELx0dHak9rKe3paXlFurrERdZEiGUGARkcAFxmSJAJ/aRkRGGnOKwdPn9/rG9vT0HXaC5uZnxer3+vr4+HdpeRVxClBWLJFuZqhF7gAjL0PGz8fFxvcfjSY0WevVUv5mZmQDWyog1/I52PyBdlxgUqUu+qMSQznVtW1ubBlP3dmlpicnA5/N5+vv770C6bhS9lEu6eHnWFP45NioJS5xxRLdNsrenKH5CusNOWH1BEeTRMTnI6MgZpYYeYhhOmS5eEX0mMhELPktGoBd/zCWSUkTAOs4QZqZ8JsokS8Kp8KWICtlwdv5P5BchBHaEIRURoQAAAABJRU5ErkJggg==","eraser-cursor@2x":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAgrSURBVHgB7ZprTBRXFIDP7gIt8lQppTwE5V0KaAn6o1pqNGkDDTEmTUhsgKRp+gNJw68CFkLbVC2QkDS+gD8KJdWmARvbFBNNWpuIRGPFWBXQRMPDqIki+KLATs+ZnTvcvXtnX8w2beJJToaduTP3fHPOPffcOwC8kP+2WCDwIvahGFxTuN8KmNSZmULPNjLeqF9F8rdPkIEGEn+r+vjx46LQ0NA8/Dsader58+e/h4WFDWntFO7ot6fMFAt3JLWi2lCDpqamCux2+2+KROj82NhYGrXT2lu5Z/DP/deFByElA4Pv3LlTiHY/nJ6eVnbv3q1s2bJFyc7OVrZu3arU1dUp4+PjxPUQoT+g9tp9PkMFgpo9kxljHRoaWp2Xl3duYmIiurKyEvDoclNCQgIcPnxYPc7MzHwcGRnZhaft4Ag7O9fUbRhaITCie4lgcnNzT7qDIaHz27dvh+vXr0NEREQneqoCHKFnAR+8ZCaQGGq2CxcurCGYycnJZHcwTNAzUFFRoUJFRUV1IFQ5OKBsXB9uxSwgl0TQ3d29Yt26dccwoyVXV1d7hGEiQmGi2AzOUHx/hob4K2yuYS9G987s7OwPISEh7xPM6dOnwVfBsIMjR45AZmbmo5s3b76Xnp7+J55egMVxBSAZT0v1ED+76yn66dOnLQSzd+9ev2BIyFP0MjBco1JTU/sxfFeDazp3cYgZHmKqdoaGNISHh9fv378fSJcqlPV6e3sBJ+I/goOD34VFL0k95Y+HxPHCYGxmw5DQ2NuzZw8EBQVtunXr1jvgwUP+hhz/QDXMMCNVE8zx48dNg2FCz6QQjI2N/RA8VBFmANnu3btXihnpG8pM9fX1EAi5du0aeWkVOAMBCF7yN+R0z4yOjq6NiYlpp9CgdBtIwXpPH6vgDKWLt0CygtM6MDCwBuUYZSKaOCksAiVY9wFOBePgDOOytPAGSKzNVCCC2bBhw69YdK7ypgpYimzbtk2dl7CM+hFcveOUHDylbTFO1YdhFbByx44dA1QFUP0VSJj4+Hjo6+sDq9U6iEmHKvFZTedQ50GYbN15SITVlwNlZWUnLRZL8s6dOwMOQ9UCTtKTra2ttdppt9V2kMF5cbmsjxuM43bMNrmUzc6fP6+GQiDGDoOJi4ubwb4qm5ubafyIE6nLxGqTPEsGo1cBOGNX0TyDYafC0CyOaxcVziyh53Z2dkJycvLMvn37PmpoaBgFR4jxYSbWdVIgI89Iq4CjR48CZjlYv369+tssqI6ODsjPz4f+/v668vLycxrEHHfkYdwC8SB6mGEV8Cl64cuuri5oa2tTG+EyGjZu3AiXLl1qefDgwV8lJSUFZkDV1tZCcXExXLx4sbWoqKgPFj0zx8GI9ZwO5W4M6ekZYeqpaqbqmaSqqkpNpcPDw4dwzfM9nrLduHEjEs+X0XV/Sx96LnqE1kLtBQUF3eDwCO8dGQyzV5rl+JyuegfXI29jRotiRlKnpFghHMzKyjqotVXS0tLacKPjF3bdHxjSq1evduAkepAD+ZsDYlC8V5w8ZBVg+PPq2MGMlkInqE4joTf45MmT4YyMjAPcA+ltLSQlJX2BafxnX6HI29QeK44TOTk57mCYZ0QoJ8OBM4yB6dkNkwGlSygsLFQvYtYB3BTMxFL+M+0eFgZqp4mJiU2+QKGX1fGIk/QIrn0aYXGsyDxjmAyMhO2jhaCGoUbX1NSkLSwsPMJqV8Fspu6lIZS6OYhjiOLwdU7fQM1HfRPD7wS1obZ0j0xpb4726Z49ezaJf2/S7s9ATUGNR41BjdJseRnke3WGwhrRTS9pD1mOGoeG15BxOOfoxuCkp0Ih6NeaEaSZGlieJyiCoc1FgsGldokGk8nBvAKOrWIGQ5uPsm0tt0BWDiicAaGuGhkZ+YqMw9StGzU4OKhCnT179hNsswY1FTXdE5QEJhc1S3tGogazXLOBwQSBl3tzIhQPtAL1VQJCTcNx8y1vHIUghSKFZE9PT7H2dlM1b+Wgrr1y5Uq77J75+fnplpaWMg2ch4nlYEI5z7hdensDpI4hrYNErcMMXJ32koG4ztf3pultz83NjWG99Ra2WQ0OL2VjZjwgeufUqVOqV8+cOdPIwdBLSNJeHg8TAh5WqJ6EfSmgt7IMNRJ1JThiOlnrOAMHshprmMKdoGSCpb9s3B3SYLIFGIqICJB7xisYi+RvfiypXw40DWGdlJaWRmMd141hk8V2OWm7ieYTXhBc3+BgaZyqAISjOYxSMVvXsBTNlzdiNQDgRao2AtK3pjggpmrqbGpqSsLPIN/dv38/gaBwUjTshMHcvn27JyUlpRmc5xpPMD599LIYnLNyUKKndKjGxsakXbt2deMCLIE8IVvs0YRM1fjdu3d/wrXN5+BcnzEgvor2uN3rjzAYMp5lPEoQlE5fA0fWo8GfhlCbKVFQ1pKNIfzcOHH58mWqaimVUwJI0+6n59D4pIlzmdZPMPiZzXjDjX47Le5g0Uu8x2zgPqWyKpjVe7x3+AUbq9NYjQbgp2dsBud5o8TP7d5kHAWcQchQfoEmLgn8HjOiBIF7o5hI1x6CEbLNP3bdqYAF44JzyWLzcN1i8DcT/o3awbm8Fz3DAy2A62INwPV/E3wWdx5inmBHuwChCBD6R2JwHge80TIQRQLjt7e8DTkGZgfX8cUMZTDAteFDkveaIlzjX9ySQs8X18r2t2VHUURPKoICmDR+eCO9aSdmOIub3/w9RgpgUpiJhvraXpa6jZKHGEqyusw0GLFzX+5RhN/8kYnMSNMMfyH/V/kHST6OYVElTPAAAAAASUVORK5CYII=","font-colors-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTQgMTEgNC05IDQgOU02IDdoNCIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","font-colors":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTQgMTEgNC05IDQgOU02IDdoNCIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","font-size-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTIgMmg4TTYgMnYxMm02LTZ2Nm0tMi02aDQiIHN0cm9rZT0iIzMzODFGRiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","font-size":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTIgMmg4TTYgMnYxMm02LTZ2Nm0tMi02aDQiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","hand-grasp":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZD0iTTExLjcyIDE0LjM0NEg0Ljk3OGMtLjUxMyAwLS45MzEtLjQ3My0uOTMxLTEuMDU1IDAtLjQ0Mi0uMS0uNzQ0LS4zMzQtMS4wMUwuNDQ2IDguNzQxLjQ0NCA4Ljc0QTEuNzkgMS43OSAwIDAgMSAwIDcuNTU0VjQuODc4QzAgMy45OC42NDUgMy4yNSAxLjQzNyAzLjI1Yy4zOTQgMCAuNzU5LjE3NiAxLjAyOC40OTUuMDkyLjExLjE3LjIzMS4yMzIuMzYzVjIuMjAyYzAtLjg5OC42NDUtMS42MjggMS40MzctMS42MjguNTcgMCAxLjA1NC4zNjcgMS4yODcuOTEzLjA1OC0uMzYuMjEtLjY5Mi40NDMtLjk1NUExLjUwNiAxLjUwNiAwIDAgMSA3IDBhLjguOCAwIDAgMSAuMTc0LjAxNWMuNjMyLjA4IDEuMTQyLjU3OSAxLjM0MSAxLjI1LjItLjYyNi43My0xLjA3NCAxLjM1LTEuMDc0LjEgMCAuMTkzLjAxMy4yOC4wMjdsLjAxNS4wMDNjLjY2Mi4xNTYgMS4xNDMuODQzIDEuMTQzIDEuNjM1di4zM2MuMjQ0LS41MDQuNzE3LS44NDggMS4yNi0uODQ4LjM5NCAwIC43NTkuMTc2IDEuMDI4LjQ5NC4yNjQuMzEyLjQwOS43MjguNDA5IDEuMTd2Mi45NGMwIC4zNTItLjAzOC42ODYtLjExNC45OTNsLTEuMTM4IDUuMjEtLjAwMS4wMDRhMy41MyAzLjUzIDAgMCAwLS4wOTYuODQxdi4yOTljMCAuNTgyLS40MTcgMS4wNTUtLjkzIDEuMDU1eiIgZmlsbD0iIzAwMCIvPjxwYXRoIGQ9Im0xLjAyNCA4LjM5OSAzLjE1MiAzLjQxMi4wMDIuMDAyYy4zMi4zNjMuNDY4LjguNDY4IDEuMzc0IDAgLjI0OC4xODUuNDU3LjQwNC40NTdoNi41MDdjLjIxOCAwIC40MDMtLjIxLjQwMy0uNDU3VjEyLjljMC0uMzQuMDM3LS42NjIuMTEtLjk1OWwxLjA5OC01LjAyNlY2LjkxYTMuMzcgMy4zNyAwIDAgMCAuMDkzLS44MTJWMy4yNjJjMC0uNTg2LS4zOTEtMS4wNDUtLjg5MS0xLjA0NS0uNDkyIDAtLjg5MS40NTMtLjg5MSAxLjAxdi42NWgtLjgyVjIuMTU1YzAtLjQ5Ni0uMjk1LS45MjYtLjcwMS0xLjAyNS0uMDY2LS4wMS0uMTMtLjAyLS4xOTEtLjAyLS40OTEgMC0uODkxLjQ1My0uODkxIDEuMDF2MS43NTdoLS44MlYyLjE5YzAtLjY1MS0uNDA4LTEuMTktLjk0OC0xLjI1NEw3LjA5Ni45MzQgNy4wODUuOTMyYy0uMDI3LS4wMDYtLjA1LS4wMDYtLjA4My0uMDA2LS41ODEgMC0xLjA1NC41MzYtMS4wNTQgMS4xOTV2MS43NTZoLS44MlYyLjUyNGMwLS41ODYtLjM5Mi0xLjA0NC0uODkxLTEuMDQ0LS40OTIgMC0uODkyLjQ1My0uODkyIDEuMDF2NS41OTJsLS44Mi0uODcyVjUuMTA2YzAtLjU4Ni0uMzkxLTEuMDQ1LS44OS0xLjA0NS0uNDkzIDAtLjg5Mi40NTMtLjg5MiAxLjAxdjIuNTgzYzAgLjI3NC4xLjUzOC4yOC43NDV6IiBmaWxsPSIjRkZGIi8+PHBhdGggZD0iTTUuNTY2IDYuMDgydjQuNjM2YzAgLjE5LjIyMy4zNDQuNS4zNDQuMjc2IDAgLjUtLjE1NC41LS4zNDRWNi4wODJjMC0uMTktLjIyNC0uMzQ0LS41LS4zNDQtLjI3NyAwLS41LjE1NC0uNS4zNDR6bTIuMTggMHY0LjYzNmMwIC4xOS4yMjQuMzQ0LjUuMzQ0cy41LS4xNTQuNS0uMzQ0VjYuMDgyYzAtLjE5LS4yMjQtLjM0NC0uNS0uMzQ0cy0uNS4xNTQtLjUuMzQ0em0yLjE4IDB2NC42MzZjMCAuMTkuMjI0LjM0NC41LjM0NHMuNS0uMTU0LjUtLjM0NFY2LjA4MmMwLS4xOS0uMjI0LS4zNDQtLjUtLjM0NHMtLjUuMTU0LS41LjM0NHoiIGZpbGw9IiMwMDAiLz48L2c+PC9zdmc+","hand-loosen":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTkiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZD0iTTkuMTU0IDBBMS4yMjYgMS4yMjYgMCAwIDAgOC4xMS42MDdjLS4yMDguMzQ4LS4yOTUuNzY4LS4zNDUgMS4yMzItLjEuOTI5LS4wMjUgMi4wNTgtLjAxNCAzLjA0Ni4wMDcuNTEyLjAwNCAxLjA0MS0uMDAxIDEuNTQ3YTYzLjMxIDYzLjMxIDAgMCAxLS4zNS0uOXYtLjAwM2wtLjAwMS0uMDAxYy0uMzU5LS45MjYtLjY5Mi0xLjg3LTEuMTUtMi41NjItLjIzLS4zNDYtLjQ5Ni0uNjQtLjg1LS44MDctLjM1Ni0uMTY2LS43OTItLjE2NS0xLjIwNC4wMmwtLjAwMy4wMDEtLjAwNC4wMDJjLS40LjE4Ny0uNjUuNTYzLS43MjIuOTU4LS4wNzQuMzk0LS4wMTkuODEyLjA4MiAxLjI2Mi4yMDMuOS42MTMgMS45NC44OTIgMi45Ny4yMi44MTMuNDM0IDEuNjMyLjYxMyAyLjMyMmExMy44NTUgMTMuODU1IDAgMCAwLS44NzQtLjgxNmMtLjU0My0uNDYyLTEuMTQtLjg4OS0xLjc1Ny0xLjExOS0uNjE2LS4yMy0xLjMyMy0uMjQ0LTEuODQ1LjIxOGwtLjAwNC4wMDQtLjAwNC4wMDRjLS40MS4zODQtLjYxNC44Ni0uNTYgMS4zMjMuMDUzLjQ2NC4zMDcuODcxLjY0MiAxLjI5LjY2OS44MzYgMS43MiAxLjc1MSAyLjczNCAyLjk2OCAxLjEzNSAxLjM2MiAyLjM3MiAzLjUzOCAzLjI1MSA0LjY4MWwuMTE4LjE1M2g3LjcwNGwuMDg2LS4yNzRjLjE1LS40ODIuMzE4LTEuNDQyLjU4Ny0yLjY0Mi4yNjgtMS4yLjYyNy0yLjYxIDEuMTA0LTMuODQ3LjYzNS0xLjY0NiAxLjI4NS0zLjE5NCAxLjU3Ny00LjQyMy4xNDctLjYxNC4yMTQtMS4xNTEuMDk1LTEuNjI2YTEuMzA2IDEuMzA2IDAgMCAwLTEuMDQ4LS45NmMtLjQ2Ny0uMDg4LS45MS4xMi0xLjIyLjQzNC0uMzEuMzE2LS41NDYuNzM2LS43NjUgMS4yMDctLjE3LjM2NS0uMzI3Ljc2NS0uNDgxIDEuMTY2bC0uMDEtMS43MzRjLS4wMDQtMS4wMDcuMDU5LTIuMTM2LS4wMTctMy4wNDQtLjAzOC0uNDU1LS4xMDMtLjg1NS0uMjcyLTEuMTkxLS4xNjUtLjMyNy0uNTI0LS42LS45MjUtLjU4NWExLjE4IDEuMTggMCAwIDAtLjk2OS40NmMtLjIyMy4yODUtLjM1NC42MzYtLjQ1OSAxLjAyMy0uMjEuNzczLS4zMDIgMS43MDktLjQ0MyAyLjQ4bC0uMTk1IDEuMDkyYTQ1Ljg3NCA0NS44NzQgMCAwIDEtLjEzNi0xLjE4N2MtLjA5NC0uOTM3LS4xNi0yLjA1NS0uMzU2LTIuOTctLjA5Ny0uNDU3LS4yMjItLjg2Ni0uNDM1LTEuMTk5LS4yMTQtLjMzMi0uNTgyLS41OTctMS4wMS0uNTc5aC4wM0w5LjE1NSAweiIgZmlsbD0iIzAwMCIvPjxwYXRoIGQ9Ik05LjE1Ljc4NGguMDQ5Yy4xMzItLjAwNS4xOTUuMDMuMzE3LjIyLjEyMy4xOTIuMjQxLjUyOC4zMjkuOTM5LjE3NS44Mi4yNDUgMS45MjQuMzQyIDIuODg0LjIxMiAyLjEwOC41MTQgMy42MzUuNTE0IDMuNjM1bC43Ny0uMDEzcy4yODctMS43NjMuNTk4LTMuNDYzYy4xNS0uODIuMjQ3LTEuNzQ2LjQyOS0yLjQxNy4wOS0uMzM1LjIwNy0uNi4zMTktLjc0My4xMTItLjE0Mi4xNjktLjE3NC4zMTktLjE2M2wuMDMuMDAyLjAyOC0uMDAyYy4xMi0uMDA5LjExNi0uMDEuMi4xNTYuMDg0LjE2Ny4xNTcuNDk1LjE5MS45MDMuMDY4LjgxNS4wMSAxLjk0Mi4wMTUgMi45ODNsLjAxOSAzLjcwNS43NDUuMTY4Yy40NTUtLjk0OC44MTktMi4xMTIgMS4yMjEtMi45NzguMjAxLS40MzMuNDE1LS43ODcuNjEzLS45ODguMTk3LS4yLjMyMy0uMjUuNTE2LS4yMTNoLjAwNGwuMDA1LjAwMmMuMjk5LjA1MS4zNi4xMjcuNDI0LjM3OC4wNjMuMjUuMDM1LjY5Ny0uMDk3IDEuMjU0LS4yNjUgMS4xMTUtLjkwNyAyLjY2NC0xLjU0NiA0LjMyMi0uNTAyIDEuMy0uODY2IDIuNzQtMS4xMzggMy45NTctLjIyLjk4My0uMzg3IDEuODM0LS40OTkgMi4zMDRINy4xNDRjLS44MDItMS4wOS0xLjk5Ny0zLjE2LTMuMTU3LTQuNTUyLTEuMDYtMS4yNzEtMi4xMzYtMi4yMi0yLjcyNC0yLjk1Ni0uMjk0LS4zNjgtLjQ1LS42NzMtLjQ3Ni0uODktLjAyNS0uMjE1LjAyNi0uMzg2LjMxMi0uNjU2LjI3LS4yMzcuNTgyLS4yNDMgMS4wNDktLjA2OS40NjcuMTc1IDEuMDE4LjU1MiAxLjUyNC45ODJhMTUuODggMTUuODggMCAwIDEgMS44NDcgMS45MDRsLjY4Ny0uMzRzLS41MDQtMi4wMS0xLjAxLTMuODcyQzQuOTAzIDYuMDggNC40OTQgNS4wMyA0LjMxNCA0LjIzYy0uMDktLjQtLjExNi0uNzMzLS4wNzctLjk0Ny4wNC0uMjEzLjA5Ny0uMzAyLjI4My0uMzkuMjQ4LS4xMS4zODgtLjA5OC41NDctLjAyNC4xNTkuMDc0LjM0NC4yNTEuNTI5LjUzLjM2OC41NTcuNzEgMS40NzYgMS4wNzMgMi40MTJsLS4wMDItLjAwNGMuMzcuOTgzIDEuMDc4IDIuNzE0IDEuMDc4IDIuNzE0bC43NTUtLjEzN3MuMDU1LTEuOTEuMDM2LTMuNTA5Yy0uMDEyLTEuMDE4LS4wNzgtMi4xMzYuMDEtMi45NTIuMDQzLS40MDguMTMxLS43MzUuMjM4LS45MTUuMTA3LS4xNzkuMTctLjIyNS4zNjctLjIyNHoiIGZpbGw9IiNGRkYiLz48cGF0aCBkPSJNNy43MjMgMTAuOHY0LjY5MmMwIC4xOTIuMjIzLjM0OC41LjM0OC4yNzYgMCAuNS0uMTU2LjUtLjM0OFYxMC44YzAtLjE5Mi0uMjI0LS4zNDgtLjUtLjM0OC0uMjc3IDAtLjUuMTU2LS41LjM0OHptMi4yMDYgMHY0LjY5MmMwIC4xOTIuMjI0LjM0OC41LjM0OHMuNS0uMTU2LjUtLjM0OFYxMC44YzAtLjE5Mi0uMjI0LS4zNDgtLjUtLjM0OHMtLjUuMTU2LS41LjM0OHptMi4yMDYgMHY0LjY5MmMwIC4xOTIuMjI0LjM0OC41LjM0OC4yNzcgMCAuNS0uMTU2LjUtLjM0OFYxMC44YzAtLjE5Mi0uMjIzLS4zNDgtLjUtLjM0OC0uMjc2IDAtLjUuMTU2LS41LjM0OHoiIGZpbGw9IiMwMDAiLz48L2c+PC9zdmc+","italic-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTcgMTQgOSAyTTUgMTRoNE03IDJoNCIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",italic:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTcgMTQgOSAyTTUgMTRoNE03IDJoNCIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","laser-pointer-cursor":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGZpbHRlciB4PSItMTIwJSIgeT0iLTEyMCUiIHdpZHRoPSIzNDAlIiBoZWlnaHQ9IjM0MCUiIGZpbHRlclVuaXRzPSJvYmplY3RCb3VuZGluZ0JveCIgaWQ9ImEiPjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjQiIGluPSJTb3VyY2VHcmFwaGljIi8+PC9maWx0ZXI+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDkgOSkiIGZpbGw9IiNGRjAxMDAiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PGNpcmNsZSBmaWx0ZXI9InVybCgjYSkiIGN4PSI1IiBjeT0iNSIgcj0iNSIvPjxwYXRoIGQ9Ik01IDhhMyAzIDAgMSAwIDAtNiAzIDMgMCAwIDAgMCA2em0wLTEuNzE0YTEuMjg2IDEuMjg2IDAgMSAxIDAtMi41NzIgMS4yODYgMS4yODYgMCAwIDEgMCAyLjU3MnoiIGZpbGwtcnVsZT0ibm9uemVybyIvPjwvZz48L3N2Zz4=","layer-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTE2IDEwLTYgNCA2IDQgNi00em0tNiA4IDYgNCA2LTQiIHN0cm9rZT0iIzMzODFGRiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+",layer:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTE2IDEwLTYgNCA2IDQgNi00em0tNiA4IDYgNCA2LTQiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","line-through-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQgOGg4bS0xLTNhMyAzIDAgMCAwLTMtM2gtLjkzOEEyLjY0IDIuNjQgMCAwIDAgNC41IDRhMi41NyAyLjU3IDAgMCAwIDEuMzQ0IDIuOTIybDQuMzEyIDIuMTU2QTIuNTcgMi41NyAwIDAgMSAxMS41IDEyYTIuNjQgMi42NCAwIDAgMS0yLjU2MiAySDdhMyAzIDAgMCAxLTMtM2gwIiBzdHJva2U9IiMzMzgxRkYiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","line-through":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQgOGg4bS0xLTNhMyAzIDAgMCAwLTMtM2gtLjkzOEEyLjY0IDIuNjQgMCAwIDAgNC41IDRhMi41NyAyLjU3IDAgMCAwIDEuMzQ0IDIuOTIybDQuMzEyIDIuMTU2QTIuNTcgMi41NyAwIDAgMSAxMS41IDEyYTIuNjQgMi42NCAwIDAgMS0yLjU2MiAySDdhMyAzIDAgMCAxLTMtM2gwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","lock-hover":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZmlsbD0iIzAwMCIgb3BhY2l0eT0iLjAxIiBkPSJNMCAwaDE2djE2SDB6Ii8+PHBhdGggZD0iTTEzIDcuMjVoLTEuMDYzdi0zLjVhMiAyIDAgMCAwLTItMkg2LjA2M2EyIDIgMCAwIDAtMiAydjMuNUgzYS41LjUgMCAwIDAtLjUuNXY2YS41LjUgMCAwIDAgLjUuNWgxMGEuNS41IDAgMCAwIC41LS41di02YS41LjUgMCAwIDAtLjUtLjV6bS00LjU2MyAzLjcwM3YuODI4YS4xMjUuMTI1IDAgMCAxLS4xMjQuMTI1aC0uNjI2YS4xMjUuMTI1IDAgMCAxLS4xMjUtLjEyNXYtLjgyOEEuNzQ5Ljc0OSAwIDAgMSA4IDkuNTkzYS43NS43NSAwIDAgMSAuNDM4IDEuMzZ6bTIuMzc2LTMuNzAzSDUuMTg2di0zLjVjMC0uNDgzLjM5My0uODc1Ljg3NS0uODc1aDMuODc1Yy40ODMgMCAuODc2LjM5Mi44NzYuODc1djMuNXoiIGZpbGw9IiM3RDdEN0QiLz48L2c+PC9zdmc+","lock-new-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0NDRFNjAiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0zYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDV2MyIgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+","lock-new":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0NDRFNjAiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0zYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDV2MyIgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+","lock-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZmlsbD0iIzAwMCIgb3BhY2l0eT0iLjAxIiBkPSJNMCAwaDE2djE2SDB6Ii8+PHBhdGggZD0iTTEzIDcuMjVoLTEuMDYzdi0zLjVhMiAyIDAgMCAwLTItMkg2LjA2M2EyIDIgMCAwIDAtMiAydjMuNUgzYS41LjUgMCAwIDAtLjUuNXY2YS41LjUgMCAwIDAgLjUuNWgxMGEuNS41IDAgMCAwIC41LS41di02YS41LjUgMCAwIDAtLjUtLjV6bS00LjU2MyAzLjcwM3YuODI4YS4xMjUuMTI1IDAgMCAxLS4xMjQuMTI1aC0uNjI2YS4xMjUuMTI1IDAgMCAxLS4xMjUtLjEyNXYtLjgyOEEuNzQ5Ljc0OSAwIDAgMSA4IDkuNTkzYS43NS43NSAwIDAgMSAuNDM4IDEuMzZ6bTIuMzc2LTMuNzAzSDUuMTg2di0zLjVjMC0uNDgzLjM5My0uODc1Ljg3NS0uODc1aDMuODc1Yy40ODMgMCAuODc2LjM5Mi44NzYuODc1djMuNXoiIGZpbGw9IiM1QjkwOEUiLz48L2c+PC9zdmc+",lock:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggb3BhY2l0eT0iLjAxIiBkPSJNMCAwaDE2djE2SDB6Ii8+PHBhdGggZD0iTTEzIDcuMjVoLTEuMDYzdi0zLjVhMiAyIDAgMCAwLTItMkg2LjA2M2EyIDIgMCAwIDAtMiAydjMuNUgzYS41LjUgMCAwIDAtLjUuNXY2YS41LjUgMCAwIDAgLjUuNWgxMGEuNS41IDAgMCAwIC41LS41di02YS41LjUgMCAwIDAtLjUtLjV6bS00LjU2MyAzLjcwM3YuODI4YS4xMjUuMTI1IDAgMCAxLS4xMjQuMTI1aC0uNjI2YS4xMjUuMTI1IDAgMCAxLS4xMjUtLjEyNXYtLjgyOEEuNzQ5Ljc0OSAwIDAgMSA4IDkuNTkzYS43NS43NSAwIDAgMSAuNDM4IDEuMzZ6bTIuMzc2LTMuNzAzSDUuMTg2di0zLjVjMC0uNDgzLjM5My0uODc1Ljg3NS0uODc1aDMuODc1Yy40ODMgMCAuODc2LjM5Mi44NzYuODc1djMuNXoiLz48L3N2Zz4=","pencil-cursor":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJ2SURBVHgB7ZXPqxJRFMfvjI4F+cqkTcrjge9B+B+0LJQ27lq4ijZprly6DaF1COKPjYRrVy0CF/aof6Baa6ChOPkLFcdMm1+dM93RafzxZuptgnfgC3ecO+dzz497JOTKNsZMp9OAoihvZFku4xp/I5dsbL/fP221Wl/D4bCKwnWn0znDd+SSDE/N6ZBgMKjJBNuKzC4dHTgQ5PF4bququn7R7XZJPB4/kSTpHcBOiQlmJ6cMpCvAcdz5ZDJhF4tF1u12v4jFYkc8z683+f1+Uq1W38K+x/AogVQ7ETF4SnB+Ho1GTxKJxDFC2u32q1KpJPh8vvVGjHK5XM4xahv+tYgRcranJrNarfay2WwKoVBIRTUajW42m70P390EOYmFrOEGdhfECEMIwur1Og+p5VOp1CP47piCOB3EXBBJAIuLRcZi7zKsSaVSEbxe70N4FEEL0AyE6VuBZEJD2wmyAkHDmoxGIwGW36ljBP2gUEXf5/wXCDZBsVjky+XyUwpCyBL0k0ai7gNp3WUVUigUvgHoWSaTaRoi2YJojk1r52q1eh2JRJ5YgUB3Pc/n83WyXRPV/A1rWrtgSAZsQL6Q3ynTI1F2QdCMqXNQEGsDMqMgrMt6ChwCaXcGYdBFjA3InELkQxBCtkcEI4riHyPFCMnlcnEKMbYzQhRi0TCKa6A76XT6wWAweD8ejz8Oh8PPcEc+9Xq9D8lkMgLv74Hugo5ALmJzlumG4+IG6BZ1dJ06wtPqN14gmza2FYljD1SljrCTsAaYpjnZFP7CmpADEel/ai4qffLiqSUKFSlEP8xfgYwwlmzyr1KYHoUtgBU4Y9D/Y78AxCeE/aWoyrkAAAAASUVORK5CYII=","pencil-cursor@2x":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAYISURBVHgB7ZpNSCtXFIBPEuvz+dMGpYUKD/sWFX+Qti6kK7Hqpm6e9q0rIoIUFUShPLV10VZx4+JZqa9v20LBhdq9fyBUCtKNPH8qYl2IOw3G38Rkek4y15y5uTOZJDOWggcOSSYzN/ebc+45554JwIM8iBCPyTEP+86T4vyMfsRN4b+nQTKIJp0vzuGvlpID7os8EQNEIBD4oKio6Bm9DwaDv/v9/n/076JgbtWUYPchwrW8qD7UnOvr6wFNkpubm+/wu7f0c7y6mrnlvQufxB0Iau7V1dX3BDA/P6/V1dVpzc3N2uLiIofK1c8VYHys/wRKBUN3/hGHqaysNOjc3FwMis6hc0FtLTHuvYLxCCZgci8uLn4wg5Gh6Fy8Jk+/NkcCAlAAuUkoW4g0B+d5tLS05O/r67O8eGxsDNra2uDy8nKsoKCAwCIQDxQa0yTxgrvCYXyTk5Ml+Orf2dlJeeHIyAigFSE/P38ELfUNqNdSkjgF5FF89jL1TU1NlQwODl5gZPujp6cHWltbUw7Koc7Pz8mkZpHPFeFrJuZeqLnoMoPoZqe0JjDP/IZgnyLUG/o8NDRkuo5Ua2pjY6MC4oFCFf1cA0oKzRSOp6enRfTaGh0d/QxBt+1CUVgnOTs7+xrHfQzGyOcKkK3QTJMnQffZ6e/v/xwttmsHqqmpKXbdycnJCxy7ABLh3FEgVZ6hZJhnFZoFFMF0d3c/w7v+dyookXBnZ2c/xvHfhriVcvXfdBRItsxjnOhYqjwjoAimq6vrCysoGofk+Ph4Esd/F/UdiFtJAGUd2DygTpp5dmBUUJ2dnc9VUALm8PDwJY7/BPU9VD8k3M4RC6kskxZMKigKIMLN9vf3p3H8DyWgfEhEOwOQD9IXOTz7EObbwsLC4YWFBRgeHrY9ECXYo6MjaGlpKWlsbPxkYGDgRW1tbSEWquVlZWXBzc3Nl1VVVa8hXiXc6ioqBqGaPDk7AACJTRZ3NS9lcUp86cJwoSQ7Pj4Op6enfxUXF3/V0NCQv7q6GsCvwrqGUG/01xAD4+VQTOxaSF43d5bBOisrGBJRCtXX17+/trb268rKSgASFgmz97KFkmo6OztWuVyPweiWGc4WRkhFRQVEIpHg8vJyQAIQVlLBROVxvBYQHsXnO8tk62ZcyN0wecLBwcEvYHSzEPscBqOLCRhLC4n9uqaA8UAWAcAKhtbQ3t7eTHl5+Y9gtAp3twhT056CDMQ7MRzIFTeTYKb1yYYVQFH9VdzsqNmYKpfTJBDX3Ixgdnd3XyHMT2AMALJlBBSPaMpNngrIsTyTCgaj288YDGakictrxizvKFNOjgSSBLS+vv6UYHDb7DgMVgsChjTEgCIKGG4ZU+EWkgNBzN1qamq+pAMTExPgFMzW1tZrhHkFyWE5KxgSszx0527RaDRmOSpRshEOU11dPQPG8CwHARHJlMnTSrwSRFIlfXt7m3V5ngJGuJtqzaQtZkFBVNJezN5ZAdmwjKo2k9tVtrcI3OXk4tPgcg7ChCDZ1URgMOu72Xa5VFHOkymQhWVU60YVmjN6wiC7k6p+S1syCACOwJBYFaexV+yhBekNPsMBO6KAEeE4BMaCU67RsoYhSbXgaT//ht709vZCaWmp6YkEbLFmVJWzas04+iBL7EKpm0J7duqu0B7+CTUpNJuyvb1NCfMj1CqI9wLKUOlOUMeG+gGFkHii4HizUF4z/KFUrPsJ8WbEIyx7nnZ0dDynME6BAuce09iFHo+GrnmGltltb2//E4wVAN82y7vOjKOZXSBhJdHNiT3TYWD8OY2PTUJkdd7MkJMnT5wZVQF2RFX6yBMUdzPMvvfqxz3sXHF+GNT9ANXit/10O1sgHkZvdQAOKvs9B5L7ARELGAAXLSTvM8QExTE+YbHe+HURhZp1aRyF4CJXClbbWwGketgkW9VsY+YaiBCVhfgE+XvxRwgZSM4jUVCDZFQ9pytmXR8hUTB2gnidx4XffVWydN0yQjwmx/jkAZJBrIBI5J7ZvQGZWUgVSuU/EqmOAzicKNMVu816DdRWUV1/7xAP8n+SfwF3Du3NF2sYhwAAAABJRU5ErkJggg==","pencil-eraser-1":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMjYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3QgeD0iLjUiIHk9Ii41IiB3aWR0aD0iMTciIGhlaWdodD0iMjUiIHJ4PSIzLjUiIGZpbGw9IiMwMDAiIGZpbGwtb3BhY2l0eT0iLjM1IiBzdHJva2U9IiNmZmYiLz48L3N2Zz4=","pencil-eraser-2":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjYiIGhlaWdodD0iMzQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3QgeD0iLjUiIHk9Ii41IiB3aWR0aD0iMjUiIGhlaWdodD0iMzMiIHJ4PSIzLjUiIGZpbGw9IiMwMDAiIGZpbGwtb3BhY2l0eT0iLjM1IiBzdHJva2U9IiNmZmYiLz48L3N2Zz4=","pencil-eraser-3":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzQiIGhlaWdodD0iNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3QgeD0iLjUiIHk9Ii41IiB3aWR0aD0iMzMiIGhlaWdodD0iNDkiIHJ4PSIzLjUiIGZpbGw9IiMwMDAiIGZpbGwtb3BhY2l0eT0iLjM1IiBzdHJva2U9IiNmZmYiLz48L3N2Zz4=",rotate:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTEzIDZhNiA2IDAgMSAxLTMuNzA5IDEuMjgzIi8+PHBhdGggZD0ibTEzIDYgMS40MTQgMi40NUwxMyA2bDIuNDUtMS40MTQiLz48L2c+PC9zdmc+","rotation-button":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iI0ZGRiIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBvcGFjaXR5PSIuMDEiIGQ9Ik0wIDI0VjBoMjR2MjR6Ii8+PHBhdGggZD0iTTUuNzI0IDUuNzI0QTguODQ3IDguODQ3IDAgMCAxIDEyIDMuMTI1YzIuMjcxIDAgNC41NDMuODY2IDYuMjc2IDIuNmE4Ljg0NiA4Ljg0NiAwIDAgMSAyLjU5OCA2LjE0IDguODQ5IDguODQ5IDAgMCAxLTIuNTU5IDYuMzdsLTEuNS0uOTgzQTcuMTA1IDcuMTA1IDAgMCAwIDE5LjEyNSAxMmE3LjEwMyA3LjEwMyAwIDAgMC0yLjA4Ny01LjAzOEE3LjEwMyA3LjEwMyAwIDAgMCAxMiA0Ljg3NWE3LjEwMyA3LjEwMyAwIDAgMC01LjAzOCAyLjA4NyA3LjEwMSA3LjEwMSAwIDAgMC0yLjA4NiA0LjkyIDcuMTAzIDcuMTAzIDAgMCAwIDEuNzY2IDQuODE1bDEuOTQ1LTEuNTg0IDIuMzk0IDcuMTgyLTcuMjIyLTIuNDA4IDEuNzkxLTEuNzlBOC44NDYgOC44NDYgMCAwIDEgMy4xMjUgMTJjMC0yLjI3MS44NjYtNC41NDMgMi42LTYuMjc2eiIgc3Ryb2tlPSIjRkZGIiBzdHJva2Utd2lkdGg9Ii41IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48L2c+PC9zdmc+",rotation:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBmaWxsPSIjRkZGIiBvcGFjaXR5PSIuMDEiIGQ9Ik0wIDI0VjBoMjR2MjR6Ii8+PHBhdGggZD0iTTUuNzI0IDUuNzI0QTguODQ3IDguODQ3IDAgMCAxIDEyIDMuMTI1YzIuMjcxIDAgNC41NDMuODY2IDYuMjc2IDIuNmE4Ljg0NiA4Ljg0NiAwIDAgMSAyLjU5OCA2LjE0IDguODQ5IDguODQ5IDAgMCAxLTIuNTU5IDYuMzdsLTEuNS0uOTgzQTcuMTA1IDcuMTA1IDAgMCAwIDE5LjEyNSAxMmE3LjEwMyA3LjEwMyAwIDAgMC0yLjA4Ny01LjAzOEE3LjEwMyA3LjEwMyAwIDAgMCAxMiA0Ljg3NWE3LjEwMyA3LjEwMyAwIDAgMC01LjAzOCAyLjA4NyA3LjEwMSA3LjEwMSAwIDAgMC0yLjA4NiA0LjkyIDcuMTAzIDcuMTAzIDAgMCAwIDEuNzY2IDQuODE1bDEuOTQ1LTEuNTg0IDIuMzk0IDcuMTgyLTcuMjIyLTIuNDA4IDEuNzkxLTEuNzlBOC44NDYgOC44NDYgMCAwIDEgMy4xMjUgMTJjMC0yLjI3MS44NjYtNC41NDMgMi42LTYuMjc2eiIgc3Ryb2tlPSIjRkZGIiBzdHJva2Utd2lkdGg9Ii41IiBmaWxsPSIjMDAwIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48L2c+PC9zdmc+","selector-cursor":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAKeSURBVHgB3VTLi1JhFD86zlQ4ysxSXAy1GWYZzMxmYAhHagRB/QN8FLqPFq4FIQhXkS6kTQ4t2ilIKEWgSS0SmVpIm0BdaBJSaOP78XU+PXey6+saburAD+73uL/feX0H4H81GQdj7D7ilrCGFRonk3c6nXvhcJiFQiGWy+Xy/X7/WbPZ1K1KkBOsl0qlO36/n+3t7Q1hs9kYF+WC3W73MTpxc1lBmej7KuJaoVDInZ6eqsWXDw4OwGKxwPHx8Se1Wn1Wr9cjW1tbOTxi9D9bJCJHXEFslsvlR263+246nYZZptPpQK/Xg8lkSvZ6vbNGo5EgQRCLiSPhIqpoNHobo3keCARgkalUKjg5ORlGuL+/n8T6PVAqlefjYmKRdYQSsZ3P5z8aDAYVLGFarRbi8fhbhUKhx2VPEJGP3eEbfTrs4MUwr4EU49FYrVbweDy1SqXyipy95FaI7g8QXS6SyWReHx4e2ubVBc+HtTk6OjqvVqtvvF7vi0gkUiSByyyJ21BGwpswJ2Vmsxlw/0Kj0bxMJBJJl8vFPWkhGogLQoeyMhEJo2jGUzYRjcPh+Op0Oq2pVOoHkXE0SahF/w+E+3KYNEaX2pSyiSiKxeJTFPiGyyriO6FKEUgSESLp4ht4bzQaf4pFYrHYO/ysEXGNyJtjKRqM/zNNhFuf0B7vst3dXdjZ2Yn4fL4vRFwn8jaMGqYPU179LBEGf3bZcNNutwPOtScwKnCLPJ9KLMWEh7mNuIFdVsNXzbBNP+D6Ou1vwAqm8hqMWlmbzWYf4mz6HAwGzbjWwGgqrEklmucJT+UGCfG3wiPjueeNwGvB0zkAid7OMmF8CyOck/I6NJcR4KZYcM6J2vCbUGhvyQIA0gonzCEZkQud9Fcd9W/bL57cJu3lkjuNAAAAAElFTkSuQmCC","selector-cursor@2x":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAAxCAYAAABznEEcAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAZoSURBVHgB7VlLSCRXFL3ljNEhEXTGhMQJmOjCz8ZNVLKICz9xIYhCNi7UgINkGEk2En8hW5cBUQNxo05GAoKikuCAmvGzGMdPcCUGjDPxD/4Vv/3JvWW97luvq7ur+hMZ8MKlqrteNfe8e965970GuLVbC5kpJr53+hjHx9yY3TUxJgLMAQG4ITARfp5T4Mri4uL9q6urnxwOxz/oY5eXl1/Pzs7e195X2FX4jZsIhAK7gx5ps9m6nGj9/f3OtbU1pzAE0318fPwVjYHrrN7R3AjU/wpOBwA9Cmf/9ejoqDMtLU31iooKGdA+ATo4OMiXAEWAHhBAGEApXj4rPAik0vPt7e0vCgoKPH4gMzMTSktLIS8vD2JiYgABvcHMTZyennbHxsaOg3udOJmLzwqEYB0ZgRCZENm4u7e39yQuLq65srISZmZmvP5Ybm4u5OfnQ0lJyXWUCAgzNLS+vt6SnJz8WgvYwV5xSlcRgyVg3ha2Dkxzc3MvfZmVlQW+bGxsDBobGyE7O1u94uJPjIqKqklKSvrbbrfPnp+ff7e8vJwMnlSTKWfJjDKhywJo6wLp0YcZ+dyIUr7s4cOHLsrRlQwBTSBFuzc2NiZYhjjVAIyzZBqEwgCQv0OOM/gNzuiP/ijlDxBRjgClpqa6AF1cXDydmpoaLCws3JcAGYHyC4JMzoKaibKysvienp6FtrY2IA/WCFB5ebkqCHSvARo8Ozt7igIxwIJ2gJ+seFMnDoIyEUV+dHT0G3qWVUr5M043DdAB0m2IKZwAYpgZX+qkywR6NFbuR0iDxmAoZRUQKRxSLTMnJ8eIaqqSeVMnIYUOdu+sq6vrp4f+VCoYo8khZaNs01VRlERUu2/BrWAA7sl2Anink1Ao18JGjyY/PDx8hq1GZqgp5c2mp6chMjLy2b179x7hRzvoqeUUwXIzqq4O5nZsNUaEbIbLqPLTou/s7FTvT05OpsA9sXJG1AVsZDwjutqBIN6gUlWjxod8XRBNKXgsrqpqYZfwEqX9h8TExD7wbFm8LmzxHQ0QHSlXKZVSqFC/hkqlaKapTaGgCQTK7PHW1lb/wsLC86KiokkccoV+qV1tcE0pO7AWxmhTxBszDzqRr66ujqanp2cRpQLNBgUsCh8BwQ54bn5+/s+mpqa+4eHhfS1gb52vwuP0trPjhSZCBtLQ0NA3MDDQQIFYAUHBYhuvzjpVbJr1lZWVP3p7e19UVVXNgHumXYrI4uBx6Yqevz02b0FcRQ8CoBQF3dXVpQLZ3d39C7n+ora29vfJyclDYFnWgFyxK3cxhss/+KoT/N6DVkQpKypFGUCp3Ozo6HgSHx//GLW/BwHsg57zl5pzADajwLn52mPL1ZHPloMoRYPMFL6EhAR18e7s7MxVV1fPsAAp4Avteq7dC/c1+wKI4g+EfGzDM+EYHBw8RDrNiA2QL6upqVGvKJ2/gHu2L1nA5wwEB2YDfSYMO1x/px0cgEc2zBY+eo67u6H29vZ/wU2VC8l58JxKNjDOgojNEp08aFVfX++3l6JMEdDx8fEB0FNIBsDXBc8ArwuW1EkeI1RKdLWmCx+1DhkZGRvR0dFfSsHKxYtnW0iqvJAN9xNm6MR/QO5sfapUSkqKmqW5ubmfwVgyZdpw/vPZl2kUEAinBMSUStG+gwra0NDQSynQKyloIxnlewafjDFLJzLRBJqiFMnqyMgIbG5uDuD996Dnv8iAPOMAPmbcm5lVJwA/vZRMKZGZlpaWVtAvUL4GZMqE1fjRJrUd76LHoX+InlhcXPwZnWW2tra6jjrpiBM3UK/weQr6J+gfodMh9HtwncG7YLA3CMSsLmxx5WuDCt8B7vZeicInTjCWlpb6wc15mfey7oc9E8LElpVmMgb9AXoC+qcTExOPKRu4NlTHs6Q10GfhgfYOvRsJQZ76BWMKuDtaolQs+gfoH6Mn436gDg+e+5BKXUQx/C5Je/a+NpbeiQJPKgUdlNXx/BCBKxVdxW5Q0I3XBqFKRhU4KLtjYawi3csuTKdc4FnIXNvKUJkVEGRG20QZAAUpA5DbaYAQLmQzfzxyk/ffdnCD4NWVnGdE7kQBQvQHC5lVEDxgMaM29lkxGCNLKrDnIbFAMkFmBIaDkHstU41coGZ1TZD5UjReCGUAYbNgdNqoXZB/T67yYbFAMiGML3BhYeH8rb0t9h/zgcTBcTNGiQAAAABJRU5ErkJggg==","to-bottom-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDEwdjhtMCAwLTItMm0yIDIgMi0ybS00IDZoMTJtLTYtNGg2bS02LTRoNm0tNi00aDYiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","to-bottom":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDEwdjhtMCAwLTItMm0yIDIgMi0ybS00IDZoMTJtLTYtNGg2bS02LTRoNm0tNi00aDYiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","to-top":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDIydi04bTAgMC0yIDJtMi0yIDIgMm0tNC02aDEybS02IDRoNm0tNiA0aDZtLTYgNGg2IiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","underline-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDJ2NWE0IDQgMCAxIDEtOCAwVjJoME0zIDE0aDEwIiBzdHJva2U9IiMzMzgxRkYiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==",underline:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDJ2NWE0IDQgMCAxIDEtOCAwVjJoME0zIDE0aDEwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","unlock-new":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiMzMzgxRkYiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjMzM4MUZGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0xYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDN2MyIgc3Ryb2tlPSIjMzM4MUZGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+",unlock:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0NDRFNjAiIGN4PSI4IiBjeT0iOSIgcj0iMSIvPjxyZWN0IHN0cm9rZT0iIzQ0NEU2MCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiB4PSIzIiB5PSI2IiB3aWR0aD0iMTAiIGhlaWdodD0iOCIgcng9IjIiLz48cGF0aCBkPSJtNS4yMDQgNC40NDcuMjYtLjk2NmEzIDMgMCAxIDEgNS43OTUgMS41NTNMMTEgNmgwTTggOXYzIiBzdHJva2U9IiM0NDRFNjAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvZz48L3N2Zz4="};var XT=q["eraser-cursor"],GS=Object.freeze({x:8,y:18}),$S=Object.freeze({width:26,height:26}),YS=36,XS=1,nc=/*#__PURE__*/function(){function nc(t){var _this274=this;_classCallCheck(this,nc);this.cursors=Object.freeze([]);var i=new Image;i.onload=function(){var r=[];for(var n=0;n<XS;++n){r[n]=null}for(var _n45=XS;_n45<=YS;++_n45){r[_n45]=_this274.createCursor(_n45,i)}_this274.cursors=Object.freeze(r)},i.onerror=function(r){t.error(r)},i.src=XT}_createClass(nc,[{key:"cursorStyle",value:function cursorStyle(t){var i=this.cursors[Math.min(Math.ceil(t),YS)];if(i)return"url(".concat(i.url,") ").concat(i.centerX," ").concat(i.centerY,", auto")}},{key:"release",value:function release(){var _iterator248=_createForOfIteratorHelper(this.cursors),_step248;try{for(_iterator248.s();!(_step248=_iterator248.n()).done;){var t=_step248.value;t&&URL.revokeObjectURL(t.url)}}catch(err){_iterator248.e(err)}finally{_iterator248.f()}this.cursors=Object.freeze([])}},{key:"createCursor",value:function createCursor(t,i){var r=-t,n=-t,s=-GS.x,o=-GS.y,a=Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER,d=Number.MIN_SAFE_INTEGER;a=Math.min(a,r),a=Math.min(a,s),l=Math.min(l,n),l=Math.min(l,o),h=Math.max(h,r)+2*t,h=Math.max(h,s)+2*$S.width,d=Math.max(l,n)+2*t,d=Math.max(l,o)+2*$S.height;var u=-a,p=-l,f=h-a,m=d-l;s+=u,o+=p;var g=document.createElement("canvas"),y=g.getContext("2d");return g.width=f,g.height=m,y.fillStyle="rgba(216,216,216,146)",y.beginPath(),y.ellipse(u,p,t,t,0,0,2*Math.PI),y.fill(),y.drawImage(i,s,o),Object.freeze({centerX:u,centerY:p,url:g.toDataURL("mycanvas")})}}]);return nc}();var QT=20,pp=/*#__PURE__*/function(){function pp(t){_classCallCheck(this,pp);this.stackMap=new Map;this.stackIndexMap=new Map;this.currentScenePath="/";this.index=0;this.textareaExtraStep=0;this.execute=t.execute,this.onCanUndoStepsUpdate=t.onCanUndoStepsUpdate,this.onCanRedoStepsUpdate=t.onCanRedoStepsUpdate}_createClass(pp,[{key:"canUndoSteps",get:function get(){return this.stack.length-this.index+this.textareaExtraStep}},{key:"canRedoSteps",get:function get(){return this.index}},{key:"stack",get:function get(){var t=this.stackMap.get(this.currentScenePath);return t||(t=[],this.stackMap.set(this.currentScenePath,t)),t}},{key:"commit",value:function commit(t){var i=this.stack,r=this.canUndoSteps,n=this.canRedoSteps;for(i.splice(0,this.index,At(t)),this.index=0;i.length>QT;){i.pop()}var s=this.canUndoSteps,o=this.canRedoSteps;s!==r&&this.onCanUndoStepsUpdate(s),o!==n&&this.onCanRedoStepsUpdate(o)}},{key:"undo",value:function undo(t,i){var r=this.stack[this.index];r&&(this.index+=1,this.textareaExtraStep=0,this.execute(this.replacePath(r.undo,t),i),this.onCanUndoStepsUpdate(this.canUndoSteps),this.onCanRedoStepsUpdate(this.canRedoSteps),this.stackIndexMap.set(this.currentScenePath,this.index))}},{key:"redo",value:function redo(t,i){this.index>0&&(this.index-=1,this.textareaExtraStep=0,this.execute(this.replacePath(this.stack[this.index].redo,t),i),this.onCanUndoStepsUpdate(this.canUndoSteps),this.onCanRedoStepsUpdate(this.canRedoSteps),this.stackIndexMap.set(this.currentScenePath,this.index))}},{key:"onTextareaUpdate",value:function onTextareaUpdate(t){this.textareaExtraStep=t?1:0,this.onCanUndoStepsUpdate(this.canUndoSteps)}},{key:"replacePath",value:function replacePath(t,i){var r=t;if(i){var n=te.parse(i);r=At(r);for(var s in r){var o=r[s];o.path!==void 0&&(o.path=n)}}return r}}]);return pp}();var mp=/*#__PURE__*/function(){function mp(t){_classCallCheck(this,mp);this.map={};this.savingQueue=[];this.hangQueue=[];this._count=0;this.maxCount=t.maxSavingCount+t.keepCountAfterRelease,this.keepCountAfterRelease=t.keepCountAfterRelease,this.onRelease=t.onRelease}_createClass(mp,[{key:"count",get:function get(){return this._count}},{key:"getValue",value:function getValue(t){var i=this.map[t];if(i)return this.pushToTail(this.savingQueue,t),this.pushToTail(this.hangQueue,t),i}},{key:"save",value:function save(t,i){this._count>=this.maxCount&&this.removeOne(),this._count+=1,this.map[t]=i,this.savingQueue.push({key:t,target:i})}},{key:"release",value:function release(t){var i=this.map[t];if(i){var _r171=this.savingQueue.findIndex(function(n){return n.key===t});_r171!==-1&&(this.savingQueue.splice(_r171,1),this.hangTarget(t,i))}}},{key:"removeOne",value:function removeOne(){if(this.hangQueue.length>0){var _this$hangQueue$shift=this.hangQueue.shift(),t=_this$hangQueue$shift.key;this.finalReleaseTarget(t)}else{var _this$savingQueue$shi=this.savingQueue.shift(),_t17=_this$savingQueue$shi.key;this.finalReleaseTarget(_t17)}}},{key:"hangTarget",value:function hangTarget(t,i){if(this.keepCountAfterRelease>0){if(this.hangQueue.length>=this.keepCountAfterRelease){var _this$hangQueue$shift2=this.hangQueue.shift(),_r172=_this$hangQueue$shift2.key;this.finalReleaseTarget(_r172)}this.hangQueue.push({key:t,target:i})}else this.finalReleaseTarget(t)}},{key:"finalReleaseTarget",value:function finalReleaseTarget(t){var r;var i=this.map[t];delete this.map[t],this._count-=1,(r=this.onRelease)==null||r.call(this,i)}},{key:"pushToTail",value:function pushToTail(t,i){var r=t.findIndex(function(n){return n.key===i});if(r!==-1&&r!==t.length-1){var _t$splice3=t.splice(r,1),_t$splice4=_slicedToArray(_t$splice3,1),n=_t$splice4[0];t.push(n)}}}]);return mp}();var sc=/*#__PURE__*/function(){function sc(t,i){var _this275=this;_classCallCheck(this,sc);this.getNode=function(t){var i=_this275.nodes.getValue(t);return i||(i=_this275.createNode(t),_this275.nodes.save(t,i)),i};this.releaseNode=function(t){t.refsCount<=0&&_this275.nodes.release(t.identifier)};this.execute=i,this.nodes=new mp({maxSavingCount:4,keepCountAfterRelease:Math.max(0,t),onRelease:function onRelease(r){for(var _i53=0,_arr4=_toConsumableArray(r.watcherDisposers);_i53<_arr4.length;_i53++){var n=_arr4[_i53];n()}}})}_createClass(sc,[{key:"createWatcher",value:function createWatcher(t,i){return new Rs(this.getNode(t),this.getNode,this.releaseNode,i)}},{key:"createNode",value:function createNode(t){var i=[],r=[],n=new pp({execute:this.execute,onCanRedoStepsUpdate:function onCanRedoStepsUpdate(s){var _iterator249=_createForOfIteratorHelper(i),_step249;try{for(_iterator249.s();!(_step249=_iterator249.n()).done;){var o=_step249.value;o(s)}}catch(err){_iterator249.e(err)}finally{_iterator249.f()}},onCanUndoStepsUpdate:function onCanUndoStepsUpdate(s){var _iterator250=_createForOfIteratorHelper(r),_step250;try{for(_iterator250.s();!(_step250=_iterator250.n()).done;){var o=_step250.value;o(s)}}catch(err){_iterator250.e(err)}finally{_iterator250.f()}}});return{identifier:t,stack:n,redoUpdaters:i,undoUpdaters:r,watcherDisposers:[],refsCount:0}}}]);return sc}();sc.watchMaxCount=15;var Rs=/*#__PURE__*/function(_Qe2){_inherits(Rs,_Qe2);var _super88=_createSuper(Rs);function Rs(t,i,r,n){var _this276;_classCallCheck(this,Rs);_this276=_super88.call(this,n);_this276.didStop=!1;_this276.stop=function(){_this276.didStop||(_this276.didStop=!0,_this276.unlink())};_this276.onCanUndoStepsUpdate=function(t){_this276.dispatch("onCanUndoStepsUpdate",function(i){return i(t)})};_this276.onCanRedoStepsUpdate=function(t){_this276.dispatch("onCanRedoStepsUpdate",function(i){return i(t)})};_this276.link(t),_this276.getNode=i,_this276.releaseNode=r;return _this276}_createClass(Rs,[{key:"watch",value:function watch(t){if(this.didStop)throw new Error("watcher did stop");if(this.identifier!==t){var i=this.canRedoSteps,_r173=this.canUndoSteps;this.unlink(),this.link(this.getNode(t));var n=this.canRedoSteps,s=this.canUndoSteps;i!==n&&this.dispatch("onCanRedoStepsUpdate",function(o){return o(n)}),_r173!==s&&this.dispatch("onCanUndoStepsUpdate",function(o){return o(s)})}}},{key:"identifier",get:function get(){return this.node.identifier}},{key:"canRedoSteps",get:function get(){return this.node.stack.canRedoSteps}},{key:"canUndoSteps",get:function get(){return this.node.stack.canUndoSteps}},{key:"stack",get:function get(){return this.node.stack}},{key:"link",value:function link(t){this.node=t,t.refsCount+=1,t.watcherDisposers.push(this.stop),t.undoUpdaters.push(this.onCanUndoStepsUpdate),t.redoUpdaters.push(this.onCanRedoStepsUpdate)}},{key:"unlink",value:function unlink(){Rs.arrayRemove(this.node.watcherDisposers,this.stop),Rs.arrayRemove(this.node.undoUpdaters,this.onCanUndoStepsUpdate),Rs.arrayRemove(this.node.redoUpdaters,this.onCanRedoStepsUpdate),this.node.refsCount-=1,this.releaseNode(this.node)}}],[{key:"arrayRemove",value:function arrayRemove(t,i){var r=t.indexOf(i);return r!==-1?(t.splice(r,1),!0):!1}}]);return Rs}(Qe);var Yr=/*#__PURE__*/function(){function Yr(){_classCallCheck(this,Yr);this.creators={};this.waitingTouchCount=0}_createClass(Yr,[{key:"reportState",value:function reportState(t,i,r){var s;var n=Yr.shadowRefs[t];if(n){var o=i&&!r,a=null;var _iterator251=_createForOfIteratorHelper(n),_step251;try{for(_iterator251.s();!(_step251=_iterator251.n()).done;){var l=_step251.value;l.isWaitingTouch!==o&&(o?(this.waitingTouchCount+=1,a=l.ref):this.waitingTouchCount-=1,l.isWaitingTouch=o)}}catch(err){_iterator251.e(err)}finally{_iterator251.f()}(s=this.onWaitingTouchRefChanged)==null||s.call(this,a,this.waitingTouchCount)}}},{key:"registerShadowRef",value:function registerShadowRef(t,i){var r=Yr.shadowRefs[t];r?r.findIndex(function(s){return s.ref===i})===-1&&r.push({ref:i,isWaitingTouch:!1}):Yr.shadowRefs[t]=[{ref:i,isWaitingTouch:!1}]}},{key:"unregisterShadowRef",value:function unregisterShadowRef(t,i){var r=Yr.shadowRefs[t];if(r){var n=r.findIndex(function(s){return s.ref===i});if(n!==-1){var _r$splice=r.splice(n,1),_r$splice2=_slicedToArray(_r$splice,1),s=_r$splice2[0];s.isWaitingTouch&&(this.waitingTouchCount-=1),r.length===0&&delete Yr.shadowRefs[t]}}}},{key:"addTextareaRectGetter",value:function addTextareaRectGetter(t,i){this.creators[t]=i}},{key:"removeTextareaRectGetter",value:function removeTextareaRectGetter(t){delete this.creators[t]}},{key:"getTextareaSizeMap",value:function getTextareaSizeMap(t){var i={};for(var _r174 in this.creators){var n=this.creators[_r174](t,!0);n&&(i[_r174]=n)}return i}},{key:"getTextareaRect",value:function getTextareaRect(t,i,r){var n=null,s=this.creators[t];return s&&(n=s(i,!1,r)),n}},{key:"forEachShadowRefs",value:function forEachShadowRefs(t,i){var r=Yr.shadowRefs[t];if(r){var _iterator252=_createForOfIteratorHelper(r),_step252;try{for(_iterator252.s();!(_step252=_iterator252.n()).done;){var n=_step252.value;i(n.ref)}}catch(err){_iterator252.e(err)}finally{_iterator252.f()}}}}]);return Yr}(),oc=Yr;oc.shadowRefs={};var Mn=P(require("mobx")),fp=/*#__PURE__*/function(){function fp(){var _this277=this;_classCallCheck(this,fp);this.mainView=null;this._cameraState={centerX:0,centerY:0,scale:1,width:0,height:0};this.onSizeUpdated=function(t){(t.width!==_this277._cameraState.width||t.height!==_this277._cameraState.height)&&(_this277._cameraState=Object.freeze(I(I({},_this277._cameraState),t)))};this.onCameraUpdated=function(t){(t.centerX!==_this277._cameraState.centerX||t.centerY!==_this277._cameraState.centerY||t.scale!==_this277._cameraState.scale)&&(_this277._cameraState=Object.freeze(I(I({},_this277._cameraState),t)))};(0,Mn.makeObservable)(this,{_cameraState:Mn.observable,onSizeUpdated:Mn.action,onCameraUpdated:Mn.action})}_createClass(fp,[{key:"cameraState",get:function get(){return this._cameraState}},{key:"setupMainView",value:function setupMainView(t){this.releaseMainView(),this.mainView=t,t.callbacks.on("onSizeUpdated",this.onSizeUpdated),t.callbacks.on("onCameraUpdated",this.onCameraUpdated)}},{key:"releaseMainView",value:function releaseMainView(){this.mainView&&(this.mainView.callbacks.off("onSizeUpdated",this.onSizeUpdated),this.mainView.callbacks.off("onCameraUpdated",this.onCameraUpdated),this.mainView=null)}},{key:"dispose",value:function dispose(){this.releaseMainView()}}]);return fp}();var Tn;(function(i){i.Dynamic="dynamic",i.Static="static"})(Tn||(Tn={}));var ac;(function(i){i.Waiting="Waiting",i.Converting="Converting"})(ac||(ac={}));var lc;(function(n){n.Extracting="Extracting",n.Packaging="Packaging",n.GeneratingPreview="GeneratingPreview",n.MediaTranscode="MediaTranscode"})(lc||(lc={}));function qS(e){return new Ko(e)}var Go=/*#__PURE__*/function(){function Go(t){_classCallCheck(this,Go);this.pptPromise=null;this.uuid=t.uuid,this.region=t.region||ae.defaultRegion,this.kind=t.kind,this.taskToken=t.taskToken,this.checkProgressInterval=t.checkProgressInterval||Go.defaultCheckProgressInterval,this.checkProgressTimeout=t.checkProgressTimeout||Go.defaultCheckProgressTimeout,this.callbacks=new Qe(t.callbacks)}_createClass(Go,[{key:"checkUtilGet",value:function checkUtilGet(){var _this278=this;return this.pptPromise?this.pptPromise:(this.pptPromise=this.getPPTResult(),this.pptPromise.then(function(t){_this278.callbacks.dispatch("onTaskSuccess",function(i){return i(t)})})["catch"](function(t){_this278.callbacks.dispatch("onTaskFail",function(i){return i(t)})}),this.pptPromise)}},{key:"getPPTResult",value:function(){var _getPPTResult=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee82(){var _this279=this;var t,i,_loop29,_ret3;return regeneratorRuntime.wrap(function _callee82$(_context85){while(1){switch(_context85.prev=_context85.next){case 0:t=!1,i=Date.now();_loop29=/*#__PURE__*/regeneratorRuntime.mark(function _loop29(){var r,n,s,o;return regeneratorRuntime.wrap(function _loop29$(_context84){while(1){switch(_context84.prev=_context84.next){case 0:r=Date.now();_context84.next=3;return _this279.fetchProgress(_this279.uuid,_this279.kind,_this279.taskToken);case 3:n=_context84.sent;_context84.t0=n.status;_context84.next=_context84.t0==="Waiting"?7:_context84.t0==="Converting"?7:_context84.t0==="Finished"?9:_context84.t0==="Fail"?10:11;break;case 7:_this279.updateProgress(n);return _context84.abrupt("break",11);case 9:return _context84.abrupt("return",{v:(t||_this279.updateProgress(n),_this279.toPPT(n))});case 10:throw new Error(n.failedReason);case 11:s=r+_this279.checkProgressInterval;if(!(s>=i+_this279.checkProgressTimeout)){_context84.next=14;break}throw new Error("timeout");case 14:n.progress.convertedPercentage===100&&(t=!0);o=s-Date.now();_context84.t1=o>0;if(!_context84.t1){_context84.next=20;break}_context84.next=20;return new Promise(function(a){return setTimeout(a,o)});case 20:case"end":return _context84.stop();}}},_loop29)});case 2:return _context85.delegateYield(_loop29(),"t0",3);case 3:_ret3=_context85.t0;if(!(_typeof(_ret3)==="object")){_context85.next=6;break}return _context85.abrupt("return",_ret3.v);case 6:_context85.next=2;break;case 8:case"end":return _context85.stop();}}},_callee82)}));function getPPTResult(){return _getPPTResult.apply(this,arguments)}return getPPTResult}()},{key:"updateProgress",value:function updateProgress(t){var i=Object.freeze({status:t.status,currentStep:t.progress.currentStep,totalPageSize:t.progress.totalPageSize,convertedPageSize:t.progress.convertedPageSize,convertedPercentage:t.progress.convertedPercentage});this.callbacks.dispatch("onProgressUpdated",function(r){return r(i)})}},{key:"toPPT",value:function toPPT(t){var i=t.progress.convertedFileList,r=[],n=0,s=0;for(var o=0;o<i.length;++o){var a=i[o],l={name:"".concat(o+1),ppt:{src:a.conversionFileUrl,previewURL:a.preview,width:a.width,height:a.height}};n=Math.max(n,a.width),s=Math.max(s,a.height),r.push(l)}return{uuid:this.uuid,kind:this.kind,width:n,height:s,scenes:r}}},{key:"fetchProgress",value:function(){var _fetchProgress=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee83(t,i,r){var n,s,o,a;return regeneratorRuntime.wrap(function _callee83$(_context86){while(1){switch(_context86.prev=_context86.next){case 0:n="http://ppt-api/v5/services/conversion/tasks/".concat(t);s=(0,QS.stringify)({type:i});_context86.next=4;return Go.apiFetch(n+"?"+s,{method:"get",headers:{"content-type":"application/json",token:r,region:this.region}});case 4:o=_context86.sent;if(!(o.status!==200)){_context86.next=10;break}_context86.next=8;return o.json();case 8:a=_context86.sent;throw new Error(a.error.title);case 10:_context86.next=12;return o.json();case 12:return _context86.abrupt("return",_context86.sent);case 13:case"end":return _context86.stop();}}},_callee83,this)}));function fetchProgress(_x148,_x149,_x150){return _fetchProgress.apply(this,arguments)}return fetchProgress}()}]);return Go}(),Ko=Go;Ko.apiFetch=ec.fetch("api"),Ko.defaultCheckProgressInterval=1500,Ko.defaultCheckProgressTimeout=5*60*1e3;var gp=P(require("query-string"));var pr=/*#__PURE__*/function(){function pr(t){_classCallCheck(this,pr);this.roomToken=t}_createClass(pr,[{key:"convert",value:function(){var _convert=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee84(t){var i,r;return regeneratorRuntime.wrap(function _callee84$(_context87){while(1){switch(_context87.prev=_context87.next){case 0:_context87.next=2;return this.createPPTTask(t);case 2:i=_context87.sent;_context87.next=5;return this.checkUtilHasResult(i,t);case 5:r=_context87.sent;return _context87.abrupt("return",pr.wrapPPTDescriptions(i,t.kind,r));case 7:case"end":return _context87.stop();}}},_callee84,this)}));function convert(_x151){return _convert.apply(this,arguments)}return convert}()},{key:"createPPTTask",value:function(){var _createPPTTask=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee85(t){var i,r,n,_yield$n$json,_yield$n$json$msg,s,o,a;return regeneratorRuntime.wrap(function _callee85$(_context88){while(1){switch(_context88.prev=_context88.next){case 0:i=pr.prefix+"/services/conversion/tasks";r=(0,gp.stringify)({roomToken:this.roomToken});_context88.next=4;return fetch(i+"?"+r,{method:"post",headers:{"content-type":"application/json",Accept:"application/json"},body:JSON.stringify({sourceUrl:t.url,serviceType:pr.convertPPTKindToServiceType(t.kind)})});case 4:n=_context88.sent;if(!(n.status!==200)){_context88.next=13;break}_context88.t0=Error;_context88.t1="failed to convert ".concat(JSON.stringify(t.url)," with status ").concat(n.status," message:");_context88.next=10;return n.text();case 10:_context88.t2=_context88.sent;_context88.t3=_context88.t1.concat.call(_context88.t1,_context88.t2);throw new _context88.t0(_context88.t3);case 13:_context88.next=15;return n.json();case 15:_yield$n$json=_context88.sent;_yield$n$json$msg=_yield$n$json.msg;s=_yield$n$json$msg.succeed;o=_yield$n$json$msg.reason;a=_yield$n$json$msg.taskUUID;if(s){_context88.next=22;break}throw new Error("create ppt task failed: "+o);case 22:return _context88.abrupt("return",a);case 23:case"end":return _context88.stop();}}},_callee85,this)}));function createPPTTask(_x152){return _createPPTTask.apply(this,arguments)}return createPPTTask}()},{key:"checkUtilHasResult",value:function(){var _checkUtilHasResult=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee86(t,i){var _this280=this;var r,n,s,o,_loop30,_ret4;return regeneratorRuntime.wrap(function _callee86$(_context90){while(1){switch(_context90.prev=_context90.next){case 0:r=!1,n=Date.now(),s=i.checkProgressInterval||pr.defaultCheckProgressInterval,o=i.checkProgressTimeout||pr.defaultCheckProgressTimeout;_loop30=/*#__PURE__*/regeneratorRuntime.mark(function _loop30(){var a,l,h,d,u,p,f;return regeneratorRuntime.wrap(function _loop30$(_context89){while(1){switch(_context89.prev=_context89.next){case 0:a=Date.now();_context89.next=3;return _this280.fetchProgress(t,i.kind);case 3:l=_context89.sent;_context89.t0=l.convertStatus;_context89.next=_context89.t0==="Finished"?7:_context89.t0==="Fail"?8:_context89.t0==="NotFound"?8:9;break;case 7:return _context89.abrupt("return",{v:(i.onProgressUpdated&&!r&&i.onProgressUpdated(1),l.convertedFileList.map(function(m){return{width:m.width,height:m.height,src:l.prefix+m.conversionFileUrl}}))});case 8:throw new Error("failed to convert ".concat(JSON.stringify(i.url),": ").concat(l.reason));case 9:h=l.totalPageSize,d=l.convertedPercentage,u=h===0?0:d/100,p=a+s;if(!(p>=n+o)){_context89.next=12;break}throw new Error("failed to convert ".concat(JSON.stringify(i.url),": timeout"));case 12:i.onProgressUpdated&&i.onProgressUpdated(u),u===1&&(r=!0);f=p-Date.now();_context89.t1=f>0;if(!_context89.t1){_context89.next=18;break}_context89.next=18;return new Promise(function(m){return setTimeout(m,f)});case 18:case"end":return _context89.stop();}}},_loop30)});case 2:return _context90.delegateYield(_loop30(),"t0",3);case 3:_ret4=_context90.t0;if(!(_typeof(_ret4)==="object")){_context90.next=6;break}return _context90.abrupt("return",_ret4.v);case 6:_context90.next=2;break;case 8:case"end":return _context90.stop();}}},_callee86)}));function checkUtilHasResult(_x153,_x154){return _checkUtilHasResult.apply(this,arguments)}return checkUtilHasResult}()},{key:"fetchProgress",value:function(){var _fetchProgress2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee87(t,i){var r,n,s;return regeneratorRuntime.wrap(function _callee87$(_context91){while(1){switch(_context91.prev=_context91.next){case 0:r="".concat(pr.prefix,"/services/conversion/tasks/").concat(t,"/progress");n=(0,gp.stringify)({roomToken:this.roomToken,serviceType:pr.convertPPTKindToServiceType(i)});_context91.next=4;return fetch(r+"?"+n,{headers:{"content-type":"application/json",Accept:"application/json"}});case 4:s=_context91.sent;if(!(s.status!==200)){_context91.next=7;break}throw new Error("failed to fetch progress of ".concat(JSON.stringify(r)));case 7:_context91.next=9;return s.json();case 9:return _context91.abrupt("return",_context91.sent.msg.task);case 10:case"end":return _context91.stop();}}},_callee87,this)}));function fetchProgress(_x155,_x156){return _fetchProgress2.apply(this,arguments)}return fetchProgress}()}],[{key:"wrapPPTDescriptions",value:function wrapPPTDescriptions(t,i,r){var n=[],s=[],o=0,a=0;for(var l=0;l<r.length;++l){var _r$l=r[l],h=_r$l.src,d=_r$l.width,u=_r$l.height;n[l]=h,s[l]={name:"".concat(l+1),ppt:{src:h,width:d,height:u}},o=d,a=u}return{uuid:t,kind:i,width:o,height:a,slideURLs:n,scenes:s}}},{key:"convertPPTKindToServiceType",value:function convertPPTKindToServiceType(t){switch(t){case Tn.Dynamic:return"dynamic_conversion";case Tn.Static:return"static_conversion";default:throw new Error("invalid kind ".concat(JSON.stringify(t)));}}}]);return pr}(),Ns=pr;Ns.prefix="https://console-api.netless.link",Ns.defaultCheckProgressInterval=1500,Ns.defaultCheckProgressTimeout=5*60*1e3;var oa=P(require("react"));var uc=P(require("react"));var rw=P(require("mobx"));var vt=P(require("react"));var Se=P(require("react"));function $e(e){return q[e]}var cc=P(require("react")),qe=/*#__PURE__*/function(_cc$Component){_inherits(qe,_cc$Component);var _super89=_createSuper(qe);function qe(t){var _this281;_classCallCheck(this,qe);_this281=_super89.call(this,t);_this281.didUnmount=!1;_this281.onMouseDown=function(t){var i=0;if(t.button===i){_this281.setState({isPressed:!0});var _r175=function _r175(n){n.button===i&&(document.body.removeEventListener("mouseup",_r175),_this281.didUnmount||_this281.setState({isPressed:!1}))};document.body.addEventListener("mouseup",_r175)}};_this281.state={isHover:!1,isPressed:!1};return _this281}_createClass(qe,[{key:"componentWillUnmount",value:function componentWillUnmount(){this.didUnmount=!0}},{key:"render",value:function render(){var _this282=this;var t=this.props.className;t!==void 0?t="button "+t:t="button",this.props.disable&&(t+=" disable");var i=this.props.refObject;return cc.createElement("div",{className:t,ref:i,onMouseEnter:function onMouseEnter(){return _this282.setState({isHover:!0})},onMouseLeave:function onMouseLeave(){return _this282.setState({isHover:!1})},onMouseDown:this.onMouseDown,onTouchEnd:this.props.onClick,onClick:this.props.onClick},this.props.children)}}]);return qe}(cc.Component);var Ls=P(require("react")),wi=/*#__PURE__*/function(_Ls$Component){_inherits(wi,_Ls$Component);var _super90=_createSuper(wi);function wi(t){var _this283;_classCallCheck(this,wi);_this283=_super90.call(this,t);_this283.divRef=Ls.createRef();_this283.onMouseDown=function(t){var i=_this283.divRef.current,r=t.target;if(i&&!wi.isEventFiredOnElement(r,i)){var n=_this283.props.onShouldBecomeHide;n(r)}};document.body.addEventListener("mousedown",_this283.onMouseDown);return _this283}_createClass(wi,[{key:"componentWillUnmount",value:function componentWillUnmount(){document.body.removeEventListener("mousedown",this.onMouseDown)}},{key:"render",value:function render(){var t=D(I({},this.props),{ref:this.divRef});delete t.onShouldBecomeHide;var i=t.children;return Ls.createElement("div",I({},t),i)}}],[{key:"isEventFiredOnElement",value:function isEventFiredOnElement(t,i){var r=t;for(;r;){if(r===i)return!0;r=r.parentElement}return!1}}]);return wi}(Ls.Component);function ZS(_ref106){var e=_ref106.viewMovingState,t=_ref106.delegate,i=_ref106.components;return{width:95,height:40,node:function node(s,o,a,l,h,d){var p=o+l/2<=d/2;return Se.createElement(_bt,{key:"font-size",delegate:t,viewMovingState:e,components:i,isMenuToDown:p})}}}function JS(e){var t=Math.floor(e);return e>=t+.5&&(t+=1),t}var _bt=/*#__PURE__*/function(_Se$Component){_inherits(bt,_Se$Component);var _super91=_createSuper(bt);function bt(t){var _this284;_classCallCheck(this,bt);_this284=_super91.call(this,t);_this284.inputRef=Se.createRef();_this284.upArrowButton=Object.freeze({iconName:"arrow-up",isUp:!0,ref:Se.createRef()});_this284.downArrowButton=Object.freeze({iconName:"arrow-down",isUp:!1,ref:Se.createRef()});_this284.onFocusInput=function(){var t=_this284.inputRef.current;t&&(t.type="text",t.setSelectionRange(0,t.value.length),t.type="number",_this284.setState({isFocusInput:!0}))};_this284.onShouldBecomeHide=function(t){var i=_this284.inputRef.current,r=_this284.upArrowButton.ref.current,n=_this284.downArrowButton.ref.current;i&&r&&n&&!wi.isEventFiredOnElement(t,r)&&!wi.isEventFiredOnElement(t,n)&&_this284.commitFontSizeWithString(i.value)};_this284.onPressKeyInput=function(t){t.key==="Enter"&&_this284.commitFontSizeWithString(t.target.value)};_this284.state={overrideFontSize:void 0,hoverIndex:void 0,isFocusInput:!1};return _this284}_createClass(bt,[{key:"onSelectFontSize",value:function onSelectFontSize(t){this.commitFontSizeWithInt(t),this.setState({overrideFontSize:void 0,hoverIndex:void 0,isFocusInput:!1})}},{key:"getFontSize",value:function getFontSize(){var t=this.props.components,i;var _iterator253=_createForOfIteratorHelper(t),_step253;try{for(_iterator253.s();!(_step253=_iterator253.n()).done;){var _r176=_step253.value;var n=_r176.currentScale,s=_r176.textSize,o=JS(n*s);if(i===void 0)i=o;else if(i!==o){i=void 0;break}}}catch(err){_iterator253.e(err)}finally{_iterator253.f()}return i}},{key:"shouldUpdateFontSize",value:function shouldUpdateFontSize(t){var i=this.props.components;var _iterator254=_createForOfIteratorHelper(i),_step254;try{for(_iterator254.s();!(_step254=_iterator254.n()).done;){var _r177=_step254.value;var n=_r177.currentScale,s=_r177.textSize;if(n*s!==t)return!0}}catch(err){_iterator254.e(err)}finally{_iterator254.f()}return!1}},{key:"commitFontSizeWithString",value:function commitFontSizeWithString(t){var r;var i=Number.parseFloat(t);Number.isNaN(i)||(i=JS(i),i=Math.max(i,_bt.minFontSize),i=Math.min(i,_bt.maxFontSize),this.commitFontSizeWithInt(i),(r=this.inputRef.current)==null||r.blur(),this.setState({overrideFontSize:void 0,isFocusInput:!1,hoverIndex:void 0}))}},{key:"commitFontSizeWithInt",value:function commitFontSizeWithInt(t){if(this.shouldUpdateFontSize(t)){var _this$props99=this.props,i=_this$props99.viewMovingState,_r178=_this$props99.delegate;i.maskHideFloatBarSometime(),_r178.updateTextareaFontSize(t)}}},{key:"renderMenu",value:function renderMenu(t){var _this285=this;var i=this.inputRef.current;if(!i)return null;var _bt2=_bt,r=_bt2.menuMargin,_bt2$menuSize=_bt2.menuSize,n=_bt2$menuSize.width,s=_bt2$menuSize.height,o=this.props.isMenuToDown,a=i.offsetLeft+(i.offsetWidth-n)/2,l;return o?l=i.offsetTop+i.offsetHeight+r:l=i.offsetTop-r-s,Se.createElement(wi,{className:"font-size-menu",style:{left:a,top:l,width:n,height:s},onMouseLeave:function onMouseLeave(){return _this285.setState({hoverIndex:void 0})},onShouldBecomeHide:this.onShouldBecomeHide},this.renderFontSizeList(t))}},{key:"renderFontSizeList",value:function renderFontSizeList(t){var _this286=this;var i=parseInt(t,10),_bt3=_bt,r=_bt3.fontSizeList,n=[];var _loop31=function _loop31(s){var o=r[s],a=null,l="cell";i===o&&(a=Se.createElement("img",{className:"check",alt:"check",src:$e("check")}));var h=_this286.state.hoverIndex;s===h&&(l+=" hover"),n.push(Se.createElement("div",{key:"".concat(s),className:l,onMouseEnter:function onMouseEnter(){return _this286.setState({hoverIndex:s})},onClick:function onClick(){return _this286.onSelectFontSize(o)}},a&&Se.createElement("div",{className:"check"}),Se.createElement("span",null,o),a))};for(var s=0;s<r.length;++s){_loop31(s)}return n}},{key:"renderArrowButton",value:function renderArrowButton(t,i){var _this287=this;var r,n=Number.parseFloat(t),_bt4=_bt,s=_bt4.fontSizeList;if(!Number.isNaN(n))if(i.isUp)for(var l=0;l<s.length;++l){var h=s[l];if(h>n){r=h;break}}else for(var _l13=s.length-1;_l13>=0;--_l13){var _h13=s[_l13];if(_h13<n){r=_h13;break}}var o=i.iconName,a=function a(){if(r!==void 0){var _l14=_this287.props.viewMovingState;_l14.maskHideFloatBarSometime(),_this287.commitFontSizeWithInt(r),_this287.setState({overrideFontSize:void 0,hoverIndex:void 0})}};return Se.createElement(qe,{className:"arrow-button "+(i.isUp?"up":"down"),disable:r===void 0,refObject:i.ref,onClick:a},Se.createElement("img",{alt:"icon",src:$e(o)}))}},{key:"render",value:function render(){var _this288=this;var _this$state10=this.state,t=_this$state10.overrideFontSize,i=_this$state10.isFocusInput,r=t;if(r===void 0){var s=this.getFontSize();s===void 0?r="":r="".concat(s)}return Se.createElement(Se.Fragment,{key:"font-size"},Se.createElement("div",{className:"decorator"},Se.createElement("img",{className:"font-size-icon",alt:"icon",src:$e(i?"font-size-active":"font-size")})),Se.createElement("input",{className:"font-size-input",type:"number",value:r,ref:this.inputRef,onFocus:this.onFocusInput,onKeyUp:this.onPressKeyInput,onChange:function onChange(s){return _this288.setState({overrideFontSize:s.target.value})}}),i&&this.renderMenu(r),Se.createElement("div",{className:"decorator"},Se.createElement("div",{className:"font-size-buttons"},this.renderArrowButton(r,this.upArrowButton),this.renderArrowButton(r,this.downArrowButton))))}}]);return bt}(Se.Component);_bt.minFontSize=1,_bt.maxFontSize=999,_bt.fontSizeList=Object.freeze([12,14,18,24,36,48,64,80,144,288]),_bt.menuMargin=21,_bt.menuSize=Object.freeze({width:64,height:248}),_bt=vr([Li],_bt);var zt=P(require("react"));function yp(_ref107,r){var e=_ref107.viewMovingState,t=_ref107.components,i=_ref107.colors;return{width:40,height:40,node:function node(o,a,l,h,d,u){var f=a+h/2<=u/2;return zt.createElement(_at,{key:"font-colors",viewMovingState:e,colors:i,components:t,parentWidth:l,parentHeight:h,isMenuToDown:f,onUpdateColor:r})}}}function ew(e,t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;++i){if(e[i]!==t[i])return!1}return!0}var _at=/*#__PURE__*/function(_zt$Component){_inherits(at,_zt$Component);var _super92=_createSuper(at);function at(t){var _this289;_classCallCheck(this,at);_this289=_super92.call(this,t);_this289.onClickDisplayButton=function(){var t=_this289.state.isDisplayMenu;t||_this289.setState({isDisplayMenu:!0})};_this289.state={isDisplayMenu:!1};return _this289}_createClass(at,[{key:"onClickColorButton",value:function onClickColorButton(t){var i=_toConsumableArray(t),r=this.props.onUpdateColor;r(i),this.setState({isDisplayMenu:!1})}},{key:"getSelectedColor",value:function getSelectedColor(){var t=null,i=this.props.components;var _iterator255=_createForOfIteratorHelper(i),_step255;try{for(_iterator255.s();!(_step255=_iterator255.n()).done;){var _r179=_step255.value;var n=_r179.color;if(n){if(!t)t=n;else if(!ew(t,n)){t=null;break}}}}catch(err){_iterator255.e(err)}finally{_iterator255.f()}return t}},{key:"renderMenu",value:function renderMenu(t){var _this290=this;var _this$props100=this.props,i=_this$props100.isMenuToDown,r=_this$props100.colors,n=_this$props100.parentWidth,s=_this$props100.parentHeight,o=Math.ceil(r.length/_at.menuLineCellsCount),l=Math.min(r.length,_at.menuLineCellsCount)*_at.menuCellSize.width+2*_at.menuPadding,h=o*_at.menuCellSize.height+2*_at.menuPadding,_at2=_at,d=_at2.menuMargin,u=n-l,p;return i?p=s+d:p=-(d+h),zt.createElement(wi,{className:"font-colors-menu",style:{left:u,top:p,width:l,height:h},onShouldBecomeHide:function onShouldBecomeHide(){return _this290.setState({isDisplayMenu:!1})}},this.renderColorButtons(t))}},{key:"renderColorButtons",value:function renderColorButtons(t){var _this291=this;var i=this.props.colors,r=[];var _loop32=function _loop32(n){var s=i[n],o="rgb(".concat(s[0],", ").concat(s[1],", ").concat(s[2],")"),a="font-color-button";t&&ew(t,s)?a+=" font-color-selected":a+=" font-color-not-selected",r.push(zt.createElement("div",{key:"".concat(n),className:a,onTouchEnd:function onTouchEnd(){return _this291.onClickColorButton(s)},onClick:function onClick(){return _this291.onClickColorButton(s)}},zt.createElement("div",{className:"core",style:{backgroundColor:o}})))};for(var n=0;n<i.length;++n){_loop32(n)}return r}},{key:"render",value:function render(){var t=this.getSelectedColor(),i=t&&zt.createElement("div",{className:"bar",style:{backgroundColor:"rgb(".concat(t[0],",").concat(t[1],",").concat(t[2],")")}}),r=this.state.isDisplayMenu,n=r?"font-colors-active":"font-colors";return zt.createElement(zt.Fragment,null,zt.createElement(qe,{className:"normal-button",onClick:this.onClickDisplayButton},zt.createElement("div",{className:"font-colors-icon"},zt.createElement("img",{alt:"icon",src:$e(n)}),i)),r&&this.renderMenu(t))}}]);return at}(zt.Component);_at.menuMargin=8,_at.menuPadding=8,_at.menuLineCellsCount=4,_at.menuCellSize=Object.freeze({width:28,height:28}),_at=vr([Li],_at);var lt=P(require("react"));function bp(_ref108){var e=_ref108.delegate;return{width:40,height:40,node:function node(r,n,s,o,a,l){var d=n+o/2<=l/2;return lt.createElement(_mr,{key:"image-layer-button",isMenuToDown:d,delegate:e})}}}var _mr=/*#__PURE__*/function(_lt$Component){_inherits(mr,_lt$Component);var _super93=_createSuper(mr);function mr(t){var _this292;_classCallCheck(this,mr);_this292=_super93.call(this,t);_this292.buttonRef=lt.createRef();_this292.state={isDisplayMenu:!1};return _this292}_createClass(mr,[{key:"renderMenu",value:function renderMenu(){var _this293=this;var t=this.buttonRef.current;if(!t)return null;var _mr$menuSize=_mr.menuSize,i=_mr$menuSize.width,r=_mr$menuSize.height,_mr2=_mr,n=_mr2.menuMargin,_this$props101=this.props,s=_this$props101.isMenuToDown,o=_this$props101.delegate,a=t.offsetLeft+(t.offsetWidth-i)/2,l;return s?l=t.offsetTop+t.offsetHeight+n:l=t.offsetTop-n-r,lt.createElement(wi,{className:"image-layer-menu",style:{left:a,top:l,width:i,height:r},onShouldBecomeHide:function onShouldBecomeHide(){return _this293.setState({isDisplayMenu:!1})}},lt.createElement(qe,{key:"layer-unlock",className:"normal-button",onClick:function onClick(){return o.moveSelectedComponentsToTop()}},lt.createElement("img",{alt:"icon",src:$e("to-top")})),lt.createElement(qe,{key:"layer-lock",className:"normal-button",onClick:function onClick(){return o.moveSelectedComponentsToBottom()}},lt.createElement("img",{alt:"icon",src:$e("to-bottom")})))}},{key:"render",value:function render(){var _this294=this;var t=this.state.isDisplayMenu,i=t?"layer-pressed":"layer";return lt.createElement(lt.Fragment,null,lt.createElement(qe,{key:"layer",className:"normal-button ".concat(t?"highlight-button":""),refObject:this.buttonRef,onClick:function onClick(){return _this294.setState({isDisplayMenu:!t})}},lt.createElement("img",{alt:"icon",src:$e(i)})),t&&this.renderMenu())}}]);return mr}(lt.Component);_mr.menuMargin=21,_mr.menuSize=Object.freeze({width:72,height:40}),_mr=vr([Li],_mr);var fr=Object.freeze({top:12,bottom:24,left:12,right:12}),$o=Object.freeze({top:1,bottom:1,left:1,right:1});function tw(e){var _e$whiteModel=e.whiteModel,t=_e$whiteModel.BezierCurveShape,i=_e$whiteModel.ImageShape,r=_e$whiteModel.TextareaShape,n=[],s=e.components;if(s.length===0)return n;var o=0,a=0,l=0,h=!0,d=!0,u=!0,p=!0,f=!0;var _iterator256=_createForOfIteratorHelper(s),_step256;try{for(_iterator256.s();!(_step256=_iterator256.n()).done;){var _y8=_step256.value;if(Ye(_y8,t))o+=1;else if(Ye(_y8,i))a+=1;else if(Ye(_y8,r)){var b=_y8,v=b.format;v.bold||(d=!1),v.italic||(u=!1),v.underline||(p=!1),v.lineThrough||(f=!1),l+=1}_y8.locked||(h=!1)}}catch(err){_iterator256.e(err)}finally{_iterator256.f()}var m=40,g=40;if(o===s.length){var y=e.delegate;n.push({width:m,height:g,node:function node(){return vp(e)}}),n.push(bp(e)),n.push({width:m,height:g,node:function node(){return iw(e)}}),n.push(yp(e,function(b){return y.updatePencilColor(b)}))}else if(a===s.length)n.push({width:m,height:g,node:function node(){return vp(e)}}),n.push({width:m,height:g,node:function node(){return qT(e,h)}}),h||n.push(bp(e)),n.push({width:m,height:g,node:function node(){return iw(e)}});else if(l===s.length){var _y7=e.delegate;n.push({width:m,height:g,node:function node(){return vp(e)}}),n.push({width:m,height:g,node:function node(){return ZT(e,d)}}),n.push({width:m,height:g,node:function node(){return JT(e,u)}}),n.push({width:m,height:g,node:function node(){return eE(e,f)}}),n.push({width:m,height:g,node:function node(){return tE(e,p)}}),n.push(ZS(e)),n.push(yp(e,function(b){return _y7.updateTextareaFormat({color:b})}))}return n}function vp(_ref109){var e=_ref109.delegate,t=_ref109.isEditTextarea;return vt.createElement(qe,{key:"delete",className:"normal-button",onClick:function onClick(){return e["delete"]()},disable:t},vt.createElement("img",{alt:"delete",src:$e("delete")}))}function qT(_ref110,t){var e=_ref110.delegate;var i=!t;return vt.createElement(qe,{key:"lock",className:"normal-button",onClick:function onClick(){return e.lockImages(i)}},vt.createElement("img",{alt:"lock",src:$e(t?"unlock-new":"lock-new")}))}function ZT(_ref111,i){var e=_ref111.viewMovingState,t=_ref111.delegate;var r=!i;return vt.createElement(qe,{key:"text-blob",className:"normal-button",onClick:function onClick(){e.maskHideFloatBarSometime(),t.updateTextareaFormat({bold:r})}},vt.createElement("img",{alt:"text-blob",src:$e(i?"bold-active":"bold")}))}function JT(_ref112,i){var e=_ref112.viewMovingState,t=_ref112.delegate;var r=!i;return vt.createElement(qe,{key:"text-italic",className:"normal-button",onClick:function onClick(){e.maskHideFloatBarSometime(),t.updateTextareaFormat({italic:r})}},vt.createElement("img",{alt:"text-italic",src:$e(i?"italic-active":"italic")}))}function eE(_ref113,i){var e=_ref113.viewMovingState,t=_ref113.delegate;var r=!i;return vt.createElement(qe,{key:"text-line-through",className:"normal-button",onClick:function onClick(){e.maskHideFloatBarSometime(),t.updateTextareaFormat({lineThrough:r})}},vt.createElement("img",{alt:"text-line-through",src:$e(i?"line-through-active":"line-through")}))}function tE(_ref114,i){var e=_ref114.viewMovingState,t=_ref114.delegate;var r=!i;return vt.createElement(qe,{key:"text-underline",className:"normal-button",onClick:function onClick(){e.maskHideFloatBarSometime(),t.updateTextareaFormat({underline:r})}},vt.createElement("img",{alt:"text-underline",src:$e(i?"underline-active":"underline")}))}function iw(_ref115){var e=_ref115.delegate;return vt.createElement(qe,{key:"duplicate",className:"normal-button",onClick:function onClick(){return e.duplicate()}},vt.createElement("img",{alt:"duplicate",src:$e("duplicate")}))}var gr=P(require("mobx"));function hc(e,t){return Math.abs(e-t)<=.01}var dc=/*#__PURE__*/function(){function dc(t){var _this295=this;_classCallCheck(this,dc);this.latestCallMaskTimestamp=0;this.timer=null;this._shouldHideFloatBar=!1;this.onAfterMoving=function(){_this295._shouldHideFloatBar&&(_this295._shouldHideFloatBar=!1),_this295.timer=null};this.rectangle=t,(0,gr.makeObservable)(this,{_shouldHideFloatBar:gr.observable,setState:gr.action,release:gr.action})}_createClass(dc,[{key:"shouldHideFloatBar",get:function get(){return this._shouldHideFloatBar}},{key:"setState",value:function setState(t,i){var _this296=this;var r=this.rectangle,n=!hc(r.originX,t.originX)||!hc(r.originY,t.originY),s=!hc(r.width,t.width)||!hc(r.height,t.height);(n||!i&&s)&&(!this._shouldHideFloatBar&&Date.now()>=this.latestCallMaskTimestamp+dc.maskDuration&&(this._shouldHideFloatBar=!0),this.timer!==null&&clearTimeout(this.timer),this.timer=setTimeout(function(){return(0,gr.runInAction)(_this296.onAfterMoving)},dc.cameraTouchInterval)),(n||s)&&(this.rectangle=t)}},{key:"maskHideFloatBarSometime",value:function maskHideFloatBarSometime(){this.latestCallMaskTimestamp=Date.now()}},{key:"release",value:function release(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null,this._shouldHideFloatBar=!1)}}]);return dc}(),Yo=dc;Yo.cameraTouchInterval=300,Yo.maskDuration=100;var si;(function(s){s[s.Top=0]="Top",s[s.Bottom=1]="Bottom",s[s.Left=2]="Left",s[s.Right=3]="Right",s[s.Center=4]="Center"})(si||(si={}));var Ds=/*#__PURE__*/function(_uc$Component){_inherits(Ds,_uc$Component);var _super94=_createSuper(Ds);function Ds(t){var _this297;_classCallCheck(this,Ds);_this297=_super94.call(this,t);_this297.lockView=function(t){_this297.setState({lockedPosition:t})};_this297.state={lockedPosition:void 0},_this297.viewMovingState=new Yo(t.rectangle);return _this297}_createClass(Ds,[{key:"componentDidMount",value:function componentDidMount(){var _this298=this;var t=!0;this.disposer=(0,rw.autorun)(function(){_this298.viewMovingState.shouldHideFloatBar?t||(_this298.unlockView(),t=!0):t=!1})}},{key:"componentDidUpdate",value:function componentDidUpdate(){var t=this.props.rectangle;this.viewMovingState.setState(t,this.isEditTextarea())}},{key:"componentWillUnmount",value:function componentWillUnmount(){var t;this.viewMovingState.release(),(t=this.disposer)==null||t.call(this)}},{key:"isEditTextarea",value:function isEditTextarea(){var _this$props102=this.props,t=_this$props102.components,i=_this$props102.whiteModel.TextareaShape;var _iterator257=_createForOfIteratorHelper(t),_step257;try{for(_iterator257.s();!(_step257=_iterator257.n()).done;){var _r180=_step257.value;if(Ye(_r180,i)&&_r180.editedBy!==void 0)return!0}}catch(err){_iterator257.e(err)}finally{_iterator257.f()}return!1}},{key:"position",value:function position(t,i){var r=t.originX,n=t.originY,s=r+t.width,o=n+t.height,a=$o.left+$o.right,l=$o.top+$o.bottom,h=0;var _iterator258=_createForOfIteratorHelper(i),_step258;try{for(_iterator258.s();!(_step258=_iterator258.n()).done;){var _step258$value=_step258.value,y=_step258$value.width,b=_step258$value.height;a+=y,h=Math.max(h,b)}}catch(err){_iterator258.e(err)}finally{_iterator258.f()}l+=h;var d=a+fr.left+fr.right,u=l+fr.top+fr.bottom,p=this.props.screenSize,f=p.width,m=p.height,g;return n>=u?g=0:m-o>=u?g=1:r>=d?g=2:f-s>=d?g=3:g=4,{left:r,right:s,top:n,bottom:o,position:g,boxWidth:a,boxHeight:l,width:d,height:u}}},{key:"centerXWithTopOrBottom",value:function centerXWithTopOrBottom(t,i){var r=Math.max(t.left,0),n=Math.min(t.right,i),s=t.width/2,o=(r+n)/2;return o-s<0?o=s:o+s>i&&(o=i-s),o}},{key:"unlockView",value:function unlockView(){this.setState({lockedPosition:void 0})}},{key:"render",value:function render(){var _this299=this;var _this$props103=this.props,t=_this$props103.whiteModel,i=_this$props103.components,r=_this$props103.screenSize,n=_this$props103.rectangle,s=_this$props103.view,o=_this$props103.cnode,a=_this$props103.room;if(!a||this.viewMovingState.shouldHideFloatBar)return null;var l;s?l=s.floatBarDelegate:l=a.getMainViewIfExits().floatBarDelegate;var h=this.state.lockedPosition,d=tw({viewMovingState:this.viewMovingState,isEditTextarea:this.isEditTextarea(),whiteModel:t,components:i,delegate:l,colors:a.floatBarOptions.colors});if(d.length<=0)return null;var u=h||this.position(n,d),p=r.width,f=r.height,m,g;switch(u.position){case 0:{m=this.centerXWithTopOrBottom(u,p),g=u.top-u.height/2;break}case 1:{m=this.centerXWithTopOrBottom(u,p),g=u.bottom+u.height/2;break}case 2:{m=u.left-u.width/2,g=Math.max(u.top,0)+u.height/2;break}case 3:{m=u.right+u.width/2,g=Math.max(u.top,0)+u.height/2;break}case 4:{var x=Math.max(u.left,0),T=Math.min(u.right,p),O=Math.max(u.top,0);m=(x+T)/2,g=O+u.height/2;break}}var y=m-u.width/2,b=g-u.height/2,v="translate(".concat(y,"px,").concat(b,"px)"),w=[],M=y;var _iterator259=_createForOfIteratorHelper(d),_step259;try{for(_iterator259.s();!(_step259=_iterator259.n()).done;){var _step259$value=_step259.value,_x157=_step259$value.width,_T2=_step259$value.node;var _O=_T2(M,b,u.boxWidth,u.boxHeight,p,f);w.push(_O),M+=_x157}}catch(err){_iterator259.e(err)}finally{_iterator259.f()}return uc.createElement(Oi,{context:o,className:"float-bar",onMouseEnter:function onMouseEnter(){return _this299.lockView(u)},style:{WebkitTransform:v,transform:v,width:u.boxWidth,height:u.boxHeight,padding:0,marginLeft:fr.left,marginRight:fr.right,marginTop:fr.top,marginBottom:fr.bottom}},w)}}],[{key:"willInterruptEvent",value:function willInterruptEvent(){return!0}}]);return Ds}(uc.Component);Ds=vr([Li],Ds);function Xo(e){return function(){return e}}function nw(){return Sp(1)}function Sp(e){return function(t,i){var r=t.width/i.width,n=t.height/i.height,s=Math.max(r,n)*e;return Number.isNaN(s)?1:s}}function sw(){return wp(1,0)}function ow(e){return wp(1,e)}function aw(e){return wp(e,0)}function wp(e,t){return function(i,r){var n=i.width/(r.width+t*2),s=i.height/(r.height+t*2),o=Math.min(n,s)*e;return Number.isNaN(o)||o===1/0?0:o}}function iE(e){for(var t in e){e[t]===void 0&&delete e[t]}return e}var pc=/*#__PURE__*/function(){function pc(t,i){_classCallCheck(this,pc);this._cameraBound=i,this.cameraman=t.bindCameraman(this.toCameraBorder(i),"device")}_createClass(pc,[{key:"cameraBound",get:function get(){return this._cameraBound}},{key:"setScreenSize",value:function setScreenSize(t){(!this.screenSize||this.screenSize.width!==t.width||this.screenSize.height!==t.height)&&(this.screenSize=t,this.setCameraBound({maxContentMode:this.maxContentMode,minContentMode:this.minContentMode}))}},{key:"setCameraBound",value:function setCameraBound(t){this._cameraBound=t,this.cameraman.setCameraBorder(this.toCameraBorder(t))}},{key:"toCameraBorder",value:function toCameraBorder(t){var i=t.damping,r=t.centerX,n=t.centerY,s=t.width,o=t.height,a=this.boundSize(s,o);this.maxContentMode=t.maxContentMode,this.minContentMode=t.minContentMode;var l=1/0,h=0;return this.screenSize&&(this.maxContentMode&&(l=this.maxContentMode(this.screenSize,a)),this.minContentMode&&(h=this.minContentMode(this.screenSize,a))),iE({damping:i,centerX:r,centerY:n,width:s,height:o,maxScale:l,minScale:h})}},{key:"boundSize",value:function boundSize(t,i){return this.cameraman?{width:t===void 0?this.cameraman.cameraBorder.width:t,height:i===void 0?this.cameraman.cameraBorder.height:i}:{width:t===void 0?1/0:t,height:i===void 0?1/0:i}}}]);return pc}();var mc;(function(n){n.Triangle="triangle",n.Rhombus="rhombus",n.Pentagram="pentagram",n.SpeechBalloon="speechBalloon"})(mc||(mc={}));var lw=Object.freeze(["currentApplianceName","strokeColor","strokeWidth","textColor","textSize","pencilEraserSize","bold","italic","underline","lineThrough","dottedLine","shapeType","textCanSelectText"]),L;(function(f){f.selector="selector",f.clicker="clicker",f.laserPointer="laserPointer",f.pencil="pencil",f.rectangle="rectangle",f.ellipse="ellipse",f.shape="shape",f.eraser="eraser",f.pencilEraser="pencilEraser",f.text="text",f.straight="straight",f.arrow="arrow",f.hand="hand"})(L||(L={}));var ct;(function(n){n.None="none",n.Dir="dir",n.Page="page",n.Conflict="conflict"})(ct||(ct={}));var Cp=/*#__PURE__*/function(){function Cp(t,i){_classCallCheck(this,Cp);this.enableDrawPoint=t;this.disableNewPencil=i}_createClass(Cp,[{key:"becomeWritable",value:function becomeWritable(t){if(this.disableNewPencil){var i=t.getMemberState();if(i){var _r181=i.pencilOptions;_r181?_r181=D(I({},_r181),{disableBezier:!0}):_r181={disableBezier:!0,enableDrawPoint:!1,sparseHump:3,sparseWidth:4},t.setMemberStateWithCommitter({pencilOptions:_r181})}}}},{key:"shouldUseNewPencil",value:function shouldUseNewPencil(t){return!this.disableNewPencil&&t===L.pencil}}]);return Cp}();var Qo=/*#__PURE__*/function(){function Qo(t){var _this300=this;_classCallCheck(this,Qo);this.onLimiterInvoke=function(){if(_this300.nextInvoker)try{_this300.nextInvoker()}finally{_this300.nextInvoker=void 0}};this.limiter=new dt(t,this.onLimiterInvoke)}_createClass(Qo,[{key:"limitDuration",get:function get(){return this.limiter.limitDuration},set:function set(t){this.limiter.limitDuration=t}},{key:"invoke",value:function invoke(t){this.nextInvoker=t,this.limiter.invoke()}},{key:"flush",value:function flush(){this.nextInvoker&&this.onLimiterInvoke(),this.cancel()}},{key:"cancel",value:function cancel(){this.nextInvoker=void 0,this.limiter.cancel()}}]);return Qo}();var cw=5600,hw=4,fc=100,kp=17,dw=75,uw=100,yr;(function(r){r[r.Hight=0]="Hight",r[r.Medium=1]="Medium",r[r.Low=2]="Low"})(yr||(yr={}));var pw=Object.freeze((_Object$freeze={},_defineProperty(_Object$freeze,0,41),_defineProperty(_Object$freeze,1,82),_defineProperty(_Object$freeze,2,164),_Object$freeze));var Mp={};Bn(Mp,{bezierMaxSegments:function bezierMaxSegments(){return Pp},bezierRenderGranularity:function bezierRenderGranularity(){return xp},fitCurveMaxError:function fitCurveMaxError(){return Ip}});var xp=4.5,Pp=30,Ip=1;var mw=Object.freeze({x:0,y:0});function rE(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function gc(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function fw(e){return Math.pow(e.x,2)+Math.pow(e.y,2)}function br(e,t){return{x:e.x+t.x,y:e.y+t.y}}function gw(){for(var _len24=arguments.length,e=new Array(_len24),_key24=0;_key24<_len24;_key24++){e[_key24]=arguments[_key24]}return{x:e.reduce(function(t,i){return t+i.x},0),y:e.reduce(function(t,i){return t+i.y},0)}}function Ut(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Ee(e,t){return{x:e.x*t,y:e.y*t}}function nE(e,t){return{x:e.x/t,y:e.y/t}}function yw(e){var t=gc(e);return t===0?e:nE(e,t)}function Xr(e,t){return e.x*t.x+e.y*t.y}function yc(e,t){if(e.length<2)return[];var i=e.length,r=vw(e[1],e[0]),n=vw(e[i-2],e[i-1]);return Tp(e,r,n,t)}function Tp(e,t,i,r){var n=20;if(e.length===2){var m=rE(e[0],e[1])/3;return[{curve:[e[0],br(e[0],Ee(t,m)),br(e[1],Ee(i,m)),e[1]],beginIndex:0,count:e.length}]}var s=lE(e),_bw=bw(e,s,s,t,i),_bw2=_slicedToArray(_bw,3),o=_bw2[0],a=_bw2[1],l=_bw2[2];if(a===0||a<r)return[{curve:o,beginIndex:0,count:e.length}];if(a<r*r){var _m28=s,g=a,y=l;for(var b=0;b<n;b++){var _bw3,_bw4;if(_m28=oE(o,e,_m28),(_bw3=bw(e,s,_m28,t,i),_bw4=_slicedToArray(_bw3,3),o=_bw4[0],a=_bw4[1],l=_bw4[2],_bw3),a<r)return[{curve:o,beginIndex:0,count:e.length}];if(l===y){var v=a/g;if(v>.9999&&v<1.0001)break}g=a,y=l}}var h=Ut(e[l-1],e[l+1]);if(h.x===0&&h.y===0){var _Ut=Ut(e[l-1],e[l]),_m29=_Ut.x,_g10=_Ut.y;h={x:-_g10,y:_m29}}var d=yw(h),u=Ee(d,-1),p=Tp(e.slice(0,l+1),t,d,r),f=Tp(e.slice(l),u,i,r);var _iterator260=_createForOfIteratorHelper(f),_step260;try{for(_iterator260.s();!(_step260=_iterator260.n()).done;){var _m30=_step260.value;_m30.beginIndex+=l}}catch(err){_iterator260.e(err)}finally{_iterator260.f()}return[].concat(_toConsumableArray(p),_toConsumableArray(f))}function bw(e,t,i,r,n){var s=sE(e,i,r,n),_cE=cE(e,s,t),_cE2=_slicedToArray(_cE,2),o=_cE2[0],a=_cE2[1];return[s,o,a]}function sE(e,t,i,r){var n=e[0],s=e[e.length-1],o=[n,mw,mw,s],a=t.map(function(b){var v=1-b;return[Ee(i,3*b*(v*v)),Ee(r,3*v*(b*b))]}),l=[[0,0],[0,0]],h=[0,0];for(var _i54=0,_Array$from=Array.from(t.entries());_i54<_Array$from.length;_i54++){var _Array$from$_i=_slicedToArray(_Array$from[_i54],2),b=_Array$from$_i[0],v=_Array$from$_i[1];var _a$b=_slicedToArray(a[b],2),w=_a$b[0],M=_a$b[1];l[0][0]+=Xr(w,w),l[0][1]+=Xr(w,M),l[1][0]+=Xr(w,M),l[1][1]+=Xr(M,M);var x=Ut(e[b],bc([n,n,s,s],v));h[0]+=Xr(w,x),h[1]+=Xr(M,x)}var d=l[0][0]*l[1][1]-l[1][0]*l[0][1],u=l[0][0]*h[1]-l[1][0]*h[0],p=h[0]*l[1][1]-h[1]*l[0][1],f=d===0?0:p/d,m=d===0?0:u/d,g=gc(Ut(n,s)),y=1e-6*g;return f<y||m<y?(o[1]=br(n,Ee(i,g/3)),o[2]=br(s,Ee(r,g/3))):(o[1]=br(n,Ee(i,f)),o[2]=br(s,Ee(r,m))),o}function oE(e,t,i){return i.map(function(r,n){return aE(e,t[n],r)})}function aE(e,t,i){var r=Ut(bc(e,i),t),n=uE(e,i),s=Xr(r,n),o=fw(n)+2*Xr(r,pE(e,i));return o===0?i:i-s/o}function lE(e){var t=[],i,r,n;return e.forEach(function(s,o){i=o>0?r+gc(Ut(s,n)):0,t.push(i),r=i,n=s}),t=t.map(function(s){return r===0?0:s/r}),t}function cE(e,t,i){var r=0,n=Math.floor(e.length/2),s=hE(t,10);for(var o=1;o<e.length-1;o++){var a=e[o],l=dE(t,i[o],s,10),h=Ut(bc(t,l),a),d=fw(h);d>r&&(r=d,n=o)}return[r,n]}function hE(e,t){var i=[0],r=e[0],n=0;for(var s=1;s<=t;s++){var o=bc(e,s/t);n+=gc(Ut(o,r)),i.push(n),r=o}return i=i.map(function(s){return s/n}),i}function dE(e,t,i,r){if(t<0)return 0;if(t>1)return 1;for(var n=1;n<=r;n++){if(t<=i[n]){var s=(n-1)/r,o=n/r,a=i[n-1],l=i[n];return(t-a)/(l-a)*(o-s)+s}}return Number.NaN}function vw(e,t){return yw(Ut(e,t))}function bc(e,t){var i=1-t,r=Ee(e[0],Math.pow(i,3)),n=Ee(e[1],3*Math.pow(i,2)*t),s=Ee(e[2],3*i*Math.pow(t,2)),o=Ee(e[3],Math.pow(t,3));return gw(r,n,s,o)}function uE(e,t){var i=1-t,r=Ee(Ut(e[1],e[0]),3*Math.pow(i,2)),n=Ee(Ut(e[2],e[1]),6*i*t),s=Ee(Ut(e[3],e[2]),3*Math.pow(t,2));return gw(r,n,s)}function pE(e,t){return br(Ee(br(Ut(e[2],Ee(e[1],2)),e[0]),6*(1-t)),Ee(br(Ut(e[3],Ee(e[2],2)),e[1]),6*t))}var Qr=/*#__PURE__*/function(){function Qr(t){_classCallCheck(this,Qr);this.extraSteups=0;this.straightEnd=null;this.points=null;this.isCurveExits=!1;this.didPushPointsCount=0;var i=t.firstPoint;this.applianceManager=t.applianceManager,this.paintingShape=t.paintingShape,this.bezierCurvePainter=t.bezierCurvePainter,this.invoker=t.invoker,this.beginPoint=i,this.isStraightMode=t.isStraightMode,this.scale=t.scale,this.enableDrawPoint=t.enableDrawPoint,this.zone=Object.seal({top:i.y,bottom:i.y,left:i.x,right:i.x}),this.bezierCurvePainter.pushPoint(i.x,i.y)}_createClass(Qr,[{key:"toStraightMode",value:function toStraightMode(){var t;if((t=this.invoker)==null||t.flush(),this.points){var i=this.points[this.points.length-1];this.beginPoint={x:i.x,y:i.y},this.points=null}this.isStraightMode=!0}},{key:"toPencilMode",value:function toPencilMode(){if(this.straightEnd){var _this$straightEnd=this.straightEnd,t=_this$straightEnd.x,i=_this$straightEnd.y;this.receiveIntoZone(t,i),this.beginPoint={x:t,y:i},this.straightEnd=null}this.bezierCurvePainter.completeMoveBrokenPoint(),this.isStraightMode=!1,this.isCurveExits=!1}},{key:"addExtraSteups",value:function addExtraSteups(){return this.extraSteups+=1}},{key:"moveTo",value:function moveTo(t,i){this.isStraightMode?this.moveStraightEnd(t,i):this.pushPencilPoint(t,i)}},{key:"complete",value:function complete(t,i){return this.isStraightMode&&this.receiveIntoZone(t,i),!this.shouldCancelPaintingPencil()}},{key:"shouldCancelPaintingPencil",value:function shouldCancelPaintingPencil(){if(this.enableDrawPoint)return!1;{var t=this.paintingShape.hitTestingBoxMargin/5,i=this.zone.right-this.zone.left,_r182=this.zone.bottom-this.zone.top;return i<=t&&_r182<=t}}},{key:"moveStraightEnd",value:function moveStraightEnd(t,i){var r=qr.curveConvergenceSteps.length,n=this.extraSteups-r;this.extraSteups=r,this.straightEnd?(this.straightEnd.x=t,this.straightEnd.y=i,this.applianceManager.updateBezierCurveTail(this.createStraightLine(t,i),n)):(this.straightEnd={x:t,y:i},this.didPushPointsCount+=1,this.applianceManager.appendBezierCurveTail([this.createStraightLine(t,i)],n)),this.didPushPointsCount<Qr.maxSegmentsPointsCount?this.bezierCurvePainter.moveBrokenPoint(t,i):this.bezierCurvePainter.touchPoint(t,i)}},{key:"createStraightLine",value:function createStraightLine(t,i){var r=this.beginPoint.x-t,n=this.beginPoint.y-i;return{point1:I({},this.beginPoint),point2:{x:t,y:i},point3:{x:t,y:i},hiddenPoints:0,cubic:[0,1],distance:Math.sqrt(r*r+n*n)}}},{key:"pushPencilPoint",value:function pushPencilPoint(t,i){var _this301=this;this.points||(this.points=[D(I({},this.beginPoint),{distance:0})]);var r=this.createStrokePoint(this.points,t,i);this.points.push(r),this.didPushPointsCount<Qr.maxSegmentsPointsCount?(this.bezierCurvePainter.pushPoint(t,i),this.didPushPointsCount+=1):this.bezierCurvePainter.touchPoint(t,i),this.invoker&&this.points.length<Qr.maxSegmentsPointsCount?this.invoker.invoke(function(){return _this301.syncCurve()}):this.syncCurve(),this.receiveIntoZone(t,i)}},{key:"syncCurve",value:function syncCurve(){var t=this.points,i=Ip/this.scale,r=yc(t,Math.pow(i,2)),n=this.subtractExtraSteps();if(r.length===1){var s=r[0].curve,o=this.createBezierCurve(t,s,0,t.length);this.isCurveExits?this.applianceManager.updateBezierCurveTail(o,n):this.applianceManager.appendBezierCurveTail([o],n)}else{var _s37=0,_o32=[];var _iterator261=_createForOfIteratorHelper(r),_step261;try{for(_iterator261.s();!(_step261=_iterator261.n()).done;){var _step261$value=_step261.value,a=_step261$value.curve,l=_step261$value.beginIndex,h=_step261$value.count;_o32.push(this.createBezierCurve(t,a,l,h)),_s37=Math.max(_s37,l)}}catch(err){_iterator261.e(err)}finally{_iterator261.f()}t.splice(0,_s37),this.isCurveExits?this.applianceManager.splitBezierCurveTail(_o32,n):this.applianceManager.appendBezierCurveTail(_o32,n)}this.isCurveExits=!0}},{key:"createStrokePoint",value:function createStrokePoint(t,i,r){var n=t[t.length-1],s=i-n.x,o=r-n.y,a=n.distance+Math.sqrt(s*s+o*o);return{x:i,y:r,distance:a}}},{key:"createBezierCurve",value:function createBezierCurve(t,i,r,n){var o=n-2,a=t[r],l=t[r+n-1];return{point1:i[1],point2:i[2],point3:i[3],hiddenPoints:o,cubic:this.fitCubic(t,r,n),distance:l.distance-a.distance}}},{key:"fitCubic",value:function fitCubic(t,i,r){var n=null,s=t[i].distance,o=t[i+r-1].distance-s;if(r>=3&&o>0){var a=[],l=[];for(var h=0;h<r;++h){var d=t[i+h].distance;a[h]=(d-s)/o,l[h]=h/(r-1)}n=Qr.getLinearRegression(a,l)}return n||(n=_toConsumableArray(Qr.defaultCubic)),n}},{key:"receiveIntoZone",value:function receiveIntoZone(t,i){this.zone.left=Math.min(this.zone.left,t),this.zone.right=Math.max(this.zone.right,t),this.zone.top=Math.min(this.zone.top,i),this.zone.bottom=Math.max(this.zone.bottom,i)}},{key:"subtractExtraSteps",value:function subtractExtraSteps(){var t=0;return this.extraSteups>0&&(this.extraSteups-=1,t=1),t}}],[{key:"getLinearRegression",value:function getLinearRegression(t,i){var r=null,n=0,s=0,o=0,a=0,l=0;for(var h=1;h<t.length;++h){var d=t[h],u=i[h];if(d!==0){var p=d*d,f=u/p;n+=f,s+=d,o+=p,a+=f*d,l+=1}}if(l>2){var _h14=s/l,_d13=n/l,_u19=(a-_d13*_h14)/(o-s*s/l),_p19=_d13-_u19*_h14,_f15=_p19+_u19;r=[_p19/_f15,_u19/_f15,0,0]}return r}}]);return Qr}(),qo=Qr;qo.maxSegmentsPointsCount=350,qo.defaultCubic=Object.freeze(Qr.getLinearRegression([0,.2,.4,.6,.8,1],[0,.2,.4,.6,.8,1]));var qr=/*#__PURE__*/function(){function qr(t,i,r,n,s,o,a){var _this302=this;_classCallCheck(this,qr);this.isShiftPress=!1;this.isCtrlKeyPress=!1;this.isAltPress=!1;this.isPaintCircularMode=!1;this.curve=null;this.commiter=null;this.onAddExtraSteups=function(){var t;_this302.curve&&((t=_this302.invoker)==null||t.flush(),_this302.applianceManager.addBezierCurveExtraSteups(),_this302.curve.addExtraSteups()>=_this302.bezierCurvePainter.maxExtraSteups&&_this302.fountain.stop())};this.view=t,this.applianceManager=i,this.cameraObserver=r,this.pencilOptions=n,this.bezierCurvePainter=s,this.fountain=new vc(this.onAddExtraSteups),o?this.invoker=null:this.invoker=new Qo(pw[a])}_createClass(qr,[{key:"notifyShiftPress",value:function notifyShiftPress(t){var i,r;this.isShiftPress!==t&&(this.isShiftPress=t,t?(i=this.curve)==null||i.toStraightMode():(r=this.curve)==null||r.toPencilMode())}},{key:"notifiyCtrlPress",value:function notifiyCtrlPress(t){this.isCtrlKeyPress=t}},{key:"notifiyAltPress",value:function notifiyAltPress(t){this.isAltPress=t}},{key:"pushBoundlessMouseEvent",value:function pushBoundlessMouseEvent(t,i){switch(this.commiter=null,t){case S.MouseDown:case S.SortedTouchStart:{this.onMouseDown(i);break}case S.MouseMove:case S.SortedTouchMove:{this.onMouseMove(i);break}case S.MouseUp:case S.SortedTouchEnd:case S.SortedTouchCancel:{this.onMouseUp(i);break}case S.MouseLeave:{this.onMouseLeave(i);break}}return this.commiter}},{key:"onMouseDown",value:function onMouseDown(_ref116){var t=_ref116.x,i=_ref116.y;!this.curve&&!this.isPaintCircularMode&&(this.isAltPress?(this.isPaintCircularMode=!0,this.applianceManager.beginPencilCircular(t,i,this.isCtrlKeyPress)):(this.curve=new qo({applianceManager:this.applianceManager,paintingShape:this.createCurveShape(t,i),bezierCurvePainter:this.bezierCurvePainter,invoker:this.invoker,firstPoint:{x:t,y:i},isStraightMode:this.isShiftPress,enableDrawPoint:this.pencilOptions.enableDrawPoint,scale:this.cameraObserver.cameraState.scale}),this.fountain.touch()))}},{key:"onMouseMove",value:function onMouseMove(t){this.curve?(this.curve.moveTo(t.x,t.y),this.fountain.touch()):this.isPaintCircularMode?this.applianceManager.movePencilCircular(t.x,t.y):this.applianceManager.onMouseMove(t,this.view.focusSceneId)}},{key:"onMouseUp",value:function onMouseUp(_ref117){var t=_ref117.x,i=_ref117.y;var r;this.curve?((r=this.invoker)==null||r.flush(),this.fountain.stop(),this.curve.complete(t,i)?this.commiter=this.applianceManager.completePencilPainting(t,i):this.applianceManager.cancelPencilPainting(t,i,this.view.focusSceneId),this.bezierCurvePainter.completePainting(this.curve.paintingShape),this.curve=null):this.isPaintCircularMode&&(this.isPaintCircularMode=!1,this.commiter=this.applianceManager.completePencilCircular(t,i))}},{key:"onMouseLeave",value:function onMouseLeave(t){this.curve||(this.commiter=this.applianceManager.onMouseLeave(t,this.view.focusSceneId))}},{key:"createCurveShape",value:function createCurveShape(t,i){var r=this.applianceManager.createBezierCurve({x:t,y:i},this.view.focusSceneId),n=Va(r);return this.bezierCurvePainter.startPainting(n),r}}]);return qr}();qr.curveConvergenceSteps=Object.freeze([.1,.3,.5,.7,.9,1]);var Sc=/*#__PURE__*/function(){function Sc(t){var _this303=this;_classCallCheck(this,Sc);this.onGush=t;this.sleepTimer=null;this.gushInterval=null;this.onTick=function(){_this303.sleepTimer=null,_this303.gushInterval=setTimeout(_this303.onTick,Sc.GushInterval),_this303.onGush()}}_createClass(Sc,[{key:"touch",value:function touch(){this.gushInterval&&(clearTimeout(this.gushInterval),this.gushInterval=null),this.sleepTimer&&clearTimeout(this.sleepTimer),this.sleepTimer=setTimeout(this.onTick,Sc.SleepDuration)}},{key:"stop",value:function stop(){this.gushInterval&&(clearTimeout(this.gushInterval),this.gushInterval=null),this.sleepTimer&&(clearTimeout(this.sleepTimer),this.sleepTimer=null)}}]);return Sc}(),vc=Sc;vc.SleepDuration=17*4,vc.GushInterval=17;var ge;(function(n){n[n.Down=0]="Down",n[n.Move=1]="Move",n[n.Up=2]="Up",n[n.Leave=3]="Leave"})(ge||(ge={}));var Zo=/*#__PURE__*/function(){function Zo(t,i){var _this304=this;_classCallCheck(this,Zo);this.invoker=new Qo(fc);this.latestHitTestIdentifies=[];this.isPressed=!1;this.onStart=function(t,i){var r=_this304.getProxyEventKind(t),n=_this304.createProxyEvent(t,i,0);if(n&&(_this304.pushProxyEvent(n,i),r===2)){var s=_this304.createProxyEvent(t,i,2);s&&_this304.pushProxyEvent(s,i)}};this.onEvent=function(t,i){var r=_this304.createProxyEvent(t,i);r&&_this304.pushProxyEvent(r,i)};this.onCancel=function(t,i){var h;var r=2,n=0,s=0;t&&(n=t.pointOnScreen.x,s=t.pointOnScreen.y);var o=[],a=0,l={x:n,y:s,targetsMap:{},hitTestIdentifies:o};_this304.invoker.cancel(),_this304.latestHitTestIdentifies=o,(h=_this304.onReceviedMouseEvent)==null||h.call(_this304,r,a,l,i)};this.radiusSelector=t,this.delegate=i}_createClass(Zo,[{key:"cleanWaitingEvents",value:function cleanWaitingEvents(){this.invoker.cancel()}},{key:"pushProxyEvent",value:function pushProxyEvent(t,i){var _this305=this;switch(t.boundlessEvent.kind){case S.MouseDown:{this.invoker.limitDuration=kp,this.isPressed=!0;break}case S.MouseUp:{this.invoker.limitDuration=fc,this.isPressed=!1;break}}switch(t.kind){case 0:{this.invoker.limitDuration=kp;break}case 2:{this.invoker.limitDuration=fc;break}}var r=t.mouseEvent.hitTestIdentifies;t.boundlessEvent.kind===S.MouseMove&&!this.isHitTestIdentifiesDifferent(r)?this.invoker.invoke(function(){return _this305.callbackReceiveMouseEvent(t,i)}):(this.invoker.cancel(),this.callbackReceiveMouseEvent(t,i)),this.latestHitTestIdentifies=r}},{key:"callbackReceiveMouseEvent",value:function callbackReceiveMouseEvent(_ref118,n){var t=_ref118.kind,i=_ref118.eraserRadius,r=_ref118.mouseEvent;var s;(s=this.onReceviedMouseEvent)==null||s.call(this,t,i,r,n)}},{key:"createProxyEvent",value:function createProxyEvent(t,i,r){var n=this.delegate.getScreen(i),s=null,o=0,a,l=this.delegate.getCurrentApplianceName(),h=t.pointOnScreen,d=r!=null?r:this.getProxyEventKind(t);if(l===L.selector||l===L.eraser||l===L.text){var p=this.radiusSelector.radius(l,h,this.isPressed);this.isPressed&&l===L.eraser&&(o=p),a=n.hitTest(h.x,h.y,p)}else a=[];var u=this.createMouseEvent(n,t,i,a);return s={kind:d,eraserRadius:o,applianceName:l,mouseEvent:u,boundlessEvent:t},s}},{key:"createMouseEvent",value:function createMouseEvent(t,i,r,n){var s=i.nativeEvent,o;if(s&&s.target){var l=t.findComponentWithTarget(s.target);l&&(o=this.delegate.getTargetsMap(l,r,s))}return o||(o={}),{x:i.pointOnScene.x,y:i.pointOnScene.y,targetsMap:o,hitTestIdentifies:n}}},{key:"getProxyEventKind",value:function getProxyEventKind(t){switch(t.kind){case S.MouseDown:case S.SortedTouchStart:return 0;case S.MouseMove:case S.SortedTouchMove:return 1;case S.MouseUp:case S.SortedTouchEnd:case S.SortedTouchCancel:return 2;case S.MouseLeave:return 3;default:throw new Error("invalid kind ".concat(t.kind));}}},{key:"isHitTestIdentifiesDifferent",value:function isHitTestIdentifiesDifferent(t){var i=this.latestHitTestIdentifies.length!==t.length;if(!i)for(var _r183=0;_r183<t.length;++_r183){var n=t[_r183],s=this.latestHitTestIdentifies[_r183];if(i=n!==s,i)break}return i}}]);return Zo}();var Ep=/*#__PURE__*/function(){function Ep(t){_classCallCheck(this,Ep);this.isDisplayerWritable=t;this.catchPress=!1;this.catchTarget=null;this.shadowTextarea=null;this.didRelease=!1}_createClass(Ep,[{key:"receivePreEndTouch",value:function receivePreEndTouch(t,i){var r=!1;this.catchTarget&&!this.isParent(this.catchTarget,t.target)&&(r=!0),this.isDisplayerWritable()&&!this.didRelease&&this.catchPress&&!r&&i<=7&&this.getShadowTextarea().focus()}},{key:"isParent",value:function isParent(t,i){var r=t;for(;r;){if(r===i)return!0;r=r.parentElement}return!1}},{key:"release",value:function release(){this.shadowTextarea&&(this.shadowTextarea.remove(),this.shadowTextarea=null),this.didRelease=!0}},{key:"getShadowTextarea",value:function getShadowTextarea(){return this.shadowTextarea||(this.shadowTextarea=this.createShadowTextarea()),this.shadowTextarea}},{key:"createShadowTextarea",value:function createShadowTextarea(){var t=document.createElement("textarea");return t.style.flex="fixed",t.style.opacity="0.0",t.style.width="0px",t.style.height="0px",t.addEventListener("onchange",function(){t.value="",t.blur(),console.warn("")}),document.body.append(t),t}}]);return Ep}();var Bs=/*#__PURE__*/function(){function Bs(t){_classCallCheck(this,Bs);this.bezierRenderGranularity=t.bezierRenderGranularity,this.bezierMaxSegments=t.bezierMaxSegments,this.fitCurveMaxError=t.fitCurveMaxError}_createClass(Bs,[{key:"erase",value:function erase(t,i,r){var _this306=this;var n={},s=[];var _iterator262=_createForOfIteratorHelper(t),_step262;try{var _loop33=function _loop33(){var o=_step262.value;var a=o.getCurves(),h=_this306.splitAndKeepErasedRanges(o,i,a,r).map(function(d){return _this306.toBezierCurveShapeUpdater(d,i,o,a)});n[o.identifier]=h,s.push(o.protoKey)};for(_iterator262.s();!(_step262=_iterator262.n()).done;){_loop33()}}catch(err){_iterator262.e(err)}finally{_iterator262.f()}return{updaters:n,touchProtoKeys:s}}},{key:"splitAndKeepErasedRanges",value:function splitAndKeepErasedRanges(t,i,r,n){var _this307=this;var s=t.getInitializedSize(),o=t.getHeadPoint(),a=this.bezierRenderGranularity/i,l=Bs.scale(t.width,s.width),h=Bs.scale(t.height,s.height),u=Math.sqrt(l*l+h*h)/Math.sqrt(2),p=n.transform(t.originX,t.originY,l,h),f=[],m=null,g=o.x*l,y=o.y*h;p.includes(g,y)||(m={headPoint:I({},o),begin:{index:0,d:0,points:null,cubic:[0,0,0,0]},end:{index:0,d:0,points:null,cubic:[0,0,0,0]}});var b=function b(v){var w=Math.ceil(v*u/a);return Math.max(2,Math.min(w,_this307.bezierMaxSegments))};var _loop34=function _loop34(v){var _r$v=r[v],w=_r$v.point1,M=_r$v.point2,x=_r$v.point3,T=_r$v.distance,O=_r$v.cubic,R=!0;_this307.forEachCurvePoints(g,y,w,M,x,R,b(T),function(W,J,ee){var z=p.includes(W,J);m&&!z?(m.end.index=v,m.end.d=ee,m.end.cubic=O):m&&z?(f.push(m),m=null):!m&&!z&&(m={headPoint:{x:W,y:J},begin:{index:v,d:ee,points:null,cubic:O},end:{index:v,d:ee,points:null,cubic:O}})}),g=x.x,y=x.y};for(var v=0;v<r.length;++v){_loop34(v)}m&&f.push(m);for(var _i55=0,_f16=f;_i55<_f16.length;_i55++){var _v13=_f16[_i55];_v13.begin.index===_v13.end.index?this.collectPointsOnTheSameCurve(_v13,r,b):(this.collectPointsOnBeginSideCurve(_v13,r,b),this.collectPointsOnEndSideCurve(_v13,r,b))}return f}},{key:"collectPointsOnTheSameCurve",value:function collectPointsOnTheSameCurve(t,i,r){var n=t.begin,s=t.end;if(n.d>0||s.d<1){var _i$n$index=i[n.index],o=_i$n$index.point1,a=_i$n$index.point2,l=_i$n$index.point3,h=_i$n$index.distance,_t$headPoint=t.headPoint,d=_t$headPoint.x,u=_t$headPoint.y,p=[],f=!0;this.forEachCurvePoints(d,u,o,a,l,f,r(h),function(m,g,y){return y>s.d?!0:(y>=n.d&&p.push({x:m,y:g}),!1)}),t.begin.points=p,t.end.points=p}}},{key:"collectPointsOnBeginSideCurve",value:function collectPointsOnBeginSideCurve(t,i,r){var n=t.begin;if(n.d>0){var _i$n$index2=i[n.index],s=_i$n$index2.point1,o=_i$n$index2.point2,a=_i$n$index2.point3,l=_i$n$index2.distance,_t$headPoint2=t.headPoint,h=_t$headPoint2.x,d=_t$headPoint2.y,u=[],p=!1;this.forEachCurvePoints(h,d,s,o,a,p,r(l),function(f,m,g){return u.push({x:f,y:m}),g<n.d}),t.begin.points=u.reverse()}}},{key:"collectPointsOnEndSideCurve",value:function collectPointsOnEndSideCurve(t,i,r){var n=t.end;if(n.d<1){var _i$n$index3=i[n.index],s=_i$n$index3.point1,o=_i$n$index3.point2,a=_i$n$index3.point3,l=_i$n$index3.distance,_ref119=i[n.index-1].point3||t.headPoint,h=_ref119.x,d=_ref119.y,u=[],p=!0;this.forEachCurvePoints(h,d,s,o,a,p,r(l),function(f,m,g){return u.push({x:f,y:m}),g>n.d}),t.end.points=u}}},{key:"forEachCurvePoints",value:function forEachCurvePoints(t,i,r,n,s,o,a,l){var h=r.x,d=r.y,u=n.x,p=n.y,f=s.x,m=s.y,g,y,b;for(o?(g=0,y=a-1,b=1):(g=a-1,y=0,b=-1);;){var v=g/(a-1),w=Math.pow(1-v,3),M=3*v*Math.pow(1-v,2),x=3*Math.pow(v,2)*(1-v),T=Math.pow(v,3),O=w*t+M*h+x*u+T*f,R=w*i+M*d+x*p+T*m;if(l(O,R,v)||g===y)break;g+=b}}},{key:"toBezierCurveShapeUpdater",value:function toBezierCurveShapeUpdater(t,i,r,n){var s=t.headPoint,o=t.begin,a=t.end,l=Math.pow(this.fitCurveMaxError/i,2),h=null,d=null,u=-1,p=o.index;if(o.points){var m=1;o.index===a.index&&(m=a.d),h=this.collectBezierCurve(o.points,o.cubic,l,o.d,m)}if(o.index<a.index){if(a.points){var _m31=0;o.index===a.index&&(_m31=o.d),d=this.collectBezierCurve(a.points,a.cubic,l,_m31,a.d)}u=a.index,p=a.index}var f;return p===n.length-1?f=r.getExtraSteups():f=this.bezierMaxSegments,{firstPoint:s,first:h,last:d,firstIndex:o.index,lastIndex:u,extraSteups:f}}},{key:"collectBezierCurve",value:function collectBezierCurve(t,i,r,n,s){var o=[],a=2,l=yc(t,Math.pow(r,2)),h=t.length,d=this.calculateDistance(t),u=s-n,p=0;var _iterator263=_createForOfIteratorHelper(l),_step263;try{for(_iterator263.s();!(_step263=_iterator263.n()).done;){var _step263$value=_step263.value,f=_step263$value.curve,m=_step263$value.count;var g=m/h,y=m-a,b=g*d,v=n+p/h*u,w=n+(p+m)/h*u;o.push({point1:f[1],point2:f[2],point3:f[3],cubic:this.cutOffCubic(i,v,w),hiddenPoints:y,distance:b}),p+=m}}catch(err){_iterator263.e(err)}finally{_iterator263.f()}return o}},{key:"calculateDistance",value:function calculateDistance(t){var i=0,r=t[0];for(var n=1;n<t.length;++n){var s=t[n],o=s.x-r.x,a=s.y-r.y;i+=Math.sqrt(Math.pow(o,2)+Math.pow(a,2)),r=s}return i}},{key:"cutOffCubic",value:function cutOffCubic(t,i,r){var n=t;if(i>0||r<1){var s=r-i,o=i,_n46=n,_n47=_slicedToArray(_n46,4),a=_n47[0],l=_n47[1],h=_n47[2],d=_n47[3];n=[a*Math.pow(s,3),3*a*Math.pow(s,2)*o+l*Math.pow(s,2),3*a*Math.pow(o,2)+2*l*o+h*s,a*Math.pow(o,3)+l*Math.pow(o,2),h*Math.pow(o,2)+d]}return n}}],[{key:"isRectIncludes",value:function isRectIncludes(t,i,r,n,s,o){return t>=r&&t<=n&&i>=s&&i<=o}},{key:"scale",value:function scale(t,i){return i===0?1:t/i}}]);return Bs}();var Jo=/*#__PURE__*/function(){function Jo(){_classCallCheck(this,Jo);this.points=[]}_createClass(Jo,[{key:"pushPoint",value:function pushPoint(t,i){return this.points.push({x:t,y:i}),this}},{key:"complete",value:function complete(){return this.points.push(this.points[0]),this}},{key:"transform",value:function transform(t,i,r,n){var s=new Jo;var _iterator264=_createForOfIteratorHelper(this.points),_step264;try{for(_iterator264.s();!(_step264=_iterator264.n()).done;){var _step264$value=_step264.value,o=_step264$value.x,a=_step264$value.y;var l=(o-t)/r,h=(a-i)/n;s.points.push({x:l,y:h})}}catch(err){_iterator264.e(err)}finally{_iterator264.f()}return s}},{key:"externalRectangle",value:function externalRectangle(){var t=Number.MAX_VALUE,i=Number.MAX_VALUE,r=-Number.MAX_VALUE,n=-Number.MAX_VALUE;var _iterator265=_createForOfIteratorHelper(this.points),_step265;try{for(_iterator265.s();!(_step265=_iterator265.n()).done;){var _step265$value=_step265.value,s=_step265$value.x,o=_step265$value.y;t>s&&(t=s),i>o&&(i=o),r<s&&(r=s),n<o&&(n=o)}}catch(err){_iterator265.e(err)}finally{_iterator265.f()}return{originX:t,originY:i,width:r-t,height:n-i}}},{key:"includes",value:function includes(t,i){for(var _r184=1;_r184<this.points.length;++_r184){var n=this.points[_r184-1],s=this.points[_r184],o=s.x-n.x,a=s.y-n.y,l=t-n.x,h=i-n.y;if(o*h-a*l>0)return!1}return!0}}]);return Jo}();var Ap=/*#__PURE__*/function(){function Ap(t){_classCallCheck(this,Ap);this.prePoint=null;this.commiterState=null;this.isPressed=!1;this.applianceManager=t,this.eraser=new Bs(Mp)}_createClass(Ap,[{key:"fireMouseDown",value:function fireMouseDown(t,i,r,n){this.isPressed||(this.commiterState={snapshots:{},modify:{added:{},removed:{},updated:{}}},this.isPressed=!0,this.erase(t,i,r,!1,n),this.prePoint={x:t,y:i})}},{key:"fireMouseMove",value:function fireMouseMove(t,i,r,n){this.isPressed&&(this.erase(t,i,r,!1,n),this.prePoint={x:t,y:i})}},{key:"fireMouseUp",value:function fireMouseUp(t,i,r,n){var s=null;return this.isPressed&&(this.isPressed=!1,this.erase(t,i,r,!0,n),this.commiterState&&(s=this.createCommiter(this.commiterState),this.commiterState=null),this.prePoint=null),s}},{key:"erase",value:function erase(t,i,r,n,s){var o=this.createPolygon(t,i,r),_o$externalRectangle=o.externalRectangle(),a=_o$externalRectangle.originX,l=_o$externalRectangle.originY,h=_o$externalRectangle.width,d=_o$externalRectangle.height,u=this.applianceManager.collectNewPencilCurves(a,l,h,d,s),_this$eraser$erase=this.eraser.erase(u,r,o),p=_this$eraser$erase.updaters,f=_this$eraser$erase.touchProtoKeys;this.searchSnapshotsBeforeUpdate(f,s);var m=this.applianceManager.updateNewPencilCurves(p,t,i,n,s);this.commitModify(m)}},{key:"getEraserSizeIndex",value:function getEraserSizeIndex(t){var i=1;return t&&typeof t.pencilEraserSize=="number"&&(i=t.pencilEraserSize),i=Math.min(3,Math.max(1,Math.floor(i))),i-1}},{key:"createPolygon",value:function createPolygon(t,i,r){var n=new Jo,s=this.applianceManager.getMemberState(),o=this.getEraserSizeIndex(s),a=Ap.eraserSizes[o],l=a.width/r,h=a.height/r,d=t-l/2,u=i-h/2,p,f;this.prePoint?(p=this.prePoint.x-l/2,f=this.prePoint.y-h/2):(p=d,f=u);var m=d-p,g=u-f;return m>0?g>0?n.pushPoint(p,f).pushPoint(p,f+h).pushPoint(d,u+h).pushPoint(d+l,u+h).pushPoint(d+l,u).pushPoint(p+l,f):g<0?n.pushPoint(p,f).pushPoint(p,f+h).pushPoint(d+l,u+h).pushPoint(d+l,u):n.pushPoint(p,f).pushPoint(p,f+h).pushPoint(p+l,f+h).pushPoint(d+l,u+h).pushPoint(d+l,u).pushPoint(d,u):m<0?g>0?n.pushPoint(p,f).pushPoint(d,u).pushPoint(d,u+h).pushPoint(d+l,u+h).pushPoint(p+l,u+h).pushPoint(p+l,f):g<0?n.pushPoint(p+l,f).pushPoint(d+l,u).pushPoint(d,u).pushPoint(d,u+h).pushPoint(p,f+h).pushPoint(p+h,f+h):n.pushPoint(p,f+h).pushPoint(d,u).pushPoint(d,u+h).pushPoint(p+l,f+h):g>0?n.pushPoint(p,f).pushPoint(d,u+h).pushPoint(d+l,u+h).pushPoint(p+l,f):g<0?n.pushPoint(p,f+h).pushPoint(d,u).pushPoint(d+l,u).pushPoint(p+l,f+h):n.pushPoint(p,f).pushPoint(p,f+h).pushPoint(p+l,f+h).pushPoint(p+l,f),n.complete()}},{key:"searchSnapshotsBeforeUpdate",value:function searchSnapshotsBeforeUpdate(t,i){var r=[],_this$commiterState=this.commiterState,n=_this$commiterState.snapshots,_this$commiterState$m=_this$commiterState.modify,s=_this$commiterState$m.added,o=_this$commiterState$m.removed,a=_this$commiterState$m.updated;var _iterator266=_createForOfIteratorHelper(t),_step266;try{for(_iterator266.s();!(_step266=_iterator266.n()).done;){var l=_step266.value;!n[l]&&!s[l]&&!o[l]&&!a[l]&&r.push(l)}}catch(err){_iterator266.e(err)}finally{_iterator266.f()}r.length>0&&this.applianceManager.searchPencilCurves(r,i).forEach(function(h,d){h&&(n[r[d]]=h.snapshotUndo())})}},{key:"commitModify",value:function commitModify(t){var _this$commiterState$m2=this.commiterState.modify,i=_this$commiterState$m2.added,r=_this$commiterState$m2.removed,n=_this$commiterState$m2.updated;for(var s in t.added){i[s]=!0}for(var _s38 in t.removed){i[_s38]?delete i[_s38]:(r[_s38]=!0,delete n[_s38])}for(var _s39 in t.updated){i[_s39]||(n[_s39]=!0)}}},{key:"createCommiter",value:function createCommiter(_ref120){var t=_ref120.modify,i=_ref120.snapshots;var r={},n={},s=this.collectAfterSnapshots(t);for(var o in t.added){r[o]={"delete":!0},n[o]={createCurve:s[o]}}for(var _o33 in t.updated){r[_o33]={updateCurve:i[_o33]},n[_o33]={updateCurve:s[_o33]}}for(var _o34 in t.removed){r[_o34]={createCurve:i[_o34]},n[_o34]={"delete":!0}}return{redo:n,undo:r}}},{key:"collectAfterSnapshots",value:function collectAfterSnapshots(t){var i=[];for(var n in t.added){i.push(n)}for(var _n48 in t.updated){i.push(_n48)}var r={};return this.applianceManager.searchPencilCurves(i).forEach(function(n,s){n&&(r[i[s]]=n.snapshotUndo())}),r}}]);return Ap}(),wc=Ap;wc.eraserSizes=Object.freeze([Object.freeze({width:18,height:26}),Object.freeze({width:26,height:34}),Object.freeze({width:34,height:50})]);var Op=/*#__PURE__*/function(){function Op(t,i,r,n,s,o,a,l,h){var _this308=this;_classCallCheck(this,Op);this._disableKey=!1;this.onReceviedPencilMouseEvent=function(t,i,r){var n;switch(t){case ge.Down:{n=S.MouseDown;break}case ge.Move:{n=S.MouseMove;break}case ge.Up:{n=S.MouseUp;break}case ge.Leave:{n=S.MouseLeave;break}}var s=_this308.bezierPencilAppliance.pushBoundlessMouseEvent(n,r);s&&_this308.undoWatcher&&_this308.undoWatcher.stack.commit(s)};this.onReceivedPencilEraserMouseEvent=function(t,i,_ref121){var r=_ref121.x,n=_ref121.y;switch(t){case ge.Down:{_this308.pencilEraserAppliance.fireMouseDown(r,n,_this308.view.camera.scale,_this308.view.focusSceneId);break}case ge.Move:{_this308.pencilEraserAppliance.fireMouseMove(r,n,_this308.view.camera.scale,_this308.view.focusSceneId);break}case ge.Up:{var _s40=_this308.pencilEraserAppliance.fireMouseUp(r,n,_this308.view.camera.scale,_this308.view.focusSceneId);_s40&&_this308.undoWatcher&&_this308.undoWatcher.stack.commit(_s40);break}}};this.onReceviedOthersMouseEvent=function(t,i,r){var n=null;switch(t){case ge.Down:{n=_this308.magix.trigger.onMouseDown(r,_this308.view.focusSceneId);break}case ge.Move:{n=_this308.magix.trigger.onMouseMove(r,_this308.view.focusSceneId);break}case ge.Up:{n=_this308.magix.trigger.onMouseUp(r,_this308.view.focusSceneId);break}case ge.Leave:{n=_this308.magix.trigger.onMouseLeave(r,_this308.view.focusSceneId);break}}_this308.viewsHub.putState({cursorStyle:_this308.getCursorStyleWithRadius(i)}),n&&_this308.undoWatcher&&_this308.undoWatcher.stack.commit(n)};this.magix=t.magix,this.viewInputsHub=t.viewInputsHub,this.view=t.view,this.viewsHub=t.viewsHub,this.mouseFollower=n,this.pencilKeyInterrupter=r,this.undoWatcher=i,this.getCursorStyleWithRadius=t.getCursorStyleWithRadius,this.onKeyPressed=o,this.onMetaKeyUp=a,this.onTouchPressUpdate=l,this.onWindowBlur=h,this._virtualKeyboardHelper=new Ep(s),this.bezierPencilAppliance=new qr(this.view,this.magix.trigger,t.cameraObserver,t.pencilOptions,t.bezierCurvePainter,t.disablePencilWrittingLimitFrequency,t.newPencilWritingQuality),this.pencilEraserAppliance=new wc(this.magix.trigger),this.pencilKeyInterrupter.setAppliance(this.bezierPencilAppliance),this.input=this.viewInputsHub.bindView(this.view,{onReceviedPencilMouseEvent:this.onReceviedPencilMouseEvent,onReceivedPencilEraserMouseEvent:this.onReceivedPencilEraserMouseEvent,onReceviedOthersMouseEvent:this.onReceviedOthersMouseEvent}),window.addEventListener("blur",this.onWindowBlur)}_createClass(Op,[{key:"disableKey",get:function get(){return this._disableKey},set:function set(t){this._disableKey!==t&&(this._disableKey=t)}},{key:"virtualKeyboardHelper",get:function get(){return this._virtualKeyboardHelper}},{key:"pushEvent",value:function pushEvent(t){this.syncStateOfMouseFollower(t),t.kind===S.SortedTouchStart&&this.onTouchPressUpdate(!0),this.pushAndCallback(t),t.kind===S.SortedTouchEnd&&this.onTouchPressUpdate(!1)}},{key:"syncStateOfMouseFollower",value:function syncStateOfMouseFollower(t){switch(t.kind){case S.MouseDown:{var _t$pointOnScreen=t.pointOnScreen,i=_t$pointOnScreen.x,_r185=_t$pointOnScreen.y;this.mouseFollower.moveMouse(i,_r185);break}case S.MouseMove:{var _t$pointOnScreen2=t.pointOnScreen,_i56=_t$pointOnScreen2.x,_r186=_t$pointOnScreen2.y;this.mouseFollower.moveMouse(_i56,_r186);break}case S.MouseUp:{this.mouseFollower.releaseMouse();break}}}},{key:"pushAndCallback",value:function pushAndCallback(t){switch(t.kind){case S.MouseDown:case S.MouseMove:case S.MouseUp:case S.MouseLeave:case S.SortedTouchStart:case S.SortedTouchMove:case S.SortedTouchEnd:case S.SortedTouchCancel:{this.input.pushEvent(t);break}case S.KeyDown:case S.KeyUp:{this._disableKey||this.onKeyPressed(t);break}case S.MetaKeyUp:{this._disableKey||this.onMetaKeyUp(t.nativeEvent);break}}}},{key:"pushPreEndTouchEvent",value:function pushPreEndTouchEvent(_ref122){var t=_ref122.nativeEvent,i=_ref122.pointOnScreen,r=_ref122.beginPointOnScreen;if(t){var n=0;if(r){var s=r.x-i.x,o=r.y-i.y;n+=Math.sqrt(Math.pow(s,2)+Math.pow(o,2))}this._virtualKeyboardHelper.receivePreEndTouch(t,n)}}},{key:"fireSceneUpdate",value:function fireSceneUpdate(){this.input=this.viewInputsHub.swapInput(this.view)}},{key:"release",value:function release(){window.removeEventListener("blur",this.onWindowBlur),this.pencilKeyInterrupter.setAppliance(null),this.viewInputsHub.unbindView(this.view),this._virtualKeyboardHelper.release(),this.mouseFollower.releaseMouse()}}]);return Op}();var Rp=/*#__PURE__*/function(){function Rp(t){_classCallCheck(this,Rp);this.inputs={};this.outputs={};this.previousId=0;this.pressedInputId="";this.isPressed=!1;this.output=void 0;this.outputSwitch=t}_createClass(Rp,[{key:"createInput",value:function createInput(){var _this309=this;var t="".concat(this.previousId+=1),i=Object.freeze({id:t,pushEvent:function pushEvent(r){return _this309.pushEventByInput(t,r)},dispose:function dispose(){return _this309.removeInput(i)}});return this.inputs[t]={input:i,isPressed:!1},i}},{key:"removeInput",value:function removeInput(t){var r;var i=this.inputs[t.id];if((i==null?void 0:i.input)===t&&(delete this.inputs[t.id],this.pressedInputId===t.id)){this.pressedInputId="",this.isPressed=!1;var n=this.outputSwitch(t),s=this.outputs[n];(r=s==null?void 0:s.onCancel)==null||r.call(s,null,t)}}},{key:"putOutput",value:function putOutput(t,i){this.outputs[t]=i}},{key:"pushEventByInput",value:function pushEventByInput(t,i){var r=this.inputs[t];switch(i.kind){case S.MouseDown:case S.SortedTouchStart:{r.isPressed=!0,this.isPressed=!0,this.pressedInputId===""&&(this.pressedInputId=t,this.pushEvent(r.input,i));break}case S.MouseMove:case S.MouseLeave:case S.SortedTouchMove:{(this.pressedInputId===""&&!r.isPressed||this.pressedInputId===t)&&this.pushEvent(r.input,i);break}case S.MouseUp:case S.SortedTouchEnd:case S.SortedTouchCancel:{this.pressedInputId===t&&(this.pressedInputId="",this.pushEvent(r.input,i)),r.isPressed=!1,this.isPressed=!1;break}}}},{key:"pushEvent",value:function pushEvent(t,i){var s;var r=this.outputSwitch(t),n=this.outputs[r];if(this.output===void 0||this.output!==r){var o=this.output!==void 0?this.outputs[this.output]:void 0;this.output=r,this.isPressed&&((s=o==null?void 0:o.onCancel)==null||s.call(o,i,t),n==null||n.onEvent(i,t))}else n==null||n.onEvent(i,t)}}]);return Rp}();var Cc=.45,Np=4.35,mE=90,Lp=/*#__PURE__*/function(){function Lp(t,i){_classCallCheck(this,Lp);this.deviceType=t;this.screenType=i;this.previousPoint={x:0,y:0};this.previousTimestamp=0;this.currentSpeed=0;this.isPressed=!1}_createClass(Lp,[{key:"radius",value:function radius(t,i,r){switch(this.updatePressed(i,r),this.deviceType){case Ue.Touch:return 36/_o(this.screenType);default:return t===L.eraser?this.getSpeedRaidus():0;}}},{key:"updatePressed",value:function updatePressed(t,i){if(this.isPressed!==i&&(this.isPressed=i,i?(this.previousPoint.x=0,this.previousPoint.y=0,this.previousTimestamp=Date.now(),this.currentSpeed=0):this.currentSpeed=0),i){var _r187=Date.now(),n=t.x-this.previousPoint.x,s=t.y-this.previousPoint.y,o=_r187-this.previousTimestamp,a=o===0?0:Math.sqrt(n*n+s*s)/o;this.previousPoint.x=t.x,this.previousPoint.y=t.y,this.previousTimestamp=_r187,this.currentSpeed=(a+this.currentSpeed)/2}}},{key:"getSpeedRaidus",value:function getSpeedRaidus(){var t=this.currentSpeed;t>Np?t=Np:t<Cc&&(t=Cc);var i=t-Cc,r=Np-Cc;return mE*i/r/_o(this.screenType)}}]);return Lp}();var zi;(function(n){n[n.Hand=0]="Hand",n[n.NewPencil=1]="NewPencil",n[n.PencilEraser=2]="PencilEraser",n[n.Others=3]="Others"})(zi||(zi={}));var Dp=/*#__PURE__*/function(){function Dp(t){var _this310=this;_classCallCheck(this,Dp);this.view2input={};this.input2view={};this.onReceviedPencilMouseEvent=function(t,i,r,n){var s=_this310.input2view[n.id];s&&s.callbacks.onReceviedPencilMouseEvent(t,i,r)};this.onReceivedPencilEraserMouseEvent=function(t,i,r,n){var s=_this310.input2view[n.id];s&&s.callbacks.onReceivedPencilEraserMouseEvent(t,i,r)};this.onReceviedOthersMouseEvent=function(t,i,r,n){var s=_this310.input2view[n.id];s&&s.callbacks.onReceviedOthersMouseEvent(t,i,r)};var i=t.magix,r=t.pencilOptions,n=t.onReceivedHandMouseEvent,s=t.onHandMouseEventCompleted,o=new Lp(t.deviceType,t.screenType),a={isWorking:function isWorking(){return i.phase===j.Connected},getScreen:function getScreen(l){return _this310.viewWithInput(l).screen},getCurrentApplianceName:function getCurrentApplianceName(){return i.trigger.getMemberState().currentApplianceName},getTargetsMap:function getTargetsMap(l,h,d){return _this310.viewWithInput(h).getTargetsMap(l,d)}};this.channel=new Rp(function(){var l=i.trigger.getMemberState().currentApplianceName;return l===L.hand?0:r.shouldUseNewPencil(l)?1:l===L.pencilEraser?2:3}),this.pencilChannel=new Zo(o,a),this.eraserChannel=new Zo(o,a),this.othersChannel=new Zo(o,a),this.pencilChannel.onReceviedMouseEvent=this.onReceviedPencilMouseEvent,this.eraserChannel.onReceviedMouseEvent=this.onReceivedPencilEraserMouseEvent,this.othersChannel.onReceviedMouseEvent=this.onReceviedOthersMouseEvent,this.channel.putOutput(1,this.pencilChannel),this.channel.putOutput(2,this.eraserChannel),this.channel.putOutput(3,this.othersChannel),this.channel.putOutput(0,{onEvent:function onEvent(l,h){return n(_this310.viewWithInput(h),l,h)},onCancel:function onCancel(l,h){return s(_this310.viewWithInput(h))}})}_createClass(Dp,[{key:"bindView",value:function bindView(t,i){var r=this.view2input[t.id];return r||(this.view2input[t.id]=r=this.channel.createInput(),this.input2view[r.id]=Object.freeze({view:t,callbacks:Object.freeze(I({},i))})),r}},{key:"unbindView",value:function unbindView(t){var i=this.view2input[t.id];i&&(delete this.view2input[t.id],delete this.input2view[i.id],i.dispose())}},{key:"swapInput",value:function swapInput(t){var i=this.view2input[t.id];if(!i)throw new Error("unbinded view id=".concat(t.id));var r=this.channel.createInput();return this.input2view[r.id]=this.input2view[i.id],this.view2input[t.id]=r,i.dispose(),delete this.input2view[i.id],r}},{key:"cleanWaitingEvents",value:function cleanWaitingEvents(){this.pencilChannel.cleanWaitingEvents(),this.othersChannel.cleanWaitingEvents()}},{key:"viewWithInput",value:function viewWithInput(t){return this.input2view[t.id].view}}]);return Dp}();var oi=P(require("mobx"));var ei;(function(i){i.SVG="svg",i.Canvas="canvas"})(ei||(ei={}));var pe;(function(r){r.Freedom="freedom",r.Follower="follower",r.Broadcaster="broadcaster"})(pe||(pe={}));var Ac=P(require("mobx"));function kc(e){return e instanceof Ui}function Sw(e){return e instanceof En}function xc(e,t){var i=I({},e),r=!1;for(var n in t){var s=t[n];e[n]!==s&&(i[n]=s,r=!0)}return r?i:null}var ea=/*#__PURE__*/function(){function ea(t){_classCallCheck(this,ea);this._state=Object.freeze(I({},t))}_createClass(ea,[{key:"state",get:function get(){return this._state}},{key:"putState",value:function putState(t){var i=xc(this._state,t),r=!1;if(i){var n=this._state;this._state=Object.freeze(i),this.onStateUpdate(t,n),r=!0}return r}}]);return ea}();var jp=P(require("react-dom")),zp=P(require("react"));function ww(_x158){return _ww.apply(this,arguments)}function _ww(){_ww=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee120(e){var t,i,r,s,n;return regeneratorRuntime.wrap(function _callee120$(_context124){while(1){switch(_context124.prev=_context124.next){case 0:t=3,i=null,r=null;s=0;case 2:if(!(s<t)){_context124.next=19;break}_context124.prev=3;_context124.next=6;return fetch(e);case 6:i=_context124.sent;_context124.next=13;break;case 9:_context124.prev=9;_context124.t0=_context124["catch"](3);r=_context124.t0;return _context124.abrupt("continue",16);case 13:if(!(i.status===200)){_context124.next=15;break}return _context124.abrupt("break",19);case 15:throw new Error("fetch ".concat(JSON.stringify(e)," failed with status ").concat(i.status));case 16:++s;_context124.next=2;break;case 19:if(!r){_context124.next=21;break}throw r;case 21:_context124.next=23;return i.blob();case 23:n=_context124.sent;_context124.next=26;return fE(n);case 26:return _context124.abrupt("return",_context124.sent);case 27:case"end":return _context124.stop();}}},_callee120,null,[[3,9]])}));return _ww.apply(this,arguments)}function fE(_x159){return _fE.apply(this,arguments)}function _fE(){_fE=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee121(e){return regeneratorRuntime.wrap(function _callee121$(_context125){while(1){switch(_context125.prev=_context125.next){case 0:return _context125.abrupt("return",window.createImageBitmap?window.createImageBitmap(e):new Promise(function(t,i){var r=URL.createObjectURL(e),n=document.createElement("img");n.addEventListener("load",function(){URL.revokeObjectURL(n.src),t(n)}),n.src=r}));case 1:case"end":return _context125.stop();}}},_callee121)}));return _fE.apply(this,arguments)}var ti=P(require("mobx"));var Cw=P(require("react"));var Bp=/*#__PURE__*/function(){function Bp(){_classCallCheck(this,Bp)}_createClass(Bp,[{key:"createCursor",value:function createCursor(){return{x:0,y:0,width:0,height:0}}},{key:"onAddedCursor",value:function onAddedCursor(t){var i=t.cursorMember.appliance,r=0,n=0,s=0,o=0,a="";switch(i){case L.laserPointer:{r=14,n=14,s=28,o=28,a=q["laser-pointer-cursor"];break}case L.eraser:{r=8,n=18,s=26,o=26,a=q["eraser-cursor@2x"];break}case L.pencilEraser:{var l=t.eraserSize;switch(typeof l!="number"&&(l=1),l=Math.min(3,Math.max(1,Math.floor(l))),a=q["pencil-eraser-"+l],l){case 1:{r=9,n=13,s=18,o=26;break}case 2:{r=13,n=17,s=26,o=34;break}case 3:{r=17,n=25,s=34,o=50;break}}break}}t.setCursorDescription({x:r,y:n,width:s,height:o}),t.setReactNode(Cw.createElement("img",{alt:"self-cursor",width:s,height:o,src:a}))}}]);return Bp}();var kw=P(require("mobx"));var Fp=/*#__PURE__*/function(){function Fp(t){var _this311=this;_classCallCheck(this,Fp);this.eraserSize=void 0;this.reactNode=null;this.onCursorComponentChanged=function(t){_this311.cursorComponent=t,t?_this311.adapter.onAddedCursor&&_this311.adapter.onAddedCursor(_this311):_this311.adapter.onRemovedCursor&&_this311.adapter.onRemovedCursor(_this311)};this.onComponentMoved=function(){if(_this311.adapter.onMovingCursor){var _t18=_this311.component.originX+_this311._x+_this311.screen.width/2,_i57=_this311.component.originY+_this311._y+_this311.screen.height/2;_this311.adapter.onMovingCursor(_this311,_t18,_i57)}};this.idPrefix=t.idPrefix,this.applianceManager=t.applianceManager,this.adapter=t.adapter,this.screen=t.screen,this.memberId=t.memberId,this._cursorMember=t.cursorMember;var i=this.adapter.createCursor(this.memberId);this._x=i.x,this._y=i.y,this._width=i.width,this._height=i.height,this.reactNode=i.reactNode||null,this.component=this.screen.scene.addComponent({id:this.idPrefix+this.memberId,definition:t.cursorDefinition,originX:t.point.x-this._x,originY:t.point.y-this._y,width:i.width,height:i.height,orderIndex:this.memberId,absoluteCoordinates:!0,payload:{reactNode:this.reactNode,onCursorComponentChanged:this.onCursorComponentChanged}}),this.adapter.onMovingCursor&&this.component.addRectangleUpdatedListener(this.onComponentMoved)}_createClass(Fp,[{key:"cursorMember",get:function get(){return this._cursorMember}},{key:"setCursorMember",value:function setCursorMember(t){var i;this._cursorMember&&!dr(this._cursorMember,t)&&(this._cursorMember=t,(i=this.onCursorMemberChanged)==null||i.call(this,this._cursorMember))}},{key:"remove",value:function remove(){this.screen.scene.removeComponent(this.component),this.adapter.onMovingCursor&&this.component.removeRectangleUpdatedListener(this.onComponentMoved)}},{key:"x",get:function get(){return this._x}},{key:"y",get:function get(){return this._y}},{key:"width",get:function get(){return this._width}},{key:"height",get:function get(){return this._height}},{key:"divElement",get:function get(){if(!this.cursorComponent)throw new Error("cursor isn't added");return this.cursorComponent.divElement}},{key:"setReactNode",value:function setReactNode(t){this.reactNode=t,this.component.payload={reactNode:t,onCursorComponentChanged:this.onCursorComponentChanged}}},{key:"setCursorDescription",value:function setCursorDescription(t){var i=I({x:this._x,y:this._y,width:this._width,height:this._height},t),r=this._x-i.x,n=this._y-i.y;this.component.setRectangle(this.component.originX+r,this.component.originY+n,i.width,i.height),this._x=i.x,this._y=i.y,this._width=i.width,this._height=i.height}}]);return Fp}();var Pc=/*#__PURE__*/function(){function Pc(t){var _this312=this;_classCallCheck(this,Pc);this.didMouseCursorMoved=!1;this.inactivityTimer=null;this.shouldAppearNextFrame=!0;this.cursor=null;this.disposer=null;this.refreshState=function(){var t=_this312.getCursorState(_this312.memberId),i=_this312.applianceManager.getViewState(_this312.memberId);t&&i&&_this312.willShow(_this312.applianceManager,t)?_this312.cursor?_this312.refreshCursorVisibleState(t,i,_this312.cursor):_this312.cursor=_this312.createCursor(t):_this312.cursor&&(_this312.removeCursor(_this312.cursor),_this312.cursor=null)};this.applianceManager=t.applianceManager,this.cursorDefinition=t.cursorDefinition,this.screen=t.screen,this.engine=t.engine,this.idPrefix=t.idPrefix,this.memberId=t.memberId,this.adapter=t.adapter,this.willShow=t.willShow,this.isFollowerFixedOnScreen=t.isFollowerFixedOnScreen,this.getOverridePoint=t.getOverridePoint,this.refreshAutorun(),this.refreshIsVisible()}_createClass(Pc,[{key:"isVisible",get:function get(){return this.isCursorInScene&&this.isKeepVisible}},{key:"getCursorState",value:function getCursorState(t){if(!this.applianceManager.getCursorState)return this.getCursorStateLegacy(t);var i=this.applianceManager.getCursorState(t),r=this.getOverridePoint(t);if(r){var _this$applianceManage=this.applianceManager.getViewState(t),n=_this$applianceManage.originX,s=_this$applianceManage.originY,o=_this$applianceManage.width,a=_this$applianceManage.height,l=r.x,h=r.y;return o===0?l=.5:l=(l-n)/o,a===0?h=.5:h=(h-s)/a,D(I({},i),{cursorX:l,cursorY:h,isPressed:!0,isActivity:!0,isCursorInScene:!0})}else return i}},{key:"getCursorStateLegacy",value:function getCursorStateLegacy(t){var i;var _iterator267=_createForOfIteratorHelper(this.applianceManager.getMemberDisplayers()),_step267;try{for(_iterator267.s();!(_step267=_iterator267.n()).done;){var _r188=_step267.value;if(_r188.memberId===t){i={deviceType:_r188.deviceType,isPressed:_r188.isPressed,isActivity:_r188.isActivity,isCursorInScene:_r188.isCursorInScene,currentApplianceName:_r188.currentApplianceName,color:_r188.color,cursorX:_r188.cursorX,cursorY:_r188.cursorY};break}}}catch(err){_iterator267.e(err)}finally{_iterator267.f()}return i}},{key:"refreshCursorVisibleState",value:function refreshCursorVisibleState(t,i,r){this.setPositionProperties(t,i),this.setVisibleProperties(t),this.refreshComponentPosition(),t.currentApplianceName===L.pencilEraser?r.eraserSize=t.eraserSize:r.eraserSize=void 0,r.setCursorMember({appliance:t.currentApplianceName,color:t.color,information:this.applianceManager.getInformationWithMemberId(this.memberId)})}},{key:"createCursor",value:function createCursor(t){return this.isCursorInScene=t.isCursorInScene,this.isPressed=t.isPressed,this.isActivity=t.isActivity,this.isKeepVisible=t.isActivity,this.cursorX=t.cursorX,this.cursorY=t.cursorY,this.latestCheckedCursorX=this.cursorX,this.latestCheckedCursorY=this.cursorY,new Fp({idPrefix:this.idPrefix,memberId:this.memberId,applianceManager:this.applianceManager,cursorDefinition:this.cursorDefinition,screen:this.screen,adapter:this.adapter,point:this.getCurrentComponentPosition(),cursorMember:{color:t.color,appliance:t.currentApplianceName}})}},{key:"removeCursor",value:function removeCursor(t){this.cleanInactivityDelayer(),t.remove()}},{key:"updateScreenSize",value:function updateScreenSize(){this.refreshComponentPosition()}},{key:"refreshAutorun",value:function refreshAutorun(){this.disposer&&this.disposer(),this.disposer=(0,kw.autorun)(this.refreshState)}},{key:"dispose",value:function dispose(){this.disposer&&(this.disposer(),this.disposer=null),this.cursor&&(this.removeCursor(this.cursor),this.cursor=null)}},{key:"setPositionProperties",value:function setPositionProperties(t,i){if(this.mode=i.mode,this.originX=i.originX,this.originY=i.originY,this.cursorX=t.cursorX,this.cursorY=t.cursorY,this.width=i.width,this.height=i.height,this.didMouseCursorMoved)this.latestCheckedCursorX=this.cursorX,this.latestCheckedCursorY=this.cursorY;else{var _r189=hw,n=this.width===0?1:this.screen.width/this.width,s=this.height===0?1:this.screen.height/this.height,o=(this.cursorX-this.latestCheckedCursorX)*this.width*n,a=(this.cursorY-this.latestCheckedCursorY)*this.height*s;o*o+a*a>=_r189*_r189&&(this.didMouseCursorMoved=!0,this.latestCheckedCursorX=this.cursorX,this.latestCheckedCursorY=this.cursorY)}}},{key:"setVisibleProperties",value:function setVisibleProperties(t){var i=this.isActivity;this.isCursorInScene=t.isCursorInScene,this.isPressed=t.isPressed,this.isActivity=t.isActivity,i&&!this.isActivity?(this.delayInactivity(),this.checkMouseCursorMoved()):!i&&this.isActivity?(this.cleanInactivityDelayer(),this.isKeepVisible=!0):!this.isActivity&&this.checkMouseCursorMoved()&&this.delayInactivity(),this.refreshIsVisible()}},{key:"refreshComponentPosition",value:function refreshComponentPosition(){var t;if(this.isVisible){var i=this.getCurrentComponentPosition(),_r190=this.getNextAnimationMode();(t=this.cursor)==null||t.component.moveTo(i.x-this.cursor.x,i.y-this.cursor.y,_r190)}}},{key:"getNextAnimationMode",value:function getNextAnimationMode(){return this.shouldAppearNextFrame?(this.shouldAppearNextFrame=!1,$.Immediately):this.isPressed?$.Immediately:$.Continuous}},{key:"getCurrentComponentPosition",value:function getCurrentComponentPosition(){var t,i;if(this.isFollowerFixedOnScreen(this.applianceManager)&&this.mode!==pe.Freedom){var _r191=this.width===0?1:this.screen.width/this.width,n=this.height===0?1:this.screen.height/this.height,s=Math.min(_r191,n),o=(this.screen.width-s*this.width)/2,a=(this.screen.height-s*this.height)/2;t=this.cursorX*this.width*s+o-this.screen.width/2,i=this.cursorY*this.height*s+a-this.screen.height/2}else{var _this$screen$camera3=this.screen.camera,_r192=_this$screen$camera3.centerX,_n49=_this$screen$camera3.centerY,_s41=_this$screen$camera3.scale;t=this.cursorX*this.width+this.originX,i=this.cursorY*this.height+this.originY,t=(t-_r192)*_s41,i=(i-_n49)*_s41}return{x:t,y:i}}},{key:"checkMouseCursorMoved",value:function checkMouseCursorMoved(){return this.didMouseCursorMoved?(this.didMouseCursorMoved=!1,!0):!1}},{key:"cleanInactivityDelayer",value:function cleanInactivityDelayer(){this.inactivityTimer!==null&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null)}},{key:"delayInactivity",value:function delayInactivity(){var _this313=this;this.inactivityTimer!==null&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null),this.isActivity||(this.isKeepVisible=!0,this.refreshIsVisible(),this.inactivityTimer=setTimeout(function(){_this313.isKeepVisible=!1,_this313.inactivityTimer=null,_this313.refreshIsVisible()},cw))}},{key:"refreshIsVisible",value:function refreshIsVisible(){var i;var t=this.isVisible;t||(this.shouldAppearNextFrame=!0),(i=this.cursor)==null||i.component.setVisible(this.engine,t)}}]);return Pc}();var Ic=P(require("react"));var Mc=/*#__PURE__*/function(_Ic$Component){_inherits(Mc,_Ic$Component);var _super95=_createSuper(Mc);function Mc(){var _this314;_classCallCheck(this,Mc);_this314=_super95.apply(this,arguments);_this314.onRef=function(t){var i=_this314.props.payload;if(!_this314._divElement&&t)_this314._divElement=t,i.onCursorComponentChanged(_assertThisInitialized(_this314));else if(_this314._divElement&&!t)try{i.onCursorComponentChanged(null)}finally{_this314._divElement=t}};return _this314}_createClass(Mc,[{key:"divElement",get:function get(){return this._divElement}},{key:"render",value:function render(){var _this$props104=this.props,t=_this$props104.cnode,i=_this$props104.size,r=_this$props104.payload;return Ic.createElement(Oi,{context:t,onRef:this.onRef,style:i},r.reactNode)}}]);return Mc}(Ic.Component);Mc.isVisible=!1;var Tc=/*#__PURE__*/function(){function Tc(t){var _this315=this;_classCallCheck(this,Tc);this.nodes={};this._isHidden=!1;this._showBuiltin=!1;this.getOverridePoint=function(t){return _this315.overrideCurves.get("".concat(t))};this.onAddedMember=function(t,i){var r=new Pc({memberId:i,idPrefix:"laser-pointer-",adapter:_this315.builtinPointerCursorAdapter,applianceManager:t,cursorDefinition:_this315.cursorDefinition,engine:_this315.engine,screen:_this315.screen,isFollowerFixedOnScreen:_this315.isFollowerFixedOnScreen,getOverridePoint:_this315.getOverridePoint,willShow:function willShow(s,o){switch(o.currentApplianceName){case L.laserPointer:return _this315.enableLaser&&i!==_this315.observerId||_this315._showBuiltin;case L.eraser:case L.pencilEraser:return i===_this315.observerId&&_this315._showBuiltin;default:return!1;}}}),n;_this315.cursorAdapter&&(n=new Pc({memberId:i,idPrefix:"cursor-",adapter:_this315.cursorAdapter,applianceManager:t,cursorDefinition:_this315.cursorDefinition,engine:_this315.engine,screen:_this315.screen,isFollowerFixedOnScreen:_this315.isFollowerFixedOnScreen,getOverridePoint:_this315.getOverridePoint,willShow:function willShow(s,o){return i!==_this315.observerId&&o.currentApplianceName!==L.laserPointer}})),_this315.nodes[i]={builtinPointer:r,cursor:n}};this.onRemovedMember=function(t,i){var n;var r=_this315.nodes[i];r&&(delete _this315.nodes[i],r.builtinPointer.dispose(),(n=r.cursor)==null||n.dispose())};this.onRefreshed=function(){var t;for(var i in _this315.nodes){var _r193=_this315.nodes[i];_r193.builtinPointer.refreshAutorun(),(t=_r193.cursor)==null||t.refreshAutorun()}};this.isFollowerFixedOnScreen=function(t){var i=t.getViewState(_this315.observerId);return i?i.mode===pe.Broadcaster||i.mode===pe.Follower:!1};this.screen=t.screen,this.members=t.members,this.engine=this.getMouseCursorEngine(t.appVersion,t.engine),this.observerId=t.observerId,this.cursorAdapter=t.adapter,this._isHidden=t.isHidden,this.enableLaser=t.enableLaser,this.builtinPointerCursorAdapter=new Bp,this.overrideCurves=ti.observable.map({}),this.cursorDefinition=vo({name:"Cursor"}),this.engine.bind(this.cursorDefinition)(Mc),this.members.forEach(this.onAddedMember),this.members.callbacks.on("onAdded",this.onAddedMember),this.members.callbacks.on("onRemoved",this.onRemovedMember),this.members.callbacks.on("onRefreshed",this.onRefreshed),(0,ti.makeObservable)(this,{observerId:ti.observable,_isHidden:ti.observable,_showBuiltin:ti.observable,setHidden:ti.action,setShowBuiltin:ti.action,updateObserverId:ti.action,putOverrideCursor:ti.action,removeOverrideCursors:ti.action})}_createClass(Tc,[{key:"isHidden",get:function get(){return this._isHidden}},{key:"setHidden",value:function setHidden(t){this._isHidden!==t&&(this._isHidden=t)}},{key:"showBuiltin",get:function get(){return this._showBuiltin}},{key:"setShowBuiltin",value:function setShowBuiltin(t){this._showBuiltin!==t&&(this._showBuiltin=t)}},{key:"updateObserverId",value:function updateObserverId(t){this.observerId=t}},{key:"updateScreenSize",value:function updateScreenSize(){var t;for(var i in this.nodes){var _r194=this.nodes[i];_r194.builtinPointer.updateScreenSize(),(t=_r194.cursor)==null||t.updateScreenSize()}}},{key:"putOverrideCursor",value:function putOverrideCursor(t,i,r){this.overrideCurves.set("".concat(t),{x:i,y:r})}},{key:"removeOverrideCursors",value:function removeOverrideCursors(t){this.overrideCurves["delete"]("".concat(t))}},{key:"release",value:function release(){var t,i;this.members.callbacks.off("onAdded",this.onAddedMember),this.members.callbacks.off("onRemoved",this.onRemovedMember),this.members.callbacks.off("onRefreshed",this.onRefreshed);for(var _r195 in this.nodes){var n=this.nodes[_r195];(t=n.builtinPointer)==null||t.dispose(),(i=n.cursor)==null||i.dispose(),delete this.nodes[_r195]}}},{key:"getMouseCursorEngine",value:function getMouseCursorEngine(t,i){if(i)return i;switch(t){case"2.0.0":return this.screen.scene.getEngineWithLegacyLayout(4);case"2.1.0":return this.screen.scene.getEngineWithLegacyLayout(5);default:throw new Error("invalid app version "+t);}}}]);return Tc}();function xw(e,t){var i=document.createElement("canvas");return i.width=e,i.height=t,i.toDataURL("screenshot")}var Ec=/*#__PURE__*/function(){function Ec(t,i,r,n,s,o){var _this316=this;_classCallCheck(this,Ec);this.screenshotEngines={};this._maskScreenObserverId=!0;this.onScreenSizeUpdated=function(t){_this316.cameraBoundState.setScreenSize(t),_this316._cursors&&_this316._cursors.updateScreenSize(),_this316.render.refreshSceneComponents(),_this316._onScreenSizeUpdated&&_this316._onScreenSizeUpdated(t)};this.updateCursorClassBySelector=function(t){if(_this316.applianceManager){var _i58=_this316.applianceManager.getMemberState();_i58&&_i58.currentApplianceName===L.selector&&_this316.updateCursorClass(t)}};this.reportCurveTailUpdate=function(t,i,r){var n;(n=_this316._cursors)==null||n.putOverrideCursor(t,i,r)};this.reportCurveComplete=function(t){var i;(i=_this316._cursors)==null||i.removeOverrideCursors(t)};this.interruptEvent=function(t){var i=!1;return _this316.eventInterrupter&&(i=_this316.eventInterrupter(t)),_this316.view.handleNativeEvent(t),i};var f;var a=r.modules,_a$WhiteRender=a.WhiteRender,l=_a$WhiteRender.cleanCurveAnimes,h=_a$WhiteRender.WhiteboardRender;this.engines=r.engines,this.modules=r.modules,this.pluginManager=r.pluginManager,this.applianceManager=r.applianceManager,this.enableAssignScene=!!this.applianceManager.enableAssignScene,this.members=r.members,this.dynamicPpt=r.dynamicPpt,this.bezierCurvePainter=r.bezierCurvePainter,this.view=t,this._isCursorsHidden=s,this.observerId=i.observerId,this.mouseFollower=n.mouseFollowerHub.createMouseFollower();var d=this.applianceManager.getViewState(),u=this.createScene(n.boundless,n.logger,n.renderEngine,a),p=Object.freeze(D(I({},i),{view:t,icons:q,observerId:this.screenObserverId(i),deviceType:n.boundless.deviceType,dynamicPpt:this.dynamicPpt,disalbeImageHit:!1,disableOthersSelectingBox:!1,pluginManager:this.pluginManager,bezierCurvePainter:this.bezierCurvePainter,mouseFollower:this.mouseFollower,fontFamily:n.fontFamily,convertIdToUrl:n.urlInterrupter,updateTextarea:t.updateTextarea,updateCursorClass:this.updateCursorClassBySelector,enableSelfCurveAnime:n.enableSelfCurveAnime,enableCurveAnimes:!n.disableCurveAnimes,enableRotation:!n.disableRotation,enableVectorOperator:!0,disableNewPencilStroke:n.disableNewPencilStroke,reportCurveTailUpdate:this.reportCurveTailUpdate,reportCurveComplete:this.reportCurveComplete,floatBarClass:n.floatBarClass,textareaHub:t.textareaHub}));if(this.screen=u.createScreen({className:"netless-whiteboard",context:p,engines:(f=this.engines)==null?void 0:f.enginesList,autoResize:n.autoResize,eventInterrupter:this.interruptEvent,wrappedComponents:n.wrappedComponents,onRenderDuration:function onRenderDuration(m){return _this316.view.fireRenderDuration(m)}}),this.mouseFollower.initScreen(this.screen),this.eventInterrupter=n.eventInterrupter,this.onCatchErrorWhenRender=n.onCatchErrorWhenRender,this._onScreenSizeUpdated=n.onScreenSizeUpdated,n.onCatchErrorWhenRender&&this.screen.addRenderErrorCatchedListener(n.onCatchErrorWhenRender),this.screen.addSizeUpdatedListener(this.onScreenSizeUpdated),o){var m=o.cameraBoundState;this.cameraBoundState=new pc(this.screen,m.cameraBound),this.cameraBoundState.cameraman.disableBoundlessEvent=m.cameraman.disableBoundlessEvent,this.cameraBoundState.cameraman.disableCameraTransform=m.cameraman.disableCameraTransform,this.cameraBoundState.cameraman.handToolKey=m.cameraman.handToolKey}else this.cameraBoundState=new pc(this.screen,n.cameraBound),this.cameraBoundState.cameraman.disableBoundlessEvent=n.disableOperations,this.cameraBoundState.cameraman.handToolKey=n.handToolKey;this.cameraBoundState.cameraman.adaptRectangle({originX:d.originX,originY:d.originY,width:d.width,height:d.height,adapterMode:mi.Centering,animationMode:$.Immediately}),this.cleanCurveAnimes=l,this.render=new h(this.screen,this.pluginManager,this.applianceManager,this.engines),this.setupViewContextState(t.state),setTimeout(function(){var m;_this316._cursors=new Tc({appVersion:r.appVersion,members:_this316.members,screen:_this316.screen,engine:(m=_this316.engines)==null?void 0:m.engines.mouseCurosrEngine,observerId:_this316.observerId,isHidden:_this316._isCursorsHidden,enableLaser:n.enableLaser,adapter:n.cursorAdapter})},0)}_createClass(Ec,[{key:"isCursorsHidden",get:function get(){return this._isCursorsHidden},set:function set(t){this._isCursorsHidden!==t&&(this._isCursorsHidden=t,this._cursors&&this._cursors.setHidden(this._isCursorsHidden))}},{key:"maskFloatBar",get:function get(){return this.render.maskFloatBar},set:function set(t){this.render.maskFloatBar=t}},{key:"cursors",get:function get(){return this._cursors}},{key:"updateState",value:function updateState(t){"cameraBound"in t&&this.cameraBoundState.setCameraBound(t.cameraBound),this.syncCameraMoving(t.cameraMoving),"disableCameraTransform"in t&&(this.cameraman.disableCameraTransform=t.disableCameraTransform),"handToolActive"in t&&(this.cameraman.handToolActive=t.handToolActive),"handToolKey"in t&&(this.cameraman.handToolKey=t.handToolKey),"divElement"in t&&(this.screen.divElement=t.divElement)}},{key:"syncCameraMoving",value:function syncCameraMoving(t){if(t){var i=t.camera,_r196=t.toContaint;if(i){var n=i.animationMode||$.Continuous;this.cameraman.transformCamera(D(I({},i),{animationMode:n}))}else if(_r196){var _n50=_r196.animationMode||$.Continuous;this.cameraman.adaptRectangle(D(I({},_r196),{animationMode:_n50,adapterMode:mi.Centering}))}}}},{key:"setupViewContextState",value:function setupViewContextState(t){this.cameraBoundState.setCameraBound(t.cameraBound),this.syncCameraMoving(t.cameraMoving),this.cameraman.transformCamera(D(I({},t.cameraMoving),{animationMode:$.Immediately})),this.cameraman.disableCameraTransform=t.disableCameraTransform,this.cameraman.handToolActive=t.handToolActive,this.cameraman.handToolKey=t.handToolKey,this.screen.divElement=t.divElement}},{key:"createScene",value:function createScene(t,i,r,_ref123){var n=_ref123.WhiteRender;if(n.createLayoutDescriptions){var s=n.createLayoutDescriptions(r);return t.createSceneWithLegacyLayoutDescriptions(s,i)}else return t.createScene(i)}},{key:"scenePath",get:function get(){return"/"+this.applianceManager.getCurrentScenePath().join("/")}},{key:"foucsScenePath",get:function get(){return this.render.foucsScenePath},set:function set(t){this.render.foucsScenePath=t}},{key:"cameraman",get:function get(){return this.cameraBoundState.cameraman}},{key:"maskScreenObserverId",get:function get(){return this._maskScreenObserverId},set:function set(t){this._maskScreenObserverId!==t&&(this._maskScreenObserverId=t,this.screen.context=Object.freeze(D(I({},this.screen.context),{observerId:t?ce:this.observerId})))}},{key:"sceneIdentifier",value:function sceneIdentifier(t){var i=te.parse(t),r=this.applianceManager.scenes.getScene(i);return r==null?void 0:r.id}},{key:"setCommonScreenContext",value:function setCommonScreenContext(t){var n;var i=this.observerId,r=t.observerId;this.screen.context=Object.freeze(D(I(I({},this.screen.context),t),{observerId:this.screenObserverId(t)})),i!==r&&(this.observerId=r,(n=this._cursors)==null||n.updateObserverId(r))}},{key:"setCameraBound",value:function setCameraBound(t){this.cameraBoundState.setCameraBound(t)}},{key:"resizeScreen",value:function resizeScreen(){this.screen.resize()}},{key:"refreshRender",value:function refreshRender(){this.render.refreshSceneComponents()}},{key:"fireReloadLibrary",value:function fireReloadLibrary(){this.render.rebuildSceneRender&&this.render.rebuildSceneRender(),this.stopCurveAnimesAndRemoveOverrideCursors()}},{key:"refreshCameraToFocus",value:function refreshCameraToFocus(){var _this$applianceManage2=this.applianceManager.getViewState(),t=_this$applianceManage2.originX,i=_this$applianceManage2.originY,r=_this$applianceManage2.width,n=_this$applianceManage2.height,s={originX:t,originY:i,width:r,height:n};this.screen.adaptRectangle(D(I({},s),{animationMode:$.Continuous,adapterMode:mi.Centering}))}},{key:"getTargetsMap",value:function getTargetsMap(_ref124,r){var t=_ref124.component,i=_ref124.engine;var n=this.modules.WhiteModel.ApplianceComponent,s;return Ye(t.payload,n)&&(this.render.getTargetsMap?s=this.render.getTargetsMap(t,r):s=this.render.findTargetsMap(t.id,i.orderIndex,r)),s}},{key:"cleanScreen",value:function cleanScreen(){var t;(t=this.render)==null||t.clean()}},{key:"release",value:function release(){var t;this.onCatchErrorWhenRender&&this.screen.removeRenderErrorCatchedListener(this.onCatchErrorWhenRender),this.screen.removeSizeUpdatedListener(this.onScreenSizeUpdated),(t=this._cursors)==null||t.release(),this.render.release(),this.cameraBoundState.cameraman.release(),this.mouseFollower.release()}},{key:"scenePreview",value:function scenePreview(t,i,r,n,s){var _this$modules$WhiteRe=this.modules.WhiteRender,o=_this$modules$WhiteRe.screenshot,a=_this$modules$WhiteRe.EnginesHub;if(o){var l=s||ei.SVG;this.screenshotEngines[l]||(this.screenshotEngines[l]=a&&new a(l));var h=te.parse(t),d=this.screen,u=r,p=n;u=typeof u!="number"?i.clientWidth:u,p=typeof p!="number"?i.clientHeight:p;var f=1;d.width!==0&&d.height!==0&&(f=Math.min(u/d.width,p/d.height)*d.camera.scale);var m={centerX:d.camera.centerX,centerY:d.camera.centerY,scale:f},g=o({applianceManager:this.applianceManager,engines:this.screenshotEngines[l],pluginManager:this.pluginManager,bezierCurvePainter:this.bezierCurvePainter,width:u,height:p,path:h,camera:m});if((0,zp.isValidElement)(g))jp.render(g,i);else throw new Error("scene preview must render ReactElement")}}},{key:"fillSceneSnapshot",value:function fillSceneSnapshot(t,i,r,n,s){var _this$modules$WhiteRe2=this.modules.WhiteRender,o=_this$modules$WhiteRe2.screenshot,a=_this$modules$WhiteRe2.EnginesHub;if(o){var l=s||ei.SVG;this.screenshotEngines[l]||(this.screenshotEngines[l]=a&&new a(l));var h=te.parse(t),d=r,u=n;d=typeof d!="number"?i.clientWidth:d,u=typeof u!="number"?i.clientHeight:u;var p=o({applianceManager:this.applianceManager,engines:this.screenshotEngines[l],pluginManager:this.pluginManager,bezierCurvePainter:this.bezierCurvePainter,fontFamily:this.screen.context.fontFamily,width:d,height:u,path:h});if((0,zp.isValidElement)(p))jp.render(p,i);else throw new Error("scene preview must render ReactElement")}}},{key:"screenshotToCanvas",value:function screenshotToCanvas(t,i,r,n,s,o){var _this$modules$WhiteRe3=this.modules.WhiteRender,a=_this$modules$WhiteRe3.screenshotToCanvas,l=_this$modules$WhiteRe3.EnginesHub;if(a){var h=ei.Canvas;this.screenshotEngines[h]||(this.screenshotEngines[h]=l&&new l(h));var d=te.parse(i),u={applianceManager:this.applianceManager,engines:this.screenshotEngines[h],pluginManager:this.pluginManager,bezierCurvePainter:this.bezierCurvePainter,fontFamily:this.screen.context.fontFamily,width:r,height:n,camera:s,path:d};a(u,t,o)}}},{key:"getBoundingRect",value:function getBoundingRect(t){var _this$modules$WhiteRe4=this.modules.WhiteRender,i=_this$modules$WhiteRe4.getBoundingRect,r=_this$modules$WhiteRe4.EnginesHub;if(i){var n=ei.Canvas;this.screenshotEngines[n]||(this.screenshotEngines[n]=r&&new r(n));var s=te.parse(t),o={applianceManager:this.applianceManager,engines:this.screenshotEngines[n],pluginManager:this.pluginManager,width:0,height:0,path:s};return i(o)}return{originX:0,originY:0,width:0,height:0}}},{key:"generateScreenshot",value:function(){var _generateScreenshot=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee88(t,i,r){var n,o,s;return regeneratorRuntime.wrap(function _callee88$(_context92){while(1){switch(_context92.prev=_context92.next){case 0:if(t){o=te.parse(t);n=this.applianceManager.scenes.getScene(o)}else n=this.applianceManager.scene;if(n){_context92.next=3;break}throw new Error("cannot find scene with path ".concat(JSON.stringify(t)));case 3:s=this.findBackgroundImage(n);if(!s){_context92.next=10;break}_context92.next=7;return this.generateImage(s,i,r);case 7:_context92.t0=_context92.sent;_context92.next=11;break;case 10:_context92.t0=xw(1,1);case 11:return _context92.abrupt("return",_context92.t0);case 12:case"end":return _context92.stop();}}},_callee88,this)}));function generateScreenshot(_x160,_x161,_x162){return _generateScreenshot.apply(this,arguments)}return generateScreenshot}()},{key:"findBackgroundImage",value:function findBackgroundImage(t){var i=this.modules.WhiteModel.BackgroundImage;for(var _r197=0;_r197<t.componentsLength;++_r197){var n=t.componentAt(_r197);if(Ye(n,i))return n}return null}},{key:"generateImage",value:function(){var _generateImage=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee89(t,i,r){var n,s,o,a,h,d,u,p,f,m,g,l;return regeneratorRuntime.wrap(function _callee89$(_context93){while(1){switch(_context93.prev=_context93.next){case 0:n=document.createElement("canvas"),s=i,o=r;s===void 0&&(s=t.width),o===void 0&&(o=t.height),n.width=s,n.height=o;a=t.previewURL;if(!(!a&&/^https?:\/\//im.test(t.src)&&(a=t.src),a)){_context93.next=14;break}_context93.next=6;return ww(a);case 6:h=_context93.sent;d=n.getContext("2d");u=Math.min(s/t.width,o/t.height);p=t.width*u;f=t.height*u;m=(s-p)/2;g=(o-f)/2;d.drawImage(h,m,g,p,f);case 14:_context93.next=16;return new Promise(function(h){return n.toBlob(function(d){return h(d)})});case 16:l=_context93.sent;return _context93.abrupt("return",URL.createObjectURL(l));case 18:case"end":return _context93.stop();}}},_callee89)}));function generateImage(_x163,_x164,_x165){return _generateImage.apply(this,arguments)}return generateImage}()},{key:"stopCurveAnimesAndRemoveOverrideCursors",value:function stopCurveAnimesAndRemoveOverrideCursors(){if(this.cleanCurveAnimes){var t=this.cleanCurveAnimes();if(this._cursors){var _iterator268=_createForOfIteratorHelper(t),_step268;try{for(_iterator268.s();!(_step268=_iterator268.n()).done;){var i=_step268.value;this._cursors.removeOverrideCursors(i)}}catch(err){_iterator268.e(err)}finally{_iterator268.f()}}}}},{key:"updateCursorClass",value:function updateCursorClass(t){t!==null?this.screen.className="netless-whiteboard "+t:this.screen.className="netless-whiteboard"}},{key:"updateCursorStyle",value:function updateCursorStyle(t){t===null?this.screen.style=void 0:this.screen.style={cursor:t}}},{key:"screenObserverId",value:function screenObserverId(_ref125){var t=_ref125.observerId;return this._maskScreenObserverId?ce:t}}]);return Ec}();var Pw=P(require("mobx"));var Up=/*#__PURE__*/function(){function Up(t,i,r,n){var _this317=this;_classCallCheck(this,Up);var s;this.scenePath=t,this.applianceManager=i,this.isWritable=r,this.disposer=(0,Pw.autorun)(function(){var o=_this317.applianceManager.scenes,a=te.parse(t),l=o.getScene(a);s?_this317.onSceneUpdate(l):s=l}),s||this.disposer(),this.onBecomeInvlaid=n,this.focusScene=s}_createClass(Up,[{key:"isValid",get:function get(){return!!this.focusScene}},{key:"identifier",get:function get(){var t;return(t=this.focusScene)==null?void 0:t.id}},{key:"dispose",value:function dispose(){if(this.focusScene&&(this.focusScene=void 0,this.disposer(),this.isWritable())){var t=te.parse(this.scenePath);this.applianceManager.notifyThatSceneChanged(t)}}},{key:"onSceneUpdate",value:function onSceneUpdate(t){this.focusScene&&this.focusScene!==t&&(this.focusScene=void 0,this.disposer(),this.onBecomeInvlaid())}}]);return Up}();var Vp=/*#__PURE__*/function(){function Vp(){_classCallCheck(this,Vp);this.appliance=null;this.pencilOptions=null;this.applianceName=null;this.shouldInterrupt=!1;this.isShiftKeyPressed=!1;this.isCtrlKeyPress=!1;this.isAltKeyPress=!1}_createClass(Vp,[{key:"interruptKeyEvent",value:function interruptKeyEvent(t,i){var a,l,h;var r=this.isShiftKeyPressed,n=this.isCtrlKeyPress,s=this.isAltKeyPress,o=!1;if(this.shouldInterrupt)switch(i){case S.KeyDown:{switch(t){case"lock":{r=!0,o=!0;break}case"lockCenter":{n=!0,o=!0;break}case"pencilPaintCircular":{s=!0,o=!0;break}}break}case S.KeyUp:{switch(t){case"lock":{r=!1,o=!0;break}case"lockCenter":{n=!1,o=!0;break}case"pencilPaintCircular":{s=!1,o=!0;break}}break}}return o&&(this.isShiftKeyPressed!==r&&(this.isShiftKeyPressed=r,(a=this.appliance)==null||a.notifyShiftPress(r)),this.isCtrlKeyPress!==n&&(this.isCtrlKeyPress=n,(l=this.appliance)==null||l.notifiyCtrlPress(n)),this.isAltKeyPress!==s&&(this.isAltKeyPress=s,(h=this.appliance)==null||h.notifiyAltPress(s))),o}},{key:"setAppliance",value:function setAppliance(t){var i,r,n;this.appliance!==t&&(this.appliance=t,(i=this.appliance)==null||i.notifyShiftPress(this.isShiftKeyPressed),(r=this.appliance)==null||r.notifiyCtrlPress(this.isCtrlKeyPress),(n=this.appliance)==null||n.notifiyAltPress(this.isAltKeyPress))}},{key:"setApplianceName",value:function setApplianceName(t){var i=t||null;this.applianceName!==i&&(this.applianceName=i,this.refreshShouldIterrupt())}},{key:"setPencilOptions",value:function setPencilOptions(t){this.pencilOptions!==t&&(this.pencilOptions=t,this.refreshShouldIterrupt())}},{key:"cancel",value:function cancel(){var t,i,r;this.shouldInterrupt&&(this.isShiftKeyPressed&&(this.isShiftKeyPressed=!1,(t=this.appliance)==null||t.notifyShiftPress(!1)),this.isCtrlKeyPress&&(this.isCtrlKeyPress=!1,(i=this.appliance)==null||i.notifiyCtrlPress(!1)),this.isAltKeyPress&&(this.isAltKeyPress=!1,(r=this.appliance)==null||r.notifiyAltPress(!1))),this.refreshShouldIterrupt()}},{key:"refreshShouldIterrupt",value:function refreshShouldIterrupt(){var i;var t;this.pencilOptions&&this.applianceName!==null?t=this.pencilOptions.shouldUseNewPencil(this.applianceName):t=!1,this.shouldInterrupt!==t&&(this.shouldInterrupt=t,t||(this.isShiftKeyPressed=!1),(i=this.appliance)==null||i.notifyShiftPress(this.isShiftKeyPressed))}}]);return Vp}();function Iw(e){for(var t in e){return!0}return!1}var Vt;(function(r){r[r.FollowSceneAndCamera=0]="FollowSceneAndCamera",r[r.FollowScene=1]="FollowScene",r[r.Freedom=2]="Freedom"})(Vt||(Vt={}));var Oc=/*#__PURE__*/function(_ea){_inherits(Oc,_ea);var _super96=_createSuper(Oc);function Oc(t,i,r,n,s,o,a){var _this318;_classCallCheck(this,Oc);_this318=_super96.call(this,s);_this318.pressedHotKeys={};_this318.extraWrappedComponents=Object.freeze([]);_this318.didRelease=!1;_this318.wannaFocusScenePath=void 0;_this318.input=null;_this318._mode=2;_this318.updateTextarea=function(t,i,r){var n;_this318.params.displayer.isEnableModify()&&(_this318.node.applianceManager.updateTextarea(t,i,_this318.focusSceneId),(n=_this318.undoWatcher)==null||n.stack.onTextareaUpdate(!!r))};_this318.isDisplayerWritable=function(){var t=_this318.params.displayer;return kc(t)?t.isWritable:!1};_this318.onSizeUpdated=function(_ref126){var t=_ref126.width,i=_ref126.height;_this318._size=Object.freeze({width:t,height:i}),_this318._callbacks.dispatch("onSizeUpdated",function(r){return r(_this318._size)})};_this318.onCameraUpdated=function(t){_this318._camera=Object.freeze({centerX:t.centerX,centerY:t.centerY,scale:t.scale}),typeof t.operatorId=="string"&&_this318._callbacks.dispatch("onCameraUpdatedByDevice",function(i){return i(_this318._camera)}),_this318._callbacks.dispatch("onCameraUpdated",function(i){return i(_this318._camera)})};_this318.onKeyPressed=function(t){var n;var _this318$params=_this318.params,i=_this318$params.hotKeys,r=_this318$params.displayer;if(r.isEnableModify()){if(i){var _s42=t,_o35=i.checkHotKey(_s42);_o35&&!_this318.pencilKeyInterrupter.interruptKeyEvent(_o35,_s42.kind)&&(_this318.receiveAndHandleHotKey(_o35,t),(n=t.nativeEvent)==null||n.preventDefault())}switch(t.kind){case S.KeyDown:{_this318._callbacks.dispatch("onKeyDown",function(s){return s(t.nativeEvent)});break}case S.KeyUp:{_this318._callbacks.dispatch("onKeyUp",function(s){return s(t.nativeEvent)});break}}}};_this318.onMetaKeyUp=function(t){var n;var _this318$params2=_this318.params,i=_this318$params2.hotKeys,r=_this318$params2.displayer;if(r.isEnableModifyWithoutThrowError()&&i){var _s43={nativeEvent:t,kind:S.KeyUp,key:"Meta",altKey:!1,ctrlKey:!1,shiftKey:!1},_o36=i.checkHotKey(_s43);_o36&&!_this318.pencilKeyInterrupter.interruptKeyEvent(_o36,"KeyUp")&&(_this318.receiveAndHandleHotKey(_o36,_s43),(n=_s43.nativeEvent)==null||n.preventDefault())}};_this318.onTouchPressUpdate=function(t){var i=_this318.node.cursors;if(i&&!_this318.params.willHideSelfCursor)if(t){var _r198=_this318.node.applianceManager.getMemberState();(_r198==null?void 0:_r198.currentApplianceName)&&i.setShowBuiltin(!0)}else i.setShowBuiltin(!1)};_this318.onWindowBlur=function(){_this318.pencilKeyInterrupter.cancel(),_this318.cancelPressedHotKeys()};_this318.onBoundlessEvent=function(t){var i;(i=_this318.input)==null||i.pushEvent(t)};_this318.onPreEndTouchEvent=function(t){var i;(i=_this318.input)==null||i.pushPreEndTouchEvent(t)};_this318.onHandToolActive=function(t){_this318._callbacks.dispatch("onHandToolActive",function(i){return i(t)})};_this318.onCameraTransformation=function(t){_this318._callbacks.dispatch("onCameraTransform",function(i){return i(t)})};_this318.updateScenePath=function(t){if(!_this318.latestSceneInfo||t!==_this318.latestSceneInfo.path){var _i59=_this318.node.sceneIdentifier(t);_this318.latestSceneInfo={id:_i59,path:t},_this318.undoWatcher&&!_this318.focusScene&&_this318.undoWatcher.watch(_i59)}};_this318.id=t,_this318.textareaHub=r.enableTextareHub?new oc:void 0,_this318.floatBarDelegate=_this318.createFloatBarDelegate(),_this318.commonScreenContext=i,_this318.params=r,_this318.node=new Ec(_assertThisInitialized(_this318),i,n,r,_this318.shouldHideCursors(n)),_this318.node.maskScreenObserverId=!1,_this318.node.maskFloatBar=!1,_this318.mobxDisposer=_this318.startWatchScenePath(),_this318.pencilKeyInterrupter=new Vp,_this318.delegate=o,_this318._callbacks=new Qe(a),_this318.undoWatcher=_this318.createUndoStackWatcher(r.undoStacksHub),_this318.registerScreenAndCameraman(_this318.node.screen,_this318.node.cameraman);return _this318}_createClass(Oc,[{key:"scenePath",get:function get(){return this.latestSceneInfo.path}},{key:"focusScenePath",get:function get(){return this.wannaFocusScenePath},set:function set(t){var _this319=this;this.wannaFocusScenePath!==t&&(this.node.foucsScenePath!==t&&!this.shouldFollowScene(this._mode)&&this.watchScenePathUpdate(function(){var i,r,n,s;if((i=_this319.focusScene)==null||i.dispose(),_this319.focusScene=void 0,t){var o=new Up(t,_this319.node.applianceManager,_this319.isDisplayerWritable,function(){var a,l;_this319.didRelease||(_this319.focusScene=void 0,_this319.node.foucsScenePath=void 0,_this319.wannaFocusScenePath=void 0,(a=_this319.input)==null||a.fireSceneUpdate(),(l=_this319.undoWatcher)==null||l.watch(_this319.latestSceneInfo.id))});o.isValid&&(_this319.focusScene=o)}_this319.focusScene?(_this319.node.foucsScenePath=t,(r=_this319.undoWatcher)==null||r.watch(_this319.focusScene.identifier)):(_this319.node.foucsScenePath=void 0,(n=_this319.undoWatcher)==null||n.watch(_this319.latestSceneInfo.id)),(s=_this319.input)==null||s.fireSceneUpdate()}),this.wannaFocusScenePath=this.node.foucsScenePath)}},{key:"focusSceneIndex",get:function get(){var t;if(this.wannaFocusScenePath!==void 0){var i=te.parse(this.wannaFocusScenePath),_r199=i.pop(),n=this.node.applianceManager.getSceneNames(i);for(var s=0;s<n.length;++s){if(n[s]===_r199)return s}}return t},set:function set(t){if(t===void 0)this.focusScenePath=void 0;else if(this.wannaFocusScenePath){var i=te.parse(this.wannaFocusScenePath),_r200=i.pop(),s=this.node.applianceManager.getSceneNames(i)[t];s!==void 0&&s!==_r200&&(i.push(s),this.focusScenePath=te.stringify(i))}}},{key:"focusSceneId",get:function get(){var t;return(t=this.focusScene)==null?void 0:t.identifier}},{key:"disableCameraTransform",get:function get(){return this.state.disableCameraTransform},set:function set(t){this.putState({disableCameraTransform:t})}},{key:"disableKey",get:function get(){return this.input?this.input.disableKey:!0},set:function set(t){if(!this.input)throw new Error("cannot modify disableKey");this.input.disableKey=t}},{key:"callbacks",get:function get(){return this._callbacks}},{key:"mode",get:function get(){return this._mode},set:function set(t){var _this320=this;this.assertNotRelease(),this._mode!==t&&this.watchScenePathUpdate(function(){var i;_this320.shouldFollowCamera(t)&&!_this320.shouldFollowCamera(_this320._mode)&&_this320.node.refreshCameraToFocus(),_this320.shouldFollowScene(t)&&!_this320.shouldFollowScene(_this320._mode)?_this320.node.foucsScenePath=void 0:!_this320.shouldFollowScene(t)&&_this320.shouldFollowScene(_this320._mode)&&(_this320.node.foucsScenePath=_this320.wannaFocusScenePath),(i=_this320.input)==null||i.fireSceneUpdate(),_this320._mode=t})}},{key:"wrappedComponents",get:function get(){return this.extraWrappedComponents},set:function set(t){this.extraWrappedComponents=Object.freeze(_toConsumableArray(t)),this.node.screen.wrappedComponents=[].concat(_toConsumableArray(t),_toConsumableArray(this.params.wrappedComponents))}},{key:"fireReloadLibrary",value:function fireReloadLibrary(){this.node.fireReloadLibrary()}},{key:"setupViewInput",value:function setupViewInput(t){var i;this.input=new Op(t,this.undoWatcher,this.pencilKeyInterrupter,this.node.mouseFollower,this.isDisplayerWritable,this.onKeyPressed,this.onMetaKeyUp,this.onTouchPressUpdate,this.onWindowBlur),this.pencilKeyInterrupter.setApplianceName((i=t.magix.trigger.getMemberState())==null?void 0:i.currentApplianceName),this.pencilKeyInterrupter.setPencilOptions(t.pencilOptions)}},{key:"releaseViewInput",value:function releaseViewInput(){this.input&&(this.input.release(),this.input=null)}},{key:"createUndoStackWatcher",value:function createUndoStackWatcher(t){var i;return t&&(i=t.createWatcher(this.latestSceneInfo.id),i.forwardTo("onCanRedoStepsUpdate",this._callbacks),i.forwardTo("onCanUndoStepsUpdate",this._callbacks)),i}},{key:"shouldFollowCamera",value:function shouldFollowCamera(t){switch(t){case 0:return!0;default:return!1;}}},{key:"shouldHideCursors",value:function shouldHideCursors(_ref127){var t=_ref127.applianceManager;var i="/"+t.getCurrentScenePath().join("/");return!!(this.wannaFocusScenePath&&!this.shouldFollowScene(this._mode)&&i!==this.wannaFocusScenePath)}},{key:"shouldFollowScene",value:function shouldFollowScene(t){switch(t){case 0:case 1:return!0;default:return!1;}}},{key:"canUndoSteps",get:function get(){return this.undoWatcher?this.undoWatcher.stack.canUndoSteps:0}},{key:"canRedoSteps",get:function get(){return this.undoWatcher?this.undoWatcher.stack.canRedoSteps:0}},{key:"undoStack",get:function get(){var t;return(t=this.undoWatcher)==null?void 0:t.stack}},{key:"camera",get:function get(){return this._camera}},{key:"size",get:function get(){return this._size}},{key:"screen",get:function get(){return this.node.screen}},{key:"cameraman",get:function get(){return this.node.cameraman}},{key:"divElement",get:function get(){return this.state.divElement},set:function set(t){this.putState({divElement:t})}},{key:"getTargetsMap",value:function getTargetsMap(t,i){return this.node.getTargetsMap(t,i)}},{key:"cancelCurrentContinuityEvent",value:function cancelCurrentContinuityEvent(){this.cameraman.cancelCurrentContinuityEvent()}},{key:"setCommonScreenContext",value:function setCommonScreenContext(t){this.assertNotRelease(),this.commonScreenContext=t,this.node.setCommonScreenContext(t)}},{key:"updateContext",value:function updateContext(t){var _this321=this;var i=this.node.maskFloatBar;this.assertNotRelease(),this.node.cleanScreen(),this.node.release(),this.unregisterScreenAndCameraman(this.node.screen,this.node.cameraman),this.node=new Ec(this,this.commonScreenContext,t,this.handleUpdatedParams(this.params),this.shouldHideCursors(t),this.node),this.node.maskScreenObserverId=!1,this.node.maskFloatBar=i,this.input&&(this.input.mouseFollower=this.node.mouseFollower),this.shouldFollowScene(this._mode)&&this.watchScenePathUpdate(function(){var r;_this321.node.foucsScenePath=_this321.wannaFocusScenePath,(r=_this321.input)==null||r.fireSceneUpdate()}),this.registerScreenAndCameraman(this.node.screen,this.node.cameraman)}},{key:"handleUpdatedParams",value:function handleUpdatedParams(t){return this.extraWrappedComponents.length===0?t:D(I({},t),{wrappedComponents:[].concat(_toConsumableArray(this.extraWrappedComponents),_toConsumableArray(t.wrappedComponents))})}},{key:"setMemberState",value:function setMemberState(t){var _this322=this;return this.params.setMemberStateWrapper(t,this,function(i){var a;var r=_this322.node.applianceManager,n=(a=r.getMemberState())==null?void 0:a.currentApplianceName,_r$setMemberStateWith=r.setMemberStateWithCommitter(i),s=_r$setMemberStateWith.memberState,o=_r$setMemberStateWith.committer;if(_this322.undoWatcher&&o&&_this322.undoWatcher.stack.commit(o),"currentApplianceName"in s){var l=s.currentApplianceName;l!==n&&(_this322.pencilKeyInterrupter.setApplianceName(l),_this322.checkApplianceNameUpdate(l),_this322.refreshCursorHideObserverIdNeed(l),n==="text"&&_this322.focusToSomeThing())}return s})}},{key:"checkApplianceNameUpdate",value:function checkApplianceNameUpdate(t){var r;var i=(r=this.input)==null?void 0:r.virtualKeyboardHelper;if(i)switch(t){case L.text:{i.catchPress=!0,i.catchTarget=null,this.textareaHub&&(this.textareaHub.onWaitingTouchRefChanged=void 0);break}case L.selector:{i.catchPress=!1,i.catchTarget=null,this.textareaHub&&(this.textareaHub.onWaitingTouchRefChanged=function(n,s){n&&s===1?(i.catchPress=!0,i.catchTarget=n):(i.catchPress=!1,i.catchTarget=null)});break}default:{i.catchPress=!1,i.catchTarget=null,this.textareaHub&&(this.textareaHub.onWaitingTouchRefChanged=void 0);break}}}},{key:"setCameraBound",value:function setCameraBound(t){this.putState({cameraBound:t})}},{key:"moveCamera",value:function moveCamera(t){this.putState({cameraMoving:{camera:t}})}},{key:"moveCameraToContain",value:function moveCameraToContain(t){this.putState({cameraMoving:{toContaint:t}})}},{key:"insertImage",value:function insertImage(t){this.params.displayer.isEnableModify()&&this.node.applianceManager.insertImage(t,this.focusSceneId)}},{key:"lockImage",value:function lockImage(t,i){this.params.displayer.isEnableModify()&&this.node.applianceManager.lockImage(t,i,this.focusSceneId)}},{key:"lockImages",value:function lockImages(t){this.params.displayer.isEnableModify()&&this.node.applianceManager.lockImages(t,this.focusSceneId)}},{key:"updatePencilColor",value:function updatePencilColor(t){this.params.displayer.isEnableModify()&&this.node.applianceManager.updatePencilColor(t,this.focusSceneId)}},{key:"completeImageUpload",value:function completeImageUpload(t,i){if(this.params.displayer.isEnableModify()){var _r201=this.node.applianceManager.completeImageUpload(t,i,this.focusSceneId);this.undoWatcher&&_r201&&this.undoWatcher.stack.commit(_r201)}}},{key:"insertText",value:function insertText(t,i,r){var _this323=this;if(this.textareaHub&&this.params.displayer.isEnableModify()){var n=this.node.applianceManager.insertTextarea(t,i,this.focusSceneId);if(r){var s=this.node.applianceManager.getMemberState();if(s){var o=s.bold,a=s.italic,l=s.underline,h=s.lineThrough,d={bold:o,italic:a,underline:l,lineThrough:h};setTimeout(function(){var f;var p=_this323.textareaHub.getTextareaRect(n,d,r);if(p){var m={width:p.width,height:p.height,scale:p.scale,textLines:[],originalText:r};_this323.node.applianceManager.updateTextarea(m,n,_this323.focusSceneId),(f=_this323.undoWatcher)==null||f.stack.onTextareaUpdate(r.length>0)}},100)}}return n}else return xt}},{key:"updateText",value:function updateText(t,i){var r;if(i.length===0)throw new Error("make text blank");if(this.textareaHub&&this.params.displayer.isEnableModify()){var _this$node$applianceM=this.node.applianceManager.getMemberState(),n=_this$node$applianceM.bold,s=_this$node$applianceM.italic,o=_this$node$applianceM.underline,a=_this$node$applianceM.lineThrough,l={bold:n,italic:s,underline:o,lineThrough:a},h=this.textareaHub.getTextareaRect(t,l,i);if(!h)throw new Error("text ".concat(t," not exits or invisible"));var d={width:h.width,height:h.height,scale:h.scale,textLines:[],originalText:i};this.node.applianceManager.updateTextarea(d,t,this.focusSceneId),(r=this.undoWatcher)==null||r.stack.onTextareaUpdate(!0)}}},{key:"updateSelectedText",value:function updateSelectedText(t){var i;if(this.params.displayer.isEnableModify()){var _r202=this.getTextMemberState(t);if(this.textareaHub&&Iw(_r202)){var n=this.textareaHub.getTextareaSizeMap(t),s=this.node.applianceManager.updateTextareaFormat(t,n,this.focusSceneId);this.undoWatcher&&s&&this.undoWatcher.stack.commit(s)}if(t.fontSize!==void 0){var _n51=this.node.applianceManager.updateTextareaFontSize(t.fontSize,this.focusSceneId);this.undoWatcher&&_n51&&this.undoWatcher.stack.commit(_n51),_r202.textSize=t.fontSize}Iw(_r202)&&((i=this.params.memberStateStorage)==null||i.setMemberState(_r202),this.node.applianceManager.setMemberState(_r202))}}},{key:"updateTextFormat",value:function updateTextFormat(t){var i;if(this.textareaHub){var _r203=this.getTextMemberState(t);(i=this.params.memberStateStorage)==null||i.setMemberState(_r203),this.node.applianceManager.setMemberState(_r203);var n=this.textareaHub.getTextareaSizeMap(t),s=this.node.applianceManager.updateTextareaFormat(t,n,this.focusSceneId);this.undoWatcher&&s&&this.undoWatcher.stack.commit(s)}}},{key:"getTextMemberState",value:function getTextMemberState(t){var i={};return"bold"in t&&(i.bold=t.bold),"italic"in t&&(i.italic=t.italic),"underline"in t&&(i.underline=t.underline),"lineThrough"in t&&(i.lineThrough=t.lineThrough),"color"in t&&(i.textColor=t.color),i}},{key:"delete",value:function _delete(){if(this.params.displayer.isEnableModify()){var t=this.node.applianceManager["delete"](null,this.focusSceneId);this.undoWatcher&&t&&this.undoWatcher.stack.commit(t)}}},{key:"duplicate",value:function duplicate(){var _this$params3=this.params,t=_this$params3.displayer,i=_this$params3.copyOperator;if(i&&t.isEnableModify()){var _r204=i.duplicate(this.node.applianceManager,this.focusSceneId);this.undoWatcher&&_r204&&this.undoWatcher.stack.commit(_r204)}}},{key:"redo",value:function redo(){var t,i;return(t=this.undoWatcher)==null||t.stack.redo(this.focusScenePath,this.focusSceneId),((i=this.undoWatcher)==null?void 0:i.stack.canRedoSteps)||0}},{key:"undo",value:function undo(){var t,i;return(t=this.undoWatcher)==null||t.stack.undo(this.focusScenePath,this.focusSceneId),((i=this.undoWatcher)==null?void 0:i.stack.canUndoSteps)||0}},{key:"copy",value:function copy(){var _this$params4=this.params,t=_this$params4.displayer,i=_this$params4.copyOperator;i&&t.isEnableModify()&&i.copy(this.node.applianceManager,this.focusSceneId)}},{key:"paste",value:function paste(){var _this$params5=this.params,t=_this$params5.displayer,i=_this$params5.copyOperator;if(i&&t.isEnableModify()){var _r205=i.paste(this.node.applianceManager,this.focusSceneId);this.undoWatcher&&_r205&&this.undoWatcher.stack.commit(_r205)}}},{key:"cleanCurrentScene",value:function cleanCurrentScene(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!0;if(this.params.displayer.isEnableModify()){var i=this.node.applianceManager.cleanCurrentScene(t,this.focusSceneId);this.undoWatcher&&i&&this.undoWatcher.stack.commit(i)}}},{key:"moveSelectedComponentsToTop",value:function moveSelectedComponentsToTop(){this.params.displayer.isEnableModify()&&this.node.applianceManager.moveSelectedComponentsToTop(null)}},{key:"moveSelectedComponentsToBottom",value:function moveSelectedComponentsToBottom(){this.params.displayer.isEnableModify()&&this.node.applianceManager.moveSelectedComponentsToBottom(null)}},{key:"updateDisableBoundlessEvent",value:function updateDisableBoundlessEvent(t){this.node.cameraman.disableBoundlessEvent=t}},{key:"updateCursorClass",value:function updateCursorClass(t){this.node.updateCursorClass(t)}},{key:"updateCursorStyle",value:function updateCursorStyle(t){this.node.updateCursorStyle(t)}},{key:"resizeScreen",value:function resizeScreen(){this.node.resizeScreen()}},{key:"refreshRender",value:function refreshRender(){var _this324=this;this.watchScenePathUpdate(function(){return _this324.node.refreshRender()})}},{key:"scenePreview",value:function scenePreview(t,i,r,n,s){return this.node.scenePreview(t,i,r,n,s)}},{key:"generateScreenshot",value:function generateScreenshot(t,i,r){return this.node.generateScreenshot(t,i,r)}},{key:"fillSceneSnapshot",value:function fillSceneSnapshot(t,i,r,n,s){this.node.fillSceneSnapshot(t,i,r,n,s)}},{key:"screenshotToCanvas",value:function screenshotToCanvas(t,i,r,n,s,o){this.node.screenshotToCanvas(t,i,r,n,s,o)}},{key:"getBoundingRect",value:function getBoundingRect(t){return this.node.getBoundingRect(t)}},{key:"convertToPointInWorld",value:function convertToPointInWorld(_ref128){var t=_ref128.x,i=_ref128.y;return this.node.screen.convertPointToScene(t,i)}},{key:"convertToPointOnScreen",value:function convertToPointOnScreen(t,i){return this.node.screen.convertPointToScreen(t,i)}},{key:"fireRenderDuration",value:function fireRenderDuration(t){this._callbacks.dispatch("onRenderDuration",function(i){return i(t)})}},{key:"handleNativeEvent",value:function handleNativeEvent(t){if(t.code==="Escape"){var i=this.node.applianceManager.releaseAllTextarea(null,this.focusSceneId);this.undoWatcher&&i&&this.undoWatcher.stack.commit(i)}}},{key:"release",value:function release(){var t;this.assertNotRelease(),this.node.release(),(t=this.undoWatcher)==null||t.stop(),this.mobxDisposer(),this.unregisterScreenAndCameraman(this.node.screen,this.node.cameraman),this.didRelease=!0,this.delegate.onRelease()}},{key:"onStateUpdate",value:function onStateUpdate(t){this.node.updateState(t)}},{key:"registerScreenAndCameraman",value:function registerScreenAndCameraman(t,i){var _this325=this;var r=t.width,n=t.height,s=t.camera;(!this._size||this._size.width!==r||this._size.height!==n)&&(this._size=Object.freeze({width:r,height:n}),this._callbacks.dispatch("onSizeUpdated",function(o){return o(_this325._size)})),(!this._camera||!dr(this._camera,s))&&(this._camera=Object.freeze(I({},s)),this._callbacks.dispatch("onCameraUpdated",function(o){return o(_this325._camera)})),t.addSizeUpdatedListener(this.onSizeUpdated),t.addCameraUpdatedListener(this.onCameraUpdated),i.addBoundlessEventListener(this.onBoundlessEvent),i.addPreTouchEventListener(this.onPreEndTouchEvent),i.addHandToolActiveListener(this.onHandToolActive),i.addCameraTransformationListener(this.onCameraTransformation)}},{key:"unregisterScreenAndCameraman",value:function unregisterScreenAndCameraman(t,i){t.removeSizeUpdatedListener(this.onSizeUpdated),t.removeCameraUpdatedListener(this.onCameraUpdated),i.removeBoundlessEventListener(this.onBoundlessEvent),i.removePreTouchEventListener(this.onPreEndTouchEvent),i.removeHandToolActiveListener(this.onHandToolActive),i.removeCameraTransformationListener(this.onCameraTransformation)}},{key:"refreshCursorHideObserverIdNeed",value:function refreshCursorHideObserverIdNeed(t){var i=this.node.cursors;i&&!this.params.willHideSelfCursor&&i.setShowBuiltin(!1)}},{key:"assertNotRelease",value:function assertNotRelease(){if(this.didRelease)throw new Error("view did release")}},{key:"receiveAndHandleHotKey",value:function receiveAndHandleHotKey(t,i){switch(i.kind){case S.KeyDown:{var _r206=this.pressedHotKeys[t];_r206||(_r206=this.pressedHotKeys[t]=[]),_r206.push(i);break}case S.KeyUp:{delete this.pressedHotKeys[t];break}}this.handleHotKey(t,i)}},{key:"cancelPressedHotKeys",value:function cancelPressedHotKeys(){for(var t in this.pressedHotKeys){var i=this.pressedHotKeys[t];delete this.pressedHotKeys[t];var _iterator269=_createForOfIteratorHelper(i),_step269;try{for(_iterator269.s();!(_step269=_iterator269.n()).done;){var _r207=_step269.value;var n=D(I({},_r207),{kind:S.KeyUp});this.handleHotKey(t,n)}}catch(err){_iterator269.e(err)}finally{_iterator269.f()}}}},{key:"handleHotKey",value:function handleHotKey(t,i){switch(t){case"duplicate":{this.duplicate();break}case"copy":{this.copy();break}case"paste":{this.paste();break}case"undo":{this.undo();break}case"redo":{this.redo();break}case"delete":{this["delete"]();break}case"lock":{var _r208=this.sendToApplianceManager(t,i);this.undoWatcher&&_r208&&this.undoWatcher.stack.commit(_r208);break}case"lockCenter":{var _r209=this.sendToApplianceManager(t,i);this.undoWatcher&&_r209&&this.undoWatcher.stack.commit(_r209);break}case"changeToSelector":{this.updateAppliance(L.selector);break}case"changeToClick":{this.updateAppliance(L.clicker);break}case"changeToLaserPointer":{this.updateAppliance(L.laserPointer);break}case"changeToPencil":{this.updateAppliance(L.pencil);break}case"changeToRectangle":{this.updateAppliance(L.rectangle);break}case"changeToEllipse":{this.updateAppliance(L.ellipse);break}case"changeToEraser":{this.updateAppliance(L.eraser);break}case"changeToPencilEraser":{this.updateAppliance(L.pencilEraser);break}case"changeToText":{this.updateAppliance(L.text);break}case"changeToStraight":{this.updateAppliance(L.straight);break}case"changeToArrow":{this.updateAppliance(L.arrow);break}case"changeToHand":{this.updateAppliance(L.hand);break}}}},{key:"sendToApplianceManager",value:function sendToApplianceManager(t,i){var r=null,n={kind:t};switch(i.kind){case S.KeyDown:{r=this.node.applianceManager.onKeyDown(n,this.focusSceneId);break}case S.KeyUp:{r=this.node.applianceManager.onKeyUp(n,this.focusSceneId);break}}return r}},{key:"updateAppliance",value:function updateAppliance(t){this.setMemberState({currentApplianceName:t})}},{key:"createFloatBarDelegate",value:function createFloatBarDelegate(){var _this326=this;return Object.freeze({"delete":function _delete(){return _this326["delete"]()},lockImages:function lockImages(t){return _this326.lockImages(t)},updatePencilColor:function updatePencilColor(t){return _this326.updatePencilColor(t)},moveSelectedComponentsToTop:function moveSelectedComponentsToTop(){return _this326.moveSelectedComponentsToTop()},moveSelectedComponentsToBottom:function moveSelectedComponentsToBottom(){return _this326.moveSelectedComponentsToBottom()},duplicate:function duplicate(){return _this326.duplicate()},updateTextareaFontSize:function updateTextareaFontSize(t){return _this326.updateSelectedText({fontSize:t})},updateTextareaFormat:function updateTextareaFormat(t){return _this326.updateTextFormat(t)}})}},{key:"watchScenePathUpdate",value:function watchScenePathUpdate(t){try{return t()}finally{var i=this.latestSceneInfo.path,_r210=this.node.scenePath;this.wannaFocusScenePath&&!this.shouldFollowScene(this._mode)&&_r210!==this.wannaFocusScenePath?this.node.isCursorsHidden=!0:this.node.isCursorsHidden=!1,i!==_r210&&(this.updateScenePath(_r210),this._callbacks.dispatch("onScenePathUpdated",function(n){return n(_r210)}))}}},{key:"startWatchScenePath",value:function startWatchScenePath(){var _this327=this;var t={equals:Ac.comparer["default"]};return this.updateScenePath(this.node.scenePath),(0,Ac.reaction)(function(){return _this327.node.scenePath},this.updateScenePath,t)}},{key:"focusToSomeThing",value:function focusToSomeThing(){var t=document.createElement("button");t.style.position="fixed",t.style.zIndex="-1024",t.style.opacity="1.0",document.body.appendChild(t),t.focus(),setTimeout(function(){return t.remove()},0)}}]);return Oc}(ea);var Rc=/*#__PURE__*/function(_ea2){_inherits(Rc,_ea2);var _super97=_createSuper(Rc);function Rc(t,i,r){var _this328;_classCallCheck(this,Rc);_this328=_super97.call(this,i);_this328.viewsMap={};_this328.previousViewId=0;_this328.viewInputParams=null;_this328.params=t,_this328.context=Object.freeze(I({},r)),_this328._dynamicPpt=r.dynamicPpt,_this328._callbacks=new Qe,_this328.commonScreenContext=Object.freeze({observerId:i.observerId,forcePPTLandscape:i.forcePPTLandscape,disalbeImageHit:i.disalbeImageHit,disableOthersSelectingBox:i.disableOthersSelectingBox});return _this328}_createClass(Rc,[{key:"dynamicPpt",get:function get(){return this._dynamicPpt}},{key:"callbacks",get:function get(){return this._callbacks}},{key:"setupViewInput",value:function setupViewInput(t){this.viewInputParams||(this.viewInputParams=Object.freeze(I({},t)),this.forEach(function(i){return i.setupViewInput(D(I({},t),{view:i}))}))}},{key:"releaseViewInput",value:function releaseViewInput(){this.viewInputParams&&(this.viewInputParams=null,this.forEach(function(t){return t.release()}))}},{key:"onStateUpdate",value:function onStateUpdate(t,i){if("observerId"in t&&this.updateCommonScreenContext("observerId",t.observerId),"forcePPTLandscape"in t&&this.updateCommonScreenContext("forcePPTLandscape",t.forcePPTLandscape),"disalbeImageHit"in t&&this.updateCommonScreenContext("disalbeImageHit",t.disalbeImageHit),"disableOthersSelectingBox"in t&&this.updateCommonScreenContext("disableOthersSelectingBox",t.disableOthersSelectingBox),"disableBoundlessEvent"in t&&this.forEach(function(r){return r.updateDisableBoundlessEvent(t.disableBoundlessEvent)}),"cursorClass"in t&&this.forEach(function(r){return r.updateCursorClass(t.cursorClass)}),"cursorStyle"in t&&this.forEach(function(r){return r.updateCursorStyle(t.cursorStyle)}),"playerState"in t){var _r211=t.playerState,n=this.context.pluginManager;n.setPlayerState?n.setPlayerState(_r211):_r211.isPlaying!==void 0&&n.setPlayingState(_r211.isPlaying)}}},{key:"setupViewContext",value:function setupViewContext(t){t.updateDisableBoundlessEvent(this.state.disableBoundlessEvent),t.updateCursorClass(this.state.cursorClass),t.updateCursorStyle(this.state.cursorStyle)}},{key:"updateCommonScreenContext",value:function updateCommonScreenContext(t,i){this.commonScreenContext=Object.freeze(D(I({},this.commonScreenContext),_defineProperty({},t,i)));for(var _r212 in this.viewsMap){this.viewsMap[_r212].setCommonScreenContext(this.commonScreenContext)}}},{key:"forEach",value:function forEach(t){for(var i in this.viewsMap){t(this.viewsMap[i])}}},{key:"createView",value:function createView(t,i){var _this329=this;var r="".concat(this.previousViewId+=1),n=Object.freeze({onRelease:function onRelease(){return _this329.releaseView(s)}}),s=new Oc(r,this.commonScreenContext,this.params,this.context,t,n,i);return this.viewsMap[s.id]=s,this.setupViewContext(s),this.viewInputParams&&s.setupViewInput(D(I({},this.viewInputParams),{view:s})),this._callbacks.dispatch("onCreatedView",function(o){return o(s)}),s}},{key:"updateContext",value:function updateContext(t){for(var i in this.viewsMap){var _r213=this.viewsMap[i];_r213.updateContext(t),this.setupViewContext(_r213)}this._dynamicPpt=t.dynamicPpt}},{key:"fireReloadLibrary",value:function fireReloadLibrary(){var t,i;(i=(t=this.context.pluginManager).refreshPluginInstances)==null||i.call(t);for(var _r214 in this.viewsMap){this.viewsMap[_r214].fireReloadLibrary()}}},{key:"releaseView",value:function releaseView(t){delete this.viewsMap[t.id],this._callbacks.dispatch("onReleasedView",function(i){return i(t)})}}]);return Rc}(ea);var Nc=/*#__PURE__*/function(){function Nc(t){_classCallCheck(this,Nc);this.viewsHub=t}_createClass(Nc,[{key:"createView",value:function createView(t){var i={cameraBound:{},handToolActive:!1,divElement:null,disableCameraTransform:!1};return this.viewsHub.createView(i,t)}},{key:"forEach",value:function forEach(t){this.viewsHub.forEach(t)}}]);return Nc}();var ta=/*#__PURE__*/function(){function ta(t){_classCallCheck(this,ta);this._owner=void 0;this._state=Object.freeze(I({},t))}_createClass(ta,[{key:"owner",get:function get(){return this._owner}},{key:"state",get:function get(){return this._state||this._owner.state}},{key:"putState",value:function putState(t){var i;if(this._state){var _r215=xc(this._state,t);_r215&&(this._state=Object.freeze(_r215)),i=!!_r215}else i=this._owner.putState(t);return i}},{key:"updateOwner",value:function updateOwner(t){this._owner=t,this._state=null}}]);return ta}();var ia=/*#__PURE__*/function(){function ia(t,i){var _this330=this;_classCallCheck(this,ia);this.isReadonlyMode=!1;this.isOverrideWithFreedom=!1;this.overrideDisposer=null;this.previousRectangle=null;this.onCreatedView=function(t){_this330.previousRectangle&&_this330.refreshScreenRectangle(t,_this330.previousRectangle)};this.viewsHub=t,this.applianceManager=i,this.followerCheckingDisposer=(0,oi.reaction)(function(){return _this330.getCurrentMode()===pe.Follower},function(r){r?_this330.refreshCameraRectangle():_this330.previousRectangle=null}),t.callbacks.on("onCreatedView",this.onCreatedView),(0,oi.makeObservable)(this,{isReadonlyMode:oi.observable,isOverrideWithFreedom:oi.observable,setReadonlyMode:oi.action,overrideWithFreedom:oi.action})}_createClass(ia,[{key:"release",value:function release(){this.overrideDisposer&&(this.overrideDisposer(),this.overrideDisposer=null),this.viewsHub.callbacks.off("onCreatedView",this.onCreatedView),this.followerCheckingDisposer()}},{key:"setReadonlyMode",value:function setReadonlyMode(t){this.isReadonlyMode!==t&&(this.isReadonlyMode=t,this.overrideDisposer&&!t&&(this.overrideDisposer(),this.overrideDisposer=null))}},{key:"overrideWithFreedom",value:function overrideWithFreedom(t){var _this331=this;this.isReadonlyMode&&this.isOverrideWithFreedom!==t&&(this.isOverrideWithFreedom=t,t?this.overrideDisposer=(0,oi.when)(function(){return _this331.applianceManager.getViewState().mode===pe.Freedom},function(){_this331.isReadonlyMode&&_this331.isOverrideWithFreedom&&(_this331.isOverrideWithFreedom=!1),_this331.overrideDisposer=null}):this.overrideDisposer&&(this.overrideDisposer(),this.overrideDisposer=null))}},{key:"getBroadcastState",value:function getBroadcastState(){var t=this.applianceManager,i=t.getBroadcasterId();return{mode:this.getCurrentMode(),broadcasterId:i}}},{key:"getCurrentMode",value:function getCurrentMode(){return this.isReadonlyMode&&this.isOverrideWithFreedom?pe.Freedom:this.applianceManager.getViewState().mode}},{key:"refreshCameraRectangle",value:function refreshCameraRectangle(){var _this332=this;var _this$applianceManage3=this.applianceManager.getViewState(),t=_this$applianceManage3.originX,i=_this$applianceManage3.originY,r=_this$applianceManage3.width,n=_this$applianceManage3.height,s={originX:t,originY:i,width:r,height:n};(!this.previousRectangle||this.previousRectangle.originX!==t||this.previousRectangle.originY!==i||this.previousRectangle.width!==r||this.previousRectangle.height!==n)&&(this.viewsHub.forEach(function(o){return _this332.refreshScreenRectangle(o,s)}),this.previousRectangle=s)}},{key:"refreshScreenRectangle",value:function refreshScreenRectangle(t,i){var r=t.mode;r===Vt.FollowSceneAndCamera&&t.screen.adaptRectangle(D(I({},i),{animationMode:$.Continuous,adapterMode:mi.Centering}))}}]);return ia}();function Mw(e,t){var i=[],r=new dt(t,function(){i.length>0&&e(i.splice(0,i.length))});function n(s){i.push(s),r.invoke()}return Object.defineProperty(n,"proxyListener",{writable:!1,value:e}),n}var Wp=/*#__PURE__*/function(){function Wp(){_classCallCheck(this,Wp);this.listeners={};this.eventsMergers={};this.waitingNodes=[]}_createClass(Wp,[{key:"dispatchEvent",value:function dispatchEvent(t,i,r){var n=this.listeners[t.event];if(n){var _iterator270=_createForOfIteratorHelper(n),_step270;try{for(_iterator270.s();!(_step270=_iterator270.n()).done;){var o=_step270.value;if(!r||o.isAfterCommit===i)try{o.invoke(t)}catch(a){console.error(a)}}}catch(err){_iterator270.e(err)}finally{_iterator270.f()}}var s=this.waitingNodes.findIndex(function(o){return o.filter(t)?(o.resolve(t),!0):!1});s!==-1&&this.waitingNodes.splice(s,1)}},{key:"addMagixEventsListener",value:function addMagixEventsListener(t,i,r,n){var s=Mw(i,r),o=this.eventsMergers[t];o||(o=[],this.eventsMergers[t]=o),o.push(s),this.addMagixEventListener(t,s,n)}},{key:"addMagixEventListener",value:function addMagixEventListener(t,i,r){var n=this.listeners[t];n||(n=[],this.listeners[t]=n),n.push({invoke:i,isAfterCommit:r})}},{key:"removeMagixEventListener",value:function removeMagixEventListener(t,i){if(i){var _r216=this.removeFromEventMerges(t,i);_r216?this.removeFromListeners(t,_r216):this.removeFromListeners(t,i)}else delete this.listeners[t],delete this.eventsMergers[t]}},{key:"removeFromEventMerges",value:function removeFromEventMerges(t,i){var r=this.eventsMergers[t];if(r){var n=-1;for(var s=0;s<r.length;++s){if(r[s].proxyListener===i){n=s;break}}if(n!==-1){var _s44=r[n];return r.splice(n,1),r.length===0&&delete this.eventsMergers[t],_s44}}}},{key:"removeFromListeners",value:function removeFromListeners(t,i){var r=this.listeners[t];if(r){var n=r.findIndex(function(s){return s.invoke===i});n!==-1&&(r.splice(n,1),r.length===0&&delete this.listeners[t])}}},{key:"waitMagixEvent",value:function waitMagixEvent(t){var _this333=this;return new Promise(function(i){_this333.waitingNodes.push({resolve:i,filter:t})})}}]);return Wp}();var An=P(require("react")),Hp=An.createContext(void 0),_p=An.createContext(void 0),Kp=An.createContext(void 0),Gp=/*#__PURE__*/function(){function Gp(){_classCallCheck(this,Gp);this.contents={};this.nextId=0}_createClass(Gp,[{key:"createWrappedComponent",value:function createWrappedComponent(t,i){var r=this,n="".concat(this.nextId),s=function s(_ref129){var o=_ref129.children;if(r.contents){var _r$contents$n=r.contents[n],a=_r$contents$n.value,l=_r$contents$n.provider;return An.createElement(l,{value:a},o)}else return null};return this.nextId+=1,this.contents[n]=Object.freeze({value:i,provider:t.Provider}),s}},{key:"dispose",value:function dispose(){this.contents=null}}]);return Gp}(),$p=Hp.Consumer,ra=_p.Consumer,Yp=Kp.Consumer;function Xp(e){return new Fs(e)}var Fs=/*#__PURE__*/function(){function Fs(t){_classCallCheck(this,Fs);this.cacheContextMap={};this.manager=null;this.plugins=this.copyAndFreezePlugins(t)}_createClass(Fs,[{key:"copyAndFreezePlugins",value:function copyAndFreezePlugins(t){var i={};for(var _r217 in t){var n=t[_r217];if(n.kind!==void 0&&_r217!==n.kind)throw new Error("plugin's kind ".concat(JSON.stringify(n.kind)," is not equals key ").concat(JSON.stringify(_r217)));var s=n.defaultAttributes;_typeof(s)=="object"&&s!==null&&(s=Object.freeze(I({},s))),i[_r217]=Object.freeze({kind:_r217,render:n.render,defaultAttributes:s,hitTest:n.hitTest,willInterruptEvent:n.willInterruptEvent})}return Object.freeze(i)}},{key:"setPluginContext",value:function setPluginContext(t,i){this.manager?this.manager.setPluginContext(t,i):this.cacheContextMap&&t in this.plugins&&(this.cacheContextMap[t]=i)}},{key:"getPluginContext",value:function getPluginContext(t){return this.manager?this.manager.getPluginContext(t):this.cacheContextMap?this.cacheContextMap[t]:void 0}},{key:"setPluginManager",value:function setPluginManager(t){if(this.cacheContextMap){for(var i in this.cacheContextMap){t.setPluginContext(i,this.cacheContextMap[i])}this.cacheContextMap=null}else if(this.manager)for(var _i60 in this.plugins){var _r218=this.manager.getPluginContext(_i60);t.setPluginContext(_i60,_r218)}this.manager=t}}]);return Fs}();var On=P(require("mobx"));var js=/*#__PURE__*/function(){function js(t){_classCallCheck(this,js);this.enableCallbackUpdate=!0;this.disposers=null;this.copiedAttributes=null;this.copiedMemberAttributes=null;this.kind=t.kind,this._displayer=t.displayer,this._callbacks=new Qe,this.onAttributesUpdate&&this._callbacks.on("onAttributesUpdate",this.onAttributesUpdate.bind(this)),this.onDestroy&&this._callbacks.on("onDestroy",this.onDestroy.bind(this)),this.autorunAttributesUpdate(),(0,On.makeObservable)(this,{attributes:On.computed})}_createClass(js,[{key:"autorunAttributesUpdate",value:function autorunAttributesUpdate(){var _this334=this;this._displayer.useMobXState||(this.disposers=[this.bindAutorunAttributes(function(){return _this334.copiedAttributes=At(_this334.attributes)},function(){return _this334._callbacks.dispatch("onAttributesUpdate",function(t){return t(_this334.copiedAttributes)})}),this.bindAutorunAttributes(function(){return _this334.copiedMemberAttributes=At(_this334.memberAttributes)},function(){return _this334._callbacks.dispatch("onMemberAttributesUpdate",function(t){return t(_this334.copiedMemberAttributes)})})])}},{key:"bindAutorunAttributes",value:function bindAutorunAttributes(t,i){var _this335=this;var r=!1;return(0,On.autorun)(function(){_this335._displayer.applianceManager.hasInvisibilePluginKind(_this335.kind)&&(t(),r&&_this335.enableCallbackUpdate&&i(),r=!0)})}},{key:"displayer",get:function get(){return this._displayer}},{key:"callbacks",get:function get(){return this._callbacks}},{key:"attributes",get:function get(){var t;if(this._displayer.useMobXState)t=this._displayer.applianceManager.getAttributesWithInvisiblePlugin(this.kind);else{if(!this.copiedAttributes)throw new Error("invisible plugin \"".concat(this.kind,"\" not exits"));t=this.copiedAttributes}return t}},{key:"memberAttributes",get:function get(){var t;if(this._displayer.useMobXState)t=this._displayer.applianceManager.getMemberAttributes(this.kind);else{if(!this.copiedMemberAttributes)throw new Error("invisible plugin \"".concat(this.kind,"\" not exits"));t=this.copiedMemberAttributes}return t}},{key:"getMemberAttributes",value:function getMemberAttributes(t){return this._displayer.applianceManager.getMemberAttributes(this.kind,[],t)}},{key:"getAttributesValue",value:function getAttributesValue(t){var i=this._displayer.applianceManager;return i.getAttributesWithInvisiblePlugin(this.kind,t)}},{key:"getMemberAttributesValue",value:function getMemberAttributesValue(t){var i=this._displayer.applianceManager;return i.getMemberAttributes(this.kind,t)}},{key:"setAttributes",value:function setAttributes(t){if(this.isEnableUpdateAttributes())try{this.enableCallbackUpdate=!1;var _this$_displayer=this._displayer,i=_this$_displayer.applianceManager,_r219=_this$_displayer.parametersFilter,n=_r219?_r219.filter(t):t;i.updateAttributesInvisiblePlugin(this.kind,n)}finally{this.resetEnableCallbackUpdate()}}},{key:"setMemberAttributes",value:function setMemberAttributes(t){if(this.isEnableUpdateAttributes())try{this.enableCallbackUpdate=!1;var _this$_displayer2=this._displayer,i=_this$_displayer2.applianceManager,_r220=_this$_displayer2.parametersFilter,n=_r220?_r220.filter(t):t;i.updateMemberAttributes(this.kind,n)}finally{this.resetEnableCallbackUpdate()}}},{key:"updateAttributes",value:function updateAttributes(t,i){if(this.isEnableUpdateAttributes())try{this.enableCallbackUpdate=!1;var _this$_displayer3=this._displayer,_r221=_this$_displayer3.applianceManager,n=_this$_displayer3.parametersFilter,s=n?n.filter(i):i;_r221.updateAttributesInvisiblePluginWithKeys(this.kind,t,s)}finally{this.resetEnableCallbackUpdate()}}},{key:"updateMemberAttributes",value:function updateMemberAttributes(t,i){if(this.isEnableUpdateAttributes())try{this.enableCallbackUpdate=!1;var _this$_displayer4=this._displayer,_r222=_this$_displayer4.applianceManager,n=_this$_displayer4.parametersFilter,s=n?n.filter(i):i;_r222.updateMemberAttrubtesWithKeys(this.kind,t,s)}finally{this.resetEnableCallbackUpdate()}}},{key:"destroy",value:function destroy(){try{this.enableCallbackUpdate=!1;var t=this._displayer.applianceManager;t.removeInvisiblePlugin(this.kind)}finally{this.resetEnableCallbackUpdate()}}},{key:"_dispose",value:function _dispose(t){this.disposers&&(this.disposers.forEach(function(i){return i()}),this.disposers=null),t&&this.enableCallbackUpdate&&this._callbacks.dispatch("onDestroy",function(i){return i()})}},{key:"resetEnableCallbackUpdate",value:function resetEnableCallbackUpdate(){var _this336=this;Promise.resolve().then(function(){_this336.enableCallbackUpdate=!0})}},{key:"isEnableUpdateAttributes",value:function isEnableUpdateAttributes(){if(this._displayer instanceof Ui)return this._displayer.isEnableModify();throw new Error("cannot update attributes when displayer is player")}}]);return js}(),Lc=/*#__PURE__*/function(){function Lc(t,i,r){_classCallCheck(this,Lc);this.pluginClasses={};this.plugins={};this.paddingCreators={};this.disposer=null;this._isWatching=!1;this.logger=t,this.displayer=i,this.pluginClasses=this.createPluginClasses(r)}_createClass(Lc,[{key:"createPluginClasses",value:function createPluginClasses(t){var i={};var _iterator271=_createForOfIteratorHelper(t),_step271;try{for(_iterator271.s();!(_step271=_iterator271.n()).done;){var _r223=_step271.value;if(_r223.kind in i)throw new Error("duplicated kind from invisible plugin ".concat(JSON.stringify(_r223.kind)));i[_r223.kind]=_r223}}catch(err){_iterator271.e(err)}finally{_iterator271.f()}return Object.freeze(i)}},{key:"isWatching",get:function get(){return this._isWatching},set:function set(t){var _this337=this;this._isWatching!==t&&(this._isWatching=t,t&&!this.disposer?this.disposer=(0,On.autorun)(function(){for(var i in _this337.pluginClasses){_this337.refreshPlugin(_this337.pluginClasses[i])}}):!t&&this.disposer&&(this.disposer(),this.disposer=null))}},{key:"get",value:function get(t){return this.plugins[t]||null}},{key:"create",value:function create(t,i){var _this338=this;return new Promise(function(r,n){var s=t.kind,o=_this338.displayer.applianceManager;try{if(_this338.addPaddingCreator(s,r),t!==_this338.pluginClasses[s])throw new Error("unregister invisible plugin class");o.putInvisiblePlugin(s,i)}catch(a){n(a),_this338.removePaddingCreator(s,r)}})}},{key:"dispose",value:function dispose(){this.disposer&&(this.disposer(),this.disposer=null);var t=!1;for(var i in this.plugins){try{this.plugins[i]._dispose(t)}catch(r){this.logger.error(r)}delete this.plugins[i]}}},{key:"refreshPlugin",value:function refreshPlugin(t){var i=this.displayer.applianceManager,r=t.kind;if(i.hasInvisibilePluginKind(r)){if(!this.plugins[r]){var s={kind:r,displayer:this.displayer},o=t,a=this.plugins[r]=new o(s);if(t.onCreate)try{t.onCreate(a)}catch(l){this.logger.error(l)}}var n=this.paddingCreators[r];if(n){delete this.paddingCreators[r];var _iterator272=_createForOfIteratorHelper(n),_step272;try{for(_iterator272.s();!(_step272=_iterator272.n()).done;){var _s45=_step272.value;_s45(this.plugins[r])}}catch(err){_iterator272.e(err)}finally{_iterator272.f()}}}else{var _n52=this.plugins[r],_s46=!0;if(_n52){delete this.plugins[r];try{_n52._dispose(_s46)}catch(o){this.logger.error(o)}if(t.onDestroy)try{t.onDestroy(_n52)}catch(o){this.logger.error(o)}}}}},{key:"addPaddingCreator",value:function addPaddingCreator(t,i){var r=this.paddingCreators[t];r||(r=this.paddingCreators[t]=[]),r.push(i)}},{key:"removePaddingCreator",value:function removePaddingCreator(t,i){var r=this.paddingCreators[t];if(r){var n=r.indexOf(i);n!==-1&&(r.splice(n,1),r.length===0&&delete this.paddingCreators[t])}}}]);return Lc}();var ht=P(require("mobx"));var Qp=/*#__PURE__*/function(){function Qp(t){var _this339=this;_classCallCheck(this,Qp);this._callbacks=new Qe;this.set={};this.autoUpdateMembers=function(){var t=_this339.applianceManager,i={};var _iterator273=_createForOfIteratorHelper(_this339.getMemberIds(t)),_step273;try{for(_iterator273.s();!(_step273=_iterator273.n()).done;){var _r225=_step273.value;_r225 in _this339.set?delete _this339.set[_r225]:_this339.dispatchEvent("onAdded",t,_r225),i[_r225]=_r225}}catch(err){_iterator273.e(err)}finally{_iterator273.f()}for(var _r224 in _this339.set){var n=_this339.set[_r224];_this339.dispatchEvent("onRemoved",t,n)}_this339.set=i};this.applianceManager=t,this.disposer=(0,ht.autorun)(this.autoUpdateMembers),(0,ht.makeObservable)(this,{refresh:ht.action})}_createClass(Qp,[{key:"callbacks",get:function get(){return this._callbacks}},{key:"forEach",value:function forEach(t){for(var i in this.set){t(this.applianceManager,this.set[i])}}},{key:"refresh",value:function refresh(){var t=this.applianceManager;this.disposer(),this.disposer=(0,ht.autorun)(this.autoUpdateMembers),this._callbacks.dispatch("onRefreshed",function(i){return i(t)})}},{key:"createMapper",value:function createMapper(t){return new Tw(this,t)}},{key:"dispose",value:function dispose(){this.disposer()}},{key:"dispatchEvent",value:function dispatchEvent(t,i,r){var _this340=this;setTimeout(function(){_this340._callbacks.dispatch(t,function(s){return(0,ht.runInAction)(function(){s(i,r)})})},0)}},{key:"getMemberIds",value:function getMemberIds(t){if(t.getMemberIds)return t.getMemberIds();var i=t.getMemberDisplayers(),r=[];var _iterator274=_createForOfIteratorHelper(i),_step274;try{for(_iterator274.s();!(_step274=_iterator274.n()).done;){var n=_step274.value.memberId;r.push(n)}}catch(err){_iterator274.e(err)}finally{_iterator274.f()}return r}}]);return Qp}(),Tw=/*#__PURE__*/function(){function Tw(t,i){var _this341=this;_classCallCheck(this,Tw);this._nodes=[];this.memberIds={};this.onAdded=function(t,i){i in _this341.memberIds||(_this341.memberIds[i]=!0,_this341._nodes.push(new Dc(t,i,_this341.mapper)))};this.onRemoved=function(t,i){var r=_this341._nodes.findIndex(function(n){return n.memberId===i});r!==-1&&(_this341._nodes.splice(r,1),delete _this341.memberIds[i])};this.onRefreshed=function(){_this341._nodes.splice(0,_this341._nodes.length),_this341.memberIds={},_this341.members.forEach(function(t,i){_this341.memberIds[i]=!0,_this341._nodes.push(new Dc(t,i,_this341.mapper))})};this.members=t,this.mapper=i,this.members.forEach(function(r,n){_this341.memberIds[n]=!0,_this341._nodes.push(new Dc(r,n,i))}),this.members.callbacks.on("onAdded",this.onAdded),this.members.callbacks.on("onRemoved",this.onRemoved),this.members.callbacks.on("onRefreshed",this.onRefreshed),(0,ht.makeObservable)(this,{_nodes:ht.observable,targets:ht.computed})}_createClass(Tw,[{key:"targets",get:function get(){var t=[];var _iterator275=_createForOfIteratorHelper(this._nodes),_step275;try{for(_iterator275.s();!(_step275=_iterator275.n()).done;){var i=_step275.value;t.push(i.target)}}catch(err){_iterator275.e(err)}finally{_iterator275.f()}return t}},{key:"dispose",value:function dispose(){this.members.callbacks.off("onAdded",this.onAdded),this.members.callbacks.off("onRemoved",this.onRemoved),this.members.callbacks.off("onRefreshed",this.onRefreshed)}}]);return Tw}(),Dc=/*#__PURE__*/function(){function Dc(t,i,r){_classCallCheck(this,Dc);this.applianceManager=t,this.memberId=i,this.mapper=r,(0,ht.makeObservable)(this,{target:ht.computed})}_createClass(Dc,[{key:"target",get:function get(){return this.mapper(this.applianceManager,this.memberId)}}]);return Dc}();function Ew(e){var _i61;if(!("getRectangle"in e.prototype))return e;var t=e;return _i61=/*#__PURE__*/function(_t19){_inherits(i,_t19);var _super98=_createSuper(i);function i(){var _this342;_classCallCheck(this,i);_this342=_super98.apply(this,arguments);_this342.cacheSegments={};_this342.cacheIdentifiers=[];_this342.isWrapped=!0;return _this342}_createClass(i,[{key:"getPrecisionSegments",value:function getPrecisionSegments(n){var s=_get(_getPrototypeOf(i.prototype),"getPrecisionSegments",this).call(this,n);return s||(s=this.cacheSegments[n]||null),s}},{key:"completePainting",value:function completePainting(n){var s=_get(_getPrototypeOf(i.prototype),"completePainting",this).call(this);if(s){var o,a;n?(o=n.originX,a=n.originY):(o=s.left,a=s.top),this.cachePrecisionSegments(s.identifier,{points:s.points,beginIndex:s.beginIndex,left:o,top:a})}return s}},{key:"fireRemoveComponent",value:function fireRemoveComponent(n){delete this.cacheSegments[n],_get(_getPrototypeOf(i.prototype),"fireRemoveComponent",this).call(this,n)}},{key:"cachePrecisionSegments",value:function cachePrecisionSegments(n,s){if(!this.cacheSegments[n]){this.cacheSegments[n]=s,this.cacheIdentifiers.push(n);var _i62=_i61,o=_i62.maxCacheCount;if(this.cacheIdentifiers.length>o){var a=this.cacheIdentifiers.shift();delete this.cacheSegments[a]}}}}]);return i}(t),_i61.maxCacheCount=3,_i61}var Fc=P(require("react"));var qp=/*#__PURE__*/function(){function qp(t,i,r){_classCallCheck(this,qp);this.mousePoint=null;this.follower=null;this.component=null;this.id=t,this.description=i,this.onRelease=r}_createClass(qp,[{key:"initScreen",value:function initScreen(t){this._screen=t}},{key:"release",value:function release(){this.component&&(this._screen.scene.removeComponent(this.component),this.component=null),this.onRelease(this.id)}},{key:"moveMouse",value:function moveMouse(t,i){var _this$_screen=this._screen,r=_this$_screen.width,n=_this$_screen.height,s=qp.mouseOffset,o=t-r/2+s.x,a=i-n/2+s.y;this.mousePoint?(this.mousePoint.x=o,this.mousePoint.y=a,this.follower&&this.moveFollower(this.follower,o,a)):(this.mousePoint={x:o,y:a},this.follower&&this.updateFollowerBecomeVisible(this.follower,this.mousePoint.x,this.mousePoint.y))}},{key:"releaseMouse",value:function releaseMouse(){this.mousePoint&&this.follower&&this.updateFoolowerBecomeHidden(),this.mousePoint=null}},{key:"setFollower",value:function setFollower(t){this.follower?t?(this.follower=t,this.mousePoint&&this.updateFollowerDescription(t)):(this.follower=null,this.mousePoint&&this.updateFoolowerBecomeHidden()):t&&(this.follower=t,this.mousePoint&&this.updateFollowerBecomeVisible(t,this.mousePoint.x,this.mousePoint.y))}},{key:"updateFollowerBecomeVisible",value:function updateFollowerBecomeVisible(t,i,r){this.component=this._screen.scene.addComponent({id:this.id,definition:this.description,originX:i-t.width/2,originY:r-t.height/2,width:t.width,height:t.height,absoluteCoordinates:!0,payload:{reactNode:t.reactNode}})}},{key:"updateFollowerDescription",value:function updateFollowerDescription(t){this.component.payload={reactNode:t.reactNode}}},{key:"moveFollower",value:function moveFollower(t,i,r){this.component.moveTo(i-t.width/2,r-t.height/2,$.Immediately)}},{key:"updateFoolowerBecomeHidden",value:function updateFoolowerBecomeHidden(){this._screen.scene.removeComponent(this.component)}}]);return qp}(),Bc=qp;Bc.mouseOffset=Object.freeze({x:-12,y:-19});var Zp=/*#__PURE__*/function(){function Zp(){_classCallCheck(this,Zp);this.previousId=0;this.followers={};this.follower=null;this.description=vo({name:"MouseFollower"})}_createClass(Zp,[{key:"refreshEngine",value:function refreshEngine(t){t.bind(this.description)(Jp)}},{key:"createMouseFollower",value:function createMouseFollower(){var _this343=this;var t="follower-".concat(this.previousId+=1),i=new Bc(t,this.description,function(r){delete _this343.followers[r]});return this.follower&&i.setFollower(this.follower),this.followers[t]=i,i}},{key:"setFollower",value:function setFollower(t){this.follower=t;for(var i in this.follower){this.followers[i].setFollower(t)}}}]);return Zp}(),Jp=/*#__PURE__*/function(_Fc$Component){_inherits(Jp,_Fc$Component);var _super99=_createSuper(Jp);function Jp(){_classCallCheck(this,Jp);return _super99.apply(this,arguments)}_createClass(Jp,[{key:"render",value:function render(){var _this$props105=this.props,t=_this$props105.cnode,i=_this$props105.size,r=_this$props105.payload;return Fc.createElement(Oi,{context:t,style:i},r.reactNode)}}]);return Jp}(Fc.Component);Jp.isVisible=!0;var jc=500,zs="/";function Aw(e){return _typeof(e)=="object"&&e!==null}var na=/*#__PURE__*/function(){function na(_ref130){var _this344=this;var t=_ref130.logger,i=_ref130.region,r=_ref130.boundless,n=_ref130.useMobXState,s=_ref130.preloadDynamicPPT,o=_ref130.userFonts,a=_ref130.pptHandler,l=_ref130.globalStateUpdater,h=_ref130.screenType,d=_ref130.cameraBound,u=_ref130.renderEngine,p=_ref130.undoStacksHub,f=_ref130.autoResize,m=_ref130.plugins,g=_ref130.wrappedComponents,y=_ref130.floatBarClass,b=_ref130.useMultiViews,v=_ref130.willHideSelfCursor,w=_ref130.disableCameraTransform,M=_ref130.memberStateStorage,x=_ref130.onlyCallbackRemoteStateModify,T=_ref130.invisiblePlugins,O=_ref130.handToolKey,R=_ref130.fontFamily,W=_ref130.disableOperations,J=_ref130.disableOthersSelectingBox,ee=_ref130.cursorAdapter,z=_ref130.eraserRadiusCursor,Re=_ref130.enableTextareHub,Ht=_ref130.enableSelfCurveAnime,Ne=_ref130.modulesOrigin,St=_ref130.disableCurveAnimes,Je=_ref130.disableRotation,wt=_ref130.disableNewPencilStroke,ki=_ref130.hotKeys,Ws=_ref130.copyOperator,Xc=_ref130.eventInterrupter,Qc=_ref130.callbacks,qc=_ref130.urlInterrupter,cm=_ref130.userPayload,hm=_ref130.pptParams;_classCallCheck(this,na);this.magixEventsManager=new Wp;this.preloadDynamicPPT=!1;this.mainViewProxy=null;this.membersMapper=null;this.context=null;this._views=null;this.libraryNodeFetcher=/*#__PURE__*/function(){var _ref131=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee90(t){var i,r,n;return regeneratorRuntime.wrap(function _callee90$(_context94){while(1){switch(_context94.prev=_context94.next){case 0:i="".concat(ae.modules.identifier,"/").concat(t.libIdentifier);_context94.next=3;return FS(i,_this344.modulesOrigin);case 3:r=_context94.sent;n=r.WhiteModel["default"];return _context94.abrupt("return",(_this344.logger.info("load modules ",i),Object.freeze({modules:r,libraryClass:n,appVersion:t.appVersion})));case 6:case"end":return _context94.stop();}}},_callee90)}));return function(_x166){return _ref131.apply(this,arguments)}}();this.covertMemberDisplayerToMember=function(t,i){var r=_this344.getMemberInformation(t,i),n=r?r.session:"",s=r&&r.payload,o=_this344.memberState(i);return o||(o=_this344.getDefaultMemberState()),{memberId:i,memberState:o,session:n,payload:s}};this.logger=t,this.region=i,this.useMobXState=n,this.boundless=r,this.screenType=h,this.eraserRadiusCursor=z,this.pluginOperator=this.createPluginOperator(),this.plugins=m,this.autoResize=f,this.modulesOrigin=Ne,this.cameraObserver=new fp,this.copyOperator=Ws,this.reactContext=new Gp,this.wrappedComponents=Object.freeze(_toConsumableArray(g)),this.onlyCallbackRemoteStateModify=x,this.pptHandler=a,this.invisiblePluginNode=new Lc(t,this,T),this.callbacks=new Qe(Qc),this.preloadDynamicPPT=s,this.mouseFollowerHub=new Zp,this.viewsParams={logger:t,displayer:this,renderEngine:u,undoStacksHub:p,boundless:r,cameraBound:d,fontFamily:R,cursorAdapter:ee,autoResize:f,floatBarClass:y,memberStateStorage:M,enableSelfCurveAnime:Ht,disableCurveAnimes:St,disableRotation:Je,disableNewPencilStroke:wt,mouseFollowerHub:this.mouseFollowerHub,wrappedComponents:this.createWrappedComponents(),disableOperations:W,willHideSelfCursor:v,handToolKey:O,eventInterrupter:Xc,urlInterrupter:qc,enableTextareHub:Re,userPayload:cm,pptParams:hm,hotKeys:ki,copyOperator:Ws,enableLaser:!b,setMemberStateWrapper:this.wrapSetMemberState.bind(this),onScreenSizeUpdated:function onScreenSizeUpdated(Hi){return _this344.onScreenSizeUpdated(Hi)}},this.dynamicPptParams={globalStateUpdater:l,observerId:ce,userFonts:o,preload:s,pptHandler:a,logger:t,pptParams:hm,userPayload:cm,pptAssetsOrigin:"https://convertcdn.netless.link/dynamicConvert",onPPTLoadProgress:function onPPTLoadProgress(Hi,Jr){return _this344.callbacks.dispatch("onPPTLoadProgress",function(en){return en(Hi,Jr)})},onPPTMediaPause:function onPPTMediaPause(Hi,Jr){return _this344.callbacks.dispatch("onPPTMediaPause",function(en){return en(Hi,Jr)})},onPPTMediaPlay:function onPPTMediaPlay(Hi,Jr){return _this344.callbacks.dispatch("onPPTMediaPlay",function(en){return en(Hi,Jr)})},onPPTMediaPlayError:function onPPTMediaPlayError(Hi,Jr,en){_this344.callbacks.dispatch("onPPTMediaPlayError",function(qw){return qw(Hi,Jr,en)})}},this.viewsHubProxy=new ta({observerId:ce,forcePPTLandscape:!1,disalbeImageHit:!1,disableBoundlessEvent:!0,disableOthersSelectingBox:J,cursorClass:null,cursorStyle:null,playerState:Object.freeze({isPlaying:!0,timestamp:0,playbackSpeed:1})}),b||(this.mainViewProxy=new ta({cameraBound:d,handToolActive:!1,divElement:null,disableCameraTransform:!!w}))}_createClass(na,[{key:"getMainViewIfExits",value:function getMainViewIfExits(){var t;return(t=this.mainViewProxy)==null?void 0:t.owner}},{key:"enableWriteNow",get:function get(){return!1}},{key:"deviceType",get:function get(){return this.boundless.deviceType}},{key:"observerId",get:function get(){return this.viewsHubProxy.state.observerId}},{key:"version",get:function get(){return ae.sdkVersion}},{key:"viewsHub",get:function get(){return this.viewsHubProxy.owner}},{key:"useMultiViews",get:function get(){return!this.mainViewProxy}},{key:"mainView",get:function get(){var t=this.mainViewProxy;if(t){var i=t.owner;if(i)return i}return null}},{key:"memberStateStorage",get:function get(){return this.viewsParams.memberStateStorage}},{key:"onScreenSizeUpdated",value:function onScreenSizeUpdated(t){}},{key:"createWrappedComponents",value:function createWrappedComponents(){return[].concat(_toConsumableArray(this.wrappedComponents),[this.reactContext.createWrappedComponent(Hp,this)])}},{key:"createPluginOperator",value:function createPluginOperator(){return Object.freeze({remove:function remove(){throw new Error("it is not a writable room")},update:function update(){throw new Error("it is not a writable room")},getPlugin:function getPlugin(){throw new Error("it is not a writable room")}})}},{key:"scalePptToFit",value:function scalePptToFit(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:$.Continuous;var i=this.state.sceneState.scenes[this.state.sceneState.index];i.ppt&&this.moveCameraToContain({originX:-i.ppt.width/2,originY:-i.ppt.height/2,width:i.ppt.width,height:i.ppt.height,animationMode:t})}},{key:"scenePathType",value:function scenePathType(t){var i=t.replace(/\/$/g,"").split(zs);i.shift();var r=this.applianceManager.scenes.findSceneOrGroup(i),n=this.context.modules.WhiteModel.SceneNode;if(r&&Ye(r,n))return ct.Page;if(r)return ct.Dir;for(;i.length>1;){i.pop();var s=this.applianceManager.scenes.findSceneOrGroup(i);if(s&&Ye(s,n))return ct.Conflict}return ct.None}},{key:"entireScenes",value:function entireScenes(){var t=this.applianceManager,i=t.getAllScenePaths(),r={};var _iterator276=_createForOfIteratorHelper(i),_step276;try{for(_iterator276.s();!(_step276=_iterator276.n()).done;){var n=_step276.value;var s=t.getScene(ue(n)),o=n.slice(0,-1),a="".concat(zs).concat(o.join(zs));r[a]=r[a]||[],s&&r[a].push(s)}}catch(err){_iterator276.e(err)}finally{_iterator276.f()}return r}},{key:"getScene",value:function getScene(t){var i=te.parse(t),r=this.applianceManager.getScene(i);return ue(r)}},{key:"refreshViewSize",value:function refreshViewSize(){var t;this.autoResize||(t=this.viewsHubProxy.owner)==null||t.forEach(function(i){return i.resizeScreen()})}},{key:"getCurrentSceneState",value:function getCurrentSceneState(){var t=this.applianceManager,i=At(t.getCurrentScenePath()),r=te.stringify(i),n=i.pop(),s=t.getSceneNames(i),o=te.stringify(i),a=[],l=Number.NaN;for(var h=0;h<s.length;++h){var d=s[h],u=t.getScene([].concat(_toConsumableArray(i),[d]));(u==null?void 0:u.name)===n&&(l=h),a[h]=ue(u)}return{sceneName:n,scenePath:r,contextPath:o,scenes:a,index:l}}},{key:"assignAttributes",value:function assignAttributes(t,i){if(this.context){var _r226=i;if(_r226===void 0||Aw(_r226)){var n=this.context.pluginManager.findPlugin(t);n&&Aw(n.defaultAttributes)&&(_r226=I(I({},n.defaultAttributes),_r226))}return _r226}}},{key:"hasLibraryNode",get:function get(){return!!this.context}},{key:"isEnableModifyWithoutThrowError",value:function isEnableModifyWithoutThrowError(){return!1}},{key:"isEnableModify",value:function isEnableModify(){return!1}},{key:"getDefaultMemberState",value:function getDefaultMemberState(){return{currentApplianceName:L.pencil,strokeColor:[0,0,0],strokeWidth:4,textSize:16,bold:!1,italic:!1,underline:!1,lineThrough:!1}}},{key:"bezierCurvePainter",get:function get(){return this.context?this.context.bezierCurvePainter:null}},{key:"getCursorStyleWithRadius",value:function getCursorStyleWithRadius(t){return t===0?void 0:this.eraserRadiusCursor.cursorStyle(t)}},{key:"putPlayerState",value:function putPlayerState(t){var i=Object.freeze(I(I({},this.viewsHubProxy.state.playerState),t));this.viewsHubProxy.putState({playerState:i})}},{key:"updateLibraryNode",value:function updateLibraryNode(t){var p;this.members=new Qp(this.applianceManager),this.membersMapper=(p=this.membersMapper)!=null?p:this.members.createMapper(this.covertMemberDisplayerToMember);var i=t.modules,_i$WhiteRender=i.WhiteRender,r=_i$WhiteRender.createDynamicPpt,n=_i$WhiteRender.EnginesHub,s=_i$WhiteRender.BezierCurvePainter,o=this.createPluginManager(i,this.pluginOperator,this.plugins),a=this.createBezierCurvePainter(s),l=r(D(I({},this.dynamicPptParams),{observerId:this.viewsHubProxy.state.observerId})),h=n&&new n(this.viewsParams.renderEngine),d=Object.freeze({appVersion:t.appVersion,applianceManager:this.applianceManager,members:this.members,pluginManager:o,dynamicPpt:l,bezierCurvePainter:a,engines:h,modules:i});if(this.mouseFollowerHub.refreshEngine(h.engines.mouseCurosrEngine),this.viewsHubProxy.owner)this.viewsHubProxy.owner.updateContext(d);else{var f=this.viewsHubProxy.state,m=new Rc(this.viewsParams,f,d);if(this.viewsHubProxy.updateOwner(m),this._views=new Nc(m),this.mainViewProxy){var g=this.mainViewProxy.state,y=m.createView(g);y.mode=Vt.FollowSceneAndCamera,this.mainViewProxy.updateOwner(y),this.cameraObserver.setupMainView(y),y.callbacks.forwardTo("onHandToolActive",this.callbacks),y.callbacks.forwardTo("onRenderDuration",this.callbacks)}}var u=new up({applianceManager:this.applianceManager,sceneNodeClass:i.WhiteModel.SceneNode});this.context=Object.freeze({modules:i,pluginManager:o,bezierCurvePainter:a,scenesCallbacksHub:u}),this.refreshViewSize()}},{key:"fireTriggerRebuild",value:function fireTriggerRebuild(){if(this.viewsHub.fireReloadLibrary(),this.members.refresh(),this.context){var _this$context=this.context,t=_this$context.scenesCallbacksHub,i=_this$context.modules;t.refresh({applianceManager:this.applianceManager,sceneNodeClass:i.WhiteModel.SceneNode})}}},{key:"createPluginManager",value:function createPluginManager(t,i,r){var n=t.WhiteRender.PluginManager,s=r?r.plugins:{},o=new n(s,i);return r&&r.setPluginManager(o),o}},{key:"createBezierCurvePainter",value:function createBezierCurvePainter(t){var i=null;if(t){var _r227=t;this.disablePencilWrittingLimitFrequency||(_r227=Ew(t)),i=new _r227(qr.curveConvergenceSteps),i.bezierRenderGranularity=xp,i.bezierMaxSegments=Pp}return i}},{key:"refreshRender",value:function refreshRender(){var t;(t=this.viewsHubProxy.owner)==null||t.forEach(function(i){return i.refreshRender()})}},{key:"disableOthersSelectingBox",get:function get(){return this.viewsHubProxy.state.disableOthersSelectingBox},set:function set(t){this.viewsHubProxy.putState({disableOthersSelectingBox:t})}},{key:"views",get:function get(){if(this.mainViewProxy)throw new Error("you can only read views when useMultiViews is true");if(!this._views)throw new Error("views is not ready");return this._views}},{key:"dispose",value:function dispose(){var t,i,r,n;(t=this.viewsHubProxy.owner)==null||t.forEach(function(s){return s.release()}),this.eraserRadiusCursor.release(),this.invisiblePluginNode.dispose(),this.cameraObserver.dispose(),(i=this.membersMapper)==null||i.dispose(),(r=this.members)==null||r.dispose(),(n=this.memberStateStorage)==null||n.dispose(),this.reactContext.dispose()}},{key:"setObserverId",value:function setObserverId(t){var r;((r=this.viewsHubProxy.owner)==null?void 0:r.putState({observerId:t}))&&this.dynamicPpt.updateObserverId&&this.dynamicPpt.updateObserverId(t)}},{key:"dynamicPpt",get:function get(){return this.viewsHubProxy.owner.dynamicPpt}},{key:"fetchNextPptSlideIfNeeded",value:function fetchNextPptSlideIfNeeded(t){var i;if(this.preloadDynamicPPT&&t.index+1<t.scenes.length){var n=(i=t.scenes[t.index+1].ppt)==null?void 0:i.src;this.dynamicPpt.getPptSildeDefinition(n||"")}}},{key:"getRoomMembers",value:function getRoomMembers(){return this.membersMapper.targets}},{key:"getInvisiblePlugin",value:function getInvisiblePlugin(t){return this.invisiblePluginNode.get(t)}},{key:"dispatchMagixEventWithObject",value:function dispatchMagixEventWithObject(t,i,r){var n=t;we(n.payload)&&(n=D(I({},n),{payload:n.payload.primitiveBuffer})),this.magixEventsManager.dispatchEvent(n,i,r)}},{key:"addMagixEventListener",value:function addMagixEventListener(t,i,r){var n=this.standardizeOptions(r),s=!!n.fireSelfEventAfterCommit,o=n.fireInterval;o===void 0?this.magixEventsManager.addMagixEventListener(t,i,s):(o<jc&&(this.logger.warn("fireInterval ".concat(o,"ms of event ").concat(JSON.stringify(t)," can't less than ").concat(jc,"ms, it's will be reset as ").concat(jc,"ms")),o=jc),this.magixEventsManager.addMagixEventsListener(t,i,o,s))}},{key:"standardizeOptions",value:function standardizeOptions(t){return typeof t=="undefined"?{}:typeof t=="number"?{fireInterval:t}:t}},{key:"removeMagixEventListener",value:function removeMagixEventListener(t,i){this.magixEventsManager.removeMagixEventListener(t,i)}},{key:"waitMagixEvent",value:function waitMagixEvent(t){return this.magixEventsManager.waitMagixEvent(t)}},{key:"createScenesCallback",value:function createScenesCallback(t,i){return this.context&&this.context.scenesCallbacksHub.create(t,i)}},{key:"memberState",value:function memberState(t){return ue(this.applianceManager.getMemberState(t))}},{key:"getMemberInformation",value:function getMemberInformation(t,i){if(t.getMemberInformation)return t.getMemberInformation(i);var r=t.getMemberDisplayers();var _iterator277=_createForOfIteratorHelper(r),_step277;try{for(_iterator277.s();!(_step277=_iterator277.n()).done;){var n=_step277.value;if(n.memberId===i)return n.information}}catch(err){_iterator277.e(err)}finally{_iterator277.f()}}},{key:"assertMainViewProxy",value:function assertMainViewProxy(){var t=this.mainViewProxy;if(!t)throw new Error("can not use these methods or properties. you should pass useMultiViews: false");return t}},{key:"scenePreview",value:function scenePreview(t,i,r,n,s){var o=this.assertMainViewProxy().owner;o&&o.scenePreview(t,i,r,n,s)}},{key:"generateScreenshot",value:function(){var _generateScreenshot2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee91(t,i,r){return regeneratorRuntime.wrap(function _callee91$(_context95){while(1){switch(_context95.prev=_context95.next){case 0:return _context95.abrupt("return",this.assertMainViewProxy().owner.generateScreenshot(t,i,r));case 1:case"end":return _context95.stop();}}},_callee91,this)}));function generateScreenshot(_x167,_x168,_x169){return _generateScreenshot2.apply(this,arguments)}return generateScreenshot}()},{key:"fillSceneSnapshot",value:function fillSceneSnapshot(t,i,r,n,s){var o;(o=this.assertMainViewProxy().owner)==null||o.fillSceneSnapshot(t,i,r,n,s)}},{key:"screenshotToCanvas",value:function screenshotToCanvas(t,i,r,n,s,o){var a;(a=this.assertMainViewProxy().owner)==null||a.screenshotToCanvas(t,i,r,n,s,o)}},{key:"getBoundingRect",value:function getBoundingRect(t){return this.assertMainViewProxy().owner.getBoundingRect(t)}},{key:"convertToPointInWorld",value:function convertToPointInWorld(t){var i=this.assertMainViewProxy().owner;return i?i.convertToPointInWorld(t):{x:t.x,y:t.y}}},{key:"handToolActive",get:function get(){return this.assertMainViewProxy().state.handToolActive},set:function set(t){this.assertMainViewProxy().putState({handToolActive:t})&&this.onlyCallbackRemoteStateModify&&this.callbacks.dispatch("onHandToolActive",function(n){return n(t)})}},{key:"handToolKey",get:function get(){return this.assertMainViewProxy().state.handToolKey}},{key:"disableCameraTransform",get:function get(){return this.assertMainViewProxy().state.disableCameraTransform},set:function set(t){this.assertMainViewProxy().putState({disableCameraTransform:t})&&this.onlyCallbackRemoteStateModify&&this.callbacks.dispatch("onHandToolActive",function(n){return n(t)})}},{key:"bindHtmlElement",value:function bindHtmlElement(t){this.assertMainViewProxy().putState({divElement:t})}},{key:"setCameraBound",value:function setCameraBound(t){this.assertMainViewProxy().putState({cameraBound:t})}},{key:"moveCamera",value:function moveCamera(t){this.assertMainViewProxy().putState({cameraMoving:{camera:t}})}},{key:"moveCameraToContain",value:function moveCameraToContain(t){this.assertMainViewProxy().putState({cameraMoving:{toContaint:t}})}}]);return na}();var le;(function(s){s.Connecting="connecting",s.Connected="connected",s.Reconnecting="reconnecting",s.Disconnecting="disconnecting",s.Disconnected="disconnected"})(le||(le={}));var Zr;(function(r){r.ThrowError="throwError",r.Warn="warn",r.Ignore="ignore"})(Zr||(Zr={}));var Lw=P(require("uuid"));var em=/*#__PURE__*/function(){function em(t){_classCallCheck(this,em);this.lastCommitValues={};this.sumNodes={};this.maxValues={};this.minValues={};this.lastCommitTimestamp=Date.now(),this.backgroundValues=Object.freeze(I({},t))}_createClass(em,[{key:"report",value:function report(){var t={},i={},r={};for(var n in this.backgroundValues){var s=this.backgroundValues[n],o=this.sumNodes[n],a=this.maxValues[n],l=this.minValues[n];if(o===void 0)t[n]=s;else if(o.otherValueSum===void 0)t[n]=o.firstValue;else{var h=this.lastCommitTimestamp-o.beginAt,d=h/o.count,u=o.firstValue*d+o.otherValueSum,p=d+h;p>0?t[n]=u/p:t[n]=s}a===void 0?i[n]=s:i[n]=a,l===void 0?r[n]=s:r[n]=l}return this.lastCommitTimestamp=Date.now(),this.sumNodes={},this.maxValues={},this.minValues={},{averageValues:t,maxValues:i,minValues:r}}},{key:"clean",value:function clean(){this.lastCommitTimestamp=Date.now(),this.sumNodes={},this.maxValues={},this.minValues={};for(var t in this.lastCommitValues){delete this.lastCommitValues[t]}}},{key:"commit",value:function commit(t){var i=Date.now();this.commitSumValues(i,t),this.commitMaxAndMinValues(t),this.lastCommitTimestamp=i}},{key:"commitSumValues",value:function commitSumValues(t,i){for(var _r228 in i){i[_r228]!==void 0&&(this.lastCommitValues[_r228]=i[_r228])}for(var _r229 in this.lastCommitValues){var n=this.lastCommitValues[_r229],s=this.sumNodes[_r229];s===void 0?this.sumNodes[_r229]={beginAt:t,firstValue:n,count:1,otherValueSum:n}:(s.count+=1,s.otherValueSum===void 0?s.otherValueSum=n*(t-s.beginAt):s.otherValueSum+=n*(t-this.lastCommitTimestamp))}}},{key:"commitMaxAndMinValues",value:function commitMaxAndMinValues(t){for(var i in t){var _r230=t[i],n=this.maxValues[i],s=this.minValues[i];n===void 0?this.maxValues[i]=_r230:this.maxValues[i]=Math.max(n,_r230),s===void 0?this.minValues[i]=_r230:this.minValues[i]=Math.min(s,_r230)}}}]);return em}();var Uc=/*#__PURE__*/function(){function Uc(_ref132){var _this345=this;var t=_ref132.connection,i=_ref132.disconnection,r=_ref132.sample;_classCallCheck(this,Uc);this.statisticsTimer=null;this.onReportStatistics=function(){_this345.statisticsTimer=null,_this345.latestReportAt=Date.now();var _this345$statistics$r=_this345.statistics.report(),t=_this345$statistics$r.maxValues,i=_this345$statistics$r.minValues,r=_this345$statistics$r.averageValues;_this345.sampleCommitter.commit({maxRTT:t.rtt,minRTT:i.rtt,averageRTT:r.rtt,maxQueue:t.illusionQueueLength,minQueue:i.illusionQueueLength,averageQueue:r.illusionQueueLength,maxInterval:t.frameReceivedInterval,minInterval:i.frameReceivedInterval,averageInterval:r.frameReceivedInterval})};this.connectionCommitter=t,this.disconnectionCommitter=i,this.sampleCommitter=r,this.statistics=new em({rtt:0,frameReceivedInterval:0,illusionQueueLength:0})}_createClass(Uc,[{key:"commitConnection",value:function commitConnection(t){this.connectionCommitter.commit(t)}},{key:"commitDisconnection",value:function commitDisconnection(t){this.disconnectionCommitter.commit(t)}},{key:"commitStatistics",value:function commitStatistics(t){if(this.latestReportAt===void 0&&(this.latestReportAt=Date.now()),this.statisticsTimer===null){var i=this.latestReportAt+Uc.reportStatisticsInterval,_r231=Date.now(),n=i-_r231;n<0&&(n=Uc.reportStatisticsInterval,this.statistics.clean()),this.statisticsTimer=setTimeout(this.onReportStatistics,n)}this.statistics.commit(t)}},{key:"stop",value:function stop(){this.statisticsTimer!==null&&(clearTimeout(this.statisticsTimer),this.statisticsTimer=null)}}]);return Uc}(),zc=Uc;zc.reportStatisticsInterval=60*1e3;var se;(function(x){x.Hand="cursor-hand",x.HandGrasp="cursor-hand-grasp",x.LaserPointer="cursor-laserPointer",x.Selector="cursor-selector",x.Pencil="cursor-pencil",x.Eraser="cursor-eraser",x.PencilEraser1="cursor-pencil-eraser-1",x.PencilEraser2="cursor-pencil-eraser-2",x.PencilEraser3="cursor-pencil-eraser-3",x.Rectangle="cursor-rectangle",x.Ellipse="cursor-ellipse",x.Shape="cursor-shape",x.Straight="cursor-straight",x.Arrow="cursor-arrow",x.Text="cursor-text",x.Nwse="cursor-nwse",x.Nesw="cursor-nesw",x.Ns="cursor-ns",x.Ew="cursor-ew",x.Rotation="cursor-rotation",x.Ban="cursor-ban"})(se||(se={}));var Ow=Object.freeze((_Object$freeze2={},_defineProperty(_Object$freeze2,se.Hand,Object.freeze(["url(".concat(q["hand-loosen"],") 7 7, auto;"),"-webkit-image-set(url(".concat(q["hand-loosen"],") 7 7, auto);")])),_defineProperty(_Object$freeze2,se.HandGrasp,Object.freeze(["url(".concat(q["hand-grasp"],") 6 6, auto;"),"-webkit-image-set(url(".concat(q["hand-grasp"],") 6 6, auto);")])),_defineProperty(_Object$freeze2,se.LaserPointer,Object.freeze(["url(".concat(q["laser-pointer-cursor"],") 14 14, auto;"),"-webkit-image-set(url(".concat(q["laser-pointer-cursor"],") 14 14, auto);")])),_defineProperty(_Object$freeze2,se.Rotation,Object.freeze(["url(".concat(q.rotation,") 12 12, auto;"),"-webkit-image-set(url(".concat(q.rotation,") 12 12, auto);")])),_defineProperty(_Object$freeze2,se.Selector,Object.freeze(["url(".concat(q["selector-cursor"],") 5 4, auto;"),"-webkit-image-set(\n            url(".concat(q["selector-cursor"],") 1x,\n            url(").concat(q["selector-cursor@2x"],") 2x) 5 4, auto;")])),_defineProperty(_Object$freeze2,se.Pencil,Object.freeze(["url(".concat(q["pencil-cursor"],") 2 22, auto;"),"-webkit-image-set(\n            url(".concat(q["pencil-cursor"],") 1x,\n            url(").concat(q["pencil-cursor@2x"],") 2x) 2 22, auto;")])),_defineProperty(_Object$freeze2,se.Eraser,Object.freeze(["url(".concat(q["eraser-cursor"],") 8 18, auto;"),"-webkit-image-set(\n            url(".concat(q["eraser-cursor"],") 1x,\n            url(").concat(q["eraser-cursor@2x"],") 2x) 8 18, auto;")])),_defineProperty(_Object$freeze2,se.PencilEraser1,Object.freeze(["url(".concat(q["pencil-eraser-1"],") 9 13, auto;"),"-webkit-image-set(url(".concat(q["pencil-eraser-1"],") 9 13, auto);")])),_defineProperty(_Object$freeze2,se.PencilEraser2,Object.freeze(["url(".concat(q["pencil-eraser-2"],") 13 17, auto;"),"-webkit-image-set(url(".concat(q["pencil-eraser-2"],") 13 17, auto);")])),_defineProperty(_Object$freeze2,se.PencilEraser3,Object.freeze(["url(".concat(q["pencil-eraser-3"],") 17 25, auto;"),"-webkit-image-set(url(".concat(q["pencil-eraser-3"],") 17 25, auto);")])),_defineProperty(_Object$freeze2,se.Rectangle,Object.freeze(["crosshair;"])),_defineProperty(_Object$freeze2,se.Ellipse,Object.freeze(["crosshair;"])),_defineProperty(_Object$freeze2,se.Shape,Object.freeze(["crosshair;"])),_defineProperty(_Object$freeze2,se.Straight,Object.freeze(["crosshair;"])),_defineProperty(_Object$freeze2,se.Arrow,Object.freeze(["crosshair;"])),_defineProperty(_Object$freeze2,se.Text,Object.freeze(["text;"])),_defineProperty(_Object$freeze2,se.Nwse,Object.freeze(["nwse-resize;"])),_defineProperty(_Object$freeze2,se.Nesw,Object.freeze(["nesw-resize;"])),_defineProperty(_Object$freeze2,se.Ns,Object.freeze(["ns-resize;"])),_defineProperty(_Object$freeze2,se.Ew,Object.freeze(["ew-resize;"])),_defineProperty(_Object$freeze2,se.Ban,Object.freeze(["not-allowed"])),_Object$freeze2)),Rw=/*#__PURE__*/function(){function Rw(){_classCallCheck(this,Rw);this.isInjected=!1}_createClass(Rw,[{key:"injectDefaultStyleIfNotInjectBefore",value:function injectDefaultStyleIfNotInjectBefore(){this.isInjected||(this.injectToDom(Ow),this.isInjected=!0)}},{key:"injectCustomStyle",value:function injectCustomStyle(t){if(this.isInjected)throw new Error("cannot be called repeatedly, or after new WhiteWebSdk().");var i=I(I({},Ow),t);this.injectToDom(i),this.isInjected=!0}},{key:"injectToDom",value:function injectToDom(t){if(Object.keys(t).length>0){var i=document.createElement("style"),_r232=[];for(var s in t){var o=t[s];if(o){var a=".netless-whiteboard.".concat(s," {\n                        ").concat(o.map(function(l){return"cursor: ".concat(l)}).join(""),"\n                    }");_r232.push(a)}}i.appendChild(document.createTextNode(_r232.join("")));var n=document.head;n&&n.appendChild(i)}}}]);return Rw}(),tm=new Rw;function Nw(e){tm.injectCustomStyle(e)}var Us=P(require("mobx")),im=/*#__PURE__*/function(){function im(t){_classCallCheck(this,im);this.useMobX=t}_createClass(im,[{key:"filter",value:function filter(t){return this.useMobX?this.copyValue(t):t}},{key:"copyValue",value:function copyValue(t){return _typeof(t)!="object"||t===null?t:(0,Us.isObservableObject)(t)?this.copyObservableObject(t):(0,Us.isObservableArray)(t)||t instanceof Array?this.copyArray(t):this.copyObject(t)}},{key:"copyObservableObject",value:function copyObservableObject(t){var i={};var _iterator278=_createForOfIteratorHelper((0,Us.keys)(t)),_step278;try{for(_iterator278.s();!(_step278=_iterator278.n()).done;){var _r233=_step278.value;i[_r233]=this.copyValue(t[_r233])}}catch(err){_iterator278.e(err)}finally{_iterator278.f()}return i}},{key:"copyArray",value:function copyArray(t){var i=[],r=t.length;for(var n=0;n<r;++n){i[n]=this.copyValue(t[n])}return i}},{key:"copyObject",value:function copyObject(t){var i={};for(var _r234 in t){i[_r234]=this.copyValue(t[_r234])}return i}}]);return im}();var rm=/*#__PURE__*/function(){function rm(t,i,r){var _this346=this;_classCallCheck(this,rm);this.queue=[];this.limiter=new dt(i,function(){var n=_this346.queue.shift();if(n){try{r(n.event,n.payload)}catch(s){t.error(s)}_this346.queue.length>0&&_this346.limiter.invoke()}})}_createClass(rm,[{key:"dispatch",value:function dispatch(t,i){this.queue.push({event:t,payload:i}),this.limiter.invoke()}}]);return rm}();var nm=/*#__PURE__*/function(){function nm(){_classCallCheck(this,nm);this.copyBuffer=null}_createClass(nm,[{key:"cleanBuffer",value:function cleanBuffer(){this.copyBuffer=null}},{key:"duplicate",value:function duplicate(t,i){return t.duplicate(this.createDelta(),this.createDelta(),i)}},{key:"copy",value:function copy(t,i){this.copyBuffer=t.copy(null,i)}},{key:"paste",value:function paste(t,i){var r=null;return this.copyBuffer&&(r=t.paste(this.copyBuffer,this.createDelta(),this.createDelta(),i)),r}},{key:"createDelta",value:function createDelta(){var t=nm.maxDeltaDistance;return t*(Math.random()*2-1)}}]);return nm}(),Vc=nm;Vc.maxDeltaDistance=12;var sm=function sm(){var _this347=this;_classCallCheck(this,sm);this.onPageJumpTo=function(t,i){var r="".concat(t,"/").concat(i,".slide"),n=_this347.room.state.sceneState.scenes,s=n.findIndex(function(o){return!!o.ppt&&o.ppt.src.endsWith(r)});s>=0&&_this347.room.setSceneIndex(s)};this.onPageToNext=function(){var _this347$room$state$s=_this347.room.state.sceneState,t=_this347$room$state$s.scenes,i=_this347$room$state$s.index;i<t.length-1&&_this347.room.setSceneIndex(i+1)};this.onPageToPrev=function(){var t=_this347.room.state.sceneState.index;t>=1&&_this347.room.setSceneIndex(t-1)}};var gE=500,yE="__netlessMemberState",bE=1,sa="modules",Vs=/*#__PURE__*/function(){function Vs(t){var _this348=this;_classCallCheck(this,Vs);this.writingBuffer=null;this.invoker=function(){var t=_this348.writingBuffer;t&&_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee92(){var i;return regeneratorRuntime.wrap(function _callee92$(_context96){while(1){switch(_context96.prev=_context96.next){case 0:_this348.limiter.freeze();_context96.prev=1;i={uid:_this348.uid,timestamp:Date.now(),memberState:t};_context96.next=5;return _this348.write(_this348.uuid,JSON.stringify(i));case 5:_context96.prev=5;_this348.limiter.unfreeze();return _context96.finish(5);case 8:case"end":return _context96.stop();}}},_callee92,null,[[1,,5,8]])}))()["catch"](function(i){return console.error(i)})};this.uid=t,this.limiter=new dt(gE,this.invoker)}_createClass(Vs,[{key:"getMemberState",value:function(){var _getMemberState=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee93(t,i){var r,n;return regeneratorRuntime.wrap(function _callee93$(_context97){while(1){switch(_context97.prev=_context97.next){case 0:_context97.next=2;return this.read(t);case 2:r=_context97.sent;if(!r){_context97.next=7;break}n=JSON.parse(r);if(!(n.uid===i)){_context97.next=7;break}return _context97.abrupt("return",this.writingBuffer=n.memberState);case 7:return _context97.abrupt("return",null);case 8:case"end":return _context97.stop();}}},_callee93,this)}));function getMemberState(_x170,_x171){return _getMemberState.apply(this,arguments)}return getMemberState}()},{key:"setMemberState",value:function setMemberState(t){var i={};var _iterator279=_createForOfIteratorHelper(lw),_step279;try{for(_iterator279.s();!(_step279=_iterator279.n()).done;){var _r235=_step279.value;var n=t[_r235];n!==void 0&&(i[_r235]=n)}}catch(err){_iterator279.e(err)}finally{_iterator279.f()}this.limiter.invoke(),this.writingBuffer=I(I({},this.writingBuffer),ue(i))}},{key:"dispose",value:function dispose(){this.limiter.cancel(),this.writingBuffer=null}},{key:"read",value:function(){var _read=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee94(t){var r,n;return regeneratorRuntime.wrap(function _callee94$(_context98){while(1){switch(_context98.prev=_context98.next){case 0:_context98.next=2;return Vs.dbp;case 2:r=_context98.sent.transaction([sa],"readonly").objectStore(sa).get(t);_context98.next=5;return om(r);case 5:n=_context98.sent;return _context98.abrupt("return",(typeof n!="string"&&(n=void 0),n));case 7:case"end":return _context98.stop();}}},_callee94)}));function read(_x172){return _read.apply(this,arguments)}return read}()},{key:"write",value:function(){var _write=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee95(t,i){var n;return regeneratorRuntime.wrap(function _callee95$(_context99){while(1){switch(_context99.prev=_context99.next){case 0:_context99.next=2;return Vs.dbp;case 2:n=_context99.sent.transaction([sa],"readwrite").objectStore(sa).put(i,t);_context99.next=5;return om(n);case 5:case"end":return _context99.stop();}}},_callee95)}));function write(_x173,_x174){return _write.apply(this,arguments)}return write}()}],[{key:"dbp",get:function get(){if(!this._dbp){var t=indexedDB.open(yE,bE);t.onupgradeneeded=function(i){i.target.result.createObjectStore(sa)},this._dbp=om(t)}return this._dbp}}]);return Vs}();function om(e){return new Promise(function(t,i){e.onsuccess=function(){return t(e.result)},e.onerror=function(){if(e.error){var _r236=new Error(e.error.message);_r236.name=e.error.name,i(_r236)}else i(new Error("failed with null Error"))}})}var Ui=/*#__PURE__*/function(_na){_inherits(Ui,_na);var _super100=_createSuper(Ui);function Ui(t){var _this349;_classCallCheck(this,Ui);_this349=_super100.call(this,{logger:t.whiteLogger,region:t.region,useMobXState:t.useMobXState,screenType:t.screenType,renderEngine:t.renderEngine,boundless:t.boundless,cameraBound:t.cameraBound,autoResize:t.autoResize,plugins:t.plugins,invisiblePlugins:t.invisiblePlugins,wrappedComponents:t.wrappedComponents,preloadDynamicPPT:t.preloadDynamicPPT,disableCameraTransform:t.disableCameraTransform,useMultiViews:t.useMultiViews,userFonts:t.userFonts,handToolKey:t.handToolKey,fontFamily:t.fontFamily,pptHandler:t.useMultiViews?void 0:new sm,memberStateStorage:t.disableKeepMemberState?void 0:new Vs(t.userPayload.uid),onlyCallbackRemoteStateModify:t.onlyCallbackRemoteStateModify,enableTextareHub:t.enableTextareHub,floatBarClass:t.floatBarOptions&&Wc,globalStateUpdater:function globalStateUpdater(i){return _this349.setGlobalState(i)},disableOperations:!1,disableOthersSelectingBox:t.disableOthersSelectingBox,disableCurveAnimes:t.disableCurveAnimes,disableRotation:t.disableRotation,disableNewPencilStroke:t.disableNewPencilStroke,willHideSelfCursor:!1,cursorAdapter:t.cursorAdapter,eraserRadiusCursor:t.eraserRadiusCursor,eventInterrupter:function eventInterrupter(i){return _this349.willInterruptEvent(i)},urlInterrupter:t.urlInterrupter,callbacks:t.callbacks,pptParams:t.pptParams,userPayload:t.userPayload,hotKeys:new hp(t.hotKeys),copyOperator:new Vc,enableSelfCurveAnime:!1,undoStacksHub:new sc(t.undoCacheScenesCount,function(i,r){_this349.applianceManager.execute(i,r)}),modulesOrigin:t.modulesOrigin});_this349.apiFetch=ec.fetch("api");_this349._phase=le.Connecting;_this349._isWritable=!1;_this349._enableWriteNow=!1;_this349.isEraser=!1;_this349.disableSerializationCache=!0;_this349.didConnected=!1;_this349.viewInputsHub=null;_this349.viewStateObserver=null;_this349.beginReconnectAt=0;_this349.isHandGrasp=!1;_this349.onRoomStateChanged=function(t){t.globalState&&_this349.dynamicPpt.setGlobalState(ue(t.globalState)),t.memberState&&(_this349.isEraser=Ui.checkIsEraser(t.memberState.currentApplianceName),_this349.refreshShouldDisableImageHit(),_this349.refreshCursorClass()),t.sceneState&&_this349.fetchNextPptSlideIfNeeded(t.sceneState),_this349.callbacks.dispatch("onRoomStateChanged",function(i){return i(t)})};_this349.onReceivedHandMouseEvent=function(t,i,r){if(_this349.magix.phase===j.Connected)switch(i.kind){case S.MouseDown:case S.SortedTouchStart:{_this349.isHandGrasp=!0,t.putState({handToolActive:!0}),_this349.refreshCursorClass();break}case S.MouseUp:case S.SortedTouchEnd:case S.SortedTouchCancel:{_this349.isHandGrasp=!1,t.putState({handToolActive:!1}),_this349.refreshCursorClass();break}}};_this349.onHandMouseEventCompleted=function(t){_this349.isHandGrasp=!1,t.putState({handToolActive:!1}),_this349.refreshCursorClass()};_this349.onModified=function(){if(_this349._phase===le.Connected){var _t20=_this349.viewStateObserver;pe.Follower===_t20.getCurrentMode()&&_t20.refreshCameraRectangle()}};_this349.onReconnected=function(t){var i;(i=_this349.statistics)==null||i.commitConnection(D(I({},t),{isReconnection:!0})),_this349.fireTriggerRebuild(),_this349.syncCameraToRemote(),_this349.magix.isWritable&&(_this349.receoverDisableSerialization(),_this349.recoverMemberState()["catch"](function(r){return console.error(r)}),_this349.refreshPptState())};_this349.onDisconnectWithError=function(t){var i;_this349.beginReconnectAt!==0&&((i=_this349.statistics)==null||i.commitDisconnection({isReconnection:!0,duration:Date.now()-_this349.beginReconnectAt})),_this349.callbacks.dispatch("onDisconnectWithError",function(r){return r(t)}),_this349.logger.error("onDisconnectWithError",t)};_this349.updateSelfUserId=function(t){t===void 0?(_this349.setObserverId(ce),_this349._isWritable=!1):(_this349.setObserverId(t),_this349._isWritable=!0),_this349.refreshSyncOperations(),_this349.refreshCursorClass()};_this349.onCameraTransform=function(t){le.Connected===_this349._phase&&fi.Begin===t&&pe.Follower===_this349.stateTrigger.state.broadcastState.mode&&(_this349._isWritable?_this349.applianceManager.setViewState({mode:pe.Freedom}):_this349.viewStateObserver.overrideWithFreedom(!0))};_this349.onCameraUpdated=function(){if(_this349._isWritable)switch(_this349.stateTrigger.state.broadcastState.mode){case pe.Broadcaster:case pe.Freedom:{_this349.syncCameraToRemoteLimiter.invoke();break}}};_this349.syncCameraToRemote=function(){var _assertThisInitialize=_assertThisInitialized(_this349),t=_assertThisInitialize.mainView;if(_this349._isWritable&&t&&_this349.phase===le.Connected){var i=t.screen,_r237=i.visionRectangle,n=i.camera.scale*_o(_this349.screenType);_this349.applianceManager.setViewState({originX:_r237.originX,originY:_r237.originY,width:_r237.width,height:_r237.height,pixelWidth:n})}};_this349.updateSession=function(t){_this349.logger.context=D(I({},_this349.logger.context),{session:t})};_this349.onPhaseChanged=function(t){_this349.logger.info("change room phase to "+t),t===j.Disconnected&&_this349.dispose();var i=le.Connecting;switch(t){case j.Ready:case j.Connecting:{i=le.Connecting;break}case j.Connected:{i=le.Connected;break}case j.Reconnecting:{i=le.Reconnecting;break}case j.Disconnecting:{i=le.Disconnecting;break}case j.Disconnected:{i=le.Disconnected;break}}switch(i){case le.Reconnecting:{_this349.beginReconnectAt=Date.now();break}case le.Connected:{_this349.beginReconnectAt=0;break}}var r=_this349._phase!==i;_this349._phase=i,_this349.refreshSyncOperations(),_this349.didConnected&&_this349.refreshCursorClass(),r&&_this349.callbacks.dispatch("onPhaseChanged",function(n){return n(i)})};_this349.dispatchEvent=function(t,i){var r=i;r instanceof ArrayBuffer&&(r=ai(r)),_this349.magix.dispatch(t,r)};_this349.uid=t.userPayload.uid,_this349.statistics=t.qualityComitters&&new zc(t.qualityComitters),_this349.rejectWhenReadonlyErrorLevel=t.rejectWhenReadonlyErrorLevel||Zr.ThrowError,_this349.disablePencilWrittingLimitFrequency=t.disablePencilWrittingLimitFrequency,_this349.magix=t.akkoApp.createMagix({logger:_this349.logger,userPayload:t.userPayload,libraryNodeFetcher:_this349.libraryNodeFetcher,callbacks:{onPhaseChanged:_this349.onPhaseChanged,onDisconnectWithError:_this349.onDisconnectWithError,onModified:_this349.onModified,onSelfUserIdUpdate:_this349.updateSelfUserId,onSessionChanged:_this349.updateSession,onEventFire:function onEventFire(i){return _this349.dispatchMagixEventWithObject(i,!1,i.authorId===_this349.observerId)},onEventFireACK:function onEventFireACK(i){return _this349.dispatchMagixEventWithObject(i,!0,i.authorId===_this349.observerId)},onReconnected:_this349.onReconnected,onKickedWithReason:function onKickedWithReason(i){return _this349.callbacks.dispatch("onKickedWithReason",function(r){return r(i)})},onCatchErrorWhenAppendFrame:function onCatchErrorWhenAppendFrame(i,r){_this349.callbacks.dispatch("onCatchErrorWhenAppendFrame",function(n){return n(i,r)})},onSliceChanged:function onSliceChanged(i){return _this349.callbacks.dispatch("onSliceChanged",function(r){return r(i)})},onReceivedRttReport:_this349.statistics&&function(i){return _this349.statistics.commitStatistics({rtt:i})},onIllusionQueueLengthChanged:_this349.statistics&&function(i){_this349.statistics.commitStatistics({illusionQueueLength:i})},onFrameReceivedInterval:_this349.statistics&&function(i){_this349.statistics.commitStatistics({frameReceivedInterval:i})}}}),_this349.eventsQueue=t.disableMagixEventDispatchLimit?null:new rm(_this349.logger,dw,_this349.dispatchEvent),_this349._disableDeviceInputs=t.disableDeviceInputs,_this349._disableEraseImage=t.disableEraseImage,_this349.syncCameraToRemoteLimiter=new dt(uw,_this349.syncCameraToRemote),_this349.newPencilWritingQuality=t.newPencilWritingQuality,_this349.parametersFilter=new im(t.useMobXState),_this349.floatBarOptions=t.floatBarOptions,_this349.pptHandler&&(_this349.pptHandler.room=_assertThisInitialized(_this349));return _this349}_createClass(Ui,[{key:"applianceManager",get:function get(){return this.magix.trigger}},{key:"isWritable",get:function get(){return this.magix.isWritable}},{key:"enableWriteNow",get:function get(){return this._enableWriteNow}},{key:"setWritable",value:function(){var _setWritable2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee96(t){var _this350=this;var i,_r238,n;return regeneratorRuntime.wrap(function _callee96$(_context100){while(1){switch(_context100.prev=_context100.next){case 0:this.logger.info("set writable "+t);i=this.viewStateObserver;if(!t){_context100.next=14;break}_context100.next=5;return this.magix.setWritable(t,this.deviceType);case 5:this.pencilOptions.becomeWritable(this.applianceManager);_r238=this.applianceManager.getViewState().mode;if(_r238!==pe.Broadcaster){n=i.getCurrentMode();n!==_r238&&this.stateTrigger.activeUpdate("broadcastState",function(){return _this350.applianceManager.setViewState({mode:n}),i.getBroadcastState()})}_context100.next=10;return this.recoverMemberState();case 10:this.syncCameraToRemote();i.setReadonlyMode(!1);_context100.next=17;break;case 14:i.setReadonlyMode(!0);_context100.next=17;return this.magix.setWritable(t);case 17:case"end":return _context100.stop();}}},_callee96,this)}));function setWritable(_x175){return _setWritable2.apply(this,arguments)}return setWritable}()},{key:"disableDeviceInputs",get:function get(){return this._disableDeviceInputs},set:function set(t){this._disableDeviceInputs=t,this.refreshSyncOperations(),this.refreshCursorClass()}},{key:"disableEraseImage",get:function get(){return this._disableEraseImage},set:function set(t){this._disableEraseImage=t,this.refreshShouldDisableImageHit()}},{key:"disableSerialization",get:function get(){return this._phase===le.Connected?this.disableSerializationCache:!0},set:function set(t){this.isEnableModify()&&(t&&this.copyOperator.cleanBuffer(),this.applianceManager.setEnableExecute(!t),this.disableSerializationCache=t)}},{key:"uuid",get:function get(){return this._uuid}},{key:"session",get:function get(){return this.magix.session}},{key:"slice",get:function get(){return this.magix.slice}},{key:"roomToken",get:function get(){return this._roomToken}},{key:"phase",get:function get(){return this._phase}},{key:"calibrationTimestamp",get:function get(){return this.magix.calibrationTimestamp}},{key:"state",get:function get(){return this.stateTrigger.state}},{key:"timeDelay",get:function get(){return this.magix.timeDelay},set:function set(t){this.magix.timeDelay=t}},{key:"setupLibraryNode",value:function setupLibraryNode(t,i){var _this351=this;var o;var r=this.mainView;this.viewInputsHub=new Dp({deviceType:t,screenType:this.screenType,magix:this.magix,pencilOptions:this.pencilOptions,onReceivedHandMouseEvent:this.onReceivedHandMouseEvent,onHandMouseEventCompleted:this.onHandMouseEventCompleted}),this.updateLibraryNode(i),this.viewStateObserver=new ia(this.viewsHub,this.magix.trigger),this.viewsHub.setupViewInput({viewInputsHub:this.viewInputsHub,magix:this.magix,viewsHub:this.viewsHub,cameraObserver:this.cameraObserver,pencilOptions:this.pencilOptions,bezierCurvePainter:this.bezierCurvePainter,disablePencilWrittingLimitFrequency:this.disablePencilWrittingLimitFrequency,newPencilWritingQuality:this.newPencilWritingQuality,getCursorStyleWithRadius:function getCursorStyleWithRadius(a){return _this351.getCursorStyleWithRadius(a)}}),r&&this.unregisterMainView(r),this.mainView&&this.registerMainView(this.mainView);var n=this.cameraObserver,s=this.applianceManager;this.stateTrigger=new Ho({useMobXMode:this.useMobXState,disableMaskKey:this.onlyCallbackRemoteStateModify,onStateChanged:this.onRoomStateChanged,propertyGetters:{globalState:function globalState(){return s.getGlobalState()},memberState:function memberState(){return s.getMemberState()||_this351.getDefaultMemberState()},roomMembers:function roomMembers(){return _this351.getRoomMembers()},sceneState:function sceneState(){return _this351.getCurrentSceneState()},broadcastState:function broadcastState(){return _this351.viewStateObserver.getBroadcastState()},cameraState:function cameraState(){return n.cameraState}}}),this.invisiblePluginNode.isWatching=!0,this.isEraser=Ui.checkIsEraser((o=this.stateTrigger.state.memberState)==null?void 0:o.currentApplianceName),this.dynamicPpt.setGlobalState(ue(s.getGlobalState())),this.refreshSyncOperations(),this.refreshCursorClass(),this.refreshShouldDisableImageHit()}},{key:"registerMainView",value:function registerMainView(t){var _this352=this;t.callbacks.on("onKeyDown",function(i){return _this352.callbacks.dispatch("onKeyDown",function(r){return r(i)})}),t.callbacks.on("onKeyUp",function(i){return _this352.callbacks.dispatch("onKeyUp",function(r){return r(i)})}),t.callbacks.on("onCanRedoStepsUpdate",function(i){return _this352.callbacks.dispatch("onCanRedoStepsUpdate",function(r){return r(i)})}),t.callbacks.on("onCanUndoStepsUpdate",function(i){return _this352.callbacks.dispatch("onCanUndoStepsUpdate",function(r){return r(i)})}),t.cameraman.addCameraTransformationListener(this.onCameraTransform),t.screen.addCameraUpdatedListener(this.onCameraUpdated)}},{key:"unregisterMainView",value:function unregisterMainView(t){t.callbacks.off("onKeyDown"),t.callbacks.off("onKeyUp"),t.callbacks.off("onCanRedoStepsUpdate"),t.callbacks.off("onCanUndoStepsUpdate"),t.cameraman.removeCameraTransformationListener(this.onCameraTransform),t.screen.removeCameraUpdatedListener(this.onCameraUpdated)}},{key:"dispose",value:function dispose(){var t;_get(_getPrototypeOf(Ui.prototype),"dispose",this).call(this),this.didConnected&&this.viewsHub.releaseViewInput(),(t=this.viewStateObserver)==null||t.release(),this.didConnected&&this.stateTrigger.release()}},{key:"willInterruptEvent",value:function willInterruptEvent(t){if(t instanceof KeyboardEvent){var i=!1;return this.callbacks.dispatch("willInterceptKeyboardEvent",function(r){r(t)&&(i=!0)}),i}return!1}},{key:"refreshSyncOperations",value:function refreshSyncOperations(){var t=!this._isWritable||this._phase===le.Reconnecting||this._phase===le.Disconnecting||this._phase===le.Disconnected,i=t||this._disableDeviceInputs;this.hasLibraryNode&&(this.viewsHub.putState({disableBoundlessEvent:i}),this.dynamicPpt.setDisableInteractive(i)),this._enableWriteNow!==t&&(this._enableWriteNow=t,this.viewInputsHub&&!t&&this.viewInputsHub.cleanWaitingEvents(),this.callbacks.dispatch("onEnableWriteNowChanged",function(r){return r(t)}))}},{key:"connect",value:function(){var _connect6=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee97(t){var r,n,i,_yield$this$magix$con,s,o;return regeneratorRuntime.wrap(function _callee97$(_context101){while(1){switch(_context101.prev=_context101.next){case 0:i=Date.now();_context101.prev=1;this._uuid=t.uuid,this._roomToken=t.roomToken,this.pencilOptions=new Cp(t.enableDrawPoint,t.disableNewPencil),this.memberStateStorage&&(this.memberStateStorage.uuid=t.uuid);_context101.next=5;return this.magix.connect({uuid:t.uuid,region:t.region||ae.defaultRegion,roomToken:t.roomToken,connectedPayload:t.deviceType,isWritable:t.isWritable});case 5:_yield$this$magix$con=_context101.sent;s=_yield$this$magix$con.libraryNode;o=_yield$this$magix$con.statistics;this.logger.context=D(I({},this.logger.context),{session:this.magix.session});this.setupLibraryNode(t.deviceType,s);this.magix.isWritable&&this.updateSelfUserId(this.magix.selfUserId);this._isWritable||this.viewStateObserver.setReadonlyMode(!0);_context101.t0=this._isWritable;if(!_context101.t0){_context101.next=18;break}this.pencilOptions.becomeWritable(this.applianceManager);_context101.next=17;return this.recoverMemberState();case 17:this.refreshPptState();case 18:(r=this.statistics)==null||r.commitConnection(D(I({},o),{isReconnection:!1}));this.logger.info("join room success");this.fetchNextPptSlideIfNeeded(this.state.sceneState);this.didConnected=!0;_context101.next=27;break;case 24:_context101.prev=24;_context101.t1=_context101["catch"](1);throw(n=this.statistics)==null||n.commitDisconnection({isReconnection:!1,duration:Date.now()-i}),this.logger.error("join room fail"),this.logger.error(_context101.t1),_context101.t1;case 27:case"end":return _context101.stop();}}},_callee97,this,[[1,24]])}));function connect(_x176){return _connect6.apply(this,arguments)}return connect}()},{key:"recoverMemberState",value:function(){var _recoverMemberState=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee98(){var _this353=this;var i,t;return regeneratorRuntime.wrap(function _callee98$(_context102){while(1){switch(_context102.prev=_context102.next){case 0:_context102.next=2;return(i=this.memberStateStorage)==null?void 0:i.getMemberState(this._uuid,this.uid);case 2:t=_context102.sent;t&&this.stateTrigger.activeUpdate("memberState",function(){return _this353.applianceManager.setMemberState(t)});case 4:case"end":return _context102.stop();}}},_callee98,this)}));function recoverMemberState(){return _recoverMemberState.apply(this,arguments)}return recoverMemberState}()},{key:"onScreenSizeUpdated",value:function onScreenSizeUpdated(){this.stateTrigger.state.broadcastState.mode!==pe.Follower&&this.syncCameraToRemoteLimiter.invoke()}},{key:"syncBlockTimestamp",value:function syncBlockTimestamp(t){this.magix.syncBlockTimestamp(t)}},{key:"stopBlockTimestamp",value:function stopBlockTimestamp(){this.magix.stopBlockTimestamp()}},{key:"dispatchMagixEvent",value:function dispatchMagixEvent(t,i){if(this.isEnableModify())if(this.eventsQueue)this.eventsQueue.dispatch(t,i);else try{this.dispatchEvent(t,i)}catch(r){this.logger.error(r)}}},{key:"disconnect",value:function(){var _disconnect2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee99(){return regeneratorRuntime.wrap(function _callee99$(_context103){while(1){switch(_context103.prev=_context103.next){case 0:if(!(this._phase===le.Disconnected)){_context103.next=2;break}throw new Error("room did disconnect");case 2:_context103.next=4;return this.magix.disconnect();case 4:case"end":return _context103.stop();}}},_callee99,this)}));function disconnect(){return _disconnect2.apply(this,arguments)}return disconnect}()},{key:"setGlobalState",value:function setGlobalState(t){var _this354=this;return this.isEnableModify()?this.stateTrigger.activeUpdate("globalState",function(){var i=_this354.parametersFilter.filter(t),r=_this354.applianceManager.setGlobalState(i);return _this354.dynamicPpt.setGlobalState(ue(r)),r}):this.stateTrigger.state.globalState}},{key:"setMemberState",value:function setMemberState(t){var i=JSON.parse(JSON.stringify(t));return this.assertMainViewProxy().owner.setMemberState(i)}},{key:"wrapSetMemberState",value:function wrapSetMemberState(t,i,r){var n;if(this.isEnableModify()){var s=this.parametersFilter.filter(t);s.currentApplianceName&&(i.cancelCurrentContinuityEvent(),this.beforeSceneChangeStoreCommit(i));var o=this.stateTrigger.activeUpdate("memberState",function(){return r(s)});return this.refreshCursorClass(),(n=this.memberStateStorage)==null||n.setMemberState(s),ue(o)}else return this.stateTrigger.state.memberState}},{key:"setViewMode",value:function setViewMode(t){var _this355=this;this.assertRoomIsConnected();var i=this.viewStateObserver;if(this._isWritable)this.stateTrigger.activeUpdate("broadcastState",function(){return _this355.applianceManager.setViewState({mode:t}),i.getBroadcastState()}),t===pe.Follower&&i.refreshCameraRectangle();else switch(t){case pe.Follower:{i.overrideWithFreedom(!1),i.refreshCameraRectangle();break}case pe.Freedom:{i.overrideWithFreedom(!0);break}case pe.Broadcaster:throw new Error("cannot be broadcaster when room.isWritable is false");}}},{key:"updatePptPageInfo",value:function updatePptPageInfo(){var _this$stateTrigger$st=this.stateTrigger.state.sceneState,t=_this$stateTrigger$st.scenes,i=_this$stateTrigger$st.index,r=t[i],n=r.ppt&&r.ppt.src,s=n&&this.dynamicPpt.getSlideUrl&&this.dynamicPpt.getSlideUrl(n);s&&this.setGlobalState(ue(this.dynamicPpt.globalStateWith({uuid:s.uuid,pageIndex:s.index,disableAutoPlay:!1})))}},{key:"setScenePath",value:function setScenePath(t){var _this356=this;if(this.isEnableModify()){this.logger.info("change scene path ".concat(t));var i=this.applianceManager,_r239=this.scenePathType(t),n=t;if(_r239===ct.Dir){var s=At(i.getSceneNames(te.parse(t))).shift();n=s===void 0?n:[n,s].join(zs)}this.beforeSceneChangeStoreCommit(),this.stateTrigger.activeUpdate("sceneState",function(){return i.changeScene(te.parse(n)),_this356.getCurrentSceneState()}),this.updatePptPageInfo()}}},{key:"setSceneIndex",value:function setSceneIndex(t){var _this357=this;if(this.isEnableModify()){var i=this.stateTrigger.state.sceneState.scenes[t];if(!i)throw new Error("index ".concat(t," is out of range"));var _r240=this.applianceManager,n=_toConsumableArray(_r240.getCurrentScenePath());n.pop(),n.push(i.name),this.logger.info("change scene index ".concat(t," /").concat(n.join("/"))),this.beforeSceneChangeStoreCommit(),this.stateTrigger.activeUpdate("sceneState",function(){return _r240.changeScene(n),_this357.getCurrentSceneState()}),this.updatePptPageInfo()}}},{key:"moveCamera",value:function moveCamera(t){this.assertRoomIsConnected(),_get(_getPrototypeOf(Ui.prototype),"moveCamera",this).call(this,t)}},{key:"moveCameraToContain",value:function moveCameraToContain(t){this.assertRoomIsConnected(),_get(_getPrototypeOf(Ui.prototype),"moveCameraToContain",this).call(this,t)}},{key:"putScenes",value:function putScenes(t,i,r){var _this358=this;if(this.isEnableModify()){var n=[];var _iterator280=_createForOfIteratorHelper(i),_step280;try{for(_iterator280.s();!(_step280=_iterator280.n()).done;){var s=_step280.value;s.name!==void 0?n.push(this.parametersFilter.filter(s)):n.push({name:(0,Lw.v1)().replace(/-/g,""),ppt:s.ppt})}}catch(err){_iterator280.e(err)}finally{_iterator280.f()}this.stateTrigger.activeUpdate("sceneState",function(){return _this358.applianceManager.putScenes(te.parse(t),n,r),_this358.getCurrentSceneState()})}}},{key:"cleanCurrentScene",value:function cleanCurrentScene(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!0;var i;(i=this.assertMainViewProxy().owner)==null||i.cleanCurrentScene(t)}},{key:"removeScenes",value:function removeScenes(t){var _this359=this;this.isEnableModify()&&this.stateTrigger.activeUpdate("sceneState",function(){return _this359.applianceManager.removeScenes(te.parse(t)),_this359.getCurrentSceneState()})}},{key:"moveScene",value:function moveScene(t,i){var _this360=this;this.isEnableModify()&&this.stateTrigger.activeUpdate("sceneState",function(){return _this360.applianceManager.moveScene(te.parse(t),te.parse(i)),_this360.getCurrentSceneState()})}},{key:"createWrappedComponents",value:function createWrappedComponents(){return[].concat(_toConsumableArray(_get(_getPrototypeOf(Ui.prototype),"createWrappedComponents",this).call(this)),[this.reactContext.createWrappedComponent(_p,this)])}},{key:"createPluginOperator",value:function createPluginOperator(){var _this361=this;return Object.freeze(D(I({},_get(_getPrototypeOf(Ui.prototype),"createPluginOperator",this).call(this)),{remove:function remove(t){return _this361.removePlugin(t)},update:function update(t,i){return _this361.updatePlugin(t,i)},getPlugin:function getPlugin(t){return _this361.applianceManager.getPlugin(t)}}))}},{key:"insertImage",value:function insertImage(t){var i;(i=this.assertMainViewProxy().owner)==null||i.insertImage(t)}},{key:"completeImageUpload",value:function completeImageUpload(t,i){var r;(r=this.assertMainViewProxy().owner)==null||r.completeImageUpload(t,i)}},{key:"lockImage",value:function lockImage(t,i){var r;(r=this.assertMainViewProxy().owner)==null||r.lockImage(t,i)}},{key:"createInvisiblePlugin",value:function createInvisiblePlugin(t,i){return this.invisiblePluginNode.create(t,i)}},{key:"insertPlugin",value:function insertPlugin(t,i){if(this.assertMainViewProxy(),this.isEnableModify()){var _r241=i,n=_r241&&_r241.attributes,s=this.assignAttributes(t,n);return s!==n&&(_r241=D(I({},_r241),{attributes:s})),this.applianceManager.insertPlugin(t,_r241).identifier}else return xt}},{key:"removePlugin",value:function removePlugin(t){var i=!1;return this.isEnableModify()&&(i=!!this.applianceManager.removePlugin(t)),i}},{key:"updatePlugin",value:function updatePlugin(t,i){var r=!1;return this.isEnableModify()&&(r=!!this.applianceManager.updatePlugin(t,i)),r}},{key:"getPluginAttributes",value:function getPluginAttributes(t){this.assertRoomIsConnected();var i=this.applianceManager.getPlugin(t);return i&&i.attributes}},{key:"getPluginRectangle",value:function getPluginRectangle(t){this.assertRoomIsConnected();var i=this.applianceManager.getPlugin(t);return i&&{originX:i.originX,originY:i.originY,width:i.width,height:i.height}}},{key:"insertText",value:function insertText(t,i,r){var s;var n=(s=this.assertMainViewProxy().owner)==null?void 0:s.insertText(t,i,r);return n===void 0&&(n=xt),n}},{key:"updateText",value:function updateText(t,i){var r;(r=this.assertMainViewProxy().owner)==null||r.updateText(t,i)}},{key:"updateSelectedText",value:function updateSelectedText(t){var i;(i=this.assertMainViewProxy().owner)==null||i.updateSelectedText(t)}},{key:"duplicate",value:function duplicate(){var t;(t=this.assertMainViewProxy().owner)==null||t.duplicate()}},{key:"copy",value:function copy(){var t;(t=this.assertMainViewProxy().owner)==null||t.copy()}},{key:"paste",value:function paste(){var t;(t=this.assertMainViewProxy().owner)==null||t.paste()}},{key:"canUndoSteps",get:function get(){var t;return((t=this.assertMainViewProxy().owner)==null?void 0:t.canUndoSteps)||0}},{key:"canRedoSteps",get:function get(){var t;return((t=this.assertMainViewProxy().owner)==null?void 0:t.canUndoSteps)||0}},{key:"undo",value:function undo(){var t=this.assertMainViewProxy().owner;return t?t.undo():0}},{key:"redo",value:function redo(){var t=this.assertMainViewProxy().owner;return t?t.redo():0}},{key:"delete",value:function _delete(){var t;(t=this.assertMainViewProxy().owner)==null||t["delete"]()}},{key:"lockImages",value:function lockImages(t){var i;(i=this.assertMainViewProxy().owner)==null||i.lockImages(t)}},{key:"moveSelectedComponentsToTop",value:function moveSelectedComponentsToTop(){var t;(t=this.assertMainViewProxy().owner)==null||t.moveSelectedComponentsToTop()}},{key:"moveSelectedComponentsToBottom",value:function moveSelectedComponentsToBottom(){var t;(t=this.assertMainViewProxy().owner)==null||t.moveSelectedComponentsToBottom()}},{key:"pptNextStep",value:function pptNextStep(){this.isEnableModify()&&this.pptMoveStep(1)}},{key:"pptPreviousStep",value:function pptPreviousStep(){this.isEnableModify()&&this.pptMoveStep(-1)}},{key:"pptMoveStep",value:function pptMoveStep(t){var _this$stateTrigger$st2=this.stateTrigger.state.sceneState,i=_this$stateTrigger$st2.scenes,r=_this$stateTrigger$st2.index,n=i[r],s=n.ppt&&n.ppt.src;if(s&&this.dynamicPpt.getSlideUrl(s))this.dynamicPpt.moveStep(t);else{var a=r+t;a>=0&&a<i.length&&this.setSceneIndex(a)}}},{key:"refreshCursorClass",value:function refreshCursorClass(){var t;switch(this.phase){case le.Reconnecting:case le.Disconnecting:case le.Disconnected:{t=se.Ban;break}case le.Connected:{if(this.stateTrigger){var i=this.stateTrigger.state.memberState;if(i&&this._isWritable&&!this._disableDeviceInputs)switch(i.currentApplianceName){case L.hand:{t=this.isHandGrasp?se.HandGrasp:se.Hand;break}case L.pencilEraser:{var n=i.pencilEraserSize;typeof n!="number"&&(n=1),n=Math.min(3,Math.max(1,Math.floor(n))),t="cursor-pencil-eraser-"+n;break}default:{t="cursor-"+i.currentApplianceName;break}}else t=null}break}}t!==void 0&&this.viewsHub.putState({cursorClass:t})}},{key:"refreshPptState",value:function refreshPptState(){this.updatePptPageInfo()}},{key:"receoverDisableSerialization",value:function receoverDisableSerialization(){this.disableSerializationCache||this.applianceManager.setEnableExecute(!0)}},{key:"refreshShouldDisableImageHit",value:function refreshShouldDisableImageHit(){this.viewsHub.putState({disalbeImageHit:this._disableEraseImage&&this.isEraser})}},{key:"exportScene",value:function(){var _exportScene=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee100(t){var i,r;return regeneratorRuntime.wrap(function _callee100$(_context104){while(1){switch(_context104.prev=_context104.next){case 0:i=this.scenePathType(t);if(!(i!==ct.Page)){_context104.next=3;break}throw new Error("can export a page, because of ".concat(t,"'s scene path type is ").concat(i));case 3:_context104.next=5;return this.apiFetch("http://api/v5/rooms/".concat(this.uuid,"/scenes-export/"),{method:"POST",headers:{token:this.roomToken,"content-type":"application/json",region:this.region},body:JSON.stringify({path:t})});case 5:r=_context104.sent;if(!(r.status===201)){_context104.next=10;break}_context104.next=9;return r.blob();case 9:return _context104.abrupt("return",_context104.sent);case 10:_context104.t0=Error;_context104.t1="export scene fail: ";_context104.next=14;return r.text();case 14:_context104.t2=_context104.sent;_context104.t3=_context104.t1.concat.call(_context104.t1,_context104.t2);throw new _context104.t0(_context104.t3);case 17:case"end":return _context104.stop();}}},_callee100,this)}));function exportScene(_x177){return _exportScene.apply(this,arguments)}return exportScene}()},{key:"importScene",value:function(){var _importScene=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee101(t,i){var r,d,n,s,o,l,h;return regeneratorRuntime.wrap(function _callee101$(_context105){while(1){switch(_context105.prev=_context105.next){case 0:r=this.scenePathType(t);if(!(r===ct.Page||r===ct.Conflict)){_context105.next=4;break}d=r===ct.Page?"".concat(t," is a scene page"):"".concat(t," path contains a page");throw new Error("can't import a scene in ".concat(t,", because of ").concat(d));case 4:_context105.next=6;return this.getSceneFromBlob(i);case 6:n=_context105.sent;s=n.name;o=[t,s].join(zs);if(!(this.scenePathType(o)===ct.Dir)){_context105.next=11;break}throw new Error("can't import a scene in ".concat(o," because of ").concat(o," contains scene page"));case 11:l=new FormData;l.append("dir",t),l.append("payload",i);_context105.next=15;return this.apiFetch("http://api/v5/rooms/".concat(this.uuid,"/scenes-import/"),{method:"POST",headers:{token:this.roomToken,region:this.region},body:l});case 15:h=_context105.sent;if(!(h.status>=300)){_context105.next=24;break}_context105.t0=Error;_context105.t1="import scene fail: ";_context105.next=21;return h.text();case 21:_context105.t2=_context105.sent;_context105.t3=_context105.t1.concat.call(_context105.t1,_context105.t2);throw new _context105.t0(_context105.t3);case 24:return _context105.abrupt("return",n);case 25:case"end":return _context105.stop();}}},_callee101,this)}));function importScene(_x178,_x179){return _importScene.apply(this,arguments)}return importScene}()},{key:"getSceneFromBlob",value:function(){var _getSceneFromBlob=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee102(t){var _this362=this;return regeneratorRuntime.wrap(function _callee102$(_context106){while(1){switch(_context106.prev=_context106.next){case 0:return _context106.abrupt("return",new Promise(function(i,r){var n=new FileReader;n.readAsArrayBuffer(t),n.onloadend=function(){if(n.result instanceof ArrayBuffer)try{var s=ai(n.result),o=_this362.applianceManager.getSceneFromFile(s);i(o)}catch(s){i(s)}else i(new Error("wrong content"))},n.onerror=function(s){r(s)}}));case 1:case"end":return _context106.stop();}}},_callee102)}));function getSceneFromBlob(_x180){return _getSceneFromBlob.apply(this,arguments)}return getSceneFromBlob}()},{key:"isEnableModifyWithoutThrowError",value:function isEnableModifyWithoutThrowError(){return this._phase!==le.Connected?!1:!!this._isWritable}},{key:"isEnableModify",value:function isEnableModify(){if(this.assertRoomIsConnected(),this._isWritable)return!0;switch(this.rejectWhenReadonlyErrorLevel){case Zr.ThrowError:throw new Error("you can only call it when room is writable");case Zr.Warn:{this.logger.warn("you can only call it when room is writable");break}}return!1}},{key:"assertRoomIsConnected",value:function assertRoomIsConnected(){if(this._phase!==le.Connected)throw new Error("you can only call it when room is connected. the phase of room is "+this._phase)}},{key:"beforeSceneChangeStoreCommit",value:function beforeSceneChangeStoreCommit(t){var i=this.applianceManager.releaseAllTextarea(null,t==null?void 0:t.focusSceneId),r=t==null?void 0:t.undoStack;r&&i&&r.commit(i)}}],[{key:"checkIsEraser",value:function checkIsEraser(t){switch(t){case L.eraser:case L.pencilEraser:return!0;default:return!1;}}}]);return Ui}(na);var Ze;(function(o){o.WaitingFirstFrame="waitingFirstFrame",o.Playing="playing",o.Pause="pause",o.Stopped="stop",o.Ended="ended",o.Buffering="buffering"})(Ze||(Ze={}));var Vi;(function(i){i.Directory="directory",i.Freedom="freedom"})(Vi||(Vi={}));var Rn;(function(n){n.Success="success",n.SuccessButUnnecessary="successButUnnecessary",n.Override="override",n.Stopped="stopped"})(Rn||(Rn={}));var Hc=P(require("mobx"));var vE=new Date("2019-06-23Z00:00:00").getTime(),En=/*#__PURE__*/function(_na2){_inherits(En,_na2);var _super101=_createSuper(En);function En(t){var _this363;_classCallCheck(this,En);_this363=_super101.call(this,{logger:t.logger,region:t.region,useMobXState:t.useMobXState,screenType:t.screenType,renderEngine:t.renderEngine,boundless:t.boundless,cameraBound:t.cameraBound,autoResize:t.autoResize,plugins:t.plugins,invisiblePlugins:t.invisiblePlugins,wrappedComponents:t.wrappedComponents,preloadDynamicPPT:t.preloadDynamicPPT,userFonts:t.userFonts,handToolKey:t.handToolKey,fontFamily:t.fontFamily,onlyCallbackRemoteStateModify:t.onlyCallbackRemoteStateModify,disableOthersSelectingBox:t.disableOthersSelectingBox,disableCameraTransform:t.disableCameraTransform,disableNewPencilStroke:t.disableNewPencilStroke,useMultiViews:t.useMultiViews,disableOperations:!0,willHideSelfCursor:!0,cursorAdapter:t.cursorAdapter,eraserRadiusCursor:t.eraserRadiusCursor,urlInterrupter:t.urlInterrupter,pptParams:t.pptParams,disableCurveAnimes:t.disableCurveAnimes,disableRotation:t.disableRotation,enableTextareHub:!1,enableSelfCurveAnime:!0,callbacks:t.callbacks,modulesOrigin:t.modulesOrigin});_this363.didLoadFirstFrame=!1;_this363.observerMode=Vi.Directory;_this363.onTriggerBuilt=function(){_this363.hasLibraryNode&&_this363.fireTriggerRebuild()};_this363.onLibraryNodeChanged=function(t,i){var n;var r=_this363.hasLibraryNode;if(_this363.updateLibraryNode(i),!r){var _assertThisInitialize2=_assertThisInitialized(_this363),s=_assertThisInitialize2.applianceManager,o=_assertThisInitialize2.cameraObserver;_this363.viewStateObserver=new ia(_this363.viewsHub,s),_this363.stateTrigger=new Ho({useMobXMode:_this363.useMobXState,disableMaskKey:_this363.onlyCallbackRemoteStateModify,onStateChanged:_this363.onPlayerStateChanged,propertyGetters:{observerMode:function observerMode(){return _this363.observerMode},globalState:function globalState(){return s.getGlobalState()},roomMembers:function roomMembers(){return _this363.getRoomMembers()},sceneState:function sceneState(){return _this363.getCurrentSceneState()},cameraState:function cameraState(){return o.cameraState}}}),(n=_this363.mainView)==null||n.callbacks.on("onCameraTransform",_this363.onCameraTransform)}};_this363.onPhaseChanged=function(t){var i=!1;!_this363.didLoadFirstFrame&&_this363.hasFrameToDisplay(t)&&(_this363.didLoadFirstFrame=!0,i=!0,_this363.fetchNextPptSlideIfNeeded(_this363.state.sceneState),_this363.setupAfterLoadFirstFrame()),_this363.updatePhaseByReconstructorPhase(_this363.reconstructor.phase)&&(_this363.logger.info("change player phase to "+_this363._phase),_this363.callbacks.dispatch("onPhaseChanged",function(n){return n(_this363._phase)}),_this363.dynamicPpt&&_this363.dynamicPpt.replayPasue&&_this363.dynamicPpt.replayPasue(_this363._phase!==Ze.Playing)),i&&_this363.callbacks.dispatch("onLoadFirstFrame",function(n){return n()}),_this363.invisiblePluginNode.isWatching=_this363._phase===Ze.Playing||_this363._phase===Ze.Pause};_this363.onPlayerStateChanged=function(t){t.globalState&&_this363.dynamicPpt.setGlobalState(ue(t.globalState)),t.sceneState&&_this363.fetchNextPptSlideIfNeeded(t.sceneState),_this363.callbacks.dispatch("onPlayerStateChanged",function(i){return i(t)})};_this363.onSliceChanged=function(t){_this363.logger.context=D(I({},_this363.logger.context),{slice:t&&t.uuid}),_this363.refreshForcePPTLandscapeWithSlice(t),_this363.callbacks.dispatch("onSliceChanged",function(i){return i(t.uuid)})};_this363.onCameraTransform=function(t){t===fi.Begin&&_this363.observerMode===Vi.Directory&&(_this363.observerMode=Vi.Freedom)};_this363.onModified=function(){_this363.viewStateObserver&&_this363.observerMode===Vi.Directory&&_this363.viewStateObserver.refreshCameraRectangle(),_this363.refreshRender()};_this363.callbacks.on("onProgressTimeChanged",function(i){return _this363.putPlayerState({timestamp:i})}),(0,Hc.makeObservable)(_assertThisInitialized(_this363),{observerMode:Hc.observable});return _this363}_createClass(En,[{key:"applianceManager",get:function get(){return this.reconstructor.trigger}},{key:"parametersFilter",get:function get(){}},{key:"playbackSpeed",get:function get(){return this.reconstructor.playbackSpeed},set:function set(t){this.reconstructor.playbackSpeed=t,this.putPlayerState({playbackSpeed:t})}},{key:"disablePencilWrittingLimitFrequency",get:function get(){return!1}},{key:"wrapSetMemberState",value:function wrapSetMemberState(){throw new Error("can only call this method on room")}},{key:"setupReconstructor",value:function(){var _setupReconstructor=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee103(t){return regeneratorRuntime.wrap(function _callee103$(_context107){while(1){switch(_context107.prev=_context107.next){case 0:_context107.prev=0;_context107.next=3;return t.akkoApp.createReconstructor({logger:this.logger,roomToken:t.roomToken,clientVersion:ae.sdkVersion,libraryNodeFetcher:this.libraryNodeFetcher,callbacks:this.createReconstructorCallbacks(),rangeQuery:{region:t.region,room:t.room,roomToken:t.roomToken,slice:t.slice,beginTimestamp:t.beginTimestamp,duration:t.duration}});case 3:this.reconstructor=_context107.sent;this.updatePhaseByReconstructorPhase(this.reconstructor.phase);this.logger.info("setup player success");this.logger.context=D(I({},this.logger.context),{uuid:this.reconstructor.roomUUID,slice:this.reconstructor.slice&&this.reconstructor.slice.uuid});_context107.next=12;break;case 9:_context107.prev=9;_context107.t0=_context107["catch"](0);throw this.logger.error("setup player fail"),this.logger.error(_context107.t0),_context107.t0;case 12:case"end":return _context107.stop();}}},_callee103,this,[[0,9]])}));function setupReconstructor(_x181){return _setupReconstructor.apply(this,arguments)}return setupReconstructor}()},{key:"createReconstructorCallbacks",value:function createReconstructorCallbacks(){var _this364=this;return{onEventFire:function onEventFire(t){return _this364.dispatchMagixEventWithObject(t,!1,!1)},onSliceChanged:this.onSliceChanged,onTriggerBuilt:this.onTriggerBuilt,onLibraryNodeChanged:this.onLibraryNodeChanged,onPhaseChanged:this.onPhaseChanged,onModified:this.onModified,onIsPlayableChanged:function onIsPlayableChanged(t){return _this364.callbacks.dispatch("onIsPlayableChanged",function(i){return i(t)})},onProgressTimeChanged:function onProgressTimeChanged(t){return _this364.callbacks.dispatch("onProgressTimeChanged",function(i){return i(t)})},onStoppedWithError:function onStoppedWithError(t){return _this364.callbacks.dispatch("onStoppedWithError",function(i){return i(t)})},onCatchErrorWhenAppendFrame:function onCatchErrorWhenAppendFrame(t,i){_this364.callbacks.dispatch("onCatchErrorWhenAppendFrame",function(r){return r(t,i)})}}}},{key:"hasFrameToDisplay",value:function hasFrameToDisplay(t){switch(t){case fe.Playing:case fe.Pause:case fe.Buffering:case fe.Ended:return!0;default:return!1;}}},{key:"setupAfterLoadFirstFrame",value:function setupAfterLoadFirstFrame(){this.reconstructor.slice&&this.refreshForcePPTLandscapeWithSlice(this.reconstructor.slice),this.dynamicPpt.setGlobalState(ue(this.applianceManager.getGlobalState()))}},{key:"dispose",value:function dispose(){var t;_get(_getPrototypeOf(En.prototype),"dispose",this).call(this),this.viewStateObserver&&this.viewStateObserver.release(),this.stateTrigger&&this.stateTrigger.release(),(t=this.mainView)==null||t.callbacks.on("onCameraTransform",this.onCameraTransform)}},{key:"createWrappedComponents",value:function createWrappedComponents(){return[].concat(_toConsumableArray(_get(_getPrototypeOf(En.prototype),"createWrappedComponents",this).call(this)),[this.reactContext.createWrappedComponent(Kp,this)])}},{key:"refreshForcePPTLandscapeWithSlice",value:function refreshForcePPTLandscapeWithSlice(t){t.beginTimestamp<=vE?this.viewsHub.putState({forcePPTLandscape:!0}):this.viewsHub.putState({forcePPTLandscape:!1})}},{key:"setObserverMode",value:function setObserverMode(t){var _this365=this;this.stateTrigger.activeUpdate("observerMode",function(){return _this365.observerMode=t}),this.viewStateObserver&&t===Vi.Directory&&this.viewStateObserver.refreshCameraRectangle()}},{key:"state",get:function get(){if(!this.hasLibraryNode)throw new Error("can't read state before load first frame");return this.stateTrigger.state}},{key:"roomUUID",get:function get(){return this.reconstructor.roomUUID}},{key:"slice",get:function get(){return this.reconstructor.slice&&this.reconstructor.slice.uuid}},{key:"isPlayable",get:function get(){return this.reconstructor.isPlayable}},{key:"phase",get:function get(){return this._phase}},{key:"progressTime",get:function get(){return this.reconstructor.progressTime}},{key:"timeDuration",get:function get(){return this.reconstructor.duration}},{key:"framesCount",get:function get(){return this.reconstructor.framesCount}},{key:"beginTimestamp",get:function get(){return this.reconstructor.beginTimestamp}},{key:"play",value:function play(){this.assertRoomIsConnected(),this.reconstructor.play()}},{key:"pause",value:function pause(){this.assertRoomIsConnected(),this.reconstructor.pause()}},{key:"stop",value:function stop(){if(this._phase===Ze.Stopped)throw new Error("player did stop");this.reconstructor.stop(),this.dispose()}},{key:"seekToProgressTime",value:function(){var _seekToProgressTime=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee104(t){return regeneratorRuntime.wrap(function _callee104$(_context108){while(1){switch(_context108.prev=_context108.next){case 0:this.assertRoomIsConnected();_context108.next=3;return this.reconstructor.seekToProgressTime(t);case 3:_context108.t0=_context108.sent;_context108.next=_context108.t0===$t.Success?6:_context108.t0===$t.SuccessButUnnecessary?7:_context108.t0===$t.Override?8:_context108.t0===$t.Stopped?9:10;break;case 6:return _context108.abrupt("return",Rn.Success);case 7:return _context108.abrupt("return",Rn.SuccessButUnnecessary);case 8:return _context108.abrupt("return",Rn.Override);case 9:return _context108.abrupt("return",Rn.Stopped);case 10:throw new Error("invalid result");case 11:case"end":return _context108.stop();}}},_callee104,this)}));function seekToProgressTime(_x182){return _seekToProgressTime.apply(this,arguments)}return seekToProgressTime}()},{key:"updatePhaseByReconstructorPhase",value:function updatePhaseByReconstructorPhase(t){var i=En.covertPhase(t),r=this._phase!==i;return r&&(this._phase=i,this.putPlayerState({isPlaying:i===Ze.Playing})),r}},{key:"assertRoomIsConnected",value:function assertRoomIsConnected(){if(this._phase===Ze.Stopped)throw new Error("you cannot call it when phase of player is stopped")}}],[{key:"covertPhase",value:function covertPhase(t){switch(t){case fe.WaitingFirstFrame:return Ze.WaitingFirstFrame;case fe.Playing:return Ze.Playing;case fe.Pause:return Ze.Pause;case fe.Stopped:return Ze.Stopped;case fe.Ended:return Ze.Ended;case fe.Buffering:case fe.Seeking:return Ze.Buffering;default:throw new Error("invalid phase ".concat(t));}}}]);return En}(na);var Wc=/*#__PURE__*/function(_oa$Component){_inherits(Wc,_oa$Component);var _super102=_createSuper(Wc);function Wc(){_classCallCheck(this,Wc);return _super102.apply(this,arguments)}_createClass(Wc,[{key:"render",value:function render(){var _this366=this;return oa.createElement(ra,null,function(t){return oa.createElement(Ds,D(I({},_this366.props),{room:t}))})}}],[{key:"willInterruptEvent",value:function willInterruptEvent(){return Ds.willInterruptEvent()}}]);return Wc}(oa.Component);function am(e){var t;return typeof e=="boolean"?e?t=Object.freeze({colors:Dw()}):t=void 0:e&&(t=Object.freeze({colors:Dw(e.colors)})),t}function Dw(e){return e?Object.freeze(e.map(function(t){return Object.freeze(_toConsumableArray(t))})):SE}var SE=Object.freeze([Object.freeze([224,32,32]),Object.freeze([250,100,0]),Object.freeze([247,181,0]),Object.freeze([109,212,0]),Object.freeze([68,215,182]),Object.freeze([50,197,255]),Object.freeze([0,145,255]),Object.freeze([98,54,255]),Object.freeze([182,32,224]),Object.freeze([109,114,120]),Object.freeze([0,0,0]),Object.freeze([255,255,255])]);var wE=Object.defineProperty,CE=Object.defineProperties,kE=Object.getOwnPropertyDescriptors,Bw=Object.getOwnPropertySymbols,xE=Object.prototype.hasOwnProperty,PE=Object.prototype.propertyIsEnumerable,Fw=function Fw(e,t,i){return t in e?wE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},jw=function jw(e,t){for(var i in t||(t={})){xE.call(t,i)&&Fw(e,i,t[i])}if(Bw){var _iterator281=_createForOfIteratorHelper(Bw(t)),_step281;try{for(_iterator281.s();!(_step281=_iterator281.n()).done;){var i=_step281.value;PE.call(t,i)&&Fw(e,i,t[i])}}catch(err){_iterator281.e(err)}finally{_iterator281.f()}}return e},IE=function IE(e,t){return CE(e,kE(t))},sj=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")},ME=/*#__PURE__*/function(){var _ref134=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee105(e,t){var i;return regeneratorRuntime.wrap(function _callee105$(_context109){while(1){switch(_context109.prev=_context109.next){case 0:_context109.next=2;return window.fetch(t,{method:"post",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});case 2:i=_context109.sent;if(i.ok){_context109.next=5;break}throw new Error("report log failed, request status code: ".concat(i.status,", statusText: ").concat(i.statusText));case 5:case"end":return _context109.stop();}}},_callee105)}));return function ME(_x183,_x184){return _ref134.apply(this,arguments)}}(),zw=/*#__PURE__*/function(){function zw(e,t,i){_classCallCheck(this,zw);this.argusEncoder=e,this.timestampKey=i,this.reportQueueManage=new Zg(zw.logQueue,t,ME,console.warn)}_createClass(zw,[{key:"report",value:function report(e,t){var i=this.convertToBody(e),r=this.argusEncoder.encode(t,i);this.reportQueueManage.report(r)["catch"](function(){})}},{key:"convertToBody",value:function convertToBody(e){var t=e.timestamp,i=e.logObject,r={};this.timestampKey!==void 0&&(r[this.timestampKey]="".concat(t));for(var n in i){r[n]="".concat(i[n])}return r}}]);return zw}(),Uw=zw;Uw.logQueue=new qg;var _c=/*#__PURE__*/function(){function _c(e){_classCallCheck(this,_c);this.events=e.events,this.argusEncoder=new Qg(e.events,e.vid),this.reporter=new Uw(this.argusEncoder,e.reportResourceURL,e.timestampKey),this.logger=new ls({prefix:e.prefix,levelMask:e.printLevelMask}),this.reportLevelMaskIndex=ro[e.reportLevelMask||"info"],this.eventEmitter=new Jg(e.on)}_createClass(_c,[{key:"commit",value:function commit(e,t){this.reportLogNode(e,{timestamp:Date.now(),logObject:jw({},t)})}},{key:"log",value:function log(e,t,i,r){if(this.logger.log(e,t,i),ro[t]>=this.reportLevelMaskIndex){var n={timestamp:Date.now(),logObject:IE(jw({},r),{level:t,message:i})};this.eventEmitter.emit(t,n),this.reportLogNode(e,n)}}},{key:"isSupportedEvents",value:function isSupportedEvents(e){return e in this.events}},{key:"reportLogNode",value:function reportLogNode(e,t){try{this.reporter.report(t,e)}catch(i){console.warn(i)}}}]);return _c}();var Wt=P(require("protobufjs/minimal")),Ae=Wt.Reader,aa=Wt.Writer,C=Wt.util,Oe=Wt.roots["default"]||(Wt.roots["default"]={}),Vw=Oe.WhiteBoardPlayer=function(){function e(t){if(t)for(var i=Object.keys(t),_r242=0;_r242<i.length;++_r242){t[i[_r242]]!=null&&(this[i[_r242]]=t[i[_r242]])}}return e.prototype.lts=C.Long?C.Long.fromBits(0,0,!1):0,e.prototype.uuid="",e.prototype.region="",e.prototype.slice="",e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.createdAt="",e.prototype.level="",e.prototype.message="",e.prototype.vid=0,e.prototype.clientIP="",e.prototype.netlessUA="",e.create=function(i){return new e(i)},e.encode=function(i,r){return r||(r=aa.create()),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&r.uint32(8).int64(i.lts),i.uuid!=null&&Object.hasOwnProperty.call(i,"uuid")&&r.uint32(18).string(i.uuid),i.region!=null&&Object.hasOwnProperty.call(i,"region")&&r.uint32(26).string(i.region),i.slice!=null&&Object.hasOwnProperty.call(i,"slice")&&r.uint32(34).string(i.slice),i.team!=null&&Object.hasOwnProperty.call(i,"team")&&r.uint32(42).string(i.team),i.app!=null&&Object.hasOwnProperty.call(i,"app")&&r.uint32(50).string(i.app),i.akkoVersion!=null&&Object.hasOwnProperty.call(i,"akkoVersion")&&r.uint32(58).string(i.akkoVersion),i.sdkVersion!=null&&Object.hasOwnProperty.call(i,"sdkVersion")&&r.uint32(66).string(i.sdkVersion),i.nativeVersion!=null&&Object.hasOwnProperty.call(i,"nativeVersion")&&r.uint32(74).string(i.nativeVersion),i.platform!=null&&Object.hasOwnProperty.call(i,"platform")&&r.uint32(82).string(i.platform),i.os!=null&&Object.hasOwnProperty.call(i,"os")&&r.uint32(90).string(i.os),i.createdAt!=null&&Object.hasOwnProperty.call(i,"createdAt")&&r.uint32(98).string(i.createdAt),i.level!=null&&Object.hasOwnProperty.call(i,"level")&&r.uint32(106).string(i.level),i.message!=null&&Object.hasOwnProperty.call(i,"message")&&r.uint32(114).string(i.message),i.vid!=null&&Object.hasOwnProperty.call(i,"vid")&&r.uint32(120).int32(i.vid),i.clientIP!=null&&Object.hasOwnProperty.call(i,"clientIP")&&r.uint32(130).string(i.clientIP),i.netlessUA!=null&&Object.hasOwnProperty.call(i,"netlessUA")&&r.uint32(138).string(i.netlessUA),r},e.encodeDelimited=function(i,r){return this.encode(i,r).ldelim()},e.decode=function(i,r){i instanceof Ae||(i=Ae.create(i));var n=r===void 0?i.len:i.pos+r,s=new Oe.WhiteBoardPlayer;for(;i.pos<n;){var o=i.uint32();switch(o>>>3){case 1:s.lts=i.int64();break;case 2:s.uuid=i.string();break;case 3:s.region=i.string();break;case 4:s.slice=i.string();break;case 5:s.team=i.string();break;case 6:s.app=i.string();break;case 7:s.akkoVersion=i.string();break;case 8:s.sdkVersion=i.string();break;case 9:s.nativeVersion=i.string();break;case 10:s.platform=i.string();break;case 11:s.os=i.string();break;case 12:s.createdAt=i.string();break;case 13:s.level=i.string();break;case 14:s.message=i.string();break;case 15:s.vid=i.int32();break;case 16:s.clientIP=i.string();break;case 17:s.netlessUA=i.string();break;default:i.skipType(o&7);break;}}return s},e.decodeDelimited=function(i){return i instanceof Ae||(i=new Ae(i)),this.decode(i,i.uint32())},e.verify=function(i){return _typeof(i)!="object"||i===null?"object expected":i.lts!=null&&i.hasOwnProperty("lts")&&!C.isInteger(i.lts)&&!(i.lts&&C.isInteger(i.lts.low)&&C.isInteger(i.lts.high))?"lts: integer|Long expected":i.uuid!=null&&i.hasOwnProperty("uuid")&&!C.isString(i.uuid)?"uuid: string expected":i.region!=null&&i.hasOwnProperty("region")&&!C.isString(i.region)?"region: string expected":i.slice!=null&&i.hasOwnProperty("slice")&&!C.isString(i.slice)?"slice: string expected":i.team!=null&&i.hasOwnProperty("team")&&!C.isString(i.team)?"team: string expected":i.app!=null&&i.hasOwnProperty("app")&&!C.isString(i.app)?"app: string expected":i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&!C.isString(i.akkoVersion)?"akkoVersion: string expected":i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&!C.isString(i.sdkVersion)?"sdkVersion: string expected":i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&!C.isString(i.nativeVersion)?"nativeVersion: string expected":i.platform!=null&&i.hasOwnProperty("platform")&&!C.isString(i.platform)?"platform: string expected":i.os!=null&&i.hasOwnProperty("os")&&!C.isString(i.os)?"os: string expected":i.createdAt!=null&&i.hasOwnProperty("createdAt")&&!C.isString(i.createdAt)?"createdAt: string expected":i.level!=null&&i.hasOwnProperty("level")&&!C.isString(i.level)?"level: string expected":i.message!=null&&i.hasOwnProperty("message")&&!C.isString(i.message)?"message: string expected":i.vid!=null&&i.hasOwnProperty("vid")&&!C.isInteger(i.vid)?"vid: integer expected":i.clientIP!=null&&i.hasOwnProperty("clientIP")&&!C.isString(i.clientIP)?"clientIP: string expected":i.netlessUA!=null&&i.hasOwnProperty("netlessUA")&&!C.isString(i.netlessUA)?"netlessUA: string expected":null},e.fromObject=function(i){if(i instanceof Oe.WhiteBoardPlayer)return i;var r=new Oe.WhiteBoardPlayer;return i.lts!=null&&(C.Long?(r.lts=C.Long.fromValue(i.lts)).unsigned=!1:typeof i.lts=="string"?r.lts=parseInt(i.lts,10):typeof i.lts=="number"?r.lts=i.lts:_typeof(i.lts)=="object"&&(r.lts=new C.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber())),i.uuid!=null&&(r.uuid=String(i.uuid)),i.region!=null&&(r.region=String(i.region)),i.slice!=null&&(r.slice=String(i.slice)),i.team!=null&&(r.team=String(i.team)),i.app!=null&&(r.app=String(i.app)),i.akkoVersion!=null&&(r.akkoVersion=String(i.akkoVersion)),i.sdkVersion!=null&&(r.sdkVersion=String(i.sdkVersion)),i.nativeVersion!=null&&(r.nativeVersion=String(i.nativeVersion)),i.platform!=null&&(r.platform=String(i.platform)),i.os!=null&&(r.os=String(i.os)),i.createdAt!=null&&(r.createdAt=String(i.createdAt)),i.level!=null&&(r.level=String(i.level)),i.message!=null&&(r.message=String(i.message)),i.vid!=null&&(r.vid=i.vid|0),i.clientIP!=null&&(r.clientIP=String(i.clientIP)),i.netlessUA!=null&&(r.netlessUA=String(i.netlessUA)),r},e.toObject=function(i,r){r||(r={});var n={};if(r.defaults){if(C.Long){var s=new C.Long(0,0,!1);n.lts=r.longs===String?s.toString():r.longs===Number?s.toNumber():s}else n.lts=r.longs===String?"0":0;n.uuid="",n.region="",n.slice="",n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.createdAt="",n.level="",n.message="",n.vid=0,n.clientIP="",n.netlessUA=""}return i.lts!=null&&i.hasOwnProperty("lts")&&(typeof i.lts=="number"?n.lts=r.longs===String?String(i.lts):i.lts:n.lts=r.longs===String?C.Long.prototype.toString.call(i.lts):r.longs===Number?new C.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber():i.lts),i.uuid!=null&&i.hasOwnProperty("uuid")&&(n.uuid=i.uuid),i.region!=null&&i.hasOwnProperty("region")&&(n.region=i.region),i.slice!=null&&i.hasOwnProperty("slice")&&(n.slice=i.slice),i.team!=null&&i.hasOwnProperty("team")&&(n.team=i.team),i.app!=null&&i.hasOwnProperty("app")&&(n.app=i.app),i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&(n.akkoVersion=i.akkoVersion),i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&(n.sdkVersion=i.sdkVersion),i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&(n.nativeVersion=i.nativeVersion),i.platform!=null&&i.hasOwnProperty("platform")&&(n.platform=i.platform),i.os!=null&&i.hasOwnProperty("os")&&(n.os=i.os),i.createdAt!=null&&i.hasOwnProperty("createdAt")&&(n.createdAt=i.createdAt),i.level!=null&&i.hasOwnProperty("level")&&(n.level=i.level),i.message!=null&&i.hasOwnProperty("message")&&(n.message=i.message),i.vid!=null&&i.hasOwnProperty("vid")&&(n.vid=i.vid),i.clientIP!=null&&i.hasOwnProperty("clientIP")&&(n.clientIP=i.clientIP),i.netlessUA!=null&&i.hasOwnProperty("netlessUA")&&(n.netlessUA=i.netlessUA),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Wt.util.toJSONOptions)},e}(),Ww=Oe.WhiteBoardQualityConnection=function(){function e(t){if(t)for(var i=Object.keys(t),_r243=0;_r243<i.length;++_r243){t[i[_r243]]!=null&&(this[i[_r243]]=t[i[_r243]])}}return e.prototype.lts=C.Long?C.Long.fromBits(0,0,!1):0,e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.kind="",e.prototype.uuid="",e.prototype.region="",e.prototype.userId="",e.prototype.session="",e.prototype.isReconnection="",e.prototype.retryCount="",e.prototype.buildWebSocketDuration="",e.prototype.buildMagixDuration="",e.prototype.createdAt="",e.prototype.vid=0,e.prototype.clientIP="",e.create=function(i){return new e(i)},e.encode=function(i,r){return r||(r=aa.create()),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&r.uint32(8).int64(i.lts),i.team!=null&&Object.hasOwnProperty.call(i,"team")&&r.uint32(18).string(i.team),i.app!=null&&Object.hasOwnProperty.call(i,"app")&&r.uint32(26).string(i.app),i.akkoVersion!=null&&Object.hasOwnProperty.call(i,"akkoVersion")&&r.uint32(34).string(i.akkoVersion),i.sdkVersion!=null&&Object.hasOwnProperty.call(i,"sdkVersion")&&r.uint32(42).string(i.sdkVersion),i.nativeVersion!=null&&Object.hasOwnProperty.call(i,"nativeVersion")&&r.uint32(50).string(i.nativeVersion),i.platform!=null&&Object.hasOwnProperty.call(i,"platform")&&r.uint32(58).string(i.platform),i.os!=null&&Object.hasOwnProperty.call(i,"os")&&r.uint32(66).string(i.os),i.kind!=null&&Object.hasOwnProperty.call(i,"kind")&&r.uint32(74).string(i.kind),i.uuid!=null&&Object.hasOwnProperty.call(i,"uuid")&&r.uint32(82).string(i.uuid),i.region!=null&&Object.hasOwnProperty.call(i,"region")&&r.uint32(90).string(i.region),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&r.uint32(98).string(i.userId),i.session!=null&&Object.hasOwnProperty.call(i,"session")&&r.uint32(106).string(i.session),i.isReconnection!=null&&Object.hasOwnProperty.call(i,"isReconnection")&&r.uint32(114).string(i.isReconnection),i.retryCount!=null&&Object.hasOwnProperty.call(i,"retryCount")&&r.uint32(122).string(i.retryCount),i.buildWebSocketDuration!=null&&Object.hasOwnProperty.call(i,"buildWebSocketDuration")&&r.uint32(130).string(i.buildWebSocketDuration),i.buildMagixDuration!=null&&Object.hasOwnProperty.call(i,"buildMagixDuration")&&r.uint32(138).string(i.buildMagixDuration),i.createdAt!=null&&Object.hasOwnProperty.call(i,"createdAt")&&r.uint32(146).string(i.createdAt),i.vid!=null&&Object.hasOwnProperty.call(i,"vid")&&r.uint32(152).int32(i.vid),i.clientIP!=null&&Object.hasOwnProperty.call(i,"clientIP")&&r.uint32(162).string(i.clientIP),r},e.encodeDelimited=function(i,r){return this.encode(i,r).ldelim()},e.decode=function(i,r){i instanceof Ae||(i=Ae.create(i));var n=r===void 0?i.len:i.pos+r,s=new Oe.WhiteBoardQualityConnection;for(;i.pos<n;){var o=i.uint32();switch(o>>>3){case 1:s.lts=i.int64();break;case 2:s.team=i.string();break;case 3:s.app=i.string();break;case 4:s.akkoVersion=i.string();break;case 5:s.sdkVersion=i.string();break;case 6:s.nativeVersion=i.string();break;case 7:s.platform=i.string();break;case 8:s.os=i.string();break;case 9:s.kind=i.string();break;case 10:s.uuid=i.string();break;case 11:s.region=i.string();break;case 12:s.userId=i.string();break;case 13:s.session=i.string();break;case 14:s.isReconnection=i.string();break;case 15:s.retryCount=i.string();break;case 16:s.buildWebSocketDuration=i.string();break;case 17:s.buildMagixDuration=i.string();break;case 18:s.createdAt=i.string();break;case 19:s.vid=i.int32();break;case 20:s.clientIP=i.string();break;default:i.skipType(o&7);break;}}return s},e.decodeDelimited=function(i){return i instanceof Ae||(i=new Ae(i)),this.decode(i,i.uint32())},e.verify=function(i){return _typeof(i)!="object"||i===null?"object expected":i.lts!=null&&i.hasOwnProperty("lts")&&!C.isInteger(i.lts)&&!(i.lts&&C.isInteger(i.lts.low)&&C.isInteger(i.lts.high))?"lts: integer|Long expected":i.team!=null&&i.hasOwnProperty("team")&&!C.isString(i.team)?"team: string expected":i.app!=null&&i.hasOwnProperty("app")&&!C.isString(i.app)?"app: string expected":i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&!C.isString(i.akkoVersion)?"akkoVersion: string expected":i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&!C.isString(i.sdkVersion)?"sdkVersion: string expected":i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&!C.isString(i.nativeVersion)?"nativeVersion: string expected":i.platform!=null&&i.hasOwnProperty("platform")&&!C.isString(i.platform)?"platform: string expected":i.os!=null&&i.hasOwnProperty("os")&&!C.isString(i.os)?"os: string expected":i.kind!=null&&i.hasOwnProperty("kind")&&!C.isString(i.kind)?"kind: string expected":i.uuid!=null&&i.hasOwnProperty("uuid")&&!C.isString(i.uuid)?"uuid: string expected":i.region!=null&&i.hasOwnProperty("region")&&!C.isString(i.region)?"region: string expected":i.userId!=null&&i.hasOwnProperty("userId")&&!C.isString(i.userId)?"userId: string expected":i.session!=null&&i.hasOwnProperty("session")&&!C.isString(i.session)?"session: string expected":i.isReconnection!=null&&i.hasOwnProperty("isReconnection")&&!C.isString(i.isReconnection)?"isReconnection: string expected":i.retryCount!=null&&i.hasOwnProperty("retryCount")&&!C.isString(i.retryCount)?"retryCount: string expected":i.buildWebSocketDuration!=null&&i.hasOwnProperty("buildWebSocketDuration")&&!C.isString(i.buildWebSocketDuration)?"buildWebSocketDuration: string expected":i.buildMagixDuration!=null&&i.hasOwnProperty("buildMagixDuration")&&!C.isString(i.buildMagixDuration)?"buildMagixDuration: string expected":i.createdAt!=null&&i.hasOwnProperty("createdAt")&&!C.isString(i.createdAt)?"createdAt: string expected":i.vid!=null&&i.hasOwnProperty("vid")&&!C.isInteger(i.vid)?"vid: integer expected":i.clientIP!=null&&i.hasOwnProperty("clientIP")&&!C.isString(i.clientIP)?"clientIP: string expected":null},e.fromObject=function(i){if(i instanceof Oe.WhiteBoardQualityConnection)return i;var r=new Oe.WhiteBoardQualityConnection;return i.lts!=null&&(C.Long?(r.lts=C.Long.fromValue(i.lts)).unsigned=!1:typeof i.lts=="string"?r.lts=parseInt(i.lts,10):typeof i.lts=="number"?r.lts=i.lts:_typeof(i.lts)=="object"&&(r.lts=new C.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber())),i.team!=null&&(r.team=String(i.team)),i.app!=null&&(r.app=String(i.app)),i.akkoVersion!=null&&(r.akkoVersion=String(i.akkoVersion)),i.sdkVersion!=null&&(r.sdkVersion=String(i.sdkVersion)),i.nativeVersion!=null&&(r.nativeVersion=String(i.nativeVersion)),i.platform!=null&&(r.platform=String(i.platform)),i.os!=null&&(r.os=String(i.os)),i.kind!=null&&(r.kind=String(i.kind)),i.uuid!=null&&(r.uuid=String(i.uuid)),i.region!=null&&(r.region=String(i.region)),i.userId!=null&&(r.userId=String(i.userId)),i.session!=null&&(r.session=String(i.session)),i.isReconnection!=null&&(r.isReconnection=String(i.isReconnection)),i.retryCount!=null&&(r.retryCount=String(i.retryCount)),i.buildWebSocketDuration!=null&&(r.buildWebSocketDuration=String(i.buildWebSocketDuration)),i.buildMagixDuration!=null&&(r.buildMagixDuration=String(i.buildMagixDuration)),i.createdAt!=null&&(r.createdAt=String(i.createdAt)),i.vid!=null&&(r.vid=i.vid|0),i.clientIP!=null&&(r.clientIP=String(i.clientIP)),r},e.toObject=function(i,r){r||(r={});var n={};if(r.defaults){if(C.Long){var s=new C.Long(0,0,!1);n.lts=r.longs===String?s.toString():r.longs===Number?s.toNumber():s}else n.lts=r.longs===String?"0":0;n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.kind="",n.uuid="",n.region="",n.userId="",n.session="",n.isReconnection="",n.retryCount="",n.buildWebSocketDuration="",n.buildMagixDuration="",n.createdAt="",n.vid=0,n.clientIP=""}return i.lts!=null&&i.hasOwnProperty("lts")&&(typeof i.lts=="number"?n.lts=r.longs===String?String(i.lts):i.lts:n.lts=r.longs===String?C.Long.prototype.toString.call(i.lts):r.longs===Number?new C.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber():i.lts),i.team!=null&&i.hasOwnProperty("team")&&(n.team=i.team),i.app!=null&&i.hasOwnProperty("app")&&(n.app=i.app),i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&(n.akkoVersion=i.akkoVersion),i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&(n.sdkVersion=i.sdkVersion),i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&(n.nativeVersion=i.nativeVersion),i.platform!=null&&i.hasOwnProperty("platform")&&(n.platform=i.platform),i.os!=null&&i.hasOwnProperty("os")&&(n.os=i.os),i.kind!=null&&i.hasOwnProperty("kind")&&(n.kind=i.kind),i.uuid!=null&&i.hasOwnProperty("uuid")&&(n.uuid=i.uuid),i.region!=null&&i.hasOwnProperty("region")&&(n.region=i.region),i.userId!=null&&i.hasOwnProperty("userId")&&(n.userId=i.userId),i.session!=null&&i.hasOwnProperty("session")&&(n.session=i.session),i.isReconnection!=null&&i.hasOwnProperty("isReconnection")&&(n.isReconnection=i.isReconnection),i.retryCount!=null&&i.hasOwnProperty("retryCount")&&(n.retryCount=i.retryCount),i.buildWebSocketDuration!=null&&i.hasOwnProperty("buildWebSocketDuration")&&(n.buildWebSocketDuration=i.buildWebSocketDuration),i.buildMagixDuration!=null&&i.hasOwnProperty("buildMagixDuration")&&(n.buildMagixDuration=i.buildMagixDuration),i.createdAt!=null&&i.hasOwnProperty("createdAt")&&(n.createdAt=i.createdAt),i.vid!=null&&i.hasOwnProperty("vid")&&(n.vid=i.vid),i.clientIP!=null&&i.hasOwnProperty("clientIP")&&(n.clientIP=i.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Wt.util.toJSONOptions)},e}(),Hw=Oe.WhiteBoardQualityDisconnection=function(){function e(t){if(t)for(var i=Object.keys(t),_r244=0;_r244<i.length;++_r244){t[i[_r244]]!=null&&(this[i[_r244]]=t[i[_r244]])}}return e.prototype.lts=C.Long?C.Long.fromBits(0,0,!1):0,e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.kind="",e.prototype.uuid="",e.prototype.region="",e.prototype.userId="",e.prototype.session="",e.prototype.duration="",e.prototype.createdAt="",e.prototype.vid=0,e.prototype.isReconnection="",e.prototype.clientIP="",e.create=function(i){return new e(i)},e.encode=function(i,r){return r||(r=aa.create()),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&r.uint32(8).int64(i.lts),i.team!=null&&Object.hasOwnProperty.call(i,"team")&&r.uint32(18).string(i.team),i.app!=null&&Object.hasOwnProperty.call(i,"app")&&r.uint32(26).string(i.app),i.akkoVersion!=null&&Object.hasOwnProperty.call(i,"akkoVersion")&&r.uint32(34).string(i.akkoVersion),i.sdkVersion!=null&&Object.hasOwnProperty.call(i,"sdkVersion")&&r.uint32(42).string(i.sdkVersion),i.nativeVersion!=null&&Object.hasOwnProperty.call(i,"nativeVersion")&&r.uint32(50).string(i.nativeVersion),i.platform!=null&&Object.hasOwnProperty.call(i,"platform")&&r.uint32(58).string(i.platform),i.os!=null&&Object.hasOwnProperty.call(i,"os")&&r.uint32(66).string(i.os),i.kind!=null&&Object.hasOwnProperty.call(i,"kind")&&r.uint32(74).string(i.kind),i.uuid!=null&&Object.hasOwnProperty.call(i,"uuid")&&r.uint32(82).string(i.uuid),i.region!=null&&Object.hasOwnProperty.call(i,"region")&&r.uint32(90).string(i.region),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&r.uint32(98).string(i.userId),i.session!=null&&Object.hasOwnProperty.call(i,"session")&&r.uint32(106).string(i.session),i.duration!=null&&Object.hasOwnProperty.call(i,"duration")&&r.uint32(122).string(i.duration),i.createdAt!=null&&Object.hasOwnProperty.call(i,"createdAt")&&r.uint32(130).string(i.createdAt),i.vid!=null&&Object.hasOwnProperty.call(i,"vid")&&r.uint32(136).int32(i.vid),i.isReconnection!=null&&Object.hasOwnProperty.call(i,"isReconnection")&&r.uint32(146).string(i.isReconnection),i.clientIP!=null&&Object.hasOwnProperty.call(i,"clientIP")&&r.uint32(154).string(i.clientIP),r},e.encodeDelimited=function(i,r){return this.encode(i,r).ldelim()},e.decode=function(i,r){i instanceof Ae||(i=Ae.create(i));var n=r===void 0?i.len:i.pos+r,s=new Oe.WhiteBoardQualityDisconnection;for(;i.pos<n;){var o=i.uint32();switch(o>>>3){case 1:s.lts=i.int64();break;case 2:s.team=i.string();break;case 3:s.app=i.string();break;case 4:s.akkoVersion=i.string();break;case 5:s.sdkVersion=i.string();break;case 6:s.nativeVersion=i.string();break;case 7:s.platform=i.string();break;case 8:s.os=i.string();break;case 9:s.kind=i.string();break;case 10:s.uuid=i.string();break;case 11:s.region=i.string();break;case 12:s.userId=i.string();break;case 13:s.session=i.string();break;case 15:s.duration=i.string();break;case 16:s.createdAt=i.string();break;case 17:s.vid=i.int32();break;case 18:s.isReconnection=i.string();break;case 19:s.clientIP=i.string();break;default:i.skipType(o&7);break;}}return s},e.decodeDelimited=function(i){return i instanceof Ae||(i=new Ae(i)),this.decode(i,i.uint32())},e.verify=function(i){return _typeof(i)!="object"||i===null?"object expected":i.lts!=null&&i.hasOwnProperty("lts")&&!C.isInteger(i.lts)&&!(i.lts&&C.isInteger(i.lts.low)&&C.isInteger(i.lts.high))?"lts: integer|Long expected":i.team!=null&&i.hasOwnProperty("team")&&!C.isString(i.team)?"team: string expected":i.app!=null&&i.hasOwnProperty("app")&&!C.isString(i.app)?"app: string expected":i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&!C.isString(i.akkoVersion)?"akkoVersion: string expected":i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&!C.isString(i.sdkVersion)?"sdkVersion: string expected":i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&!C.isString(i.nativeVersion)?"nativeVersion: string expected":i.platform!=null&&i.hasOwnProperty("platform")&&!C.isString(i.platform)?"platform: string expected":i.os!=null&&i.hasOwnProperty("os")&&!C.isString(i.os)?"os: string expected":i.kind!=null&&i.hasOwnProperty("kind")&&!C.isString(i.kind)?"kind: string expected":i.uuid!=null&&i.hasOwnProperty("uuid")&&!C.isString(i.uuid)?"uuid: string expected":i.region!=null&&i.hasOwnProperty("region")&&!C.isString(i.region)?"region: string expected":i.userId!=null&&i.hasOwnProperty("userId")&&!C.isString(i.userId)?"userId: string expected":i.session!=null&&i.hasOwnProperty("session")&&!C.isString(i.session)?"session: string expected":i.duration!=null&&i.hasOwnProperty("duration")&&!C.isString(i.duration)?"duration: string expected":i.createdAt!=null&&i.hasOwnProperty("createdAt")&&!C.isString(i.createdAt)?"createdAt: string expected":i.vid!=null&&i.hasOwnProperty("vid")&&!C.isInteger(i.vid)?"vid: integer expected":i.isReconnection!=null&&i.hasOwnProperty("isReconnection")&&!C.isString(i.isReconnection)?"isReconnection: string expected":i.clientIP!=null&&i.hasOwnProperty("clientIP")&&!C.isString(i.clientIP)?"clientIP: string expected":null},e.fromObject=function(i){if(i instanceof Oe.WhiteBoardQualityDisconnection)return i;var r=new Oe.WhiteBoardQualityDisconnection;return i.lts!=null&&(C.Long?(r.lts=C.Long.fromValue(i.lts)).unsigned=!1:typeof i.lts=="string"?r.lts=parseInt(i.lts,10):typeof i.lts=="number"?r.lts=i.lts:_typeof(i.lts)=="object"&&(r.lts=new C.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber())),i.team!=null&&(r.team=String(i.team)),i.app!=null&&(r.app=String(i.app)),i.akkoVersion!=null&&(r.akkoVersion=String(i.akkoVersion)),i.sdkVersion!=null&&(r.sdkVersion=String(i.sdkVersion)),i.nativeVersion!=null&&(r.nativeVersion=String(i.nativeVersion)),i.platform!=null&&(r.platform=String(i.platform)),i.os!=null&&(r.os=String(i.os)),i.kind!=null&&(r.kind=String(i.kind)),i.uuid!=null&&(r.uuid=String(i.uuid)),i.region!=null&&(r.region=String(i.region)),i.userId!=null&&(r.userId=String(i.userId)),i.session!=null&&(r.session=String(i.session)),i.duration!=null&&(r.duration=String(i.duration)),i.createdAt!=null&&(r.createdAt=String(i.createdAt)),i.vid!=null&&(r.vid=i.vid|0),i.isReconnection!=null&&(r.isReconnection=String(i.isReconnection)),i.clientIP!=null&&(r.clientIP=String(i.clientIP)),r},e.toObject=function(i,r){r||(r={});var n={};if(r.defaults){if(C.Long){var s=new C.Long(0,0,!1);n.lts=r.longs===String?s.toString():r.longs===Number?s.toNumber():s}else n.lts=r.longs===String?"0":0;n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.kind="",n.uuid="",n.region="",n.userId="",n.session="",n.duration="",n.createdAt="",n.vid=0,n.isReconnection="",n.clientIP=""}return i.lts!=null&&i.hasOwnProperty("lts")&&(typeof i.lts=="number"?n.lts=r.longs===String?String(i.lts):i.lts:n.lts=r.longs===String?C.Long.prototype.toString.call(i.lts):r.longs===Number?new C.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber():i.lts),i.team!=null&&i.hasOwnProperty("team")&&(n.team=i.team),i.app!=null&&i.hasOwnProperty("app")&&(n.app=i.app),i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&(n.akkoVersion=i.akkoVersion),i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&(n.sdkVersion=i.sdkVersion),i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&(n.nativeVersion=i.nativeVersion),i.platform!=null&&i.hasOwnProperty("platform")&&(n.platform=i.platform),i.os!=null&&i.hasOwnProperty("os")&&(n.os=i.os),i.kind!=null&&i.hasOwnProperty("kind")&&(n.kind=i.kind),i.uuid!=null&&i.hasOwnProperty("uuid")&&(n.uuid=i.uuid),i.region!=null&&i.hasOwnProperty("region")&&(n.region=i.region),i.userId!=null&&i.hasOwnProperty("userId")&&(n.userId=i.userId),i.session!=null&&i.hasOwnProperty("session")&&(n.session=i.session),i.duration!=null&&i.hasOwnProperty("duration")&&(n.duration=i.duration),i.createdAt!=null&&i.hasOwnProperty("createdAt")&&(n.createdAt=i.createdAt),i.vid!=null&&i.hasOwnProperty("vid")&&(n.vid=i.vid),i.isReconnection!=null&&i.hasOwnProperty("isReconnection")&&(n.isReconnection=i.isReconnection),i.clientIP!=null&&i.hasOwnProperty("clientIP")&&(n.clientIP=i.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Wt.util.toJSONOptions)},e}(),_w=Oe.WhiteBoardQualitySample=function(){function e(t){if(t)for(var i=Object.keys(t),_r245=0;_r245<i.length;++_r245){t[i[_r245]]!=null&&(this[i[_r245]]=t[i[_r245]])}}return e.prototype.lts=C.Long?C.Long.fromBits(0,0,!1):0,e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.kind="",e.prototype.uuid="",e.prototype.region="",e.prototype.userId="",e.prototype.session="",e.prototype.maxRTT="",e.prototype.minRTT="",e.prototype.averageRTT="",e.prototype.maxQueue="",e.prototype.minQueue="",e.prototype.averageQueue="",e.prototype.maxInterval="",e.prototype.minInterval="",e.prototype.averageInterval="",e.prototype.vid=0,e.prototype.createdAt="",e.prototype.clientIP="",e.create=function(i){return new e(i)},e.encode=function(i,r){return r||(r=aa.create()),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&r.uint32(8).int64(i.lts),i.team!=null&&Object.hasOwnProperty.call(i,"team")&&r.uint32(18).string(i.team),i.app!=null&&Object.hasOwnProperty.call(i,"app")&&r.uint32(26).string(i.app),i.akkoVersion!=null&&Object.hasOwnProperty.call(i,"akkoVersion")&&r.uint32(34).string(i.akkoVersion),i.sdkVersion!=null&&Object.hasOwnProperty.call(i,"sdkVersion")&&r.uint32(42).string(i.sdkVersion),i.nativeVersion!=null&&Object.hasOwnProperty.call(i,"nativeVersion")&&r.uint32(50).string(i.nativeVersion),i.platform!=null&&Object.hasOwnProperty.call(i,"platform")&&r.uint32(58).string(i.platform),i.os!=null&&Object.hasOwnProperty.call(i,"os")&&r.uint32(66).string(i.os),i.kind!=null&&Object.hasOwnProperty.call(i,"kind")&&r.uint32(74).string(i.kind),i.uuid!=null&&Object.hasOwnProperty.call(i,"uuid")&&r.uint32(82).string(i.uuid),i.region!=null&&Object.hasOwnProperty.call(i,"region")&&r.uint32(90).string(i.region),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&r.uint32(98).string(i.userId),i.session!=null&&Object.hasOwnProperty.call(i,"session")&&r.uint32(106).string(i.session),i.maxRTT!=null&&Object.hasOwnProperty.call(i,"maxRTT")&&r.uint32(114).string(i.maxRTT),i.minRTT!=null&&Object.hasOwnProperty.call(i,"minRTT")&&r.uint32(122).string(i.minRTT),i.averageRTT!=null&&Object.hasOwnProperty.call(i,"averageRTT")&&r.uint32(130).string(i.averageRTT),i.maxQueue!=null&&Object.hasOwnProperty.call(i,"maxQueue")&&r.uint32(138).string(i.maxQueue),i.minQueue!=null&&Object.hasOwnProperty.call(i,"minQueue")&&r.uint32(146).string(i.minQueue),i.averageQueue!=null&&Object.hasOwnProperty.call(i,"averageQueue")&&r.uint32(154).string(i.averageQueue),i.maxInterval!=null&&Object.hasOwnProperty.call(i,"maxInterval")&&r.uint32(162).string(i.maxInterval),i.minInterval!=null&&Object.hasOwnProperty.call(i,"minInterval")&&r.uint32(170).string(i.minInterval),i.averageInterval!=null&&Object.hasOwnProperty.call(i,"averageInterval")&&r.uint32(178).string(i.averageInterval),i.vid!=null&&Object.hasOwnProperty.call(i,"vid")&&r.uint32(184).int32(i.vid),i.createdAt!=null&&Object.hasOwnProperty.call(i,"createdAt")&&r.uint32(194).string(i.createdAt),i.clientIP!=null&&Object.hasOwnProperty.call(i,"clientIP")&&r.uint32(202).string(i.clientIP),r},e.encodeDelimited=function(i,r){return this.encode(i,r).ldelim()},e.decode=function(i,r){i instanceof Ae||(i=Ae.create(i));var n=r===void 0?i.len:i.pos+r,s=new Oe.WhiteBoardQualitySample;for(;i.pos<n;){var o=i.uint32();switch(o>>>3){case 1:s.lts=i.int64();break;case 2:s.team=i.string();break;case 3:s.app=i.string();break;case 4:s.akkoVersion=i.string();break;case 5:s.sdkVersion=i.string();break;case 6:s.nativeVersion=i.string();break;case 7:s.platform=i.string();break;case 8:s.os=i.string();break;case 9:s.kind=i.string();break;case 10:s.uuid=i.string();break;case 11:s.region=i.string();break;case 12:s.userId=i.string();break;case 13:s.session=i.string();break;case 14:s.maxRTT=i.string();break;case 15:s.minRTT=i.string();break;case 16:s.averageRTT=i.string();break;case 17:s.maxQueue=i.string();break;case 18:s.minQueue=i.string();break;case 19:s.averageQueue=i.string();break;case 20:s.maxInterval=i.string();break;case 21:s.minInterval=i.string();break;case 22:s.averageInterval=i.string();break;case 23:s.vid=i.int32();break;case 24:s.createdAt=i.string();break;case 25:s.clientIP=i.string();break;default:i.skipType(o&7);break;}}return s},e.decodeDelimited=function(i){return i instanceof Ae||(i=new Ae(i)),this.decode(i,i.uint32())},e.verify=function(i){return _typeof(i)!="object"||i===null?"object expected":i.lts!=null&&i.hasOwnProperty("lts")&&!C.isInteger(i.lts)&&!(i.lts&&C.isInteger(i.lts.low)&&C.isInteger(i.lts.high))?"lts: integer|Long expected":i.team!=null&&i.hasOwnProperty("team")&&!C.isString(i.team)?"team: string expected":i.app!=null&&i.hasOwnProperty("app")&&!C.isString(i.app)?"app: string expected":i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&!C.isString(i.akkoVersion)?"akkoVersion: string expected":i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&!C.isString(i.sdkVersion)?"sdkVersion: string expected":i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&!C.isString(i.nativeVersion)?"nativeVersion: string expected":i.platform!=null&&i.hasOwnProperty("platform")&&!C.isString(i.platform)?"platform: string expected":i.os!=null&&i.hasOwnProperty("os")&&!C.isString(i.os)?"os: string expected":i.kind!=null&&i.hasOwnProperty("kind")&&!C.isString(i.kind)?"kind: string expected":i.uuid!=null&&i.hasOwnProperty("uuid")&&!C.isString(i.uuid)?"uuid: string expected":i.region!=null&&i.hasOwnProperty("region")&&!C.isString(i.region)?"region: string expected":i.userId!=null&&i.hasOwnProperty("userId")&&!C.isString(i.userId)?"userId: string expected":i.session!=null&&i.hasOwnProperty("session")&&!C.isString(i.session)?"session: string expected":i.maxRTT!=null&&i.hasOwnProperty("maxRTT")&&!C.isString(i.maxRTT)?"maxRTT: string expected":i.minRTT!=null&&i.hasOwnProperty("minRTT")&&!C.isString(i.minRTT)?"minRTT: string expected":i.averageRTT!=null&&i.hasOwnProperty("averageRTT")&&!C.isString(i.averageRTT)?"averageRTT: string expected":i.maxQueue!=null&&i.hasOwnProperty("maxQueue")&&!C.isString(i.maxQueue)?"maxQueue: string expected":i.minQueue!=null&&i.hasOwnProperty("minQueue")&&!C.isString(i.minQueue)?"minQueue: string expected":i.averageQueue!=null&&i.hasOwnProperty("averageQueue")&&!C.isString(i.averageQueue)?"averageQueue: string expected":i.maxInterval!=null&&i.hasOwnProperty("maxInterval")&&!C.isString(i.maxInterval)?"maxInterval: string expected":i.minInterval!=null&&i.hasOwnProperty("minInterval")&&!C.isString(i.minInterval)?"minInterval: string expected":i.averageInterval!=null&&i.hasOwnProperty("averageInterval")&&!C.isString(i.averageInterval)?"averageInterval: string expected":i.vid!=null&&i.hasOwnProperty("vid")&&!C.isInteger(i.vid)?"vid: integer expected":i.createdAt!=null&&i.hasOwnProperty("createdAt")&&!C.isString(i.createdAt)?"createdAt: string expected":i.clientIP!=null&&i.hasOwnProperty("clientIP")&&!C.isString(i.clientIP)?"clientIP: string expected":null},e.fromObject=function(i){if(i instanceof Oe.WhiteBoardQualitySample)return i;var r=new Oe.WhiteBoardQualitySample;return i.lts!=null&&(C.Long?(r.lts=C.Long.fromValue(i.lts)).unsigned=!1:typeof i.lts=="string"?r.lts=parseInt(i.lts,10):typeof i.lts=="number"?r.lts=i.lts:_typeof(i.lts)=="object"&&(r.lts=new C.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber())),i.team!=null&&(r.team=String(i.team)),i.app!=null&&(r.app=String(i.app)),i.akkoVersion!=null&&(r.akkoVersion=String(i.akkoVersion)),i.sdkVersion!=null&&(r.sdkVersion=String(i.sdkVersion)),i.nativeVersion!=null&&(r.nativeVersion=String(i.nativeVersion)),i.platform!=null&&(r.platform=String(i.platform)),i.os!=null&&(r.os=String(i.os)),i.kind!=null&&(r.kind=String(i.kind)),i.uuid!=null&&(r.uuid=String(i.uuid)),i.region!=null&&(r.region=String(i.region)),i.userId!=null&&(r.userId=String(i.userId)),i.session!=null&&(r.session=String(i.session)),i.maxRTT!=null&&(r.maxRTT=String(i.maxRTT)),i.minRTT!=null&&(r.minRTT=String(i.minRTT)),i.averageRTT!=null&&(r.averageRTT=String(i.averageRTT)),i.maxQueue!=null&&(r.maxQueue=String(i.maxQueue)),i.minQueue!=null&&(r.minQueue=String(i.minQueue)),i.averageQueue!=null&&(r.averageQueue=String(i.averageQueue)),i.maxInterval!=null&&(r.maxInterval=String(i.maxInterval)),i.minInterval!=null&&(r.minInterval=String(i.minInterval)),i.averageInterval!=null&&(r.averageInterval=String(i.averageInterval)),i.vid!=null&&(r.vid=i.vid|0),i.createdAt!=null&&(r.createdAt=String(i.createdAt)),i.clientIP!=null&&(r.clientIP=String(i.clientIP)),r},e.toObject=function(i,r){r||(r={});var n={};if(r.defaults){if(C.Long){var s=new C.Long(0,0,!1);n.lts=r.longs===String?s.toString():r.longs===Number?s.toNumber():s}else n.lts=r.longs===String?"0":0;n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.kind="",n.uuid="",n.region="",n.userId="",n.session="",n.maxRTT="",n.minRTT="",n.averageRTT="",n.maxQueue="",n.minQueue="",n.averageQueue="",n.maxInterval="",n.minInterval="",n.averageInterval="",n.vid=0,n.createdAt="",n.clientIP=""}return i.lts!=null&&i.hasOwnProperty("lts")&&(typeof i.lts=="number"?n.lts=r.longs===String?String(i.lts):i.lts:n.lts=r.longs===String?C.Long.prototype.toString.call(i.lts):r.longs===Number?new C.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber():i.lts),i.team!=null&&i.hasOwnProperty("team")&&(n.team=i.team),i.app!=null&&i.hasOwnProperty("app")&&(n.app=i.app),i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&(n.akkoVersion=i.akkoVersion),i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&(n.sdkVersion=i.sdkVersion),i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&(n.nativeVersion=i.nativeVersion),i.platform!=null&&i.hasOwnProperty("platform")&&(n.platform=i.platform),i.os!=null&&i.hasOwnProperty("os")&&(n.os=i.os),i.kind!=null&&i.hasOwnProperty("kind")&&(n.kind=i.kind),i.uuid!=null&&i.hasOwnProperty("uuid")&&(n.uuid=i.uuid),i.region!=null&&i.hasOwnProperty("region")&&(n.region=i.region),i.userId!=null&&i.hasOwnProperty("userId")&&(n.userId=i.userId),i.session!=null&&i.hasOwnProperty("session")&&(n.session=i.session),i.maxRTT!=null&&i.hasOwnProperty("maxRTT")&&(n.maxRTT=i.maxRTT),i.minRTT!=null&&i.hasOwnProperty("minRTT")&&(n.minRTT=i.minRTT),i.averageRTT!=null&&i.hasOwnProperty("averageRTT")&&(n.averageRTT=i.averageRTT),i.maxQueue!=null&&i.hasOwnProperty("maxQueue")&&(n.maxQueue=i.maxQueue),i.minQueue!=null&&i.hasOwnProperty("minQueue")&&(n.minQueue=i.minQueue),i.averageQueue!=null&&i.hasOwnProperty("averageQueue")&&(n.averageQueue=i.averageQueue),i.maxInterval!=null&&i.hasOwnProperty("maxInterval")&&(n.maxInterval=i.maxInterval),i.minInterval!=null&&i.hasOwnProperty("minInterval")&&(n.minInterval=i.minInterval),i.averageInterval!=null&&i.hasOwnProperty("averageInterval")&&(n.averageInterval=i.averageInterval),i.vid!=null&&i.hasOwnProperty("vid")&&(n.vid=i.vid),i.createdAt!=null&&i.hasOwnProperty("createdAt")&&(n.createdAt=i.createdAt),i.clientIP!=null&&i.hasOwnProperty("clientIP")&&(n.clientIP=i.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Wt.util.toJSONOptions)},e}(),Kw=Oe.WhiteBoardRealtime=function(){function e(t){if(t)for(var i=Object.keys(t),_r246=0;_r246<i.length;++_r246){t[i[_r246]]!=null&&(this[i[_r246]]=t[i[_r246]])}}return e.prototype.lts=C.Long?C.Long.fromBits(0,0,!1):0,e.prototype.akkoVersion="",e.prototype.app="",e.prototype.createdAt="",e.prototype.level="",e.prototype.message="",e.prototype.os="",e.prototype.platform="",e.prototype.region="",e.prototype.sdkVersion="",e.prototype.session="",e.prototype.team="",e.prototype.userId="",e.prototype.uuid="",e.prototype.vid=0,e.prototype.nativeVersion="",e.prototype.clientIP="",e.prototype.suid="",e.prototype.netlessUA="",e.create=function(i){return new e(i)},e.encode=function(i,r){return r||(r=aa.create()),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&r.uint32(8).int64(i.lts),i.akkoVersion!=null&&Object.hasOwnProperty.call(i,"akkoVersion")&&r.uint32(18).string(i.akkoVersion),i.app!=null&&Object.hasOwnProperty.call(i,"app")&&r.uint32(26).string(i.app),i.createdAt!=null&&Object.hasOwnProperty.call(i,"createdAt")&&r.uint32(34).string(i.createdAt),i.level!=null&&Object.hasOwnProperty.call(i,"level")&&r.uint32(42).string(i.level),i.message!=null&&Object.hasOwnProperty.call(i,"message")&&r.uint32(50).string(i.message),i.os!=null&&Object.hasOwnProperty.call(i,"os")&&r.uint32(58).string(i.os),i.platform!=null&&Object.hasOwnProperty.call(i,"platform")&&r.uint32(66).string(i.platform),i.region!=null&&Object.hasOwnProperty.call(i,"region")&&r.uint32(74).string(i.region),i.sdkVersion!=null&&Object.hasOwnProperty.call(i,"sdkVersion")&&r.uint32(82).string(i.sdkVersion),i.session!=null&&Object.hasOwnProperty.call(i,"session")&&r.uint32(90).string(i.session),i.team!=null&&Object.hasOwnProperty.call(i,"team")&&r.uint32(98).string(i.team),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&r.uint32(106).string(i.userId),i.uuid!=null&&Object.hasOwnProperty.call(i,"uuid")&&r.uint32(114).string(i.uuid),i.vid!=null&&Object.hasOwnProperty.call(i,"vid")&&r.uint32(120).int32(i.vid),i.nativeVersion!=null&&Object.hasOwnProperty.call(i,"nativeVersion")&&r.uint32(130).string(i.nativeVersion),i.clientIP!=null&&Object.hasOwnProperty.call(i,"clientIP")&&r.uint32(138).string(i.clientIP),i.suid!=null&&Object.hasOwnProperty.call(i,"suid")&&r.uint32(146).string(i.suid),i.netlessUA!=null&&Object.hasOwnProperty.call(i,"netlessUA")&&r.uint32(154).string(i.netlessUA),r},e.encodeDelimited=function(i,r){return this.encode(i,r).ldelim()},e.decode=function(i,r){i instanceof Ae||(i=Ae.create(i));var n=r===void 0?i.len:i.pos+r,s=new Oe.WhiteBoardRealtime;for(;i.pos<n;){var o=i.uint32();switch(o>>>3){case 1:s.lts=i.int64();break;case 2:s.akkoVersion=i.string();break;case 3:s.app=i.string();break;case 4:s.createdAt=i.string();break;case 5:s.level=i.string();break;case 6:s.message=i.string();break;case 7:s.os=i.string();break;case 8:s.platform=i.string();break;case 9:s.region=i.string();break;case 10:s.sdkVersion=i.string();break;case 11:s.session=i.string();break;case 12:s.team=i.string();break;case 13:s.userId=i.string();break;case 14:s.uuid=i.string();break;case 15:s.vid=i.int32();break;case 16:s.nativeVersion=i.string();break;case 17:s.clientIP=i.string();break;case 18:s.suid=i.string();break;case 19:s.netlessUA=i.string();break;default:i.skipType(o&7);break;}}return s},e.decodeDelimited=function(i){return i instanceof Ae||(i=new Ae(i)),this.decode(i,i.uint32())},e.verify=function(i){return _typeof(i)!="object"||i===null?"object expected":i.lts!=null&&i.hasOwnProperty("lts")&&!C.isInteger(i.lts)&&!(i.lts&&C.isInteger(i.lts.low)&&C.isInteger(i.lts.high))?"lts: integer|Long expected":i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&!C.isString(i.akkoVersion)?"akkoVersion: string expected":i.app!=null&&i.hasOwnProperty("app")&&!C.isString(i.app)?"app: string expected":i.createdAt!=null&&i.hasOwnProperty("createdAt")&&!C.isString(i.createdAt)?"createdAt: string expected":i.level!=null&&i.hasOwnProperty("level")&&!C.isString(i.level)?"level: string expected":i.message!=null&&i.hasOwnProperty("message")&&!C.isString(i.message)?"message: string expected":i.os!=null&&i.hasOwnProperty("os")&&!C.isString(i.os)?"os: string expected":i.platform!=null&&i.hasOwnProperty("platform")&&!C.isString(i.platform)?"platform: string expected":i.region!=null&&i.hasOwnProperty("region")&&!C.isString(i.region)?"region: string expected":i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&!C.isString(i.sdkVersion)?"sdkVersion: string expected":i.session!=null&&i.hasOwnProperty("session")&&!C.isString(i.session)?"session: string expected":i.team!=null&&i.hasOwnProperty("team")&&!C.isString(i.team)?"team: string expected":i.userId!=null&&i.hasOwnProperty("userId")&&!C.isString(i.userId)?"userId: string expected":i.uuid!=null&&i.hasOwnProperty("uuid")&&!C.isString(i.uuid)?"uuid: string expected":i.vid!=null&&i.hasOwnProperty("vid")&&!C.isInteger(i.vid)?"vid: integer expected":i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&!C.isString(i.nativeVersion)?"nativeVersion: string expected":i.clientIP!=null&&i.hasOwnProperty("clientIP")&&!C.isString(i.clientIP)?"clientIP: string expected":i.suid!=null&&i.hasOwnProperty("suid")&&!C.isString(i.suid)?"suid: string expected":i.netlessUA!=null&&i.hasOwnProperty("netlessUA")&&!C.isString(i.netlessUA)?"netlessUA: string expected":null},e.fromObject=function(i){if(i instanceof Oe.WhiteBoardRealtime)return i;var r=new Oe.WhiteBoardRealtime;return i.lts!=null&&(C.Long?(r.lts=C.Long.fromValue(i.lts)).unsigned=!1:typeof i.lts=="string"?r.lts=parseInt(i.lts,10):typeof i.lts=="number"?r.lts=i.lts:_typeof(i.lts)=="object"&&(r.lts=new C.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber())),i.akkoVersion!=null&&(r.akkoVersion=String(i.akkoVersion)),i.app!=null&&(r.app=String(i.app)),i.createdAt!=null&&(r.createdAt=String(i.createdAt)),i.level!=null&&(r.level=String(i.level)),i.message!=null&&(r.message=String(i.message)),i.os!=null&&(r.os=String(i.os)),i.platform!=null&&(r.platform=String(i.platform)),i.region!=null&&(r.region=String(i.region)),i.sdkVersion!=null&&(r.sdkVersion=String(i.sdkVersion)),i.session!=null&&(r.session=String(i.session)),i.team!=null&&(r.team=String(i.team)),i.userId!=null&&(r.userId=String(i.userId)),i.uuid!=null&&(r.uuid=String(i.uuid)),i.vid!=null&&(r.vid=i.vid|0),i.nativeVersion!=null&&(r.nativeVersion=String(i.nativeVersion)),i.clientIP!=null&&(r.clientIP=String(i.clientIP)),i.suid!=null&&(r.suid=String(i.suid)),i.netlessUA!=null&&(r.netlessUA=String(i.netlessUA)),r},e.toObject=function(i,r){r||(r={});var n={};if(r.defaults){if(C.Long){var s=new C.Long(0,0,!1);n.lts=r.longs===String?s.toString():r.longs===Number?s.toNumber():s}else n.lts=r.longs===String?"0":0;n.akkoVersion="",n.app="",n.createdAt="",n.level="",n.message="",n.os="",n.platform="",n.region="",n.sdkVersion="",n.session="",n.team="",n.userId="",n.uuid="",n.vid=0,n.nativeVersion="",n.clientIP="",n.suid="",n.netlessUA=""}return i.lts!=null&&i.hasOwnProperty("lts")&&(typeof i.lts=="number"?n.lts=r.longs===String?String(i.lts):i.lts:n.lts=r.longs===String?C.Long.prototype.toString.call(i.lts):r.longs===Number?new C.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber():i.lts),i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&(n.akkoVersion=i.akkoVersion),i.app!=null&&i.hasOwnProperty("app")&&(n.app=i.app),i.createdAt!=null&&i.hasOwnProperty("createdAt")&&(n.createdAt=i.createdAt),i.level!=null&&i.hasOwnProperty("level")&&(n.level=i.level),i.message!=null&&i.hasOwnProperty("message")&&(n.message=i.message),i.os!=null&&i.hasOwnProperty("os")&&(n.os=i.os),i.platform!=null&&i.hasOwnProperty("platform")&&(n.platform=i.platform),i.region!=null&&i.hasOwnProperty("region")&&(n.region=i.region),i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&(n.sdkVersion=i.sdkVersion),i.session!=null&&i.hasOwnProperty("session")&&(n.session=i.session),i.team!=null&&i.hasOwnProperty("team")&&(n.team=i.team),i.userId!=null&&i.hasOwnProperty("userId")&&(n.userId=i.userId),i.uuid!=null&&i.hasOwnProperty("uuid")&&(n.uuid=i.uuid),i.vid!=null&&i.hasOwnProperty("vid")&&(n.vid=i.vid),i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&(n.nativeVersion=i.nativeVersion),i.clientIP!=null&&i.hasOwnProperty("clientIP")&&(n.clientIP=i.clientIP),i.suid!=null&&i.hasOwnProperty("suid")&&(n.suid=i.suid),i.netlessUA!=null&&i.hasOwnProperty("netlessUA")&&(n.netlessUA=i.netlessUA),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Wt.util.toJSONOptions)},e}();var Nn;(function(r){r.Connected="connected",r.ConnectFailed="connectFailed",r.Sample="sample"})(Nn||(Nn={}));var Gw=Object.freeze({Realtime:Object.freeze({eventID:9115,proto:Kw}),Player:Object.freeze({eventID:9118,proto:Vw})}),$w=Object.freeze({QualityConnection:Object.freeze({eventID:9120,proto:Ww}),QualityDisconnection:Object.freeze({eventID:9121,proto:Hw}),QualitySample:Object.freeze({eventID:9123,proto:_w})});function Ln(e,t){var n;var i=EE(),r={team:e,app:t,platform:(i==null?void 0:i.platform)||"browser",akkoVersion:Le,sdkVersion:ae.sdkVersion,nativeVersion:i==null?void 0:i.nativeVersion,os:(n=window.navigator)==null?void 0:n.platform,netlessUA:TE()};for(var s in r){r[s]===void 0&&delete r[s]}return r}function TE(){var e=window.__netlessUA;if(typeof e=="string")return e.slice(0,255).split(/\s+/).filter(function(t){return t.includes("/")}).join(" ")}function EE(){var e=window.__nativeTags;if(_typeof(e)=="object"&&e!==null){var t=e.nativeVersion,i=e.platform;if(typeof t=="string"&&typeof i=="string")return{nativeVersion:t,platform:i}}return null}var Ci;(function(r){r.AlwaysReport="alwaysReport",r.BanReport="banReport",r.DependsOnRemote="dependsOnRemote"})(Ci||(Ci={}));var Kc=/*#__PURE__*/function(){function Kc(t,i,r){_classCallCheck(this,Kc);this.teamUUID=t,this.appUUID=i,this.loggerHub=this.createLoggerHub(r)}_createClass(Kc,[{key:"createLoggerHub",value:function createLoggerHub(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i="[White]",r=t.reportDebugLogMode||Ci.AlwaysReport,n;switch(r){case Ci.BanReport:{n=new ls({prefix:i,levelMask:t.printLevelMask});break}case Ci.AlwaysReport:case Ci.DependsOnRemote:{var _ae$log$argusOptions=ae.log.argusOptions,s=_ae$log$argusOptions.reportResourceURL,o=_ae$log$argusOptions.vid;n=new _c({vid:o,reportResourceURL:s,prefix:i,reportLevelMask:t.reportLevelMask,printLevelMask:t.printLevelMask,timestampKey:"createdAt",events:Gw,on:t.callbacksWhenReceiveLog});break}default:throw new Error("unrecognized LoggerReportMode ".concat(JSON.stringify(r)));}return n}},{key:"createRealtimeLogger",value:function createRealtimeLogger(t,i,r){var n=Object.freeze(D(I({},Ln(this.teamUUID,this.appUUID)),{uuid:t,uid:i,suid:i,region:r}));return no(this.loggerHub,"Realtime",n)}},{key:"createPlayerLogger",value:function createPlayerLogger(t){var i=Object.freeze(D(I({},Ln(this.teamUUID,this.appUUID)),{region:t}));return no(this.loggerHub,"Player",i)}}]);return Kc}();var Gc=/*#__PURE__*/function(){function Gc(t,i){_classCallCheck(this,Gc);var _ae$log$argusOptions2=ae.log.argusOptions,r=_ae$log$argusOptions2.reportResourceURL,n=_ae$log$argusOptions2.vid;this.loggerHub=new _c({vid:n,reportResourceURL:r,timestampKey:"createdAt",events:$w}),this.teamUUID=t,this.appUUID=i}_createClass(Gc,[{key:"createQualityConnectionCommitter",value:function createQualityConnectionCommitter(t,i){var r=Object.freeze(D(I({},Ln(this.teamUUID,this.appUUID)),{kind:Nn.Connected,uuid:t,region:i}));return Ga(this.loggerHub,"QualityConnection",r)}},{key:"createQualityDisconnectionCommitter",value:function createQualityDisconnectionCommitter(t,i){var r=Object.freeze(D(I({},Ln(this.teamUUID,this.appUUID)),{kind:Nn.ConnectFailed,uuid:t,region:i}));return Ga(this.loggerHub,"QualityDisconnection",r)}},{key:"createQualitySampleCommitter",value:function createQualitySampleCommitter(t,i){var r=Object.freeze(D(I({},Ln(this.teamUUID,this.appUUID)),{kind:Nn.Sample,uuid:t,region:i}));return Ga(this.loggerHub,"QualitySample",r)}}]);return Gc}();function Yw(e){return e}var Qw=1024,Jt;(function(n){n.Desktop="desktop",n.Phone="phone",n.Pad="pad",n.TV="tv"})(Jt||(Jt={}));var Wi=/*#__PURE__*/function(){function Wi(t){_classCallCheck(this,Wi);this.version=ae.sdkVersion;var n;var _this$parseAppIdentif=this.parseAppIdentifier(t.appIdentifier),i=_this$parseAppIdentif.teamUUID,r=_this$parseAppIdentif.appUUID;if(t.deviceType&&t.screenType)this.deviceType=t.deviceType,this.screenType=t.screenType;else if(t.deviceType&&!t.screenType)this.deviceType=t.deviceType,this.screenType=t.deviceType===Ue.Touch?Jt.Phone:Jt.Desktop;else if(!t.deviceType&&t.screenType)this.deviceType=Ue.Surface,this.screenType=t.screenType;else{switch(Xw["default"].deviceType){case"mouseOnly":{this.screenType=Jt.Desktop;break}case"touchOnly":{this.screenType=Jt.Phone;break}case"hybrid":{this.screenType=Jt.Desktop;break}}this.deviceType=Ue.Surface}if(t.renderEngine!==ei.SVG&&!this.isCanvasRenderEngineAvailable()?this.renderEngine=ei.SVG:t.renderEngine?this.renderEngine=t.renderEngine:this.renderEngine=ei.Canvas,this.region=t.region||ae.defaultRegion,this.pptParams=t.pptParams,((n=t.loggerOptions)==null?void 0:n.disableReportLog)!==void 0)throw new Error("loggserOptions.disableReportLog is deprecated. please replace it with reportDebugLogMode or reportQualityMode");this.enableReportQuality(t.loggerOptions)&&(this.qualityLoggerFactory=new Gc(i,r)),this.whiteLoggerFactory=new Kc(i,r,t.loggerOptions),this.akkoApp=new od({appIdentifier:t.appIdentifier,observerAdapter:new VS,clientVersion:ae.sdkVersion,enableAnimationFrame:!0,jsxFactory:$c.createElement,escapeObjectFilter:$c.isValidElement,reconnectionOptions:t.reconnectionOptions,netStateAdapter:Wi.netState,convertIdToUrl:t.urlInterrupter||function(s){return s},configsInterrupter:Yw,shuntApiHosts:t.apiHosts||ae.shuntApiHosts,onAkkoSetupFailed:t.onWhiteSetupFailed}),this.preloadDynamicPPT=!!t.preloadDynamicPPT,this.fonts=Object.freeze(I({},t.fonts)),this.handToolKey=t.handToolKey,this.fontFamily=t.fontFamily,this.disableCurveAnimes=Wi.defaultValue(t.disableCurveAnimes,!0),this.disableNewPencilStroke=Wi.defaultValue(t.disableNewPencilStroke,!1),this.disableRotation=!!t.disableRotation,this.urlInterrupter=t.urlInterrupter||function(s){return s},this.boundless=new bo(this.deviceType),this.plugins=this.assertPlugins(t.plugins),this.invisiblePlugins=this.assertInvisiblePlugins(t.invisiblePlugins),this.wrappedComponents=Object.freeze(t.wrappedComponents?_toConsumableArray(t.wrappedComponents):[]),this.useMobXState=!!t.useMobXState,this.onlyCallbackRemoteStateModify=!!t.onlyCallbackRemoteStateModify,tm.injectDefaultStyleIfNotInjectBefore()}_createClass(Wi,[{key:"joinRoom",value:function(){var _joinRoom=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee106(t,i){var r,n,s,o,a,l,h,d;return regeneratorRuntime.wrap(function _callee106$(_context110){while(1){switch(_context110.prev=_context110.next){case 0:r=t.uuid;if(!(t.useMultiViews&&t.cursorAdapter)){_context110.next=3;break}throw new Error("cannot pass cursorAdapter when open useMultiViews");case 3:n=t.region||this.region,s=this.standardizeUserPayload(t.uid,t.userPayload),o=this.whiteLoggerFactory.createRealtimeLogger(r,s.uid,n),a=am(t.floatBar),l=this.qualityLoggerFactory&&{connection:this.qualityLoggerFactory.createQualityConnectionCommitter(r,n),disconnection:this.qualityLoggerFactory.createQualityDisconnectionCommitter(r,n),sample:this.qualityLoggerFactory.createQualitySampleCommitter(r,n)};t.newPencilWritingQuality!==void 0?h=t.newPencilWritingQuality:h=yr.Hight;d=new Ui({whiteLogger:o,qualityComitters:l,region:n,floatBarOptions:a,boundless:this.boundless,screenType:this.screenType,renderEngine:this.renderEngine,autoResize:!t.disableAutoResize,plugins:this.plugins,invisiblePlugins:this.mergeArray(this.invisiblePlugins,this.assertInvisiblePlugins(t.invisiblePlugins)),wrappedComponents:this.mergeArray(this.wrappedComponents,t.wrappedComponents),akkoApp:this.akkoApp,preloadDynamicPPT:this.preloadDynamicPPT,userFonts:this.fonts,handToolKey:this.handToolKey,fontFamily:this.fontFamily,undoCacheScenesCount:Wi.defaultValue(t.undoCacheScenesCount,12),cameraBound:this.standardizeCameraBound(t.cameraBound),userPayload:s,disableDeviceInputs:!!t.disableDeviceInputs,disableCameraTransform:t.disableCameraTransform,disableMagixEventDispatchLimit:!!t.disableMagixEventDispatchLimit,disableEraseImage:Wi.defaultValue(t.disableEraseImage,!0),disableOthersSelectingBox:!!t.disableOthersSelectingBox,disablePencilWrittingLimitFrequency:!!t.disablePencilWrittingLimitFrequency,disableCurveAnimes:this.disableCurveAnimes,disableRotation:this.disableRotation,disableNewPencilStroke:this.disableNewPencilStroke,newPencilWritingQuality:h,enableTextareHub:!!a||!t.disableTextOperations,useMultiViews:t.useMultiViews,onlyCallbackRemoteStateModify:this.onlyCallbackRemoteStateModify,cursorAdapter:t.cursorAdapter,hotKeys:t.hotKeys,rejectWhenReadonlyErrorLevel:t.rejectWhenReadonlyErrorLevel,eraserRadiusCursor:new nc(o),urlInterrupter:this.urlInterrupter,pptParams:this.pptParams,useMobXState:this.useMobXState,modulesOrigin:t.modulesOrigin,callbacks:i});_context110.next=8;return d.connect({uuid:r,region:n,roomToken:t.roomToken,userPayload:s,deviceType:this.deviceType,isWritable:Wi.defaultValue(t.isWritable,!0),enableDrawPoint:Wi.defaultValue(t.enableDrawPoint,!1),disableNewPencil:Wi.defaultValue(t.disableNewPencil,!0)});case 8:return _context110.abrupt("return",d);case 9:case"end":return _context110.stop();}}},_callee106,this)}));function joinRoom(_x185,_x186){return _joinRoom.apply(this,arguments)}return joinRoom}()},{key:"isPlayable",value:function(){var _isPlayable=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee107(t){var i;return regeneratorRuntime.wrap(function _callee107$(_context111){while(1){switch(_context111.prev=_context111.next){case 0:i={region:t.region||this.region,room:t.room,roomToken:t.roomToken,slice:t.slice,beginTimestamp:t.beginTimestamp,duration:t.duration};_context111.next=3;return this.akkoApp.searchSlices(i);case 3:_context111.t0=_context111.sent.length;return _context111.abrupt("return",_context111.t0>0);case 5:case"end":return _context111.stop();}}},_callee107,this)}));function isPlayable(_x187){return _isPlayable.apply(this,arguments)}return isPlayable}()},{key:"replayRoom",value:function(){var _replayRoom=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee108(t,i){var r,n,s;return regeneratorRuntime.wrap(function _callee108$(_context112){while(1){switch(_context112.prev=_context112.next){case 0:if(!t.mediaURL){_context112.next=2;break}throw new Error("mediaURL was deprecated. please to see https://github.com/netless-io/netless-combine-player");case 2:if(!(t.useMultiViews&&t.cursorAdapter)){_context112.next=4;break}throw new Error("cannot pass cursorAdapter when open useMultiViews");case 4:r=t.region||this.region,n=this.whiteLoggerFactory.createPlayerLogger(r),s=new En({logger:n,region:r,boundless:this.boundless,screenType:this.screenType,renderEngine:this.renderEngine,autoResize:!t.disableAutoResize,plugins:this.plugins,invisiblePlugins:this.mergeArray(this.invisiblePlugins,this.assertInvisiblePlugins(t.invisiblePlugins)),wrappedComponents:this.mergeArray(this.wrappedComponents,t.wrappedComponents),preloadDynamicPPT:this.preloadDynamicPPT,userFonts:this.fonts,handToolKey:this.handToolKey,fontFamily:this.fontFamily,cameraBound:this.standardizeCameraBound(t.cameraBound),onlyCallbackRemoteStateModify:this.onlyCallbackRemoteStateModify,disableCameraTransform:t.disableCameraTransform,disableOthersSelectingBox:!!t.disableOthersSelectingBox,disableNewPencilStroke:this.disableNewPencilStroke,useMultiViews:t.useMultiViews,cursorAdapter:t.cursorAdapter,disableCurveAnimes:this.disableCurveAnimes,disableRotation:this.disableRotation,eraserRadiusCursor:new nc(n),urlInterrupter:this.urlInterrupter,pptParams:this.pptParams,useMobXState:this.useMobXState,callbacks:i});_context112.next=7;return s.setupReconstructor({akkoApp:this.akkoApp,region:r,slice:t.slice,room:t.room,roomToken:t.roomToken,beginTimestamp:t.beginTimestamp,duration:t.duration});case 7:return _context112.abrupt("return",s);case 8:case"end":return _context112.stop();}}},_callee108,this)}));function replayRoom(_x188,_x189){return _replayRoom.apply(this,arguments)}return replayRoom}()},{key:"standardizeUserPayload",value:function standardizeUserPayload(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var r=i;if(t===void 0)throw new Error("expect uid on parameters");if(typeof t!="string")throw new Error("invalid uid. ".concat(t," should be string"));if(t.length>Qw)throw new Error("invalid uid. length cannot over ".concat(Qw));if(_typeof(r)!="object"||r===null)throw new Error("invalid payload. ".concat(r," should be object"));if(r=I({},r),"uid"in r&&r.uid!==t)throw new Error("payload did have uid ".concat(r.uid," that is not equals to ").concat(t));return r.uid=t,r}},{key:"pptConverter",value:function pptConverter(t){return new Ns(t)}},{key:"standardizeCameraBound",value:function standardizeCameraBound(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return I({maxContentMode:Xo(10),minContentMode:Xo(.1),width:1/0,height:1/0},t)}},{key:"enableReportQuality",value:function enableReportQuality(t){return(t==null?void 0:t.reportQualityMode)!==Ci.BanReport}},{key:"isCanvasRenderEngineAvailable",value:function isCanvasRenderEngineAvailable(){var t=["setTransform","translate","scale","drawImage","getTransform","resetTransform","clearRect","fillStyle","lineWidth","strokeStyle","lineJoin","lineCap","beginPath","moveTo","quadraticCurveTo","bezierCurveTo","stroke","lineTo","arc","fill","ellipse","setLineDash","strokeRect","closePath"],i=document.createElement("canvas");if(i===void 0)return!1;var r=i.getContext("2d");if(r===null)return!1;for(var _i63=0,_t21=t;_i63<_t21.length;_i63++){var n=_t21[_i63];if(!(n in r))return!1}return!0}},{key:"parseAppIdentifier",value:function parseAppIdentifier(t){if(!/^[0-9a-zA-Z\-_]+\/[0-9a-zA-Z\-_]+$/.test(t))throw new Error("find invalid appIdentifier: ".concat(JSON.stringify(t)));var _t$split2=t.split("/"),_t$split3=_slicedToArray(_t$split2,2),i=_t$split3[0],r=_t$split3[1];return{teamUUID:i,appUUID:r}}},{key:"assertPlugins",value:function assertPlugins(t){var i;return t&&(t instanceof Fs?i=t:console.warn("plugins is not instance of Plugins. plugins will not be working. you should call createPlugins() to create it")),i||(i=new Fs({})),i}},{key:"assertInvisiblePlugins",value:function assertInvisiblePlugins(t){var i=[];if(t){var _iterator282=_createForOfIteratorHelper(t),_step282;try{for(_iterator282.s();!(_step282=_iterator282.n()).done;){var _r247=_step282.value;this.isValidInvisiblePluginClass(_r247)&&i.push(_r247)}}catch(err){_iterator282.e(err)}finally{_iterator282.f()}}return Object.freeze(i)}},{key:"isValidInvisiblePluginClass",value:function isValidInvisiblePluginClass(t){if(typeof t.kind!="string")return console.warn("invisible plugin class is invalid. expect `public static readonly kind: string = 'xxx';`"),!1;var i=t.prototype;for(;i!==null;){if(i===js.prototype)return!0;i=Object.getPrototypeOf(i)}return console.warn("invisible plugin class is not extends InvisiblePlugin"),!1}},{key:"mergeArray",value:function mergeArray(t,i){var r=_toConsumableArray(t);if(i){var _iterator283=_createForOfIteratorHelper(i),_step283;try{for(_iterator283.s();!(_step283=_iterator283.n()).done;){var n=_step283.value;t.indexOf(n)===-1&&r.push(n)}}catch(err){_iterator283.e(err)}finally{_iterator283.f()}}return r}}],[{key:"defaultValue",value:function defaultValue(t,i){return t===void 0?i:t}}]);return Wi}(),lm=Wi;lm.netState=new lp;var AE=ae.sdkVersion;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */ /**
 *  @preserve  JavaScript implementation of
 *  Algorithm for Automatically Fitting Digitized Curves
 *  by Philip J. Schneider
 *  "Graphics Gems", Academic Press, 1990
 *
 *  The MIT License (MIT)
 *
 *  https://github.com/soswow/fit-curves
 */